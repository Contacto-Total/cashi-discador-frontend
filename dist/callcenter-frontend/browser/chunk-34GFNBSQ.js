import{a as Pe}from"./chunk-F4ESQKJH.js";import{a as Ke}from"./chunk-EELKXYU7.js";import{a as Ze}from"./chunk-66CICBUX.js";import{a as ee,b as Je}from"./chunk-OGXHDHRM.js";import"./chunk-76RYP7OX.js";import"./chunk-2IM3EOOC.js";import{a as je,b as de,e as ce,h as ue,j as De,m as Te,n as Fe,o as Me,p as We,q as He,r as Ee,s as Ge,t as ze,u as Qe,v as Ye,x as me}from"./chunk-C2F54ORN.js";import{f as Be}from"./chunk-HQKAFSDW.js";import{$ as H,Ab as p,Bb as g,Cb as fe,Cc as Oe,Dc as ke,Eb as V,Fb as L,G as Z,Gb as v,Hb as l,Ib as r,Jb as E,Qb as y,Sb as S,Ub as u,Xa as d,Xc as Ue,Y as he,Yb as ve,Zb as Se,_b as we,a as N,ad as se,b as Ce,bb as O,bd as ne,da as Q,ea as Re,ec as le,fc as A,gc as c,hc as U,ib as ie,ic as f,jc as xe,jd as G,ka as x,la as _,lc as w,mc as k,md as M,nb as Ne,nc as D,p as J,rc as K,tc as X,ua as b,xa as qe,xc as $e,yc as B,zb as ye,zc as re}from"./chunk-HLFIS3WE.js";var Ve=(a,s)=>s.id,mt=(a,s)=>s.value,pt=(a,s)=>s.value||s;function gt(a,s){a&1&&(l(0,"span",6),c(1,"*"),r())}function ht(a,s){if(a&1&&(l(0,"p",7),c(1),r()),a&2){let i=u().$implicit;d(),U(i.helpText)}}function ft(a,s){if(a&1){let i=y();l(0,"input",20),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u(2);w("ngModel",e.fieldData()[i.id]),v("placeholder",i.placeholder||"")("required",i.required??!1)("minlength",i.minLength??null)("maxlength",i.maxLength??null)}}function xt(a,s){if(a&1){let i=y();l(0,"input",21),S("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return _(o.updateFieldValue(n.id,t))}),r()}if(a&2){let i=u().$implicit,e=u(2);v("ngModel",e.fieldData()[i.id])("placeholder",i.placeholder||"")("required",i.required??!1)("min",i.min??null)("max",i.max??null)}}function _t(a,s){if(a&1){let i=y();l(0,"div",10)(1,"span",22),c(2,"S/"),r(),l(3,"input",23),S("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return _(o.updateFieldValue(n.id,t))}),r()()}if(a&2){let i=u().$implicit,e=u(2);d(3),v("ngModel",e.fieldData()[i.id])("placeholder",i.placeholder||"0.00")("required",i.required??!1)("min",i.min||0)}}function bt(a,s){if(a&1){let i=y();l(0,"input",24),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u(2);w("ngModel",e.fieldData()[i.id]),v("required",i.required??!1)}}function Ct(a,s){if(a&1){let i=y();l(0,"input",25),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u(2);w("ngModel",e.fieldData()[i.id]),v("required",i.required??!1)}}function yt(a,s){if(a&1&&(l(0,"option",28),c(1),r()),a&2){let i=s.$implicit;v("value",i.value),d(),U(i.label)}}function vt(a,s){if(a&1){let i=y();l(0,"select",26),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),l(1,"option",27),c(2,"-- Seleccionar --"),r(),V(3,yt,2,2,"option",28,mt),r()}if(a&2){let i=u().$implicit,e=u(2);w("ngModel",e.fieldData()[i.id]),v("required",i.required??!1),d(3),L(i.options)}}function St(a,s){if(a&1){let i=y();l(0,"textarea",29),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u(2);w("ngModel",e.fieldData()[i.id]),v("placeholder",i.placeholder||"")("required",i.required??!1)("minlength",i.minLength??null)("maxlength",i.maxLength??null)}}function wt(a,s){if(a&1){let i=y();l(0,"div",15)(1,"input",30),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),r(),l(2,"span",31),c(3),r()()}if(a&2){let i=u().$implicit,e=u(2);d(),w("ngModel",e.fieldData()[i.id]),v("required",i.required??!1),d(2),U(i.placeholder||"Marcar si aplica")}}function kt(a,s){if(a&1){let i=y();l(0,"div",10)(1,"span",22),c(2,"\u{1F4F1}"),r(),l(3,"input",32),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),r()()}if(a&2){let i=u().$implicit,e=u(2);d(3),w("ngModel",e.fieldData()[i.id]),v("placeholder",i.placeholder||"999 999 999")("required",i.required??!1)}}function Dt(a,s){if(a&1){let i=y();l(0,"input",33),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u(2);w("ngModel",e.fieldData()[i.id]),v("required",i.required??!1)}}function Tt(a,s){if(a&1){let i=y();l(0,"input",34),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u(2);w("ngModel",e.fieldData()[i.id]),v("placeholder",i.placeholder||"ejemplo@correo.com")("required",i.required??!1)}}function Ft(a,s){if(a&1){let i=y();l(0,"input",35),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u(2);return k(o.fieldData()[n.id],t)||(o.fieldData()[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u(2);w("ngModel",e.fieldData()[i.id]),v("placeholder",i.placeholder||"https://ejemplo.com")("required",i.required??!1)}}function Mt(a,s){a&1&&(l(0,"span",44),c(1,"*"),r())}function Et(a,s){if(a&1&&(l(0,"th",39),c(1),p(2,Mt,2,0,"span",44),r()),a&2){let i=s.$implicit;d(),f(" ",i.label," "),d(),g(i.required?2:-1)}}function Pt(a,s){a&1&&E(0,"th",40)}function It(a,s){if(a&1&&(l(0,"div",47),c(1),r()),a&2){let i=u(2).$index;d(),f(" ",i+1," ")}}function Nt(a,s){if(a&1){let i=y();l(0,"input",54),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u().$implicit;return k(o[n.id],t)||(o[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u().$implicit;w("ngModel",e[i.id]),v("required",i.required??!1)}}function Vt(a,s){if(a&1){let i=y();l(0,"input",55),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u().$implicit;return k(o[n.id],t)||(o[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u().$implicit;w("ngModel",e[i.id]),v("required",i.required??!1)}}function Lt(a,s){if(a&1){let i=y();l(0,"div",10)(1,"span",56),c(2,"S/"),r(),l(3,"input",57),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u().$implicit;return k(o[n.id],t)||(o[n.id]=t),_(t)}),r()()}if(a&2){let i=u().$implicit,e=u().$implicit;d(3),w("ngModel",e[i.id]),v("required",i.required??!1)}}function At(a,s){if(a&1){let i=y();l(0,"input",58),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u().$implicit;return k(o[n.id],t)||(o[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u().$implicit,t=u(4);w("ngModel",e[i.id]),v("required",i.required??!1)("min",t.getMinDate(i))("max",t.getMaxDate(i))}}function Rt(a,s){if(a&1){let i=y();l(0,"input",59),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u().$implicit;return k(o[n.id],t)||(o[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u().$implicit;w("ngModel",e[i.id]),v("required",i.required??!1)}}function qt(a,s){if(a&1){let i=y();l(0,"input",60),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u().$implicit;return k(o[n.id],t)||(o[n.id]=t),_(t)}),r()}if(a&2){let i=u().$implicit,e=u().$implicit;w("ngModel",e[i.id]),v("required",i.required??!1)}}function $t(a,s){if(a&1&&(l(0,"option",28),c(1),r()),a&2){let i=s.$implicit;v("value",i.value||i),d(),f(" ",i.label||i," ")}}function Ot(a,s){if(a&1){let i=y();l(0,"select",61),D("ngModelChange",function(t){x(i);let n=u().$implicit,o=u().$implicit;return k(o[n.id],t)||(o[n.id]=t),_(t)}),l(1,"option",27),c(2,"Seleccionar..."),r(),V(3,$t,2,2,"option",28,pt),r()}if(a&2){let i=u().$implicit,e=u().$implicit;w("ngModel",e[i.id]),v("required",i.required??!1),d(3),L(i.options)}}function Ut(a,s){if(a&1&&(l(0,"td",45),p(1,It,2,1,"div",47)(2,Nt,1,2,"input",48)(3,Vt,1,2,"input",49)(4,Lt,4,2,"div",10)(5,At,1,4,"input",50)(6,Rt,1,2,"input",51)(7,qt,1,2,"input",52)(8,Ot,5,2,"select",53),r()),a&2){let i=s.$implicit;d(),g(i.type==="auto-number"?1:i.type==="text"?2:i.type==="number"?3:i.type==="currency"?4:i.type==="date"?5:i.type==="time"?6:i.type==="phone"?7:i.type==="select"?8:-1)}}function Bt(a,s){if(a&1){let i=y();l(0,"td",46)(1,"button",62),S("click",function(){x(i);let t=u().$index,n=u(2).$implicit,o=u(2);return _(o.removeTableRow(n.id,t))}),r()()}}function jt(a,s){if(a&1&&(l(0,"tr",42),V(1,Ut,9,1,"td",45,Ve),p(3,Bt,2,0,"td",46),r()),a&2){let i=u(2).$implicit;d(),L(i.columns),d(2),g(i.allowDeleteRow?3:-1)}}function Wt(a,s){if(a&1&&(l(0,"tr")(1,"td",63)(2,"div",64),E(3,"div",65),l(4,"p",66),c(5,"No hay registros en la tabla"),r(),l(6,"p",67),c(7,'Haz clic en "Agregar Fila" para comenzar'),r()()()()),a&2){let i=u(2).$implicit;d(),ye("colspan",i.columns.length+(i.allowDeleteRow?1:0))}}function Ht(a,s){if(a&1){let i=y();l(0,"div",43)(1,"button",68),S("click",function(){x(i);let t=u(2).$implicit,n=u(2);return _(n.addTableRow(t.id,t.columns||[]))}),c(2," Agregar Fila "),r()()}}function Gt(a,s){if(a&1&&(l(0,"div",19)(1,"div",36)(2,"table",37)(3,"thead")(4,"tr",38),V(5,Et,3,2,"th",39,Ve),p(7,Pt,1,0,"th",40),r()(),l(8,"tbody",41),V(9,jt,4,1,"tr",42,fe),p(11,Wt,8,1,"tr"),r()()(),p(12,Ht,3,0,"div",43),r()),a&2){let i=u().$implicit,e=u(2);d(5),L(i.columns),d(2),g(i.allowDeleteRow?7:-1),d(2),L(e.getTableRows(i.id)),d(2),g(e.getTableRows(i.id).length===0?11:-1),d(),g(i.allowAddRow&&(!i.maxRows||e.getTableRows(i.id).length<i.maxRows)?12:-1)}}function zt(a,s){if(a&1&&(l(0,"div")(1,"label",5),c(2),p(3,gt,2,0,"span",6),r(),p(4,ht,2,1,"p",7),p(5,ft,1,5,"input",8),p(6,xt,1,5,"input",9),p(7,_t,4,4,"div",10),p(8,bt,1,2,"input",11),p(9,Ct,1,2,"input",12),p(10,vt,5,2,"select",13),p(11,St,1,5,"textarea",14),p(12,wt,4,3,"div",15),p(13,kt,4,3,"div",10),p(14,Dt,1,2,"input",16),p(15,Tt,1,3,"input",17),p(16,Ft,1,3,"input",18),p(17,Gt,13,3,"div",19),r()),a&2){let i=s.$implicit;le("md:col-span-2",i.type==="table"||i.type==="textarea"),d(2),f(" ",i.label," "),d(),g(i.required?3:-1),d(),g(i.helpText?4:-1),d(),g(i.type==="text"?5:-1),d(),g(i.type==="number"?6:-1),d(),g(i.type==="currency"?7:-1),d(),g(i.type==="date"?8:-1),d(),g(i.type==="datetime"?9:-1),d(),g(i.type==="select"?10:-1),d(),g(i.type==="textarea"?11:-1),d(),g(i.type==="checkbox"?12:-1),d(),g(i.type==="phone"?13:-1),d(),g(i.type==="time"?14:-1),d(),g(i.type==="email"?15:-1),d(),g(i.type==="url"?16:-1),d(),g(i.type==="table"?17:-1)}}function Qt(a,s){if(a&1&&(l(0,"div",0)(1,"div",1)(2,"h3",2),c(3,"Campos Adicionales"),r()(),l(4,"div",3),V(5,zt,18,18,"div",4,Ve),r()()),a&2){let i=u();d(5),L(i.schema().fields)}}var et=(()=>{let s=class s{constructor(){this.schema=ke(null),this.externalUpdates=ke({}),this.selectedClassification=ke(null),this.fieldData=b({}),this.dataChange=Oe(),re(()=>{let e=this.schema();if(e&&e.fields){let t={};e.fields.forEach(n=>{if(n.type==="table"){let o=n.minRows||0;t[n.id]=Array.from({length:o},()=>this.createEmptyTableRow(n.columns||[]))}else n.type==="checkbox"?t[n.id]=!1:t[n.id]=""}),this.fieldData.set(t)}}),re(()=>{let e=this.externalUpdates();if(e&&Object.keys(e).length>0){console.log("[DynamicField] Received external updates:",e);let t=$e(()=>N({},this.fieldData())),n=!1;Object.keys(e).forEach(o=>{e[o]!==void 0&&e[o]!==null&&t[o]!==e[o]&&(t[o]=e[o],n=!0)}),n?(console.log("[DynamicField] Applying updates to fieldData"),this.fieldData.set(t)):console.log("[DynamicField] No changes detected, skipping update")}}),re(()=>{let e=this.fieldData(),t=this.schema();if(!t?.fields)return;t.fields.filter(o=>o.type==="table"&&o.linkedToField).forEach(o=>{let m=o.linkedToField,h=e[m];if(console.log(`\u{1F517} Sincronizaci\xF3n n\xFAmero\u2192tabla: "${m}"=${h} \u2192 tabla="${o.id}"`),h&&typeof h=="number"&&h>0){let C=this.getTableRows(o.id),T=Math.floor(h);console.log(`   Filas actuales: ${C.length}, Filas objetivo: ${T}`),C.length!==T&&(console.log(`   \u2705 Ajustando tabla de ${C.length} a ${T} filas`),this.adjustTableRows(o.id,T,o.columns||[]))}})}),re(()=>{this.dataChange.emit(this.fieldData())})}updateFieldValue(e,t){let n=N({},this.fieldData());typeof t=="string"&&t!==""&&!isNaN(Number(t))?n[e]=Number(t):n[e]=t,this.fieldData.set(n),this.checkLinkedTables(e,n)}checkLinkedTables(e,t){let n=this.schema();if(!n?.fields)return;n.fields.filter(m=>m.type==="table"&&m.linkedToField===e).forEach(m=>{let h=t[e];if(h&&typeof h=="number"&&h>0){let C=this.getTableRows(m.id),T=Math.floor(h);C.length!==T&&this.adjustTableRows(m.id,T,m.columns||[])}})}getTableRows(e){let t=this.fieldData()[e];return Array.isArray(t)?t:[]}addTableRow(e,t){let n=N({},this.fieldData());Array.isArray(n[e])||(n[e]=[]);let o=this.createEmptyTableRow(t);n[e].push(o);let m=n[e].length;console.log(`\u2795 Tabla\u2192N\xFAmero: Agregada fila, total=${m}`),this.fieldData.set(n),this.updateLinkedFieldFromTable(e,m)}removeTableRow(e,t){let n=N({},this.fieldData());if(Array.isArray(n[e])){let o=n[e].length,m=this.selectedClassification();if(m?.codigo==="PF"){if(o<=2){alert("Los Pagos Fraccionados requieren m\xEDnimo 2 cuotas. No se puede eliminar m\xE1s filas.");return}}else if(m?.codigo==="CF"&&o<=1){alert("Los Convenios requieren m\xEDnimo 1 cuota. No se puede eliminar esta fila.");return}n[e].splice(t,1);let h=n[e].length;console.log(`\u2796 Tabla\u2192N\xFAmero: Eliminada fila, total=${h}`),this.fieldData.set(n),this.updateLinkedFieldFromTable(e,h)}}updateLinkedFieldFromTable(e,t){let n=this.schema();if(console.log(`\u{1F50D} updateLinkedFieldFromTable: tableFieldId="${e}", rowCount=${t}`),!n?.fields){console.log("   \u274C No hay schema o fields");return}let o=n.fields.find(T=>T.id===e);if(console.log("   Campo tabla encontrado:",o),!o||o.type!=="table"){console.log("   \u274C Campo no encontrado o no es tabla");return}let m=o.linkedToField;if(console.log(`   linkedToField="${m}"`),!m){console.log("   \u274C No hay linkedToField definido");return}let h=N({},this.fieldData()),C=h[m];console.log(`   Valor actual del campo vinculado: ${C}`),C!==t?(h[m]=t,this.fieldData.set(h),console.log(`   \u2705 Campo "${m}" actualizado: ${C} \u2192 ${t}`)):console.log(`   \u26A0\uFE0F El valor ya es ${t}, no se actualiza`)}adjustTableRows(e,t,n){let o=N({},this.fieldData());Array.isArray(o[e])||(o[e]=[]);let m=o[e],h=m.length;if(t>h)for(let C=h;C<t;C++)m.push(this.createEmptyTableRow(n));else t<h&&m.splice(t);this.fieldData.set(o)}getTodayDate(){let e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}getEndOfMonthDate(){let e=new Date,t=e.getFullYear(),n=e.getMonth(),o=new Date(t,n+1,0).getDate(),m=String(n+1).padStart(2,"0"),h=String(o).padStart(2,"0");return`${t}-${m}-${h}`}getMinDate(e){let t=e.minDate;return t==="today"?this.getTodayDate():t}getMaxDate(e){return this.selectedClassification()?.codigo==="PF"?this.getEndOfMonthDate():e.maxDate}createEmptyTableRow(e){let t={};return e.forEach(n=>{n.type==="auto-number"?t[n.id]=null:n.type==="number"||n.type==="currency"?t[n.id]=n.defaultValue||0:(n.type,t[n.id]=n.defaultValue||"")}),t}getData(){return this.fieldData()}setData(e){this.fieldData.set(e)}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=ie({type:s,selectors:[["app-dynamic-field-renderer"]],inputs:{schema:[1,"schema"],externalUpdates:[1,"externalUpdates"],selectedClassification:[1,"selectedClassification"]},outputs:{dataChange:"dataChange"},decls:1,vars:1,consts:[[1,"bg-purple-50","dark:bg-purple-950/20","border","border-purple-200","dark:border-purple-900/50","rounded-lg","shadow-md","p-3"],[1,"flex","items-center","gap-2","text-purple-800","dark:text-purple-200","mb-3","pb-2","border-b","border-purple-200","dark:border-purple-800"],[1,"font-bold","text-xs","uppercase","tracking-wide"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[3,"md:col-span-2"],[1,"text-[11px]","font-bold","text-gray-800","dark:text-gray-100","mb-1","flex","items-center","gap-1"],[1,"text-red-500","text-xs"],[1,"text-[9px]","text-gray-500","dark:text-gray-400","mb-1","italic"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","min","max"],[1,"relative"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],[1,"flex","items-center","gap-2"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],[1,"rounded-lg","border","border-purple-200","dark:border-purple-800/50","overflow-hidden","shadow-sm"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min","max"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-gray-500","dark:text-gray-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["value",""],[3,"value"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","checkbox",1,"w-4","h-4","text-purple-600","bg-gray-100","dark:bg-gray-700","border-gray-300","dark:border-gray-600","rounded","focus:ring-purple-500","cursor-pointer",3,"ngModelChange","ngModel","required"],[1,"text-xs","text-gray-700","dark:text-gray-300"],["type","tel","pattern","[0-9]{9}","maxlength","9",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],[1,"overflow-x-auto"],[1,"w-full","border-collapse"],[1,"bg-gradient-to-r","from-purple-50","to-purple-100","dark:from-purple-950/50","dark:to-purple-900/30"],[1,"px-3","py-2","text-left","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700"],[1,"px-3","py-2","text-center","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700","w-16"],[1,"bg-white","dark:bg-slate-800"],[1,"border-b","border-purple-100","dark:border-purple-900/30","hover:bg-purple-50/50","dark:hover:bg-purple-950/20","transition-colors"],[1,"border-t","border-purple-300","dark:border-purple-700","p-2","from-purple-100/70","to-white","dark:from-purple-950/40","dark:to-purple-800/60"],[1,"text-red-500","ml-0.5"],[1,"px-3","py-2"],[1,"px-3","py-2","text-center"],[1,"flex","items-center","justify-center","w-7","h-7","rounded-full","bg-purple-100","dark:bg-purple-900/30","text-[11px]","font-bold","text-purple-700","dark:text-purple-300"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-purple-600","dark:text-purple-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-6","pr-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","button","title","Eliminar fila",1,"inline-flex","items-center","justify-center","w-7","h-7","rounded-full","hover:bg-red-50","dark:hover:bg-red-900/20","text-red-500","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","transition-colors",3,"click"],[1,"px-4","py-12","text-center"],[1,"flex","flex-col","items-center","gap-2"],[1,"w-12","h-12","rounded-full","bg-purple-100","dark:bg-purple-900/30","flex","items-center","justify-center"],[1,"text-[11px]","text-gray-500","dark:text-gray-400","font-medium"],[1,"text-[10px]","text-gray-400","dark:text-gray-500"],["type","button",1,"w-full","py-1.5","px-3","border","border-dashed","border-purple-400","dark:border-purple-600","rounded-lg","text-purple-900/50","dark:text-purple-300","hover:bg-purple-100","dark:hover:bg-purple-900/50","hover:border-purple-600","dark:hover:border-purple-400","transition-all","flex","items-center","justify-center","gap-2","text-[11px]","font-semibold",3,"click"]],template:function(t,n){t&1&&p(0,Qt,7,0,"div",0),t&2&&g(n.schema()&&n.schema().fields&&n.schema().fields.length>0?0:-1)},dependencies:[ne,me,Fe,Me,de,De,je,Te,ce,Ee,ze,Qe,Ye,Ge,He,We,ue],styles:["[_nghost-%COMP%]{display:contents}"]});let a=s;return a})();var pe=(()=>{let s=class s{constructor(e){this.http=e,this.baseUrl=`${M.tipificacionUrl}/payment-schedules`}createPaymentSchedule(e){return this.http.post(`${M.tipificacionUrl}/payments/schedules`,e)}getPaymentScheduleByManagementId(e){return this.http.get(`${this.baseUrl}/management/${e}`)}updateInstallmentStatus(e,t){return this.http.post(`${this.baseUrl}/installments/${e}/status`,t)}getInstallmentHistory(e){return this.http.get(`${this.baseUrl}/installments/${e}/history`)}getLatestStatusByManagement(e){return this.http.get(`${this.baseUrl}/management/${e}/latest-status`)}};s.\u0275fac=function(t){return new(t||s)(Q(G))},s.\u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();function Yt(a,s){if(a&1){let i=y();l(0,"div",17)(1,"div")(2,"label",13),c(3," Fecha de Pago * "),r(),l(4,"input",23),D("ngModelChange",function(t){x(i);let n=u(2);return k(n.paymentDate,t)||(n.paymentDate=t),_(t)}),r()(),l(5,"div")(6,"label",13),c(7," Monto Pagado * "),r(),l(8,"div",24)(9,"span",25),c(10,"S/"),r(),l(11,"input",26),D("ngModelChange",function(t){x(i);let n=u(2);return k(n.amountPaid,t)||(n.amountPaid=t),_(t)}),r()()()()}if(a&2){let i=u(2);d(4),w("ngModel",i.paymentDate),d(7),w("ngModel",i.amountPaid)}}function Jt(a,s){if(a&1&&(l(0,"div",19)(1,"span",27),c(2),r()()),a&2){let i=u(2);d(2),U(i.errorMessage())}}function Zt(a,s){a&1&&(l(0,"span"),c(1,"Guardando..."),r())}function Kt(a,s){a&1&&(l(0,"span"),c(1,"Guardar"),r())}function Xt(a,s){if(a&1){let i=y();l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"h2",4),c(6,"Actualizar Estado de Cuota"),r(),l(7,"p",5),c(8),r()()(),l(9,"button",6),S("click",function(){x(i);let t=u();return _(t.close())}),r()(),l(10,"div",7)(11,"div",8)(12,"div",9)(13,"div")(14,"span",10),c(15,"Monto:"),r(),l(16,"span",11),c(17),K(18,"number"),r()(),l(19,"div")(20,"span",10),c(21,"Fecha Vencimiento:"),r(),l(22,"span",11),c(23),r()(),l(24,"div")(25,"span",10),c(26,"Estado Actual:"),r(),l(27,"span",12),c(28),r()()()(),l(29,"div")(30,"label",13),c(31," Nuevo Estado "),r(),l(32,"div",14)(33,"button",15),S("click",function(){x(i);let t=u();return _(t.selectedStatus.set("COMPLETADO"))}),l(34,"span",16),c(35,"Completado"),r()(),l(36,"button",15),S("click",function(){x(i);let t=u();return _(t.selectedStatus.set("VENCIDO"))}),l(37,"span",16),c(38,"Vencido"),r()(),l(39,"button",15),S("click",function(){x(i);let t=u();return _(t.selectedStatus.set("CANCELADO"))}),l(40,"span",16),c(41,"Cancelado"),r()()()(),p(42,Yt,12,2,"div",17),l(43,"div")(44,"label",13),c(45," Observaciones "),r(),l(46,"textarea",18),D("ngModelChange",function(t){x(i);let n=u();return k(n.observations,t)||(n.observations=t),_(t)}),r()(),p(47,Jt,3,1,"div",19),r(),l(48,"div",20)(49,"button",21),S("click",function(){x(i);let t=u();return _(t.close())}),c(50," Cancelar "),r(),l(51,"button",22),S("click",function(){x(i);let t=u();return _(t.save())}),p(52,Zt,2,0,"span")(53,Kt,2,0,"span"),r()()()()}if(a&2){let i,e,t,n,o,m=u();d(8),f("Cuota #",(i=m.installment())==null?null:i.installmentNumber),d(9),f(" S/ ",X(18,17,(e=m.installment())==null?null:e.amount,"1.2-2")," "),d(6),f(" ",m.formatDate((t=m.installment())==null?null:t.dueDate)," "),d(4),A(m.getStatusBadgeClass(((n=m.installment())==null?null:n.status)||"PENDIENTE")),d(),f(" ",((o=m.installment())==null?null:o.statusDescription)||"Pendiente"," "),d(5),A(m.selectedStatus()==="COMPLETADO"?"bg-green-100 dark:bg-green-900/30 border-green-500 dark:border-green-600 text-green-900 dark:text-green-300":"bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-green-400"),d(3),A(m.selectedStatus()==="VENCIDO"?"bg-red-100 dark:bg-red-900/30 border-red-500 dark:border-red-600 text-red-900 dark:text-red-300":"bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-red-400"),d(3),A(m.selectedStatus()==="CANCELADO"?"bg-gray-100 dark:bg-gray-700/30 border-gray-500 dark:border-gray-600 text-gray-900 dark:text-gray-300":"bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-gray-400"),d(3),g(m.selectedStatus()==="COMPLETADO"?42:-1),d(4),w("ngModel",m.observations),d(),g(m.errorMessage()?47:-1),d(4),v("disabled",!m.canSave()||m.isSaving()),d(),g(m.isSaving()?52:53)}}var it=(()=>{let s=class s{constructor(e){this.paymentScheduleService=e,this.isOpen=b(!1),this.installment=b(null),this.managementId=b(0),this.selectedStatus=b(null),this.paymentDate="",this.amountPaid=null,this.observations="",this.isSaving=b(!1),this.errorMessage=b(null),this.canSave=B(()=>this.selectedStatus()?this.selectedStatus()==="COMPLETADO"?!!this.paymentDate&&this.amountPaid!==null&&this.amountPaid>0:!0:!1),re(()=>{this.isOpen()||this.resetForm()})}open(e,t){this.installment.set(e),this.managementId.set(t),this.isOpen.set(!0),this.amountPaid=e.amount;let n=new Date,o=n.getFullYear(),m=String(n.getMonth()+1).padStart(2,"0"),h=String(n.getDate()).padStart(2,"0"),C=String(n.getHours()).padStart(2,"0"),T=String(n.getMinutes()).padStart(2,"0");this.paymentDate=`${o}-${m}-${h}T${C}:${T}`}close(){this.isOpen.set(!1)}resetForm(){this.selectedStatus.set(null),this.paymentDate="",this.amountPaid=null,this.observations="",this.errorMessage.set(null),this.installment.set(null),this.managementId.set(0)}save(){let e=this.installment();if(!e||!this.canSave())return;this.isSaving.set(!0),this.errorMessage.set(null);let t={status:this.selectedStatus(),observations:this.observations||void 0,registeredBy:"USUARIO"};this.selectedStatus()==="COMPLETADO"&&(t.paymentDate=this.paymentDate,t.amountPaid=this.amountPaid),this.paymentScheduleService.updateInstallmentStatus(e.id,t).subscribe({next:()=>{console.log("\u2705 Estado de cuota actualizado exitosamente"),this.isSaving.set(!1),this.close(),this.onSave&&this.onSave(!0)},error:n=>{console.error("\u274C Error actualizando estado de cuota:",n),this.errorMessage.set("Error al actualizar el estado. Intente nuevamente."),this.isSaving.set(!1),this.onSave&&this.onSave(!1)}})}formatDate(e){return e?new Date(e).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}getStatusBadgeClass(e){switch(e.toUpperCase()){case"COMPLETED":case"COMPLETADO":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border border-green-300 dark:border-green-700";case"PENDING":case"PENDIENTE":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 border border-yellow-300 dark:border-yellow-700";case"OVERDUE":case"VENCIDO":return"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 border border-red-300 dark:border-red-700";case"CANCELLED":case"CANCELADO":return"bg-gray-100 dark:bg-gray-700/30 text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600";default:return"bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-300"}}};s.\u0275fac=function(t){return new(t||s)(O(pe))},s.\u0275cmp=ie({type:s,selectors:[["app-installment-status-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","z-50","flex","items-center","justify-center","p-4","bg-black/50","backdrop-blur-sm","animate-fadeIn"],[1,"bg-white","dark:bg-slate-900","rounded-xl","shadow-2xl","max-w-2xl","w-full","max-h-[90vh]","overflow-hidden","flex","flex-col","animate-slideInUp","border","border-slate-200","dark:border-slate-700"],[1,"bg-gradient-to-r","from-purple-600","to-purple-700","dark:from-purple-700","dark:to-purple-800","text-white","px-6","py-4","flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-lg","font-bold"],[1,"text-sm","opacity-90"],["type","button",1,"p-2","hover:bg-white/20","rounded-lg","transition-colors",3,"click"],[1,"flex-1","overflow-y-auto","p-6","space-y-6"],[1,"bg-purple-50","dark:bg-purple-950/30","border","border-purple-200","dark:border-purple-800","rounded-lg","p-4"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"text-slate-600","dark:text-slate-400"],[1,"font-bold","text-purple-900","dark:text-purple-200","ml-2"],[1,"ml-2","px-2","py-0.5","rounded","text-xs","font-bold"],[1,"block","text-sm","font-semibold","text-slate-700","dark:text-slate-300","mb-2"],[1,"grid","grid-cols-3","gap-3"],["type","button",1,"border-2","rounded-lg","p-4","flex","flex-col","items-center","gap-2","transition-all",3,"click"],[1,"text-sm","font-bold"],[1,"space-y-4","p-4","bg-green-50","dark:bg-green-950/20","border","border-green-200","dark:border-green-800","rounded-lg"],["rows","3","placeholder","Ingrese notas o comentarios adicionales...",1,"w-full","px-3","py-2","text-sm","border","border-slate-300","dark:border-slate-600","rounded-lg","bg-white","dark:bg-slate-800","text-slate-900","dark:text-slate-100","focus:ring-2","focus:ring-purple-500","dark:focus:ring-purple-600","focus:border-transparent","placeholder:text-slate-400","dark:placeholder:text-slate-500",3,"ngModelChange","ngModel"],[1,"bg-red-50","dark:bg-red-950/30","border","border-red-200","dark:border-red-800","text-red-900","dark:text-red-300","px-4","py-3","rounded-lg","flex","items-start","gap-2"],[1,"px-6","py-4","bg-slate-50","dark:bg-slate-800/50","border-t","border-slate-200","dark:border-slate-700","flex","justify-end","gap-3"],["type","button",1,"px-4","py-2","text-sm","font-semibold","text-slate-700","dark:text-slate-300","hover:bg-slate-200","dark:hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],["type","button",1,"px-4","py-2","text-sm","font-semibold","text-white","bg-gradient-to-r","from-purple-600","to-purple-700","hover:from-purple-700","hover:to-purple-800","rounded-lg","transition-all","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:from-purple-600","flex","items-center","gap-2",3,"click","disabled"],["type","datetime-local","required","",1,"w-full","px-3","py-2","text-sm","border","border-slate-300","dark:border-slate-600","rounded-lg","bg-white","dark:bg-slate-800","text-slate-900","dark:text-slate-100","focus:ring-2","focus:ring-green-500","dark:focus:ring-green-600","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"relative"],[1,"absolute","left-3","top-2","text-slate-500","dark:text-slate-400"],["type","number","step","0.01","required","",1,"w-full","pl-10","pr-3","py-2","text-sm","border","border-slate-300","dark:border-slate-600","rounded-lg","bg-white","dark:bg-slate-800","text-slate-900","dark:text-slate-100","focus:ring-2","focus:ring-green-500","dark:focus:ring-green-600","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"text-sm"]],template:function(t,n){t&1&&p(0,Xt,54,20,"div",0),t&2&&g(n.isOpen()?0:-1)},dependencies:[ne,me,de,De,ce,Ee,ue,se],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.animate-fadeIn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.animate-slideInUp[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInUp .3s ease-out}"]});let a=s;return a})();var ei=["statusDialog"],nt=(a,s)=>s.id;function ti(a,s){a&1&&(l(0,"div",9)(1,"div",10)(2,"span"),c(3,"Cargando estados..."),r()()())}function ii(a,s){if(a&1&&(l(0,"div",31),c(1),r()),a&2){let i=u().$implicit,e=u(2);d(),f(" ",e.formatDateTime(i.latestStatus.actualPaymentDate)," ")}}function ni(a,s){a&1&&(l(0,"div",36),c(1,"-"),r())}function ai(a,s){a&1&&(l(0,"div",43)(1,"span"),c(2,"Cargando historial..."),r()())}function oi(a,s){if(a&1&&(l(0,"span",48),c(1),K(2,"number"),r()),a&2){let i=u().$implicit;d(),f(" S/ ",X(2,1,i.amountPaid,"1.2-2")," ")}}function ri(a,s){if(a&1&&(l(0,"div",49),c(1),r()),a&2){let i=u().$implicit;d(),f(" ",i.observations," ")}}function li(a,s){if(a&1&&(l(0,"div",44)(1,"div",45),c(2),r(),l(3,"div",46)(4,"span",47),c(5),r(),p(6,oi,3,4,"span",48),p(7,ri,2,1,"div",49),r(),l(8,"div",50),c(9),r()()),a&2){let i=s.$implicit,e=u(5);d(2),f(" ",e.formatDateTime(i.changeDate)," "),d(2),A(e.getStatusBadgeClass(i.status)),d(),f(" ",i.statusDescription," "),d(),g(i.amountPaid?6:-1),d(),g(i.observations?7:-1),d(2),f(" ",i.registeredBy," ")}}function si(a,s){if(a&1&&(l(0,"div",41),V(1,li,10,7,"div",44,nt),r()),a&2){let i=u(4);d(),L(i.installmentHistory())}}function di(a,s){if(a&1&&(l(0,"tr")(1,"td",40)(2,"div",41)(3,"div",42)(4,"span"),c(5,"Historial de Estados"),r()(),p(6,ai,3,0,"div",43)(7,si,3,0,"div",41),r()()()),a&2){let i=u(3);d(6),g(i.isLoadingHistory()?6:i.installmentHistory()&&i.installmentHistory().length>0?7:-1)}}function ci(a,s){if(a&1){let i=y();l(0,"tr",26)(1,"td",27)(2,"div",28)(3,"div",29)(4,"span",30),c(5),r()()()(),l(6,"td",27)(7,"div",31),c(8),r()(),l(9,"td",32)(10,"div",33),c(11),K(12,"number"),r()(),l(13,"td",27)(14,"div",34)(15,"span",35),c(16),r()()(),l(17,"td",27),p(18,ii,2,1,"div",31)(19,ni,2,0,"div",36),r(),l(20,"td",27)(21,"div",37)(22,"button",38),S("click",function(){let t=x(i).$implicit,n=u(2);return _(n.openStatusDialog(t))}),r(),l(23,"button",39),S("click",function(){let t=x(i).$implicit,n=u(2);return _(n.toggleHistory(t.id))}),r()()()(),p(24,di,8,1,"tr")}if(a&2){let i=s.$implicit,e=u(2);d(5),f(" ",i.installmentNumber," "),d(3),f(" ",e.formatDate(i.dueDate)," "),d(3),f(" S/ ",X(12,10,i.amount,"1.2-2")," "),d(4),A(e.getStatusBadgeClass((i.latestStatus==null?null:i.latestStatus.status)||"PENDIENTE")),d(),f(" ",(i.latestStatus==null?null:i.latestStatus.statusDescription)||"Pendiente"," "),d(2),g(i.latestStatus!=null&&i.latestStatus.actualPaymentDate?18:19),d(5),A(e.expandedHistory()===i.id?"bg-slate-200 dark:bg-slate-700":"hover:bg-slate-100 dark:hover:bg-slate-800"),d(),g(e.expandedHistory()===i.id&&e.installmentHistory()?24:-1)}}function ui(a,s){if(a&1&&(l(0,"div",11)(1,"table",12)(2,"thead",13)(3,"tr")(4,"th",14),c(5,"#"),r(),l(6,"th",14),c(7,"Fecha Vencimiento"),r(),l(8,"th",15),c(9,"Monto"),r(),l(10,"th",16),c(11,"Estado"),r(),l(12,"th",14),c(13,"Fecha Pago"),r(),l(14,"th",16),c(15,"Acciones"),r()()(),l(16,"tbody",17),V(17,ci,25,13,null,null,nt),r()()(),l(19,"div",18)(20,"div",19)(21,"div",20)(22,"div",21),c(23,"Completadas"),r(),l(24,"div",22),c(25),r()(),l(26,"div",20)(27,"div",21),c(28,"Pendientes"),r(),l(29,"div",23),c(30),r()(),l(31,"div",20)(32,"div",21),c(33,"Vencidas"),r(),l(34,"div",24),c(35),r()(),l(36,"div",20)(37,"div",21),c(38,"Canceladas"),r(),l(39,"div",25),c(40),r()()()()),a&2){let i=u();d(17),L(i.installmentsWithStatus()),d(8),f(" ",i.summaryStats().completed," "),d(5),f(" ",i.summaryStats().pending," "),d(5),f(" ",i.summaryStats().overdue," "),d(5),f(" ",i.summaryStats().cancelled," ")}}var at=(()=>{let s=class s{constructor(e){this.paymentScheduleService=e,this.managementId=0,this.schedule=b(null),this.latestStatuses=b([]),this.isLoading=b(!1),this.expandedHistory=b(null),this.installmentHistory=b(null),this.isLoadingHistory=b(!1),this.installmentsWithStatus=B(()=>{let t=this.schedule(),n=this.latestStatuses();return t?t.installments.map(o=>{let m=n.find(h=>h.installmentId===o.id);return Ce(N({},o),{latestStatus:m})}):[]}),this.summaryStats=B(()=>{let t=this.installmentsWithStatus();return{completed:t.filter(n=>["COMPLETED","COMPLETADO"].includes(n.latestStatus?.status||"")).length,pending:t.filter(n=>["PENDING","PENDIENTE"].includes(n.latestStatus?.status||"")).length,overdue:t.filter(n=>["OVERDUE","VENCIDO"].includes(n.latestStatus?.status||"")).length,cancelled:t.filter(n=>["CANCELLED","CANCELADO"].includes(n.latestStatus?.status||"")).length}})}ngOnChanges(e){e.managementId&&this.managementId&&this.loadSchedule()}loadSchedule(){this.isLoading.set(!0),this.paymentScheduleService.getPaymentScheduleByManagementId(this.managementId).subscribe({next:e=>{console.log("\u{1F4CA} Cronograma cargado:",e),this.schedule.set(e),this.loadLatestStatuses()},error:e=>{console.error("\u274C Error cargando cronograma:",e),this.isLoading.set(!1)}})}loadLatestStatuses(){this.paymentScheduleService.getLatestStatusByManagement(this.managementId).subscribe({next:e=>{console.log("\u{1F4CB} Estados m\xE1s recientes cargados:",e),this.latestStatuses.set(e),this.isLoading.set(!1)},error:e=>{console.error("\u274C Error cargando estados:",e),this.isLoading.set(!1)}})}openStatusDialog(e){this.statusDialog.open(e,this.managementId),this.statusDialog.onSave=t=>{t&&(this.loadLatestStatuses(),this.expandedHistory()===e.id&&this.loadInstallmentHistory(e.id))}}toggleHistory(e){this.expandedHistory()===e?(this.expandedHistory.set(null),this.installmentHistory.set(null)):(this.expandedHistory.set(e),this.loadInstallmentHistory(e))}loadInstallmentHistory(e){this.isLoadingHistory.set(!0),this.paymentScheduleService.getInstallmentHistory(e).subscribe({next:t=>{console.log("\u{1F4DC} Historial de cuota cargado:",t),this.installmentHistory.set(t),this.isLoadingHistory.set(!1)},error:t=>{console.error("\u274C Error cargando historial:",t),this.isLoadingHistory.set(!1)}})}formatDate(e){return new Date(e).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}formatDateTime(e){return new Date(e).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}getStatusBadgeClass(e){switch(e.toUpperCase()){case"COMPLETED":case"COMPLETADO":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border border-green-300 dark:border-green-700";case"PENDING":case"PENDIENTE":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 border border-yellow-300 dark:border-yellow-700";case"OVERDUE":case"VENCIDO":return"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 border border-red-300 dark:border-red-700";case"CANCELLED":case"CANCELADO":return"bg-gray-100 dark:bg-gray-700/30 text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600";default:return"bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-300"}}};s.\u0275fac=function(t){return new(t||s)(O(pe))},s.\u0275cmp=ie({type:s,selectors:[["app-payment-schedule-view"]],viewQuery:function(t,n){if(t&1&&ve(ei,5),t&2){let o;Se(o=we())&&(n.statusDialog=o.first)}},inputs:{managementId:"managementId"},features:[qe],decls:19,vars:7,consts:[["statusDialog",""],[1,"bg-white","dark:bg-slate-900","rounded-xl","shadow-lg","border","border-slate-200","dark:border-slate-700","overflow-hidden"],[1,"bg-gradient-to-r","from-purple-600","to-purple-700","dark:from-purple-700","dark:to-purple-800","text-white","px-6","py-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-lg","font-bold"],[1,"text-sm","opacity-90"],[1,"text-right"],[1,"text-2xl","font-bold"],[1,"p-8","flex","items-center","justify-center"],[1,"flex","items-center","gap-3","text-slate-600","dark:text-slate-400"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-slate-50","dark:bg-slate-800/50","border-b","border-slate-200","dark:border-slate-700"],[1,"px-4","py-3","text-left","text-xs","font-bold","text-slate-700","dark:text-slate-300","uppercase","tracking-wider"],[1,"px-4","py-3","text-right","text-xs","font-bold","text-slate-700","dark:text-slate-300","uppercase","tracking-wider"],[1,"px-4","py-3","text-center","text-xs","font-bold","text-slate-700","dark:text-slate-300","uppercase","tracking-wider"],[1,"divide-y","divide-slate-200","dark:divide-slate-700"],[1,"px-6","py-4","bg-slate-50","dark:bg-slate-800/50","border-t","border-slate-200","dark:border-slate-700"],[1,"grid","grid-cols-4","gap-4","text-sm"],[1,"text-center"],[1,"text-slate-600","dark:text-slate-400","mb-1"],[1,"text-2xl","font-bold","text-green-600","dark:text-green-400"],[1,"text-2xl","font-bold","text-yellow-600","dark:text-yellow-400"],[1,"text-2xl","font-bold","text-red-600","dark:text-red-400"],[1,"text-2xl","font-bold","text-gray-600","dark:text-gray-400"],[1,"hover:bg-slate-50","dark:hover:bg-slate-800/50","transition-colors"],[1,"px-4","py-3"],[1,"flex","items-center","gap-2"],[1,"w-8","h-8","rounded-full","bg-purple-100","dark:bg-purple-900/30","flex","items-center","justify-center"],[1,"text-xs","font-bold","text-purple-700","dark:text-purple-300"],[1,"text-sm","text-slate-900","dark:text-slate-100"],[1,"px-4","py-3","text-right"],[1,"text-sm","font-bold","text-slate-900","dark:text-slate-100"],[1,"flex","justify-center"],[1,"px-2","py-1","rounded","text-xs","font-bold"],[1,"text-sm","text-slate-400","dark:text-slate-500"],[1,"flex","items-center","justify-center","gap-2"],["type","button","title","Actualizar estado",1,"p-1.5","hover:bg-purple-100","dark:hover:bg-purple-900/30","rounded","transition-colors",3,"click"],["type","button","title","Ver historial",1,"p-1.5","rounded","transition-colors",3,"click"],["colspan","6",1,"px-4","py-3","bg-slate-50","dark:bg-slate-800/50"],[1,"space-y-2"],[1,"flex","items-center","gap-2","text-sm","font-bold","text-slate-700","dark:text-slate-300","mb-2"],[1,"flex","items-center","gap-2","text-sm","text-slate-600","dark:text-slate-400","py-2"],[1,"flex","items-start","gap-3","text-xs","p-2","bg-white","dark:bg-slate-900","rounded","border","border-slate-200","dark:border-slate-700"],[1,"flex-shrink-0","w-24","text-slate-600","dark:text-slate-400"],[1,"flex-1"],[1,"px-2","py-0.5","rounded","font-bold"],[1,"ml-2","text-slate-700","dark:text-slate-300"],[1,"mt-1","text-slate-600","dark:text-slate-400"],[1,"flex-shrink-0","text-slate-500","dark:text-slate-500"]],template:function(t,n){if(t&1&&(l(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"h3",5),c(6,"Cronograma de Pagos"),r(),l(7,"p",6),c(8),r()()(),l(9,"div",7)(10,"div",6),c(11,"Monto Total"),r(),l(12,"div",8),c(13),K(14,"number"),r()()()(),p(15,ti,4,0,"div",9),p(16,ui,41,4),r(),E(17,"app-installment-status-dialog",null,0)),t&2){let o;d(8),f("",n.installmentsWithStatus().length," cuotas programadas"),d(5),f("S/ ",X(14,4,(o=n.schedule())==null?null:o.totalAmount,"1.2-2")),d(2),g(n.isLoading()?15:-1),d(),g(!n.isLoading()&&n.installmentsWithStatus().length>0?16:-1)}},dependencies:[ne,it,se],encapsulation:2});let a=s;return a})();var Ie=(()=>{let s=class s{constructor(e){this.http=e,this.baseUrl=`${M.tipificacionUrl}/system-config`,this.classificationsUrl=`${M.tipificacionUrl}/typifications`,this.contactClassifications=b([]),this.managementClassifications=b([]),this.campaigns=b([]),this.tenantClassifications=b([]),this.isLoading=b(!1),this.isLoaded=b(!1)}setTenantAndPortfolio(e,t){this.tenantClassifications.set([]),this.contactClassifications.set([]),this.managementClassifications.set([]),this.currentTenantId=e,this.currentPortfolioId=t,this.loadTenantClassifications(),this.loadTypificationsFromCatalog()}loadAllData(){this.isLoading.set(!0),Promise.all([this.loadTenantClassifications(),this.loadTypificationsFromCatalog()]).finally(()=>{this.isLoading.set(!1),this.isLoaded.set(!0)})}loadTypificationsFromCatalog(){return new Promise(e=>{this.http.get(`${M.tipificacionUrl}/typifications`).pipe(he(t=>{console.log("Tipificaciones cargadas desde cat\xE1logo:",t);let o=t.filter(m=>m.classificationType==="CUSTOM").map(m=>({id:m.id,code:m.code,label:m.name,requiresPayment:!1,requiresSchedule:!1,requiresFollowUp:!1,parentId:m.parentTypificationId,hierarchyLevel:m.hierarchyLevel,suggestsFullAmount:null,allowsInstallmentSelection:null,requiresManualAmount:null}));this.managementClassifications.set(o),console.log("Clasificaciones de gesti\xF3n cargadas:",o.length),console.log("Nivel 1 (sin parentId):",o.filter(m=>!m.parentId).map(m=>`${m.code} (${m.label})`)),console.log("Nivel 2 (con parentId):",o.filter(m=>m.parentId&&m.hierarchyLevel===2).map(m=>`${m.code} -> parent:${m.parentId}`)),console.log("Nivel 3 (con parentId):",o.filter(m=>m.parentId&&m.hierarchyLevel===3).map(m=>`${m.code} -> parent:${m.parentId}`))}),Z(t=>(console.error("Error cargando tipificaciones del cat\xE1logo:",t),J([])))).subscribe(()=>e())})}loadTenantClassifications(){return new Promise(e=>{if(!this.currentTenantId){e();return}console.log("[TEMPORAL] loadTenantClassifications - endpoint /tenants/.../typifications no existe");let t=[];this.tenantClassifications.set(t),this.contactClassifications.set([]),this.managementClassifications.set([]),e()})}loadContactClassifications(){return new Promise(e=>{this.http.get(`${this.baseUrl}/contact-typifications`).pipe(he(t=>{this.contactClassifications.set(t)}),Z(t=>(console.error("Error cargando tipificaciones de contacto:",t),J([])))).subscribe(()=>e())})}loadManagementClassifications(){return new Promise(e=>{this.http.get(`${this.baseUrl}/management-typifications`).pipe(he(t=>{this.managementClassifications.set(t)}),Z(t=>(console.error("Error cargando tipificaciones de gesti\xF3n:",t),J([])))).subscribe(()=>e())})}loadActiveCampaigns(){return new Promise(e=>{this.http.get(`${this.baseUrl}/campaigns/active`).pipe(he(t=>{this.campaigns.set(t)}),Z(t=>(console.error("Error cargando campa\xF1as:",t),J([])))).subscribe(()=>e())})}refresh(){this.loadAllData()}getContactClassificationsForUI(){return this.contactClassifications().map(e=>({id:e.code,codigo:e.code,label:e.label,isSuccessful:e.isSuccessful}))}getManagementClassificationsForUI(){return this.managementClassifications().map(e=>({id:String(e.id),codigo:e.code,label:e.label,requiere_pago:e.requiresPayment,requiere_cronograma:e.requiresSchedule,requiere_seguimiento:e.requiresFollowUp,parentId:e.parentId,hierarchyLevel:e.hierarchyLevel,suggestsFullAmount:e.suggestsFullAmount,allowsInstallmentSelection:e.allowsInstallmentSelection,requiresManualAmount:e.requiresManualAmount}))}getActiveCampaign(){let e=this.campaigns();return e.length>0?{id:e[0].campaignId,nombre:e[0].name,tipo:e[0].campaignType}:null}getClassificationFields(e){if(!this.currentTenantId)throw new Error("No hay tenant configurado");let t=`${M.tipificacionUrl}/tenants/${this.currentTenantId}/typifications/${e}/fields`;return this.currentPortfolioId&&(t+=`?portfolioId=${this.currentPortfolioId}`),this.http.get(t).pipe(Z(n=>(console.error("Error cargando campos din\xE1micos:",n),J({typificationId:e,isLeaf:!1,fields:[]}))))}getAllFieldTypes(){let e=`${M.tipificacionUrl}/field-types`;return this.http.get(e).pipe(Z(t=>(console.error("Error cargando tipos de campo:",t),J([]))))}getFieldTypesForMainFields(){let e=`${M.tipificacionUrl}/field-types/main-fields`;return this.http.get(e).pipe(Z(t=>(console.error("Error cargando tipos para campos principales:",t),J([]))))}getFieldTypesForTableColumns(){let e=`${M.tipificacionUrl}/field-types/table-columns`;return this.http.get(e).pipe(Z(t=>(console.error("Error cargando tipos para columnas de tabla:",t),J([]))))}};s.\u0275fac=function(t){return new(t||s)(Q(G))},s.\u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();var rt=(()=>{let s=class s{constructor(e){this.apiService=e,this.systemConfig={campana:{id:"CAMP-001",nombre:"Cartera Vencida Q3 2025",tipo:"Cobranza Temprana"},tipificaciones:{contacto:[{id:"CPC",codigo:"CPC",label:"Contacto con Cliente"},{id:"CTT",codigo:"CTT",label:"Contacto con Tercero"},{id:"NCL",codigo:"NCL",label:"No Contesta"},{id:"BZN",codigo:"BZN",label:"Buz\xF3n de Voz"},{id:"OCP",codigo:"OCP",label:"Ocupado"},{id:"FTN",codigo:"FTN",label:"Fuera de Tono"},{id:"NEQ",codigo:"NEQ",label:"N\xFAmero Equivocado"},{id:"TEL",codigo:"TEL",label:"Tel\xE9fono Inv\xE1lido"},{id:"CLG",codigo:"CLG",label:"Cliente Colg\xF3"},{id:"RCH",codigo:"RCH",label:"Rechaz\xF3 Llamada"}],gestion:[{id:"ACP",codigo:"ACP",label:"Acepta Compromiso de Pago",requiere_pago:!0,requiere_fecha:!0},{id:"PGR",codigo:"PGR",label:"Pago Realizado - Completo",requiere_pago:!0},{id:"PGP",codigo:"PGP",label:"Pago Parcial Realizado",requiere_pago:!0},{id:"PGT",codigo:"PGT",label:"Pago Total de Deuda",requiere_pago:!0},{id:"PPR",codigo:"PPR",label:"Pago Programado",requiere_pago:!0,requiere_fecha:!0},{id:"SRP",codigo:"SRP",label:"Solicita Refinanciamiento",requiere_seguimiento:!0},{id:"SQA",codigo:"SQA",label:"Solicita Quita o Descuento",requiere_seguimiento:!0},{id:"SCN",codigo:"SCN",label:"Solicita Congelamiento",requiere_seguimiento:!0},{id:"SPL",codigo:"SPL",label:"Solicita Ampliaci\xF3n de Plazo",requiere_seguimiento:!0},{id:"DPD",codigo:"DPD",label:"Disputa de Deuda",requiere_seguimiento:!0},{id:"NRD",codigo:"NRD",label:"No Reconoce Deuda",requiere_seguimiento:!0},{id:"DIF",codigo:"DIF",label:"Dificultad Financiera Temporal",requiere_seguimiento:!0},{id:"DSE",codigo:"DSE",label:"Desempleo",requiere_seguimiento:!0},{id:"ENF",codigo:"ENF",label:"Enfermedad/Incapacidad",requiere_seguimiento:!0},{id:"FLC",codigo:"FLC",label:"Fallecimiento del Titular",requiere_seguimiento:!0},{id:"RCL",codigo:"RCL",label:"Reclamo Registrado",requiere_seguimiento:!0},{id:"FRD",codigo:"FRD",label:"Reporte de Fraude",requiere_seguimiento:!0},{id:"NCB",codigo:"NCB",label:"Sin Capacidad de Pago",requiere_seguimiento:!0},{id:"VJE",codigo:"VJE",label:"Viaje/Fuera del Pa\xEDs",requiere_fecha:!0},{id:"SLL",codigo:"SLL",label:"Solicita Llamar Despu\xE9s",requiere_fecha:!0},{id:"NIN",codigo:"NIN",label:"No est\xE1 Interesado"},{id:"AGR",codigo:"AGR",label:"Cliente Agresivo/Hostil"},{id:"NBL",codigo:"NBL",label:"No Desea Ser Contactado"},{id:"LGL",codigo:"LGL",label:"Amenaza Legal"},{id:"CNV",codigo:"CNV",label:"Acepta Convenio de Pago",requiere_cronograma:!0,requiere_fecha:!0},{id:"CRO",codigo:"CRO",label:"Solicita Cronograma de Pagos",requiere_cronograma:!0,requiere_cuotas:!0},{id:"CPP",codigo:"CPP",label:"Convenio con Pago Parcial Inicial",requiere_cronograma:!0,requiere_monto_inicial:!0},{id:"CTT",codigo:"CTT",label:"Convenio a Plazo Total",requiere_cronograma:!0,requiere_periodicidad:!0},{id:"CCG",codigo:"CCG",label:"Convenio con Congelamiento",requiere_cronograma:!0,requiere_fecha:!0},{id:"CRF",codigo:"CRF",label:"Convenio con Refinanciamiento",requiere_cronograma:!0,requiere_seguimiento:!0},{id:"CQT",codigo:"CQT",label:"Convenio con Quita/Descuento",requiere_cronograma:!0,requiere_pago:!0},{id:"CAP",codigo:"CAP",label:"Convenio Aprobado por Supervisor",requiere_cronograma:!0,requiere_autorizacion:!0},{id:"CRC",codigo:"CRC",label:"Cliente Rechaza Convenio Propuesto",requiere_seguimiento:!0},{id:"CEV",codigo:"CEV",label:"Convenio en Evaluaci\xF3n",requiere_seguimiento:!0,requiere_fecha:!0}],motivo_no_pago:[{id:"FRE",label:"Falta de Recursos Econ\xF3micos"},{id:"DSP",label:"Desempleo Reciente"},{id:"RDS",label:"Reducci\xF3n de Salario"},{id:"EMR",label:"Emergencia M\xE9dica"},{id:"GSF",label:"Gastos Familiares Imprevistos"},{id:"OGS",label:"Otros Gastos Prioritarios"},{id:"NGC",label:"Negocio/Comercio en Crisis"},{id:"DCP",label:"Desconoce el Cargo/Producto"},{id:"IFC",label:"Inconformidad con Servicio"},{id:"FCC",label:"Fraude o Cargo no Reconocido"},{id:"OLV",label:"Olvido de Fecha de Pago"},{id:"PRG",label:"Problemas con M\xE9todo de Pago"},{id:"BNK",label:"Problemas Bancarios"},{id:"OTR",label:"Otro Motivo"}]},metodos_pago:[{id:"TDC",codigo:"TDC",label:"Tarjeta de Cr\xE9dito",icono:"\u{1F4B3}",requiere_ultimos4:!0},{id:"TDD",codigo:"TDD",label:"Tarjeta de D\xE9bito",icono:"\u{1F4B3}",requiere_ultimos4:!0},{id:"TRF",codigo:"TRF",label:"Transferencia Bancaria",icono:"\u{1F3E6}",requiere_banco:!0},{id:"DEP",codigo:"DEP",label:"Dep\xF3sito en Cuenta",icono:"\u{1F3E6}",requiere_banco:!0},{id:"EFE",codigo:"EFE",label:"Efectivo en Agencia",icono:"\u{1F4B5}",requiere_agencia:!0},{id:"CAU",codigo:"CAU",label:"Cargo Autom\xE1tico",icono:"\u{1F504}",requiere_autorizacion:!0},{id:"YPE",codigo:"YPE",label:"Yape",icono:"\u{1F4F1}",requiere_telefono:!0},{id:"PLN",codigo:"PLN",label:"Plin",icono:"\u{1F4F1}",requiere_telefono:!0},{id:"TNK",codigo:"TNK",label:"Tunki",icono:"\u{1F4F1}",requiere_telefono:!0},{id:"PGW",codigo:"PGW",label:"Pasarela Web/Link de Pago",icono:"\u{1F310}",requiere_email:!0}],bancos:["BCP - Banco de Cr\xE9dito del Per\xFA","BBVA","Interbank","Scotiabank","BanBif","Banco Pichincha","Banco Falabella","Banco Ripley","Banco Azteca","Otros"],cronograma_config:{periodicidades:[{id:"SEM",label:"Semanal",dias:7},{id:"QUI",label:"Quincenal",dias:15},{id:"MEN",label:"Mensual",dias:30},{id:"BIM",label:"Bimestral",dias:60},{id:"TRI",label:"Trimestral",dias:90}],tipos_cronograma:[{id:"FIJ",label:"Cuotas Fijas",descripcion:"Mismo monto cada cuota"},{id:"DEC",label:"Decreciente",descripcion:"Cuotas van disminuyendo"},{id:"ESC",label:"Escalonado",descripcion:"Cuotas aumentan gradualmente"},{id:"PER",label:"Personalizado",descripcion:"Montos espec\xEDficos por cuota"}],campos_requeridos:{requiere_cronograma:["numero_cuotas","periodicidad","fecha_primera_cuota"],requiere_cuotas:["numero_cuotas","monto_cuota"],requiere_monto_inicial:["monto_inicial","fecha_pago_inicial"],requiere_periodicidad:["periodicidad","dia_pago"],requiere_autorizacion:["supervisor_id","codigo_autorizacion"]},validaciones:{numero_cuotas_max:48,numero_cuotas_min:2,monto_minimo_cuota:50,porcentaje_quita_max:30,dias_gracia_max:90}}}}getSystemConfig(){return this.systemConfig}getCampaign(){return this.apiService.getActiveCampaign()||this.systemConfig.campana}getContactClassifications(){let e=this.apiService.tenantClassifications();if(e.length>0){let n=e.filter(o=>o.typification.classificationType==="CONTACT_RESULT"&&o.isEnabled).map(o=>({id:o.typification.id,codigo:o.typification.code,label:o.customName||o.typification.name}));if(n.length>0)return n}let t=this.apiService.getContactClassificationsForUI();return t.length>0?t:this.systemConfig.tipificaciones.contacto}getManagementClassifications(){let e=this.apiService.tenantClassifications();if(e.length>0){let n=e.filter(o=>o.isEnabled).map(o=>{let m=o.typification.metadataSchema?JSON.parse(o.typification.metadataSchema):{};return{id:String(o.typification.id),codigo:o.typification.code,label:o.customName||o.typification.name,requiere_pago:m.requiresPayment||!1,requiere_cronograma:m.requiresSchedule||!1,requiere_seguimiento:m.requiresFollowUp||!1,parentId:o.typification.parentTypificationId,hierarchyLevel:o.typification.hierarchyLevel,suggestsFullAmount:o.typification.suggestsFullAmount,allowsInstallmentSelection:o.typification.allowsInstallmentSelection,requiresManualAmount:o.typification.requiresManualAmount}});if(n.length>0)return n}let t=this.apiService.getManagementClassificationsForUI();return t.length>0?t:this.systemConfig.tipificaciones.gestion}getPaymentNoReasons(){return this.systemConfig.tipificaciones.motivo_no_pago}getPaymentMethods(){return this.systemConfig.metodos_pago}getBanks(){return this.systemConfig.bancos}getScheduleConfig(){return this.systemConfig.cronograma_config}getManagementClassificationById(e){return this.getManagementClassifications().find(o=>o.id==e)}};s.\u0275fac=function(t){return new(t||s)(Q(Ie))},s.\u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();var lt=(()=>{let s=class s{constructor(e){this.http=e,this.baseUrl=`${M.tipificacionUrl}/managements`,this.scheduleUrl=`${M.tipificacionUrl}/payment-schedules`}createManagement(e){return this.http.post(this.baseUrl,e)}getManagementById(e){return this.http.get(`${this.baseUrl}/${e}`)}getManagementsByCustomer(e){return this.http.get(`${this.baseUrl}/customer/${e}`)}getManagementsByAdvisor(e){return this.http.get(`${this.baseUrl}/advisor/${e}`)}getActiveSchedulesByCustomer(e){return console.log("[SCHEDULE] Fetching active schedules for customer:",e),this.http.get(`${this.scheduleUrl}/customer/${e}/active`)}startCall(e,t){return this.http.post(`${this.baseUrl}/${e}/call/start`,t)}endCall(e,t){return this.http.post(`${this.baseUrl}/${e}/call/end`,t)}registerPayment(e,t){return this.http.post(`${this.baseUrl}/${e}/payment`,t)}};s.\u0275fac=function(t){return new(t||s)(Q(G))},s.\u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();var st=(()=>{let s=class s{constructor(){this.http=Re(G),this.apiUrl=`${M.tipificacionUrl}/customer-outputs`}saveConfiguration(e){return this.http.post(`${this.apiUrl}/config`,e)}getConfiguration(e,t){let n={tenantId:e};return t!=null&&(n.portfolioId=t),this.http.get(`${this.apiUrl}/config`,{params:n})}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();var dt=(()=>{let s=class s{constructor(e){this.http=e,this.apiUrl=`${M.apiUrl}/customers`}getAllCustomers(){return this.http.get(this.apiUrl)}getCustomerById(e){return this.http.get(`${this.apiUrl}/${e}`)}getCustomerByDocument(e){return this.http.get(`${this.apiUrl}/document/${e}`)}searchCustomers(e){return this.http.get(`${this.apiUrl}/search`,{params:{q:e}})}filterCustomers(e){return this.http.get(`${this.apiUrl}/filter`,{params:N({},e)})}createCustomer(e){return this.http.post(this.apiUrl,e)}updateCustomer(e,t){return this.http.put(`${this.apiUrl}/${e}`,t)}deleteCustomer(e){return this.http.delete(`${this.apiUrl}/${e}`)}getCustomerDetail(e,t){return this.http.get(`${this.apiUrl}/detail/${e}`,{params:{subPortfolioId:t.toString()}})}searchCustomerByCriteria(e,t,n){return this.http.get(`${this.apiUrl}/search-by`,{params:{tenantId:e.toString(),searchBy:t,value:n}})}searchCustomersByCriteria(e,t,n){return this.http.get(`${this.apiUrl}/search-by-multi`,{params:{tenantId:e.toString(),searchBy:t,value:n}})}searchCustomersAcrossAllTenants(e,t){return this.http.get(`${this.apiUrl}/search-all-tenants`,{params:{searchBy:e,value:t}})}getRecentCustomers(){return this.http.get(`${this.apiUrl}/recent`)}registerCustomerAccess(e){return this.http.post(`${this.apiUrl}/${e}/access`,{})}};s.\u0275fac=function(t){return new(t||s)(Q(G))},s.\u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();var ct=(()=>{let s=class s{constructor(e){this.http=e,this.apiUrl=`${M.apiUrl}/agents`}getAllAgents(){return this.http.get(this.apiUrl)}getAgentStatus(e){return this.http.get(`${this.apiUrl}/${e}/status`)}changeAgentStatus(e,t){return this.http.post(`${this.apiUrl}/${e}/status`,t)}getAvailableAgents(){return this.http.get(`${this.apiUrl}/available`)}};s.\u0275fac=function(t){return new(t||s)(Q(G))},s.\u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();var xi=["dynamicFieldRendererComponent"],ge=(a,s)=>s.id;function _i(a,s){a&1&&(l(0,"div",2)(1,"div",65)(2,"div")(3,"div",66),c(4,"\xA1Gesti\xF3n Guardada!"),r(),l(5,"div",67),c(6,"Los datos se registraron correctamente"),r()()()())}function bi(a,s){a&1&&(l(0,"span",17),c(1,"OSCURO"),r())}function Ci(a,s){a&1&&(l(0,"span",18),c(1,"CLARO"),r())}function yi(a,s){if(a&1&&(l(0,"option",74),c(1),r()),a&2){let i=s.$implicit;v("ngValue",i.id),d(),f(" Cliente: ",i.tenantName," ")}}function vi(a,s){if(a&1){let i=y();l(0,"select",72),D("ngModelChange",function(t){x(i);let n=u(2);return k(n.selectedTenantId,t)||(n.selectedTenantId=t),_(t)}),S("change",function(){x(i);let t=u(2);return _(t.onTenantChange())}),Ne(1,yi,2,2,"option",73),r()}if(a&2){let i=u(2);w("ngModel",i.selectedTenantId),d(),v("ngForOf",i.tenants)}}function Si(a,s){if(a&1&&(l(0,"option",74),c(1),r()),a&2){let i=s.$implicit;v("ngValue",i.id),d(),f(" Cartera: ",i.portfolioName," ")}}function wi(a,s){if(a&1){let i=y();l(0,"select",72),D("ngModelChange",function(t){x(i);let n=u(2);return k(n.selectedPortfolioId,t)||(n.selectedPortfolioId=t),_(t)}),S("change",function(){x(i);let t=u(2);return _(t.onPortfolioChange())}),l(1,"option",74),c(2,"Cartera: Todas"),r(),Ne(3,Si,2,2,"option",73),r()}if(a&2){let i=u(2);w("ngModel",i.selectedPortfolioId),d(),v("ngValue",void 0),d(2),v("ngForOf",i.portfolios)}}function ki(a,s){if(a&1){let i=y();l(0,"div",20)(1,"span",68),c(2,"\u26A0\uFE0F TEMP - Testing Only:"),r(),p(3,vi,2,2,"select",69),p(4,wi,4,3,"select",69),l(5,"input",70),D("ngModelChange",function(t){x(i);let n=u();return k(n.testDocument,t)||(n.testDocument=t),_(t)}),S("keyup.enter",function(){x(i);let t=u();return _(t.searchByTestDocument())}),r(),l(6,"input",71),D("ngModelChange",function(t){x(i);let n=u();return k(n.testPhone,t)||(n.testPhone=t),_(t)}),S("keyup.enter",function(){x(i);let t=u();return _(t.searchByTestPhone())}),r()()}if(a&2){let i=u();d(3),g(i.tenants.length>0?3:-1),d(),g(i.portfolios.length>0?4:-1),d(),w("ngModel",i.testDocument),d(),w("ngModel",i.testPhone)}}function Di(a,s){a&1&&E(0,"div",77)}function Ti(a,s){if(a&1){let i=y();l(0,"button",75),S("click",function(){let t=x(i).$implicit,n=u();return _(n.activeTab.set(t.id))}),l(1,"div",76),c(2),r(),p(3,Di,1,0,"div",77),r()}if(a&2){let i=s.$implicit,e=u();A("flex-1 px-2 py-1.5 text-xs font-semibold transition-all duration-300 relative group "+(e.activeTab()===i.id?"text-blue-700 dark:text-blue-200 bg-blue-50 dark:bg-blue-950/50":"text-gray-700 dark:text-gray-100 hover:text-blue-700 dark:hover:text-blue-200 hover:bg-gray-50 dark:hover:bg-gray-800")),d(2),f(" ",i.label," "),d(),g(e.activeTab()===i.id?3:-1)}}function Fi(a,s){}function Mi(a,s){if(a&1&&(l(0,"div",81)(1,"div",82)(2,"div",83)(3,"div",84),p(4,Fi,0,0),c(5),r(),l(6,"div",85),c(7),r()()()()),a&2){let i=s.$implicit,e=u(2);le("col-span-1",!i.size||i.size==="small")("col-span-2",i.size==="medium")("col-span-3",i.size==="large")("col-span-4",i.size==="full")("bg-cyan-50",i.highlight&&!e.themeService.isDarkMode())("dark:bg-cyan-950/30",i.highlight&&e.themeService.isDarkMode())("border-cyan-300",i.highlight&&!e.themeService.isDarkMode())("dark:border-cyan-900/50",i.highlight&&e.themeService.isDarkMode())("bg-slate-50",!i.highlight&&!e.themeService.isDarkMode())("dark:bg-slate-900/50",!i.highlight&&e.themeService.isDarkMode())("border-slate-200",!i.highlight&&!e.themeService.isDarkMode())("dark:border-slate-700",!i.highlight&&e.themeService.isDarkMode()),d(3),le("text-cyan-800",i.highlight&&!e.themeService.isDarkMode())("dark:text-cyan-100",i.highlight&&e.themeService.isDarkMode())("text-slate-600",!i.highlight&&!e.themeService.isDarkMode())("dark:text-slate-400",!i.highlight&&e.themeService.isDarkMode()),d(),g(i.highlight?4:-1),d(),f(" ",i.label," "),d(),le("text-cyan-900",i.highlight&&!e.themeService.isDarkMode())("dark:text-cyan-50",i.highlight&&e.themeService.isDarkMode())("text-slate-900",!i.highlight&&!e.themeService.isDarkMode())("dark:text-white",!i.highlight&&e.themeService.isDarkMode()),d(),f(" ",e.formatFieldValue(e.getFieldValue(i.field),i.format)," ")}}function Ei(a,s){a&1&&(l(0,"div",80)(1,"p"),c(2,"No hay campos configurados para mostrar"),r(),l(3,"p",86),c(4,"Configure los campos en Mantenimiento > Salidas de Cliente"),r()())}function Pi(a,s){if(a&1&&(l(0,"div",41)(1,"div",78),V(2,Mi,8,43,"div",79,ge),r(),p(4,Ei,5,0,"div",80),r()),a&2){let i=u();d(2),L(i.customerOutputFields()),d(2),g(i.customerOutputFields().length===0?4:-1)}}function Ii(a,s){if(a&1&&(l(0,"div",41)(1,"div",87)(2,"div",88),c(3," Info. Producto "),r(),l(4,"div",89)(5,"div",90)(6,"span",91),c(7,"Producto:"),r(),l(8,"span",92),c(9),r()(),l(10,"div",90)(11,"span",91),c(12,"F. Desemb.:"),r(),l(13,"span",92),c(14),r()(),l(15,"div",90)(16,"span",91),c(17,"Monto:"),r(),l(18,"span",92),c(19),r()(),l(20,"div",90)(21,"span",91),c(22,"Plazo:"),r(),l(23,"span",92),c(24),r()(),l(25,"div",90)(26,"span",91),c(27,"Tasa:"),r(),l(28,"span",92),c(29),r()()()(),l(30,"div",93)(31,"div",94),c(32," Detalle Deuda "),r(),l(33,"div",89)(34,"div",95)(35,"span",96),c(36,"Capital:"),r(),l(37,"span",97),c(38),r()(),l(39,"div",95)(40,"span",96),c(41,"Intereses:"),r(),l(42,"span",97),c(43),r()(),l(44,"div",98)(45,"span",99),c(46,"Moras:"),r(),l(47,"span",100),c(48),r()(),l(49,"div",98)(50,"span",99),c(51,"G. Cobr.:"),r(),l(52,"span",100),c(53),r()(),E(54,"div",101),l(55,"div",102)(56,"span",100),c(57,"Total:"),r(),l(58,"span",100),c(59),r()()()()()),a&2){let i=u();d(9),U(i.customerData().cuenta.tipo_producto),d(5),U(i.customerData().cuenta.fecha_desembolso),d(5),f("S/ ",i.customerData().cuenta.monto_original.toFixed(2)),d(5),f("",i.customerData().cuenta.plazo_meses,"m"),d(5),f("",i.customerData().cuenta.tasa_interes,"%"),d(9),f("S/ ",i.customerData().deuda.saldo_capital.toFixed(2)),d(5),f("S/ ",i.customerData().deuda.intereses_vencidos.toFixed(2)),d(5),f("S/ ",i.customerData().deuda.mora_acumulada.toFixed(2)),d(5),f("S/ ",i.customerData().deuda.gastos_cobranza.toFixed(2)),d(6),f("S/ ",i.customerData().deuda.saldo_total.toFixed(2))}}function Ni(a,s){if(a&1){let i=y();l(0,"div",103)(1,"div")(2,"p",104),c(3,"Sin gestiones previas"),r(),l(4,"p",105),c(5," No hay gestiones registradas para este cliente "),r(),l(6,"p",106),c(7),r()(),l(8,"button",107),S("click",function(){x(i);let t=u(2);return _(t.loadManagementHistory())}),c(9," Recargar Historial "),r()()}if(a&2){let i=u(2);d(7),f(" Cliente: ",i.customerData().id_cliente," ")}}function Vi(a,s){if(a&1){let i=y();l(0,"div",116)(1,"div",117)(2,"div",118)(3,"span",119),c(4,"Cronograma"),r()(),l(5,"button",120),S("click",function(){x(i);let t=u().$implicit,n=u(3);return _(n.openScheduleDetail(t.id))}),c(6," Ver Detalle "),r()(),l(7,"div",121)(8,"div",90)(9,"span"),c(10),r(),l(11,"span",66),c(12),K(13,"number"),r()(),l(14,"div",122),c(15),r()()()}if(a&2){let i=u().$implicit;d(10),f("Cuotas: ",i.schedule.numberOfInstallments),d(2),f("S/ ",X(13,3,i.schedule.totalAmount,"1.2-2")),d(3),f(" ",i.schedule.installments.length," cuota(s) registrada(s) ")}}function Li(a,s){if(a&1&&(l(0,"div",108)(1,"div",109)(2,"div",110),c(3),r(),l(4,"div",111),c(5),r()(),l(6,"div",89)(7,"div",112),c(8),r(),l(9,"div",113),c(10),r(),l(11,"div",114),c(12),r(),l(13,"div",115),c(14),r(),p(15,Vi,16,6,"div",116),r()()),a&2){let i=s.$implicit;d(3),f(" ",i.fecha," "),d(2),U(i.asesor),d(3),U(i.resultado),d(2),U(i.gestion),d(2),U(i.observacion),d(2),f("Duraci\xF3n: ",i.duracion),d(),g(i.schedule?15:-1)}}function Ai(a,s){if(a&1&&V(0,Li,16,7,"div",108,fe),a&2){let i=u(2);L(i.historialGestiones())}}function Ri(a,s){if(a&1&&(l(0,"div",41),p(1,Ni,10,1,"div",103)(2,Ai,2,0),r()),a&2){let i=u();d(),g(i.historialGestiones().length===0?1:2)}}function qi(a,s){if(a&1&&(l(0,"option",127),c(1),r()),a&2){let i=s.$implicit;v("value",i.id),d(),xe("[",i.codigo,"] ",i.label)}}function $i(a,s){a&1&&(l(0,"div",128),c(1," Requerido "),r())}function Oi(a,s){if(a&1){let i=y();l(0,"div",48)(1,"label",58),E(2,"div",123),c(3," Resultado de Contacto * "),r(),l(4,"div",124)(5,"select",125),D("ngModelChange",function(t){x(i);let n=u();return k(n.managementForm.resultadoContacto,t)||(n.managementForm.resultadoContacto=t),_(t)}),S("ngModelChange",function(){x(i);let t=u();return _(t.onContactResultChange())}),l(6,"option",126),c(7,"-- Seleccionar resultado --"),r(),V(8,qi,2,3,"option",127,ge),r()(),p(10,$i,2,0,"div",128),r()}if(a&2){let i=u();d(5),A("w-full p-2 pr-8 border rounded-lg font-semibold text-gray-700 dark:text-white appearance-none cursor-pointer transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-800 hover:border-blue-400 dark:hover:border-blue-600 text-xs "+(i.errors().resultadoContacto?"border-red-500 bg-red-50 dark:bg-red-950/30 dark:border-red-600":"border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-900")+" "+(i.managementForm.resultadoContacto?"bg-blue-50 dark:bg-blue-950/30 border-blue-400 dark:border-blue-600":"")),w("ngModel",i.managementForm.resultadoContacto),d(3),L(i.contactClassifications()),d(2),g(i.errors().resultadoContacto?10:-1)}}function Ui(a,s){if(a&1&&(l(0,"option",127),c(1),r()),a&2){let i=s.$implicit;v("value",i.id),d(),xe("[",i.codigo,"] ",i.label)}}function Bi(a,s){a&1&&(l(0,"div",130),c(1," Requerido "),r())}function ji(a,s){if(a&1){let i=y();l(0,"div",129)(1,"label",58),E(2,"div"),c(3),r(),l(4,"div",124)(5,"select",125),S("ngModelChange",function(t){x(i);let n=u().$index,o=u(2);return _(o.onClassificationLevelChange(n,t))}),l(6,"option",126),c(7,"-- Seleccionar --"),r(),V(8,Ui,2,3,"option",127,ge),r()(),p(10,Bi,2,0,"div",130),r()}if(a&2){let i=u(),e=i.$implicit,t=i.$index,n=u(2);d(2),A("w-1.5 h-1.5 rounded-full "+(t===0?"bg-red-500":t===1?"bg-blue-500":t===2?"bg-purple-500":t===3?"bg-orange-500":"bg-green-500")),d(),xe(" ",n.getDynamicLevelLabel(t),"",t===0?" *":""," "),d(2),A("w-full p-2 pr-8 border rounded-lg font-semibold text-gray-700 dark:text-white appearance-none cursor-pointer transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-green-200 dark:focus:ring-green-800 hover:border-green-500 text-xs "+(n.errors().tipoGestion&&t===0?"border-red-500 bg-red-50 dark:bg-red-950/30":"border-green-300 dark:border-green-700 bg-white dark:bg-gray-900")+" "+(n.selectedClassifications()[t]?"bg-green-100 dark:bg-green-950/30 border-green-500 dark:border-green-600":"")),v("ngModel",n.selectedClassifications()[t]),d(3),L(e),d(2),g(n.errors().tipoGestion&&t===0?10:-1)}}function Wi(a,s){if(a&1&&p(0,ji,11,8,"div",129),a&2){let i=s.$index,e=u(2);g(e.shouldShowLevel(i)?0:-1)}}function Hi(a,s){if(a&1&&V(0,Wi,1,1,null,null,fe),a&2){let i=u();L(i.hierarchyLevels())}}function Gi(a,s){a&1&&(l(0,"div",49)(1,"div",131)(2,"span",12),c(3,"Cargando campos adicionales..."),r()()())}function zi(a,s){a&1&&(l(0,"div",50)(1,"div",132)(2,"span",12),c(3,"Esta clasificaci\xF3n no tiene campos adicionales configurados"),r()()())}function Qi(a,s){if(a&1){let i=y();l(0,"app-dynamic-field-renderer",133,0),S("dataChange",function(t){x(i);let n=u();return _(n.onDynamicFieldsChange(t))}),r()}if(a&2){let i=u();v("schema",i.dynamicFieldsSchema())("externalUpdates",i.externalFieldUpdates())("selectedClassification",i.selectedClassification())}}function Yi(a,s){a&1&&(l(0,"div",52)(1,"div",134)(2,"span",135),c(3,"Cargando cronogramas pendientes..."),r()()())}function Ji(a,s){if(a&1&&(l(0,"div",148)(1,"div",15)(2,"span",149),c(3),r(),l(4,"span",150),c(5),r()(),l(6,"span",151),c(7),K(8,"number"),r()()),a&2){let i=u().$implicit;d(3),f("Cuota #",i.installmentNumber),d(2),f("Vence: ",i.dueDate),d(2),f("S/ ",X(8,3,i.amount,"1.2-2"))}}function Zi(a,s){if(a&1&&p(0,Ji,9,6,"div",148),a&2){let i=s.$index;g(i<3?0:-1)}}function Ki(a,s){if(a&1&&(l(0,"div",143),c(1),r()),a&2){let i=u().$implicit,e=u(2);d(),f(" + ",e.getPendingInstallments(i).length-3," cuotas m\xE1s ")}}function Xi(a,s){if(a&1){let i=y();l(0,"button",152),S("click",function(){x(i);let t=u(3);return _(t.applyNextInstallmentPayment())}),c(1," Usar Pr\xF3xima Cuota "),r()}}function en(a,s){if(a&1){let i=y();l(0,"button",153),S("click",function(){x(i);let t=u(3);return _(t.applyFullSchedulePayment())}),c(1),K(2,"number"),r()}if(a&2){let i=u().$implicit,e=u(2);d(),f(" Pagar Todo (S/ ",X(2,1,e.calculatePendingAmount(i),"1.2-2"),") ")}}function tn(a,s){if(a&1&&(l(0,"div",139)(1,"div",5)(2,"div",15)(3,"div",137),c(4),r(),l(5,"div",140),c(6," ACTIVO "),r()(),l(7,"div",137),c(8),K(9,"number"),r()(),l(10,"div",141)(11,"div",142),c(12,"Cuotas Pendientes"),r(),V(13,Zi,1,1,null,null,ge),p(15,Ki,2,1,"div",143),r(),l(16,"div",144),p(17,Xi,2,0,"button",145),p(18,en,3,4,"button",146),r(),l(19,"div",147)(20,"span"),c(21,"El pago se aplicar\xE1 autom\xE1ticamente a las cuotas pendientes en orden de vencimiento"),r()()()),a&2){let i,e,t=s.$implicit,n=u(2);d(4),f(" ",t.scheduleType||"CRONOGRAMA"," "),d(4),f(" S/ ",X(9,5,t.totalAmount,"1.2-2")," "),d(5),L(n.getPendingInstallments(t)),d(2),g(n.getPendingInstallments(t).length>3?15:-1),d(2),g(((i=n.selectedClassification())==null?null:i.allowsInstallmentSelection)===!0?17:-1),d(),g(((e=n.selectedClassification())==null?null:e.suggestsFullAmount)===!0?18:-1)}}function nn(a,s){if(a&1&&(l(0,"div",53)(1,"div",5)(2,"div",15),E(3,"div",136),l(4,"div")(5,"h4",137),c(6,"Cronograma Activo Detectado"),r(),l(7,"p",138),c(8),r()()()(),V(9,tn,22,8,"div",139,ge),r()),a&2){let i=u();d(8),f("Cliente tiene ",i.activeSchedules().length," cronograma(s) pendiente(s)"),d(),L(i.activeSchedules())}}function an(a,s){a&1&&c(0," Guardando... ")}function on(a,s){a&1&&c(0," Guardar Gesti\xF3n ")}function rn(a,s){if(a&1){let i=y();l(0,"div",64)(1,"div",154)(2,"div",155)(3,"div",6)(4,"div")(5,"h2",156),c(6,"Cronograma de Pagos"),r(),l(7,"p",67),c(8),r()()(),l(9,"button",157),S("click",function(){x(i);let t=u();return _(t.closeScheduleDetail())}),r()(),l(10,"div",158),E(11,"app-payment-schedule-view",159),r(),l(12,"div",160)(13,"button",161),S("click",function(){x(i);let t=u();return _(t.closeScheduleDetail())}),c(14," Cerrar "),r()()()()}if(a&2){let i=u();d(8),f("Gesti\xF3n ",i.scheduleManagementId()),d(3),v("managementId",i.scheduleManagementId())}}var ea=(()=>{let s=class s{constructor(e,t,n,o,m,h,C,T,Y,ae,oe,R){this.systemConfigService=e,this.managementService=t,this.paymentScheduleService=n,this.themeService=o,this.classificationService=m,this.apiSystemConfigService=h,this.customerOutputConfigService=C,this.customerService=T,this.router=Y,this.http=ae,this.sipService=oe,this.agentService=R,this.callActive=b(!1),this.callDuration=b(0),this.saving=b(!1),this.showScheduleDetail=b(!1),this.scheduleManagementId=b(null),this.showOutputSelector=!1,this.errors=b({}),this.showSuccess=b(!1),this.animateEntry=b(!0),this.activeTab=b("cliente"),this.historialGestiones=b([]),this.tenants=[],this.portfolios=[],this.testDocument="",this.testPhone="",this.customerOutputFields=b([]),this.campaign=B(()=>this.systemConfigService.getCampaign()),this.contactClassifications=B(()=>this.systemConfigService.getContactClassifications()),this.managementClassifications=B(()=>this.apiSystemConfigService.getManagementClassificationsForUI()),this.managementClassificationsHierarchical=B(()=>{let P=this.managementClassifications(),q=new Map,I=new Map;P.forEach($=>{let W=String($.id);q.set(W,$),I.set(W,[])}),P.forEach($=>{if($.parentId){let W=String($.parentId),z=I.get(W);z&&z.push($)}});let F=($,W=0)=>{let z=[];return $.forEach(be=>{z.push(Ce(N({},be),{indentLevel:W,displayLabel:"  ".repeat(W)+(W>0?"\u2514\u2500 ":"")+`[${be.codigo}] ${be.label}`}));let ut=String(be.id),Ae=I.get(ut)||[];Ae.length>0&&z.push(...F(Ae,W+1))}),z},j=P.filter($=>!$.parentId);return F(j,0)}),this.paymentMethods=B(()=>this.systemConfigService.getPaymentMethods()),this.scheduleTypes=B(()=>this.systemConfigService.getScheduleConfig().tipos_cronograma),this.periodicities=B(()=>this.systemConfigService.getScheduleConfig().periodicidades),this.tabs=[{id:"cliente",label:"Cliente",icon:"user"},{id:"cuenta",label:"Cuenta",icon:"wallet"},{id:"historial",label:"Historial",icon:"history"}],this.managementForm={resultadoContacto:"",tipoGestion:"",clasificacionNivel1:"",clasificacionNivel2:"",clasificacionNivel3:"",motivoNoPago:"",metodoPago:"",montoPago:"",fechaCompromiso:"",horaCompromiso:"",ultimos4Tarjeta:"",bancoSeleccionado:"",observaciones:"",notasPrivadas:""},this.selectedClassifications=b([]),this.dynamicFields=b([]),this.dynamicFieldValues=b({}),this.isLoadingDynamicFields=b(!1),this.isLeafClassification=b(!1),this.dynamicFieldsSchema=b(null),this.externalFieldUpdates=b({}),this.activeSchedules=b([]),this.isLoadingSchedules=b(!1),this.showScheduleHelper=b(!1),this.selectedClassification=B(()=>{let P=this.selectedClassifications();if(P.length===0)return null;let q=P[P.length-1];if(!q)return null;let F=this.managementClassifications().find(j=>String(j.id)===String(q));return F&&(console.log("[DEBUG] Selected typification:",F),console.log("[DEBUG] suggestsFullAmount:",F.suggestsFullAmount),console.log("[DEBUG] allowsInstallmentSelection:",F.allowsInstallmentSelection),console.log("[DEBUG] requiresManualAmount:",F.requiresManualAmount)),F||null}),this.isFormValid=B(()=>{if(this.usesHierarchicalClassifications()){let q=this.selectedClassifications();if(q.length===0||!q[q.length-1])return!1;let I=q[q.length-1];if(this.managementClassifications().some($=>$.parentId&&Number($.parentId)===Number(I)))return console.log("[isFormValid] A\xFAn hay niveles por seleccionar"),!1}else if(!this.managementForm.resultadoContacto)return!1;let P=this.dynamicFieldsSchema();if(P&&P.fields&&P.fields.length>0){let q=this.dynamicFieldValues();for(let I of P.fields)if(I.required){let F=q[I.id];if(F==null||F===""||I.type==="table"&&(!Array.isArray(F)||F.length===0))return!1}}return!0}),this.hierarchyLevels=B(()=>{let P=this.managementClassifications(),q=this.selectedClassifications(),I=[];console.log("[hierarchyLevels] Total classifications:",P.length),console.log("[hierarchyLevels] Selected:",q);let F=P.filter(j=>j.hierarchyLevel===1||!j.parentId);console.log("[hierarchyLevels] Nivel 1 (roots):",F.length,F.map(j=>`${j.codigo} (ID:${j.id})`)),F.length>0&&I.push(F);for(let j=0;j<q.length;j++){let $=q[j];if(console.log(`[hierarchyLevels] Buscando hijos del nivel ${j+1}, parentId:`,$),$){let W=P.filter(z=>z.parentId&&Number(z.parentId)===Number($));if(console.log(`[hierarchyLevels] Encontrados ${W.length} hijos:`,W.map(z=>`${z.codigo} (ID:${z.id}, parent:${z.parentId})`)),W.length>0)I.push(W);else{console.log("[hierarchyLevels] No se encontraron hijos, deteniendo b\xFAsqueda");break}}}return console.log("[hierarchyLevels] Total niveles construidos:",I.length),I}),this.scheduleForm={numeroCuotas:"",montoCuota:"",periodicidad:"",fechaPrimeraCuota:"",tipoCronograma:"",montoInicial:"",montoNegociado:"",cuotas:[]},this.customerData=b({id_cliente:"CLI-2025-0087453",nombre_completo:"GARC\xCDA RODRIGUEZ, CARMEN ROSA",tipo_documento:"DNI",numero_documento:"45621378",fecha_nacimiento:"15/03/1985",edad:40,contacto:{telefono_principal:"+51 987 654 321",telefono_alternativo:"+51 945 123 456",telefono_trabajo:"+51 01 4567890",email:"carmen.garcia@email.com",direccion:"Av. Los \xC1lamos 458, Dpto 302, San Borja, Lima"},cuenta:{numero_cuenta:"****5678",tipo_producto:"Pr\xE9stamo Personal",fecha_desembolso:"15/01/2024",monto_original:15e3,plazo_meses:24,tasa_interes:18.5},deuda:{saldo_capital:8750.5,intereses_vencidos:456.78,mora_acumulada:234.5,gastos_cobranza:120,saldo_total:9561.78,dias_mora:45,fecha_ultimo_pago:"15/10/2024",monto_ultimo_pago:458.33}}),this.callState=ee.IDLE,this.isMuted=b(!1),this.incomingPhoneNumber=null}ngOnInit(){this.loadTenants(),this.loadManagementHistory(),this.callStateSubscription=this.sipService.onCallStatus.subscribe(e=>{console.log("\u{1F4DE} [CollectionManagement] Estado de llamada:",e),this.callState=e,e===ee.ACTIVE&&!this.callActive()&&(this.callActive.set(!0),this.startCall(),this.agentService.changeAgentStatus(1,{estado:Pe.EN_LLAMADA}).subscribe({next:()=>console.log("\u2705 Estado cambiado a EN_LLAMADA"),error:n=>console.error("\u274C Error cambiando estado:",n)})),(e===ee.ENDED||e===ee.IDLE)&&this.callActive()&&(this.callActive.set(!1),this.callTimer&&(clearInterval(this.callTimer),this.callTimer=void 0),this.agentService.changeAgentStatus(1,{estado:Pe.TIPIFICANDO}).subscribe({next:()=>console.log("\u2705 Estado cambiado a TIPIFICANDO"),error:n=>console.error("\u274C Error cambiando estado:",n)}))}),this.incomingCallSubscription=this.sipService.onIncomingCall.subscribe(e=>{console.log("\u{1F4F2} [CollectionManagement] Llamada entrante de:",e.from),this.incomingPhoneNumber=e.from,this.selectedTenantId&&e.from?this.autoLoadCustomerByPhone(e.from):console.warn("\u26A0\uFE0F No se puede buscar cliente: tenant no seleccionado")})}autoLoadCustomerByPhone(e){if(console.log("\u{1F50D} [AUTO-LOAD] Buscando cliente por tel\xE9fono:",e),!this.selectedTenantId){console.error("\u274C No hay tenant seleccionado");return}this.customerService.searchCustomersByCriteria(this.selectedTenantId,"telefono",e).subscribe({next:t=>{t&&t.length>0?(console.log("\u2705 [AUTO-LOAD] Cliente encontrado:",t[0]),this.loadCustomerFromResource(t[0])):console.warn("\u26A0\uFE0F [AUTO-LOAD] No se encontr\xF3 cliente con tel\xE9fono:",e)},error:t=>{console.error("\u274C [AUTO-LOAD] Error buscando cliente:",t)}})}loadTenants(){this.classificationService.getAllTenants().subscribe({next:e=>{this.tenants=e,e.length>0&&(this.selectedTenantId=e[1].id,this.onTenantChange())},error:e=>{console.error("Error loading tenants:",e)}})}onTenantChange(){this.selectedPortfolioId=void 0,this.portfolios=[],this.selectedTenantId&&(this.loadPortfolios(),this.reloadTypifications(),this.loadCustomerOutputConfig(),this.loadFirstCustomer())}loadPortfolios(){this.selectedTenantId&&this.classificationService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:e=>{this.portfolios=e},error:e=>{console.error("Error loading portfolios:",e)}})}onPortfolioChange(){this.reloadTypifications(),this.loadCustomerOutputConfig()}reloadTypifications(){this.selectedTenantId&&this.apiSystemConfigService.setTenantAndPortfolio(this.selectedTenantId,this.selectedPortfolioId)}loadCustomerOutputConfig(){this.selectedTenantId&&(console.log("[TEMPORAL] loadCustomerOutputConfig - endpoint no existe, usando campos por defecto"),this.setDefaultOutputFields())}loadFirstCustomer(){this.selectedTenantId&&this.http.get(`${M.apiUrl}/customers`,{params:{page:"0",size:"1"}}).pipe(Z(e=>(console.error("Error cargando primer cliente:",e),J([])))).subscribe({next:e=>{if(e&&e.length>0){let t=e[0];console.log("\u{1F50D} [FRONTEND] Primer cliente cargado:",t),console.log("\u{1F50D} [FRONTEND] accountNumber en el customer:",t.accountNumber),console.log("\u{1F50D} [FRONTEND] Campos disponibles:",Object.keys(t));let n=t.contactMethods?.find(h=>h.contactType?.toLowerCase()==="telefono"||h.contactType?.toLowerCase()==="phone"),o=t.contactMethods?.find(h=>h.contactType?.toLowerCase()==="email"),m=t.accountNumber||"";console.log("\u{1F50D} [FRONTEND] Valor final de numero_cuenta:",m),this.customerData.set({id:t.id,id_cliente:t.customerId||t.identificationCode||t.id?.toString(),nombre_completo:t.fullName||"",tipo_documento:t.documentType||"DNI",numero_documento:t.documentNumber||t.document||"",fecha_nacimiento:t.birthDate||"",edad:t.age||0,contacto:{telefono_principal:n?.value||"",telefono_alternativo:"",telefono_trabajo:"",email:o?.value||"",direccion:t.address||""},cuenta:{numero_cuenta:m,tipo_producto:t.subPortfolioName||"",fecha_desembolso:"",monto_original:0,plazo_meses:0,tasa_interes:0},deuda:{saldo_capital:0,intereses_vencidos:0,mora_acumulada:0,gastos_cobranza:0,saldo_total:0,dias_mora:0,fecha_ultimo_pago:"",monto_ultimo_pago:0}})}else console.log("No se encontraron clientes en la base de datos")}})}setDefaultOutputFields(){this.customerOutputFields.set([{id:"numero_documento",label:"DNI/Documento",field:"numero_documento",category:"personal",format:"text",highlight:!0,size:"medium"},{id:"nombre_completo",label:"Nombre Completo",field:"nombre_completo",category:"personal",format:"text",highlight:!1,size:"full"},{id:"telefono_principal",label:"Celular",field:"contacto.telefono_principal",category:"contact",format:"text",highlight:!1,size:"medium"},{id:"email",label:"Email",field:"contacto.email",category:"contact",format:"text",highlight:!1,size:"medium"},{id:"direccion",label:"Direcci\xF3n",field:"contacto.direccion",category:"contact",format:"text",highlight:!1,size:"full"},{id:"edad",label:"Edad",field:"edad",category:"personal",format:"number",highlight:!1,size:"small"},{id:"saldo_total",label:"Deuda Total",field:"deuda.saldo_total",category:"debt",format:"currency",highlight:!0,size:"small"},{id:"dias_mora",label:"D\xEDas de Mora",field:"deuda.dias_mora",category:"debt",format:"number",highlight:!0,size:"small"},{id:"numero_cuenta",label:"Nro. Cuenta",field:"cuenta.numero_cuenta",category:"account",format:"text",highlight:!1,size:"medium"},{id:"tipo_producto",label:"Producto",field:"cuenta.tipo_producto",category:"account",format:"text",highlight:!1,size:"medium"}])}loadManagementHistory(){let e=String(this.customerData().id);console.log("[HISTORIAL] Cargando historial para cliente ID:",e),this.managementService.getManagementsByCustomer(e).subscribe({next:t=>{console.log("[HISTORIAL] Gestiones recibidas del backend:",t),console.log("[HISTORIAL] Total de gestiones:",t.length);let n=t.map(o=>{let m=o.managementDate&&o.managementTime?`${o.managementDate} ${o.managementTime}`:new Date().toLocaleString("es-PE"),h={id:o.id,fecha:m,asesor:o.advisorId,resultado:"Gesti\xF3n realizada",gestion:o.level3Name||o.level2Name||o.level1Name||"-",observacion:o.observations||"Sin observaciones",duracion:"00:00:00",hasSchedule:o.typificationRequiresSchedule||!1,schedule:null};return h.hasSchedule&&this.paymentScheduleService.getPaymentScheduleByManagementId(o.id).subscribe({next:C=>{C&&(h.schedule=C)},error:()=>{}}),h});this.historialGestiones.set(n),console.log("[HISTORIAL] Historial establecido en signal:",this.historialGestiones())},error:t=>{console.error("[HISTORIAL] Error al cargar historial de gestiones:",t),console.error("[HISTORIAL] Detalles del error:",{status:t.status,statusText:t.statusText,message:t.message,url:t.url})}})}formatDateTime(e){let t=new Date(e),n=t.getDate().toString().padStart(2,"0"),o=(t.getMonth()+1).toString().padStart(2,"0"),m=t.getFullYear(),h=t.getHours().toString().padStart(2,"0"),C=t.getMinutes().toString().padStart(2,"0");return`${n}/${o}/${m} ${h}:${C}`}calculateCallDuration(e){return e.durationSeconds?this.formatTime(e.durationSeconds):"00:00:00"}ngOnDestroy(){this.callTimer&&clearInterval(this.callTimer),this.callStateSubscription&&this.callStateSubscription.unsubscribe(),this.incomingCallSubscription&&this.incomingCallSubscription.unsubscribe()}openScheduleDetail(e){this.scheduleManagementId.set(e),this.showScheduleDetail.set(!0)}closeScheduleDetail(){this.showScheduleDetail.set(!1),this.scheduleManagementId.set(null)}toggleCall(){this.callActive()?this.endCall():this.startCall()}startCall(){this.callActive.set(!0),this.callDuration.set(0),this.callStartTime=new Date().toISOString(),this.callTimer=window.setInterval(()=>{this.callDuration.update(e=>e+1)},1e3)}endCall(){if(!this.managementForm.resultadoContacto){alert("\u26A0\uFE0F Debe seleccionar un resultado de contacto antes de finalizar");return}this.callActive.set(!1),this.callTimer&&clearInterval(this.callTimer)}formatTime(e){let t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=e%60;return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}onContactResultChange(){this.managementForm.tipoGestion="",this.managementForm.motivoNoPago=""}onManagementTypeChange(){}showManagementType(){return this.managementForm.resultadoContacto==="CPC"||this.managementForm.resultadoContacto==="CTT"}usesHierarchicalClassifications(){let e=this.hierarchyLevels();return e.length>0&&e[0].length>0}getTypificationsForLevel(e){return this.hierarchyLevels()[e]||[]}onClassificationLevelChange(e,t){let n=[...this.selectedClassifications()];if(n[e]=t,this.selectedClassifications.set(n.slice(0,e+1)),e===0?(this.managementForm.clasificacionNivel1=t,this.managementForm.clasificacionNivel2="",this.managementForm.clasificacionNivel3=""):e===1?(this.managementForm.clasificacionNivel2=t,this.managementForm.clasificacionNivel3=""):e===2&&(this.managementForm.clasificacionNivel3=t),t){this.managementForm.tipoGestion=t;let o=Number(t);!isNaN(o)&&o>0?this.loadDynamicFields(o):(this.dynamicFields.set([]),this.dynamicFieldValues.set({}),this.isLeafClassification.set(!1))}else{let o=this.selectedClassifications().filter(m=>m).pop();this.managementForm.tipoGestion=o||"",this.dynamicFields.set([]),this.dynamicFieldValues.set({}),this.isLeafClassification.set(!1)}}loadDynamicFields(e){console.log("[TEMPORAL] loadDynamicFields deshabilitado - endpoint /tenants/.../typifications/.../fields no existe"),this.isLoadingDynamicFields.set(!1),this.isLeafClassification.set(!1),this.dynamicFields.set([]),this.dynamicFieldsSchema.set(null)}checkAndLoadPaymentSchedules(){let e=this.selectedClassifications();if(e.length===0){this.showScheduleHelper.set(!1);return}let t=e[e.length-1],o=this.managementClassifications().find(m=>m.id.toString()===t);o&&o.requiere_pago?(console.log("[SCHEDULE] Payment typification detected:",o.codigo),console.log("[DEBUG-SCHEDULE] Full typification object:",o),console.log("[DEBUG-SCHEDULE] suggestsFullAmount:",o.suggestsFullAmount),console.log("[DEBUG-SCHEDULE] allowsInstallmentSelection:",o.allowsInstallmentSelection),console.log("[DEBUG-SCHEDULE] requiresManualAmount:",o.requiresManualAmount),this.loadActiveSchedules()):(this.showScheduleHelper.set(!1),this.activeSchedules.set([]))}loadActiveSchedules(){let e=String(this.customerData().id);console.log("[SCHEDULE] Loading active schedules for customer ID:",e),this.isLoadingSchedules.set(!0),this.managementService.getActiveSchedulesByCustomer(e).subscribe({next:t=>{console.log("[SCHEDULE] Active schedules loaded:",t),this.activeSchedules.set(t),this.showScheduleHelper.set(t.length>0),this.isLoadingSchedules.set(!1),t.length>0&&this.suggestPaymentAmount(t[0])},error:t=>{console.error("[SCHEDULE] Error loading schedules:",t),this.isLoadingSchedules.set(!1),this.showScheduleHelper.set(!1)}})}suggestPaymentAmount(e){if(!e.installments||e.installments.length===0)return;let t=e.installments.filter(n=>n.status.status==="PENDING").sort((n,o)=>new Date(n.dueDate).getTime()-new Date(o.dueDate).getTime())[0];if(t){console.log("[SCHEDULE] Suggested payment amount:",t.amount),this.managementForm.montoPago||(this.managementForm.montoPago=t.amount.toFixed(2));let n=N({},this.dynamicFieldValues());n.monto_pagado||(n.monto_pagado=t.amount,this.dynamicFieldValues.set(n))}}applyFullSchedulePayment(){let e=this.activeSchedules();if(e.length===0)return;let t=e[0],n=this.calculatePendingAmount(t);console.log("[BUTTON] Pagar Todo clicked. Amount:",n);let o=this.dynamicFieldsSchema(),m=o?.fields.find(h=>h.type==="currency"||h.id.toLowerCase().includes("monto"));if(m){console.log("[BUTTON] Found monto field:",m.id);let h={};if(h[m.id]=n,o?.fields.some(T=>T.id==="saldo_pendiente")){h.saldo_pendiente=0,console.log("[BUTTON] Saldo pendiente ser\xE1 0 (pago total)");let T=N({},this.dynamicFieldValues());T[m.id]=n,T.saldo_pendiente=0,this.dynamicFieldValues.set(T)}this.externalFieldUpdates.set(h),console.log("[BUTTON] Updated externalFieldUpdates:",h),setTimeout(()=>this.externalFieldUpdates.set({}),100)}else console.warn("[BUTTON] No se encontr\xF3 campo de monto en el schema")}applyNextInstallmentPayment(){console.log("[BUTTON-PP] Usar Pr\xF3xima Cuota clicked!");let e=this.activeSchedules();if(console.log("[BUTTON-PP] Active schedules:",e),e.length===0){console.warn("[BUTTON-PP] No schedules found");return}let t=e[0];console.log("[BUTTON-PP] Using schedule:",t),console.log("[BUTTON-PP] Schedule installments:",t.installments);let n=t.installments.filter(m=>(console.log("[BUTTON-PP] Checking installment:",m,"Status:",m.status?.status),m.status.status==="PENDING"));console.log("[BUTTON-PP] Pending installments:",n);let o=n.sort((m,h)=>new Date(m.dueDate).getTime()-new Date(h.dueDate).getTime())[0];if(console.log("[BUTTON-PP] Next pending installment:",o),o){console.log("[BUTTON-PP] Usar Pr\xF3xima Cuota - Amount:",o.amount);let m=this.dynamicFieldsSchema(),h=m?.fields.find(C=>C.type==="currency"||C.id.toLowerCase().includes("monto"));if(h){console.log("[BUTTON-PP] Found monto field:",h.id);let C={};if(C[h.id]=o.amount,m?.fields.some(Y=>Y.id==="saldo_pendiente")){let Y=this.calculatePendingAmount(t),ae=Math.max(0,Y-o.amount);C.saldo_pendiente=ae,console.log("[BUTTON-PP] Saldo pendiente calculado:",ae,"= Total",Y,"- Monto",o.amount);let oe=N({},this.dynamicFieldValues());oe[h.id]=o.amount,oe.saldo_pendiente=ae,this.dynamicFieldValues.set(oe)}this.externalFieldUpdates.set(C),console.log("[BUTTON-PP] Updated externalFieldUpdates:",C),setTimeout(()=>this.externalFieldUpdates.set({}),100)}else console.warn("[BUTTON-PP] No se encontr\xF3 campo de monto en el schema")}else console.warn("[BUTTON-PP] No pending installment found")}calculatePendingAmount(e){console.log("[CALC] Schedule:",e),console.log("[CALC] Installments:",e.installments);let t=e.installments.filter(o=>(console.log("[CALC] Installment status:",o.status,"Status value:",o.status?.status),o.status.status==="PENDING"));console.log("[CALC] Pending installments:",t);let n=t.reduce((o,m)=>o+m.amount,0);return console.log("[CALC] Total pending amount:",n),n}getPendingInstallments(e){return e.installments?e.installments.filter(t=>t.status.status==="PENDING").sort((t,n)=>new Date(t.dueDate).getTime()-new Date(n.dueDate).getTime()):[]}onDynamicFieldsChange(e){this.dynamicFieldValues.set(e),e.monto_pagado!==void 0&&e.monto_pagado!==null&&this.calculateAndUpdatePendingBalance(e.monto_pagado)}calculateAndUpdatePendingBalance(e){let t=this.activeSchedules();if(t.length===0){console.log("[SALDO] No hay cronogramas activos");return}let n=t[0],o=this.calculatePendingAmount(n),m=Math.max(0,o-(e||0));if(console.log("[SALDO] Total pendiente:",o),console.log("[SALDO] Monto pagado:",e),console.log("[SALDO] Saldo pendiente calculado:",m),this.dynamicFieldsSchema()?.fields.some(T=>T.id==="saldo_pendiente")){console.log("[SALDO] Actualizando campo saldo_pendiente con:",m);let T={saldo_pendiente:m};this.externalFieldUpdates.set(T);let Y=N({},this.dynamicFieldValues());Y.saldo_pendiente=m,this.dynamicFieldValues.set(Y),setTimeout(()=>this.externalFieldUpdates.set({}),100)}}getDynamicLevelLabel(e){if(e===0){let m=this.hierarchyLevels()[0]||[];if(m.length===0)return"Nivel 1";let h=m.map(C=>C.codigo);return h.includes("RP")||h.includes("CSA")?"Tipo de Resultado":"Categor\xEDa Principal"}let t=e-1,n=this.selectedClassifications()[t];if(!n)return`Nivel ${e+1}`;let o=this.managementClassifications().find(m=>m.id==n);return o?e===1?{RP:"Intenci\xF3n de Pago",CSA:"Motivo de No Atenci\xF3n",SC:"Raz\xF3n de No Contacto",GA:"Tipo de Gesti\xF3n"}[o.codigo]||`Detalle de ${o.label}`:`Detalle de ${o.label}`:`Nivel ${e+1}`}shouldShowLevel(e){if(e===0)return this.usesHierarchicalClassifications();let t=e-1;return this.selectedClassifications()[t]?this.getTypificationsForLevel(e).length>0:!1}showPaymentSection(){return this.managementClassifications().find(t=>t.id===this.managementForm.tipoGestion)?.requiere_pago||!1}showScheduleSection(){return this.managementClassifications().find(t=>t.id===this.managementForm.tipoGestion)?.requiere_cronograma||!1}onInstallmentCountChange(){let e=parseInt(this.scheduleForm.numeroCuotas);if(isNaN(e)||e<1){this.scheduleForm.cuotas=[];return}let t=this.scheduleForm.cuotas.length;if(e>t)for(let n=t+1;n<=e;n++)this.scheduleForm.cuotas.push({numero:n,monto:"",fechaVencimiento:""});else e<t&&(this.scheduleForm.cuotas=this.scheduleForm.cuotas.slice(0,e),this.scheduleForm.cuotas.forEach((n,o)=>{n.numero=o+1}))}generateSchedule(){let e=parseInt(this.scheduleForm.numeroCuotas);if(isNaN(e)||e<1){alert("Por favor ingrese un n\xFAmero v\xE1lido de cuotas");return}this.scheduleForm.cuotas=[];for(let t=1;t<=e;t++)this.scheduleForm.cuotas.push({numero:t,monto:"",fechaVencimiento:""})}addInstallmentRow(){let e=this.scheduleForm.cuotas.length+1;this.scheduleForm.cuotas.push({numero:e,monto:"",fechaVencimiento:""}),this.scheduleForm.numeroCuotas=e.toString()}removeInstallmentRow(e){this.scheduleForm.cuotas.length>1&&(this.scheduleForm.cuotas.splice(e,1),this.scheduleForm.cuotas.forEach((t,n)=>{t.numero=n+1}),this.scheduleForm.numeroCuotas=this.scheduleForm.cuotas.length.toString())}getTodayDate(){let e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}loadMontoNegociadoFromOutput(e){let t=this.customerOutputFields().find(m=>m.id===e);if(!t)return;let n=t.field.split("."),o=this.customerData();for(let m of n)if(o&&typeof o=="object")o=o[m];else{o=null;break}o&&(this.scheduleForm.montoNegociado=o.toString())}toggleScheduleDetail(){this.showScheduleDetail.update(e=>!e)}saveManagement(){if(!this.validateForm())return;this.saving.set(!0);let e,t;if(this.usesHierarchicalClassifications()){let R=this.selectedClassifications(),P=this.managementClassifications(),q=R[R.length-1];if(t=P.find(I=>I.id.toString()===q),t?.parentId){let I=t.parentId;e=P.find(F=>F.id.toString()===I.toString())}else e=t}else e=this.contactClassifications().find(R=>R.id===this.managementForm.resultadoContacto),t=this.managementClassifications().find(R=>R.id===this.managementForm.tipoGestion);let n=this.selectedClassifications(),o=Number(n[0]),m=n[1]?Number(n[1]):null,h=n[2]?Number(n[2]):null,C=this.managementClassifications(),T=C.find(R=>R.id.toString()===n[0]),Y=n[1]?C.find(R=>R.id.toString()===n[1]):null,ae=n[2]?C.find(R=>R.id.toString()===n[2]):null,oe={customerId:String(this.customerData().id),advisorId:"ADV-001",tenantId:this.selectedTenantId,portfolioId:this.selectedPortfolioId||1,subPortfolioId:1,phone:this.customerData().contacto?.telefono_principal||"",level1Id:o,level1Name:T?.label||"",level2Id:m,level2Name:Y?.label||null,level3Id:h,level3Name:ae?.label||null,observations:this.managementForm.observaciones};this.managementService.createManagement(oe).subscribe({next:R=>{this.callStartTime&&this.callActive()&&this.registerCallToBackend(R.id),this.onSaveSuccess(e?.label||"",t?.label||"-")},error:R=>{console.error("Error al guardar gesti\xF3n:",R),this.saving.set(!1),alert("\u26A0\uFE0F Error al guardar la gesti\xF3n. Por favor intente nuevamente.")}})}registerCallToBackend(e){if(!this.callStartTime)return;let t={phoneNumber:this.customerData().contacto.telefono_principal,startTime:this.callStartTime};this.managementService.startCall(e,t).subscribe({next:n=>{if(!this.callActive()){let o={endTime:new Date().toISOString()};this.managementService.endCall(e,o).subscribe({next:()=>{},error:m=>console.error("Error al finalizar llamada:",m)})}},error:n=>{console.error("Error al registrar llamada:",n)}})}registerPaymentToBackend(e){if(!this.managementForm.montoPago||!this.managementForm.metodoPago)return;let t={amount:parseFloat(this.managementForm.montoPago),scheduledDate:new Date().toISOString().split("T")[0],paymentMethodType:this.managementForm.metodoPago,paymentMethodDetails:this.managementForm.ultimos4Tarjeta||void 0,voucherNumber:void 0,bankName:this.managementForm.bancoSeleccionado||void 0};this.managementService.registerPayment(e,t).subscribe({next:n=>{},error:n=>{console.error("Error al registrar pago:",n)}})}createScheduleToBackend(e){if(this.scheduleForm.cuotas.length===0)return;if(this.scheduleForm.cuotas.some(o=>!o.monto||!o.fechaVencimiento)){alert("\u26A0\uFE0F Por favor complete todos los montos y fechas de las cuotas");return}let n={customerId:String(this.customerData().id),managementId:e,scheduleType:this.scheduleForm.tipoCronograma,negotiatedAmount:this.scheduleForm.montoNegociado?parseFloat(this.scheduleForm.montoNegociado):null,installments:this.scheduleForm.cuotas.map(o=>({installmentNumber:o.numero,amount:parseFloat(o.monto),dueDate:o.fechaVencimiento}))};this.paymentScheduleService.createPaymentSchedule(n).subscribe({next:o=>{},error:o=>{console.error("Error al crear cronograma:",o),alert("\u26A0\uFE0F Error al crear el cronograma de pagos")}})}onSaveSuccess(e,t){this.saving.set(!1),this.showSuccess.set(!0),this.loadManagementHistory(),this.managementForm={resultadoContacto:"",tipoGestion:"",clasificacionNivel1:"",clasificacionNivel2:"",clasificacionNivel3:"",motivoNoPago:"",metodoPago:"",montoPago:"",fechaCompromiso:"",horaCompromiso:"",ultimos4Tarjeta:"",bancoSeleccionado:"",observaciones:"",notasPrivadas:""},this.callDuration.set(0),this.callStartTime=void 0,this.activeTab.set("historial"),console.log("\u2705 Gesti\xF3n guardada, cambiando estado a DISPONIBLE..."),this.agentService.changeAgentStatus(1,{estado:Pe.DISPONIBLE}).subscribe({next:()=>{console.log("\u2705 Estado cambiado a DISPONIBLE"),setTimeout(()=>{this.showSuccess.set(!1),console.log("\u{1F504} Navegando a /agent-dashboard..."),this.router.navigate(["/agent-dashboard"])},2e3)},error:o=>{console.error("\u274C Error cambiando estado:",o),setTimeout(()=>{this.showSuccess.set(!1),this.router.navigate(["/agent-dashboard"])},2e3)}})}validateForm(){let e={};if(this.usesHierarchicalClassifications()){let n=this.selectedClassifications();if(n.length===0||!n[n.length-1])e.typification="Debe seleccionar una clasificaci\xF3n";else{let o=n[n.length-1];this.managementClassifications().some(C=>C.parentId&&Number(C.parentId)===Number(o))&&(e.typification="Debe completar todos los niveles de clasificaci\xF3n")}}else this.managementForm.resultadoContacto||(e.resultadoContacto="Requerido"),this.showManagementType()&&!this.managementForm.tipoGestion&&(e.tipoGestion="Requerido");let t=this.dynamicFieldsSchema();if(t&&t.fields&&t.fields.length>0){let n=this.dynamicFieldValues();for(let o of t.fields)if(o.required){let m=n[o.id];(m==null||m==="")&&(e[`dynamic_${o.id}`]=`${o.label} es requerido`),o.type==="table"&&(!Array.isArray(m)||m.length===0)&&(e[`dynamic_${o.id}`]=`${o.label} debe tener al menos una fila`)}}return this.errors.set(e),Object.keys(e).length>0?(alert("Por favor complete todos los campos requeridos"),!1):!0}calculateRemaining(){if(!this.managementForm.montoPago)return"0.00";let e=parseFloat(this.managementForm.montoPago);return(this.customerData().deuda.saldo_total-e).toFixed(2)}toggleDarkMode(){this.themeService.toggleTheme()}getFieldValue(e){let t=this.customerData();return t?e.split(".").reduce((n,o)=>n?.[o],t):null}formatFieldValue(e,t){if(e==null||e==="")return"-";switch(t){case"currency":return"S/ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",");case"number":return String(e);case"date":return typeof e=="string"?new Date(e).toLocaleDateString("es-PE"):String(e);default:return String(e)}}getContactClassificationLabel(e){let t=this.contactClassifications().find(o=>o.id===e);if(!t)return e;let n=t.label||t.codigo;return`[${t.codigo}] ${n}`}getManagementClassificationLabel(e){let t=this.managementClassifications().find(o=>o.id===e);if(!t)return e;let n=t.label||t.codigo;return`[${t.codigo}] ${n}`}getTableRows(e){let t=this.dynamicFieldValues()[e];return Array.isArray(t)?t:[]}addTableRow(e,t){if(!Array.isArray(t)){console.error("addTableRow: columns no es un array v\xE1lido",t);return}let n=N({},this.dynamicFieldValues());Array.isArray(n[e])||(n[e]=[]);let o=this.createEmptyTableRow(t);n[e].push(o),this.dynamicFieldValues.set(n)}removeTableRow(e,t){let n=N({},this.dynamicFieldValues());Array.isArray(n[e])&&(n[e].splice(t,1),this.dynamicFieldValues.set(n))}createEmptyTableRow(e){let t={};return e.forEach(n=>{n.type==="auto-number"?t[n.id]=null:n.type==="number"||n.type==="currency"?t[n.id]=n.defaultValue||0:(n.type,t[n.id]=n.defaultValue||"")}),t}searchByTestDocument(){if(!this.testDocument.trim()||!this.selectedTenantId){console.warn("[TEST] Documento vac\xEDo o tenant no seleccionado");return}console.log("[TEST] Buscando cliente por documento:",this.testDocument),this.customerService.searchCustomersByCriteria(this.selectedTenantId,"documento",this.testDocument).subscribe({next:e=>{e&&e.length>0?(console.log("[TEST] Cliente encontrado:",e[0]),this.loadCustomerFromResource(e[0])):(console.warn("[TEST] No se encontr\xF3 cliente con documento:",this.testDocument),alert("No se encontr\xF3 cliente con el documento: "+this.testDocument))},error:e=>{console.error("[TEST] Error buscando cliente:",e),alert("Error buscando cliente")}})}searchByTestPhone(){if(!this.testPhone.trim()||!this.selectedTenantId){console.warn("[TEST] Tel\xE9fono vac\xEDo o tenant no seleccionado");return}console.log("[TEST] Buscando cliente por tel\xE9fono:",this.testPhone),this.customerService.searchCustomersByCriteria(this.selectedTenantId,"telefono",this.testPhone).subscribe({next:e=>{e&&e.length>0?(console.log("[TEST] Cliente encontrado:",e[0]),this.loadCustomerFromResource(e[0])):(console.warn("[TEST] No se encontr\xF3 cliente con tel\xE9fono:",this.testPhone),alert("No se encontr\xF3 cliente con el tel\xE9fono: "+this.testPhone))},error:e=>{console.error("[TEST] Error buscando cliente:",e),alert("Error buscando cliente")}})}loadCustomerFromResource(e){console.log("[TEST] Cargando cliente:",e),this.customerData.set({id:e.id,id_cliente:e.documentNumber||e.identificationCode,nombre_completo:e.fullName||"",tipo_documento:e.documentType||"DNI",numero_documento:e.documentNumber||"",fecha_nacimiento:e.birthDate||"",edad:e.age||null,contacto:{telefono_principal:e.contactMethods?.find(t=>t.subtype==="telefono_principal")?.value||"",telefono_alternativo:e.contactMethods?.find(t=>t.subtype==="telefono_secundario")?.value||"",telefono_trabajo:e.contactMethods?.find(t=>t.subtype==="telefono_trabajo")?.value||"",email:e.contactMethods?.find(t=>t.contactType==="email")?.value||"",direccion:e.address||""},cuenta:{numero_cuenta:e.accountNumber||"",tipo_producto:"PR\xC9STAMO",fecha_desembolso:"2024-01-15",monto_original:e.principalAmount||0,plazo_meses:12,tasa_interes:2.5},deuda:{saldo_capital:e.principalAmount||0,intereses_vencidos:0,mora_acumulada:e.overdueAmount||0,gastos_cobranza:0,saldo_total:(e.principalAmount||0)+(e.overdueAmount||0),dias_mora:e.overdueDays||0,fecha_ultimo_pago:"",monto_ultimo_pago:0}}),this.loadManagementHistory(),console.log("[TEST] Cliente cargado exitosamente")}hangupCall(){console.log("\u{1F4F5} Colgando llamada..."),this.sipService.hangup()}toggleMute(){this.isMuted()?(console.log("\u{1F50A} Desmuteando..."),this.sipService.unmute(),this.isMuted.set(!1)):(console.log("\u{1F507} Muteando..."),this.sipService.mute(),this.isMuted.set(!0))}isInActiveCall(){return this.callState===ee.ACTIVE}getCallStateText(){switch(this.callState){case ee.IDLE:return"LISTO";case ee.CONNECTING:return"CONECTANDO...";case ee.RINGING:return"TIMBRANDO...";case ee.ACTIVE:return"EN LLAMADA";case ee.ENDED:return"FINALIZADA";default:return"DESCONOCIDO"}}};s.\u0275fac=function(t){return new(t||s)(O(rt),O(lt),O(pe),O(Ze),O(Ke),O(Ie),O(st),O(dt),O(Be),O(G),O(Je),O(ct))},s.\u0275cmp=ie({type:s,selectors:[["app-collection-management"]],viewQuery:function(t,n){if(t&1&&ve(xi,5),t&2){let o;Se(o=we())&&(n.dynamicFieldRenderer=o.first)}},decls:117,vars:42,consts:[["dynamicFieldRendererComponent",""],[1,"h-[100dvh]","bg-gradient-to-br","from-slate-50","via-blue-50","to-slate-100","dark:from-slate-950","dark:via-gray-950","dark:to-black","flex","flex-col","overflow-hidden","transition-colors","duration-300"],[1,"fixed","top-4","right-4","z-50","animate-[slideInRight_0.5s_ease-out]"],[1,"bg-gradient-to-r","from-slate-900","via-blue-900","to-slate-900","dark:from-slate-950","dark:via-blue-950","dark:to-slate-950","text-white","shadow-md","relative","overflow-hidden"],[1,"relative","px-3","py-1"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","gap-1.5"],[1,"bg-blue-500","dark:bg-blue-600","p-1","rounded"],[1,"text-sm","font-bold"],[1,"text-[9px]","text-blue-200","dark:text-blue-300","flex","items-center","gap-0.5"],[1,"h-6","w-px","bg-white/20"],[1,"text-xs"],[1,"text-blue-200","dark:text-blue-300","text-[9px]"],[1,"font-semibold","text-white","text-xs"],[1,"flex","items-center","gap-2"],["title","Cambiar tema",3,"click"],[1,"text-[10px]","text-yellow-300","font-semibold"],[1,"text-[10px]","text-white","font-semibold"],[1,"text-right"],[1,"fixed","top-16","left-4","z-50","flex","items-center","gap-2","bg-yellow-100","dark:bg-yellow-900/40","border-2","border-yellow-500","dark:border-yellow-600","px-3","py-2","rounded-lg","shadow-xl","text-[10px]"],[1,"bg-white","dark:bg-slate-900","border-b","border-blue-400","dark:border-slate-700","shadow-sm","relative","overflow-hidden"],[1,"absolute","inset-0","bg-gradient-to-r","from-blue-50","dark:from-blue-950/50","to-transparent","opacity-50"],[1,"flex","items-center","gap-3","text-xs"],[1,"text-[9px]","text-gray-500","dark:text-white","uppercase","font-semibold","flex","items-center","gap-0.5"],[1,"text-xs","font-bold","text-gray-900","dark:text-white"],[1,"h-6","w-px","bg-gray-200","dark:bg-gray-700"],[1,"text-[9px]","text-gray-500","dark:text-white"],[1,"font-semibold","text-gray-800","dark:text-white","text-[10px]"],[1,"font-semibold","text-gray-800","dark:text-white","font-mono","text-[10px]"],[1,"text-right","bg-red-50","dark:bg-red-950/30","px-2","py-1","rounded","border","border-red-200","dark:border-red-900/50"],[1,"text-[9px]","text-red-600","dark:text-red-200","font-semibold","flex","items-center","justify-end","gap-0.5"],[1,"text-sm","font-bold","text-red-600","dark:text-red-100"],[1,"text-right","bg-orange-50","dark:bg-orange-950/30","px-2","py-1","rounded","border","border-orange-200","dark:border-orange-900/50"],[1,"text-[9px]","text-orange-600","dark:text-orange-200","font-semibold","flex","items-center","justify-end","gap-0.5"],[1,"text-sm","font-bold","text-orange-600","dark:text-orange-100"],[1,"flex-1","flex","overflow-hidden"],[1,"w-80","bg-white","dark:bg-slate-900","border-r","dark:border-slate-800","shadow-lg","overflow-hidden","flex","flex-col","transition-colors","duration-300"],[1,"flex","border-b","dark:border-slate-800","bg-slate-50","dark:bg-slate-950"],[3,"class"],[1,"flex-1","overflow-y-auto","p-2"],[1,"space-y-2"],[1,"flex-1","overflow-y-auto","bg-gradient-to-br","from-gray-50","via-slate-50","to-blue-50","dark:from-slate-900","dark:via-gray-900","dark:to-slate-900","transition-colors","duration-300"],[1,"p-3","space-y-2"],[1,"font-bold","text-gray-800","dark:text-white","flex","items-center","gap-2","text-xs"],[1,"flex","gap-2"],[1,"px-4","py-1.5","bg-gradient-to-r","from-green-600","to-green-700","hover:from-green-700","hover:to-green-800","disabled:from-gray-400","disabled:to-gray-500","text-white","dark:text-white","disabled:text-gray-200","rounded-lg","font-bold","flex","items-center","gap-2","transition-all","duration-300","text-xs","shadow-md","hover:shadow-lg",3,"click","disabled"],[1,"px-4","py-1.5","bg-gradient-to-r","from-red-600","to-red-700","hover:from-red-700","hover:to-red-800","disabled:from-gray-400","disabled:to-gray-500","text-white","dark:text-white","disabled:text-gray-200","rounded-lg","font-bold","flex","items-center","gap-2","transition-all","duration-300","text-xs","shadow-md","hover:shadow-lg",3,"click","disabled"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-md","border","border-gray-200","dark:border-gray-700","p-2","hover:border-blue-300","dark:hover:border-blue-600","transition-colors","duration-300"],[1,"bg-indigo-50","dark:bg-indigo-950/20","border","border-indigo-200","dark:border-indigo-900/50","rounded-lg","shadow-md","p-3"],[1,"bg-gray-50","dark:bg-gray-900/20","border","border-gray-200","dark:border-gray-700","rounded-lg","shadow-md","p-3"],[3,"schema","externalUpdates","selectedClassification"],[1,"bg-purple-50","dark:bg-purple-950/20","border","border-purple-200","dark:border-purple-900/50","rounded-lg","shadow-md","p-3","animate-pulse"],[1,"bg-gradient-to-r","from-purple-50","to-indigo-50","dark:from-purple-950/30","dark:to-indigo-950/30","border-2","border-purple-300","dark:border-purple-700","rounded-lg","shadow-lg","p-3","space-y-2"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-md","border","border-gray-200","dark:border-gray-700","p-2","hover:border-purple-300","dark:hover:border-purple-600","transition-all","duration-300"],[1,"font-bold","text-gray-800","dark:text-white","mb-1","text-[11px]","flex","items-center","gap-1"],["placeholder","Detalles de la conversaci\xF3n...","rows","2",1,"w-full","p-1.5","border","border-gray-300","dark:border-gray-600","rounded","focus:border-purple-500","dark:focus:border-purple-600","focus:outline-none","focus:ring-2","focus:ring-purple-200","dark:focus:ring-purple-900","resize-none","bg-gray-50","dark:bg-gray-900","text-gray-900","dark:text-gray-100","text-xs","placeholder:text-gray-400","dark:placeholder:text-gray-500",3,"ngModelChange","ngModel"],[1,"bg-amber-50","dark:bg-amber-950/30","border","border-amber-300","dark:border-amber-900/50","rounded-lg","p-2"],[1,"block","font-bold","text-gray-800","dark:text-white","mb-1","text-[11px]","flex","items-center","gap-1"],[1,"p-0.5","bg-amber-400","dark:bg-amber-600","rounded"],["placeholder","Notas internas...","rows","2",1,"w-full","p-1.5","border","border-amber-300","dark:border-amber-800","rounded","focus:border-amber-500","dark:focus:border-amber-600","focus:outline-none","focus:ring-2","focus:ring-amber-200","dark:focus:ring-amber-900","resize-none","bg-white","dark:bg-gray-900","text-gray-900","dark:text-gray-100","text-xs","placeholder:text-gray-400","dark:placeholder:text-gray-500",3,"ngModelChange","ngModel"],[1,"flex","gap-2","pt-2"],[1,"flex-1","bg-gradient-to-r","from-blue-600","to-blue-700","hover:from-blue-700","hover:to-blue-800","disabled:from-gray-400","disabled:to-gray-500","text-white","dark:text-white","disabled:text-gray-200","py-2","px-4","rounded-lg","font-bold","text-xs","flex","items-center","justify-center","gap-2","transition-all","duration-300","shadow-lg","hover:shadow-xl","disabled:cursor-not-allowed",3,"click","disabled","title"],[1,"px-6","bg-gradient-to-r","from-gray-400","to-gray-500","hover:from-gray-500","hover:to-gray-600","text-white","dark:text-white","py-2","rounded-lg","font-bold","text-xs","flex","items-center","justify-center","gap-2","transition-all","duration-300","shadow-md","hover:shadow-lg"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","p-4","bg-black/50","backdrop-blur-sm","animate-fadeIn"],[1,"bg-gradient-to-r","from-green-500","to-emerald-600","text-white","px-6","py-4","rounded-lg","shadow-2xl","flex","items-center","gap-3"],[1,"font-bold"],[1,"text-sm","opacity-90"],[1,"text-yellow-800","dark:text-yellow-200","font-bold"],[1,"text-[10px]","font-semibold","text-gray-900","dark:text-white","bg-white","dark:bg-slate-800","border","border-gray-400","dark:border-gray-600","rounded","px-2","py-1","cursor-pointer","shadow-sm",3,"ngModel"],["type","text","placeholder","Documento...",1,"text-[10px]","font-semibold","text-gray-900","bg-white","border-2","border-yellow-500","rounded","px-2","py-1","w-28","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-yellow-400",3,"ngModelChange","keyup.enter","ngModel"],["type","text","placeholder","Tel\xE9fono...",1,"text-[10px]","font-semibold","text-gray-900","bg-white","border-2","border-yellow-500","rounded","px-2","py-1","w-28","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-yellow-400",3,"ngModelChange","keyup.enter","ngModel"],[1,"text-[10px]","font-semibold","text-gray-900","dark:text-white","bg-white","dark:bg-slate-800","border","border-gray-400","dark:border-gray-600","rounded","px-2","py-1","cursor-pointer","shadow-sm",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[3,"click"],[1,"flex","items-center","justify-center","gap-1"],[1,"absolute","bottom-0","left-0","right-0","h-0.5","bg-blue-500"],[1,"grid","grid-cols-4","gap-2"],[1,"rounded-lg","border","p-2","transition-all",3,"col-span-1","col-span-2","col-span-3","col-span-4","bg-cyan-50","dark:bg-cyan-950/30","border-cyan-300","dark:border-cyan-900/50","bg-slate-50","dark:bg-slate-900/50","border-slate-200","dark:border-slate-700"],[1,"text-center","py-4","text-slate-500","dark:text-slate-400","text-xs"],[1,"rounded-lg","border","p-2","transition-all"],[1,"flex","items-start","justify-between","gap-2"],[1,"flex-1","min-w-0"],[1,"text-[9px]","font-bold","uppercase","tracking-wide","mb-0.5","flex","items-center","gap-1"],[1,"text-[11px]","font-bold","break-words"],[1,"text-[10px]","mt-1"],[1,"bg-slate-50","dark:bg-slate-900/50","border","border-slate-200","dark:border-slate-700","rounded-lg","p-2"],[1,"text-[10px]","font-bold","text-slate-800","dark:text-white","mb-1","flex","items-center","gap-1"],[1,"space-y-1","text-[10px]"],[1,"flex","justify-between"],[1,"text-slate-600","dark:text-slate-200"],[1,"font-bold","text-slate-900","dark:text-white"],[1,"bg-red-50","dark:bg-red-950/30","border","border-red-300","dark:border-red-900/50","rounded-lg","p-2"],[1,"text-[10px]","font-bold","text-red-800","dark:text-red-100","mb-1","flex","items-center","gap-1"],[1,"flex","justify-between","bg-white","dark:bg-gray-800/50","rounded","px-1"],[1,"text-red-700","dark:text-red-200"],[1,"font-bold","text-red-900","dark:text-white"],[1,"flex","justify-between","bg-white","rounded","px-1"],[1,"text-red-700"],[1,"font-bold","text-red-900"],[1,"h-px","bg-red-300","my-1"],[1,"flex","justify-between","bg-red-200","rounded","px-1","py-0.5"],[1,"text-center","py-8","space-y-3"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-200"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1"],[1,"text-xs","text-gray-400","dark:text-gray-500","mt-2"],[1,"px-4","py-2","bg-blue-500","hover:bg-blue-600","text-white","text-xs","rounded-lg","transition-colors","flex","items-center","gap-2","mx-auto",3,"click"],[1,"bg-gray-50","dark:bg-gray-800","border","border-gray-200","dark:border-gray-700","rounded-lg","p-2"],[1,"flex","justify-between","items-start","mb-1"],[1,"text-[9px]","font-bold","text-gray-700","dark:text-gray-100","flex","items-center","gap-1"],[1,"text-[9px]","text-gray-500","dark:text-gray-200","bg-gray-200","dark:bg-gray-700","px-1","rounded"],[1,"font-bold","text-blue-700","dark:text-blue-200","bg-blue-50","dark:bg-blue-950/30","px-2","py-0.5","rounded","inline-block"],[1,"font-semibold","text-green-700","dark:text-green-200","bg-green-50","dark:bg-green-950/30","px-2","py-0.5","rounded","inline-block","ml-1"],[1,"text-[9px]","text-gray-600","dark:text-gray-100","italic","mt-1","bg-white","dark:bg-gray-900","p-1","rounded","leading-tight"],[1,"text-[9px]","text-gray-500","dark:text-gray-100"],[1,"mt-2","p-2","bg-purple-50","dark:bg-purple-950/30","border","border-purple-200","dark:border-purple-800","rounded"],[1,"flex","items-center","justify-between","gap-1","mb-1"],[1,"flex","items-center","gap-1"],[1,"text-[9px]","font-bold","text-purple-900","dark:text-purple-200","uppercase"],["type","button",1,"text-[8px]","px-1.5","py-0.5","bg-purple-600","hover:bg-purple-700","text-white","rounded","transition-colors","font-bold",3,"click"],[1,"text-[9px]","text-purple-800","dark:text-purple-300"],[1,"text-[8px]","text-purple-600","dark:text-purple-400","mt-0.5"],[1,"w-1.5","h-1.5","bg-red-500","rounded-full"],[1,"relative"],[3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"text-red-600","text-[10px]","mt-1","flex","items-center","gap-1"],[1,"bg-green-50","dark:bg-green-950/30","rounded-lg","shadow-md","border","border-green-300","dark:border-green-900/50","p-2","mb-2","animate-[fadeIn_0.3s_ease-in]"],[1,"text-red-600","dark:text-red-400","text-[10px]","mt-1","flex","items-center","gap-1"],[1,"flex","items-center","justify-center","gap-2","text-indigo-600","dark:text-indigo-400"],[1,"flex","items-center","justify-center","gap-2","text-gray-500","dark:text-gray-400"],[3,"dataChange","schema","externalUpdates","selectedClassification"],[1,"flex","items-center","justify-center","gap-2","text-purple-600","dark:text-purple-400"],[1,"text-xs","font-semibold"],[1,"p-1.5","bg-purple-500","dark:bg-purple-600","rounded"],[1,"text-xs","font-bold","text-purple-900","dark:text-purple-100"],[1,"text-[9px]","text-purple-600","dark:text-purple-300"],[1,"bg-white","dark:bg-gray-800","rounded-lg","border","border-purple-200","dark:border-purple-700","p-2","space-y-2"],[1,"text-[9px]","px-1.5","py-0.5","bg-green-100","dark:bg-green-900/30","text-green-700","dark:text-green-300","rounded","font-semibold"],[1,"space-y-1"],[1,"text-[9px]","font-bold","text-gray-600","dark:text-gray-300","uppercase"],[1,"text-[9px]","text-center","text-gray-500","dark:text-gray-400","italic"],[1,"flex","gap-2","pt-1"],["type","button",1,"flex-1","px-3","py-1.5","bg-purple-600","hover:bg-purple-700","dark:bg-purple-700","dark:hover:bg-purple-600","text-white","text-[10px]","font-bold","rounded","transition-colors","flex","items-center","justify-center","gap-1"],["type","button",1,"flex-1","px-3","py-1.5","bg-indigo-600","hover:bg-indigo-700","dark:bg-indigo-700","dark:hover:bg-indigo-600","text-white","text-[10px]","font-bold","rounded","transition-colors","flex","items-center","justify-center","gap-1"],[1,"text-[9px]","text-purple-600","dark:text-purple-400","bg-purple-100","dark:bg-purple-900/20","p-1.5","rounded","flex","items-start","gap-1"],[1,"flex","items-center","justify-between","text-[10px]","bg-gray-50","dark:bg-gray-900","p-1.5","rounded"],[1,"font-semibold","text-gray-700","dark:text-gray-300"],[1,"text-gray-500","dark:text-gray-400"],[1,"font-bold","text-purple-700","dark:text-purple-300"],["type","button",1,"flex-1","px-3","py-1.5","bg-purple-600","hover:bg-purple-700","dark:bg-purple-700","dark:hover:bg-purple-600","text-white","text-[10px]","font-bold","rounded","transition-colors","flex","items-center","justify-center","gap-1",3,"click"],["type","button",1,"flex-1","px-3","py-1.5","bg-indigo-600","hover:bg-indigo-700","dark:bg-indigo-700","dark:hover:bg-indigo-600","text-white","text-[10px]","font-bold","rounded","transition-colors","flex","items-center","justify-center","gap-1",3,"click"],[1,"bg-white","dark:bg-slate-900","rounded-xl","shadow-2xl","max-w-6xl","w-full","max-h-[90vh]","overflow-hidden","flex","flex-col","animate-slideInUp"],[1,"bg-gradient-to-r","from-purple-600","to-purple-700","dark:from-purple-700","dark:to-purple-800","text-white","px-6","py-4","flex","items-center","justify-between"],[1,"text-lg","font-bold"],["type","button",1,"p-2","hover:bg-white/20","rounded-lg","transition-colors",3,"click"],[1,"flex-1","overflow-y-auto","p-6"],[3,"managementId"],[1,"px-6","py-4","bg-slate-50","dark:bg-slate-800/50","border-t","border-slate-200","dark:border-slate-700","flex","justify-end"],["type","button",1,"px-4","py-2","text-sm","font-semibold","text-slate-700","dark:text-slate-300","hover:bg-slate-200","dark:hover:bg-slate-700","rounded-lg","transition-colors",3,"click"]],template:function(t,n){t&1&&(l(0,"div",1),p(1,_i,7,0,"div",2),l(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div")(7,"div",7),E(8,"div",8),l(9,"div")(10,"h1",9),c(11,"Gesti\xF3n de Cobranza"),r(),l(12,"p",10),c(13),r()()()(),E(14,"div",11),l(15,"div",12)(16,"div",13),c(17,"Asesor"),r(),l(18,"div",14),c(19,"Mar\xEDa Gonz\xE1lez Castro"),r()()(),l(20,"div",15)(21,"button",16),S("click",function(){return n.toggleDarkMode()}),p(22,bi,2,0,"span",17)(23,Ci,2,0,"span",18),r(),E(24,"div",11),l(25,"div",19)(26,"div",13),c(27,"Estado"),r(),l(28,"div"),c(29),r()(),l(30,"div"),c(31),r()()()()(),p(32,ki,7,4,"div",20),l(33,"div",21),E(34,"div",22),l(35,"div",4)(36,"div",5)(37,"div",23)(38,"div")(39,"div",24),c(40," Cliente "),r(),l(41,"div",25),c(42),r()(),E(43,"div",26),l(44,"div")(45,"div",27),c(46,"Documento"),r(),l(47,"div",28),c(48),r()(),E(49,"div",26),l(50,"div")(51,"div",27),c(52,"ID Cliente"),r(),l(53,"div",29),c(54),r()(),E(55,"div",26),l(56,"div")(57,"div",27),c(58,"Cuenta"),r(),l(59,"div",28),c(60),r()()(),l(61,"div",15)(62,"div",30)(63,"div",31),c(64," Deuda "),r(),l(65,"div",32),c(66),r()(),l(67,"div",33)(68,"div",34),c(69," Mora "),r(),l(70,"div",35),c(71),r()()()()()(),l(72,"div",36)(73,"div",37)(74,"div",38),V(75,Ti,4,4,"button",39,ge),r(),l(77,"div",40)(78,"div"),p(79,Pi,5,1,"div",41),p(80,Ii,60,10,"div",41),p(81,Ri,3,1,"div",41),r()()(),l(82,"div",42)(83,"div",43)(84,"div")(85,"div",5)(86,"h3",44),E(87,"div"),c(88," Control de Llamada "),r(),l(89,"div",45)(90,"button",46),S("click",function(){return n.startCall()}),c(91," Iniciar "),r(),l(92,"button",47),S("click",function(){return n.endCall()}),c(93," Finalizar "),r()()()(),p(94,Oi,11,4,"div",48),p(95,Hi,2,0),p(96,Gi,4,0,"div",49),p(97,zi,4,0,"div",50),p(98,Qi,2,3,"app-dynamic-field-renderer",51),p(99,Yi,4,0,"div",52),p(100,nn,11,1,"div",53),l(101,"div",54)(102,"label",55),c(103," Observaciones "),r(),l(104,"textarea",56),D("ngModelChange",function(m){return k(n.managementForm.observaciones,m)||(n.managementForm.observaciones=m),m}),r()(),l(105,"div",57)(106,"label",58),E(107,"div",59),c(108," Notas Privadas "),r(),l(109,"textarea",60),D("ngModelChange",function(m){return k(n.managementForm.notasPrivadas,m)||(n.managementForm.notasPrivadas=m),m}),r()(),l(110,"div",61)(111,"button",62),S("click",function(){return n.saveManagement()}),p(112,an,1,0)(113,on,1,0),r(),l(114,"button",63),c(115," Cancelar "),r()()()()(),p(116,rn,15,2,"div",64),r()),t&2&&(d(),g(n.showSuccess()?1:-1),d(12),f(" ",n.campaign().nombre," "),d(8),A("flex items-center gap-1.5 px-2 py-1.5 rounded-lg transition-all duration-300 group border "+(n.themeService.isDarkMode()?"bg-yellow-500/20 hover:bg-yellow-500/30 border-yellow-500/40":"bg-blue-500/90 hover:bg-blue-600 border-blue-600")),ye("aria-label",n.themeService.isDarkMode()?"Activar modo claro":"Activar modo oscuro"),d(),g(n.themeService.isDarkMode()?22:23),d(6),A("font-semibold text-xs transition-all duration-300 "+(n.callActive()?"text-green-400 animate-pulse":"text-slate-300 dark:text-slate-200")),d(),f(" ",n.callActive()?"\u25CF EN LLAMADA":"\u25CB DISPONIBLE"," "),d(),A("px-3 py-1 rounded font-mono text-base font-bold transition-all duration-300 "+(n.callActive()?"bg-gradient-to-r from-red-600 to-red-700 animate-pulse":"bg-slate-800/50 dark:bg-gray-900/80")),d(),f(" ",n.formatTime(n.callDuration())," "),d(),g(n.tenants.length>0||n.portfolios.length>0?32:-1),d(10),U(n.customerData().nombre_completo),d(6),xe("",n.customerData().tipo_documento,": ",n.customerData().numero_documento),d(6),U(n.customerData().id_cliente),d(6),U(n.customerData().cuenta.numero_cuenta),d(6),f("S/ ",n.customerData().deuda.saldo_total.toFixed(2)),d(5),U(n.customerData().deuda.dias_mora),d(4),L(n.tabs),d(4),g(n.activeTab()==="cliente"?79:-1),d(),g(n.activeTab()==="cuenta"?80:-1),d(),g(n.activeTab()==="historial"?81:-1),d(3),A("bg-white dark:bg-gray-800 rounded-lg shadow-md border p-2 transition-colors duration-300 "+(n.callActive()?"border-green-400 dark:border-green-500":"border-gray-200 dark:border-gray-700")),d(3),A("p-1 rounded transition-all duration-300 "+(n.callActive()?"bg-green-100 dark:bg-green-900/30 animate-pulse":"bg-blue-100 dark:bg-blue-900/30")),d(3),v("disabled",n.callActive()),d(2),v("disabled",!n.callActive()),d(2),g(n.usesHierarchicalClassifications()?-1:94),d(),g(n.usesHierarchicalClassifications()?95:-1),d(),g(n.isLoadingDynamicFields()?96:-1),d(),g(!n.isLoadingDynamicFields()&&n.isLeafClassification()&&n.dynamicFields().length===0?97:-1),d(),g(!n.isLoadingDynamicFields()&&n.isLeafClassification()&&n.dynamicFieldsSchema()?98:-1),d(),g(n.isLoadingSchedules()?99:-1),d(),g(!n.isLoadingSchedules()&&n.showScheduleHelper()&&n.activeSchedules().length>0?100:-1),d(4),w("ngModel",n.managementForm.observaciones),d(5),w("ngModel",n.managementForm.notasPrivadas),d(2),v("disabled",n.saving()||!n.isFormValid())("title","Guardando: "+n.saving()+" | V\xE1lido: "+n.isFormValid()),d(),g(n.saving()?112:113),d(4),g(n.showScheduleDetail()&&n.scheduleManagementId()?116:-1))},dependencies:[ne,Ue,me,Fe,Me,de,Te,ce,ue,et,at,se],styles:["@keyframes _ngcontent-%COMP%_slideInRight{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}"]});let a=s;return a})();export{ea as CollectionManagementPage};
