import{Ea as Mt,Q as ml,d as B,e as Nu,f as ct}from"./chunk-G7UR4G7J.js";var jr=B((Id,ku)=>{ku.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"3.10.1",homepage:"https://jssip.net",contributors:["Jos\xE9 Luis Mill\xE1n <jmillan@aliax.net> (https://github.com/jmillan)","I\xF1aki Baz Castillo <ibc@aliax.net> (https://inakibaz.me)"],types:"lib/JsSIP.d.ts",main:"lib-es5/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{"@types/events":"^3.0.0","@types/debug":"^4.1.7",debug:"^4.3.1",events:"^3.3.0","sdp-transform":"^2.14.1"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","ansi-colors":"^3.2.4",browserify:"^16.5.1",eslint:"^5.16.0","fancy-log":"^1.3.3",gulp:"^4.0.2","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.2","gulp-header":"^2.0.9","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.1","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4",pegjs:"^0.7.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},scripts:{lint:"node npm-scripts.js lint",test:"node npm-scripts.js test",prepublish:"node npm-scripts.js prepublish",release:"node npm-scripts.js release"}}});var ae=B((Od,Tl)=>{"use strict";var yl=jr();Tl.exports={USER_AGENT:"".concat(yl.title," ").concat(yl.version),SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",DTMF_TRANSPORT:{INFO:"INFO",RFC2833:"RFC2833"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60,CONNECTION_RECOVERY_MAX_INTERVAL:30,CONNECTION_RECOVERY_MIN_INTERVAL:2}});var qe=B((Nd,Cl)=>{"use strict";function Cn(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cn=function(i){return typeof i}:Cn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Cn(a)}function bn(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function An(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&Ft(a,o)}function Rn(a){var o=Sl();return function(){var n=Ht(a),s;if(o){var c=Ht(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return Du(this,s)}}function Du(a,o){return o&&(Cn(o)==="object"||typeof o=="function")?o:xu(a)}function xu(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function ht(a){var o=typeof Map=="function"?new Map:void 0;return ht=function(n){if(n===null||!Pu(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof o<"u"){if(o.has(n))return o.get(n);o.set(n,s)}function s(){return En(n,arguments,Ht(this).constructor)}return s.prototype=Object.create(n.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),Ft(s,n)},ht(a)}function En(a,o,i){return Sl()?En=Reflect.construct:En=function(s,c,t){var u=[null];u.push.apply(u,c);var p=Function.bind.apply(s,u),g=new p;return t&&Ft(g,t.prototype),g},En.apply(null,arguments)}function Sl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Pu(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function Ft(a,o){return Ft=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},Ft(a,o)}function Ht(a){return Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Ht(a)}var Uu=(function(a){An(i,a);var o=Rn(i);function i(n,s){var c;return bn(this,i),c=o.call(this),c.code=1,c.name="CONFIGURATION_ERROR",c.parameter=n,c.value=s,c.message=c.value?"Invalid value ".concat(JSON.stringify(c.value),' for parameter "').concat(c.parameter,'"'):"Missing parameter: ".concat(c.parameter),c}return i})(ht(Error)),Mu=(function(a){An(i,a);var o=Rn(i);function i(n){var s;return bn(this,i),s=o.call(this),s.code=2,s.name="INVALID_STATE_ERROR",s.status=n,s.message="Invalid status: ".concat(n),s}return i})(ht(Error)),Fu=(function(a){An(i,a);var o=Rn(i);function i(n){var s;return bn(this,i),s=o.call(this),s.code=3,s.name="NOT_SUPPORTED_ERROR",s.message=n,s}return i})(ht(Error)),Hu=(function(a){An(i,a);var o=Rn(i);function i(n){var s;return bn(this,i),s=o.call(this),s.code=4,s.name="NOT_READY_ERROR",s.message=n,s}return i})(ht(Error));Cl.exports={ConfigurationError:Uu,InvalidStateError:Mu,NotSupportedError:Fu,NotReadyError:Hu}});var wn=B((kd,Al)=>{"use strict";function Lu(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function El(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function bl(a,o,i){return o&&El(a.prototype,o),i&&El(a,i),a}var qu=je(),ju=Oe();Al.exports=(function(){bl(a,null,[{key:"parse",value:function(i){if(i=ju.parse(i,"Name_Addr_Header"),i!==-1)return i}}]);function a(o,i,n){if(Lu(this,a),!o||!(o instanceof qu))throw new TypeError('missing or invalid "uri" parameter');this._uri=o,this._parameters={},this.display_name=i;for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&this.setParam(s,n[s])}return bl(a,[{key:"setParam",value:function(i,n){i&&(this._parameters[i.toLowerCase()]=typeof n>"u"||n===null?null:n.toString())}},{key:"getParam",value:function(i){if(i)return this._parameters[i.toLowerCase()]}},{key:"hasParam",value:function(i){if(i)return this._parameters.hasOwnProperty(i.toLowerCase())&&!0||!1}},{key:"deleteParam",value:function(i){if(i=i.toLowerCase(),this._parameters.hasOwnProperty(i)){var n=this._parameters[i];return delete this._parameters[i],n}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"clone",value:function(){return new a(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}},{key:"_quote",value:function(i){return i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}},{key:"toString",value:function(){var i=this._display_name?'"'.concat(this._quote(this._display_name),'" '):"";i+="<".concat(this._uri.toString(),">");for(var n in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,n)&&(i+=";".concat(n),this._parameters[n]!==null&&(i+="=".concat(this._parameters[n])));return i}},{key:"uri",get:function(){return this._uri}},{key:"display_name",get:function(){return this._display_name},set:function(i){this._display_name=i===0?"0":i}}]),a})()});var Oe=B((Dd,Rl)=>{"use strict";Rl.exports=(function(){function a(i){return'"'+i.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var o={parse:function(n,s){var c={CRLF:A,DIGIT:m,ALPHA:C,HEXDIG:x,WSP:L,OCTET:K,DQUOTE:Q,SP:R,HTAB:k,alphanum:w,reserved:D,unreserved:J,mark:he,escaped:ee,LWS:ie,SWS:Y,HCOLON:X,TEXT_UTF8_TRIM:we,TEXT_UTF8char:me,UTF8_NONASCII:Ie,UTF8_CONT:ke,LHEX:at,token:G,token_nodot:He,separators:ot,word:De,STAR:Je,SLASH:ut,EQUAL:M,LPAREN:W,RPAREN:z,RAQUOT:$,LAQUOT:le,COMMA:V,SEMI:q,COLON:Xe,LDQUOT:Se,RDQUOT:dr,comment:_r,ctext:pr,quoted_string:rn,quoted_string_clean:bt,qdtext:At,quoted_pair:Qe,SIP_URI_noparams:Rt,SIP_URI:sn,uri_scheme:vr,uri_scheme_sips:Ni,uri_scheme_sip:ki,userinfo:ln,user:Di,user_unreserved:gr,password:xi,hostport:an,host:wt,hostname:mr,domainlabel:yr,toplabel:Pi,IPv6reference:Tr,IPv6address:Sr,h16:F,ls32:Ce,IPv4address:It,dec_octet:Ot,port:Ui,uri_parameters:Mi,uri_parameter:Cr,transport_param:Fi,user_param:Hi,method_param:Li,ttl_param:qi,maddr_param:ji,lr_param:Gi,other_param:Wi,pname:Bi,pvalue:Vi,paramchar:Nt,param_unreserved:zi,headers:Ki,header:on,hname:$i,hvalue:Yi,hnv_unreserved:kt,Request_Response:zo,Request_Line:Ji,Request_URI:Xi,absoluteURI:Er,hier_part:Qi,net_path:Zi,abs_path:un,opaque_part:es,uric:Dt,uric_no_slash:ts,path_segments:ns,segment:fn,param:br,pchar:xt,scheme:rs,authority:is,srvr:ss,reg_name:ls,query:as,SIP_Version:Ar,INVITEm:os,ACKm:us,OPTIONSm:fs,BYEm:cs,CANCELm:hs,REGISTERm:ds,SUBSCRIBEm:_s,NOTIFYm:ps,REFERm:vs,Method:cn,Status_Line:gs,Status_Code:ms,extension_code:ys,Reason_Phrase:Ts,Allow_Events:Ko,Call_ID:$o,Contact:Yo,contact_param:hn,name_addr:Ze,display_name:dn,contact_params:Rr,c_p_q:Ss,c_p_expires:Cs,delta_seconds:et,qvalue:Es,generic_param:oe,gen_value:bs,Content_Disposition:Jo,disp_type:As,disp_param:wr,handling_param:Rs,Content_Encoding:Xo,Content_Length:Qo,Content_Type:Zo,media_type:ws,m_type:Is,discrete_type:Os,composite_type:Ns,extension_token:_n,x_token:ks,m_subtype:Ds,m_parameter:Ir,m_value:xs,CSeq:eu,CSeq_value:Ps,Expires:tu,Event:nu,event_type:Pt,From:ru,from_param:Or,tag_param:Nr,Max_Forwards:iu,Min_Expires:su,Name_Addr_Header:lu,Proxy_Authenticate:au,challenge:kr,other_challenge:Us,auth_param:Ut,digest_cln:pn,realm:Ms,realm_value:Fs,domain:Hs,URI:vn,nonce:Ls,nonce_value:qs,opaque:js,stale:Gs,algorithm:Ws,qop_options:Bs,qop_value:gn,Proxy_Require:ou,Record_Route:uu,rec_route:mn,Reason:fu,reason_param:Dr,reason_cause:Vs,Require:cu,Route:hu,route_param:yn,Subscription_State:du,substate_value:zs,subexp_params:xr,event_reason_value:Ks,Subject:_u,Supported:pu,To:vu,to_param:Pr,Via:gu,via_param:Tn,via_params:Ur,via_ttl:$s,via_maddr:Ys,via_received:Js,via_branch:Xs,response_port:Qs,rport:Zs,sent_protocol:el,protocol_name:tl,transport:nl,sent_by:rl,via_host:il,via_port:sl,ttl:Mr,WWW_Authenticate:mu,Session_Expires:yu,s_e_expires:ll,s_e_params:Fr,s_e_refresher:al,extension_header:Tu,header_value:ol,message_body:Su,uuid_URI:Cu,uuid:ul,hex4:Le,hex8:fl,hex12:cl,Refer_To:Eu,Replaces:bu,call_id:hl,replaces_param:Hr,to_tag:dl,from_tag:_l,early_flag:pl};if(s!==void 0){if(c[s]===void 0)throw new Error("Invalid rule name: "+a(s)+".")}else s="CRLF";var t=0,u=0,p=0,g=[];function y(e,r,l){for(var f=e,d=l-e.length,_=0;_<d;_++)f=r+f;return f}function S(e){var r=e.charCodeAt(0),l,f;return r<=255?(l="x",f=2):(l="u",f=4),"\\"+l+y(r.toString(16).toUpperCase(),"0",f)}function h(e){t<p||(t>p&&(p=t,g=[]),g.push(e))}function A(){var e;return n.substr(t,2)===`\r
`?(e=`\r
`,t+=2):(e=null,u===0&&h('"\\r\\n"')),e}function m(){var e;return/^[0-9]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[0-9]")),e}function C(){var e;return/^[a-zA-Z]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[a-zA-Z]")),e}function x(){var e;return/^[0-9a-fA-F]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[0-9a-fA-F]")),e}function L(){var e;return e=R(),e===null&&(e=k()),e}function K(){var e;return/^[\0-\xFF]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[\\0-\\xFF]")),e}function Q(){var e;return/^["]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h('["]')),e}function R(){var e;return n.charCodeAt(t)===32?(e=" ",t++):(e=null,u===0&&h('" "')),e}function k(){var e;return n.charCodeAt(t)===9?(e="	",t++):(e=null,u===0&&h('"\\t"')),e}function w(){var e;return/^[a-zA-Z0-9]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[a-zA-Z0-9]")),e}function D(){var e;return n.charCodeAt(t)===59?(e=";",t++):(e=null,u===0&&h('";"')),e===null&&(n.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&h('"/"')),e===null&&(n.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&h('"?"')),e===null&&(n.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&h('":"')),e===null&&(n.charCodeAt(t)===64?(e="@",t++):(e=null,u===0&&h('"@"')),e===null&&(n.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&h('"&"')),e===null&&(n.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&h('"="')),e===null&&(n.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&h('"+"')),e===null&&(n.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&h('"$"')),e===null&&(n.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&h('","'))))))))))),e}function J(){var e;return e=w(),e===null&&(e=he()),e}function he(){var e;return n.charCodeAt(t)===45?(e="-",t++):(e=null,u===0&&h('"-"')),e===null&&(n.charCodeAt(t)===95?(e="_",t++):(e=null,u===0&&h('"_"')),e===null&&(n.charCodeAt(t)===46?(e=".",t++):(e=null,u===0&&h('"."')),e===null&&(n.charCodeAt(t)===33?(e="!",t++):(e=null,u===0&&h('"!"')),e===null&&(n.charCodeAt(t)===126?(e="~",t++):(e=null,u===0&&h('"~"')),e===null&&(n.charCodeAt(t)===42?(e="*",t++):(e=null,u===0&&h('"*"')),e===null&&(n.charCodeAt(t)===39?(e="'",t++):(e=null,u===0&&h(`"'"`)),e===null&&(n.charCodeAt(t)===40?(e="(",t++):(e=null,u===0&&h('"("')),e===null&&(n.charCodeAt(t)===41?(e=")",t++):(e=null,u===0&&h('")"')))))))))),e}function ee(){var e,r,l,f,d;return f=t,d=t,n.charCodeAt(t)===37?(e="%",t++):(e=null,u===0&&h('"%"')),e!==null?(r=x(),r!==null?(l=x(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){return v.join("")})(f,e)),e===null&&(t=f),e}function ie(){var e,r,l,f,d,_;for(f=t,d=t,_=t,e=[],r=L();r!==null;)e.push(r),r=L();if(e!==null?(r=A(),r!==null?e=[e,r]:(e=null,t=_)):(e=null,t=_),e=e!==null?e:"",e!==null){if(l=L(),l!==null)for(r=[];l!==null;)r.push(l),l=L();else r=null;r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(v){return" "})(f)),e===null&&(t=f),e}function Y(){var e;return e=ie(),e=e!==null?e:"",e}function X(){var e,r,l,f,d;for(f=t,d=t,e=[],r=R(),r===null&&(r=k());r!==null;)e.push(r),r=R(),r===null&&(r=k());return e!==null?(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=Y(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return":"})(f)),e===null&&(t=f),e}function we(){var e,r,l,f,d,_,v;if(d=t,_=t,r=me(),r!==null)for(e=[];r!==null;)e.push(r),r=me();else e=null;if(e!==null){for(r=[],v=t,l=[],f=ie();f!==null;)l.push(f),f=ie();for(l!==null?(f=me(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;){for(r.push(l),v=t,l=[],f=ie();f!==null;)l.push(f),f=ie();l!==null?(f=me(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v)}r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E){return n.substring(t,E)})(d)),e===null&&(t=d),e}function me(){var e;return/^[!-~]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[!-~]")),e===null&&(e=Ie()),e}function Ie(){var e;return/^[\x80-\uFFFF]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[\\x80-\\uFFFF]")),e}function ke(){var e;return/^[\x80-\xBF]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[\\x80-\\xBF]")),e}function at(){var e;return e=m(),e===null&&(/^[a-f]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[a-f]"))),e}function G(){var e,r,l;if(l=t,r=w(),r===null&&(n.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&h('"-"')),r===null&&(n.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&h('"."')),r===null&&(n.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&h('"!"')),r===null&&(n.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&h('"%"')),r===null&&(n.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&h('"*"')),r===null&&(n.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&h('"_"')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"')),r===null&&(n.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&h('"`"')),r===null&&(n.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&h(`"'"`)),r===null&&(n.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&h('"~"')))))))))))),r!==null)for(e=[];r!==null;)e.push(r),r=w(),r===null&&(n.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&h('"-"')),r===null&&(n.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&h('"."')),r===null&&(n.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&h('"!"')),r===null&&(n.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&h('"%"')),r===null&&(n.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&h('"*"')),r===null&&(n.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&h('"_"')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"')),r===null&&(n.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&h('"`"')),r===null&&(n.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&h(`"'"`)),r===null&&(n.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&h('"~"'))))))))))));else e=null;return e!==null&&(e=(function(f){return n.substring(t,f)})(l)),e===null&&(t=l),e}function He(){var e,r,l;if(l=t,r=w(),r===null&&(n.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&h('"-"')),r===null&&(n.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&h('"!"')),r===null&&(n.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&h('"%"')),r===null&&(n.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&h('"*"')),r===null&&(n.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&h('"_"')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"')),r===null&&(n.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&h('"`"')),r===null&&(n.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&h(`"'"`)),r===null&&(n.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&h('"~"'))))))))))),r!==null)for(e=[];r!==null;)e.push(r),r=w(),r===null&&(n.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&h('"-"')),r===null&&(n.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&h('"!"')),r===null&&(n.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&h('"%"')),r===null&&(n.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&h('"*"')),r===null&&(n.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&h('"_"')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"')),r===null&&(n.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&h('"`"')),r===null&&(n.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&h(`"'"`)),r===null&&(n.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&h('"~"')))))))))));else e=null;return e!==null&&(e=(function(f){return n.substring(t,f)})(l)),e===null&&(t=l),e}function ot(){var e;return n.charCodeAt(t)===40?(e="(",t++):(e=null,u===0&&h('"("')),e===null&&(n.charCodeAt(t)===41?(e=")",t++):(e=null,u===0&&h('")"')),e===null&&(n.charCodeAt(t)===60?(e="<",t++):(e=null,u===0&&h('"<"')),e===null&&(n.charCodeAt(t)===62?(e=">",t++):(e=null,u===0&&h('">"')),e===null&&(n.charCodeAt(t)===64?(e="@",t++):(e=null,u===0&&h('"@"')),e===null&&(n.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&h('","')),e===null&&(n.charCodeAt(t)===59?(e=";",t++):(e=null,u===0&&h('";"')),e===null&&(n.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&h('":"')),e===null&&(n.charCodeAt(t)===92?(e="\\",t++):(e=null,u===0&&h('"\\\\"')),e===null&&(e=Q(),e===null&&(n.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&h('"/"')),e===null&&(n.charCodeAt(t)===91?(e="[",t++):(e=null,u===0&&h('"["')),e===null&&(n.charCodeAt(t)===93?(e="]",t++):(e=null,u===0&&h('"]"')),e===null&&(n.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&h('"?"')),e===null&&(n.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&h('"="')),e===null&&(n.charCodeAt(t)===123?(e="{",t++):(e=null,u===0&&h('"{"')),e===null&&(n.charCodeAt(t)===125?(e="}",t++):(e=null,u===0&&h('"}"')),e===null&&(e=R(),e===null&&(e=k())))))))))))))))))),e}function De(){var e,r,l;if(l=t,r=w(),r===null&&(n.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&h('"-"')),r===null&&(n.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&h('"."')),r===null&&(n.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&h('"!"')),r===null&&(n.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&h('"%"')),r===null&&(n.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&h('"*"')),r===null&&(n.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&h('"_"')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"')),r===null&&(n.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&h('"`"')),r===null&&(n.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&h(`"'"`)),r===null&&(n.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&h('"~"')),r===null&&(n.charCodeAt(t)===40?(r="(",t++):(r=null,u===0&&h('"("')),r===null&&(n.charCodeAt(t)===41?(r=")",t++):(r=null,u===0&&h('")"')),r===null&&(n.charCodeAt(t)===60?(r="<",t++):(r=null,u===0&&h('"<"')),r===null&&(n.charCodeAt(t)===62?(r=">",t++):(r=null,u===0&&h('">"')),r===null&&(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r===null&&(n.charCodeAt(t)===92?(r="\\",t++):(r=null,u===0&&h('"\\\\"')),r===null&&(r=Q(),r===null&&(n.charCodeAt(t)===47?(r="/",t++):(r=null,u===0&&h('"/"')),r===null&&(n.charCodeAt(t)===91?(r="[",t++):(r=null,u===0&&h('"["')),r===null&&(n.charCodeAt(t)===93?(r="]",t++):(r=null,u===0&&h('"]"')),r===null&&(n.charCodeAt(t)===63?(r="?",t++):(r=null,u===0&&h('"?"')),r===null&&(n.charCodeAt(t)===123?(r="{",t++):(r=null,u===0&&h('"{"')),r===null&&(n.charCodeAt(t)===125?(r="}",t++):(r=null,u===0&&h('"}"'))))))))))))))))))))))))),r!==null)for(e=[];r!==null;)e.push(r),r=w(),r===null&&(n.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&h('"-"')),r===null&&(n.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&h('"."')),r===null&&(n.charCodeAt(t)===33?(r="!",t++):(r=null,u===0&&h('"!"')),r===null&&(n.charCodeAt(t)===37?(r="%",t++):(r=null,u===0&&h('"%"')),r===null&&(n.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&h('"*"')),r===null&&(n.charCodeAt(t)===95?(r="_",t++):(r=null,u===0&&h('"_"')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"')),r===null&&(n.charCodeAt(t)===96?(r="`",t++):(r=null,u===0&&h('"`"')),r===null&&(n.charCodeAt(t)===39?(r="'",t++):(r=null,u===0&&h(`"'"`)),r===null&&(n.charCodeAt(t)===126?(r="~",t++):(r=null,u===0&&h('"~"')),r===null&&(n.charCodeAt(t)===40?(r="(",t++):(r=null,u===0&&h('"("')),r===null&&(n.charCodeAt(t)===41?(r=")",t++):(r=null,u===0&&h('")"')),r===null&&(n.charCodeAt(t)===60?(r="<",t++):(r=null,u===0&&h('"<"')),r===null&&(n.charCodeAt(t)===62?(r=">",t++):(r=null,u===0&&h('">"')),r===null&&(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r===null&&(n.charCodeAt(t)===92?(r="\\",t++):(r=null,u===0&&h('"\\\\"')),r===null&&(r=Q(),r===null&&(n.charCodeAt(t)===47?(r="/",t++):(r=null,u===0&&h('"/"')),r===null&&(n.charCodeAt(t)===91?(r="[",t++):(r=null,u===0&&h('"["')),r===null&&(n.charCodeAt(t)===93?(r="]",t++):(r=null,u===0&&h('"]"')),r===null&&(n.charCodeAt(t)===63?(r="?",t++):(r=null,u===0&&h('"?"')),r===null&&(n.charCodeAt(t)===123?(r="{",t++):(r=null,u===0&&h('"{"')),r===null&&(n.charCodeAt(t)===125?(r="}",t++):(r=null,u===0&&h('"}"')))))))))))))))))))))))));else e=null;return e!==null&&(e=(function(f){return n.substring(t,f)})(l)),e===null&&(t=l),e}function Je(){var e,r,l,f,d;return f=t,d=t,e=Y(),e!==null?(n.charCodeAt(t)===42?(r="*",t++):(r=null,u===0&&h('"*"')),r!==null?(l=Y(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return"*"})(f)),e===null&&(t=f),e}function ut(){var e,r,l,f,d;return f=t,d=t,e=Y(),e!==null?(n.charCodeAt(t)===47?(r="/",t++):(r=null,u===0&&h('"/"')),r!==null?(l=Y(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return"/"})(f)),e===null&&(t=f),e}function M(){var e,r,l,f,d;return f=t,d=t,e=Y(),e!==null?(n.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&h('"="')),r!==null?(l=Y(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return"="})(f)),e===null&&(t=f),e}function W(){var e,r,l,f,d;return f=t,d=t,e=Y(),e!==null?(n.charCodeAt(t)===40?(r="(",t++):(r=null,u===0&&h('"("')),r!==null?(l=Y(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return"("})(f)),e===null&&(t=f),e}function z(){var e,r,l,f,d;return f=t,d=t,e=Y(),e!==null?(n.charCodeAt(t)===41?(r=")",t++):(r=null,u===0&&h('")"')),r!==null?(l=Y(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return")"})(f)),e===null&&(t=f),e}function $(){var e,r,l,f;return l=t,f=t,n.charCodeAt(t)===62?(e=">",t++):(e=null,u===0&&h('">"')),e!==null?(r=Y(),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e!==null&&(e=(function(d){return">"})(l)),e===null&&(t=l),e}function le(){var e,r,l,f;return l=t,f=t,e=Y(),e!==null?(n.charCodeAt(t)===60?(r="<",t++):(r=null,u===0&&h('"<"')),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e!==null&&(e=(function(d){return"<"})(l)),e===null&&(t=l),e}function V(){var e,r,l,f,d;return f=t,d=t,e=Y(),e!==null?(n.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&h('","')),r!==null?(l=Y(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return","})(f)),e===null&&(t=f),e}function q(){var e,r,l,f,d;return f=t,d=t,e=Y(),e!==null?(n.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&h('";"')),r!==null?(l=Y(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return";"})(f)),e===null&&(t=f),e}function Xe(){var e,r,l,f,d;return f=t,d=t,e=Y(),e!==null?(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=Y(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return":"})(f)),e===null&&(t=f),e}function Se(){var e,r,l,f;return l=t,f=t,e=Y(),e!==null?(r=Q(),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e!==null&&(e=(function(d){return'"'})(l)),e===null&&(t=l),e}function dr(){var e,r,l,f;return l=t,f=t,e=Q(),e!==null?(r=Y(),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e!==null&&(e=(function(d){return'"'})(l)),e===null&&(t=l),e}function _r(){var e,r,l,f;if(f=t,e=W(),e!==null){for(r=[],l=pr(),l===null&&(l=Qe(),l===null&&(l=_r()));l!==null;)r.push(l),l=pr(),l===null&&(l=Qe(),l===null&&(l=_r()));r!==null?(l=z(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)}else e=null,t=f;return e}function pr(){var e;return/^[!-']/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[!-']")),e===null&&(/^[*-[]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[*-[]")),e===null&&(/^[\]-~]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[\\]-~]")),e===null&&(e=Ie(),e===null&&(e=ie())))),e}function rn(){var e,r,l,f,d,_;if(d=t,_=t,e=Y(),e!==null)if(r=Q(),r!==null){for(l=[],f=At(),f===null&&(f=Qe());f!==null;)l.push(f),f=At(),f===null&&(f=Qe());l!==null?(f=Q(),f!==null?e=[e,r,l,f]:(e=null,t=_)):(e=null,t=_)}else e=null,t=_;else e=null,t=_;return e!==null&&(e=(function(v){return n.substring(t,v)})(d)),e===null&&(t=d),e}function bt(){var e,r,l,f,d,_;if(d=t,_=t,e=Y(),e!==null)if(r=Q(),r!==null){for(l=[],f=At(),f===null&&(f=Qe());f!==null;)l.push(f),f=At(),f===null&&(f=Qe());l!==null?(f=Q(),f!==null?e=[e,r,l,f]:(e=null,t=_)):(e=null,t=_)}else e=null,t=_;else e=null,t=_;return e!==null&&(e=(function(v){var E=n.substring(t,v).trim();return E.substring(1,E.length-1).replace(/\\([\x00-\x09\x0b-\x0c\x0e-\x7f])/g,"$1")})(d)),e===null&&(t=d),e}function At(){var e;return e=ie(),e===null&&(n.charCodeAt(t)===33?(e="!",t++):(e=null,u===0&&h('"!"')),e===null&&(/^[#-[]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[#-[]")),e===null&&(/^[\]-~]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[\\]-~]")),e===null&&(e=Ie())))),e}function Qe(){var e,r,l;return l=t,n.charCodeAt(t)===92?(e="\\",t++):(e=null,u===0&&h('"\\\\"')),e!==null?(/^[\0-\t]/.test(n.charAt(t))?(r=n.charAt(t),t++):(r=null,u===0&&h("[\\0-\\t]")),r===null&&(/^[\x0B-\f]/.test(n.charAt(t))?(r=n.charAt(t),t++):(r=null,u===0&&h("[\\x0B-\\f]")),r===null&&(/^[\x0E-]/.test(n.charAt(t))?(r=n.charAt(t),t++):(r=null,u===0&&h("[\\x0E-\x7F]")))),r!==null?e=[e,r]:(e=null,t=l)):(e=null,t=l),e}function Rt(){var e,r,l,f,d,_;return d=t,_=t,e=vr(),e!==null?(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=ln(),l=l!==null?l:"",l!==null?(f=an(),f!==null?e=[e,r,l,f]:(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_),e!==null&&(e=(function(v){try{T.uri=new vl(T.scheme,T.user,T.host,T.port),delete T.scheme,delete T.user,delete T.host,delete T.host_type,delete T.port}catch{T=-1}})(d)),e===null&&(t=d),e}function sn(){var e,r,l,f,d,_,v,E;return v=t,E=t,e=vr(),e!==null?(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=ln(),l=l!==null?l:"",l!==null?(f=an(),f!==null?(d=Mi(),d!==null?(_=Ki(),_=_!==null?_:"",_!==null?e=[e,r,l,f,d,_]:(e=null,t=E)):(e=null,t=E)):(e=null,t=E)):(e=null,t=E)):(e=null,t=E)):(e=null,t=E),e!==null&&(e=(function(O){var j;try{T.uri=new vl(T.scheme,T.user,T.host,T.port,T.uri_params,T.uri_headers),delete T.scheme,delete T.user,delete T.host,delete T.host_type,delete T.port,delete T.uri_params,s==="SIP_URI"&&(T=T.uri)}catch{T=-1}})(v)),e===null&&(t=v),e}function vr(){var e;return e=Ni(),e===null&&(e=ki()),e}function Ni(){var e,r;return r=t,n.substr(t,4).toLowerCase()==="sips"?(e=n.substr(t,4),t+=4):(e=null,u===0&&h('"sips"')),e!==null&&(e=(function(l,f){T.scheme=f.toLowerCase()})(r,e)),e===null&&(t=r),e}function ki(){var e,r;return r=t,n.substr(t,3).toLowerCase()==="sip"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"sip"')),e!==null&&(e=(function(l,f){T.scheme=f.toLowerCase()})(r,e)),e===null&&(t=r),e}function ln(){var e,r,l,f,d,_;return f=t,d=t,e=Di(),e!==null?(_=t,n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=xi(),l!==null?r=[r,l]:(r=null,t=_)):(r=null,t=_),r=r!==null?r:"",r!==null?(n.charCodeAt(t)===64?(l="@",t++):(l=null,u===0&&h('"@"')),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(v){T.user=decodeURIComponent(n.substring(t-1,v))})(f)),e===null&&(t=f),e}function Di(){var e,r;if(r=J(),r===null&&(r=ee(),r===null&&(r=gr())),r!==null)for(e=[];r!==null;)e.push(r),r=J(),r===null&&(r=ee(),r===null&&(r=gr()));else e=null;return e}function gr(){var e;return n.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&h('"&"')),e===null&&(n.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&h('"="')),e===null&&(n.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&h('"+"')),e===null&&(n.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&h('"$"')),e===null&&(n.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&h('","')),e===null&&(n.charCodeAt(t)===59?(e=";",t++):(e=null,u===0&&h('";"')),e===null&&(n.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&h('"?"')),e===null&&(n.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&h('"/"'))))))))),e}function xi(){var e,r,l;for(l=t,e=[],r=J(),r===null&&(r=ee(),r===null&&(n.charCodeAt(t)===38?(r="&",t++):(r=null,u===0&&h('"&"')),r===null&&(n.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&h('"="')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"')),r===null&&(n.charCodeAt(t)===36?(r="$",t++):(r=null,u===0&&h('"$"')),r===null&&(n.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&h('","'))))))));r!==null;)e.push(r),r=J(),r===null&&(r=ee(),r===null&&(n.charCodeAt(t)===38?(r="&",t++):(r=null,u===0&&h('"&"')),r===null&&(n.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&h('"="')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"')),r===null&&(n.charCodeAt(t)===36?(r="$",t++):(r=null,u===0&&h('"$"')),r===null&&(n.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&h('","'))))))));return e!==null&&(e=(function(f){T.password=n.substring(t,f)})(l)),e===null&&(t=l),e}function an(){var e,r,l,f,d;return f=t,e=wt(),e!==null?(d=t,n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=Ui(),l!==null?r=[r,l]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e}function wt(){var e,r;return r=t,e=mr(),e===null&&(e=It(),e===null&&(e=Tr())),e!==null&&(e=(function(l){return T.host=n.substring(t,l).toLowerCase(),T.host})(r)),e===null&&(t=r),e}function mr(){var e,r,l,f,d,_;for(f=t,d=t,e=[],_=t,r=yr(),r!==null?(n.charCodeAt(t)===46?(l=".",t++):(l=null,u===0&&h('"."')),l!==null?r=[r,l]:(r=null,t=_)):(r=null,t=_);r!==null;)e.push(r),_=t,r=yr(),r!==null?(n.charCodeAt(t)===46?(l=".",t++):(l=null,u===0&&h('"."')),l!==null?r=[r,l]:(r=null,t=_)):(r=null,t=_);return e!==null?(r=Pi(),r!==null?(n.charCodeAt(t)===46?(l=".",t++):(l=null,u===0&&h('"."')),l=l!==null?l:"",l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(v){return T.host_type="domain",n.substring(t,v)})(f)),e===null&&(t=f),e}function yr(){var e,r,l,f;if(f=t,e=w(),e!==null){for(r=[],l=w(),l===null&&(n.charCodeAt(t)===45?(l="-",t++):(l=null,u===0&&h('"-"')),l===null&&(n.charCodeAt(t)===95?(l="_",t++):(l=null,u===0&&h('"_"'))));l!==null;)r.push(l),l=w(),l===null&&(n.charCodeAt(t)===45?(l="-",t++):(l=null,u===0&&h('"-"')),l===null&&(n.charCodeAt(t)===95?(l="_",t++):(l=null,u===0&&h('"_"'))));r!==null?e=[e,r]:(e=null,t=f)}else e=null,t=f;return e}function Pi(){var e,r,l,f;if(f=t,e=C(),e!==null){for(r=[],l=w(),l===null&&(n.charCodeAt(t)===45?(l="-",t++):(l=null,u===0&&h('"-"')),l===null&&(n.charCodeAt(t)===95?(l="_",t++):(l=null,u===0&&h('"_"'))));l!==null;)r.push(l),l=w(),l===null&&(n.charCodeAt(t)===45?(l="-",t++):(l=null,u===0&&h('"-"')),l===null&&(n.charCodeAt(t)===95?(l="_",t++):(l=null,u===0&&h('"_"'))));r!==null?e=[e,r]:(e=null,t=f)}else e=null,t=f;return e}function Tr(){var e,r,l,f,d;return f=t,d=t,n.charCodeAt(t)===91?(e="[",t++):(e=null,u===0&&h('"["')),e!==null?(r=Sr(),r!==null?(n.charCodeAt(t)===93?(l="]",t++):(l=null,u===0&&h('"]"')),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_){return T.host_type="IPv6",n.substring(t,_)})(f)),e===null&&(t=f),e}function Sr(){var e,r,l,f,d,_,v,E,O,j,te,xe,Sn,qr,b,H;return qr=t,b=t,e=F(),e!==null?(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=F(),l!==null?(n.charCodeAt(t)===58?(f=":",t++):(f=null,u===0&&h('":"')),f!==null?(d=F(),d!==null?(n.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&h('":"')),_!==null?(v=F(),v!==null?(n.charCodeAt(t)===58?(E=":",t++):(E=null,u===0&&h('":"')),E!==null?(O=F(),O!==null?(n.charCodeAt(t)===58?(j=":",t++):(j=null,u===0&&h('":"')),j!==null?(te=F(),te!==null?(n.charCodeAt(t)===58?(xe=":",t++):(xe=null,u===0&&h('":"')),xe!==null?(Sn=Ce(),Sn!==null?e=[e,r,l,f,d,_,v,E,O,j,te,xe,Sn]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,n.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&h('"::"')),e!==null?(r=F(),r!==null?(n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=F(),f!==null?(n.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&h('":"')),d!==null?(_=F(),_!==null?(n.charCodeAt(t)===58?(v=":",t++):(v=null,u===0&&h('":"')),v!==null?(E=F(),E!==null?(n.charCodeAt(t)===58?(O=":",t++):(O=null,u===0&&h('":"')),O!==null?(j=F(),j!==null?(n.charCodeAt(t)===58?(te=":",t++):(te=null,u===0&&h('":"')),te!==null?(xe=Ce(),xe!==null?e=[e,r,l,f,d,_,v,E,O,j,te,xe]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,n.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&h('"::"')),e!==null?(r=F(),r!==null?(n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=F(),f!==null?(n.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&h('":"')),d!==null?(_=F(),_!==null?(n.charCodeAt(t)===58?(v=":",t++):(v=null,u===0&&h('":"')),v!==null?(E=F(),E!==null?(n.charCodeAt(t)===58?(O=":",t++):(O=null,u===0&&h('":"')),O!==null?(j=Ce(),j!==null?e=[e,r,l,f,d,_,v,E,O,j]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,n.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&h('"::"')),e!==null?(r=F(),r!==null?(n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=F(),f!==null?(n.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&h('":"')),d!==null?(_=F(),_!==null?(n.charCodeAt(t)===58?(v=":",t++):(v=null,u===0&&h('":"')),v!==null?(E=Ce(),E!==null?e=[e,r,l,f,d,_,v,E]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,n.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&h('"::"')),e!==null?(r=F(),r!==null?(n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=F(),f!==null?(n.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&h('":"')),d!==null?(_=Ce(),_!==null?e=[e,r,l,f,d,_]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,n.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&h('"::"')),e!==null?(r=F(),r!==null?(n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=Ce(),f!==null?e=[e,r,l,f]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,n.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&h('"::"')),e!==null?(r=Ce(),r!==null?e=[e,r]:(e=null,t=b)):(e=null,t=b),e===null&&(b=t,n.substr(t,2)==="::"?(e="::",t+=2):(e=null,u===0&&h('"::"')),e!==null?(r=F(),r!==null?e=[e,r]:(e=null,t=b)):(e=null,t=b),e===null&&(b=t,e=F(),e!==null?(n.substr(t,2)==="::"?(r="::",t+=2):(r=null,u===0&&h('"::"')),r!==null?(l=F(),l!==null?(n.charCodeAt(t)===58?(f=":",t++):(f=null,u===0&&h('":"')),f!==null?(d=F(),d!==null?(n.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&h('":"')),_!==null?(v=F(),v!==null?(n.charCodeAt(t)===58?(E=":",t++):(E=null,u===0&&h('":"')),E!==null?(O=F(),O!==null?(n.charCodeAt(t)===58?(j=":",t++):(j=null,u===0&&h('":"')),j!==null?(te=Ce(),te!==null?e=[e,r,l,f,d,_,v,E,O,j,te]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,e=F(),e!==null?(H=t,n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=F(),l!==null?r=[r,l]:(r=null,t=H)):(r=null,t=H),r=r!==null?r:"",r!==null?(n.substr(t,2)==="::"?(l="::",t+=2):(l=null,u===0&&h('"::"')),l!==null?(f=F(),f!==null?(n.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&h('":"')),d!==null?(_=F(),_!==null?(n.charCodeAt(t)===58?(v=":",t++):(v=null,u===0&&h('":"')),v!==null?(E=F(),E!==null?(n.charCodeAt(t)===58?(O=":",t++):(O=null,u===0&&h('":"')),O!==null?(j=Ce(),j!==null?e=[e,r,l,f,d,_,v,E,O,j]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,e=F(),e!==null?(H=t,n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=F(),l!==null?r=[r,l]:(r=null,t=H)):(r=null,t=H),r=r!==null?r:"",r!==null?(H=t,n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=F(),f!==null?l=[l,f]:(l=null,t=H)):(l=null,t=H),l=l!==null?l:"",l!==null?(n.substr(t,2)==="::"?(f="::",t+=2):(f=null,u===0&&h('"::"')),f!==null?(d=F(),d!==null?(n.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&h('":"')),_!==null?(v=F(),v!==null?(n.charCodeAt(t)===58?(E=":",t++):(E=null,u===0&&h('":"')),E!==null?(O=Ce(),O!==null?e=[e,r,l,f,d,_,v,E,O]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,e=F(),e!==null?(H=t,n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=F(),l!==null?r=[r,l]:(r=null,t=H)):(r=null,t=H),r=r!==null?r:"",r!==null?(H=t,n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=F(),f!==null?l=[l,f]:(l=null,t=H)):(l=null,t=H),l=l!==null?l:"",l!==null?(H=t,n.charCodeAt(t)===58?(f=":",t++):(f=null,u===0&&h('":"')),f!==null?(d=F(),d!==null?f=[f,d]:(f=null,t=H)):(f=null,t=H),f=f!==null?f:"",f!==null?(n.substr(t,2)==="::"?(d="::",t+=2):(d=null,u===0&&h('"::"')),d!==null?(_=F(),_!==null?(n.charCodeAt(t)===58?(v=":",t++):(v=null,u===0&&h('":"')),v!==null?(E=Ce(),E!==null?e=[e,r,l,f,d,_,v,E]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,e=F(),e!==null?(H=t,n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=F(),l!==null?r=[r,l]:(r=null,t=H)):(r=null,t=H),r=r!==null?r:"",r!==null?(H=t,n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=F(),f!==null?l=[l,f]:(l=null,t=H)):(l=null,t=H),l=l!==null?l:"",l!==null?(H=t,n.charCodeAt(t)===58?(f=":",t++):(f=null,u===0&&h('":"')),f!==null?(d=F(),d!==null?f=[f,d]:(f=null,t=H)):(f=null,t=H),f=f!==null?f:"",f!==null?(H=t,n.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&h('":"')),d!==null?(_=F(),_!==null?d=[d,_]:(d=null,t=H)):(d=null,t=H),d=d!==null?d:"",d!==null?(n.substr(t,2)==="::"?(_="::",t+=2):(_=null,u===0&&h('"::"')),_!==null?(v=Ce(),v!==null?e=[e,r,l,f,d,_,v]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,e=F(),e!==null?(H=t,n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=F(),l!==null?r=[r,l]:(r=null,t=H)):(r=null,t=H),r=r!==null?r:"",r!==null?(H=t,n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=F(),f!==null?l=[l,f]:(l=null,t=H)):(l=null,t=H),l=l!==null?l:"",l!==null?(H=t,n.charCodeAt(t)===58?(f=":",t++):(f=null,u===0&&h('":"')),f!==null?(d=F(),d!==null?f=[f,d]:(f=null,t=H)):(f=null,t=H),f=f!==null?f:"",f!==null?(H=t,n.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&h('":"')),d!==null?(_=F(),_!==null?d=[d,_]:(d=null,t=H)):(d=null,t=H),d=d!==null?d:"",d!==null?(H=t,n.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&h('":"')),_!==null?(v=F(),v!==null?_=[_,v]:(_=null,t=H)):(_=null,t=H),_=_!==null?_:"",_!==null?(n.substr(t,2)==="::"?(v="::",t+=2):(v=null,u===0&&h('"::"')),v!==null?(E=F(),E!==null?e=[e,r,l,f,d,_,v,E]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b),e===null&&(b=t,e=F(),e!==null?(H=t,n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=F(),l!==null?r=[r,l]:(r=null,t=H)):(r=null,t=H),r=r!==null?r:"",r!==null?(H=t,n.charCodeAt(t)===58?(l=":",t++):(l=null,u===0&&h('":"')),l!==null?(f=F(),f!==null?l=[l,f]:(l=null,t=H)):(l=null,t=H),l=l!==null?l:"",l!==null?(H=t,n.charCodeAt(t)===58?(f=":",t++):(f=null,u===0&&h('":"')),f!==null?(d=F(),d!==null?f=[f,d]:(f=null,t=H)):(f=null,t=H),f=f!==null?f:"",f!==null?(H=t,n.charCodeAt(t)===58?(d=":",t++):(d=null,u===0&&h('":"')),d!==null?(_=F(),_!==null?d=[d,_]:(d=null,t=H)):(d=null,t=H),d=d!==null?d:"",d!==null?(H=t,n.charCodeAt(t)===58?(_=":",t++):(_=null,u===0&&h('":"')),_!==null?(v=F(),v!==null?_=[_,v]:(_=null,t=H)):(_=null,t=H),_=_!==null?_:"",_!==null?(H=t,n.charCodeAt(t)===58?(v=":",t++):(v=null,u===0&&h('":"')),v!==null?(E=F(),E!==null?v=[v,E]:(v=null,t=H)):(v=null,t=H),v=v!==null?v:"",v!==null?(n.substr(t,2)==="::"?(E="::",t+=2):(E=null,u===0&&h('"::"')),E!==null?e=[e,r,l,f,d,_,v,E]:(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b)):(e=null,t=b))))))))))))))),e!==null&&(e=(function(Ou){return T.host_type="IPv6",n.substring(t,Ou)})(qr)),e===null&&(t=qr),e}function F(){var e,r,l,f,d;return d=t,e=x(),e!==null?(r=x(),r=r!==null?r:"",r!==null?(l=x(),l=l!==null?l:"",l!==null?(f=x(),f=f!==null?f:"",f!==null?e=[e,r,l,f]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e}function Ce(){var e,r,l,f;return f=t,e=F(),e!==null?(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=F(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e===null&&(e=It()),e}function It(){var e,r,l,f,d,_,v,E,O;return E=t,O=t,e=Ot(),e!==null?(n.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&h('"."')),r!==null?(l=Ot(),l!==null?(n.charCodeAt(t)===46?(f=".",t++):(f=null,u===0&&h('"."')),f!==null?(d=Ot(),d!==null?(n.charCodeAt(t)===46?(_=".",t++):(_=null,u===0&&h('"."')),_!==null?(v=Ot(),v!==null?e=[e,r,l,f,d,_,v]:(e=null,t=O)):(e=null,t=O)):(e=null,t=O)):(e=null,t=O)):(e=null,t=O)):(e=null,t=O)):(e=null,t=O),e!==null&&(e=(function(j){return T.host_type="IPv4",n.substring(t,j)})(E)),e===null&&(t=E),e}function Ot(){var e,r,l,f;return f=t,n.substr(t,2)==="25"?(e="25",t+=2):(e=null,u===0&&h('"25"')),e!==null?(/^[0-5]/.test(n.charAt(t))?(r=n.charAt(t),t++):(r=null,u===0&&h("[0-5]")),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e===null&&(f=t,n.charCodeAt(t)===50?(e="2",t++):(e=null,u===0&&h('"2"')),e!==null?(/^[0-4]/.test(n.charAt(t))?(r=n.charAt(t),t++):(r=null,u===0&&h("[0-4]")),r!==null?(l=m(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e===null&&(f=t,n.charCodeAt(t)===49?(e="1",t++):(e=null,u===0&&h('"1"')),e!==null?(r=m(),r!==null?(l=m(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e===null&&(f=t,/^[1-9]/.test(n.charAt(t))?(e=n.charAt(t),t++):(e=null,u===0&&h("[1-9]")),e!==null?(r=m(),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e===null&&(e=m())))),e}function Ui(){var e,r,l,f,d,_,v;return _=t,v=t,e=m(),e=e!==null?e:"",e!==null?(r=m(),r=r!==null?r:"",r!==null?(l=m(),l=l!==null?l:"",l!==null?(f=m(),f=f!==null?f:"",f!==null?(d=m(),d=d!==null?d:"",d!==null?e=[e,r,l,f,d]:(e=null,t=v)):(e=null,t=v)):(e=null,t=v)):(e=null,t=v)):(e=null,t=v),e!==null&&(e=(function(E,O){return O=parseInt(O.join("")),T.port=O,O})(_,e)),e===null&&(t=_),e}function Mi(){var e,r,l,f;for(e=[],f=t,n.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&h('";"')),r!==null?(l=Cr(),l!==null?r=[r,l]:(r=null,t=f)):(r=null,t=f);r!==null;)e.push(r),f=t,n.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&h('";"')),r!==null?(l=Cr(),l!==null?r=[r,l]:(r=null,t=f)):(r=null,t=f);return e}function Cr(){var e;return e=Fi(),e===null&&(e=Hi(),e===null&&(e=Li(),e===null&&(e=qi(),e===null&&(e=ji(),e===null&&(e=Gi(),e===null&&(e=Wi())))))),e}function Fi(){var e,r,l,f;return l=t,f=t,n.substr(t,10).toLowerCase()==="transport="?(e=n.substr(t,10),t+=10):(e=null,u===0&&h('"transport="')),e!==null?(n.substr(t,3).toLowerCase()==="udp"?(r=n.substr(t,3),t+=3):(r=null,u===0&&h('"udp"')),r===null&&(n.substr(t,3).toLowerCase()==="tcp"?(r=n.substr(t,3),t+=3):(r=null,u===0&&h('"tcp"')),r===null&&(n.substr(t,4).toLowerCase()==="sctp"?(r=n.substr(t,4),t+=4):(r=null,u===0&&h('"sctp"')),r===null&&(n.substr(t,3).toLowerCase()==="tls"?(r=n.substr(t,3),t+=3):(r=null,u===0&&h('"tls"')),r===null&&(r=G())))),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e!==null&&(e=(function(d,_){T.uri_params||(T.uri_params={}),T.uri_params.transport=_.toLowerCase()})(l,e[1])),e===null&&(t=l),e}function Hi(){var e,r,l,f;return l=t,f=t,n.substr(t,5).toLowerCase()==="user="?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"user="')),e!==null?(n.substr(t,5).toLowerCase()==="phone"?(r=n.substr(t,5),t+=5):(r=null,u===0&&h('"phone"')),r===null&&(n.substr(t,2).toLowerCase()==="ip"?(r=n.substr(t,2),t+=2):(r=null,u===0&&h('"ip"')),r===null&&(r=G())),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e!==null&&(e=(function(d,_){T.uri_params||(T.uri_params={}),T.uri_params.user=_.toLowerCase()})(l,e[1])),e===null&&(t=l),e}function Li(){var e,r,l,f;return l=t,f=t,n.substr(t,7).toLowerCase()==="method="?(e=n.substr(t,7),t+=7):(e=null,u===0&&h('"method="')),e!==null?(r=cn(),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e!==null&&(e=(function(d,_){T.uri_params||(T.uri_params={}),T.uri_params.method=_})(l,e[1])),e===null&&(t=l),e}function qi(){var e,r,l,f;return l=t,f=t,n.substr(t,4).toLowerCase()==="ttl="?(e=n.substr(t,4),t+=4):(e=null,u===0&&h('"ttl="')),e!==null?(r=Mr(),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e!==null&&(e=(function(d,_){T.params||(T.params={}),T.params.ttl=_})(l,e[1])),e===null&&(t=l),e}function ji(){var e,r,l,f;return l=t,f=t,n.substr(t,6).toLowerCase()==="maddr="?(e=n.substr(t,6),t+=6):(e=null,u===0&&h('"maddr="')),e!==null?(r=wt(),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e!==null&&(e=(function(d,_){T.uri_params||(T.uri_params={}),T.uri_params.maddr=_})(l,e[1])),e===null&&(t=l),e}function Gi(){var e,r,l,f,d,_;return f=t,d=t,n.substr(t,2).toLowerCase()==="lr"?(e=n.substr(t,2),t+=2):(e=null,u===0&&h('"lr"')),e!==null?(_=t,n.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&h('"="')),r!==null?(l=G(),l!==null?r=[r,l]:(r=null,t=_)):(r=null,t=_),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(v){T.uri_params||(T.uri_params={}),T.uri_params.lr=void 0})(f)),e===null&&(t=f),e}function Wi(){var e,r,l,f,d,_;return f=t,d=t,e=Bi(),e!==null?(_=t,n.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&h('"="')),r!==null?(l=Vi(),l!==null?r=[r,l]:(r=null,t=_)):(r=null,t=_),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(v,E,O){T.uri_params||(T.uri_params={}),typeof O>"u"?O=void 0:O=O[1],T.uri_params[E.toLowerCase()]=O})(f,e[0],e[1])),e===null&&(t=f),e}function Bi(){var e,r,l;if(l=t,r=Nt(),r!==null)for(e=[];r!==null;)e.push(r),r=Nt();else e=null;return e!==null&&(e=(function(f,d){return d.join("")})(l,e)),e===null&&(t=l),e}function Vi(){var e,r,l;if(l=t,r=Nt(),r!==null)for(e=[];r!==null;)e.push(r),r=Nt();else e=null;return e!==null&&(e=(function(f,d){return d.join("")})(l,e)),e===null&&(t=l),e}function Nt(){var e;return e=zi(),e===null&&(e=J(),e===null&&(e=ee())),e}function zi(){var e;return n.charCodeAt(t)===91?(e="[",t++):(e=null,u===0&&h('"["')),e===null&&(n.charCodeAt(t)===93?(e="]",t++):(e=null,u===0&&h('"]"')),e===null&&(n.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&h('"/"')),e===null&&(n.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&h('":"')),e===null&&(n.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&h('"&"')),e===null&&(n.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&h('"+"')),e===null&&(n.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&h('"$"')))))))),e}function Ki(){var e,r,l,f,d,_,v;if(_=t,n.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&h('"?"')),e!==null)if(r=on(),r!==null){for(l=[],v=t,n.charCodeAt(t)===38?(f="&",t++):(f=null,u===0&&h('"&"')),f!==null?(d=on(),d!==null?f=[f,d]:(f=null,t=v)):(f=null,t=v);f!==null;)l.push(f),v=t,n.charCodeAt(t)===38?(f="&",t++):(f=null,u===0&&h('"&"')),f!==null?(d=on(),d!==null?f=[f,d]:(f=null,t=v)):(f=null,t=v);l!==null?e=[e,r,l]:(e=null,t=_)}else e=null,t=_;else e=null,t=_;return e}function on(){var e,r,l,f,d;return f=t,d=t,e=$i(),e!==null?(n.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&h('"="')),r!==null?(l=Yi(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v,E){v=v.join("").toLowerCase(),E=E.join(""),T.uri_headers||(T.uri_headers={}),T.uri_headers[v]?T.uri_headers[v].push(E):T.uri_headers[v]=[E]})(f,e[0],e[2])),e===null&&(t=f),e}function $i(){var e,r;if(r=kt(),r===null&&(r=J(),r===null&&(r=ee())),r!==null)for(e=[];r!==null;)e.push(r),r=kt(),r===null&&(r=J(),r===null&&(r=ee()));else e=null;return e}function Yi(){var e,r;for(e=[],r=kt(),r===null&&(r=J(),r===null&&(r=ee()));r!==null;)e.push(r),r=kt(),r===null&&(r=J(),r===null&&(r=ee()));return e}function kt(){var e;return n.charCodeAt(t)===91?(e="[",t++):(e=null,u===0&&h('"["')),e===null&&(n.charCodeAt(t)===93?(e="]",t++):(e=null,u===0&&h('"]"')),e===null&&(n.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&h('"/"')),e===null&&(n.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&h('"?"')),e===null&&(n.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&h('":"')),e===null&&(n.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&h('"+"')),e===null&&(n.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&h('"$"')))))))),e}function zo(){var e;return e=gs(),e===null&&(e=Ji()),e}function Ji(){var e,r,l,f,d,_;return _=t,e=cn(),e!==null?(r=R(),r!==null?(l=Xi(),l!==null?(f=R(),f!==null?(d=Ar(),d!==null?e=[e,r,l,f,d]:(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_),e}function Xi(){var e;return e=sn(),e===null&&(e=Er()),e}function Er(){var e,r,l,f;return f=t,e=rs(),e!==null?(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r!==null?(l=Qi(),l===null&&(l=es()),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function Qi(){var e,r,l,f,d;return f=t,e=Zi(),e===null&&(e=un()),e!==null?(d=t,n.charCodeAt(t)===63?(r="?",t++):(r=null,u===0&&h('"?"')),r!==null?(l=as(),l!==null?r=[r,l]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e}function Zi(){var e,r,l,f;return f=t,n.substr(t,2)==="//"?(e="//",t+=2):(e=null,u===0&&h('"//"')),e!==null?(r=is(),r!==null?(l=un(),l=l!==null?l:"",l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function un(){var e,r,l;return l=t,n.charCodeAt(t)===47?(e="/",t++):(e=null,u===0&&h('"/"')),e!==null?(r=ns(),r!==null?e=[e,r]:(e=null,t=l)):(e=null,t=l),e}function es(){var e,r,l,f;if(f=t,e=ts(),e!==null){for(r=[],l=Dt();l!==null;)r.push(l),l=Dt();r!==null?e=[e,r]:(e=null,t=f)}else e=null,t=f;return e}function Dt(){var e;return e=D(),e===null&&(e=J(),e===null&&(e=ee())),e}function ts(){var e;return e=J(),e===null&&(e=ee(),e===null&&(n.charCodeAt(t)===59?(e=";",t++):(e=null,u===0&&h('";"')),e===null&&(n.charCodeAt(t)===63?(e="?",t++):(e=null,u===0&&h('"?"')),e===null&&(n.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&h('":"')),e===null&&(n.charCodeAt(t)===64?(e="@",t++):(e=null,u===0&&h('"@"')),e===null&&(n.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&h('"&"')),e===null&&(n.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&h('"="')),e===null&&(n.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&h('"+"')),e===null&&(n.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&h('"$"')),e===null&&(n.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&h('","')))))))))))),e}function ns(){var e,r,l,f,d,_;if(d=t,e=fn(),e!==null){for(r=[],_=t,n.charCodeAt(t)===47?(l="/",t++):(l=null,u===0&&h('"/"')),l!==null?(f=fn(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,n.charCodeAt(t)===47?(l="/",t++):(l=null,u===0&&h('"/"')),l!==null?(f=fn(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function fn(){var e,r,l,f,d,_;for(d=t,e=[],r=xt();r!==null;)e.push(r),r=xt();if(e!==null){for(r=[],_=t,n.charCodeAt(t)===59?(l=";",t++):(l=null,u===0&&h('";"')),l!==null?(f=br(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,n.charCodeAt(t)===59?(l=";",t++):(l=null,u===0&&h('";"')),l!==null?(f=br(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function br(){var e,r;for(e=[],r=xt();r!==null;)e.push(r),r=xt();return e}function xt(){var e;return e=J(),e===null&&(e=ee(),e===null&&(n.charCodeAt(t)===58?(e=":",t++):(e=null,u===0&&h('":"')),e===null&&(n.charCodeAt(t)===64?(e="@",t++):(e=null,u===0&&h('"@"')),e===null&&(n.charCodeAt(t)===38?(e="&",t++):(e=null,u===0&&h('"&"')),e===null&&(n.charCodeAt(t)===61?(e="=",t++):(e=null,u===0&&h('"="')),e===null&&(n.charCodeAt(t)===43?(e="+",t++):(e=null,u===0&&h('"+"')),e===null&&(n.charCodeAt(t)===36?(e="$",t++):(e=null,u===0&&h('"$"')),e===null&&(n.charCodeAt(t)===44?(e=",",t++):(e=null,u===0&&h('","')))))))))),e}function rs(){var e,r,l,f,d;if(f=t,d=t,e=C(),e!==null){for(r=[],l=C(),l===null&&(l=m(),l===null&&(n.charCodeAt(t)===43?(l="+",t++):(l=null,u===0&&h('"+"')),l===null&&(n.charCodeAt(t)===45?(l="-",t++):(l=null,u===0&&h('"-"')),l===null&&(n.charCodeAt(t)===46?(l=".",t++):(l=null,u===0&&h('"."'))))));l!==null;)r.push(l),l=C(),l===null&&(l=m(),l===null&&(n.charCodeAt(t)===43?(l="+",t++):(l=null,u===0&&h('"+"')),l===null&&(n.charCodeAt(t)===45?(l="-",t++):(l=null,u===0&&h('"-"')),l===null&&(n.charCodeAt(t)===46?(l=".",t++):(l=null,u===0&&h('"."'))))));r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e!==null&&(e=(function(_){T.scheme=n.substring(t,_)})(f)),e===null&&(t=f),e}function is(){var e;return e=ss(),e===null&&(e=ls()),e}function ss(){var e,r,l,f;return l=t,f=t,e=ln(),e!==null?(n.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&h('"@"')),r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e=e!==null?e:"",e!==null?(r=an(),r!==null?e=[e,r]:(e=null,t=l)):(e=null,t=l),e=e!==null?e:"",e}function ls(){var e,r;if(r=J(),r===null&&(r=ee(),r===null&&(n.charCodeAt(t)===36?(r="$",t++):(r=null,u===0&&h('"$"')),r===null&&(n.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&h('","')),r===null&&(n.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&h('";"')),r===null&&(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r===null&&(n.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&h('"@"')),r===null&&(n.charCodeAt(t)===38?(r="&",t++):(r=null,u===0&&h('"&"')),r===null&&(n.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&h('"="')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"'))))))))))),r!==null)for(e=[];r!==null;)e.push(r),r=J(),r===null&&(r=ee(),r===null&&(n.charCodeAt(t)===36?(r="$",t++):(r=null,u===0&&h('"$"')),r===null&&(n.charCodeAt(t)===44?(r=",",t++):(r=null,u===0&&h('","')),r===null&&(n.charCodeAt(t)===59?(r=";",t++):(r=null,u===0&&h('";"')),r===null&&(n.charCodeAt(t)===58?(r=":",t++):(r=null,u===0&&h('":"')),r===null&&(n.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&h('"@"')),r===null&&(n.charCodeAt(t)===38?(r="&",t++):(r=null,u===0&&h('"&"')),r===null&&(n.charCodeAt(t)===61?(r="=",t++):(r=null,u===0&&h('"="')),r===null&&(n.charCodeAt(t)===43?(r="+",t++):(r=null,u===0&&h('"+"')))))))))));else e=null;return e}function as(){var e,r;for(e=[],r=Dt();r!==null;)e.push(r),r=Dt();return e}function Ar(){var e,r,l,f,d,_,v,E;if(v=t,E=t,n.substr(t,3).toLowerCase()==="sip"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"SIP"')),e!==null)if(n.charCodeAt(t)===47?(r="/",t++):(r=null,u===0&&h('"/"')),r!==null){if(f=m(),f!==null)for(l=[];f!==null;)l.push(f),f=m();else l=null;if(l!==null)if(n.charCodeAt(t)===46?(f=".",t++):(f=null,u===0&&h('"."')),f!==null){if(_=m(),_!==null)for(d=[];_!==null;)d.push(_),_=m();else d=null;d!==null?e=[e,r,l,f,d]:(e=null,t=E)}else e=null,t=E;else e=null,t=E}else e=null,t=E;else e=null,t=E;return e!==null&&(e=(function(O){T.sip_version=n.substring(t,O)})(v)),e===null&&(t=v),e}function os(){var e;return n.substr(t,6)==="INVITE"?(e="INVITE",t+=6):(e=null,u===0&&h('"INVITE"')),e}function us(){var e;return n.substr(t,3)==="ACK"?(e="ACK",t+=3):(e=null,u===0&&h('"ACK"')),e}function fs(){var e;return n.substr(t,7)==="OPTIONS"?(e="OPTIONS",t+=7):(e=null,u===0&&h('"OPTIONS"')),e}function cs(){var e;return n.substr(t,3)==="BYE"?(e="BYE",t+=3):(e=null,u===0&&h('"BYE"')),e}function hs(){var e;return n.substr(t,6)==="CANCEL"?(e="CANCEL",t+=6):(e=null,u===0&&h('"CANCEL"')),e}function ds(){var e;return n.substr(t,8)==="REGISTER"?(e="REGISTER",t+=8):(e=null,u===0&&h('"REGISTER"')),e}function _s(){var e;return n.substr(t,9)==="SUBSCRIBE"?(e="SUBSCRIBE",t+=9):(e=null,u===0&&h('"SUBSCRIBE"')),e}function ps(){var e;return n.substr(t,6)==="NOTIFY"?(e="NOTIFY",t+=6):(e=null,u===0&&h('"NOTIFY"')),e}function vs(){var e;return n.substr(t,5)==="REFER"?(e="REFER",t+=5):(e=null,u===0&&h('"REFER"')),e}function cn(){var e,r;return r=t,e=os(),e===null&&(e=us(),e===null&&(e=fs(),e===null&&(e=cs(),e===null&&(e=hs(),e===null&&(e=ds(),e===null&&(e=_s(),e===null&&(e=ps(),e===null&&(e=vs(),e===null&&(e=G()))))))))),e!==null&&(e=(function(l){return T.method=n.substring(t,l),T.method})(r)),e===null&&(t=r),e}function gs(){var e,r,l,f,d,_;return _=t,e=Ar(),e!==null?(r=R(),r!==null?(l=ms(),l!==null?(f=R(),f!==null?(d=Ts(),d!==null?e=[e,r,l,f,d]:(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_),e}function ms(){var e,r;return r=t,e=ys(),e!==null&&(e=(function(l,f){T.status_code=parseInt(f.join(""))})(r,e)),e===null&&(t=r),e}function ys(){var e,r,l,f;return f=t,e=m(),e!==null?(r=m(),r!==null?(l=m(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function Ts(){var e,r,l;for(l=t,e=[],r=D(),r===null&&(r=J(),r===null&&(r=ee(),r===null&&(r=Ie(),r===null&&(r=ke(),r===null&&(r=R(),r===null&&(r=k()))))));r!==null;)e.push(r),r=D(),r===null&&(r=J(),r===null&&(r=ee(),r===null&&(r=Ie(),r===null&&(r=ke(),r===null&&(r=R(),r===null&&(r=k()))))));return e!==null&&(e=(function(f){T.reason_phrase=n.substring(t,f)})(l)),e===null&&(t=l),e}function Ko(){var e,r,l,f,d,_;if(d=t,e=Pt(),e!==null){for(r=[],_=t,l=V(),l!==null?(f=Pt(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=V(),l!==null?(f=Pt(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function $o(){var e,r,l,f,d,_;return f=t,d=t,e=De(),e!==null?(_=t,n.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&h('"@"')),r!==null?(l=De(),l!==null?r=[r,l]:(r=null,t=_)):(r=null,t=_),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(v){T=n.substring(t,v)})(f)),e===null&&(t=f),e}function Yo(){var e,r,l,f,d,_,v;if(d=t,e=Je(),e===null)if(_=t,e=hn(),e!==null){for(r=[],v=t,l=V(),l!==null?(f=hn(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=V(),l!==null?(f=hn(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E){var O,j;for(j=T.multi_header.length,O=0;O<j;O++)if(T.multi_header[O].parsed===null){T=null;break}T!==null?T=T.multi_header:T=-1})(d)),e===null&&(t=d),e}function hn(){var e,r,l,f,d,_,v;if(d=t,_=t,e=Rt(),e===null&&(e=Ze()),e!==null){for(r=[],v=t,l=q(),l!==null?(f=Rr(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=q(),l!==null?(f=Rr(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E){var O;T.multi_header||(T.multi_header=[]);try{O=new ft(T.uri,T.display_name,T.params),delete T.uri,delete T.display_name,delete T.params}catch{O=null}T.multi_header.push({possition:t,offset:E,parsed:O})})(d)),e===null&&(t=d),e}function Ze(){var e,r,l,f,d;return d=t,e=dn(),e=e!==null?e:"",e!==null?(r=le(),r!==null?(l=sn(),l!==null?(f=$(),f!==null?e=[e,r,l,f]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e}function dn(){var e,r,l,f,d,_,v;if(d=t,_=t,e=G(),e!==null){for(r=[],v=t,l=ie(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=ie(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e===null&&(e=bt()),e!==null&&(e=(function(E,O){typeof O=="string"?T.display_name=O:T.display_name=O[1].reduce(function(j,te){return j+te[0]+te[1]},O[0])})(d,e)),e===null&&(t=d),e}function Rr(){var e;return e=Ss(),e===null&&(e=Cs(),e===null&&(e=oe())),e}function Ss(){var e,r,l,f,d;return f=t,d=t,n.substr(t,1).toLowerCase()==="q"?(e=n.substr(t,1),t++):(e=null,u===0&&h('"q"')),e!==null?(r=M(),r!==null?(l=Es(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.params||(T.params={}),T.params.q=v})(f,e[2])),e===null&&(t=f),e}function Cs(){var e,r,l,f,d;return f=t,d=t,n.substr(t,7).toLowerCase()==="expires"?(e=n.substr(t,7),t+=7):(e=null,u===0&&h('"expires"')),e!==null?(r=M(),r!==null?(l=et(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.params||(T.params={}),T.params.expires=v})(f,e[2])),e===null&&(t=f),e}function et(){var e,r,l;if(l=t,r=m(),r!==null)for(e=[];r!==null;)e.push(r),r=m();else e=null;return e!==null&&(e=(function(f,d){return parseInt(d.join(""))})(l,e)),e===null&&(t=l),e}function Es(){var e,r,l,f,d,_,v,E;return _=t,v=t,n.charCodeAt(t)===48?(e="0",t++):(e=null,u===0&&h('"0"')),e!==null?(E=t,n.charCodeAt(t)===46?(r=".",t++):(r=null,u===0&&h('"."')),r!==null?(l=m(),l=l!==null?l:"",l!==null?(f=m(),f=f!==null?f:"",f!==null?(d=m(),d=d!==null?d:"",d!==null?r=[r,l,f,d]:(r=null,t=E)):(r=null,t=E)):(r=null,t=E)):(r=null,t=E),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=v)):(e=null,t=v),e!==null&&(e=(function(O){return parseFloat(n.substring(t,O))})(_)),e===null&&(t=_),e}function oe(){var e,r,l,f,d,_;return f=t,d=t,e=G(),e!==null?(_=t,r=M(),r!==null?(l=bs(),l!==null?r=[r,l]:(r=null,t=_)):(r=null,t=_),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(v,E,O){T.params||(T.params={}),typeof O>"u"?O=void 0:O=O[1],T.params[E.toLowerCase()]=O})(f,e[0],e[1])),e===null&&(t=f),e}function bs(){var e;return e=G(),e===null&&(e=wt(),e===null&&(e=rn())),e}function Jo(){var e,r,l,f,d,_;if(d=t,e=As(),e!==null){for(r=[],_=t,l=q(),l!==null?(f=wr(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=q(),l!==null?(f=wr(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function As(){var e;return n.substr(t,6).toLowerCase()==="render"?(e=n.substr(t,6),t+=6):(e=null,u===0&&h('"render"')),e===null&&(n.substr(t,7).toLowerCase()==="session"?(e=n.substr(t,7),t+=7):(e=null,u===0&&h('"session"')),e===null&&(n.substr(t,4).toLowerCase()==="icon"?(e=n.substr(t,4),t+=4):(e=null,u===0&&h('"icon"')),e===null&&(n.substr(t,5).toLowerCase()==="alert"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"alert"')),e===null&&(e=G())))),e}function wr(){var e;return e=Rs(),e===null&&(e=oe()),e}function Rs(){var e,r,l,f;return f=t,n.substr(t,8).toLowerCase()==="handling"?(e=n.substr(t,8),t+=8):(e=null,u===0&&h('"handling"')),e!==null?(r=M(),r!==null?(n.substr(t,8).toLowerCase()==="optional"?(l=n.substr(t,8),t+=8):(l=null,u===0&&h('"optional"')),l===null&&(n.substr(t,8).toLowerCase()==="required"?(l=n.substr(t,8),t+=8):(l=null,u===0&&h('"required"')),l===null&&(l=G())),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function Xo(){var e,r,l,f,d,_;if(d=t,e=G(),e!==null){for(r=[],_=t,l=V(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=V(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function Qo(){var e,r,l;if(l=t,r=m(),r!==null)for(e=[];r!==null;)e.push(r),r=m();else e=null;return e!==null&&(e=(function(f,d){T=parseInt(d.join(""))})(l,e)),e===null&&(t=l),e}function Zo(){var e,r;return r=t,e=ws(),e!==null&&(e=(function(l){T=n.substring(t,l)})(r)),e===null&&(t=r),e}function ws(){var e,r,l,f,d,_,v,E;if(v=t,e=Is(),e!==null)if(r=ut(),r!==null)if(l=Ds(),l!==null){for(f=[],E=t,d=q(),d!==null?(_=Ir(),_!==null?d=[d,_]:(d=null,t=E)):(d=null,t=E);d!==null;)f.push(d),E=t,d=q(),d!==null?(_=Ir(),_!==null?d=[d,_]:(d=null,t=E)):(d=null,t=E);f!==null?e=[e,r,l,f]:(e=null,t=v)}else e=null,t=v;else e=null,t=v;else e=null,t=v;return e}function Is(){var e;return e=Os(),e===null&&(e=Ns()),e}function Os(){var e;return n.substr(t,4).toLowerCase()==="text"?(e=n.substr(t,4),t+=4):(e=null,u===0&&h('"text"')),e===null&&(n.substr(t,5).toLowerCase()==="image"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"image"')),e===null&&(n.substr(t,5).toLowerCase()==="audio"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"audio"')),e===null&&(n.substr(t,5).toLowerCase()==="video"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"video"')),e===null&&(n.substr(t,11).toLowerCase()==="application"?(e=n.substr(t,11),t+=11):(e=null,u===0&&h('"application"')),e===null&&(e=_n()))))),e}function Ns(){var e;return n.substr(t,7).toLowerCase()==="message"?(e=n.substr(t,7),t+=7):(e=null,u===0&&h('"message"')),e===null&&(n.substr(t,9).toLowerCase()==="multipart"?(e=n.substr(t,9),t+=9):(e=null,u===0&&h('"multipart"')),e===null&&(e=_n())),e}function _n(){var e;return e=G(),e===null&&(e=ks()),e}function ks(){var e,r,l;return l=t,n.substr(t,2).toLowerCase()==="x-"?(e=n.substr(t,2),t+=2):(e=null,u===0&&h('"x-"')),e!==null?(r=G(),r!==null?e=[e,r]:(e=null,t=l)):(e=null,t=l),e}function Ds(){var e;return e=_n(),e===null&&(e=G()),e}function Ir(){var e,r,l,f;return f=t,e=G(),e!==null?(r=M(),r!==null?(l=xs(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function xs(){var e;return e=G(),e===null&&(e=rn()),e}function eu(){var e,r,l,f;return f=t,e=Ps(),e!==null?(r=ie(),r!==null?(l=cn(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function Ps(){var e,r,l;if(l=t,r=m(),r!==null)for(e=[];r!==null;)e.push(r),r=m();else e=null;return e!==null&&(e=(function(f,d){T.value=parseInt(d.join(""))})(l,e)),e===null&&(t=l),e}function tu(){var e,r;return r=t,e=et(),e!==null&&(e=(function(l,f){T=f})(r,e)),e===null&&(t=r),e}function nu(){var e,r,l,f,d,_,v;if(d=t,_=t,e=Pt(),e!==null){for(r=[],v=t,l=q(),l!==null?(f=oe(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=q(),l!==null?(f=oe(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E,O){T.event=O.join("").toLowerCase()})(d,e[0])),e===null&&(t=d),e}function Pt(){var e,r,l,f,d,_;if(d=t,e=He(),e!==null){for(r=[],_=t,n.charCodeAt(t)===46?(l=".",t++):(l=null,u===0&&h('"."')),l!==null?(f=He(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,n.charCodeAt(t)===46?(l=".",t++):(l=null,u===0&&h('"."')),l!==null?(f=He(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function ru(){var e,r,l,f,d,_,v;if(d=t,_=t,e=Rt(),e===null&&(e=Ze()),e!==null){for(r=[],v=t,l=q(),l!==null?(f=Or(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=q(),l!==null?(f=Or(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E){var O=T.tag;try{T=new ft(T.uri,T.display_name,T.params),O&&T.setParam("tag",O)}catch{T=-1}})(d)),e===null&&(t=d),e}function Or(){var e;return e=Nr(),e===null&&(e=oe()),e}function Nr(){var e,r,l,f,d;return f=t,d=t,n.substr(t,3).toLowerCase()==="tag"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"tag"')),e!==null?(r=M(),r!==null?(l=G(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.tag=v})(f,e[2])),e===null&&(t=f),e}function iu(){var e,r,l;if(l=t,r=m(),r!==null)for(e=[];r!==null;)e.push(r),r=m();else e=null;return e!==null&&(e=(function(f,d){T=parseInt(d.join(""))})(l,e)),e===null&&(t=l),e}function su(){var e,r;return r=t,e=et(),e!==null&&(e=(function(l,f){T=f})(r,e)),e===null&&(t=r),e}function lu(){var e,r,l,f,d,_,v,E,O,j;for(E=t,O=t,e=[],r=dn();r!==null;)e.push(r),r=dn();if(e!==null)if(r=le(),r!==null)if(l=sn(),l!==null)if(f=$(),f!==null){for(d=[],j=t,_=q(),_!==null?(v=oe(),v!==null?_=[_,v]:(_=null,t=j)):(_=null,t=j);_!==null;)d.push(_),j=t,_=q(),_!==null?(v=oe(),v!==null?_=[_,v]:(_=null,t=j)):(_=null,t=j);d!==null?e=[e,r,l,f,d]:(e=null,t=O)}else e=null,t=O;else e=null,t=O;else e=null,t=O;else e=null,t=O;return e!==null&&(e=(function(te){try{T=new ft(T.uri,T.display_name,T.params)}catch{T=-1}})(E)),e===null&&(t=E),e}function au(){var e;return e=kr(),e}function kr(){var e,r,l,f,d,_,v,E;if(v=t,n.substr(t,6).toLowerCase()==="digest"?(e=n.substr(t,6),t+=6):(e=null,u===0&&h('"Digest"')),e!==null)if(r=ie(),r!==null)if(l=pn(),l!==null){for(f=[],E=t,d=V(),d!==null?(_=pn(),_!==null?d=[d,_]:(d=null,t=E)):(d=null,t=E);d!==null;)f.push(d),E=t,d=V(),d!==null?(_=pn(),_!==null?d=[d,_]:(d=null,t=E)):(d=null,t=E);f!==null?e=[e,r,l,f]:(e=null,t=v)}else e=null,t=v;else e=null,t=v;else e=null,t=v;return e===null&&(e=Us()),e}function Us(){var e,r,l,f,d,_,v,E;if(v=t,e=G(),e!==null)if(r=ie(),r!==null)if(l=Ut(),l!==null){for(f=[],E=t,d=V(),d!==null?(_=Ut(),_!==null?d=[d,_]:(d=null,t=E)):(d=null,t=E);d!==null;)f.push(d),E=t,d=V(),d!==null?(_=Ut(),_!==null?d=[d,_]:(d=null,t=E)):(d=null,t=E);f!==null?e=[e,r,l,f]:(e=null,t=v)}else e=null,t=v;else e=null,t=v;else e=null,t=v;return e}function Ut(){var e,r,l,f;return f=t,e=G(),e!==null?(r=M(),r!==null?(l=G(),l===null&&(l=rn()),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function pn(){var e;return e=Ms(),e===null&&(e=Hs(),e===null&&(e=Ls(),e===null&&(e=js(),e===null&&(e=Gs(),e===null&&(e=Ws(),e===null&&(e=Bs(),e===null&&(e=Ut()))))))),e}function Ms(){var e,r,l,f;return f=t,n.substr(t,5).toLowerCase()==="realm"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"realm"')),e!==null?(r=M(),r!==null?(l=Fs(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function Fs(){var e,r;return r=t,e=bt(),e!==null&&(e=(function(l,f){T.realm=f})(r,e)),e===null&&(t=r),e}function Hs(){var e,r,l,f,d,_,v,E,O;if(E=t,n.substr(t,6).toLowerCase()==="domain"?(e=n.substr(t,6),t+=6):(e=null,u===0&&h('"domain"')),e!==null)if(r=M(),r!==null)if(l=Se(),l!==null)if(f=vn(),f!==null){if(d=[],O=t,v=R(),v!==null)for(_=[];v!==null;)_.push(v),v=R();else _=null;for(_!==null?(v=vn(),v!==null?_=[_,v]:(_=null,t=O)):(_=null,t=O);_!==null;){if(d.push(_),O=t,v=R(),v!==null)for(_=[];v!==null;)_.push(v),v=R();else _=null;_!==null?(v=vn(),v!==null?_=[_,v]:(_=null,t=O)):(_=null,t=O)}d!==null?(_=dr(),_!==null?e=[e,r,l,f,d,_]:(e=null,t=E)):(e=null,t=E)}else e=null,t=E;else e=null,t=E;else e=null,t=E;else e=null,t=E;return e}function vn(){var e;return e=Er(),e===null&&(e=un()),e}function Ls(){var e,r,l,f;return f=t,n.substr(t,5).toLowerCase()==="nonce"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"nonce"')),e!==null?(r=M(),r!==null?(l=qs(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function qs(){var e,r;return r=t,e=bt(),e!==null&&(e=(function(l,f){T.nonce=f})(r,e)),e===null&&(t=r),e}function js(){var e,r,l,f,d;return f=t,d=t,n.substr(t,6).toLowerCase()==="opaque"?(e=n.substr(t,6),t+=6):(e=null,u===0&&h('"opaque"')),e!==null?(r=M(),r!==null?(l=bt(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.opaque=v})(f,e[2])),e===null&&(t=f),e}function Gs(){var e,r,l,f,d;return f=t,n.substr(t,5).toLowerCase()==="stale"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"stale"')),e!==null?(r=M(),r!==null?(d=t,n.substr(t,4).toLowerCase()==="true"?(l=n.substr(t,4),t+=4):(l=null,u===0&&h('"true"')),l!==null&&(l=(function(_){T.stale=!0})(d)),l===null&&(t=d),l===null&&(d=t,n.substr(t,5).toLowerCase()==="false"?(l=n.substr(t,5),t+=5):(l=null,u===0&&h('"false"')),l!==null&&(l=(function(_){T.stale=!1})(d)),l===null&&(t=d)),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function Ws(){var e,r,l,f,d;return f=t,d=t,n.substr(t,9).toLowerCase()==="algorithm"?(e=n.substr(t,9),t+=9):(e=null,u===0&&h('"algorithm"')),e!==null?(r=M(),r!==null?(n.substr(t,3).toLowerCase()==="md5"?(l=n.substr(t,3),t+=3):(l=null,u===0&&h('"MD5"')),l===null&&(n.substr(t,8).toLowerCase()==="md5-sess"?(l=n.substr(t,8),t+=8):(l=null,u===0&&h('"MD5-sess"')),l===null&&(l=G())),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.algorithm=v.toUpperCase()})(f,e[2])),e===null&&(t=f),e}function Bs(){var e,r,l,f,d,_,v,E,O,j;if(E=t,n.substr(t,3).toLowerCase()==="qop"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"qop"')),e!==null)if(r=M(),r!==null)if(l=Se(),l!==null){if(O=t,f=gn(),f!==null){for(d=[],j=t,n.charCodeAt(t)===44?(_=",",t++):(_=null,u===0&&h('","')),_!==null?(v=gn(),v!==null?_=[_,v]:(_=null,t=j)):(_=null,t=j);_!==null;)d.push(_),j=t,n.charCodeAt(t)===44?(_=",",t++):(_=null,u===0&&h('","')),_!==null?(v=gn(),v!==null?_=[_,v]:(_=null,t=j)):(_=null,t=j);d!==null?f=[f,d]:(f=null,t=O)}else f=null,t=O;f!==null?(d=dr(),d!==null?e=[e,r,l,f,d]:(e=null,t=E)):(e=null,t=E)}else e=null,t=E;else e=null,t=E;else e=null,t=E;return e}function gn(){var e,r;return r=t,n.substr(t,8).toLowerCase()==="auth-int"?(e=n.substr(t,8),t+=8):(e=null,u===0&&h('"auth-int"')),e===null&&(n.substr(t,4).toLowerCase()==="auth"?(e=n.substr(t,4),t+=4):(e=null,u===0&&h('"auth"')),e===null&&(e=G())),e!==null&&(e=(function(l,f){T.qop||(T.qop=[]),T.qop.push(f.toLowerCase())})(r,e)),e===null&&(t=r),e}function ou(){var e,r,l,f,d,_;if(d=t,e=G(),e!==null){for(r=[],_=t,l=V(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=V(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function uu(){var e,r,l,f,d,_,v;if(d=t,_=t,e=mn(),e!==null){for(r=[],v=t,l=V(),l!==null?(f=mn(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=V(),l!==null?(f=mn(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E){var O,j;for(j=T.multi_header.length,O=0;O<j;O++)if(T.multi_header[O].parsed===null){T=null;break}T!==null?T=T.multi_header:T=-1})(d)),e===null&&(t=d),e}function mn(){var e,r,l,f,d,_,v;if(d=t,_=t,e=Ze(),e!==null){for(r=[],v=t,l=q(),l!==null?(f=oe(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=q(),l!==null?(f=oe(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E){var O;T.multi_header||(T.multi_header=[]);try{O=new ft(T.uri,T.display_name,T.params),delete T.uri,delete T.display_name,delete T.params}catch{O=null}T.multi_header.push({possition:t,offset:E,parsed:O})})(d)),e===null&&(t=d),e}function fu(){var e,r,l,f,d,_,v;if(d=t,_=t,n.substr(t,3).toLowerCase()==="sip"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"SIP"')),e===null&&(e=G()),e!==null){for(r=[],v=t,l=q(),l!==null?(f=Dr(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=q(),l!==null?(f=Dr(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E,O){if(T.protocol=O.toLowerCase(),T.params||(T.params={}),T.params.text&&T.params.text[0]==='"'){var j=T.params.text;T.text=j.substring(1,j.length-1),delete T.params.text}})(d,e[0])),e===null&&(t=d),e}function Dr(){var e;return e=Vs(),e===null&&(e=oe()),e}function Vs(){var e,r,l,f,d,_;if(d=t,_=t,n.substr(t,5).toLowerCase()==="cause"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"cause"')),e!==null)if(r=M(),r!==null){if(f=m(),f!==null)for(l=[];f!==null;)l.push(f),f=m();else l=null;l!==null?e=[e,r,l]:(e=null,t=_)}else e=null,t=_;else e=null,t=_;return e!==null&&(e=(function(v,E){T.cause=parseInt(E.join(""))})(d,e[2])),e===null&&(t=d),e}function cu(){var e,r,l,f,d,_;if(d=t,e=G(),e!==null){for(r=[],_=t,l=V(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=V(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function hu(){var e,r,l,f,d,_;if(d=t,e=yn(),e!==null){for(r=[],_=t,l=V(),l!==null?(f=yn(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=V(),l!==null?(f=yn(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function yn(){var e,r,l,f,d,_;if(d=t,e=Ze(),e!==null){for(r=[],_=t,l=q(),l!==null?(f=oe(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=q(),l!==null?(f=oe(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function du(){var e,r,l,f,d,_;if(d=t,e=zs(),e!==null){for(r=[],_=t,l=q(),l!==null?(f=xr(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=q(),l!==null?(f=xr(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function zs(){var e,r;return r=t,n.substr(t,6).toLowerCase()==="active"?(e=n.substr(t,6),t+=6):(e=null,u===0&&h('"active"')),e===null&&(n.substr(t,7).toLowerCase()==="pending"?(e=n.substr(t,7),t+=7):(e=null,u===0&&h('"pending"')),e===null&&(n.substr(t,10).toLowerCase()==="terminated"?(e=n.substr(t,10),t+=10):(e=null,u===0&&h('"terminated"')),e===null&&(e=G()))),e!==null&&(e=(function(l){T.state=n.substring(t,l)})(r)),e===null&&(t=r),e}function xr(){var e,r,l,f,d;return f=t,d=t,n.substr(t,6).toLowerCase()==="reason"?(e=n.substr(t,6),t+=6):(e=null,u===0&&h('"reason"')),e!==null?(r=M(),r!==null?(l=Ks(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){typeof v<"u"&&(T.reason=v)})(f,e[2])),e===null&&(t=f),e===null&&(f=t,d=t,n.substr(t,7).toLowerCase()==="expires"?(e=n.substr(t,7),t+=7):(e=null,u===0&&h('"expires"')),e!==null?(r=M(),r!==null?(l=et(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){typeof v<"u"&&(T.expires=v)})(f,e[2])),e===null&&(t=f),e===null&&(f=t,d=t,n.substr(t,11).toLowerCase()==="retry_after"?(e=n.substr(t,11),t+=11):(e=null,u===0&&h('"retry_after"')),e!==null?(r=M(),r!==null?(l=et(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){typeof v<"u"&&(T.retry_after=v)})(f,e[2])),e===null&&(t=f),e===null&&(e=oe()))),e}function Ks(){var e;return n.substr(t,11).toLowerCase()==="deactivated"?(e=n.substr(t,11),t+=11):(e=null,u===0&&h('"deactivated"')),e===null&&(n.substr(t,9).toLowerCase()==="probation"?(e=n.substr(t,9),t+=9):(e=null,u===0&&h('"probation"')),e===null&&(n.substr(t,8).toLowerCase()==="rejected"?(e=n.substr(t,8),t+=8):(e=null,u===0&&h('"rejected"')),e===null&&(n.substr(t,7).toLowerCase()==="timeout"?(e=n.substr(t,7),t+=7):(e=null,u===0&&h('"timeout"')),e===null&&(n.substr(t,6).toLowerCase()==="giveup"?(e=n.substr(t,6),t+=6):(e=null,u===0&&h('"giveup"')),e===null&&(n.substr(t,10).toLowerCase()==="noresource"?(e=n.substr(t,10),t+=10):(e=null,u===0&&h('"noresource"')),e===null&&(n.substr(t,9).toLowerCase()==="invariant"?(e=n.substr(t,9),t+=9):(e=null,u===0&&h('"invariant"')),e===null&&(e=G()))))))),e}function _u(){var e;return e=we(),e=e!==null?e:"",e}function pu(){var e,r,l,f,d,_;if(d=t,e=G(),e!==null){for(r=[],_=t,l=V(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=V(),l!==null?(f=G(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e=e!==null?e:"",e}function vu(){var e,r,l,f,d,_,v;if(d=t,_=t,e=Rt(),e===null&&(e=Ze()),e!==null){for(r=[],v=t,l=q(),l!==null?(f=Pr(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=q(),l!==null?(f=Pr(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E){var O=T.tag;try{T=new ft(T.uri,T.display_name,T.params),O&&T.setParam("tag",O)}catch{T=-1}})(d)),e===null&&(t=d),e}function Pr(){var e;return e=Nr(),e===null&&(e=oe()),e}function gu(){var e,r,l,f,d,_;if(d=t,e=Tn(),e!==null){for(r=[],_=t,l=V(),l!==null?(f=Tn(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=V(),l!==null?(f=Tn(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function Tn(){var e,r,l,f,d,_,v,E;if(v=t,e=el(),e!==null)if(r=ie(),r!==null)if(l=rl(),l!==null){for(f=[],E=t,d=q(),d!==null?(_=Ur(),_!==null?d=[d,_]:(d=null,t=E)):(d=null,t=E);d!==null;)f.push(d),E=t,d=q(),d!==null?(_=Ur(),_!==null?d=[d,_]:(d=null,t=E)):(d=null,t=E);f!==null?e=[e,r,l,f]:(e=null,t=v)}else e=null,t=v;else e=null,t=v;else e=null,t=v;return e}function Ur(){var e;return e=$s(),e===null&&(e=Ys(),e===null&&(e=Js(),e===null&&(e=Xs(),e===null&&(e=Qs(),e===null&&(e=oe()))))),e}function $s(){var e,r,l,f,d;return f=t,d=t,n.substr(t,3).toLowerCase()==="ttl"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"ttl"')),e!==null?(r=M(),r!==null?(l=Mr(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.ttl=v})(f,e[2])),e===null&&(t=f),e}function Ys(){var e,r,l,f,d;return f=t,d=t,n.substr(t,5).toLowerCase()==="maddr"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"maddr"')),e!==null?(r=M(),r!==null?(l=wt(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.maddr=v})(f,e[2])),e===null&&(t=f),e}function Js(){var e,r,l,f,d;return f=t,d=t,n.substr(t,8).toLowerCase()==="received"?(e=n.substr(t,8),t+=8):(e=null,u===0&&h('"received"')),e!==null?(r=M(),r!==null?(l=It(),l===null&&(l=Sr()),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.received=v})(f,e[2])),e===null&&(t=f),e}function Xs(){var e,r,l,f,d;return f=t,d=t,n.substr(t,6).toLowerCase()==="branch"?(e=n.substr(t,6),t+=6):(e=null,u===0&&h('"branch"')),e!==null?(r=M(),r!==null?(l=G(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.branch=v})(f,e[2])),e===null&&(t=f),e}function Qs(){var e,r,l,f,d;return f=t,n.substr(t,5).toLowerCase()==="rport"?(e=n.substr(t,5),t+=5):(e=null,u===0&&h('"rport"')),e!==null?(d=t,r=M(),r!==null?(l=Zs(),l!==null?r=[r,l]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e}function Zs(){var e,r,l,f,d,_,v;return _=t,v=t,e=m(),e=e!==null?e:"",e!==null?(r=m(),r=r!==null?r:"",r!==null?(l=m(),l=l!==null?l:"",l!==null?(f=m(),f=f!==null?f:"",f!==null?(d=m(),d=d!==null?d:"",d!==null?e=[e,r,l,f,d]:(e=null,t=v)):(e=null,t=v)):(e=null,t=v)):(e=null,t=v)):(e=null,t=v),e!==null&&(e=(function(E,O){T.rport=parseInt(O.join(""))})(_,e)),e===null&&(t=_),e}function el(){var e,r,l,f,d,_;return _=t,e=tl(),e!==null?(r=ut(),r!==null?(l=G(),l!==null?(f=ut(),f!==null?(d=nl(),d!==null?e=[e,r,l,f,d]:(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_)):(e=null,t=_),e}function tl(){var e,r;return r=t,n.substr(t,3).toLowerCase()==="sip"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"SIP"')),e===null&&(e=G()),e!==null&&(e=(function(l,f){T.protocol=f})(r,e)),e===null&&(t=r),e}function nl(){var e,r;return r=t,n.substr(t,3).toLowerCase()==="udp"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"UDP"')),e===null&&(n.substr(t,3).toLowerCase()==="tcp"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"TCP"')),e===null&&(n.substr(t,3).toLowerCase()==="tls"?(e=n.substr(t,3),t+=3):(e=null,u===0&&h('"TLS"')),e===null&&(n.substr(t,4).toLowerCase()==="sctp"?(e=n.substr(t,4),t+=4):(e=null,u===0&&h('"SCTP"')),e===null&&(e=G())))),e!==null&&(e=(function(l,f){T.transport=f})(r,e)),e===null&&(t=r),e}function rl(){var e,r,l,f,d;return f=t,e=il(),e!==null?(d=t,r=Xe(),r!==null?(l=sl(),l!==null?r=[r,l]:(r=null,t=d)):(r=null,t=d),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=f)):(e=null,t=f),e}function il(){var e,r;return r=t,e=It(),e===null&&(e=Tr(),e===null&&(e=mr())),e!==null&&(e=(function(l){T.host=n.substring(t,l)})(r)),e===null&&(t=r),e}function sl(){var e,r,l,f,d,_,v;return _=t,v=t,e=m(),e=e!==null?e:"",e!==null?(r=m(),r=r!==null?r:"",r!==null?(l=m(),l=l!==null?l:"",l!==null?(f=m(),f=f!==null?f:"",f!==null?(d=m(),d=d!==null?d:"",d!==null?e=[e,r,l,f,d]:(e=null,t=v)):(e=null,t=v)):(e=null,t=v)):(e=null,t=v)):(e=null,t=v),e!==null&&(e=(function(E,O){T.port=parseInt(O.join(""))})(_,e)),e===null&&(t=_),e}function Mr(){var e,r,l,f,d;return f=t,d=t,e=m(),e!==null?(r=m(),r=r!==null?r:"",r!==null?(l=m(),l=l!==null?l:"",l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){return parseInt(v.join(""))})(f,e)),e===null&&(t=f),e}function mu(){var e;return e=kr(),e}function yu(){var e,r,l,f,d,_;if(d=t,e=ll(),e!==null){for(r=[],_=t,l=q(),l!==null?(f=Fr(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=q(),l!==null?(f=Fr(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function ll(){var e,r;return r=t,e=et(),e!==null&&(e=(function(l,f){T.expires=f})(r,e)),e===null&&(t=r),e}function Fr(){var e;return e=al(),e===null&&(e=oe()),e}function al(){var e,r,l,f,d;return f=t,d=t,n.substr(t,9).toLowerCase()==="refresher"?(e=n.substr(t,9),t+=9):(e=null,u===0&&h('"refresher"')),e!==null?(r=M(),r!==null?(n.substr(t,3).toLowerCase()==="uac"?(l=n.substr(t,3),t+=3):(l=null,u===0&&h('"uac"')),l===null&&(n.substr(t,3).toLowerCase()==="uas"?(l=n.substr(t,3),t+=3):(l=null,u===0&&h('"uas"'))),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.refresher=v.toLowerCase()})(f,e[2])),e===null&&(t=f),e}function Tu(){var e,r,l,f;return f=t,e=G(),e!==null?(r=X(),r!==null?(l=ol(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function ol(){var e,r;for(e=[],r=me(),r===null&&(r=ke(),r===null&&(r=ie()));r!==null;)e.push(r),r=me(),r===null&&(r=ke(),r===null&&(r=ie()));return e}function Su(){var e,r;for(e=[],r=K();r!==null;)e.push(r),r=K();return e}function Cu(){var e,r,l;return l=t,n.substr(t,5)==="uuid:"?(e="uuid:",t+=5):(e=null,u===0&&h('"uuid:"')),e!==null?(r=ul(),r!==null?e=[e,r]:(e=null,t=l)):(e=null,t=l),e}function ul(){var e,r,l,f,d,_,v,E,O,j,te;return j=t,te=t,e=fl(),e!==null?(n.charCodeAt(t)===45?(r="-",t++):(r=null,u===0&&h('"-"')),r!==null?(l=Le(),l!==null?(n.charCodeAt(t)===45?(f="-",t++):(f=null,u===0&&h('"-"')),f!==null?(d=Le(),d!==null?(n.charCodeAt(t)===45?(_="-",t++):(_=null,u===0&&h('"-"')),_!==null?(v=Le(),v!==null?(n.charCodeAt(t)===45?(E="-",t++):(E=null,u===0&&h('"-"')),E!==null?(O=cl(),O!==null?e=[e,r,l,f,d,_,v,E,O]:(e=null,t=te)):(e=null,t=te)):(e=null,t=te)):(e=null,t=te)):(e=null,t=te)):(e=null,t=te)):(e=null,t=te)):(e=null,t=te)):(e=null,t=te),e!==null&&(e=(function(xe,Sn){T=n.substring(t+5,xe)})(j,e[0])),e===null&&(t=j),e}function Le(){var e,r,l,f,d;return d=t,e=x(),e!==null?(r=x(),r!==null?(l=x(),l!==null?(f=x(),f!==null?e=[e,r,l,f]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e}function fl(){var e,r,l;return l=t,e=Le(),e!==null?(r=Le(),r!==null?e=[e,r]:(e=null,t=l)):(e=null,t=l),e}function cl(){var e,r,l,f;return f=t,e=Le(),e!==null?(r=Le(),r!==null?(l=Le(),l!==null?e=[e,r,l]:(e=null,t=f)):(e=null,t=f)):(e=null,t=f),e}function Eu(){var e,r,l,f,d,_,v;if(d=t,_=t,e=Rt(),e===null&&(e=Ze()),e!==null){for(r=[],v=t,l=q(),l!==null?(f=oe(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);l!==null;)r.push(l),v=t,l=q(),l!==null?(f=oe(),f!==null?l=[l,f]:(l=null,t=v)):(l=null,t=v);r!==null?e=[e,r]:(e=null,t=_)}else e=null,t=_;return e!==null&&(e=(function(E){try{T=new ft(T.uri,T.display_name,T.params)}catch{T=-1}})(d)),e===null&&(t=d),e}function bu(){var e,r,l,f,d,_;if(d=t,e=hl(),e!==null){for(r=[],_=t,l=q(),l!==null?(f=Hr(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);l!==null;)r.push(l),_=t,l=q(),l!==null?(f=Hr(),f!==null?l=[l,f]:(l=null,t=_)):(l=null,t=_);r!==null?e=[e,r]:(e=null,t=d)}else e=null,t=d;return e}function hl(){var e,r,l,f,d,_;return f=t,d=t,e=De(),e!==null?(_=t,n.charCodeAt(t)===64?(r="@",t++):(r=null,u===0&&h('"@"')),r!==null?(l=De(),l!==null?r=[r,l]:(r=null,t=_)):(r=null,t=_),r=r!==null?r:"",r!==null?e=[e,r]:(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(v){T.call_id=n.substring(t,v)})(f)),e===null&&(t=f),e}function Hr(){var e;return e=dl(),e===null&&(e=_l(),e===null&&(e=pl(),e===null&&(e=oe()))),e}function dl(){var e,r,l,f,d;return f=t,d=t,n.substr(t,6)==="to-tag"?(e="to-tag",t+=6):(e=null,u===0&&h('"to-tag"')),e!==null?(r=M(),r!==null?(l=G(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.to_tag=v})(f,e[2])),e===null&&(t=f),e}function _l(){var e,r,l,f,d;return f=t,d=t,n.substr(t,8)==="from-tag"?(e="from-tag",t+=8):(e=null,u===0&&h('"from-tag"')),e!==null?(r=M(),r!==null?(l=G(),l!==null?e=[e,r,l]:(e=null,t=d)):(e=null,t=d)):(e=null,t=d),e!==null&&(e=(function(_,v){T.from_tag=v})(f,e[2])),e===null&&(t=f),e}function pl(){var e,r;return r=t,n.substr(t,10)==="early-only"?(e="early-only",t+=10):(e=null,u===0&&h('"early-only"')),e!==null&&(e=(function(l){T.early_only=!0})(r)),e===null&&(t=r),e}function Au(e){e.sort();for(var r=null,l=[],f=0;f<e.length;f++)e[f]!==r&&(l.push(e[f]),r=e[f]);return l}function Ru(){for(var e=1,r=1,l=!1,f=0;f<Math.max(t,p);f++){var d=n.charAt(f);d===`
`?(l||e++,r=1,l=!1):d==="\r"||d==="\u2028"||d==="\u2029"?(e++,r=1,l=!0):(r++,l=!1)}return{line:e,column:r}}var vl=je(),ft=wn(),T={},wu=c[s]();if(wu===null||t!==n.length){var Lr=Math.max(t,p),Iu=Lr<n.length?n.charAt(Lr):null,gl=Ru();return new this.SyntaxError(Au(g),Iu,Lr,gl.line,gl.column),-1}return T},toSource:function(){return this._source}};return o.SyntaxError=function(i,n,s,c,t){function u(p,g){var y,S;switch(p.length){case 0:y="end of input";break;case 1:y=p[0];break;default:y=p.slice(0,p.length-1).join(", ")+" or "+p[p.length-1]}return S=g?a(g):"end of input","Expected "+y+" but "+S+" found."}this.name="SyntaxError",this.expected=i,this.found=n,this.message=u(i,n),this.offset=s,this.line=c,this.column=t},o.SyntaxError.prototype=Error.prototype,o})()});var je=B((xd,Nl)=>{"use strict";function Gu(a,o){var i;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(i=Wu(a))||o&&a&&typeof a.length=="number"){i&&(a=i);var n=0,s=function(){};return{s,n:function(){return n>=a.length?{done:!0}:{done:!1,value:a[n++]}},e:function(g){throw g},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,t=!1,u;return{s:function(){i=a[Symbol.iterator]()},n:function(){var g=i.next();return c=g.done,g},e:function(g){t=!0,u=g},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(t)throw u}}}}function Wu(a,o){if(a){if(typeof a=="string")return wl(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return wl(a,o)}}function wl(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,n=new Array(o);i<o;i++)n[i]=a[i];return n}function Bu(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function Il(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Ol(a,o,i){return o&&Il(a.prototype,o),i&&Il(a,i),a}var Vu=ae(),dt=de(),zu=Oe();Nl.exports=(function(){Ol(a,null,[{key:"parse",value:function(i){if(i=zu.parse(i,"SIP_URI"),i!==-1)return i}}]);function a(o,i,n,s){var c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},t=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(Bu(this,a),!n)throw new TypeError('missing or invalid "host" parameter');this._parameters={},this._headers={},this._scheme=o||Vu.SIP,this._user=i,this._host=n,this._port=s;for(var u in c)Object.prototype.hasOwnProperty.call(c,u)&&this.setParam(u,c[u]);for(var p in t)Object.prototype.hasOwnProperty.call(t,p)&&this.setHeader(p,t[p])}return Ol(a,[{key:"setParam",value:function(i,n){i&&(this._parameters[i.toLowerCase()]=typeof n>"u"||n===null?null:n.toString())}},{key:"getParam",value:function(i){if(i)return this._parameters[i.toLowerCase()]}},{key:"hasParam",value:function(i){if(i)return this._parameters.hasOwnProperty(i.toLowerCase())&&!0||!1}},{key:"deleteParam",value:function(i){if(i=i.toLowerCase(),this._parameters.hasOwnProperty(i)){var n=this._parameters[i];return delete this._parameters[i],n}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"setHeader",value:function(i,n){this._headers[dt.headerize(i)]=Array.isArray(n)?n:[n]}},{key:"getHeader",value:function(i){if(i)return this._headers[dt.headerize(i)]}},{key:"hasHeader",value:function(i){if(i)return this._headers.hasOwnProperty(dt.headerize(i))&&!0||!1}},{key:"deleteHeader",value:function(i){if(i=dt.headerize(i),this._headers.hasOwnProperty(i)){var n=this._headers[i];return delete this._headers[i],n}}},{key:"clearHeaders",value:function(){this._headers={}}},{key:"clone",value:function(){return new a(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}},{key:"toString",value:function(){var i=[],n="".concat(this._scheme,":");this._user&&(n+="".concat(dt.escapeUser(this._user),"@")),n+=this._host,(this._port||this._port===0)&&(n+=":".concat(this._port));for(var s in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,s)&&(n+=";".concat(s),this._parameters[s]!==null&&(n+="=".concat(this._parameters[s])));for(var c in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,c)){var t=Gu(this._headers[c]),u;try{for(t.s();!(u=t.n()).done;){var p=u.value;i.push("".concat(c,"=").concat(p))}}catch(g){t.e(g)}finally{t.f()}}return i.length>0&&(n+="?".concat(i.join("&"))),n}},{key:"toAor",value:function(i){var n="".concat(this._scheme,":");return this._user&&(n+="".concat(dt.escapeUser(this._user),"@")),n+=this._host,i&&(this._port||this._port===0)&&(n+=":".concat(this._port)),n}},{key:"scheme",get:function(){return this._scheme},set:function(i){this._scheme=i.toLowerCase()}},{key:"user",get:function(){return this._user},set:function(i){this._user=i}},{key:"host",get:function(){return this._host},set:function(i){this._host=i.toLowerCase()}},{key:"port",get:function(){return this._port},set:function(i){this._port=i===0?i:parseInt(i,10)||null}}]),a})()});var de=B(ue=>{"use strict";function In(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?In=function(i){return typeof i}:In=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},In(a)}function Gr(a,o){var i;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(i=Ku(a))||o&&a&&typeof a.length=="number"){i&&(a=i);var n=0,s=function(){};return{s,n:function(){return n>=a.length?{done:!0}:{done:!1,value:a[n++]}},e:function(g){throw g},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,t=!1,u;return{s:function(){i=a[Symbol.iterator]()},n:function(){var g=i.next();return c=g.done,g},e:function(g){t=!0,u=g},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(t)throw u}}}}function Ku(a,o){if(a){if(typeof a=="string")return kl(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return kl(a,o)}}function kl(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,n=new Array(o);i<o;i++)n[i]=a[i];return n}var Lt=ae(),Dl=je(),$u=Oe();ue.str_utf8_length=function(a){return unescape(encodeURIComponent(a)).length};var Yu=ue.isFunction=function(a){return a!==void 0?Object.prototype.toString.call(a)==="[object Function]":!1};ue.isString=function(a){return a!==void 0?Object.prototype.toString.call(a)==="[object String]":!1};ue.isDecimal=function(a){return!isNaN(a)&&parseFloat(a)===parseInt(a,10)};ue.isEmpty=function(a){return a===null||a===""||a===void 0||Array.isArray(a)&&a.length===0||typeof a=="number"&&isNaN(a)};ue.hasMethods=function(a){for(var o=arguments.length,i=new Array(o>1?o-1:0),n=1;n<o;n++)i[n-1]=arguments[n];for(var s=0,c=i;s<c.length;s++){var t=c[s];if(Yu(a[t]))return!1}return!0};var Ju=ue.createRandomToken=function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:32,i,n,s="";for(i=0;i<a;i++)n=Math.random()*o|0,s+=n.toString(o);return s};ue.newTag=function(){return Ju(10)};ue.newUUID=function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var i=Math.random()*16|0,n=o==="x"?i:i&3|8;return n.toString(16)});return a};ue.hostType=function(a){if(a){if(a=$u.parse(a,"host"),a!==-1)return a.host_type}else return};var Xu=ue.escapeUser=function(a){return encodeURIComponent(decodeURIComponent(a)).replace(/%3A/ig,":").replace(/%2B/ig,"+").replace(/%3F/ig,"?").replace(/%2F/ig,"/")};ue.normalizeTarget=function(a,o){if(a){if(a instanceof Dl)return a;if(typeof a=="string"){var i=a.split("@"),n,s;switch(i.length){case 1:if(!o)return;n=a,s=o;break;case 2:n=i[0],s=i[1];break;default:n=i.slice(0,i.length-1).join("@"),s=i[i.length-1]}n=n.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(n)&&(n=n.replace(/[-.()]/g,"")),a="".concat(Lt.SIP,":").concat(Xu(n),"@").concat(s);var c;return(c=Dl.parse(a))?c:void 0}else return}else return};ue.headerize=function(a){var o={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},i=a.toLowerCase().replace(/_/g,"-").split("-"),n="",s=i.length,c;for(c=0;c<s;c++)c!==0&&(n+="-"),n+=i[c].charAt(0).toUpperCase()+i[c].substring(1);return o[n]&&(n=o[n]),n};ue.sipErrorCause=function(a){for(var o in Lt.SIP_ERROR_CAUSES)if(Lt.SIP_ERROR_CAUSES[o].indexOf(a)!==-1)return Lt.causes[o];return Lt.causes.SIP_FAILURE_CODE};ue.getRandomTestNetIP=function(){function a(o,i){return Math.floor(Math.random()*(i-o+1)+o)}return"192.0.2.".concat(a(1,254))};ue.calculateMD5=function(a){function o(M,W){return M<<W|M>>>32-W}function i(M,W){var z=M&2147483648,$=W&2147483648,le=M&1073741824,V=W&1073741824,q=(M&1073741823)+(W&1073741823);return le&V?q^2147483648^z^$:le|V?q&1073741824?q^3221225472^z^$:q^1073741824^z^$:q^z^$}function n(M,W,z){return M&W|~M&z}function s(M,W,z){return M&z|W&~z}function c(M,W,z){return M^W^z}function t(M,W,z){return W^(M|~z)}function u(M,W,z,$,le,V,q){return M=i(M,i(i(n(W,z,$),le),q)),i(o(M,V),W)}function p(M,W,z,$,le,V,q){return M=i(M,i(i(s(W,z,$),le),q)),i(o(M,V),W)}function g(M,W,z,$,le,V,q){return M=i(M,i(i(c(W,z,$),le),q)),i(o(M,V),W)}function y(M,W,z,$,le,V,q){return M=i(M,i(i(t(W,z,$),le),q)),i(o(M,V),W)}function S(M){for(var W,z=M.length,$=z+8,le=($-$%64)/64,V=(le+1)*16,q=new Array(V-1),Xe=0,Se=0;Se<z;)W=(Se-Se%4)/4,Xe=Se%4*8,q[W]=q[W]|M.charCodeAt(Se)<<Xe,Se++;return W=(Se-Se%4)/4,Xe=Se%4*8,q[W]=q[W]|128<<Xe,q[V-2]=z<<3,q[V-1]=z>>>29,q}function h(M){var W="",z="",$,le;for(le=0;le<=3;le++)$=M>>>le*8&255,z="0".concat($.toString(16)),W=W+z.substr(z.length-2,2);return W}function A(M){for(var W="",z=0;z<M.length;z++){var $=M.charCodeAt(z);$<128?W+=String.fromCharCode($):$>127&&$<2048?(W+=String.fromCharCode($>>6|192),W+=String.fromCharCode($&63|128)):(W+=String.fromCharCode($>>12|224),W+=String.fromCharCode($>>6&63|128),W+=String.fromCharCode($&63|128))}return W}var m=[],C,x,L,K,Q,R,k,w,D,J=7,he=12,ee=17,ie=22,Y=5,X=9,we=14,me=20,Ie=4,ke=11,at=16,G=23,He=6,ot=10,De=15,Je=21;for(a=A(a),m=S(a),R=1732584193,k=4023233417,w=2562383102,D=271733878,C=0;C<m.length;C+=16)x=R,L=k,K=w,Q=D,R=u(R,k,w,D,m[C+0],J,3614090360),D=u(D,R,k,w,m[C+1],he,3905402710),w=u(w,D,R,k,m[C+2],ee,606105819),k=u(k,w,D,R,m[C+3],ie,3250441966),R=u(R,k,w,D,m[C+4],J,4118548399),D=u(D,R,k,w,m[C+5],he,1200080426),w=u(w,D,R,k,m[C+6],ee,2821735955),k=u(k,w,D,R,m[C+7],ie,4249261313),R=u(R,k,w,D,m[C+8],J,1770035416),D=u(D,R,k,w,m[C+9],he,2336552879),w=u(w,D,R,k,m[C+10],ee,4294925233),k=u(k,w,D,R,m[C+11],ie,2304563134),R=u(R,k,w,D,m[C+12],J,1804603682),D=u(D,R,k,w,m[C+13],he,4254626195),w=u(w,D,R,k,m[C+14],ee,2792965006),k=u(k,w,D,R,m[C+15],ie,1236535329),R=p(R,k,w,D,m[C+1],Y,4129170786),D=p(D,R,k,w,m[C+6],X,3225465664),w=p(w,D,R,k,m[C+11],we,643717713),k=p(k,w,D,R,m[C+0],me,3921069994),R=p(R,k,w,D,m[C+5],Y,3593408605),D=p(D,R,k,w,m[C+10],X,38016083),w=p(w,D,R,k,m[C+15],we,3634488961),k=p(k,w,D,R,m[C+4],me,3889429448),R=p(R,k,w,D,m[C+9],Y,568446438),D=p(D,R,k,w,m[C+14],X,3275163606),w=p(w,D,R,k,m[C+3],we,4107603335),k=p(k,w,D,R,m[C+8],me,1163531501),R=p(R,k,w,D,m[C+13],Y,2850285829),D=p(D,R,k,w,m[C+2],X,4243563512),w=p(w,D,R,k,m[C+7],we,1735328473),k=p(k,w,D,R,m[C+12],me,2368359562),R=g(R,k,w,D,m[C+5],Ie,4294588738),D=g(D,R,k,w,m[C+8],ke,2272392833),w=g(w,D,R,k,m[C+11],at,1839030562),k=g(k,w,D,R,m[C+14],G,4259657740),R=g(R,k,w,D,m[C+1],Ie,2763975236),D=g(D,R,k,w,m[C+4],ke,1272893353),w=g(w,D,R,k,m[C+7],at,4139469664),k=g(k,w,D,R,m[C+10],G,3200236656),R=g(R,k,w,D,m[C+13],Ie,681279174),D=g(D,R,k,w,m[C+0],ke,3936430074),w=g(w,D,R,k,m[C+3],at,3572445317),k=g(k,w,D,R,m[C+6],G,76029189),R=g(R,k,w,D,m[C+9],Ie,3654602809),D=g(D,R,k,w,m[C+12],ke,3873151461),w=g(w,D,R,k,m[C+15],at,530742520),k=g(k,w,D,R,m[C+2],G,3299628645),R=y(R,k,w,D,m[C+0],He,4096336452),D=y(D,R,k,w,m[C+7],ot,1126891415),w=y(w,D,R,k,m[C+14],De,2878612391),k=y(k,w,D,R,m[C+5],Je,4237533241),R=y(R,k,w,D,m[C+12],He,1700485571),D=y(D,R,k,w,m[C+3],ot,2399980690),w=y(w,D,R,k,m[C+10],De,4293915773),k=y(k,w,D,R,m[C+1],Je,2240044497),R=y(R,k,w,D,m[C+8],He,1873313359),D=y(D,R,k,w,m[C+15],ot,4264355552),w=y(w,D,R,k,m[C+6],De,2734768916),k=y(k,w,D,R,m[C+13],Je,1309151649),R=y(R,k,w,D,m[C+4],He,4149444226),D=y(D,R,k,w,m[C+11],ot,3174756917),w=y(w,D,R,k,m[C+2],De,718787259),k=y(k,w,D,R,m[C+9],Je,3951481745),R=i(R,x),k=i(k,L),w=i(w,K),D=i(D,Q);var ut=h(R)+h(k)+h(w)+h(D);return ut.toLowerCase()};ue.closeMediaStream=function(a){if(a)try{var o;if(a.getTracks){o=a.getTracks();var i=Gr(o),n;try{for(i.s();!(n=i.n()).done;){var s=n.value;s.stop()}}catch(S){i.e(S)}finally{i.f()}}else{o=a.getAudioTracks();var c=Gr(o),t;try{for(c.s();!(t=c.n()).done;){var u=t.value;u.stop()}}catch(S){c.e(S)}finally{c.f()}o=a.getVideoTracks();var p=Gr(o),g;try{for(p.s();!(g=p.n()).done;){var y=g.value;y.stop()}}catch(S){p.e(S)}finally{p.f()}}}catch{(typeof a.stop=="function"||In(a.stop)==="object")&&a.stop()}};ue.cloneArray=function(a){return a&&a.slice()||[]};ue.cloneObject=function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a&&Object.assign({},a)||o}});var Ge=B((Ud,Wr)=>{"use strict";var _t=typeof Reflect=="object"?Reflect:null,xl=_t&&typeof _t.apply=="function"?_t.apply:function(o,i,n){return Function.prototype.apply.call(o,i,n)},On;_t&&typeof _t.ownKeys=="function"?On=_t.ownKeys:Object.getOwnPropertySymbols?On=function(o){return Object.getOwnPropertyNames(o).concat(Object.getOwnPropertySymbols(o))}:On=function(o){return Object.getOwnPropertyNames(o)};function Qu(a){console&&console.warn&&console.warn(a)}var Ul=Number.isNaN||function(o){return o!==o};function Z(){Z.init.call(this)}Wr.exports=Z;Wr.exports.once=nf;Z.EventEmitter=Z;Z.prototype._events=void 0;Z.prototype._eventsCount=0;Z.prototype._maxListeners=void 0;var Pl=10;function Nn(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(Z,"defaultMaxListeners",{enumerable:!0,get:function(){return Pl},set:function(a){if(typeof a!="number"||a<0||Ul(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");Pl=a}});Z.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Z.prototype.setMaxListeners=function(o){if(typeof o!="number"||o<0||Ul(o))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+o+".");return this._maxListeners=o,this};function Ml(a){return a._maxListeners===void 0?Z.defaultMaxListeners:a._maxListeners}Z.prototype.getMaxListeners=function(){return Ml(this)};Z.prototype.emit=function(o){for(var i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);var s=o==="error",c=this._events;if(c!==void 0)s=s&&c.error===void 0;else if(!s)return!1;if(s){var t;if(i.length>0&&(t=i[0]),t instanceof Error)throw t;var u=new Error("Unhandled error."+(t?" ("+t.message+")":""));throw u.context=t,u}var p=c[o];if(p===void 0)return!1;if(typeof p=="function")xl(p,this,i);else for(var g=p.length,y=jl(p,g),n=0;n<g;++n)xl(y[n],this,i);return!0};function Fl(a,o,i,n){var s,c,t;if(Nn(i),c=a._events,c===void 0?(c=a._events=Object.create(null),a._eventsCount=0):(c.newListener!==void 0&&(a.emit("newListener",o,i.listener?i.listener:i),c=a._events),t=c[o]),t===void 0)t=c[o]=i,++a._eventsCount;else if(typeof t=="function"?t=c[o]=n?[i,t]:[t,i]:n?t.unshift(i):t.push(i),s=Ml(a),s>0&&t.length>s&&!t.warned){t.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+t.length+" "+String(o)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=a,u.type=o,u.count=t.length,Qu(u)}return a}Z.prototype.addListener=function(o,i){return Fl(this,o,i,!1)};Z.prototype.on=Z.prototype.addListener;Z.prototype.prependListener=function(o,i){return Fl(this,o,i,!0)};function Zu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Hl(a,o,i){var n={fired:!1,wrapFn:void 0,target:a,type:o,listener:i},s=Zu.bind(n);return s.listener=i,n.wrapFn=s,s}Z.prototype.once=function(o,i){return Nn(i),this.on(o,Hl(this,o,i)),this};Z.prototype.prependOnceListener=function(o,i){return Nn(i),this.prependListener(o,Hl(this,o,i)),this};Z.prototype.removeListener=function(o,i){var n,s,c,t,u;if(Nn(i),s=this._events,s===void 0)return this;if(n=s[o],n===void 0)return this;if(n===i||n.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete s[o],s.removeListener&&this.emit("removeListener",o,n.listener||i));else if(typeof n!="function"){for(c=-1,t=n.length-1;t>=0;t--)if(n[t]===i||n[t].listener===i){u=n[t].listener,c=t;break}if(c<0)return this;c===0?n.shift():ef(n,c),n.length===1&&(s[o]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",o,u||i)}return this};Z.prototype.off=Z.prototype.removeListener;Z.prototype.removeAllListeners=function(o){var i,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[o]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[o]),this;if(arguments.length===0){var c=Object.keys(n),t;for(s=0;s<c.length;++s)t=c[s],t!=="removeListener"&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=n[o],typeof i=="function")this.removeListener(o,i);else if(i!==void 0)for(s=i.length-1;s>=0;s--)this.removeListener(o,i[s]);return this};function Ll(a,o,i){var n=a._events;if(n===void 0)return[];var s=n[o];return s===void 0?[]:typeof s=="function"?i?[s.listener||s]:[s]:i?tf(s):jl(s,s.length)}Z.prototype.listeners=function(o){return Ll(this,o,!0)};Z.prototype.rawListeners=function(o){return Ll(this,o,!1)};Z.listenerCount=function(a,o){return typeof a.listenerCount=="function"?a.listenerCount(o):ql.call(a,o)};Z.prototype.listenerCount=ql;function ql(a){var o=this._events;if(o!==void 0){var i=o[a];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}Z.prototype.eventNames=function(){return this._eventsCount>0?On(this._events):[]};function jl(a,o){for(var i=new Array(o),n=0;n<o;++n)i[n]=a[n];return i}function ef(a,o){for(;o+1<a.length;o++)a[o]=a[o+1];a.pop()}function tf(a){for(var o=new Array(a.length),i=0;i<o.length;++i)o[i]=a[i].listener||a[i];return o}function nf(a,o){return new Promise(function(i,n){function s(t){a.removeListener(o,c),n(t)}function c(){typeof a.removeListener=="function"&&a.removeListener("error",s),i([].slice.call(arguments))}Gl(a,o,c,{once:!0}),o!=="error"&&rf(a,s,{once:!0})})}function rf(a,o,i){typeof a.on=="function"&&Gl(a,"error",o,i)}function Gl(a,o,i,n){if(typeof a.on=="function")n.once?a.once(o,i):a.on(o,i);else if(typeof a.addEventListener=="function")a.addEventListener(o,function s(c){n.once&&a.removeEventListener(o,s),i(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}});var Bl=B((Md,Wl)=>{"use strict";var pt=1e3,vt=pt*60,gt=vt*60,tt=gt*24,sf=tt*7,lf=tt*365.25;Wl.exports=function(a,o){o=o||{};var i=typeof a;if(i==="string"&&a.length>0)return af(a);if(i==="number"&&isFinite(a))return o.long?uf(a):of(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))};function af(a){if(a=String(a),!(a.length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(o){var i=parseFloat(o[1]),n=(o[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return i*lf;case"weeks":case"week":case"w":return i*sf;case"days":case"day":case"d":return i*tt;case"hours":case"hour":case"hrs":case"hr":case"h":return i*gt;case"minutes":case"minute":case"mins":case"min":case"m":return i*vt;case"seconds":case"second":case"secs":case"sec":case"s":return i*pt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}function of(a){var o=Math.abs(a);return o>=tt?Math.round(a/tt)+"d":o>=gt?Math.round(a/gt)+"h":o>=vt?Math.round(a/vt)+"m":o>=pt?Math.round(a/pt)+"s":a+"ms"}function uf(a){var o=Math.abs(a);return o>=tt?kn(a,o,tt,"day"):o>=gt?kn(a,o,gt,"hour"):o>=vt?kn(a,o,vt,"minute"):o>=pt?kn(a,o,pt,"second"):a+" ms"}function kn(a,o,i,n){var s=o>=i*1.5;return Math.round(a/i)+" "+n+(s?"s":"")}});var zl=B((Fd,Vl)=>{"use strict";function ff(a){i.debug=i,i.default=i,i.coerce=p,i.disable=t,i.enable=s,i.enabled=u,i.humanize=Bl(),i.destroy=g,Object.keys(a).forEach(y=>{i[y]=a[y]}),i.names=[],i.skips=[],i.formatters={};function o(y){let S=0;for(let h=0;h<y.length;h++)S=(S<<5)-S+y.charCodeAt(h),S|=0;return i.colors[Math.abs(S)%i.colors.length]}i.selectColor=o;function i(y){let S,h=null,A,m;function C(...x){if(!C.enabled)return;let L=C,K=Number(new Date),Q=K-(S||K);L.diff=Q,L.prev=S,L.curr=K,S=K,x[0]=i.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");let R=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(w,D)=>{if(w==="%%")return"%";R++;let J=i.formatters[D];if(typeof J=="function"){let he=x[R];w=J.call(L,he),x.splice(R,1),R--}return w}),i.formatArgs.call(L,x),(L.log||i.log).apply(L,x)}return C.namespace=y,C.useColors=i.useColors(),C.color=i.selectColor(y),C.extend=n,C.destroy=i.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(A!==i.namespaces&&(A=i.namespaces,m=i.enabled(y)),m),set:x=>{h=x}}),typeof i.init=="function"&&i.init(C),C}function n(y,S){let h=i(this.namespace+(typeof S>"u"?":":S)+y);return h.log=this.log,h}function s(y){i.save(y),i.namespaces=y,i.names=[],i.skips=[];let S=(typeof y=="string"?y:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let h of S)h[0]==="-"?i.skips.push(h.slice(1)):i.names.push(h)}function c(y,S){let h=0,A=0,m=-1,C=0;for(;h<y.length;)if(A<S.length&&(S[A]===y[h]||S[A]==="*"))S[A]==="*"?(m=A,C=h,A++):(h++,A++);else if(m!==-1)A=m+1,C++,h=C;else return!1;for(;A<S.length&&S[A]==="*";)A++;return A===S.length}function t(){let y=[...i.names,...i.skips.map(S=>"-"+S)].join(",");return i.enable(""),y}function u(y){for(let S of i.skips)if(c(y,S))return!1;for(let S of i.names)if(c(y,S))return!0;return!1}function p(y){return y instanceof Error?y.stack||y.message:y}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return i.enable(i.load()),i}Vl.exports=ff});var xn=B((Te,Dn)=>{"use strict";Te.formatArgs=hf;Te.save=df;Te.load=_f;Te.useColors=cf;Te.storage=pf();Te.destroy=(()=>{let a=!1;return()=>{a||(a=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Te.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function cf(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let a;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(a=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(a[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function hf(a){if(a[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+a[0]+(this.useColors?"%c ":" ")+"+"+Dn.exports.humanize(this.diff),!this.useColors)return;let o="color: "+this.color;a.splice(1,0,o,"color: inherit");let i=0,n=0;a[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(i++,s==="%c"&&(n=i))}),a.splice(n,0,o)}Te.log=console.debug||console.log||(()=>{});function df(a){try{a?Te.storage.setItem("debug",a):Te.storage.removeItem("debug")}catch{}}function _f(){let a;try{a=Te.storage.getItem("debug")||Te.storage.getItem("DEBUG")}catch{}return!a&&typeof process<"u"&&"env"in process&&(a=process.env.DEBUG),a}function pf(){try{return localStorage}catch{}}Dn.exports=zl()(Te);var{formatters:vf}=Dn.exports;vf.j=function(a){try{return JSON.stringify(a)}catch(o){return"[UnexpectedJSONParseError]: "+o.message}}});var ce=B((Hd,$l)=>{"use strict";function gf(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function Kl(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function mf(a,o,i){return o&&Kl(a.prototype,o),i&&Kl(a,i),a}var mt=xn(),yt="JsSIP";$l.exports=(function(){function a(o){gf(this,a),o?(this._debug=mt.default("".concat(yt,":").concat(o)),this._warn=mt.default("".concat(yt,":WARN:").concat(o)),this._error=mt.default("".concat(yt,":ERROR:").concat(o))):(this._debug=mt.default(yt),this._warn=mt.default("".concat(yt,":WARN")),this._error=mt.default("".concat(yt,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return mf(a,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),a})()});var Pn=B((Ld,Jl)=>{"use strict";var Yl=Jl.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":a.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return a.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return a.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(a){return"extmap:%d"+(a.direction?"/%s":"%v")+(a["encrypt-uri"]?" %s":"%v")+" %s"+(a.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(a){return a.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(a){var o="candidate:%s %d %s %d %s %d typ %s";return o+=a.raddr!=null?" raddr %s rport %d":"%v%v",o+=a.tcptype!=null?" tcptype %s":"%v",a.generation!=null&&(o+=" generation %d"),o+=a["network-id"]!=null?" network-id %d":"%v",o+=a["network-cost"]!=null?" network-cost %d":"%v",o}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(a){var o="ssrc:%d";return a.attribute!=null&&(o+=" %s",a.value!=null&&(o+=":%s")),o}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(a){return a.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(a){return a.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(a){return"imageattr:%s %s %s"+(a.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(a){return"simulcast:%s %s"+(a.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(a){return"ts-refclk:%s"+(a.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(a){var o="mediaclk:";return o+=a.id!=null?"id=%s %s":"%v%s",o+=a.mediaClockValue!=null?"=%s":"",o+=a.rateNumerator!=null?" rate=%s":"",o+=a.rateDenominator!=null?"/%s":"",o}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Yl).forEach(function(a){var o=Yl[a];o.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})})});var Zl=B(We=>{"use strict";var Tt=function(a){return String(Number(a))===a?Number(a):a},yf=function(a,o,i,n){if(n&&!i)o[n]=Tt(a[1]);else for(var s=0;s<i.length;s+=1)a[s+1]!=null&&(o[i[s]]=Tt(a[s+1]))},Tf=function(a,o,i){var n=a.name&&a.names;a.push&&!o[a.push]?o[a.push]=[]:n&&!o[a.name]&&(o[a.name]={});var s=a.push?{}:n?o[a.name]:o;yf(i.match(a.reg),s,a.names,a.name),a.push&&o[a.push].push(s)},Xl=Pn(),Sf=RegExp.prototype.test.bind(/^([a-z])=(.*)/);We.parse=function(a){var o={},i=[],n=o;return a.split(/(\r\n|\r|\n)/).filter(Sf).forEach(function(s){var c=s[0],t=s.slice(2);c==="m"&&(i.push({rtp:[],fmtp:[]}),n=i[i.length-1]);for(var u=0;u<(Xl[c]||[]).length;u+=1){var p=Xl[c][u];if(p.reg.test(t))return Tf(p,n,t)}}),o.media=i,o};var Ql=function(a,o){var i=o.split(/=(.+)/,2);return i.length===2?a[i[0]]=Tt(i[1]):i.length===1&&o.length>1&&(a[i[0]]=void 0),a};We.parseParams=function(a){return a.split(/;\s?/).reduce(Ql,{})};We.parseFmtpConfig=We.parseParams;We.parsePayloads=function(a){return a.toString().split(" ").map(Number)};We.parseRemoteCandidates=function(a){for(var o=[],i=a.split(" ").map(Tt),n=0;n<i.length;n+=3)o.push({component:i[n],ip:i[n+1],port:i[n+2]});return o};We.parseImageAttributes=function(a){return a.split(" ").map(function(o){return o.substring(1,o.length-1).split(",").reduce(Ql,{})})};We.parseSimulcastStreamList=function(a){return a.split(";").map(function(o){return o.split(",").map(function(i){var n,s=!1;return i[0]!=="~"?n=Tt(i):(n=Tt(i.substring(1,i.length)),s=!0),{scid:n,paused:s}})})}});var ta=B((jd,ea)=>{"use strict";var Br=Pn(),Cf=/%[sdv%]/g,Ef=function(a){var o=1,i=arguments,n=i.length;return a.replace(Cf,function(s){if(o>=n)return s;var c=i[o];switch(o+=1,s){case"%%":return"%";case"%s":return String(c);case"%d":return Number(c);case"%v":return""}})},qt=function(a,o,i){var n=o.format instanceof Function?o.format(o.push?i:i[o.name]):o.format,s=[a+"="+n];if(o.names)for(var c=0;c<o.names.length;c+=1){var t=o.names[c];o.name?s.push(i[o.name][t]):s.push(i[o.names[c]])}else s.push(i[o.name]);return Ef.apply(null,s)},bf=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Af=["i","c","b","a"];ea.exports=function(a,o){o=o||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(c){c.payloads==null&&(c.payloads="")});var i=o.outerOrder||bf,n=o.innerOrder||Af,s=[];return i.forEach(function(c){Br[c].forEach(function(t){t.name in a&&a[t.name]!=null?s.push(qt(c,t,a)):t.push in a&&a[t.push]!=null&&a[t.push].forEach(function(u){s.push(qt(c,t,u))})})}),a.media.forEach(function(c){s.push(qt("m",Br.m[0],c)),n.forEach(function(t){Br[t].forEach(function(u){u.name in c&&c[u.name]!=null?s.push(qt(t,u,c)):u.push in c&&c[u.push]!=null&&c[u.push].forEach(function(p){s.push(qt(t,u,p))})})})}),s.join(`\r
`)+`\r
`}});var Vr=B(Pe=>{"use strict";var nt=Zl(),Rf=ta(),wf=Pn();Pe.grammar=wf;Pe.write=Rf;Pe.parse=nt.parse;Pe.parseParams=nt.parseParams;Pe.parseFmtpConfig=nt.parseFmtpConfig;Pe.parsePayloads=nt.parsePayloads;Pe.parseRemoteCandidates=nt.parseRemoteCandidates;Pe.parseImageAttributes=nt.parseImageAttributes;Pe.parseSimulcastStreamList=nt.parseSimulcastStreamList});var Ue=B((Wd,oa)=>{"use strict";function Un(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Un=function(i){return typeof i}:Un=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Un(a)}function $r(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&Kr(a,o)}function Kr(a,o){return Kr=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},Kr(a,o)}function Yr(a){var o=Nf();return function(){var n=Mn(a),s;if(o){var c=Mn(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return If(this,s)}}function If(a,o){return o&&(Un(o)==="object"||typeof o=="function")?o:Of(a)}function Of(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Nf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Mn(a){return Mn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Mn(a)}function Ae(a,o){var i;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(i=kf(a))||o&&a&&typeof a.length=="number"){i&&(a=i);var n=0,s=function(){};return{s,n:function(){return n>=a.length?{done:!0}:{done:!1,value:a[n++]}},e:function(g){throw g},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,t=!1,u;return{s:function(){i=a[Symbol.iterator]()},n:function(){var g=i.next();return c=g.done,g},e:function(g){t=!0,u=g},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(t)throw u}}}}function kf(a,o){if(a){if(typeof a=="string")return na(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return na(a,o)}}function na(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,n=new Array(o);i<o;i++)n[i]=a[i];return n}function jt(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function ra(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Fn(a,o,i){return o&&ra(a.prototype,o),i&&ra(a,i),a}var sa=Vr(),Df=ce(),_e=ae(),fe=de(),ia=wn(),xf=Oe(),zr=new Df("SIPMessage"),la=(function(){function a(o,i,n,s,c,t){if(jt(this,a),!o||!i||!n)return null;s=s||{},this.ua=n,this.headers={},this.method=o,this.ruri=i,this.body=t,this.extraHeaders=fe.cloneArray(c),this.ua.configuration.extra_headers&&(this.extraHeaders=this.extraHeaders.concat(this.ua.configuration.extra_headers)),s.route_set?this.setHeader("route",s.route_set):n.configuration.use_preloaded_route&&this.setHeader("route","<".concat(n.transport.sip_uri,";lr>")),this.setHeader("via",""),this.setHeader("max-forwards",_e.MAX_FORWARDS);var u=s.to_uri||i,p=s.to_tag?{tag:s.to_tag}:null,g=typeof s.to_display_name<"u"?s.to_display_name:null;this.to=new ia(u,g,p),this.setHeader("to",this.to.toString());var y=s.from_uri||n.configuration.uri,S={tag:s.from_tag||fe.newTag()},h;typeof s.from_display_name<"u"?h=s.from_display_name:n.configuration.display_name?h=n.configuration.display_name:h=null,this.from=new ia(y,h,S),this.setHeader("from",this.from.toString());var A=s.call_id||n.configuration.jssip_id+fe.createRandomToken(15);this.call_id=A,this.setHeader("call-id",A);var m=s.cseq||Math.floor(Math.random()*1e4);this.cseq=m,this.setHeader("cseq","".concat(m," ").concat(o))}return Fn(a,[{key:"setHeader",value:function(i,n){for(var s=new RegExp("^\\s*".concat(i,"\\s*:"),"i"),c=0;c<this.extraHeaders.length;c++)s.test(this.extraHeaders[c])&&this.extraHeaders.splice(c,1);this.headers[fe.headerize(i)]=Array.isArray(n)?n:[n]}},{key:"getHeader",value:function(i){var n=this.headers[fe.headerize(i)];if(n){if(n[0])return n[0]}else{var s=new RegExp("^\\s*".concat(i,"\\s*:"),"i"),c=Ae(this.extraHeaders),t;try{for(c.s();!(t=c.n()).done;){var u=t.value;if(s.test(u))return u.substring(u.indexOf(":")+1).trim()}}catch(p){c.e(p)}finally{c.f()}}}},{key:"getHeaders",value:function(i){var n=this.headers[fe.headerize(i)],s=[];if(n){var c=Ae(n),t;try{for(c.s();!(t=c.n()).done;){var u=t.value;s.push(u)}}catch(h){c.e(h)}finally{c.f()}return s}else{var p=new RegExp("^\\s*".concat(i,"\\s*:"),"i"),g=Ae(this.extraHeaders),y;try{for(g.s();!(y=g.n()).done;){var S=y.value;p.test(S)&&s.push(S.substring(S.indexOf(":")+1).trim())}}catch(h){g.e(h)}finally{g.f()}return s}}},{key:"hasHeader",value:function(i){if(this.headers[fe.headerize(i)])return!0;var n=new RegExp("^\\s*".concat(i,"\\s*:"),"i"),s=Ae(this.extraHeaders),c;try{for(s.s();!(c=s.n()).done;){var t=c.value;if(n.test(t))return!0}}catch(u){s.e(u)}finally{s.f()}return!1}},{key:"parseSDP",value:function(i){return!i&&this.sdp?this.sdp:(this.sdp=sa.parse(this.body||""),this.sdp)}},{key:"toString",value:function(){var i="".concat(this.method," ").concat(this.ruri,` SIP/2.0\r
`);for(var n in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,n)){var s=Ae(this.headers[n]),c;try{for(s.s();!(c=s.n()).done;){var t=c.value;i+="".concat(n,": ").concat(t,`\r
`)}}catch(A){s.e(A)}finally{s.f()}}var u=Ae(this.extraHeaders),p;try{for(u.s();!(p=u.n()).done;){var g=p.value;i+="".concat(g.trim(),`\r
`)}}catch(A){u.e(A)}finally{u.f()}var y=[];switch(this.method){case _e.REGISTER:y.push("path","gruu");break;case _e.INVITE:this.ua.configuration.session_timers&&y.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&y.push("gruu"),y.push("ice","replaces");break;case _e.UPDATE:this.ua.configuration.session_timers&&y.push("timer"),y.push("ice");break}y.push("outbound");var S=this.ua.configuration.user_agent||_e.USER_AGENT;if(i+="Allow: ".concat(_e.ALLOWED_METHODS,`\r
`),i+="Supported: ".concat(y,`\r
`),i+="User-Agent: ".concat(S,`\r
`),this.body){var h=fe.str_utf8_length(this.body);i+="Content-Length: ".concat(h,`\r
\r
`),i+=this.body}else i+=`Content-Length: 0\r
\r
`;return i}},{key:"clone",value:function(){var i=new a(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(n){i.headers[n]=this.headers[n].slice()},this),i.body=this.body,i.extraHeaders=fe.cloneArray(this.extraHeaders),i.to=this.to,i.from=this.from,i.call_id=this.call_id,i.cseq=this.cseq,i}}]),a})(),Pf=(function(a){$r(i,a);var o=Yr(i);function i(n,s,c,t,u){var p;return jt(this,i),p=o.call(this,_e.INVITE,n,s,c,t,u),p.transaction=null,p}return Fn(i,[{key:"cancel",value:function(s){this.transaction.cancel(s)}},{key:"clone",value:function(){var s=new i(this.ruri,this.ua);return Object.keys(this.headers).forEach(function(c){s.headers[c]=this.headers[c].slice()},this),s.body=this.body,s.extraHeaders=fe.cloneArray(this.extraHeaders),s.to=this.to,s.from=this.from,s.call_id=this.call_id,s.cseq=this.cseq,s.transaction=this.transaction,s}}]),i})(la),aa=(function(){function a(){jt(this,a),this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}return Fn(a,[{key:"addHeader",value:function(i,n){var s={raw:n};i=fe.headerize(i),this.headers[i]?this.headers[i].push(s):this.headers[i]=[s]}},{key:"getHeader",value:function(i){var n=this.headers[fe.headerize(i)];if(n){if(n[0])return n[0].raw}else return}},{key:"getHeaders",value:function(i){var n=this.headers[fe.headerize(i)],s=[];if(!n)return[];var c=Ae(n),t;try{for(c.s();!(t=c.n()).done;){var u=t.value;s.push(u.raw)}}catch(p){c.e(p)}finally{c.f()}return s}},{key:"hasHeader",value:function(i){return!!this.headers[fe.headerize(i)]}},{key:"parseHeader",value:function(i){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(i=fe.headerize(i),this.headers[i]){if(n>=this.headers[i].length){zr.debug('not so many "'.concat(i,'" headers present'));return}}else{zr.debug('header "'.concat(i,'" not present'));return}var s=this.headers[i][n],c=s.raw;if(s.parsed)return s.parsed;var t=xf.parse(c,i.replace(/-/g,"_"));if(t===-1){this.headers[i].splice(n,1),zr.debug('error parsing "'.concat(i,'" header field with value "').concat(c,'"'));return}else return s.parsed=t,t}},{key:"s",value:function(i,n){return this.parseHeader(i,n)}},{key:"setHeader",value:function(i,n){var s={raw:n};this.headers[fe.headerize(i)]=[s]}},{key:"parseSDP",value:function(i){return!i&&this.sdp?this.sdp:(this.sdp=sa.parse(this.body||""),this.sdp)}},{key:"toString",value:function(){return this.data}}]),a})(),Uf=(function(a){$r(i,a);var o=Yr(i);function i(n){var s;return jt(this,i),s=o.call(this),s.ua=n,s.headers={},s.ruri=null,s.transport=null,s.server_transaction=null,s}return Fn(i,[{key:"reply",value:function(s,c,t,u,p,g){var y=[],S=this.getHeader("To");if(s=s||null,c=c||null,!s||s<100||s>699)throw new TypeError("Invalid status_code: ".concat(s));if(c&&typeof c!="string"&&!(c instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(c));c=c||_e.REASON_PHRASE[s]||"",t=fe.cloneArray(t),this.ua.configuration.extra_headers&&(t=t.concat(this.ua.configuration.extra_headers));var h="SIP/2.0 ".concat(s," ").concat(c,`\r
`);if(this.method===_e.INVITE&&s>100&&s<=200){var A=this.getHeaders("record-route"),m=Ae(A),C;try{for(m.s();!(C=m.n()).done;){var x=C.value;h+="Record-Route: ".concat(x,`\r
`)}}catch(he){m.e(he)}finally{m.f()}}var L=this.getHeaders("via"),K=Ae(L),Q;try{for(K.s();!(Q=K.n()).done;){var R=Q.value;h+="Via: ".concat(R,`\r
`)}}catch(he){K.e(he)}finally{K.f()}!this.to_tag&&s>100?S+=";tag=".concat(fe.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(S+=";tag=".concat(this.to_tag)),h+="To: ".concat(S,`\r
`),h+="From: ".concat(this.getHeader("From"),`\r
`),h+="Call-ID: ".concat(this.call_id,`\r
`),h+="CSeq: ".concat(this.cseq," ").concat(this.method,`\r
`);var k=Ae(t),w;try{for(k.s();!(w=k.n()).done;){var D=w.value;h+="".concat(D.trim(),`\r
`)}}catch(he){k.e(he)}finally{k.f()}switch(this.method){case _e.INVITE:this.ua.configuration.session_timers&&y.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&y.push("gruu"),y.push("ice","replaces");break;case _e.UPDATE:this.ua.configuration.session_timers&&y.push("timer"),u&&y.push("ice"),y.push("replaces")}if(y.push("outbound"),this.method===_e.OPTIONS?(h+="Allow: ".concat(_e.ALLOWED_METHODS,`\r
`),h+="Accept: ".concat(_e.ACCEPTED_BODY_TYPES,`\r
`)):s===405?h+="Allow: ".concat(_e.ALLOWED_METHODS,`\r
`):s===415&&(h+="Accept: ".concat(_e.ACCEPTED_BODY_TYPES,`\r
`)),h+="Supported: ".concat(y,`\r
`),u){var J=fe.str_utf8_length(u);h+=`Content-Type: application/sdp\r
`,h+="Content-Length: ".concat(J,`\r
\r
`),h+=u}else h+="Content-Length: ".concat(0,`\r
\r
`);this.server_transaction.receiveResponse(s,h,p,g)}},{key:"reply_sl",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=this.getHeaders("via");if(!s||s<100||s>699)throw new TypeError("Invalid status_code: ".concat(s));if(c&&typeof c!="string"&&!(c instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(c));c=c||_e.REASON_PHRASE[s]||"";var u="SIP/2.0 ".concat(s," ").concat(c,`\r
`),p=Ae(t),g;try{for(p.s();!(g=p.n()).done;){var y=g.value;u+="Via: ".concat(y,`\r
`)}}catch(C){p.e(C)}finally{p.f()}var S=this.getHeader("To");if(!this.to_tag&&s>100?S+=";tag=".concat(fe.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(S+=";tag=".concat(this.to_tag)),u+="To: ".concat(S,`\r
`),u+="From: ".concat(this.getHeader("From"),`\r
`),u+="Call-ID: ".concat(this.call_id,`\r
`),u+="CSeq: ".concat(this.cseq," ").concat(this.method,`\r
`),this.ua.configuration.extra_headers){var h=Ae(this.ua.configuration.extra_headers),A;try{for(h.s();!(A=h.n()).done;){var m=A.value;u+="".concat(m.trim(),`\r
`)}}catch(C){h.e(C)}finally{h.f()}}u+="Content-Length: ".concat(0,`\r
\r
`),this.transport.send(u)}}]),i})(aa),Mf=(function(a){$r(i,a);var o=Yr(i);function i(){var n;return jt(this,i),n=o.call(this),n.headers={},n.status_code=null,n.reason_phrase=null,n}return i})(aa);oa.exports={OutgoingRequest:la,InitialOutgoingInviteRequest:Pf,IncomingRequest:Uf,IncomingResponse:Mf}});var ca=B((Bd,fa)=>{"use strict";function Ff(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function ua(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Hf(a,o,i){return o&&ua(a.prototype,o),i&&ua(a,i),a}var Lf=ce(),Be=de(),Ne=new Lf("DigestAuthentication");fa.exports=(function(){function a(o){Ff(this,a),this._credentials=o,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}return Hf(a,[{key:"get",value:function(i){switch(i){case"realm":return this._realm;case"ha1":return this._ha1;default:Ne.warn('get() | cannot get "%s" parameter',i);return}}},{key:"authenticate",value:function(i,n){var s=i.method,c=i.ruri,t=i.body,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(this._algorithm=n.algorithm,this._realm=n.realm,this._nonce=n.nonce,this._opaque=n.opaque,this._stale=n.stale,this._algorithm){if(this._algorithm!=="MD5")return Ne.warn('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return Ne.warn("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return Ne.warn("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return Ne.warn("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return Ne.warn('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(n.qop)if(n.qop.indexOf("auth-int")>-1)this._qop="auth-int";else if(n.qop.indexOf("auth")>-1)this._qop="auth";else return Ne.warn('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;else this._qop=null;this._method=s,this._uri=c,this._cnonce=u||Be.createRandomToken(12),this._nc+=1;var p=Number(this._nc).toString(16);this._ncHex="00000000".substr(0,8-p.length)+p,this._nc===4294967296&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=Be.calculateMD5("".concat(this._credentials.username,":").concat(this._realm,":").concat(this._credentials.password)):this._ha1=this._credentials.ha1;var g,y;return this._qop==="auth"?(g="".concat(this._method,":").concat(this._uri),y=Be.calculateMD5(g),Ne.debug('authenticate() | using qop=auth [a2:"%s"]',g),this._response=Be.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth:").concat(y))):this._qop==="auth-int"?(g="".concat(this._method,":").concat(this._uri,":").concat(Be.calculateMD5(t||"")),y=Be.calculateMD5(g),Ne.debug('authenticate() | using qop=auth-int [a2:"%s"]',g),this._response=Be.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth-int:").concat(y))):this._qop===null&&(g="".concat(this._method,":").concat(this._uri),y=Be.calculateMD5(g),Ne.debug('authenticate() | using qop=null [a2:"%s"]',g),this._response=Be.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(y))),Ne.debug("authenticate() | response generated"),!0}},{key:"toString",value:function(){var i=[];if(!this._response)throw new Error("response field does not exist, cannot generate Authorization header");return i.push("algorithm=".concat(this._algorithm)),i.push('username="'.concat(this._credentials.username,'"')),i.push('realm="'.concat(this._realm,'"')),i.push('nonce="'.concat(this._nonce,'"')),i.push('uri="'.concat(this._uri,'"')),i.push('response="'.concat(this._response,'"')),this._opaque&&i.push('opaque="'.concat(this._opaque,'"')),this._qop&&(i.push("qop=".concat(this._qop)),i.push('cnonce="'.concat(this._cnonce,'"')),i.push("nc=".concat(this._ncHex))),"Digest ".concat(i.join(", "))}}]),a})()});var Jr=B((Vd,da)=>{"use strict";var Ve=500,qf=4e3,ha=5e3;da.exports={T1:Ve,T2:qf,T4:ha,TIMER_B:64*Ve,TIMER_D:0*Ve,TIMER_F:64*Ve,TIMER_H:64*Ve,TIMER_I:0*Ve,TIMER_J:0*Ve,TIMER_K:0*ha,TIMER_L:64*Ve,TIMER_M:64*Ve,PROVISIONAL_RESPONSE_INTERVAL:6e4}});var St=B((zd,ma)=>{"use strict";function qn(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?qn=function(i){return typeof i}:qn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},qn(a)}function Wt(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function _a(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Bt(a,o,i){return o&&_a(a.prototype,o),i&&_a(a,i),a}function Vt(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&Xr(a,o)}function Xr(a,o){return Xr=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},Xr(a,o)}function zt(a){var o=Gf();return function(){var n=jn(a),s;if(o){var c=jn(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return jf(this,s)}}function jf(a,o){return o&&(qn(o)==="object"||typeof o=="function")?o:Ke(a)}function Ke(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Gf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function jn(a){return jn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},jn(a)}var Kt=Ge().EventEmitter,$t=ce(),Gt=ae(),pa=Ue(),Me=Jr(),va=new $t("NonInviteClientTransaction"),Hn=new $t("InviteClientTransaction"),Wf=new $t("AckClientTransaction"),ga=new $t("NonInviteServerTransaction"),Ln=new $t("InviteServerTransaction"),P={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},Bf=(function(a){Vt(i,a);var o=zt(i);function i(n,s,c,t){var u;Wt(this,i),u=o.call(this),u.type=P.NON_INVITE_CLIENT,u.id="z9hG4bK".concat(Math.floor(Math.random()*1e7)),u.ua=n,u.transport=s,u.request=c,u.eventHandlers=t;var p="SIP/2.0/".concat(s.via_transport);return p+=" ".concat(n.configuration.via_host,";branch=").concat(u.id),u.request.setHeader("via",p),u.ua.newTransaction(Ke(u)),u}return Bt(i,[{key:"stateChanged",value:function(s){this.state=s,this.emit("stateChanged")}},{key:"send",value:function(){var s=this;this.stateChanged(P.STATUS_TRYING),this.F=setTimeout(function(){s.timer_F()},Me.TIMER_F),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){va.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}},{key:"timer_F",value:function(){va.debug("Timer F expired for transaction ".concat(this.id)),this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}},{key:"timer_K",value:function(){this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"receiveResponse",value:function(s){var c=this,t=s.status_code;if(t<200)switch(this.state){case P.STATUS_TRYING:case P.STATUS_PROCEEDING:this.stateChanged(P.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(s);break}else switch(this.state){case P.STATUS_TRYING:case P.STATUS_PROCEEDING:this.stateChanged(P.STATUS_COMPLETED),clearTimeout(this.F),t===408?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(s),this.K=setTimeout(function(){c.timer_K()},Me.TIMER_K);break;case P.STATUS_COMPLETED:break}}},{key:"C",get:function(){return P}}]),i})(Kt),Vf=(function(a){Vt(i,a);var o=zt(i);function i(n,s,c,t){var u;Wt(this,i),u=o.call(this),u.type=P.INVITE_CLIENT,u.id="z9hG4bK".concat(Math.floor(Math.random()*1e7)),u.ua=n,u.transport=s,u.request=c,u.eventHandlers=t,c.transaction=Ke(u);var p="SIP/2.0/".concat(s.via_transport);return p+=" ".concat(n.configuration.via_host,";branch=").concat(u.id),u.request.setHeader("via",p),u.ua.newTransaction(Ke(u)),u}return Bt(i,[{key:"stateChanged",value:function(s){this.state=s,this.emit("stateChanged")}},{key:"send",value:function(){var s=this;this.stateChanged(P.STATUS_CALLING),this.B=setTimeout(function(){s.timer_B()},Me.TIMER_B),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==P.STATUS_ACCEPTED&&(Hn.debug("transport error occurred, deleting transaction ".concat(this.id)),this.eventHandlers.onTransportError()),this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_M",value:function(){Hn.debug("Timer M expired for transaction ".concat(this.id)),this.state===P.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"timer_B",value:function(){Hn.debug("Timer B expired for transaction ".concat(this.id)),this.state===P.STATUS_CALLING&&(this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}},{key:"timer_D",value:function(){Hn.debug("Timer D expired for transaction ".concat(this.id)),clearTimeout(this.B),this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"sendACK",value:function(s){var c=this,t=new pa.OutgoingRequest(Gt.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});t.setHeader("from",this.request.getHeader("from")),t.setHeader("via",this.request.getHeader("via")),t.setHeader("to",s.getHeader("to")),this.D=setTimeout(function(){c.timer_D()},Me.TIMER_D),this.transport.send(t)}},{key:"cancel",value:function(s){if(this.state===P.STATUS_PROCEEDING){var c=new pa.OutgoingRequest(Gt.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});c.setHeader("from",this.request.getHeader("from")),c.setHeader("via",this.request.getHeader("via")),c.setHeader("to",this.request.getHeader("to")),s&&c.setHeader("reason",s),this.transport.send(c)}}},{key:"receiveResponse",value:function(s){var c=this,t=s.status_code;if(t>=100&&t<=199)switch(this.state){case P.STATUS_CALLING:this.stateChanged(P.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(s);break;case P.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(s);break}else if(t>=200&&t<=299)switch(this.state){case P.STATUS_CALLING:case P.STATUS_PROCEEDING:this.stateChanged(P.STATUS_ACCEPTED),this.M=setTimeout(function(){c.timer_M()},Me.TIMER_M),this.eventHandlers.onReceiveResponse(s);break;case P.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(s);break}else if(t>=300&&t<=699)switch(this.state){case P.STATUS_CALLING:case P.STATUS_PROCEEDING:this.stateChanged(P.STATUS_COMPLETED),this.sendACK(s),this.eventHandlers.onReceiveResponse(s);break;case P.STATUS_COMPLETED:this.sendACK(s);break}}},{key:"C",get:function(){return P}}]),i})(Kt),zf=(function(a){Vt(i,a);var o=zt(i);function i(n,s,c,t){var u;Wt(this,i),u=o.call(this),u.id="z9hG4bK".concat(Math.floor(Math.random()*1e7)),u.transport=s,u.request=c,u.eventHandlers=t;var p="SIP/2.0/".concat(s.via_transport);return p+=" ".concat(n.configuration.via_host,";branch=").concat(u.id),u.request.setHeader("via",p),u}return Bt(i,[{key:"send",value:function(){this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){Wf.debug("transport error occurred for transaction ".concat(this.id)),this.eventHandlers.onTransportError()}},{key:"C",get:function(){return P}}]),i})(Kt),Kf=(function(a){Vt(i,a);var o=zt(i);function i(n,s,c){var t;return Wt(this,i),t=o.call(this),t.type=P.NON_INVITE_SERVER,t.id=c.via_branch,t.ua=n,t.transport=s,t.request=c,t.last_response="",c.server_transaction=Ke(t),t.state=P.STATUS_TRYING,n.newTransaction(Ke(t)),t}return Bt(i,[{key:"stateChanged",value:function(s){this.state=s,this.emit("stateChanged")}},{key:"timer_J",value:function(){ga.debug("Timer J expired for transaction ".concat(this.id)),this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,ga.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.J),this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"receiveResponse",value:function(s,c,t,u){var p=this;if(s===100)switch(this.state){case P.STATUS_TRYING:this.stateChanged(P.STATUS_PROCEEDING),this.transport.send(c)||this.onTransportError();break;case P.STATUS_PROCEEDING:this.last_response=c,this.transport.send(c)?t&&t():(this.onTransportError(),u&&u());break}else if(s>=200&&s<=699)switch(this.state){case P.STATUS_TRYING:case P.STATUS_PROCEEDING:this.stateChanged(P.STATUS_COMPLETED),this.last_response=c,this.J=setTimeout(function(){p.timer_J()},Me.TIMER_J),this.transport.send(c)?t&&t():(this.onTransportError(),u&&u());break;case P.STATUS_COMPLETED:break}}},{key:"C",get:function(){return P}}]),i})(Kt),$f=(function(a){Vt(i,a);var o=zt(i);function i(n,s,c){var t;return Wt(this,i),t=o.call(this),t.type=P.INVITE_SERVER,t.id=c.via_branch,t.ua=n,t.transport=s,t.request=c,t.last_response="",c.server_transaction=Ke(t),t.state=P.STATUS_PROCEEDING,n.newTransaction(Ke(t)),t.resendProvisionalTimer=null,c.reply(100),t}return Bt(i,[{key:"stateChanged",value:function(s){this.state=s,this.emit("stateChanged")}},{key:"timer_H",value:function(){Ln.debug("Timer H expired for transaction ".concat(this.id)),this.state===P.STATUS_COMPLETED&&Ln.debug("ACK not received, dialog will be terminated"),this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_I",value:function(){this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_L",value:function(){Ln.debug("Timer L expired for transaction ".concat(this.id)),this.state===P.STATUS_ACCEPTED&&(this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,Ln.debug("transport error occurred, deleting transaction ".concat(this.id)),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(P.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"resend_provisional",value:function(){this.transport.send(this.last_response)||this.onTransportError()}},{key:"receiveResponse",value:function(s,c,t,u){var p=this;if(s>=100&&s<=199)switch(this.state){case P.STATUS_PROCEEDING:this.transport.send(c)||this.onTransportError(),this.last_response=c;break}if(s>100&&s<=199&&this.state===P.STATUS_PROCEEDING)this.resendProvisionalTimer===null&&(this.resendProvisionalTimer=setInterval(function(){p.resend_provisional()},Me.PROVISIONAL_RESPONSE_INTERVAL));else if(s>=200&&s<=299)switch(this.state){case P.STATUS_PROCEEDING:this.stateChanged(P.STATUS_ACCEPTED),this.last_response=c,this.L=setTimeout(function(){p.timer_L()},Me.TIMER_L),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case P.STATUS_ACCEPTED:this.transport.send(c)?t&&t():(this.onTransportError(),u&&u());break}else if(s>=300&&s<=699)switch(this.state){case P.STATUS_PROCEEDING:this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(c)?(this.stateChanged(P.STATUS_COMPLETED),this.H=setTimeout(function(){p.timer_H()},Me.TIMER_H),t&&t()):(this.onTransportError(),u&&u());break}}},{key:"C",get:function(){return P}}]),i})(Kt);function Yf(a,o){var i=a._transactions,n;switch(o.method){case Gt.INVITE:if(n=i.ist[o.via_branch],n){switch(n.state){case P.STATUS_PROCEEDING:n.transport.send(n.last_response);break;case P.STATUS_ACCEPTED:break}return!0}break;case Gt.ACK:if(n=i.ist[o.via_branch],n){if(n.state===P.STATUS_ACCEPTED)return!1;if(n.state===P.STATUS_COMPLETED)return n.state=P.STATUS_CONFIRMED,n.I=setTimeout(function(){n.timer_I()},Me.TIMER_I),!0}else return!1;break;case Gt.CANCEL:return n=i.ist[o.via_branch],n?(o.reply_sl(200),n.state!==P.STATUS_PROCEEDING):(o.reply_sl(481),!0);default:if(n=i.nist[o.via_branch],n){switch(n.state){case P.STATUS_TRYING:break;case P.STATUS_PROCEEDING:case P.STATUS_COMPLETED:n.transport.send(n.last_response);break}return!0}break}}ma.exports={C:P,NonInviteClientTransaction:Bf,InviteClientTransaction:Vf,AckClientTransaction:zf,NonInviteServerTransaction:Kf,InviteServerTransaction:$f,checkTransaction:Yf}});var Ct=B((Kd,Sa)=>{"use strict";function Jf(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function ya(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Xf(a,o,i){return o&&ya(a.prototype,o),i&&ya(a,i),a}var Qf=ce(),Ta=ae(),Zf=ca(),Qr=St(),ec=new Qf("RequestSender"),Zr={onRequestTimeout:function(){},onTransportError:function(){},onReceiveResponse:function(){},onAuthenticated:function(){}};Sa.exports=(function(){function a(o,i,n){Jf(this,a),this._ua=o,this._eventHandlers=n,this._method=i.method,this._request=i,this._auth=null,this._challenged=!1,this._staled=!1;for(var s in Zr)Object.prototype.hasOwnProperty.call(Zr,s)&&(this._eventHandlers[s]||(this._eventHandlers[s]=Zr[s]));o.status===o.C.STATUS_USER_CLOSED&&(this._method!==Ta.BYE||this._method!==Ta.ACK)&&this._eventHandlers.onTransportError()}return Xf(a,[{key:"send",value:function(){var i=this,n={onRequestTimeout:function(){i._eventHandlers.onRequestTimeout()},onTransportError:function(){i._eventHandlers.onTransportError()},onReceiveResponse:function(c){i._receiveResponse(c)}};switch(this._method){case"INVITE":this.clientTransaction=new Qr.InviteClientTransaction(this._ua,this._ua.transport,this._request,n);break;case"ACK":this.clientTransaction=new Qr.AckClientTransaction(this._ua,this._ua.transport,this._request,n);break;default:this.clientTransaction=new Qr.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,n)}this._ua._configuration.authorization_jwt&&this._request.setHeader("Authorization",this._ua._configuration.authorization_jwt),this.clientTransaction.send()}},{key:"_receiveResponse",value:function(i){var n,s,c=i.status_code;if((c===401||c===407)&&(this._ua.configuration.password!==null||this._ua.configuration.ha1!==null)){if(i.status_code===401?(n=i.parseHeader("www-authenticate"),s="authorization"):(n=i.parseHeader("proxy-authenticate"),s="proxy-authorization"),!n){ec.debug("".concat(i.status_code," with wrong or missing challenge, cannot authenticate")),this._eventHandlers.onReceiveResponse(i);return}if(!this._challenged||!this._staled&&n.stale===!0){if(this._auth||(this._auth=new Zf({username:this._ua.configuration.authorization_user,password:this._ua.configuration.password,realm:this._ua.configuration.realm,ha1:this._ua.configuration.ha1})),!this._auth.authenticate(this._request,n)){this._eventHandlers.onReceiveResponse(i);return}this._challenged=!0,this._ua.set("realm",this._auth.get("realm")),this._ua.set("ha1",this._auth.get("ha1")),n.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq","".concat(this._request.cseq," ").concat(this._method)),this._request.setHeader(s,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()}else this._eventHandlers.onReceiveResponse(i)}else this._eventHandlers.onReceiveResponse(i)}}]),a})()});var Ra=B(($d,Aa)=>{"use strict";function tc(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function Ca(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function nc(a,o,i){return o&&Ca(a.prototype,o),i&&Ca(a,i),a}var rc=ce(),ei=de(),rt=ae(),Ea=Ue(),ba=Ct(),Yt=new rc("Registrator"),Gn=10;Aa.exports=(function(){function a(o,i){tc(this,a),this._reg_id=1,this._ua=o,this._transport=i,this._registrar=o.configuration.registrar_server,this._expires=o.configuration.register_expires,this._call_id=ei.createRandomToken(22),this._cseq=0,this._to_uri=o.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._sipInstance='"<urn:uuid:'.concat(this._ua.configuration.instance_id,'>"'),this._contact+=";reg-id=".concat(this._reg_id),this._contact+=";+sip.instance=".concat(this._sipInstance)}return nc(a,[{key:"setExtraHeaders",value:function(i){Array.isArray(i)||(i=[]),this._extraHeaders=i.slice()}},{key:"setExtraContactParams",value:function(i){i instanceof Object||(i={}),this._extraContactParams="";for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var s=i[n];this._extraContactParams+=";".concat(n),s&&(this._extraContactParams+="=".concat(s))}}},{key:"register",value:function(){var i=this;if(this._registering){Yt.debug("Register request in progress...");return}var n=this._extraHeaders.slice();n.push("Contact: ".concat(this._contact,";expires=").concat(this._expires).concat(this._extraContactParams)),n.push("Expires: ".concat(this._expires));var s=new Ea.OutgoingRequest(rt.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},n),c=new ba(this._ua,s,{onRequestTimeout:function(){i._registrationFailure(null,rt.causes.REQUEST_TIMEOUT)},onTransportError:function(){i._registrationFailure(null,rt.causes.CONNECTION_ERROR)},onAuthenticated:function(){i._cseq+=1},onReceiveResponse:function(u){if(u.cseq===i._cseq)switch(i._registrationTimer!==null&&(clearTimeout(i._registrationTimer),i._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(u.status_code):break;case/^2[0-9]{2}$/.test(u.status_code):{if(i._registering=!1,!u.hasHeader("Contact")){Yt.debug("no Contact header in response to REGISTER, response ignored");break}var p=u.headers.Contact.reduce(function(A,m){return A.concat(m.parsed)},[]),g=p.find(function(A){return i._sipInstance===A.getParam("+sip.instance")&&i._reg_id===parseInt(A.getParam("reg-id"))});if(g||(g=p.find(function(A){return A.uri.user===i._ua.contact.uri.user})),!g){Yt.debug("no Contact header pointing to us, response ignored");break}var y=g.getParam("expires");!y&&u.hasHeader("expires")&&(y=u.getHeader("expires")),y||(y=i._expires),y=Number(y),y<Gn&&(y=Gn);var S=y>64?y*1e3/2+Math.floor((y/2-32)*1e3*Math.random()):y*1e3-5e3;i._registrationTimer=setTimeout(function(){i._registrationTimer=null,i._ua.listeners("registrationExpiring").length===0?i.register():i._ua.emit("registrationExpiring")},S),g.hasParam("temp-gruu")&&(i._ua.contact.temp_gruu=g.getParam("temp-gruu").replace(/"/g,"")),g.hasParam("pub-gruu")&&(i._ua.contact.pub_gruu=g.getParam("pub-gruu").replace(/"/g,"")),i._registered||(i._registered=!0,i._ua.registered({response:u}));break}case/^423$/.test(u.status_code):{u.hasHeader("min-expires")?(i._expires=Number(u.getHeader("min-expires")),i._expires<Gn&&(i._expires=Gn),i.register()):(Yt.debug("423 response received for REGISTER without Min-Expires"),i._registrationFailure(u,rt.causes.SIP_FAILURE_CODE));break}default:{var h=ei.sipErrorCause(u.status_code);i._registrationFailure(u,h)}}}});this._registering=!0,c.send()}},{key:"unregister",value:function(){var i=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this._registered){Yt.debug("already unregistered");return}this._registered=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null);var s=this._extraHeaders.slice();n.all?s.push("Contact: *".concat(this._extraContactParams)):s.push("Contact: ".concat(this._contact,";expires=0").concat(this._extraContactParams)),s.push("Expires: 0");var c=new Ea.OutgoingRequest(rt.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},s),t=new ba(this._ua,c,{onRequestTimeout:function(){i._unregistered(null,rt.causes.REQUEST_TIMEOUT)},onTransportError:function(){i._unregistered(null,rt.causes.CONNECTION_ERROR)},onAuthenticated:function(){i._cseq+=1},onReceiveResponse:function(p){switch(!0){case/^1[0-9]{2}$/.test(p.status_code):break;case/^2[0-9]{2}$/.test(p.status_code):i._unregistered(p);break;default:{var g=ei.sipErrorCause(p.status_code);i._unregistered(p,g)}}}});t.send()}},{key:"close",value:function(){this._registered&&this.unregister()}},{key:"onTransportClosed",value:function(){this._registering=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}},{key:"_registrationFailure",value:function(i,n){this._registering=!1,this._ua.registrationFailed({response:i||null,cause:n}),this._registered&&(this._registered=!1,this._ua.unregistered({response:i||null,cause:n}))}},{key:"_unregistered",value:function(i,n){this._registering=!1,this._registered=!1,this._ua.unregistered({response:i||null,cause:n||null})}},{key:"registered",get:function(){return this._registered}}]),a})()});var Oa=B((Yd,Ia)=>{"use strict";function ic(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function wa(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function sc(a,o,i){return o&&wa(a.prototype,o),i&&wa(a,i),a}var ti=ae(),Wn=St(),lc=Ct(),ni={onRequestTimeout:function(){},onTransportError:function(){},onSuccessResponse:function(){},onErrorResponse:function(){},onAuthenticated:function(){},onDialogError:function(){}};Ia.exports=(function(){function a(o,i,n){ic(this,a),this._dialog=o,this._ua=o._ua,this._request=i,this._eventHandlers=n,this._reattempt=!1,this._reattemptTimer=null;for(var s in ni)Object.prototype.hasOwnProperty.call(ni,s)&&(this._eventHandlers[s]||(this._eventHandlers[s]=ni[s]))}return sc(a,[{key:"send",value:function(){var i=this,n=new lc(this._ua,this._request,{onRequestTimeout:function(){i._eventHandlers.onRequestTimeout()},onTransportError:function(){i._eventHandlers.onTransportError()},onAuthenticated:function(t){i._eventHandlers.onAuthenticated(t)},onReceiveResponse:function(t){i._receiveResponse(t)}});if(n.send(),(this._request.method===ti.INVITE||this._request.method===ti.UPDATE&&this._request.body)&&n.clientTransaction.state!==Wn.C.STATUS_TERMINATED){this._dialog.uac_pending_reply=!0;var s=function c(){(n.clientTransaction.state===Wn.C.STATUS_ACCEPTED||n.clientTransaction.state===Wn.C.STATUS_COMPLETED||n.clientTransaction.state===Wn.C.STATUS_TERMINATED)&&(n.clientTransaction.removeListener("stateChanged",c),i._dialog.uac_pending_reply=!1)};n.clientTransaction.on("stateChanged",s)}}},{key:"_receiveResponse",value:function(i){var n=this;i.status_code===408||i.status_code===481?this._eventHandlers.onDialogError(i):i.method===ti.INVITE&&i.status_code===491?this._reattempt?i.status_code>=200&&i.status_code<300?this._eventHandlers.onSuccessResponse(i):i.status_code>=300&&this._eventHandlers.onErrorResponse(i):(this._request.cseq=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout(function(){n._dialog.isTerminated()||(n._reattempt=!0,n.send())},1e3)):i.status_code>=200&&i.status_code<300?this._eventHandlers.onSuccessResponse(i):i.status_code>=300&&this._eventHandlers.onErrorResponse(i)}},{key:"request",get:function(){return this._request}}]),a})()});var Pa=B((Jd,xa)=>{"use strict";function ac(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function Na(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function ka(a,o,i){return o&&Na(a.prototype,o),i&&Na(a,i),a}var oc=ce(),Da=Ue(),$e=ae(),Jt=St(),uc=Oa(),ri=de(),ii=new oc("Dialog"),Ye={STATUS_EARLY:1,STATUS_CONFIRMED:2,STATUS_TERMINATED:3};xa.exports=(function(){ka(a,null,[{key:"C",get:function(){return Ye}}]);function a(o,i,n){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Ye.STATUS_CONFIRMED;if(ac(this,a),this._owner=o,this._ua=o._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!i.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};i instanceof Da.IncomingResponse&&(s=i.status_code<200?Ye.STATUS_EARLY:Ye.STATUS_CONFIRMED);var c=i.parseHeader("contact");n==="UAS"?(this._id={call_id:i.call_id,local_tag:i.to_tag,remote_tag:i.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=s,this._remote_seqnum=i.cseq,this._local_uri=i.parseHeader("to").uri,this._remote_uri=i.parseHeader("from").uri,this._remote_target=c.uri,this._route_set=i.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):n==="UAC"&&(this._id={call_id:i.call_id,local_tag:i.from_tag,remote_tag:i.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=s,this._local_seqnum=i.cseq,this._local_uri=i.parseHeader("from").uri,this._remote_uri=i.parseHeader("to").uri,this._remote_target=c.uri,this._route_set=i.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),ii.debug("new ".concat(n," dialog created with status ").concat(this._state===Ye.STATUS_EARLY?"EARLY":"CONFIRMED"))}return ka(a,[{key:"isTerminated",value:function(){return this._status===Ye.STATUS_TERMINATED}},{key:"update",value:function(i,n){this._state=Ye.STATUS_CONFIRMED,ii.debug("dialog ".concat(this._id.toString(),"  changed to CONFIRMED state")),n==="UAC"&&(this._route_set=i.getHeaders("record-route").reverse())}},{key:"terminate",value:function(){ii.debug("dialog ".concat(this._id.toString()," deleted")),this._ua.destroyDialog(this),this._state=Ye.STATUS_TERMINATED}},{key:"sendRequest",value:function(i){var n=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=ri.cloneArray(s.extraHeaders),t=ri.cloneObject(s.eventHandlers),u=s.body||null,p=this._createRequest(i,c,u);t.onAuthenticated=function(){n._local_seqnum+=1};var g=new uc(this,p,t);return g.send(),p}},{key:"receiveRequest",value:function(i){this._checkInDialogRequest(i)&&(i.method===$e.ACK&&this._ack_seqnum!==null?this._ack_seqnum=null:i.method===$e.INVITE&&(this._ack_seqnum=i.cseq),this._owner.receiveRequest(i))}},{key:"_createRequest",value:function(i,n,s){n=ri.cloneArray(n),this._local_seqnum||(this._local_seqnum=Math.floor(Math.random()*1e4));var c=i===$e.CANCEL||i===$e.ACK?this._local_seqnum:this._local_seqnum+=1,t=new Da.OutgoingRequest(i,this._remote_target,this._ua,{cseq:c,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},n,s);return t}},{key:"_checkInDialogRequest",value:function(i){var n=this;if(!this._remote_seqnum)this._remote_seqnum=i.cseq;else if(i.cseq<this._remote_seqnum)if(i.method===$e.ACK){if(this._ack_seqnum===null||i.cseq!==this._ack_seqnum)return!1}else return i.reply(500),!1;else i.cseq>this._remote_seqnum&&(this._remote_seqnum=i.cseq);if(i.method===$e.INVITE||i.method===$e.UPDATE&&i.body){if(this._uac_pending_reply===!0)i.reply(491);else if(this._uas_pending_reply===!0){var s=(Math.random()*10|0)+1;return i.reply(500,null,["Retry-After:".concat(s)]),!1}else{this._uas_pending_reply=!0;var c=function t(){(i.server_transaction.state===Jt.C.STATUS_ACCEPTED||i.server_transaction.state===Jt.C.STATUS_COMPLETED||i.server_transaction.state===Jt.C.STATUS_TERMINATED)&&(i.server_transaction.removeListener("stateChanged",t),n._uas_pending_reply=!1)};i.server_transaction.on("stateChanged",c)}i.hasHeader("contact")&&i.server_transaction.on("stateChanged",function(){i.server_transaction.state===Jt.C.STATUS_ACCEPTED&&(n._remote_target=i.parseHeader("contact").uri)})}else i.method===$e.NOTIFY&&i.hasHeader("contact")&&i.server_transaction.on("stateChanged",function(){i.server_transaction.state===Jt.C.STATUS_COMPLETED&&(n._remote_target=i.parseHeader("contact").uri)});return!0}},{key:"id",get:function(){return this._id}},{key:"local_seqnum",get:function(){return this._local_seqnum},set:function(i){this._local_seqnum=i}},{key:"owner",get:function(){return this._owner}},{key:"uac_pending_reply",get:function(){return this._uac_pending_reply},set:function(i){this._uac_pending_reply=i}},{key:"uas_pending_reply",get:function(){return this._uas_pending_reply}}]),a})()});var Ha=B((Xd,li)=>{"use strict";function Bn(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Bn=function(i){return typeof i}:Bn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Bn(a)}function fc(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function Ua(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function cc(a,o,i){return o&&Ua(a.prototype,o),i&&Ua(a,i),a}function hc(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&si(a,o)}function si(a,o){return si=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},si(a,o)}function dc(a){var o=vc();return function(){var n=Vn(a),s;if(o){var c=Vn(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return _c(this,s)}}function _c(a,o){return o&&(Bn(o)==="object"||typeof o=="function")?o:pc(a)}function pc(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function vc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Vn(a){return Vn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Vn(a)}var gc=Ge().EventEmitter,mc=ce(),yc=ae(),Tc=qe(),Ma=de(),Sc=new mc("RTCSession:DTMF"),Fa={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};li.exports=(function(a){hc(i,a);var o=dc(i);function i(n){var s;return fc(this,i),s=o.call(this),s._session=n,s._direction=null,s._tone=null,s._duration=null,s._request=null,s}return cc(i,[{key:"send",value:function(s){var c=this,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(s===void 0)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new Tc.InvalidStateError(this._session.status);var u=Ma.cloneArray(t.extraHeaders);if(this.eventHandlers=Ma.cloneObject(t.eventHandlers),typeof s=="string")s=s.toUpperCase();else if(typeof s=="number")s=s.toString();else throw new TypeError("Invalid tone: ".concat(s));if(s.match(/^[0-9A-DR#*]$/))this._tone=s;else throw new TypeError("Invalid tone: ".concat(s));this._duration=t.duration,u.push("Content-Type: application/dtmf-relay");var p="Signal=".concat(this._tone,`\r
`);p+="Duration=".concat(this._duration),this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(yc.INFO,{extraHeaders:u,eventHandlers:{onSuccessResponse:function(y){c.emit("succeeded",{originator:"remote",response:y})},onErrorResponse:function(y){c.eventHandlers.onFailed&&c.eventHandlers.onFailed(),c.emit("failed",{originator:"remote",response:y})},onRequestTimeout:function(){c._session.onRequestTimeout()},onTransportError:function(){c._session.onTransportError()},onDialogError:function(){c._session.onDialogError()}},body:p})}},{key:"init_incoming",value:function(s){var c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,t=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(this._direction="incoming",this._request=s,s.reply(200),s.body){var u=s.body.split(`
`);u.length>=1&&c.test(u[0])&&(this._tone=u[0].replace(c,"$2")),u.length>=2&&t.test(u[1])&&(this._duration=parseInt(u[1].replace(t,"$2"),10))}this._duration||(this._duration=Fa.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:s}):Sc.debug("invalid INFO DTMF received, discarded")}},{key:"tone",get:function(){return this._tone}},{key:"duration",get:function(){return this._duration}}]),i})(gc);li.exports.C=Fa});var ja=B((Qd,qa)=>{"use strict";function zn(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?zn=function(i){return typeof i}:zn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},zn(a)}function Cc(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function La(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Ec(a,o,i){return o&&La(a.prototype,o),i&&La(a,i),a}function bc(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&ai(a,o)}function ai(a,o){return ai=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},ai(a,o)}function Ac(a){var o=Ic();return function(){var n=Kn(a),s;if(o){var c=Kn(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return Rc(this,s)}}function Rc(a,o){return o&&(zn(o)==="object"||typeof o=="function")?o:wc(a)}function wc(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Ic(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Kn(a){return Kn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Kn(a)}var Oc=Ge().EventEmitter,Nc=ae(),kc=qe(),Dc=de();qa.exports=(function(a){bc(i,a);var o=Ac(i);function i(n){var s;return Cc(this,i),s=o.call(this),s._session=n,s._direction=null,s._contentType=null,s._body=null,s}return Ec(i,[{key:"send",value:function(s,c){var t=this,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._direction="outgoing",s===void 0)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new kc.InvalidStateError(this._session.status);this._contentType=s,this._body=c;var p=Dc.cloneArray(u.extraHeaders);p.push("Content-Type: ".concat(s)),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(Nc.INFO,{extraHeaders:p,eventHandlers:{onSuccessResponse:function(y){t.emit("succeeded",{originator:"remote",response:y})},onErrorResponse:function(y){t.emit("failed",{originator:"remote",response:y})},onTransportError:function(){t._session.onTransportError()},onRequestTimeout:function(){t._session.onRequestTimeout()},onDialogError:function(){t._session.onDialogError()}},body:c})}},{key:"init_incoming",value:function(s){this._direction="incoming",this.request=s,s.reply(200),this._contentType=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0,this._body=s.body,this._session.newInfo({originator:"remote",info:this,request:s})}},{key:"contentType",get:function(){return this._contentType}},{key:"body",get:function(){return this._body}}]),i})(Oc)});var Va=B((Zd,Ba)=>{"use strict";function xc(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function Ga(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Pc(a,o,i){return o&&Ga(a.prototype,o),i&&Ga(a,i),a}var Uc=ce(),Wa=ae(),Mc=new Uc("RTCSession:ReferNotifier"),oi={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300};Ba.exports=(function(){function a(o,i,n){xc(this,a),this._session=o,this._id=i,this._expires=n||oi.expires,this._active=!0,this.notify(100)}return Pc(a,[{key:"notify",value:function(i,n){if(Mc.debug("notify()"),this._active!==!1){n=n||Wa.REASON_PHRASE[i]||"";var s;i>=200?s="terminated;reason=noresource":s="active;expires=".concat(this._expires),this._session.sendRequest(Wa.NOTIFY,{extraHeaders:["Event: ".concat(oi.event_type,";id=").concat(this._id),"Subscription-State: ".concat(s),"Content-Type: ".concat(oi.body_type)],body:"SIP/2.0 ".concat(i," ").concat(n),eventHandlers:{onErrorResponse:function(){this._active=!1}}})}}}]),a})()});var Ya=B((e_,$a)=>{"use strict";function $n(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?$n=function(i){return typeof i}:$n=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},$n(a)}function Fc(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function za(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Hc(a,o,i){return o&&za(a.prototype,o),i&&za(a,i),a}function Lc(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&ui(a,o)}function ui(a,o){return ui=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},ui(a,o)}function qc(a){var o=Wc();return function(){var n=Yn(a),s;if(o){var c=Yn(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return jc(this,s)}}function jc(a,o){return o&&($n(o)==="object"||typeof o=="function")?o:Gc(a)}function Gc(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Wc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Yn(a){return Yn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Yn(a)}var Bc=Ge().EventEmitter,Vc=ce(),Xt=ae(),zc=Oe(),Ka=de(),it=new Vc("RTCSession:ReferSubscriber");$a.exports=(function(a){Lc(i,a);var o=qc(i);function i(n){var s;return Fc(this,i),s=o.call(this),s._id=null,s._session=n,s}return Hc(i,[{key:"sendRefer",value:function(s){var c=this,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};it.debug("sendRefer()");var u=Ka.cloneArray(t.extraHeaders),p=Ka.cloneObject(t.eventHandlers);for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&this.on(g,p[g]);var y=null;t.replaces&&(y=t.replaces._request.call_id,y+=";to-tag=".concat(t.replaces._to_tag),y+=";from-tag=".concat(t.replaces._from_tag),y=encodeURIComponent(y));var S="Refer-To: <".concat(s).concat(y?"?Replaces=".concat(y):"",">");if(u.push(S),!u.some(function(m){return m.toLowerCase().startsWith("referred-by:")})){var h="Referred-By: <".concat(this._session._ua._configuration.uri._scheme,":").concat(this._session._ua._configuration.uri._user,"@").concat(this._session._ua._configuration.uri._host,">");u.push(h)}u.push("Contact: ".concat(this._session.contact));var A=this._session.sendRequest(Xt.REFER,{extraHeaders:u,eventHandlers:{onSuccessResponse:function(C){c._requestSucceeded(C)},onErrorResponse:function(C){c._requestFailed(C,Xt.causes.REJECTED)},onTransportError:function(){c._requestFailed(null,Xt.causes.CONNECTION_ERROR)},onRequestTimeout:function(){c._requestFailed(null,Xt.causes.REQUEST_TIMEOUT)},onDialogError:function(){c._requestFailed(null,Xt.causes.DIALOG_ERROR)}}});this._id=A.cseq}},{key:"receiveNotify",value:function(s){if(it.debug("receiveNotify()"),!!s.body){var c=zc.parse(s.body.trim().split(`\r
`,1)[0],"Status_Line");if(c===-1){it.debug('receiveNotify() | error parsing NOTIFY body: "'.concat(s.body,'"'));return}switch(!0){case/^100$/.test(c.status_code):this.emit("trying",{request:s,status_line:c});break;case/^1[0-9]{2}$/.test(c.status_code):this.emit("progress",{request:s,status_line:c});break;case/^2[0-9]{2}$/.test(c.status_code):this.emit("accepted",{request:s,status_line:c});break;default:this.emit("failed",{request:s,status_line:c});break}}}},{key:"_requestSucceeded",value:function(s){it.debug("REFER succeeded"),it.debug('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:s})}},{key:"_requestFailed",value:function(s,c){it.debug("REFER failed"),it.debug('emit "requestFailed"'),this.emit("requestFailed",{response:s||null,cause:c})}},{key:"id",get:function(){return this._id}}]),i})(Bc)});var io=B((t_,ro)=>{"use strict";function Qn(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Qn=function(i){return typeof i}:Qn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Qn(a)}function ze(a,o){var i;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(i=Kc(a))||o&&a&&typeof a.length=="number"){i&&(a=i);var n=0,s=function(){};return{s,n:function(){return n>=a.length?{done:!0}:{done:!1,value:a[n++]}},e:function(g){throw g},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,t=!1,u;return{s:function(){i=a[Symbol.iterator]()},n:function(){var g=i.next();return c=g.done,g},e:function(g){t=!0,u=g},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(t)throw u}}}}function Kc(a,o){if(a){if(typeof a=="string")return Ja(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ja(a,o)}}function Ja(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,n=new Array(o);i<o;i++)n[i]=a[i];return n}function $c(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function Xa(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Qa(a,o,i){return o&&Xa(a.prototype,o),i&&Xa(a,i),a}function Yc(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&fi(a,o)}function fi(a,o){return fi=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},fi(a,o)}function Jc(a){var o=Zc();return function(){var n=Zn(a),s;if(o){var c=Zn(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return Xc(this,s)}}function Xc(a,o){return o&&(Qn(o)==="object"||typeof o=="function")?o:Qc(a)}function Qc(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Zc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Zn(a){return Zn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Zn(a)}var eh=Ge().EventEmitter,Za=Vr(),th=ce(),U=ae(),st=qe(),eo=St(),se=de(),Qt=Jr(),nh=Ue(),Jn=Pa(),rh=Ct(),Ee=Ha(),to=ja(),ih=Va(),sh=Ya(),no=je(),I=new th("RTCSession"),N={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},Xn=["audio","video"];ro.exports=(function(a){Yc(i,a);var o=Jc(i);Qa(i,null,[{key:"C",get:function(){return N}}]);function i(n){var s;return $c(this,i),I.debug("new"),s=o.call(this),s._id=null,s._ua=n,s._status=N.STATUS_NULL,s._dialog=null,s._earlyDialogs={},s._contact=null,s._from_tag=null,s._to_tag=null,s._connection=null,s._connectionPromiseQueue=Promise.resolve(),s._request=null,s._is_canceled=!1,s._cancel_reason="",s._is_confirmed=!1,s._late_sdp=!1,s._rtcOfferConstraints=null,s._rtcAnswerConstraints=null,s._localMediaStream=null,s._localMediaStreamLocallyGenerated=!1,s._rtcReady=!0,s._iceReady=!1,s._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},s._direction=null,s._local_identity=null,s._remote_identity=null,s._start_time=null,s._end_time=null,s._tones=null,s._audioMuted=!1,s._videoMuted=!1,s._localHold=!1,s._remoteHold=!1,s._sessionTimers={enabled:s._ua.configuration.session_timers,refreshMethod:s._ua.configuration.session_timers_refresh_method,defaultExpires:U.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},s._referSubscribers={},s._data={},s}return Qa(i,[{key:"isInProgress",value:function(){switch(this._status){case N.STATUS_NULL:case N.STATUS_INVITE_SENT:case N.STATUS_1XX_RECEIVED:case N.STATUS_INVITE_RECEIVED:case N.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}},{key:"isEstablished",value:function(){switch(this._status){case N.STATUS_ANSWERED:case N.STATUS_WAITING_FOR_ACK:case N.STATUS_CONFIRMED:return!0;default:return!1}}},{key:"isEnded",value:function(){switch(this._status){case N.STATUS_CANCELED:case N.STATUS_TERMINATED:return!0;default:return!1}}},{key:"isMuted",value:function(){return{audio:this._audioMuted,video:this._videoMuted}}},{key:"isOnHold",value:function(){return{local:this._localHold,remote:this._remoteHold}}},{key:"connect",value:function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;I.debug("connect()");var u=s,p=se.cloneObject(c.eventHandlers),g=se.cloneArray(c.extraHeaders),y=se.cloneObject(c.mediaConstraints,{audio:!0,video:!0}),S=c.mediaStream||null,h=se.cloneObject(c.pcConfig,{iceServers:[]}),A=c.rtcConstraints||null,m=c.rtcOfferConstraints||null;if(this._rtcOfferConstraints=m,this._rtcAnswerConstraints=c.rtcAnswerConstraints||null,this._data=c.data||this._data,s===void 0)throw new TypeError("Not enough arguments");if(this._status!==N.STATUS_NULL)throw new st.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new st.NotSupportedError("WebRTC not supported");if(s=this._ua.normalizeTarget(s),!s)throw new TypeError("Invalid target: ".concat(u));this._sessionTimers.enabled&&se.isDecimal(c.sessionTimersExpires)&&(c.sessionTimersExpires>=U.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=c.sessionTimersExpires:this._sessionTimers.defaultExpires=U.SESSION_EXPIRES);for(var C in p)Object.prototype.hasOwnProperty.call(p,C)&&this.on(C,p[C]);this._from_tag=se.newTag();var x=c.anonymous||!1,L={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:x,outbound:!0}),x?(L.from_display_name="Anonymous",L.from_uri=new no("sip","anonymous","anonymous.invalid"),g.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString())),g.push("Privacy: id")):c.fromUserName&&(L.from_uri=new no("sip",c.fromUserName,this._ua.configuration.uri.host),g.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),c.fromDisplayName&&(L.from_display_name=c.fromDisplayName),g.push("Contact: ".concat(this._contact)),g.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&g.push("Session-Expires: ".concat(this._sessionTimers.defaultExpires).concat(this._ua.configuration.session_timers_force_refresher?";refresher=uac":"")),this._request=new nh.InitialOutgoingInviteRequest(s,this._ua,L,g),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(h,A),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,t&&t(this),this._newRTCSession("local",this._request),this._sendInitialRequest(y,m,S)}},{key:"init_incoming",value:function(s,c){var t=this;I.debug("init_incoming()");var u,p=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0;if(s.body&&p!=="application/sdp"){s.reply(415);return}if(this._status=N.STATUS_INVITE_RECEIVED,this._from_tag=s.from_tag,this._id=s.call_id+this._from_tag,this._request=s,this._contact=this._ua.contact.toString(),s.hasHeader("expires")&&(u=s.getHeader("expires")*1e3),s.to_tag=se.newTag(),!this._createDialog(s,"UAS",!0)){s.reply(500,"Missing Contact header field");return}s.body?this._late_sdp=!1:this._late_sdp=!0,this._status=N.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout(function(){s.reply(408),t._failed("local",null,U.causes.NO_ANSWER)},this._ua.configuration.no_answer_timeout),u&&(this._timers.expiresTimer=setTimeout(function(){t._status===N.STATUS_WAITING_FOR_ANSWER&&(s.reply(487),t._failed("system",null,U.causes.EXPIRES))},u)),this._direction="incoming",this._local_identity=s.to,this._remote_identity=s.from,c&&c(this),this._newRTCSession("remote",s),this._status!==N.STATUS_TERMINATED&&(s.reply(180,null,["Contact: ".concat(this._contact)]),this._progress("local",null))}},{key:"answer",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};I.debug("answer()");var t=this._request,u=se.cloneArray(c.extraHeaders),p=se.cloneObject(c.mediaConstraints),g=c.mediaStream||null,y=se.cloneObject(c.pcConfig,{iceServers:[]}),S=c.rtcConstraints||null,h=c.rtcAnswerConstraints||null,A=se.cloneObject(c.rtcOfferConstraints),m,C=!1,x=!1,L=!1,K=!1;if(this._rtcAnswerConstraints=h,this._rtcOfferConstraints=c.rtcOfferConstraints||null,this._data=c.data||this._data,this._direction!=="incoming")throw new st.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==N.STATUS_WAITING_FOR_ANSWER)throw new st.InvalidStateError(this._status);if(this._sessionTimers.enabled&&se.isDecimal(c.sessionTimersExpires)&&(c.sessionTimersExpires>=U.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=c.sessionTimersExpires:this._sessionTimers.defaultExpires=U.SESSION_EXPIRES),this._status=N.STATUS_ANSWERED,!this._createDialog(t,"UAS")){t.reply(500,"Error creating dialog");return}clearTimeout(this._timers.userNoAnswerTimer),u.unshift("Contact: ".concat(this._contact));var Q=t.parseSDP();Array.isArray(Q.media)||(Q.media=[Q.media]);var R=ze(Q.media),k;try{for(R.s();!(k=R.n()).done;){var w=k.value;w.type==="audio"&&(C=!0,(!w.direction||w.direction==="sendrecv")&&(L=!0)),w.type==="video"&&(x=!0,(!w.direction||w.direction==="sendrecv")&&(K=!0))}}catch(X){R.e(X)}finally{R.f()}if(g&&p.audio===!1){m=g.getAudioTracks();var D=ze(m),J;try{for(D.s();!(J=D.n()).done;){var he=J.value;g.removeTrack(he)}}catch(X){D.e(X)}finally{D.f()}}if(g&&p.video===!1){m=g.getVideoTracks();var ee=ze(m),ie;try{for(ee.s();!(ie=ee.n()).done;){var Y=ie.value;g.removeTrack(Y)}}catch(X){ee.e(X)}finally{ee.f()}}!g&&p.audio===void 0&&(p.audio=L),!g&&p.video===void 0&&(p.video=K),!g&&!C&&!A.offerToReceiveAudio&&(p.audio=!1),!g&&!x&&!A.offerToReceiveVideo&&(p.video=!1),this._createRTCConnection(y,S),Promise.resolve().then(function(){if(g)return g;if(p.audio||p.video)return s._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(p).catch(function(X){throw s._status===N.STATUS_TERMINATED?new Error("terminated"):(t.reply(480),s._failed("local",null,U.causes.USER_DENIED_MEDIA_ACCESS),I.warn('emit "getusermediafailed" [error:%o]',X),s.emit("getusermediafailed",X),new Error("getUserMedia() failed"))})}).then(function(X){if(s._status===N.STATUS_TERMINATED)throw new Error("terminated");s._localMediaStream=X,X&&X.getTracks().forEach(function(we){s._connection.addTrack(we,X)})}).then(function(){if(!s._late_sdp){var X={originator:"remote",type:"offer",sdp:t.body};I.debug('emit "sdp"'),s.emit("sdp",X);var we=new RTCSessionDescription({type:"offer",sdp:X.sdp});return s._connectionPromiseQueue=s._connectionPromiseQueue.then(function(){return s._connection.setRemoteDescription(we)}).catch(function(me){throw t.reply(488),s._failed("system",null,U.causes.WEBRTC_ERROR),I.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',me),s.emit("peerconnection:setremotedescriptionfailed",me),new Error("peerconnection.setRemoteDescription() failed")}),s._connectionPromiseQueue}}).then(function(){if(s._status===N.STATUS_TERMINATED)throw new Error("terminated");return s._connecting(t),s._late_sdp?s._createLocalDescription("offer",s._rtcOfferConstraints).catch(function(){throw t.reply(500),new Error("_createLocalDescription() failed")}):s._createLocalDescription("answer",h).catch(function(){throw t.reply(500),new Error("_createLocalDescription() failed")})}).then(function(X){if(s._status===N.STATUS_TERMINATED)throw new Error("terminated");s._handleSessionTimersInIncomingRequest(t,u),t.reply(200,null,u,X,function(){s._status=N.STATUS_WAITING_FOR_ACK,s._setInvite2xxTimer(t,X),s._setACKTimer(),s._accepted("local")},function(){s._failed("system",null,U.causes.CONNECTION_ERROR)})}).catch(function(X){s._status!==N.STATUS_TERMINATED&&I.warn(X)})}},{key:"terminate",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};I.debug("terminate()");var t=c.cause||U.causes.BYE,u=se.cloneArray(c.extraHeaders),p=c.body,g,y=c.status_code,S=c.reason_phrase;if(this._status===N.STATUS_TERMINATED)throw new st.InvalidStateError(this._status);switch(this._status){case N.STATUS_NULL:case N.STATUS_INVITE_SENT:case N.STATUS_1XX_RECEIVED:if(I.debug("canceling session"),y&&(y<200||y>=700))throw new TypeError("Invalid status_code: ".concat(y));y&&(S=S||U.REASON_PHRASE[y]||"",g="SIP ;cause=".concat(y,' ;text="').concat(S,'"')),this._status===N.STATUS_NULL||this._status===N.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=g):this._status===N.STATUS_1XX_RECEIVED&&this._request.cancel(g),this._status=N.STATUS_CANCELED,this._failed("local",null,U.causes.CANCELED);break;case N.STATUS_WAITING_FOR_ANSWER:case N.STATUS_ANSWERED:if(I.debug("rejecting session"),y=y||480,y<300||y>=700)throw new TypeError("Invalid status_code: ".concat(y));this._request.reply(y,S,u,p),this._failed("local",null,U.causes.REJECTED);break;case N.STATUS_WAITING_FOR_ACK:case N.STATUS_CONFIRMED:if(I.debug("terminating session"),S=c.reason_phrase||U.REASON_PHRASE[y]||"",y&&(y<200||y>=700))throw new TypeError("Invalid status_code: ".concat(y));if(y&&u.push("Reason: SIP ;cause=".concat(y,'; text="').concat(S,'"')),this._status===N.STATUS_WAITING_FOR_ACK&&this._direction==="incoming"&&this._request.server_transaction.state!==eo.C.STATUS_TERMINATED){var h=this._dialog;this.receiveRequest=function(A){var m=A.method;m===U.ACK&&(s.sendRequest(U.BYE,{extraHeaders:u,body:p}),h.terminate())},this._request.server_transaction.on("stateChanged",function(){s._request.server_transaction.state===eo.C.STATUS_TERMINATED&&(s.sendRequest(U.BYE,{extraHeaders:u,body:p}),h.terminate())}),this._ended("local",null,t),this._dialog=h,this._ua.newDialog(h)}else this.sendRequest(U.BYE,{extraHeaders:u,body:p}),this._ended("local",null,t)}}},{key:"sendDTMF",value:function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};I.debug("sendDTMF() | tones: %s",s);var t=0,u=c.duration||null,p=c.interToneGap||null,g=c.transportType||U.DTMF_TRANSPORT.INFO;if(s===void 0)throw new TypeError("Not enough arguments");if(this._status!==N.STATUS_CONFIRMED&&this._status!==N.STATUS_WAITING_FOR_ACK&&this._status!==N.STATUS_1XX_RECEIVED)throw new st.InvalidStateError(this._status);if(g!==U.DTMF_TRANSPORT.INFO&&g!==U.DTMF_TRANSPORT.RFC2833)throw new TypeError("invalid transportType: ".concat(g));if(typeof s=="number"&&(s=s.toString()),!s||typeof s!="string"||!s.match(/^[0-9A-DR#*,]+$/i))throw new TypeError("Invalid tones: ".concat(s));if(u&&!se.isDecimal(u))throw new TypeError("Invalid tone duration: ".concat(u));if(u?u<Ee.C.MIN_DURATION?(I.debug('"duration" value is lower than the minimum allowed, setting it to '.concat(Ee.C.MIN_DURATION," milliseconds")),u=Ee.C.MIN_DURATION):u>Ee.C.MAX_DURATION?(I.debug('"duration" value is greater than the maximum allowed, setting it to '.concat(Ee.C.MAX_DURATION," milliseconds")),u=Ee.C.MAX_DURATION):u=Math.abs(u):u=Ee.C.DEFAULT_DURATION,c.duration=u,p&&!se.isDecimal(p))throw new TypeError("Invalid interToneGap: ".concat(p));if(p?p<Ee.C.MIN_INTER_TONE_GAP?(I.debug('"interToneGap" value is lower than the minimum allowed, setting it to '.concat(Ee.C.MIN_INTER_TONE_GAP," milliseconds")),p=Ee.C.MIN_INTER_TONE_GAP):p=Math.abs(p):p=Ee.C.DEFAULT_INTER_TONE_GAP,g===U.DTMF_TRANSPORT.RFC2833){var y=this._getDTMFRTPSender();y&&(s=y.toneBuffer+s,y.insertDTMF(s,u,p));return}if(this._tones){this._tones+=s;return}this._tones=s,S.call(this);function S(){var h=this,A;if(this._status===N.STATUS_TERMINATED||!this._tones||t>=this._tones.length){this._tones=null;return}var m=this._tones[t];if(t+=1,m===",")A=2e3;else{var C=new Ee(this);c.eventHandlers={onFailed:function(){h._tones=null}},C.send(m,c),A=u+p}setTimeout(S.bind(this),A)}}},{key:"sendInfo",value:function(s,c){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(I.debug("sendInfo()"),this._status!==N.STATUS_CONFIRMED&&this._status!==N.STATUS_WAITING_FOR_ACK&&this._status!==N.STATUS_1XX_RECEIVED)throw new st.InvalidStateError(this._status);var u=new to(this);u.send(s,c,t)}},{key:"mute",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{audio:!0,video:!1};I.debug("mute()");var c=!1,t=!1;this._audioMuted===!1&&s.audio&&(c=!0,this._audioMuted=!0,this._toggleMuteAudio(!0)),this._videoMuted===!1&&s.video&&(t=!0,this._videoMuted=!0,this._toggleMuteVideo(!0)),(c===!0||t===!0)&&this._onmute({audio:c,video:t})}},{key:"unmute",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{audio:!0,video:!0};I.debug("unmute()");var c=!1,t=!1;this._audioMuted===!0&&s.audio&&(c=!0,this._audioMuted=!1,this._localHold===!1&&this._toggleMuteAudio(!1)),this._videoMuted===!0&&s.video&&(t=!0,this._videoMuted=!1,this._localHold===!1&&this._toggleMuteVideo(!1)),(c===!0||t===!0)&&this._onunmute({audio:c,video:t})}},{key:"hold",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(I.debug("hold()"),this._status!==N.STATUS_WAITING_FOR_ACK&&this._status!==N.STATUS_CONFIRMED||this._localHold===!0||!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");var u={succeeded:function(){t&&t()},failed:function(){s.terminate({cause:U.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return c.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:u,extraHeaders:c.extraHeaders}):this._sendReinvite({eventHandlers:u,extraHeaders:c.extraHeaders}),!0}},{key:"unhold",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(I.debug("unhold()"),this._status!==N.STATUS_WAITING_FOR_ACK&&this._status!==N.STATUS_CONFIRMED||this._localHold===!1||!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");var u={succeeded:function(){t&&t()},failed:function(){s.terminate({cause:U.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return c.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:u,extraHeaders:c.extraHeaders}):this._sendReinvite({eventHandlers:u,extraHeaders:c.extraHeaders}),!0}},{key:"renegotiate",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;I.debug("renegotiate()");var u=c.rtcOfferConstraints||null;if(this._status!==N.STATUS_WAITING_FOR_ACK&&this._status!==N.STATUS_CONFIRMED||!this._isReadyToReOffer())return!1;var p={succeeded:function(){t&&t()},failed:function(){s.terminate({cause:U.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}};return this._setLocalMediaStatus(),c.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:p,rtcOfferConstraints:u,extraHeaders:c.extraHeaders}):this._sendReinvite({eventHandlers:p,rtcOfferConstraints:u,extraHeaders:c.extraHeaders}),!0}},{key:"refer",value:function(s,c){var t=this;I.debug("refer()");var u=s;if(this._status!==N.STATUS_WAITING_FOR_ACK&&this._status!==N.STATUS_CONFIRMED)return!1;if(s=this._ua.normalizeTarget(s),!s)throw new TypeError("Invalid target: ".concat(u));var p=new sh(this);p.sendRefer(s,c);var g=p.id;return this._referSubscribers[g]=p,p.on("requestFailed",function(){delete t._referSubscribers[g]}),p.on("accepted",function(){delete t._referSubscribers[g]}),p.on("failed",function(){delete t._referSubscribers[g]}),p}},{key:"sendRequest",value:function(s,c){return I.debug("sendRequest()"),this._dialog.sendRequest(s,c)}},{key:"receiveRequest",value:function(s){var c=this;if(I.debug("receiveRequest()"),s.method===U.CANCEL)(this._status===N.STATUS_WAITING_FOR_ANSWER||this._status===N.STATUS_ANSWERED)&&(this._status=N.STATUS_CANCELED,this._request.reply(487),this._failed("remote",s,U.causes.CANCELED));else switch(s.method){case U.ACK:if(this._status!==N.STATUS_WAITING_FOR_ACK)return;if(this._status=N.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!s.body){this.terminate({cause:U.causes.MISSING_SDP,status_code:400});break}var t={originator:"remote",type:"answer",sdp:s.body};I.debug('emit "sdp"'),this.emit("sdp",t);var u=new RTCSessionDescription({type:"answer",sdp:t.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return c._connection.setRemoteDescription(u)}).then(function(){c._is_confirmed||c._confirmed("remote",s)}).catch(function(g){c.terminate({cause:U.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),I.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',g),c.emit("peerconnection:setremotedescriptionfailed",g)})}else this._is_confirmed||this._confirmed("remote",s);break;case U.BYE:this._status===N.STATUS_CONFIRMED||this._status===N.STATUS_WAITING_FOR_ACK?(s.reply(200),this._ended("remote",s,U.causes.BYE)):this._status===N.STATUS_INVITE_RECEIVED||this._status===N.STATUS_WAITING_FOR_ANSWER?(s.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",s,U.causes.BYE)):s.reply(403,"Wrong Status");break;case U.INVITE:this._status===N.STATUS_CONFIRMED?s.hasHeader("replaces")?this._receiveReplaces(s):this._receiveReinvite(s):s.reply(403,"Wrong Status");break;case U.INFO:if(this._status===N.STATUS_1XX_RECEIVED||this._status===N.STATUS_WAITING_FOR_ANSWER||this._status===N.STATUS_ANSWERED||this._status===N.STATUS_WAITING_FOR_ACK||this._status===N.STATUS_CONFIRMED){var p=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0;p&&p.match(/^application\/dtmf-relay/i)?new Ee(this).init_incoming(s):p!==void 0?new to(this).init_incoming(s):s.reply(415)}else s.reply(403,"Wrong Status");break;case U.UPDATE:this._status===N.STATUS_CONFIRMED?this._receiveUpdate(s):s.reply(403,"Wrong Status");break;case U.REFER:this._status===N.STATUS_CONFIRMED?this._receiveRefer(s):s.reply(403,"Wrong Status");break;case U.NOTIFY:this._status===N.STATUS_CONFIRMED?this._receiveNotify(s):s.reply(403,"Wrong Status");break;default:s.reply(501)}}},{key:"onTransportError",value:function(){I.warn("onTransportError()"),this._status!==N.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:U.causes.CONNECTION_ERROR,cause:U.causes.CONNECTION_ERROR})}},{key:"onRequestTimeout",value:function(){I.warn("onRequestTimeout()"),this._status!==N.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:U.causes.REQUEST_TIMEOUT,cause:U.causes.REQUEST_TIMEOUT})}},{key:"onDialogError",value:function(){I.warn("onDialogError()"),this._status!==N.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:U.causes.DIALOG_ERROR,cause:U.causes.DIALOG_ERROR})}},{key:"newDTMF",value:function(s){I.debug("newDTMF()"),this.emit("newDTMF",s)}},{key:"newInfo",value:function(s){I.debug("newInfo()"),this.emit("newInfo",s)}},{key:"_isReadyToReOffer",value:function(){return this._rtcReady?this._dialog?this._dialog.uac_pending_reply===!0||this._dialog.uas_pending_reply===!0?(I.debug("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):!0:(I.debug("_isReadyToReOffer() | session not established yet"),!1):(I.debug("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}},{key:"_close",value:function(){if(I.debug("close()"),this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(I.debug("close() | closing local MediaStream"),se.closeMediaStream(this._localMediaStream)),this._status!==N.STATUS_TERMINATED){if(this._status=N.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(u){I.warn("close() | error closing the RTCPeerConnection: %o",u)}for(var s in this._timers)Object.prototype.hasOwnProperty.call(this._timers,s)&&clearTimeout(this._timers[s]);clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog);for(var c in this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,c)&&(this._earlyDialogs[c].terminate(),delete this._earlyDialogs[c]);for(var t in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,t)&&delete this._referSubscribers[t];this._ua.destroyRTCSession(this)}}},{key:"_setInvite2xxTimer",value:function(s,c){var t=Qt.T1;function u(){this._status===N.STATUS_WAITING_FOR_ACK&&(s.reply(200,null,["Contact: ".concat(this._contact)],c),t<Qt.T2&&(t=t*2,t>Qt.T2&&(t=Qt.T2)),this._timers.invite2xxTimer=setTimeout(u.bind(this),t))}this._timers.invite2xxTimer=setTimeout(u.bind(this),t)}},{key:"_setACKTimer",value:function(){var s=this;this._timers.ackTimer=setTimeout(function(){s._status===N.STATUS_WAITING_FOR_ACK&&(I.debug("no ACK received, terminating the session"),clearTimeout(s._timers.invite2xxTimer),s.sendRequest(U.BYE),s._ended("remote",null,U.causes.NO_ACK))},Qt.TIMER_H)}},{key:"_createRTCConnection",value:function(s,c){var t=this;this._connection=new RTCPeerConnection(s,c),this._connection.addEventListener("iceconnectionstatechange",function(){var u=t._connection.iceConnectionState;u==="failed"&&t.terminate({cause:U.causes.RTP_TIMEOUT,status_code:408,reason_phrase:U.causes.RTP_TIMEOUT})}),I.debug('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}},{key:"_createLocalDescription",value:function(s,c){var t=this;if(I.debug("createLocalDescription()"),s!=="offer"&&s!=="answer")throw new Error('createLocalDescription() | invalid type "'.concat(s,'"'));var u=this._connection;return this._rtcReady=!1,Promise.resolve().then(function(){return s==="offer"?u.createOffer(c).catch(function(p){return I.warn('emit "peerconnection:createofferfailed" [error:%o]',p),t.emit("peerconnection:createofferfailed",p),Promise.reject(p)}):u.createAnswer(c).catch(function(p){return I.warn('emit "peerconnection:createanswerfailed" [error:%o]',p),t.emit("peerconnection:createanswerfailed",p),Promise.reject(p)})}).then(function(p){return u.setLocalDescription(p).catch(function(g){return t._rtcReady=!0,I.warn('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',g),t.emit("peerconnection:setlocaldescriptionfailed",g),Promise.reject(g)})}).then(function(){var p=c&&c.iceRestart;if(u.iceGatheringState==="complete"&&!p||u.iceGatheringState==="gathering"&&t._iceReady){t._rtcReady=!0;var g={originator:"local",type:s,sdp:u.localDescription.sdp};return I.debug('emit "sdp"'),t.emit("sdp",g),Promise.resolve(g.sdp)}return new Promise(function(y){var S=!1,h,A;t._iceReady=!1;var m=function(){if(!S){u.removeEventListener("icecandidate",h),u.removeEventListener("icegatheringstatechange",A),S=!0,t._rtcReady=!0,t._iceReady=!0;var x={originator:"local",type:s,sdp:u.localDescription.sdp};I.debug('emit "sdp"'),t.emit("sdp",x),y(x.sdp)}};u.addEventListener("icecandidate",h=function(x){var L=x.candidate;L?t.emit("icecandidate",{candidate:L,ready:m}):m()}),u.addEventListener("icegatheringstatechange",A=function(){u.iceGatheringState==="complete"&&m()})})})}},{key:"_createDialog",value:function(s,c,t){var u=c==="UAS"?s.to_tag:s.from_tag,p=c==="UAS"?s.from_tag:s.to_tag,g=s.call_id+u+p,y=this._earlyDialogs[g];if(t)return y?!0:(y=new Jn(this,s,c,Jn.C.STATUS_EARLY),y.error?(I.debug(y.error),this._failed("remote",s,U.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[g]=y,!0));if(this._from_tag=s.from_tag,this._to_tag=s.to_tag,y)return y.update(s,c),this._dialog=y,delete this._earlyDialogs[g],!0;var S=new Jn(this,s,c);return S.error?(I.debug(S.error),this._failed("remote",s,U.causes.INTERNAL_ERROR),!1):(this._dialog=S,!0)}},{key:"_receiveReinvite",value:function(s){var c=this;I.debug("receiveReinvite()");var t=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0,u={request:s,callback:void 0,reject:g.bind(this)},p=!1;function g(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};p=!0;var h=S.status_code||403,A=S.reason_phrase||"",m=se.cloneArray(S.extraHeaders);if(this._status!==N.STATUS_CONFIRMED)return!1;if(h<300||h>=700)throw new TypeError("Invalid status_code: ".concat(h));s.reply(h,A,m)}if(this.emit("reinvite",u),p)return;if(this._late_sdp=!1,!s.body){this._late_sdp=!0,this._remoteHold&&(this._remoteHold=!1,this._onunhold("remote")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return c._createLocalDescription("offer",c._rtcOfferConstraints)}).then(function(S){y.call(c,S)}).catch(function(){s.reply(500)});return}if(t!=="application/sdp"){I.debug("invalid Content-Type"),s.reply(415);return}this._processInDialogSdpOffer(s).then(function(S){c._status!==N.STATUS_TERMINATED&&y.call(c,S)}).catch(function(S){I.warn(S)});function y(S){var h=this,A=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(s,A),this._late_sdp&&(S=this._mangleOffer(S)),s.reply(200,null,A,S,function(){h._status=N.STATUS_WAITING_FOR_ACK,h._setInvite2xxTimer(s,S),h._setACKTimer()}),typeof u.callback=="function"&&u.callback()}}},{key:"_receiveUpdate",value:function(s){var c=this;I.debug("receiveUpdate()");var t=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0,u={request:s,callback:void 0,reject:g.bind(this)},p=!1;function g(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};p=!0;var h=S.status_code||403,A=S.reason_phrase||"",m=se.cloneArray(S.extraHeaders);if(this._status!==N.STATUS_CONFIRMED)return!1;if(h<300||h>=700)throw new TypeError("Invalid status_code: ".concat(h));s.reply(h,A,m)}if(this.emit("update",u),p)return;if(!s.body){y.call(this,null);return}if(t!=="application/sdp"){I.debug("invalid Content-Type"),s.reply(415);return}this._processInDialogSdpOffer(s).then(function(S){c._status!==N.STATUS_TERMINATED&&y.call(c,S)}).catch(function(S){I.warn(S)});function y(S){var h=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(s,h),s.reply(200,null,h,S),typeof u.callback=="function"&&u.callback()}}},{key:"_processInDialogSdpOffer",value:function(s){var c=this;I.debug("_processInDialogSdpOffer()");var t=s.parseSDP(),u=!1,p=ze(t.media),g;try{for(p.s();!(g=p.n()).done;){var y=g.value;if(Xn.indexOf(y.type)!==-1){var S=y.direction||t.direction||"sendrecv";if(S==="sendonly"||S==="inactive")u=!0;else{u=!1;break}}}}catch(m){p.e(m)}finally{p.f()}var h={originator:"remote",type:"offer",sdp:s.body};I.debug('emit "sdp"'),this.emit("sdp",h);var A=new RTCSessionDescription({type:"offer",sdp:h.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if(c._status===N.STATUS_TERMINATED)throw new Error("terminated");return c._connection.setRemoteDescription(A).catch(function(m){throw s.reply(488),I.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',m),c.emit("peerconnection:setremotedescriptionfailed",m),m})}).then(function(){if(c._status===N.STATUS_TERMINATED)throw new Error("terminated");c._remoteHold===!0&&u===!1?(c._remoteHold=!1,c._onunhold("remote")):c._remoteHold===!1&&u===!0&&(c._remoteHold=!0,c._onhold("remote"))}).then(function(){if(c._status===N.STATUS_TERMINATED)throw new Error("terminated");return c._createLocalDescription("answer",c._rtcAnswerConstraints).catch(function(m){throw s.reply(500),I.warn('emit "peerconnection:createtelocaldescriptionfailed" [error:%o]',m),m})}).catch(function(m){I.warn("_processInDialogSdpOffer() failed [error: %o]",m)}),this._connectionPromiseQueue}},{key:"_receiveRefer",value:function(s){var c=this;if(I.debug("receiveRefer()"),!s.refer_to){I.debug("no Refer-To header field present in REFER"),s.reply(400);return}if(s.refer_to.uri.scheme!==U.SIP){I.debug("Refer-To header field points to a non-SIP URI scheme"),s.reply(416);return}s.reply(202);var t=new ih(this,s.cseq);I.debug('emit "refer"'),this.emit("refer",{request:s,accept:function(y,S){u.call(c,y,S)},reject:function(){p.call(c)}});function u(g){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(g=typeof g=="function"?g:null,this._status!==N.STATUS_WAITING_FOR_ACK&&this._status!==N.STATUS_CONFIRMED)return!1;var S=new i(this._ua);if(S.on("progress",function(A){var m=A.response;t.notify(m.status_code,m.reason_phrase)}),S.on("accepted",function(A){var m=A.response;t.notify(m.status_code,m.reason_phrase)}),S.on("_failed",function(A){var m=A.message,C=A.cause;m?t.notify(m.status_code,m.reason_phrase):t.notify(487,C)}),s.refer_to.uri.hasHeader("replaces")){var h=decodeURIComponent(s.refer_to.uri.getHeader("replaces"));y.extraHeaders=se.cloneArray(y.extraHeaders),y.extraHeaders.push("Replaces: ".concat(h))}S.connect(s.refer_to.uri.toAor(),y,g)}function p(){t.notify(603)}}},{key:"_receiveNotify",value:function(s){switch(I.debug("receiveNotify()"),s.event||s.reply(400),s.event.event){case"refer":{var c,t;if(s.event.params&&s.event.params.id)c=s.event.params.id,t=this._referSubscribers[c];else if(Object.keys(this._referSubscribers).length===1)t=this._referSubscribers[Object.keys(this._referSubscribers)[0]];else{s.reply(400,"Missing event id parameter");return}if(!t){s.reply(481,"Subscription does not exist");return}t.receiveNotify(s),s.reply(200);break}default:s.reply(489)}}},{key:"_receiveReplaces",value:function(s){var c=this;I.debug("receiveReplaces()");function t(p){var g=this;if(this._status!==N.STATUS_WAITING_FOR_ACK&&this._status!==N.STATUS_CONFIRMED)return!1;var y=new i(this._ua);y.on("confirmed",function(){g.terminate()}),y.init_incoming(s,p)}function u(){I.debug("Replaced INVITE rejected by the user"),s.reply(486)}this.emit("replaces",{request:s,accept:function(g){t.call(c,g)},reject:function(){u.call(c)}})}},{key:"_sendInitialRequest",value:function(s,c,t){var u=this,p=new rh(this._ua,this._request,{onRequestTimeout:function(){u.onRequestTimeout()},onTransportError:function(){u.onTransportError()},onAuthenticated:function(y){u._request=y},onReceiveResponse:function(y){u._receiveInviteResponse(y)}});Promise.resolve().then(function(){if(t)return t;if(s.audio||s.video)return u._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(s).catch(function(g){throw u._status===N.STATUS_TERMINATED?new Error("terminated"):(u._failed("local",null,U.causes.USER_DENIED_MEDIA_ACCESS),I.warn('emit "getusermediafailed" [error:%o]',g),u.emit("getusermediafailed",g),g)})}).then(function(g){if(u._status===N.STATUS_TERMINATED)throw new Error("terminated");return u._localMediaStream=g,g&&g.getTracks().forEach(function(y){u._connection.addTrack(y,g)}),u._connecting(u._request),u._createLocalDescription("offer",c).catch(function(y){throw u._failed("local",null,U.causes.WEBRTC_ERROR),y})}).then(function(g){if(u._is_canceled||u._status===N.STATUS_TERMINATED)throw new Error("terminated");u._request.body=g,u._status=N.STATUS_INVITE_SENT,I.debug('emit "sending" [request:%o]',u._request),u.emit("sending",{request:u._request}),p.send()}).catch(function(g){u._status!==N.STATUS_TERMINATED&&I.warn(g)})}},{key:"_getDTMFRTPSender",value:function(){var s=this._connection.getSenders().find(function(c){return c.track&&c.track.kind==="audio"});if(!(s&&s.dtmf)){I.warn("sendDTMF() | no local audio track to send DTMF with");return}return s.dtmf}},{key:"_receiveInviteResponse",value:function(s){var c=this;if(I.debug("receiveInviteResponse()"),this._dialog&&s.status_code>=200&&s.status_code<=299)if(this._dialog.id.call_id===s.call_id&&this._dialog.id.local_tag===s.from_tag&&this._dialog.id.remote_tag===s.to_tag){this.sendRequest(U.ACK);return}else{var t=new Jn(this,s,"UAC");if(t.error!==void 0){I.debug(t.error);return}this.sendRequest(U.ACK),this.sendRequest(U.BYE);return}if(this._is_canceled){s.status_code>=100&&s.status_code<200?this._request.cancel(this._cancel_reason):s.status_code>=200&&s.status_code<299&&this._acceptAndTerminate(s);return}if(!(this._status!==N.STATUS_INVITE_SENT&&this._status!==N.STATUS_1XX_RECEIVED))switch(!0){case/^100$/.test(s.status_code):this._status=N.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(s.status_code):{if(!s.to_tag){I.debug("1xx response received without to tag");break}if(s.hasHeader("contact")&&!this._createDialog(s,"UAC",!0))break;if(this._status=N.STATUS_1XX_RECEIVED,!s.body){this._progress("remote",s);break}var u={originator:"remote",type:"answer",sdp:s.body};I.debug('emit "sdp"'),this.emit("sdp",u);var p=new RTCSessionDescription({type:"answer",sdp:u.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return c._connection.setRemoteDescription(p)}).then(function(){return c._progress("remote",s)}).catch(function(h){I.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',h),c.emit("peerconnection:setremotedescriptionfailed",h)});break}case/^2[0-9]{2}$/.test(s.status_code):{if(this._status=N.STATUS_CONFIRMED,!s.body){this._acceptAndTerminate(s,400,U.causes.MISSING_SDP),this._failed("remote",s,U.causes.BAD_MEDIA_DESCRIPTION);break}if(!this._createDialog(s,"UAC"))break;var g={originator:"remote",type:"answer",sdp:s.body};I.debug('emit "sdp"'),this.emit("sdp",g);var y=new RTCSessionDescription({type:"answer",sdp:g.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if(c._connection.signalingState==="stable")return c._connection.createOffer(c._rtcOfferConstraints).then(function(h){return c._connection.setLocalDescription(h)}).catch(function(h){c._acceptAndTerminate(s,500,h.toString()),c._failed("local",s,U.causes.WEBRTC_ERROR)})}).then(function(){c._connection.setRemoteDescription(y).then(function(){c._handleSessionTimersInIncomingResponse(s),c._accepted("remote",s),c.sendRequest(U.ACK),c._confirmed("local",null)}).catch(function(h){c._acceptAndTerminate(s,488,"Not Acceptable Here"),c._failed("remote",s,U.causes.BAD_MEDIA_DESCRIPTION),I.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',h),c.emit("peerconnection:setremotedescriptionfailed",h)})});break}default:{var S=se.sipErrorCause(s.status_code);this._failed("remote",s,S)}}}},{key:"_sendReinvite",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};I.debug("sendReinvite()");var t=se.cloneArray(c.extraHeaders),u=se.cloneObject(c.eventHandlers),p=c.rtcOfferConstraints||this._rtcOfferConstraints||null,g=!1;t.push("Contact: ".concat(this._contact)),t.push("Content-Type: application/sdp"),this._sessionTimers.running&&t.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return s._createLocalDescription("offer",p)}).then(function(h){h=s._mangleOffer(h);var A={originator:"local",type:"offer",sdp:h};I.debug('emit "sdp"'),s.emit("sdp",A),s.sendRequest(U.INVITE,{extraHeaders:t,body:h,eventHandlers:{onSuccessResponse:function(C){y.call(s,C),g=!0},onErrorResponse:function(C){S.call(s,C)},onTransportError:function(){s.onTransportError()},onRequestTimeout:function(){s.onRequestTimeout()},onDialogError:function(){s.onDialogError()}}})}).catch(function(){S()});function y(h){var A=this;if(this._status!==N.STATUS_TERMINATED&&(this.sendRequest(U.ACK),!g)){if(this._handleSessionTimersInIncomingResponse(h),h.body){if(!h.hasHeader("Content-Type")||h.getHeader("Content-Type").toLowerCase()!=="application/sdp"){S.call(this);return}}else{S.call(this);return}var m={originator:"remote",type:"answer",sdp:h.body};I.debug('emit "sdp"'),this.emit("sdp",m);var C=new RTCSessionDescription({type:"answer",sdp:m.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return A._connection.setRemoteDescription(C)}).then(function(){u.succeeded&&u.succeeded(h)}).catch(function(x){S.call(A),I.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',x),A.emit("peerconnection:setremotedescriptionfailed",x)})}}function S(h){u.failed&&u.failed(h)}}},{key:"_sendUpdate",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};I.debug("sendUpdate()");var t=se.cloneArray(c.extraHeaders),u=se.cloneObject(c.eventHandlers),p=c.rtcOfferConstraints||this._rtcOfferConstraints||null,g=c.sdpOffer||!1,y=!1;t.push("Contact: ".concat(this._contact)),this._sessionTimers.running&&t.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),g?(t.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return s._createLocalDescription("offer",p)}).then(function(A){A=s._mangleOffer(A);var m={originator:"local",type:"offer",sdp:A};I.debug('emit "sdp"'),s.emit("sdp",m),s.sendRequest(U.UPDATE,{extraHeaders:t,body:A,eventHandlers:{onSuccessResponse:function(x){S.call(s,x),y=!0},onErrorResponse:function(x){h.call(s,x)},onTransportError:function(){s.onTransportError()},onRequestTimeout:function(){s.onRequestTimeout()},onDialogError:function(){s.onDialogError()}}})}).catch(function(){h.call(s)})):this.sendRequest(U.UPDATE,{extraHeaders:t,eventHandlers:{onSuccessResponse:function(m){S.call(s,m)},onErrorResponse:function(m){h.call(s,m)},onTransportError:function(){s.onTransportError()},onRequestTimeout:function(){s.onRequestTimeout()},onDialogError:function(){s.onDialogError()}}});function S(A){var m=this;if(this._status!==N.STATUS_TERMINATED&&!y)if(this._handleSessionTimersInIncomingResponse(A),g){if(A.body){if(!A.hasHeader("Content-Type")||A.getHeader("Content-Type").toLowerCase()!=="application/sdp"){h.call(this);return}}else{h.call(this);return}var C={originator:"remote",type:"answer",sdp:A.body};I.debug('emit "sdp"'),this.emit("sdp",C);var x=new RTCSessionDescription({type:"answer",sdp:C.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return m._connection.setRemoteDescription(x)}).then(function(){u.succeeded&&u.succeeded(A)}).catch(function(L){h.call(m),I.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',L),m.emit("peerconnection:setremotedescriptionfailed",L)})}else u.succeeded&&u.succeeded(A)}function h(A){u.failed&&u.failed(A)}}},{key:"_acceptAndTerminate",value:function(s,c,t){I.debug("acceptAndTerminate()");var u=[];c&&(t=t||U.REASON_PHRASE[c]||"",u.push("Reason: SIP ;cause=".concat(c,'; text="').concat(t,'"'))),(this._dialog||this._createDialog(s,"UAC"))&&(this.sendRequest(U.ACK),this.sendRequest(U.BYE,{extraHeaders:u})),this._status=N.STATUS_TERMINATED}},{key:"_mangleOffer",value:function(s){if(!this._localHold&&!this._remoteHold)return s;if(s=Za.parse(s),this._localHold&&!this._remoteHold){I.debug("mangleOffer() | me on hold, mangling offer");var c=ze(s.media),t;try{for(c.s();!(t=c.n()).done;){var u=t.value;Xn.indexOf(u.type)!==-1&&(u.direction?u.direction==="sendrecv"?u.direction="sendonly":u.direction==="recvonly"&&(u.direction="inactive"):u.direction="sendonly")}}catch(m){c.e(m)}finally{c.f()}}else if(this._localHold&&this._remoteHold){I.debug("mangleOffer() | both on hold, mangling offer");var p=ze(s.media),g;try{for(p.s();!(g=p.n()).done;){var y=g.value;Xn.indexOf(y.type)!==-1&&(y.direction="inactive")}}catch(m){p.e(m)}finally{p.f()}}else if(this._remoteHold){I.debug("mangleOffer() | remote on hold, mangling offer");var S=ze(s.media),h;try{for(S.s();!(h=S.n()).done;){var A=h.value;Xn.indexOf(A.type)!==-1&&(A.direction?A.direction==="sendrecv"?A.direction="recvonly":A.direction==="recvonly"&&(A.direction="inactive"):A.direction="recvonly")}}catch(m){S.e(m)}finally{S.f()}}return Za.write(s)}},{key:"_setLocalMediaStatus",value:function(){var s=!0,c=!0;(this._localHold||this._remoteHold)&&(s=!1,c=!1),this._audioMuted&&(s=!1),this._videoMuted&&(c=!1),this._toggleMuteAudio(!s),this._toggleMuteVideo(!c)}},{key:"_handleSessionTimersInIncomingRequest",value:function(s,c){if(this._sessionTimers.enabled){var t;s.session_expires&&s.session_expires>=U.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=s.session_expires,t=s.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,t="uas"),c.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(t)),this._sessionTimers.refresher=t==="uas",this._runSessionTimer()}}},{key:"_handleSessionTimersInIncomingResponse",value:function(s){if(this._sessionTimers.enabled){var c;s.session_expires&&s.session_expires>=U.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=s.session_expires,c=s.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,c="uac"),this._sessionTimers.refresher=c==="uac",this._runSessionTimer()}}},{key:"_runSessionTimer",value:function(){var s=this,c=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout(function(){s._status!==N.STATUS_TERMINATED&&s._isReadyToReOffer()&&(I.debug("runSessionTimer() | sending session refresh request"),s._sessionTimers.refreshMethod===U.UPDATE?s._sendUpdate():s._sendReinvite())},c*500):this._sessionTimers.timer=setTimeout(function(){s._status!==N.STATUS_TERMINATED&&(I.warn("runSessionTimer() | timer expired, terminating the session"),s.terminate({cause:U.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},c*1100)}},{key:"_toggleMuteAudio",value:function(s){var c=this._connection.getSenders().filter(function(g){return g.track&&g.track.kind==="audio"}),t=ze(c),u;try{for(t.s();!(u=t.n()).done;){var p=u.value;p.track.enabled=!s}}catch(g){t.e(g)}finally{t.f()}}},{key:"_toggleMuteVideo",value:function(s){var c=this._connection.getSenders().filter(function(g){return g.track&&g.track.kind==="video"}),t=ze(c),u;try{for(t.s();!(u=t.n()).done;){var p=u.value;p.track.enabled=!s}}catch(g){t.e(g)}finally{t.f()}}},{key:"_newRTCSession",value:function(s,c){I.debug("newRTCSession()"),this._ua.newRTCSession(this,{originator:s,session:this,request:c})}},{key:"_connecting",value:function(s){I.debug("session connecting"),I.debug('emit "connecting"'),this.emit("connecting",{request:s})}},{key:"_progress",value:function(s,c){I.debug("session progress"),I.debug('emit "progress"'),this.emit("progress",{originator:s,response:c||null})}},{key:"_accepted",value:function(s,c){I.debug("session accepted"),this._start_time=new Date,I.debug('emit "accepted"'),this.emit("accepted",{originator:s,response:c||null})}},{key:"_confirmed",value:function(s,c){I.debug("session confirmed"),this._is_confirmed=!0,I.debug('emit "confirmed"'),this.emit("confirmed",{originator:s,ack:c||null})}},{key:"_ended",value:function(s,c,t){I.debug("session ended"),this._end_time=new Date,this._close(),I.debug('emit "ended"'),this.emit("ended",{originator:s,message:c||null,cause:t})}},{key:"_failed",value:function(s,c,t){I.debug("session failed"),I.debug('emit "_failed"'),this.emit("_failed",{originator:s,message:c||null,cause:t}),this._close(),I.debug('emit "failed"'),this.emit("failed",{originator:s,message:c||null,cause:t})}},{key:"_onhold",value:function(s){I.debug("session onhold"),this._setLocalMediaStatus(),I.debug('emit "hold"'),this.emit("hold",{originator:s})}},{key:"_onunhold",value:function(s){I.debug("session onunhold"),this._setLocalMediaStatus(),I.debug('emit "unhold"'),this.emit("unhold",{originator:s})}},{key:"_onmute",value:function(s){var c=s.audio,t=s.video;I.debug("session onmute"),this._setLocalMediaStatus(),I.debug('emit "muted"'),this.emit("muted",{audio:c,video:t})}},{key:"_onunmute",value:function(s){var c=s.audio,t=s.video;I.debug("session onunmute"),this._setLocalMediaStatus(),I.debug('emit "unmuted"'),this.emit("unmuted",{audio:c,video:t})}},{key:"C",get:function(){return N}},{key:"causes",get:function(){return U.causes}},{key:"id",get:function(){return this._id}},{key:"connection",get:function(){return this._connection}},{key:"contact",get:function(){return this._contact}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"start_time",get:function(){return this._start_time}},{key:"end_time",get:function(){return this._end_time}},{key:"data",get:function(){return this._data},set:function(s){this._data=s}},{key:"status",get:function(){return this._status}}]),i})(eh)});var oo=B((n_,ao)=>{"use strict";function tr(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?tr=function(i){return typeof i}:tr=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},tr(a)}function lh(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function so(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function ah(a,o,i){return o&&so(a.prototype,o),i&&so(a,i),a}function oh(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&hi(a,o)}function hi(a,o){return hi=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},hi(a,o)}function uh(a){var o=hh();return function(){var n=nr(a),s;if(o){var c=nr(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return fh(this,s)}}function fh(a,o){return o&&(tr(o)==="object"||typeof o=="function")?o:ch(a)}function ch(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function hh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function nr(a){return nr=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},nr(a)}var dh=Ge().EventEmitter,_h=ce(),ci=ae(),ph=Ue(),Zt=de(),vh=Ct(),lo=qe(),gh=je(),er=new _h("Message");ao.exports=(function(a){oh(i,a);var o=uh(i);function i(n){var s;return lh(this,i),s=o.call(this),s._ua=n,s._request=null,s._closed=!1,s._direction=null,s._local_identity=null,s._remote_identity=null,s._is_replied=!1,s._data={},s}return ah(i,[{key:"send",value:function(s,c){var t=this,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},p=s;if(s===void 0||c===void 0)throw new TypeError("Not enough arguments");if(s=this._ua.normalizeTarget(s),!s)throw new TypeError("Invalid target: ".concat(p));var g=Zt.cloneArray(u.extraHeaders),y=Zt.cloneObject(u.eventHandlers),S=u.contentType||"text/plain",h={};u.fromUserName&&(h.from_uri=new gh("sip",u.fromUserName,this._ua.configuration.uri.host),g.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),u.fromDisplayName&&(h.from_display_name=u.fromDisplayName);for(var A in y)Object.prototype.hasOwnProperty.call(y,A)&&this.on(A,y[A]);g.push("Content-Type: ".concat(S)),this._request=new ph.OutgoingRequest(ci.MESSAGE,s,this._ua,h,g),c&&(this._request.body=c);var m=new vh(this._ua,this._request,{onRequestTimeout:function(){t._onRequestTimeout()},onTransportError:function(){t._onTransportError()},onReceiveResponse:function(x){t._receiveResponse(x)}});this._newMessage("local",this._request),m.send()}},{key:"init_incoming",value:function(s){this._request=s,this._newMessage("remote",s),this._is_replied||(this._is_replied=!0,s.reply(200)),this._close()}},{key:"accept",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=Zt.cloneArray(s.extraHeaders),t=s.body;if(this._direction!=="incoming")throw new lo.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,c,t)}},{key:"reject",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s.status_code||480,t=s.reason_phrase,u=Zt.cloneArray(s.extraHeaders),p=s.body;if(this._direction!=="incoming")throw new lo.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(c<300||c>=700)throw new TypeError("Invalid status_code: ".concat(c));this._is_replied=!0,this._request.reply(c,t,u,p)}},{key:"_receiveResponse",value:function(s){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(s.status_code):break;case/^2[0-9]{2}$/.test(s.status_code):this._succeeded("remote",s);break;default:{var c=Zt.sipErrorCause(s.status_code);this._failed("remote",s,c);break}}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,ci.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,ci.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newMessage",value:function(s,c){s==="remote"?(this._direction="incoming",this._local_identity=c.to,this._remote_identity=c.from):s==="local"&&(this._direction="outgoing",this._local_identity=c.from,this._remote_identity=c.to),this._ua.newMessage(this,{originator:s,message:this,request:c})}},{key:"_failed",value:function(s,c,t){er.debug("MESSAGE failed"),this._close(),er.debug('emit "failed"'),this.emit("failed",{originator:s,response:c||null,cause:t})}},{key:"_succeeded",value:function(s,c){er.debug("MESSAGE succeeded"),this._close(),er.debug('emit "succeeded"'),this.emit("succeeded",{originator:s,response:c})}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}}]),i})(dh)});var ho=B((r_,co)=>{"use strict";function ir(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ir=function(i){return typeof i}:ir=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},ir(a)}function mh(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function uo(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function yh(a,o,i){return o&&uo(a.prototype,o),i&&uo(a,i),a}function Th(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&_i(a,o)}function _i(a,o){return _i=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},_i(a,o)}function Sh(a){var o=bh();return function(){var n=sr(a),s;if(o){var c=sr(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return Ch(this,s)}}function Ch(a,o){return o&&(ir(o)==="object"||typeof o=="function")?o:Eh(a)}function Eh(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function bh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function sr(a){return sr=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},sr(a)}var Ah=Ge().EventEmitter,Rh=ce(),di=ae(),wh=Ue(),en=de(),Ih=Ct(),fo=qe(),rr=new Rh("Options");co.exports=(function(a){Th(i,a);var o=Sh(i);function i(n){var s;return mh(this,i),s=o.call(this),s._ua=n,s._request=null,s._closed=!1,s._direction=null,s._local_identity=null,s._remote_identity=null,s._is_replied=!1,s._data={},s}return yh(i,[{key:"send",value:function(s,c){var t=this,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},p=s;if(s===void 0)throw new TypeError("A target is required for OPTIONS");if(s=this._ua.normalizeTarget(s),!s)throw new TypeError("Invalid target: ".concat(p));var g=en.cloneArray(u.extraHeaders),y=en.cloneObject(u.eventHandlers),S=u.contentType||"application/sdp";for(var h in y)Object.prototype.hasOwnProperty.call(y,h)&&this.on(h,y[h]);g.push("Content-Type: ".concat(S)),this._request=new wh.OutgoingRequest(di.OPTIONS,s,this._ua,null,g),c&&(this._request.body=c);var A=new Ih(this._ua,this._request,{onRequestTimeout:function(){t._onRequestTimeout()},onTransportError:function(){t._onTransportError()},onReceiveResponse:function(C){t._receiveResponse(C)}});this._newOptions("local",this._request),A.send()}},{key:"init_incoming",value:function(s){this._request=s,this._newOptions("remote",s),this._is_replied||(this._is_replied=!0,s.reply(200)),this._close()}},{key:"accept",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=en.cloneArray(s.extraHeaders),t=s.body;if(this._direction!=="incoming")throw new fo.NotSupportedError('"accept" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");this._is_replied=!0,this._request.reply(200,null,c,t)}},{key:"reject",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s.status_code||480,t=s.reason_phrase,u=en.cloneArray(s.extraHeaders),p=s.body;if(this._direction!=="incoming")throw new fo.NotSupportedError('"reject" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");if(c<300||c>=700)throw new TypeError("Invalid status_code: ".concat(c));this._is_replied=!0,this._request.reply(c,t,u,p)}},{key:"_receiveResponse",value:function(s){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(s.status_code):break;case/^2[0-9]{2}$/.test(s.status_code):this._succeeded("remote",s);break;default:{var c=en.sipErrorCause(s.status_code);this._failed("remote",s,c);break}}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,di.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,di.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newOptions",value:function(s,c){s==="remote"?(this._direction="incoming",this._local_identity=c.to,this._remote_identity=c.from):s==="local"&&(this._direction="outgoing",this._local_identity=c.from,this._remote_identity=c.to),this._ua.newOptions(this,{originator:s,message:this,request:c})}},{key:"_failed",value:function(s,c,t){rr.debug("OPTIONS failed"),this._close(),rr.debug('emit "failed"'),this.emit("failed",{originator:s,response:c||null,cause:t})}},{key:"_succeeded",value:function(s,c){rr.debug("OPTIONS succeeded"),this._close(),rr.debug('emit "succeeded"'),this.emit("succeeded",{originator:s,response:c})}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}}]),i})(Ah)});var vi=B(_o=>{"use strict";var Oh=ce(),pi=de(),Nh=Oe(),tn=new Oh("Socket");_o.isSocket=function(a){if(Array.isArray(a))return!1;if(typeof a>"u")return tn.warn("undefined JsSIP.Socket instance"),!1;try{if(!pi.isString(a.url))throw tn.warn("missing or invalid JsSIP.Socket url property"),new Error("Missing or invalid JsSIP.Socket url property");if(!pi.isString(a.via_transport))throw tn.warn("missing or invalid JsSIP.Socket via_transport property"),new Error("Missing or invalid JsSIP.Socket via_transport property");if(Nh.parse(a.sip_uri,"SIP_URI")===-1)throw tn.warn("missing or invalid JsSIP.Socket sip_uri property"),new Error("missing or invalid JsSIP.Socket sip_uri property")}catch{return!1}try{["connect","disconnect","send"].forEach(function(o){if(!pi.isFunction(a[o]))throw tn.warn("missing or invalid JsSIP.Socket method: ".concat(o)),new Error("Missing or invalid JsSIP.Socket method: ".concat(o))})}catch{return!1}return!0}});var mo=B((s_,go)=>{"use strict";function kh(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function po(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Dh(a,o,i){return o&&po(a.prototype,o),i&&po(a,i),a}var xh=ce(),Ph=vi(),vo=ae(),ge=new xh("Transport"),Re={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:vo.CONNECTION_RECOVERY_MIN_INTERVAL,max_interval:vo.CONNECTION_RECOVERY_MAX_INTERVAL}};go.exports=(function(){function a(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Re.recovery_options;kh(this,a),ge.debug("new()"),this.status=Re.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=i,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1;try{this.textDecoder=new TextDecoder("utf8")}catch(n){ge.warn("cannot use TextDecoder: ".concat(n))}if(typeof o>"u")throw new TypeError("Invalid argument. undefined 'sockets' argument");o instanceof Array||(o=[o]),o.forEach(function(n){if(!Ph.isSocket(n.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(n.weight&&!Number(n.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:n.socket,weight:n.weight||0,status:Re.SOCKET_STATUS_READY})},this),this._getSocket()}return Dh(a,[{key:"connect",value:function(){if(ge.debug("connect()"),this.isConnected()){ge.debug("Transport is already connected");return}else if(this.isConnecting()){ge.debug("Transport is connecting");return}this.close_requested=!1,this.status=Re.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect())}},{key:"disconnect",value:function(){ge.debug("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=Re.STATUS_DISCONNECTED,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}},{key:"send",value:function(i){if(ge.debug("send()"),!this.isConnected())return ge.warn("unable to send message, transport is not connected"),!1;var n=i.toString();return ge.debug(`sending message:

`.concat(n,`
`)),this.socket.send(n)}},{key:"isConnected",value:function(){return this.status===Re.STATUS_CONNECTED}},{key:"isConnecting",value:function(){return this.status===Re.STATUS_CONNECTING}},{key:"_reconnect",value:function(){var i=this;this.recover_attempts+=1;var n=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1);n<this.recovery_options.min_interval?n=this.recovery_options.min_interval:n>this.recovery_options.max_interval&&(n=this.recovery_options.max_interval),ge.debug("reconnection attempt: ".concat(this.recover_attempts,". next connection attempt in ").concat(n," seconds")),this.recovery_timer=setTimeout(function(){!i.close_requested&&!(i.isConnected()||i.isConnecting())&&(i._getSocket(),i.connect())},n*1e3)}},{key:"_getSocket",value:function(){var i=[];if(this.sockets.forEach(function(s){s.status!==Re.SOCKET_STATUS_ERROR&&(i.length===0?i.push(s):s.weight>i[0].weight?i=[s]:s.weight===i[0].weight&&i.push(s))}),i.length===0){this.sockets.forEach(function(s){s.status=Re.SOCKET_STATUS_READY}),this._getSocket();return}var n=Math.floor(Math.random()*i.length);this.socket=i[n].socket}},{key:"_onConnect",value:function(){this.recover_attempts=0,this.status=Re.STATUS_CONNECTED,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}},{key:"_onDisconnect",value:function(i,n,s){this.status=Re.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:i,code:n,reason:s}),!this.close_requested&&(this.sockets.forEach(function(c){this.socket===c.socket&&(c.status=Re.SOCKET_STATUS_ERROR)},this),this._reconnect(i))}},{key:"_onData",value:function(i){if(i===`\r
\r
`){ge.debug("received message with double-CRLF Keep Alive request");try{this.socket.send(`\r
`)}catch(n){ge.warn("error sending Keep Alive response: ".concat(n))}return}if(i===`\r
`){ge.debug("received message with CRLF Keep Alive response");return}else if(typeof i!="string"){try{this.textDecoder?i=this.textDecoder.decode(i):i=String.fromCharCode.apply(null,new Uint8Array(i))}catch{ge.debug("received binary message failed to be converted into string, message discarded");return}ge.debug(`received binary message:

`.concat(i,`
`))}else ge.debug(`received text message:

`.concat(i,`
`));this.ondata({transport:this,message:i})}},{key:"via_transport",get:function(){return this.socket.via_transport}},{key:"url",get:function(){return this.socket.url}},{key:"sip_uri",get:function(){return this.socket.sip_uri}}]),a})()});var Co=B(So=>{"use strict";function yo(a,o){var i;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(i=Uh(a))||o&&a&&typeof a.length=="number"){i&&(a=i);var n=0,s=function(){};return{s,n:function(){return n>=a.length?{done:!0}:{done:!1,value:a[n++]}},e:function(g){throw g},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,t=!1,u;return{s:function(){i=a[Symbol.iterator]()},n:function(){var g=i.next();return c=g.done,g},e:function(g){t=!0,u=g},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(t)throw u}}}}function Uh(a,o){if(a){if(typeof a=="string")return To(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return To(a,o)}}function To(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,n=new Array(o);i<o;i++)n[i]=a[i];return n}var Mh=ce(),gi=Oe(),mi=Ue(),lr=new Mh("Parser");So.parseMessage=function(a,o){var i,n,s=a.indexOf(`\r
`);if(s===-1){lr.warn("parseMessage() | no CRLF found, not a SIP message");return}var c=a.substring(0,s),t=gi.parse(c,"Request_Response");if(t===-1){lr.warn('parseMessage() | error parsing first line of SIP message: "'.concat(c,'"'));return}else t.status_code?(i=new mi.IncomingResponse,i.status_code=t.status_code,i.reason_phrase=t.reason_phrase):(i=new mi.IncomingRequest(o),i.method=t.method,i.ruri=t.uri);i.data=a;for(var u=s+2;;){if(s=Fh(a,u),s===-2){n=u+2;break}else if(s===-1){lr.warn("parseMessage() | malformed message");return}if(t=Hh(i,a,u,s),t!==!0){lr.warn("parseMessage() |",t.error);return}u=s+2}if(i.hasHeader("content-length")){var p=i.getHeader("content-length");i.body=a.substr(n,p)}else i.body=a.substring(n);return i};function Fh(a,o){var i=o,n=0,s=0;if(a.substring(i,i+2).match(/(^\r\n)/))return-2;for(;n===0;){if(s=a.indexOf(`\r
`,i),s===-1)return s;!a.substring(s+2,s+4).match(/(^\r\n)/)&&a.charAt(s+2).match(/(^\s+)/)?i=s+2:n=s}return n}function Hh(a,o,i,n){var s,c=o.indexOf(":",i),t=o.substring(i,c).trim(),u=o.substring(c+1,n).trim();switch(t.toLowerCase()){case"via":case"v":a.addHeader("via",u),a.getHeaders("via").length===1?(s=a.parseHeader("Via"),s&&(a.via=s,a.via_branch=s.branch)):s=0;break;case"from":case"f":a.setHeader("from",u),s=a.parseHeader("from"),s&&(a.from=s,a.from_tag=s.getParam("tag"));break;case"to":case"t":a.setHeader("to",u),s=a.parseHeader("to"),s&&(a.to=s,a.to_tag=s.getParam("tag"));break;case"record-route":if(s=gi.parse(u,"Record_Route"),s===-1)s=void 0;else{var p=yo(s),g;try{for(p.s();!(g=p.n()).done;){var y=g.value;a.addHeader("record-route",u.substring(y.possition,y.offset)),a.headers["Record-Route"][a.getHeaders("record-route").length-1].parsed=y.parsed}}catch(m){p.e(m)}finally{p.f()}}break;case"call-id":case"i":a.setHeader("call-id",u),s=a.parseHeader("call-id"),s&&(a.call_id=u);break;case"contact":case"m":if(s=gi.parse(u,"Contact"),s===-1)s=void 0;else{var S=yo(s),h;try{for(S.s();!(h=S.n()).done;){var A=h.value;a.addHeader("contact",u.substring(A.possition,A.offset)),a.headers.Contact[a.getHeaders("contact").length-1].parsed=A.parsed}}catch(m){S.e(m)}finally{S.f()}}break;case"content-length":case"l":a.setHeader("content-length",u),s=a.parseHeader("content-length");break;case"content-type":case"c":a.setHeader("content-type",u),s=a.parseHeader("content-type");break;case"cseq":a.setHeader("cseq",u),s=a.parseHeader("cseq"),s&&(a.cseq=s.value),a instanceof mi.IncomingResponse&&(a.method=s.method);break;case"max-forwards":a.setHeader("max-forwards",u),s=a.parseHeader("max-forwards");break;case"www-authenticate":a.setHeader("www-authenticate",u),s=a.parseHeader("www-authenticate");break;case"proxy-authenticate":a.setHeader("proxy-authenticate",u),s=a.parseHeader("proxy-authenticate");break;case"session-expires":case"x":a.setHeader("session-expires",u),s=a.parseHeader("session-expires"),s&&(a.session_expires=s.expires,a.session_expires_refresher=s.refresher);break;case"refer-to":case"r":a.setHeader("refer-to",u),s=a.parseHeader("refer-to"),s&&(a.refer_to=s);break;case"replaces":a.setHeader("replaces",u),s=a.parseHeader("replaces"),s&&(a.replaces=s);break;case"event":case"o":a.setHeader("event",u),s=a.parseHeader("event"),s&&(a.event=s);break;default:a.addHeader(t,u),s=0}return s===void 0?{error:'error parsing header "'.concat(t,'"')}:!0}});var Io=B((a_,wo)=>{"use strict";function ar(a,o){var i;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(i=Lh(a))||o&&a&&typeof a.length=="number"){i&&(a=i);var n=0,s=function(){};return{s,n:function(){return n>=a.length?{done:!0}:{done:!1,value:a[n++]}},e:function(g){throw g},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,t=!1,u;return{s:function(){i=a[Symbol.iterator]()},n:function(){var g=i.next();return c=g.done,g},e:function(g){t=!0,u=g},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(t)throw u}}}}function Lh(a,o){if(a){if(typeof a=="string")return Eo(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Eo(a,o)}}function Eo(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,n=new Array(o);i<o;i++)n[i]=a[i];return n}var qh=ce(),Ao=ae(),bo=Ue(),yi=de(),Ti=new qh("sanityCheck"),jh=[Jh],Gh=[Bh,Vh,zh,Kh],Wh=[$h,Yh],ne,Fe,Ro;wo.exports=function(a,o,i){ne=a,Fe=o,Ro=i;var n=ar(jh),s;try{for(n.s();!(s=n.n()).done;){var c=s.value;if(c()===!1)return!1}}catch(h){n.e(h)}finally{n.f()}if(ne instanceof bo.IncomingRequest){var t=ar(Gh),u;try{for(t.s();!(u=t.n()).done;){var p=u.value;if(p()===!1)return!1}}catch(h){t.e(h)}finally{t.f()}}else if(ne instanceof bo.IncomingResponse){var g=ar(Wh),y;try{for(g.s();!(y=g.n()).done;){var S=y.value;if(S()===!1)return!1}}catch(h){g.e(h)}finally{g.f()}}return!0};function Bh(){if(ne.s("to").uri.scheme!=="sip")return nn(416),!1}function Vh(){if(!ne.to_tag&&ne.call_id.substr(0,5)===Fe.configuration.jssip_id)return nn(482),!1}function zh(){var a=yi.str_utf8_length(ne.body),o=ne.getHeader("content-length");if(a<o)return nn(400),!1}function Kh(){var a=ne.from_tag,o=ne.call_id,i=ne.cseq,n;if(!ne.to_tag)if(ne.method===Ao.INVITE){if(Fe._transactions.ist[ne.via_branch])return!1;for(var s in Fe._transactions.ist)if(Object.prototype.hasOwnProperty.call(Fe._transactions.ist,s)&&(n=Fe._transactions.ist[s],n.request.from_tag===a&&n.request.call_id===o&&n.request.cseq===i))return nn(482),!1}else{if(Fe._transactions.nist[ne.via_branch])return!1;for(var c in Fe._transactions.nist)if(Object.prototype.hasOwnProperty.call(Fe._transactions.nist,c)&&(n=Fe._transactions.nist[c],n.request.from_tag===a&&n.request.call_id===o&&n.request.cseq===i))return nn(482),!1}}function $h(){if(ne.getHeaders("via").length>1)return Ti.debug("more than one Via header field present in the response, dropping the response"),!1}function Yh(){var a=yi.str_utf8_length(ne.body),o=ne.getHeader("content-length");if(a<o)return Ti.debug("message body length is lower than the value in Content-Length header field, dropping the response"),!1}function Jh(){for(var a=["from","to","call_id","cseq","via"],o=0,i=a;o<i.length;o++){var n=i[o];if(!ne.hasHeader(n))return Ti.debug("missing mandatory header field : ".concat(n,", dropping the response")),!1}}function nn(a){var o=ne.getHeaders("via"),i,n="SIP/2.0 ".concat(a," ").concat(Ao.REASON_PHRASE[a],`\r
`),s=ar(o),c;try{for(s.s();!(c=s.n()).done;){var t=c.value;n+="Via: ".concat(t,`\r
`)}}catch(u){s.e(u)}finally{s.f()}i=ne.getHeader("To"),ne.to_tag||(i+=";tag=".concat(yi.newTag())),n+="To: ".concat(i,`\r
`),n+="From: ".concat(ne.getHeader("From"),`\r
`),n+="Call-ID: ".concat(ne.call_id,`\r
`),n+="CSeq: ".concat(ne.cseq," ").concat(ne.method,`\r
`),n+=`\r
`,Ro.send(n)}});var Do=B(bi=>{"use strict";function Oo(a,o){var i;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(i=Xh(a))||o&&a&&typeof a.length=="number"){i&&(a=i);var n=0,s=function(){};return{s,n:function(){return n>=a.length?{done:!0}:{done:!1,value:a[n++]}},e:function(g){throw g},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,t=!1,u;return{s:function(){i=a[Symbol.iterator]()},n:function(){var g=i.next();return c=g.done,g},e:function(g){t=!0,u=g},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(t)throw u}}}}function Xh(a,o){if(a){if(typeof a=="string")return No(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return No(a,o)}}function No(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,n=new Array(o);i<o;i++)n[i]=a[i];return n}var Et=de(),lt=ae(),Si=Oe(),ko=je(),Ci=vi(),Ei=qe();bi.settings={authorization_user:null,password:null,realm:null,ha1:null,authorization_jwt:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:lt.UPDATE,session_timers_force_refresher:!1,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:lt.CONNECTION_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:lt.CONNECTION_RECOVERY_MIN_INTERVAL,extra_headers:null,via_host:"".concat(Et.createRandomToken(12),".invalid")};var or={mandatory:{sockets:function(o){var i=[];if(Ci.isSocket(o))i.push({socket:o});else if(Array.isArray(o)&&o.length){var n=Oo(o),s;try{for(n.s();!(s=n.n()).done;){var c=s.value;Object.prototype.hasOwnProperty.call(c,"socket")&&Ci.isSocket(c.socket)?i.push(c):Ci.isSocket(c)&&i.push({socket:c})}}catch(t){n.e(t)}finally{n.f()}}else return;return i},uri:function(o){/^sip:/i.test(o)||(o="".concat(lt.SIP,":").concat(o));var i=ko.parse(o);if(i)return i.user?i:void 0}},optional:{authorization_user:function(o){if(Si.parse('"'.concat(o,'"'),"quoted_string")!==-1)return o},authorization_jwt:function(o){if(typeof o=="string")return o},user_agent:function(o){if(typeof o=="string")return o},connection_recovery_max_interval:function(o){if(Et.isDecimal(o)){var i=Number(o);if(i>0)return i}},connection_recovery_min_interval:function(o){if(Et.isDecimal(o)){var i=Number(o);if(i>0)return i}},contact_uri:function(o){if(typeof o=="string"){var i=Si.parse(o,"SIP_URI");if(i!==-1)return i}},display_name:function(o){return o},instance_id:function(o){if(/^uuid:/i.test(o)&&(o=o.substr(5)),Si.parse(o,"uuid")!==-1)return o},no_answer_timeout:function(o){if(Et.isDecimal(o)){var i=Number(o);if(i>0)return i}},session_timers:function(o){if(typeof o=="boolean")return o},session_timers_refresh_method:function(o){if(typeof o=="string"&&(o=o.toUpperCase(),o===lt.INVITE||o===lt.UPDATE))return o},session_timers_force_refresher:function(o){if(typeof o=="boolean")return o},password:function(o){return String(o)},realm:function(o){return String(o)},ha1:function(o){return String(o)},register:function(o){if(typeof o=="boolean")return o},register_expires:function(o){if(Et.isDecimal(o)){var i=Number(o);if(i>0)return i}},registrar_server:function(o){/^sip:/i.test(o)||(o="".concat(lt.SIP,":").concat(o));var i=ko.parse(o);if(i)return i.user?void 0:i},use_preloaded_route:function(o){if(typeof o=="boolean")return o},extra_headers:function(o){var i=[];if(Array.isArray(o)&&o.length){var n=Oo(o),s;try{for(n.s();!(s=n.n()).done;){var c=s.value;typeof c=="string"&&i.push(c)}}catch(t){n.e(t)}finally{n.f()}}else return;return i}}};bi.load=function(a,o){for(var i in or.mandatory)if(o.hasOwnProperty(i)){var n=o[i],s=or.mandatory[i](n);if(s!==void 0)a[i]=s;else throw new Ei.ConfigurationError(i,n)}else throw new Ei.ConfigurationError(i);for(var c in or.optional)if(o.hasOwnProperty(c)){var t=o[c];if(Et.isEmpty(t))continue;var u=or.optional[c](t);if(u!==void 0)a[c]=u;else throw new Ei.ConfigurationError(c,t)}}});var qo=B((u_,Lo)=>{"use strict";function fr(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?fr=function(i){return typeof i}:fr=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},fr(a)}function Qh(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function xo(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function Po(a,o,i){return o&&xo(a.prototype,o),i&&xo(a,i),a}function Zh(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),o&&Ii(a,o)}function Ii(a,o){return Ii=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},Ii(a,o)}function ed(a){var o=nd();return function(){var n=cr(a),s;if(o){var c=cr(this).constructor;s=Reflect.construct(n,arguments,c)}else s=n.apply(this,arguments);return td(this,s)}}function td(a,o){return o&&(fr(o)==="object"||typeof o=="function")?o:Ho(a)}function Ho(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function nd(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function cr(a){return cr=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},cr(a)}var rd=Ge().EventEmitter,id=ce(),pe=ae(),sd=Ra(),Uo=io(),Mo=oo(),Fo=ho(),Ai=St(),ld=mo(),ur=de(),ad=qe(),od=je(),ud=Co(),Ri=Ue(),fd=Io(),wi=Do(),re=new id("UA"),ve={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};Lo.exports=(function(a){Zh(i,a);var o=ed(i);Po(i,null,[{key:"C",get:function(){return ve}}]);function i(n){var s;if(Qh(this,i),re.debug("new() [configuration:%o]",n),s=o.call(this),s._cache={credentials:{}},s._configuration=Object.assign({},wi.settings),s._dynConfiguration={},s._dialogs={},s._applicants={},s._sessions={},s._transport=null,s._contact=null,s._status=ve.STATUS_INIT,s._error=null,s._transactions={nist:{},nict:{},ist:{},ict:{}},s._data={},s._closeTimer=null,n===void 0)throw new TypeError("Not enough arguments");try{s._loadConfig(n)}catch(c){throw s._status=ve.STATUS_NOT_READY,s._error=ve.CONFIGURATION_ERROR,c}return s._registrator=new sd(Ho(s)),s}return Po(i,[{key:"start",value:function(){re.debug("start()"),this._status===ve.STATUS_INIT?this._transport.connect():this._status===ve.STATUS_USER_CLOSED?(re.debug("restarting UA"),this._closeTimer!==null&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=ve.STATUS_INIT,this._transport.connect()):this._status===ve.STATUS_READY?re.debug("UA is in READY status, not restarted"):re.debug("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}},{key:"register",value:function(){re.debug("register()"),this._dynConfiguration.register=!0,this._registrator.register()}},{key:"unregister",value:function(s){re.debug("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(s)}},{key:"registrator",value:function(){return this._registrator}},{key:"isRegistered",value:function(){return this._registrator.registered}},{key:"isConnected",value:function(){return this._transport.isConnected()}},{key:"call",value:function(s,c){re.debug("call()");var t=new Uo(this);return t.connect(s,c),t}},{key:"sendMessage",value:function(s,c,t){re.debug("sendMessage()");var u=new Mo(this);return u.send(s,c,t),u}},{key:"sendOptions",value:function(s,c,t){re.debug("sendOptions()");var u=new Fo(this);return u.send(s,c,t),u}},{key:"terminateSessions",value:function(s){re.debug("terminateSessions()");for(var c in this._sessions)this._sessions[c].isEnded()||this._sessions[c].terminate(s)}},{key:"stop",value:function(){var s=this;if(re.debug("stop()"),this._dynConfiguration={},this._status===ve.STATUS_USER_CLOSED){re.debug("UA already closed");return}this._registrator.close();var c=Object.keys(this._sessions).length;for(var t in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,t)){re.debug("closing session ".concat(t));try{this._sessions[t].terminate()}catch{}}for(var u in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,u))try{this._applicants[u].close()}catch{}this._status=ve.STATUS_USER_CLOSED;var p=Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length;p===0&&c===0?this._transport.disconnect():this._closeTimer=setTimeout(function(){s._closeTimer=null,s._transport.disconnect()},2e3)}},{key:"normalizeTarget",value:function(s){return ur.normalizeTarget(s,this._configuration.hostport_params)}},{key:"get",value:function(s){switch(s){case"authorization_user":return this._configuration.authorization_user;case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;case"authorization_jwt":return this._configuration.authorization_jwt;default:re.warn('get() | cannot get "%s" parameter in runtime',s);return}}},{key:"set",value:function(s,c){switch(s){case"authorization_user":{this._configuration.authorization_user=String(c);break}case"password":{this._configuration.password=String(c);break}case"realm":{this._configuration.realm=String(c);break}case"ha1":{this._configuration.ha1=String(c),this._configuration.password=null;break}case"authorization_jwt":{this._configuration.authorization_jwt=String(c);break}case"display_name":{this._configuration.display_name=c;break}case"extra_headers":{this._configuration.extra_headers=c;break}default:return re.warn('set() | cannot set "%s" parameter in runtime',s),!1}return!0}},{key:"newTransaction",value:function(s){this._transactions[s.type][s.id]=s,this.emit("newTransaction",{transaction:s})}},{key:"destroyTransaction",value:function(s){delete this._transactions[s.type][s.id],this.emit("transactionDestroyed",{transaction:s})}},{key:"newDialog",value:function(s){this._dialogs[s.id]=s}},{key:"destroyDialog",value:function(s){delete this._dialogs[s.id]}},{key:"newMessage",value:function(s,c){this._applicants[s]=s,this.emit("newMessage",c)}},{key:"newOptions",value:function(s,c){this._applicants[s]=s,this.emit("newOptions",c)}},{key:"destroyMessage",value:function(s){delete this._applicants[s]}},{key:"newRTCSession",value:function(s,c){this._sessions[s.id]=s,this.emit("newRTCSession",c)}},{key:"destroyRTCSession",value:function(s){delete this._sessions[s.id]}},{key:"registered",value:function(s){this.emit("registered",s)}},{key:"unregistered",value:function(s){this.emit("unregistered",s)}},{key:"registrationFailed",value:function(s){this.emit("registrationFailed",s)}},{key:"receiveRequest",value:function(s){var c=s.method;if(s.ruri.user!==this._configuration.uri.user&&s.ruri.user!==this._contact.uri.user){re.debug("Request-URI does not point to us"),s.method!==pe.ACK&&s.reply_sl(404);return}if(s.ruri.scheme===pe.SIPS){s.reply_sl(416);return}if(!Ai.checkTransaction(this,s)){if(c===pe.INVITE?new Ai.InviteServerTransaction(this,this._transport,s):c!==pe.ACK&&c!==pe.CANCEL&&new Ai.NonInviteServerTransaction(this,this._transport,s),c===pe.OPTIONS){if(this.listeners("newOptions").length===0){s.reply(200);return}var t=new Fo(this);t.init_incoming(s)}else if(c===pe.MESSAGE){if(this.listeners("newMessage").length===0){s.reply(405);return}var u=new Mo(this);u.init_incoming(s)}else if(c===pe.INVITE&&!s.to_tag&&this.listeners("newRTCSession").length===0){s.reply(405);return}var p,g;if(s.to_tag)p=this._findDialog(s.call_id,s.from_tag,s.to_tag),p?p.receiveRequest(s):c===pe.NOTIFY?(g=this._findSession(s),g?g.receiveRequest(s):(re.debug("received NOTIFY request for a non existent subscription"),s.reply(481,"Subscription does not exist"))):c!==pe.ACK&&s.reply(481);else switch(c){case pe.INVITE:if(window.RTCPeerConnection)if(s.hasHeader("replaces")){var y=s.replaces;p=this._findDialog(y.call_id,y.from_tag,y.to_tag),p?(g=p.owner,g.isEnded()?s.reply(603):g.receiveRequest(s)):s.reply(481)}else g=new Uo(this),g.init_incoming(s);else re.warn("INVITE received but WebRTC is not supported"),s.reply(488);break;case pe.BYE:s.reply(481);break;case pe.CANCEL:g=this._findSession(s),g?g.receiveRequest(s):re.debug("received CANCEL request for a non existent session");break;case pe.ACK:break;case pe.NOTIFY:this.emit("sipEvent",{event:s.event,request:s}),s.reply(200);break;default:s.reply(405);break}}}},{key:"_findSession",value:function(s){var c=s.call_id,t=s.from_tag,u=s.to_tag,p=c+t,g=this._sessions[p],y=c+u,S=this._sessions[y];return g||S||null}},{key:"_findDialog",value:function(s,c,t){var u=s+c+t,p=this._dialogs[u];return p||(u=s+t+c,p=this._dialogs[u],p||null)}},{key:"_loadConfig",value:function(s){try{wi.load(this._configuration,s)}catch(y){throw y}this._configuration.display_name===0&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=ur.newUUID()),this._configuration.jssip_id=ur.createRandomToken(5);var c=this._configuration.uri.clone();c.user=null,this._configuration.hostport_params=c.toString().replace(/^sip:/i,"");try{this._transport=new ld(this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=cd.bind(this),this._transport.onconnect=hd.bind(this),this._transport.ondisconnect=dd.bind(this),this._transport.ondata=_d.bind(this)}catch(y){throw re.warn(y),new ad.ConfigurationError("sockets",this._configuration.sockets)}if(delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),!this._configuration.registrar_server){var t=this._configuration.uri.clone();t.user=null,t.clearParams(),t.clearHeaders(),this._configuration.registrar_server=t}this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new od("sip",ur.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString:function(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=S.anonymous||null,A=S.outbound||null,m="<";return h?m+=this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":m+=this.pub_gruu||this.uri.toString(),A&&(h?!this.temp_gruu:!this.pub_gruu)&&(m+=";ob"),m+=">",m}};var u=["authorization_user","password","realm","ha1","authorization_jwt","display_name","register","extra_headers"];for(var p in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,p)&&(u.indexOf(p)!==-1?Object.defineProperty(this._configuration,p,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,p,{writable:!1,configurable:!1}));re.debug("configuration parameters after validation:");for(var g in this._configuration)if(Object.prototype.hasOwnProperty.call(wi.settings,g))switch(g){case"uri":case"registrar_server":re.debug("- ".concat(g,": ").concat(this._configuration[g]));break;case"password":case"ha1":case"authorization_jwt":re.debug("- ".concat(g,": NOT SHOWN"));break;default:re.debug("- ".concat(g,": ").concat(JSON.stringify(this._configuration[g])))}}},{key:"C",get:function(){return ve}},{key:"status",get:function(){return this._status}},{key:"contact",get:function(){return this._contact}},{key:"configuration",get:function(){return this._configuration}},{key:"transport",get:function(){return this._transport}}]),i})(rd);function cd(a){this.emit("connecting",a)}function hd(a){this._status!==ve.STATUS_USER_CLOSED&&(this._status=ve.STATUS_READY,this._error=null,this.emit("connected",a),this._dynConfiguration.register&&this._registrator.register())}function dd(a){for(var o=["nict","ict","nist","ist"],i=0,n=o;i<n.length;i++){var s=n[i];for(var c in this._transactions[s])Object.prototype.hasOwnProperty.call(this._transactions[s],c)&&this._transactions[s][c].onTransportError()}this.emit("disconnected",a),this._registrator.onTransportClosed(),this._status!==ve.STATUS_USER_CLOSED&&(this._status=ve.STATUS_NOT_READY,this._error=ve.NETWORK_ERROR)}function _d(a){var o=a.transport,i=a.message;if(i=ud.parseMessage(i,this),!!i&&!(this._status===ve.STATUS_USER_CLOSED&&i instanceof Ri.IncomingRequest)&&fd(i,this,o)){if(i instanceof Ri.IncomingRequest)i.transport=o,this.receiveRequest(i);else if(i instanceof Ri.IncomingResponse){var n;switch(i.method){case pe.INVITE:n=this._transactions.ict[i.via_branch],n&&n.receiveResponse(i);break;case pe.ACK:break;default:n=this._transactions.nict[i.via_branch],n&&n.receiveResponse(i);break}}}}});var Wo=B((f_,Go)=>{"use strict";function pd(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function jo(a,o){for(var i=0;i<o.length;i++){var n=o[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function vd(a,o,i){return o&&jo(a.prototype,o),i&&jo(a,i),a}var gd=ce(),md=Oe(),ye=new gd("WebSocketInterface");Go.exports=(function(){function a(o){pd(this,a),ye.debug('new() [url:"%s"]',o),this._url=o,this._sip_uri=null,this._via_transport=null,this._ws=null;var i=md.parse(o,"absoluteURI");if(i===-1)throw ye.warn("invalid WebSocket URI: ".concat(o)),new TypeError("Invalid argument: ".concat(o));if(i.scheme!=="wss"&&i.scheme!=="ws")throw ye.warn("invalid WebSocket URI scheme: ".concat(i.scheme)),new TypeError("Invalid argument: ".concat(o));this._sip_uri="sip:".concat(i.host).concat(i.port?":".concat(i.port):"",";transport=ws"),this._via_transport=i.scheme.toUpperCase()}return vd(a,[{key:"connect",value:function(){if(ye.debug("connect()"),this.isConnected()){ye.debug("WebSocket ".concat(this._url," is already connected"));return}else if(this.isConnecting()){ye.debug("WebSocket ".concat(this._url," is connecting"));return}this._ws&&this.disconnect(),ye.debug("connecting to WebSocket ".concat(this._url));try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(i){this._onError(i)}}},{key:"disconnect",value:function(){ye.debug("disconnect()"),this._ws&&(this._ws.onopen=function(){},this._ws.onclose=function(){},this._ws.onmessage=function(){},this._ws.onerror=function(){},this._ws.close(),this._ws=null)}},{key:"send",value:function(i){return ye.debug("send()"),this.isConnected()?(this._ws.send(i),!0):(ye.warn("unable to send message, WebSocket is not open"),!1)}},{key:"isConnected",value:function(){return this._ws&&this._ws.readyState===this._ws.OPEN}},{key:"isConnecting",value:function(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}},{key:"_onOpen",value:function(){ye.debug("WebSocket ".concat(this._url," connected")),this.onconnect()}},{key:"_onClose",value:function(i){var n=i.wasClean,s=i.code,c=i.reason;ye.debug("WebSocket ".concat(this._url," closed")),n===!1&&ye.debug("WebSocket abrupt disconnection"),this.ondisconnect(!n,s,c)}},{key:"_onMessage",value:function(i){var n=i.data;ye.debug("received WebSocket message"),this.ondata(n)}},{key:"_onError",value:function(i){ye.warn("WebSocket ".concat(this._url," error: "),i)}},{key:"via_transport",get:function(){return this._via_transport},set:function(i){this._via_transport=i.toUpperCase()}},{key:"sip_uri",get:function(){return this._sip_uri}},{key:"url",get:function(){return this._url}}]),a})()});var Vo=B((c_,Bo)=>{"use strict";var Oi=jr(),yd=ae(),Td=qe(),Sd=de(),Cd=qo(),Ed=je(),bd=wn(),Ad=Oe(),Rd=Wo(),wd=xn()("JsSIP");wd("version %s",Oi.version);Bo.exports={C:yd,Exceptions:Td,Utils:Sd,UA:Cd,URI:Ed,NameAddrHeader:bd,WebSocketInterface:Rd,Grammar:Ad,debug:xn(),get name(){return Oi.title},get version(){return Oi.version}}});var hr=Nu(Vo());var be=(function(a){return a.IDLE="IDLE",a.CONNECTING="CONNECTING",a.RINGING="RINGING",a.ACTIVE="ACTIVE",a.HELD="HELD",a.ENDED="ENDED",a})(be||{}),p_=(()=>{let o=class o{constructor(){this.ua=null,this.currentSession=null,this.currentCallState=be.IDLE,this.remoteAudio=null,this.ringtoneAudio=null,this.localStream=null,this.autoAnswerEnabled=!1,this.onCallStatus=new Mt,this.onError=new Mt,this.onRegistered=new Mt,this.onIncomingCall=new Mt,hr.default.debug.enable("JsSIP:*"),this.remoteAudio=new Audio,this.remoteAudio.autoplay=!0,this.ringtoneAudio=new Audio("assets/sounds/ringtone.mp3"),this.ringtoneAudio.loop=!0}enableAutoAnswer(){this.autoAnswerEnabled=!0,console.log("\u{1F916} Auto-answer enabled for admin supervision")}disableAutoAnswer(){this.autoAnswerEnabled=!1,console.log("\u{1F916} Auto-answer disabled")}register(n,s,c,t){return ct(this,null,function*(){return new Promise((u,p)=>ct(this,null,function*(){try{console.log("\u{1F50C} Registering to FreeSWITCH:",{extension:n,wsServer:c,domain:t});let S=`${typeof window<"u"&&window.location.protocol==="https:"?"wss":"ws"}://${c}`,h=!1,A=null;console.log("Connecting to FreeSWITCH at:",S);let m=new hr.default.WebSocketInterface(S);m.onconnect=()=>{console.log("\u{1F517} WebSocket onconnect event fired")},m.ondisconnect=(x,L,K)=>{if(console.error("\u{1F50C} WebSocket ondisconnect event fired:",{error:x,code:L,reason:K}),!h){h=!0,A&&clearTimeout(A);let Q=`WebSocket connection failed: ${K||x||"Connection refused"}`;this.onError.emit(Q),this.onRegistered.emit(!1),p(new Error(Q))}};let C={sockets:[m],uri:`sip:${n}@${t}`,password:s,display_name:n,register:!0,session_timers:!1};this.ua=new hr.default.UA(C),A=setTimeout(()=>{if(!h){h=!0;let x="Registration timeout - FreeSWITCH did not respond within 30 seconds";console.error("\u274C",x),this.onError.emit(x),this.onRegistered.emit(!1),this.ua&&(this.ua.stop(),this.ua=null),p(new Error(x))}},3e4),this.ua.on("connected",()=>{console.log("\u2705 WebSocket connected to FreeSWITCH")}),this.ua.on("disconnected",()=>{if(console.log("\u274C WebSocket disconnected from FreeSWITCH"),this.onRegistered.emit(!1),!h){h=!0,A&&clearTimeout(A);let x="WebSocket disconnected before registration completed";this.onError.emit(x),p(new Error(x))}}),this.ua.on("registered",()=>{console.log("\u2705 Successfully registered to FreeSWITCH"),this.onRegistered.emit(!0),h||(h=!0,A&&clearTimeout(A),u())}),this.ua.on("unregistered",()=>{console.log("\u274C Unregistered from FreeSWITCH"),this.onRegistered.emit(!1)}),this.ua.on("registrationFailed",x=>{console.error("\u274C SIP registration failed:",x);let L=`Registration failed: ${x.cause||"Unknown error"}`;this.onError.emit(L),this.onRegistered.emit(!1),h||(h=!0,A&&clearTimeout(A),p(new Error(L)))}),this.ua.on("newRTCSession",x=>{let L=x.session;if(L.direction==="incoming")if(console.log("\u{1F4F2} Incoming call from:",L.remote_identity.uri.user),this.currentSession=L,this.autoAnswerEnabled)console.log("\u{1F916} Auto-answering call (admin supervision mode)"),this.currentCallState=be.CONNECTING,this.onCallStatus.emit(this.currentCallState),this.setupSessionHandlers(L),setTimeout(()=>{this.answer()},100);else{this.ringtoneAudio?.play().catch(Q=>{console.warn("\u26A0\uFE0F Could not play ringtone:",Q)}),this.currentCallState=be.RINGING,this.onCallStatus.emit(this.currentCallState);let K=L.remote_identity.uri.user||"Unknown";this.onIncomingCall.emit({from:K}),this.setupSessionHandlers(L)}}),this.ua.start();try{this.localStream=yield navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1}),console.log("\u{1F3A4} Microphone access granted")}catch(x){console.warn("\u26A0\uFE0F Microphone access denied (will retry when making a call):",x)}}catch(g){console.error("\u274C Failed to initialize SIP client:",g);let y=g.message||"Failed to initialize SIP client";this.onError.emit(y),this.onRegistered.emit(!1),p(g)}}))})}call(n){return ct(this,null,function*(){if(!this.ua||!this.ua.isRegistered())throw new Error("Not registered to FreeSWITCH");if(!this.localStream)throw new Error("Microphone not available");try{console.log("\u{1F4DE} Making call to:",n),this.currentCallState=be.CONNECTING,this.onCallStatus.emit(this.currentCallState);let s={mediaConstraints:{audio:!0,video:!1},mediaStream:this.localStream,pcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"}],iceTransportPolicy:"all",rtcpMuxPolicy:"require",iceCandidatePoolSize:0},rtcOfferConstraints:{offerToReceiveAudio:!0,offerToReceiveVideo:!1}},c=this.ua.call(`sip:${n}@${this.ua._configuration.uri.host}`,s);this.currentSession=c,this.setupSessionHandlers(c),this.setupICEGatheringMonitor(c,"outgoing"),this.setupSDPOptimization(c)}catch(s){throw console.error("\u274C Failed to make call:",s),this.currentCallState=be.IDLE,this.onCallStatus.emit(this.currentCallState),this.onError.emit(s.message||"Failed to make call"),s}})}answer(){return ct(this,null,function*(){if(!this.currentSession)throw new Error("No incoming call to answer");if(!this.localStream)throw new Error("Microphone not available");try{console.log("\u{1F4F2} Answering call");let n={mediaConstraints:{audio:!0,video:!1},mediaStream:this.localStream,pcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"}],iceTransportPolicy:"all",rtcpMuxPolicy:"require",iceCandidatePoolSize:0},rtcAnswerConstraints:{offerToReceiveAudio:!0,offerToReceiveVideo:!1}};this.setupICEGatheringMonitor(this.currentSession,"incoming"),this.setupSDPOptimization(this.currentSession),this.currentSession.answer(n)}catch(n){throw console.error("\u274C Failed to answer call:",n),this.onError.emit(n.message||"Failed to answer call"),n}})}hangup(){if(this.currentSession)try{console.log("\u{1F4F4} Hanging up call"),this.currentSession.terminate()}catch(n){console.error("\u274C Failed to hangup:",n)}}mute(){this.currentSession&&(this.currentSession.mute({audio:!0}),console.log("\u{1F507} Muted"))}unmute(){this.currentSession&&(this.currentSession.unmute({audio:!0}),console.log("\u{1F50A} Unmuted"))}isMuted(){return this.currentSession?.isMuted().audio||!1}setupSDPOptimization(n){n.on("sdp",s=>{if(s.originator==="local"){let c=s.sdp,t=c.length;console.log("\u{1F527} Filtering LOCAL SDP - removing problematic candidates"),c=c.replace(/a=candidate:.*:[a-f0-9]+:[a-f0-9]+:.*/gi,""),c=c.replace(/a=candidate:.*\btcp\b.*/gi,""),c=c.replace(/a=candidate:.*\b172\.\d+\.\d+\.\d+\b.*/gi,""),c=c.replace(/a=candidate:.*\b169\.254\.\d+\.\d+\b.*/gi,""),c=c.replace(/^\s*[\r\n]/gm,"");let u=t-c.length;u>0&&console.log(`\u2705 Local SDP cleaned: removed ${u} bytes`),s.sdp=c}else console.log("\u2705 Keeping remote SDP from FreeSWITCH unchanged")})}setupICEGatheringMonitor(n,s){console.log(`\u23F1\uFE0F Starting ICE gathering monitor for ${s} call`);let c,t=null,u=0,p=!1,g=!1,y=S=>{c=Date.now(),console.log("\u{1F50D} ICE Gathering State:",S.iceGatheringState);let h=S.onicecandidate;console.log("\u{1F527} Installing aggressive ICE candidate filter"),S.onicecandidate=C=>{if(C.candidate){let x=C.candidate,L=x.candidate;if(L.includes(":")&&!L.includes("::ffff:")){console.log("\u{1F6AB} Blocked IPv6 candidate from being added");return}if(x.protocol==="tcp"||L.toLowerCase().includes(" tcp ")){console.log("\u{1F6AB} Blocked TCP candidate from being added");return}if(L.includes("172.28.")||L.includes("172.16.")||L.includes("169.254.")||L.includes("172.17.")){console.log("\u{1F6AB} Blocked virtual/APIPA candidate from being added");return}console.log("\u2705 Allowing candidate:",x.type,x.protocol,x.address)}h&&h.call(S,C)},console.log("\u{1F527} [AUDIO] Setting up remote audio track handlers"),S.addEventListener("track",C=>{console.log("\u{1F3B5} Received remote audio track:",{trackId:C.track.id,trackKind:C.track.kind,trackEnabled:C.track.enabled,streamCount:C.streams.length}),this.remoteAudio&&C.streams[0]&&(this.remoteAudio.srcObject=C.streams[0],this.remoteAudio.play().then(()=>console.log("\u2705 Playing remote audio")).catch(x=>console.error("\u274C Error playing audio:",x)))});let A=0,m=setInterval(()=>{A++;let C=S.getReceivers();if(C.length>0&&C[0].track&&this.remoteAudio&&!this.remoteAudio.srcObject){console.log(`\u{1F3B5} Found remote track on check #${A}`);let L=new MediaStream(C.map(K=>K.track).filter(K=>K!==null));L.getTracks().length>0&&(this.remoteAudio.srcObject=L,this.remoteAudio.play().then(()=>console.log("\u2705 Playing remote audio from monitoring")).catch(K=>console.error("\u274C Error playing audio:",K)),clearInterval(m))}A>=30&&(clearInterval(m),this.remoteAudio?.srcObject||console.warn("\u26A0\uFE0F No remote audio track found after 3 seconds"))},100);S.addEventListener("icegatheringstatechange",()=>{let C=Date.now()-c;console.log(`\u{1F504} ICE Gathering State changed to: ${S.iceGatheringState} (${C}ms elapsed)`),S.iceGatheringState==="complete"&&(console.log(`\u2705 ICE gathering completed in ${C}ms with ${u} candidates`),t&&clearTimeout(t))}),S.addEventListener("icecandidate",C=>{if(C.candidate){u++;let x=C.candidate,L=Date.now()-c;x.type==="srflx"&&(p=!0,console.log(`\u2705 Got STUN candidate (srflx) in ${L}ms - we have public IP!`),setTimeout(()=>{if(S.iceGatheringState!=="complete"){console.log("\u{1F527} FORCE COMPLETING ICE gathering - dispatching null candidate manually"),S.setConfiguration({iceServers:[]});let K=new RTCPeerConnectionIceEvent("icecandidate",{candidate:null});S.dispatchEvent(K),h&&h.call(S,K)}},250)),x.type==="host"&&x.protocol==="udp"&&!x.address?.includes(":")&&(g=!0),console.log(`\u{1F9CA} ICE Candidate #${u} (${L}ms):`,{type:x.type,protocol:x.protocol,address:x.address||"N/A",port:x.port}),x.protocol==="tcp"&&console.warn("\u26A0\uFE0F TCP candidate detected (slower than UDP)"),x.address?.includes(":")&&console.warn("\u26A0\uFE0F IPv6 candidate detected (may cause delays)"),(x.address?.startsWith("172.")||x.address?.startsWith("169.254."))&&console.warn("\u26A0\uFE0F Virtual/APIPA interface candidate detected"),p&&L>500&&console.log("\u2705 Have srflx candidate, ready to proceed if gathering completes")}else{let x=Date.now()-c;console.log(`\u{1F3C1} ICE gathering signaled completion in ${x}ms`),t&&clearTimeout(t)}}),t=setTimeout(()=>{let C=Date.now()-c;S.iceGatheringState!=="complete"&&(console.error(`\u{1F6A8} ICE gathering STILL not complete after ${C}ms (state: ${S.iceGatheringState})`),console.error("\u{1F6A8} This is causing the call to fail - gathering should complete in < 2 seconds"),console.warn(`\u{1F4CA} Status: ${u} candidates, srflx=${p}, host=${g}`),!p&&!g?console.error("\u274C CRITICAL: No usable candidates found - network issue?"):console.warn("\u26A0\uFE0F Have usable candidates but gathering won't complete - likely IPv6/TCP timeout"))},5e3)};n.connection?(console.log("\u{1F527} [FIX] PeerConnection already exists (outgoing call), setting up directly"),y(n.connection)):(console.log("\u{1F527} [FIX] PeerConnection not yet created (incoming call), waiting for event"),n.once("peerconnection",S=>{y(S.peerconnection)}))}setupSessionHandlers(n){n.on("progress",()=>{console.log("\u{1F4DE} Call progress (ringing)"),this.currentCallState=be.RINGING,this.onCallStatus.emit(this.currentCallState)}),n.on("accepted",()=>{console.log("\u2705 Call accepted"),this.stopRingtone(),this.currentCallState=be.ACTIVE,this.onCallStatus.emit(this.currentCallState)}),n.on("confirmed",()=>{console.log("\u2705 Call confirmed (ACK received)"),this.currentCallState=be.ACTIVE,this.onCallStatus.emit(this.currentCallState)}),n.on("ended",()=>{console.log("\u{1F4F4} Call ended"),this.stopRingtone(),this.currentCallState=be.ENDED,this.onCallStatus.emit(this.currentCallState),this.currentSession=null,setTimeout(()=>{this.currentCallState=be.IDLE,this.onCallStatus.emit(this.currentCallState)},1e3)}),n.on("failed",s=>{console.error("\u274C Call failed:",s),this.stopRingtone(),this.currentCallState=be.ENDED,this.onCallStatus.emit(this.currentCallState),this.currentSession=null,this.onError.emit(`Call failed: ${s.cause}`),setTimeout(()=>{this.currentCallState=be.IDLE,this.onCallStatus.emit(this.currentCallState)},1e3)})}stopRingtone(){this.ringtoneAudio&&(this.ringtoneAudio.pause(),this.ringtoneAudio.currentTime=0)}unregister(){return ct(this,null,function*(){if(this.ua)try{console.log("\u{1F44B} Unregistering from FreeSWITCH"),this.stopRingtone(),this.currentSession&&this.currentSession.terminate(),this.ua.unregister(),this.ua.stop(),this.ua=null,this.currentSession=null,this.localStream&&(this.localStream.getTracks().forEach(n=>n.stop()),this.localStream=null)}catch(n){console.error("\u274C Failed to unregister:",n)}})}getCallState(){return this.currentCallState}isRegistered(){return this.ua?.isRegistered()||!1}};o.\u0275fac=function(s){return new(s||o)},o.\u0275prov=ml({token:o,factory:o.\u0275fac,providedIn:"root"});let a=o;return a})();export{be as a,p_ as b};
