import{a as Q}from"./chunk-VPGLT2QO.js";import{a as H,b as B}from"./chunk-JMTLUOEW.js";import"./chunk-DAJRNOBM.js";import{a as P,b as V,c as j,d as $,e as O,f as F,g as L,h as Y,i as q,j as J,k as K}from"./chunk-RY24GANX.js";import"./chunk-O3OHGESO.js";import"./chunk-SVPL2WML.js";import"./chunk-C4CJRQQ2.js";import{a as X}from"./chunk-IJZG6WC3.js";import{a as z,c as R,e as D}from"./chunk-IGD5VCKG.js";import{a as G}from"./chunk-PUQ5RSXD.js";import{B as N,C as W}from"./chunk-JRQDYGIX.js";import"./chunk-3HY3XBSW.js";import{a as T}from"./chunk-KNHDRGXI.js";import{c as A}from"./chunk-T2ZQ5EGI.js";import"./chunk-NTU7HPDP.js";import{Zb as U,_b as I}from"./chunk-NUMEWRMA.js";import"./chunk-YQKVMPSG.js";import{Lb as m,Mb as n,Nb as r,Ob as s,Sb as g,Tb as u,Vb as _,Xb as S,Zb as b,ab as l,ed as E,gb as h,kc as M,lc as d,mc as f,md as w,na as v,nb as k,nc as y,oa as C,sb as p}from"./chunk-SN4XSKG7.js";function Z(t,a){t&1&&(n(0,"div",10),s(1,"div",11),n(2,"p"),d(3,"Cargando llamadas activas..."),r()())}function tt(t,a){t&1&&(n(0,"div",12),s(1,"lucide-angular",13),n(2,"p"),d(3,"No hay llamadas activas en este momento"),r()()),t&2&&(l(),m("size",48))}function et(t,a){t&1&&(n(0,"th",26),d(1,"Agente"),r())}function it(t,a){if(t&1&&(n(0,"td",27)(1,"div",28),s(2,"lucide-angular",29),n(3,"div")(4,"div",30),d(5),r(),n(6,"div",31),d(7),r()()()()),t&2){let c=a.$implicit;l(2),m("size",20),l(3),f(c.agentName),l(2),y("Ext: ",c.agentExtension)}}function nt(t,a){t&1&&(n(0,"th",26),d(1,"Cliente"),r())}function at(t,a){if(t&1&&(n(0,"td",27)(1,"div",32),s(2,"lucide-angular",33),n(3,"span"),d(4),r()()()),t&2){let c=a.$implicit;l(2),m("size",20),l(2),f(c.clientNumber)}}function ot(t,a){t&1&&(n(0,"th",26),d(1,"Duraci\xF3n"),r())}function rt(t,a){if(t&1&&(n(0,"td",27)(1,"div",34),s(2,"lucide-angular",35),n(3,"span"),d(4),r()()()),t&2){let c=a.$implicit,e=b(2);l(2),m("size",20),l(2),f(e.formatDuration(c.duration))}}function lt(t,a){t&1&&(n(0,"th",26),d(1,"Estado"),r())}function dt(t,a){if(t&1&&(n(0,"td",27)(1,"div",36),s(2,"lucide-angular",37),n(3,"span"),d(4),r()()()),t&2){let c=a.$implicit;l(),M("state-"+c.callState.toLowerCase()),l(),m("size",20),l(2),f(c.callState)}}function mt(t,a){t&1&&(n(0,"th",26),d(1,"Campa\xF1a"),r())}function ct(t,a){if(t&1&&(n(0,"td",27)(1,"span",38),d(2),r()()),t&2){let c=a.$implicit;l(2),f(c.campaignName||"-")}}function st(t,a){t&1&&(n(0,"th",26),d(1,"Acciones"),r())}function pt(t,a){if(t&1){let c=_();n(0,"td",27)(1,"button",39),S("click",function(){let i=v(c).$implicit,o=b(2);return C(o.superviseCall(i))}),s(2,"lucide-angular",40),d(3," Supervisar "),r()()}t&2&&(l(2),m("size",20))}function gt(t,a){t&1&&s(0,"tr",41)}function ut(t,a){t&1&&s(0,"tr",42)}function ft(t,a){if(t&1&&(n(0,"div",14)(1,"table",15),g(2,16),p(3,et,2,0,"th",17)(4,it,8,3,"td",18),u(),g(5,19),p(6,nt,2,0,"th",17)(7,at,5,2,"td",18),u(),g(8,20),p(9,ot,2,0,"th",17)(10,rt,5,2,"td",18),u(),g(11,21),p(12,lt,2,0,"th",17)(13,dt,5,4,"td",18),u(),g(14,22),p(15,mt,2,0,"th",17)(16,ct,3,1,"td",18),u(),g(17,23),p(18,st,2,0,"th",17)(19,pt,4,1,"td",18),u(),p(20,gt,1,0,"tr",24)(21,ut,1,0,"tr",25),r()()),t&2){let c=b();l(),m("dataSource",c.activeCalls),l(19),m("matHeaderRowDef",c.displayedColumns),l(),m("matRowDefColumns",c.displayedColumns)}}function ht(t,a){t&1&&(n(0,"div",43)(1,"h4"),d(2,"Modos de Monitoreo:"),r(),n(3,"div",44)(4,"div",45),s(5,"lucide-angular",46),n(6,"span")(7,"strong"),d(8,"VIG\xCDA:"),r(),d(9," Escuchas la llamada, pero nadie te escucha"),r()(),n(10,"div",45),s(11,"lucide-angular",47),n(12,"span")(13,"strong"),d(14,"SUSURRO:"),r(),d(15," Solo el agente puede escucharte, el cliente no"),r()(),n(16,"div",45),s(17,"lucide-angular",48),n(18,"span")(19,"strong"),d(20,"TRIPARTITA:"),r(),d(21," Todos te escuchan (agente y cliente)"),r()()()()),t&2&&(l(5),m("size",20),l(6),m("size",20),l(6),m("size",20))}var Nt=(()=>{let a=class a{constructor(e,i,o,x){this.adminMonitoringService=e,this.websocketService=i,this.authService=o,this.router=x,this.activeCalls=[],this.loading=!0,this.currentUser=null,this.currentMonitoringCall=null,this.currentAdminCallUuid=null,this.displayedColumns=["agent","client","duration","state","campaign","actions"],this.subscriptions=[]}ngOnInit(){this.currentUser=this.authService.getCurrentUser(),this.loadActiveCalls(),this.subscribeToWebSocket(),this.refreshInterval=setInterval(()=>{this.loadActiveCalls()},5e3)}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.refreshInterval&&clearInterval(this.refreshInterval)}loadActiveCalls(){this.adminMonitoringService.getActiveCalls().subscribe({next:e=>{this.activeCalls=e,this.loading=!1},error:e=>{console.error("Error loading active calls:",e),this.loading=!1}})}subscribeToWebSocket(){let e=this.websocketService.subscribe("/topic/admin/calls").subscribe({next:o=>{console.log("Admin call event received:",o),this.handleCallEvent(o)},error:o=>{console.error("WebSocket error:",o)}}),i=this.websocketService.subscribe("/topic/admin/monitoring").subscribe({next:o=>{console.log("Monitoring event received:",o),this.handleMonitoringEvent(o)},error:o=>{console.error("WebSocket monitoring error:",o)}});this.subscriptions.push(e,i)}handleCallEvent(e){let i=e.data||e;if(i.callState==="ENDED")this.activeCalls=this.activeCalls.filter(o=>o.callUuid!==i.callUuid);else{let o=this.activeCalls.findIndex(x=>x.callUuid===i.callUuid);o>=0?this.activeCalls[o]=i:this.activeCalls.push(i)}}handleMonitoringEvent(e){console.log("Monitoring event:",e)}startSpyMode(e){!this.currentUser||this.currentMonitoringCall||(console.log("Starting SPY mode for call:",e.callUuid),this.adminMonitoringService.startSpyMode({callUuid:e.callUuid,adminExtension:"1003",adminUsername:this.currentUser.username}).subscribe({next:i=>{console.log("SPY mode started:",i),this.currentMonitoringCall=e.callUuid,this.currentAdminCallUuid=i.adminCallUuid,alert("Modo VIG\xCDA activado. Escucha la llamada sin ser o\xEDdo.")},error:i=>{console.error("Error starting SPY mode:",i),alert("Error al activar modo VIG\xCDA")}}))}startWhisperMode(e){!this.currentUser||this.currentMonitoringCall||(console.log("Starting WHISPER mode for call:",e.callUuid),this.adminMonitoringService.startWhisperMode({callUuid:e.callUuid,adminExtension:"1003",adminUsername:this.currentUser.username}).subscribe({next:i=>{console.log("WHISPER mode started:",i),this.currentMonitoringCall=e.callUuid,this.currentAdminCallUuid=i.adminCallUuid,alert("Modo SUSURRO activado. Solo el agente puede escucharte.")},error:i=>{console.error("Error starting WHISPER mode:",i),alert("Error al activar modo SUSURRO")}}))}startBargeMode(e){!this.currentUser||this.currentMonitoringCall||(console.log("Starting BARGE mode for call:",e.callUuid),this.adminMonitoringService.startBargeMode({callUuid:e.callUuid,adminExtension:"1003",adminUsername:this.currentUser.username}).subscribe({next:i=>{console.log("BARGE mode started:",i),this.currentMonitoringCall=e.callUuid,this.currentAdminCallUuid=i.adminCallUuid,alert("Modo TRIPARTITA activado. Todos pueden escucharte.")},error:i=>{console.error("Error starting BARGE mode:",i),alert("Error al activar modo TRIPARTITA")}}))}stopMonitoring(e){!this.currentMonitoringCall||!this.currentAdminCallUuid||(console.log("Stopping monitoring for call:",e.callUuid),this.adminMonitoringService.stopMonitoring(e.callUuid,this.currentAdminCallUuid,this.currentUser.username).subscribe({next:i=>{console.log("Monitoring stopped:",i),this.currentMonitoringCall=null,this.currentAdminCallUuid=null,alert("Monitoreo detenido")},error:i=>{console.error("Error stopping monitoring:",i),alert("Error al detener monitoreo")}}))}isMonitoring(e){return this.currentMonitoringCall===e.callUuid}formatDuration(e){let i=Math.floor(e/60),o=e%60;return`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}getStateIcon(e){switch(e){case"RINGING":return"phone_in_talk";case"ANSWERED":return"call";case"ACTIVE":return"call";default:return"phone"}}getStateColor(e){switch(e){case"RINGING":return"accent";case"ANSWERED":return"primary";case"ACTIVE":return"primary";default:return""}}superviseCall(e){this.router.navigate(["/admin/supervision",e.callUuid])}};a.\u0275fac=function(i){return new(i||a)(h(X),h(G),h(T),h(A))},a.\u0275cmp=k({type:a,selectors:[["app-admin-monitoring"]],decls:15,vars:5,consts:[[1,"monitoring-container"],[1,"flex","items-center","gap-2","mb-2"],[1,"w-8","h-8","bg-gradient-to-br","from-green-600","to-green-700","rounded-lg","flex","items-center","justify-center"],["name","phone-call",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-gray-400"],["class","loading-container",4,"ngIf"],["class","no-calls",4,"ngIf"],["class","table-container",4,"ngIf"],["class","legend",4,"ngIf"],[1,"loading-container"],[1,"w-8","h-8","border-4","border-blue-500","border-t-transparent","rounded-full","animate-spin"],[1,"no-calls"],["name","phone-off",3,"size"],[1,"table-container"],["mat-table","",1,"calls-table",3,"dataSource"],["matColumnDef","agent"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","client"],["matColumnDef","duration"],["matColumnDef","state"],["matColumnDef","campaign"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"agent-info"],["name","user",3,"size"],[1,"agent-name"],[1,"agent-ext"],[1,"client-info"],["name","phone",3,"size"],[1,"duration"],["name","clock",3,"size"],[1,"call-state"],["name","phone-call",3,"size"],[1,"campaign-name"],["mat-raised-button","","color","primary","matTooltip","Abrir pantalla de supervisi\xF3n",3,"click"],["name","eye",3,"size"],["mat-header-row",""],["mat-row",""],[1,"legend"],[1,"legend-items"],[1,"legend-item"],["name","eye",1,"text-blue-500",3,"size"],["name","mic",1,"text-green-500",3,"size"],["name","users",1,"text-red-500",3,"size"]],template:function(i,o){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),s(3,"lucide-angular",3),r(),n(4,"div")(5,"h1",4),d(6,"Llamadas Activas"),r(),n(7,"p",5),d(8,"Monitoreo en tiempo real de llamadas en curso"),r()()(),n(9,"mat-card")(10,"mat-card-content"),p(11,Z,4,0,"div",6)(12,tt,4,1,"div",7)(13,ft,22,3,"div",8)(14,ht,22,3,"div",9),r()()()),i&2&&(l(3),m("size",16),l(8),m("ngIf",o.loading),l(),m("ngIf",!o.loading&&o.activeCalls.length===0),l(),m("ngIf",!o.loading&&o.activeCalls.length>0),l(),m("ngIf",!o.loading&&o.activeCalls.length>0))},dependencies:[w,E,D,z,R,W,N,K,P,j,L,$,V,Y,O,F,q,J,B,H,Q,I,U],styles:[`.monitoring-container{padding:20px;max-width:1400px;margin:0 auto;background-color:#f8fafc;min-height:100vh}app-admin-monitoring mat-card{margin-bottom:20px;background-color:#fff!important;border:1px solid #e2e8f0!important;border-radius:12px!important;box-shadow:0 1px 3px #0000001a!important}app-admin-monitoring mat-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:16px;background-color:transparent!important}app-admin-monitoring mat-card-title{display:flex;align-items:center;gap:10px;font-size:24px!important;font-weight:600!important;color:#0f172a!important;margin:0!important}app-admin-monitoring mat-card-title mat-icon{color:#10b981!important}app-admin-monitoring mat-card-content{padding:16px!important;color:#0f172a!important}.header-actions{display:flex;gap:10px}.loading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px}.loading-container p{margin-top:20px;color:#64748b!important;font-size:16px}.no-calls{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:#94a3b8;background-color:#f8fafc;border-radius:8px;border:1px dashed #cbd5e1}.no-calls mat-icon{font-size:64px!important;width:64px!important;height:64px!important;margin-bottom:20px;color:#cbd5e1!important}.no-calls p{font-size:16px;color:#64748b!important;margin:0}.table-container{overflow-x:auto;background-color:#fff;border-radius:8px}.calls-table{width:100%;background-color:#fff!important}.calls-table th{background-color:#f8fafc!important;font-weight:600!important;color:#0f172a!important;font-size:13px!important;text-transform:uppercase;letter-spacing:.5px;padding:12px 16px!important;border-bottom:1px solid #e2e8f0!important}.calls-table td{padding:12px 16px!important;border-bottom:1px solid #e2e8f0!important;color:#1e293b!important;font-weight:500!important}.calls-table tr:last-child td{border-bottom:none!important}.calls-table tr:hover td{background-color:#f8fafc!important}.agent-info,.client-info,.duration,.call-state{display:flex;align-items:center;gap:8px}.agent-info mat-icon,.client-info mat-icon,.duration mat-icon{color:#64748b!important;font-size:20px!important;width:20px!important;height:20px!important}.agent-name{font-weight:600!important;color:#0f172a!important}.agent-ext{font-size:12px;color:#64748b!important}.client-info span,.duration span{color:#1e293b!important;font-weight:500!important}.call-state{padding:6px 12px;border-radius:16px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.3px}.call-state mat-icon{font-size:18px!important;width:18px!important;height:18px!important}.call-state.state-ringing{background-color:#fff7ed!important;color:#ea580c!important}.call-state.state-ringing mat-icon{color:#ea580c!important}.call-state.state-answered,.call-state.state-active{background-color:#f0fdf4!important;color:#16a34a!important}.call-state.state-answered mat-icon,.call-state.state-active mat-icon{color:#16a34a!important}.campaign-name{font-size:13px;color:#334155!important;font-weight:500!important}.legend{margin-top:30px;padding:20px;background-color:#f8fafc!important;border-radius:8px;border:1px solid #e2e8f0!important}.legend h4{margin:0 0 16px;color:#0f172a!important;font-weight:600!important;font-size:16px}.legend-items{display:flex;flex-direction:column;gap:12px}.legend-item{display:flex;align-items:center;gap:12px}.legend-item mat-icon{color:#64748b!important}.legend-item span{font-size:14px;color:#334155!important}.legend-item strong{color:#0f172a!important;font-weight:600}:root.dark .monitoring-container,body.dark-theme .monitoring-container{background-color:#0f172a!important}:root.dark app-admin-monitoring mat-card,body.dark-theme app-admin-monitoring mat-card{background-color:#1e293b!important;border:1px solid #334155!important;box-shadow:0 1px 3px #0000004d!important}:root.dark app-admin-monitoring mat-card-title,body.dark-theme app-admin-monitoring mat-card-title{color:#f8fafc!important}:root.dark app-admin-monitoring mat-card-title mat-icon,body.dark-theme app-admin-monitoring mat-card-title mat-icon{color:#10b981!important}:root.dark app-admin-monitoring mat-card-content,body.dark-theme app-admin-monitoring mat-card-content{color:#e2e8f0!important}:root.dark .loading-container p,body.dark-theme .loading-container p{color:#94a3b8!important}:root.dark .no-calls,body.dark-theme .no-calls{background-color:#0f172a!important;border:1px dashed #334155!important;color:#64748b!important}:root.dark .no-calls mat-icon,body.dark-theme .no-calls mat-icon{color:#334155!important}:root.dark .no-calls p,body.dark-theme .no-calls p{color:#94a3b8!important}:root.dark .table-container,body.dark-theme .table-container{background-color:#1e293b!important}:root.dark .calls-table,body.dark-theme .calls-table{background-color:#1e293b!important}:root.dark .calls-table th,body.dark-theme .calls-table th{background-color:#0f172a!important;color:#f8fafc!important;border-bottom:1px solid #334155!important}:root.dark .calls-table td,body.dark-theme .calls-table td{color:#e2e8f0!important;border-bottom:1px solid #334155!important}:root.dark .calls-table tr:hover td,body.dark-theme .calls-table tr:hover td{background-color:#0f172a!important}:root.dark .agent-info mat-icon,:root.dark .client-info mat-icon,:root.dark .duration mat-icon,body.dark-theme .agent-info mat-icon,body.dark-theme .client-info mat-icon,body.dark-theme .duration mat-icon{color:#94a3b8!important}:root.dark .agent-name,body.dark-theme .agent-name{color:#fff!important}:root.dark .agent-ext,body.dark-theme .agent-ext{color:#64748b!important}:root.dark .client-info span,:root.dark .duration span,body.dark-theme .client-info span,body.dark-theme .duration span{color:#e2e8f0!important}:root.dark .call-state.state-ringing,body.dark-theme .call-state.state-ringing{background-color:#fb923c26!important;color:#fb923c!important}:root.dark .call-state.state-ringing mat-icon,body.dark-theme .call-state.state-ringing mat-icon{color:#fb923c!important}:root.dark .call-state.state-answered,:root.dark .call-state.state-active,body.dark-theme .call-state.state-answered,body.dark-theme .call-state.state-active{background-color:#10b98126!important;color:#10b981!important}:root.dark .call-state.state-answered mat-icon,:root.dark .call-state.state-active mat-icon,body.dark-theme .call-state.state-answered mat-icon,body.dark-theme .call-state.state-active mat-icon{color:#10b981!important}:root.dark .campaign-name,body.dark-theme .campaign-name{color:#e2e8f0!important}:root.dark .legend,body.dark-theme .legend{background-color:#0f172a!important;border:1px solid #334155!important}:root.dark .legend h4,body.dark-theme .legend h4{color:#f8fafc!important}:root.dark .legend-item mat-icon,body.dark-theme .legend-item mat-icon{color:#94a3b8!important}:root.dark .legend-item span,body.dark-theme .legend-item span{color:#e2e8f0!important}:root.dark .legend-item strong,body.dark-theme .legend-item strong{color:#f8fafc!important}:root.dark app-admin-monitoring button[mat-raised-button],body.dark-theme app-admin-monitoring button[mat-raised-button]{background-color:#10b981!important;color:#fff!important}:root.dark app-admin-monitoring button[mat-raised-button]:hover,body.dark-theme app-admin-monitoring button[mat-raised-button]:hover{background-color:#059669!important}@media (max-width: 768px){.monitoring-container{padding:10px}app-admin-monitoring mat-card-title{font-size:18px!important}app-admin-monitoring mat-card-header{flex-direction:column;align-items:flex-start;gap:12px}.calls-table td,.calls-table th{padding:8px 12px!important;font-size:13px!important}}@media (max-width: 480px){.monitoring-container{padding:8px}app-admin-monitoring mat-card-title{font-size:16px!important}.calls-table td,.calls-table th{padding:6px 8px!important;font-size:12px!important}.call-state{font-size:11px;padding:4px 8px}}.action-buttons button:focus-visible{outline:3px solid #10B981!important;outline-offset:2px}@media (prefers-contrast: high){app-admin-monitoring mat-card{border-width:2px!important}.call-state{border:2px solid currentColor!important}}@media (prefers-reduced-motion: reduce){*{animation:none!important;transition:none!important}}
`],encapsulation:2});let t=a;return t})();export{Nt as AdminMonitoringComponent};
