import{Tb as h}from"./chunk-XLQ3V3R5.js";import{E as n,X as o,Y as u,_ as i,ba as l,fa as c,n as r,rd as p}from"./chunk-S5LLKQFC.js";var A=(()=>{let a=class a{constructor(t){this.http=t,this.apiUrl=`${h.gatewayUrl}/agent-status`,this.currentStatusSubject=new r(null),this.currentStatus$=this.currentStatusSubject.asObservable()}getAgentStatus(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(i(e=>{let m={idUsuario:e.idUsuario,estadoActual:e.estadoActual,estadoAnterior:e.estadoAnterior,timestampCambio:e.timestampCambio,tiempoEnEstadoMinutos:e.tiempoEnEstadoMinutos,notas:e.notas,sessionId:e.sessionId};this.currentStatusSubject.next(m)}))}changeStatus(t,e){return this.http.post(`${this.apiUrl}/${t}/cambiar-estado`,e).pipe(i(()=>{this.getAgentStatus(t).subscribe()}))}enterManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/entrar`,{}).pipe(i(()=>{this.getAgentStatus(t).subscribe()}))}exitManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/salir`,{}).pipe(i(()=>{this.getAgentStatus(t).subscribe()}))}getAvailableStates(){return this.http.get(`${this.apiUrl}/estados-disponibles`)}isAvailableForCalls(t){return this.http.get(`${this.apiUrl}/${t}/disponible-para-llamadas`)}startStatusPolling(t){return n(3e4).pipe(o(0),u(()=>this.getAgentStatus(t)))}clearCurrentStatus(){this.currentStatusSubject.next(null)}disconnectAgent(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(i(()=>{console.log(`[AgentStatusService] Agente ${t} marcado como desconectado`),this.currentStatusSubject.next(null)}))}getCurrentStatus(){return this.currentStatusSubject.value}};a.\u0275fac=function(e){return new(e||a)(c(p))},a.\u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();export{A as a};
