import{a as Se,b as Me}from"./chunk-KHMFQFBX.js";import{a as Fe}from"./chunk-4BQOIAP5.js";import{D as W,b as Q,c as q,e as $,j as L,l as ke,r as G,s as Y,t as H,v as Ee,z as ee}from"./chunk-5CXVSPU7.js";import{ob as B,pb as z}from"./chunk-7OAV6HC2.js";import{a as R}from"./chunk-CVSECBKN.js";import{$a as l,Bc as ye,Eb as h,Fb as y,Gc as Ce,Ib as D,Jb as V,Jc as ce,Kb as g,Kc as pe,Lb as a,Mb as r,Nb as x,Tb as le,Ub as k,Wb as _,Yb as m,a as ae,b as re,ba as ge,cd as ve,fa as ue,fb as X,fd as Te,ga as fe,gc as se,hc as j,ic as S,jc as Z,jd as I,kc as d,lc as M,ma as u,mb as O,mc as E,na as f,nc as xe,pc as C,qc as v,qd as K,rb as J,rc as T,rd as we,ub as U,vc as de,wa as w,wc as be,xc as he,za as _e}from"./chunk-3MKZGHO3.js";var P=(function(o){return o.RESULTADO_CONTACTO="RESULTADO_CONTACTO",o.TIPO_GESTION="TIPO_GESTION",o.MODALIDAD_PAGO="MODALIDAD_PAGO",o.TIPO_FRACCIONAMIENTO="TIPO_FRACCIONAMIENTO",o})(P||{});var Ie=o=>[o],ze=o=>({fields:o}),ie=(o,s)=>s.id;function $e(o,s){if(o&1&&(a(0,"option",24),d(1),r()),o&2){let t=s.$implicit;g("value",t.typeCode),l(),M(t.typeName)}}function Le(o,s){if(o&1&&(a(0,"option",24),d(1),r()),o&2){let t=s.$implicit;g("value",t.typeCode),l(),M(t.typeName)}}function We(o,s){if(o&1){let t=k();a(0,"div",41)(1,"input",42),T("ngModelChange",function(i){let e=u(t).$implicit;return v(e.id,i)||(e.id=i),f(i)}),r(),a(2,"input",43),T("ngModelChange",function(i){let e=u(t).$implicit;return v(e.label,i)||(e.label=i),f(i)}),r(),a(3,"div",44)(4,"select",45),T("ngModelChange",function(i){let e=u(t).$implicit;return v(e.type,i)||(e.type=i),f(i)}),D(5,Le,2,2,"option",24,ie),r(),a(7,"button",46),_("click",function(){let i=u(t).$index,e=m(2).$implicit,p=m(2);return f(p.removeColumn(e,i))}),x(8,"lucide-angular",37),r()()()}if(o&2){let t=s.$implicit,n=m(4);l(),C("ngModel",t.id),l(),C("ngModel",t.label),l(2),C("ngModel",t.type),l(),V(n.columnFieldTypes()),l(3),g("size",16)}}function Ue(o,s){if(o&1){let t=k();a(0,"div",29)(1,"div",38)(2,"h4",39),d(3,"Columnas de la Tabla"),r(),a(4,"button",40),_("click",function(){u(t);let i=m().$implicit,e=m(2);return f(e.addColumn(i))}),d(5," + Agregar Columna "),r()(),D(6,We,9,4,"div",41,ie),r()}if(o&2){let t=m().$implicit;l(6),V(t.columns)}}function je(o,s){if(o&1){let t=k();a(0,"div",9)(1,"div",17)(2,"div",18)(3,"div",19)(4,"div")(5,"label",20),d(6," ID del Campo "),r(),a(7,"input",21),T("ngModelChange",function(i){let e=u(t).$implicit;return v(e.id,i)||(e.id=i),f(i)}),r()(),a(8,"div")(9,"label",20),d(10," Etiqueta "),r(),a(11,"input",22),T("ngModelChange",function(i){let e=u(t).$implicit;return v(e.label,i)||(e.label=i),f(i)}),r()()(),a(12,"div",19)(13,"div")(14,"label",20),d(15," Tipo de Campo "),r(),a(16,"select",23),T("ngModelChange",function(i){let e=u(t).$implicit;return v(e.type,i)||(e.type=i),f(i)}),_("ngModelChange",function(){let i=u(t).$implicit,e=m(2);return f(e.onFieldTypeChange(i))}),D(17,$e,2,2,"option",24,ie),r()(),a(19,"div",25)(20,"label",26)(21,"input",27),T("ngModelChange",function(i){let e=u(t).$implicit;return v(e.required,i)||(e.required=i),f(i)}),r(),a(22,"span",28),d(23," Campo Requerido "),r()()()(),h(24,Ue,8,0,"div",29),a(25,"div")(26,"label",20),d(27," Texto de Ayuda (opcional) "),r(),a(28,"input",30),T("ngModelChange",function(i){let e=u(t).$implicit;return v(e.helpText,i)||(e.helpText=i),f(i)}),r()(),a(29,"div",31)(30,"div",32),x(31,"lucide-angular",33),a(32,"h5",34),d(33,"Vista Previa"),r()(),a(34,"app-dynamic-field-renderer",35),_("dataChange",function(i){u(t);let e=m(2);return f(e.onPreviewDataChange(i))}),r()()(),a(35,"button",36),_("click",function(){let i=u(t).$index,e=m(2);return f(e.removeField(i))}),x(36,"lucide-angular",37),r()()()}if(o&2){let t=s.$implicit,n=m(2);l(7),C("ngModel",t.id),l(4),C("ngModel",t.label),l(5),C("ngModel",t.type),l(),V(n.fieldTypes()),l(4),C("ngModel",t.required),l(3),y(t.type==="table"?24:-1),l(4),C("ngModel",t.helpText),l(3),g("size",16),l(3),g("schema",de(11,ze,de(9,Ie,t))),l(2),g("size",20)}}function Be(o,s){o&1&&(a(0,"div",10)(1,"p"),d(2,"No hay campos configurados"),r(),a(3,"p",47),d(4,'Haz clic en "Agregar Campo" para empezar'),r()())}function Re(o,s){if(o&1){let t=k();a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),x(4,"lucide-angular",4),d(5," Configurar Campos Personalizados "),r(),a(6,"button",5),_("click",function(){u(t);let i=m();return f(i.handleCancel())}),x(7,"lucide-angular",6),r()(),a(8,"div",7)(9,"div",8),D(10,je,37,13,"div",9,ie),h(12,Be,5,0,"div",10),r(),a(13,"button",11),_("click",function(){u(t);let i=m();return f(i.addField())}),x(14,"lucide-angular",12),d(15," Agregar Campo "),r()(),a(16,"div",13)(17,"button",14),_("click",function(){u(t);let i=m();return f(i.handleCancel())}),d(18," Cancelar "),r(),a(19,"button",15),_("click",function(){u(t);let i=m();return f(i.handleSave())}),x(20,"lucide-angular",16),d(21," Guardar Configuraci\xF3n "),r()()()()}if(o&2){let t=m();l(4),g("size",24),l(3),g("size",24),l(3),V(t.fields()),l(2),y(t.fields().length===0?12:-1),l(2),g("size",20),l(6),g("size",20)}}var Ve=(()=>{let s=class s{constructor(){this.apiSystemConfigService=fe(Me),this.isOpen=pe.required(),this.existingSchema=pe(null),this.save=ce(),this.cancel=ce(),this.fields=w([]),this.fieldTypes=w([]),this.columnFieldTypes=w([]),this.apiSystemConfigService.getFieldTypesForMainFields().subscribe(n=>{this.fieldTypes.set(n)}),this.apiSystemConfigService.getFieldTypesForTableColumns().subscribe(n=>{this.columnFieldTypes.set(n)}),Ce(()=>{let n=this.existingSchema();if(n&&n.fields){let i=JSON.parse(JSON.stringify(n.fields)).map(e=>re(ae({},e),{type:e.type?.toLowerCase()||"text",columns:e.columns?.map(p=>re(ae({},p),{type:p.type?.toLowerCase()||"text"}))}));this.fields.set(i)}else this.fields.set([])})}addField(){let n={id:`field_${Date.now()}`,label:"Nuevo Campo",type:"text",required:!1,displayOrder:this.fields().length};this.fields.update(i=>[...i,n])}removeField(n){this.fields.update(i=>i.filter((e,p)=>p!==n))}onFieldTypeChange(n){n.type==="table"&&((!n.columns||n.columns.length===0)&&(n.columns=[{id:"cuota",label:"Cuota",type:"auto-number",required:!0},{id:"fecha",label:"Fecha",type:"date",required:!0},{id:"monto",label:"Monto",type:"currency",required:!0}]),n.allowAddRow=!0,n.allowDeleteRow=!0)}addColumn(n){n.columns||(n.columns=[]);let i={id:`column_${Date.now()}`,label:"Nueva Columna",type:"text"};n.columns.push(i),this.fields.set([...this.fields()])}removeColumn(n,i){n.columns&&(n.columns.splice(i,1),this.fields.set([...this.fields()]))}handleSave(){let n={fields:this.fields()};this.save.emit(n)}handleCancel(){this.cancel.emit()}onPreviewDataChange(n){}};s.\u0275fac=function(i){return new(i||s)},s.\u0275cmp=O({type:s,selectors:[["app-field-config-dialog"]],inputs:{isOpen:[1,"isOpen"],existingSchema:[1,"existingSchema"]},outputs:{save:"save",cancel:"cancel"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-xl","max-w-4xl","w-full","max-h-[90vh]","flex","flex-col"],[1,"flex","items-center","justify-between","p-6","border-b","border-gray-200","dark:border-gray-700"],[1,"text-xl","font-bold","text-gray-900","dark:text-white","flex","items-center","gap-2"],["name","settings",1,"text-blue-600",3,"size"],["type","button",1,"text-gray-400","hover:text-gray-600","dark:hover:text-gray-300",3,"click"],["name","x",3,"size"],[1,"flex-1","overflow-y-auto","p-6","space-y-4"],[1,"space-y-3"],[1,"bg-gray-50","dark:bg-gray-700","p-4","rounded-lg","border","border-gray-200","dark:border-gray-600"],[1,"text-center","py-8","text-gray-500","dark:text-gray-400"],["type","button",1,"w-full","py-3","border-2","border-dashed","border-gray-300","dark:border-gray-600","rounded-lg","text-gray-600","dark:text-gray-400","hover:border-blue-500","hover:text-blue-500","dark:hover:border-blue-400","dark:hover:text-blue-400","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],["name","plus",3,"size"],[1,"flex","items-center","justify-end","gap-3","p-6","border-t","border-gray-200","dark:border-gray-700"],["type","button",1,"px-4","py-2","text-gray-700","dark:text-gray-300","bg-gray-100","dark:bg-gray-700","rounded-lg","hover:bg-gray-200","dark:hover:bg-gray-600",3,"click"],["type","button",1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","flex","items-center","gap-2",3,"click"],["name","save",3,"size"],[1,"flex","items-start","justify-between","gap-4"],[1,"flex-1","space-y-3"],[1,"grid","grid-cols-2","gap-3"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","text","placeholder","payment_schedule",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],["type","text","placeholder","Cronograma de Pago",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","items-cent","er","pt-6"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"text-sm","font-medium","text-gray-700","dark:text-gray-300"],[1,"mt-4","p-4","bg-white","dark:bg-gray-800","rounded","border","border-gray-300","dark:border-gray-600"],["type","text","placeholder","Instrucciones para el usuario...",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"mt-4","p-4","bg-gradient-to-br","from-purple-50","to-blue-50","dark:from-purple-950/30","dark:to-blue-950/30","rounded-lg","border-2","border-purple-200","dark:border-purple-800"],[1,"flex","items-center","gap-2","mb-3"],["name","eye",1,"text-purple-600","dark:text-purple-400",3,"size"],[1,"text-xs","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide"],[3,"dataChange","schema"],["type","button",1,"text-red-600","hover:text-red-800","dark:text-red-400","dark:hover:text-red-300",3,"click"],["name","trash-2",3,"size"],[1,"flex","items-center","justify-between","mb-3"],[1,"font-medium","text-gray-900","dark:text-white"],["type","button",1,"text-sm","px-3","py-1","bg-blue-600","text-white","rounded","hover:bg-blue-700",3,"click"],[1,"grid","grid-cols-3","gap-2","mb-2"],["type","text","placeholder","ID",1,"px-2","py-1","text-sm","border","border-gray-300","dark:border-gray-600","rounded","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],["type","text","placeholder","Etiqueta",1,"px-2","py-1","text-sm","border","border-gray-300","dark:border-gray-600","rounded","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"flex","gap-1"],[1,"flex-1","px-2","py-1","text-sm","border","border-gray-300","dark:border-gray-600","rounded","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],["type","button",1,"px-2","text-red-600","hover:text-red-800",3,"click"],[1,"text-sm"]],template:function(i,e){i&1&&h(0,Re,22,5,"div",0),i&2&&y(e.isOpen()?0:-1)},dependencies:[I,W,Y,H,q,Q,G,$,L,z,B,Se],styles:["[_nghost-%COMP%]{display:contents}"]});let o=s;return o})();var ne=(()=>{let s=class s{constructor(n){this.http=n,this.catalogUrl=`${R.gatewayUrl}/v2/typifications/catalog`,this.configUrl=`${R.gatewayUrl}/v2/typifications/config`}getAllClassifications(){return this.http.get(`${this.catalogUrl}`)}getActiveClassifications(){return this.http.get(`${this.catalogUrl}/active`)}getTypificationsByType(n){return this.http.get(`${this.catalogUrl}/type/${n}`)}getTypificationsByLevel(n){return this.http.get(`${this.catalogUrl}/level/${n}`)}getTypificationsByParent(n){return this.http.get(`${this.catalogUrl}/${n}/children`)}getClassificationById(n){return this.http.get(`${this.catalogUrl}/${n}`)}getRootTypifications(){return this.http.get(`${this.catalogUrl}/roots`)}createTypification(n){return this.http.post(`${this.catalogUrl}`,n)}updateTypification(n,i){return this.http.put(`${this.catalogUrl}/${n}`,i)}deleteTypification(n){return this.http.delete(`${this.catalogUrl}/${n}`)}activateTypification(n){return this.http.put(`${this.catalogUrl}/${n}/activate`,{})}deactivateTypification(n){return this.http.put(`${this.catalogUrl}/${n}/deactivate`,{})}getTenantClassifications(n,i,e){let p=new K;return e&&(p=p.set("includeDisabled","true")),i?this.http.get(`${this.configUrl}/tenant/${n}/portfolio/${i}`,{params:p}):this.http.get(`${this.configUrl}/tenant/${n}`,{params:p})}getTenantClassificationsByType(n,i,e){let p=new K;return e&&(p=p.set("portfolioId",e.toString())),this.http.get(`${this.configUrl}/tenant/${n}/type/${i}`,{params:p})}getEffectiveTypifications(n,i,e){return this.http.get(`${this.configUrl}/effective/tenant/${n}/portfolio/${i}/subportfolio/${e}`)}updateTenantTypificationConfig(n,i){return this.http.put(`${this.configUrl}/${n}`,i)}enableClassification(n,i,e,p,c){let b=new K().set("userId",c?.toString()||"1");return p&&e?this.http.post(`${this.configUrl}/tenant/${n}/portfolio/${e}/subportfolio/${p}/typification/${i}/enable`,{},{params:b}):e?this.http.post(`${this.configUrl}/tenant/${n}/portfolio/${e}/subportfolio/0/typification/${i}/enable`,{},{params:b}):this.http.post(`${this.configUrl}/tenant/${n}/portfolio/0/subportfolio/0/typification/${i}/enable`,{},{params:b})}disableClassification(n,i,e,p,c){let b=new K().set("userId",c?.toString()||"1");return p&&e?this.http.post(`${this.configUrl}/tenant/${n}/portfolio/${e}/subportfolio/${p}/typification/${i}/disable`,{},{params:b}):e?this.http.post(`${this.configUrl}/tenant/${n}/portfolio/${e}/subportfolio/0/typification/${i}/disable`,{},{params:b}):this.http.post(`${this.configUrl}/tenant/${n}/portfolio/0/subportfolio/0/typification/${i}/disable`,{},{params:b})}getAllTenants(){return this.http.get(`${R.webServiceUrl}/v1/system-config/tenants`)}getPortfoliosByTenant(n){return this.http.get(`${R.webServiceUrl}/v1/system-config/tenants/${n}/portfolios`)}getSubPortfoliosByPortfolio(n){return this.http.get(`${R.gatewayUrl}/carteras/${n}/subcarteras`)}getAdditionalFields(n){return this.http.get(`${this.catalogUrl}/${n}/additional-fields`)}buildClassificationTree(n){let i=new Map,e=[];n.forEach(c=>{i.set(c.id,{typification:c,children:[],level:c.nivelJerarquia})}),n.forEach(c=>{let b=i.get(c.id),F=c.tipificacionPadre?.id;if(F){let A=i.get(F);A&&A.children.push(b)}else e.push(b)});let p=c=>{c.children.length>0&&(c.children.sort((b,F)=>{let A=b.typification.ordenVisualizacion||0,oe=F.typification.ordenVisualizacion||0;return A-oe}),c.children.forEach(b=>p(b)))};return e.forEach(c=>p(c)),e}};s.\u0275fac=function(i){return new(i||s)(ue(we))},s.\u0275prov=ge({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();var qe=(o,s)=>s.hex,Ge=(o,s)=>s.name;function Ye(o,s){if(o&1&&(a(0,"p",12),d(1),r()),o&2){let t=m();l(),M(t.errors().codigo)}}function He(o,s){if(o&1&&(a(0,"p",12),d(1),r()),o&2){let t=m();l(),M(t.errors().nombre)}}function Xe(o,s){if(o&1&&(a(0,"p",12),d(1),r()),o&2){let t=m();l(),M(t.errors().tipoClasificacion)}}function Je(o,s){o&1&&x(0,"lucide-angular",45),o&2&&g("size",20)}function Ze(o,s){if(o&1){let t=k();a(0,"button",44),_("click",function(){let i=u(t).$implicit,e=m();return f(e.form.colorSugerido=i.hex)}),h(1,Je,1,1,"lucide-angular",45),r()}if(o&2){let t=s.$implicit,n=m();Z("w-12 h-12 rounded-lg border-2 transition-all hover:scale-110 flex items-center justify-center "+(n.form.colorSugerido===t.hex?"border-gray-900 dark:border-white ring-2 ring-offset-2 ring-gray-900 dark:ring-white":"border-gray-300 dark:border-gray-600")),j("background-color",t.hex),g("title",t.name),l(),y(n.form.colorSugerido===t.hex?1:-1)}}function Ke(o,s){if(o&1){let t=k();a(0,"button",44),_("click",function(){let i=u(t).$implicit,e=m();return f(e.form.iconoSugerido=i.name)}),x(1,"lucide-angular",46),r()}if(o&2){let t=s.$implicit,n=m();Z("p-3 rounded-lg border-2 transition-all hover:bg-gray-100 dark:hover:bg-slate-700 flex items-center justify-center "+(n.form.iconoSugerido===t.name?"border-blue-500 bg-blue-50 dark:bg-blue-950/30":"border-gray-300 dark:border-gray-600")),g("title",t.label),l(),g("name",t.name)("size",20)}}function Qe(o,s){if(o&1){let t=k();a(0,"div",31),x(1,"lucide-angular",47),a(2,"span",48),d(3),r(),a(4,"button",49),_("click",function(){u(t);let i=m();return f(i.form.iconoSugerido="")}),x(5,"lucide-angular",6),r()()}if(o&2){let t=m();l(),g("name",t.form.iconoSugerido)("size",28),l(2),E("Icono seleccionado: ",t.form.iconoSugerido),l(2),g("size",18)}}function et(o,s){o&1&&(a(0,"p",32),d(1,"No has seleccionado ning\xFAn icono"),r())}function tt(o,s){if(o&1){let t=k();a(0,"div",23)(1,"input",50),T("ngModelChange",function(i){u(t);let e=m();return v(e.form.estaActiva,i)||(e.form.estaActiva=i),f(i)}),r(),a(2,"label",51),d(3," Tipificaci\xF3n Activa "),a(4,"span",52),d(5,"Desmarca para desactivar temporalmente esta tipificaci\xF3n"),r()()()}if(o&2){let t=m();l(),C("ngModel",t.form.estaActiva)}}function it(o,s){if(o&1&&(a(0,"div",36)(1,"div",53),x(2,"lucide-angular",54),a(3,"span",55),d(4,"Tipificaci\xF3n Hijo"),r()(),a(5,"p",56)(6,"span",57),d(7,"Padre:"),r(),d(8),a(9,"span",58),d(10),r()(),a(11,"p",59),d(12),r()()),o&2){let t=m();l(2),g("size",16),l(6),E(" ",t.parentClassification.nombre," "),l(2),E("(",t.parentClassification.codigo,")"),l(2),E(" Esta tipificaci\xF3n ser\xE1 nivel ",t.parentClassification.nivelJerarquia+1," en la jerarqu\xEDa ")}}function nt(o,s){o&1&&(x(0,"div",60),d(1," Guardando... "))}function ot(o,s){o&1&&(x(0,"lucide-angular",61),d(1," Guardar ")),o&2&&g("size",18)}function at(o,s){if(o&1){let t=k();a(0,"app-field-config-dialog",62),_("save",function(i){u(t);let e=m();return f(e.onFieldConfigSave(i))})("cancel",function(){u(t);let i=m();return f(i.onFieldConfigCancel())}),r()}if(o&2){let t=m();g("isOpen",t.showFieldConfig())("existingSchema",t.form.metadataSchema||null)}}var Pe=(()=>{let s=class s{constructor(n){this.classificationService=n,this.mode="create",this.save=new U,this.cancel=new U,this.ClassificationTypeV2=P,this.isEditMode=!1,this.form={codigo:"",nombre:"",tipoClasificacion:"",descripcion:"",ordenVisualizacion:0,iconoSugerido:"",colorSugerido:"#3B82F6",estaActiva:!0},this.showFieldConfig=w(!1),this.presetColors=[{hex:"#3B82F6",name:"Azul"},{hex:"#10B981",name:"Verde"},{hex:"#EF4444",name:"Rojo"},{hex:"#F59E0B",name:"Naranja"},{hex:"#8B5CF6",name:"Violeta"},{hex:"#EC4899",name:"Rosa"},{hex:"#6366F1",name:"\xCDndigo"},{hex:"#14B8A6",name:"Turquesa"},{hex:"#F97316",name:"Naranja Oscuro"},{hex:"#06B6D4",name:"Cyan"},{hex:"#84CC16",name:"Lima"},{hex:"#A855F7",name:"P\xFArpura"},{hex:"#64748B",name:"Gris"},{hex:"#0EA5E9",name:"Azul Cielo"},{hex:"#22C55E",name:"Verde Claro"},{hex:"#DC2626",name:"Rojo Oscuro"}],this.commonIcons=[{name:"phone",label:"Tel\xE9fono"},{name:"phone-call",label:"Llamada"},{name:"check-circle",label:"\xC9xito"},{name:"x-circle",label:"Error"},{name:"alert-circle",label:"Alerta"},{name:"user",label:"Usuario"},{name:"users",label:"Usuarios"},{name:"credit-card",label:"Tarjeta"},{name:"dollar-sign",label:"Dinero"},{name:"calendar",label:"Calendario"},{name:"clock",label:"Reloj"},{name:"mail",label:"Correo"},{name:"message-square",label:"Mensaje"},{name:"file-text",label:"Documento"},{name:"building",label:"Casa"},{name:"wallet",label:"Malet\xEDn"},{name:"trending-up",label:"Tendencia"}],this.saving=w(!1),this.errors=w({})}ngOnInit(){this.isEditMode=this.mode==="edit",this.defaultType&&(this.form.tipoClasificacion=this.defaultType),this.isEditMode&&this.typification&&(this.form={codigo:this.typification.codigo,nombre:this.typification.nombre,tipoClasificacion:this.typification.tipoClasificacion,descripcion:this.typification.descripcion||"",ordenVisualizacion:this.typification.ordenVisualizacion||0,iconoSugerido:this.typification.iconoSugerido||"",colorSugerido:this.typification.colorSugerido||"#3B82F6",estaActiva:this.typification.estaActiva})}validate(){let n={};return this.form.codigo.trim()||(n.codigo="El c\xF3digo es requerido"),this.form.nombre.trim()||(n.nombre="El nombre es requerido"),this.form.tipoClasificacion||(n.tipoClasificacion="El tipo de clasificaci\xF3n es requerido"),this.errors.set(n),Object.keys(n).length===0}onSave(){this.validate()&&(this.saving.set(!0),this.isEditMode&&this.typification?this.updateTypification():this.createTypification())}createTypification(){let n={codigo:this.form.codigo.trim(),nombre:this.form.nombre.trim(),tipoClasificacion:this.form.tipoClasificacion,tipificacionPadre:this.parentClassification?{id:this.parentClassification.id}:void 0,descripcion:this.form.descripcion.trim()||void 0,ordenVisualizacion:this.form.ordenVisualizacion,iconoSugerido:this.form.iconoSugerido.trim()||void 0,colorSugerido:this.form.colorSugerido||void 0};this.classificationService.createTypification(n).subscribe({next:i=>{console.log("\u2705 Clasificaci\xF3n creada:",i),this.tenantId?(console.log(`\u{1F504} Auto-habilitando clasificaci\xF3n ${i.id} para tenant ${this.tenantId}`),this.classificationService.enableClassification(this.tenantId,i.id,this.portfolioId).subscribe({next:()=>{console.log("\u2705 Clasificaci\xF3n auto-habilitada para el tenant"),this.saving.set(!1),this.save.emit(i)},error:e=>{console.error("\u26A0\uFE0F Error al auto-habilitar (pero la clasificaci\xF3n se cre\xF3):",e),this.saving.set(!1),this.save.emit(i)}})):(this.saving.set(!1),this.save.emit(i))},error:i=>{console.error("Error al crear tipificaci\xF3n:",i),this.saving.set(!1),alert("Error al crear la tipificaci\xF3n. Verifique que el c\xF3digo no est\xE9 duplicado.")}})}updateTypification(){if(!this.typification)return;let n={nombre:this.form.nombre.trim(),descripcion:this.form.descripcion.trim()||void 0,ordenVisualizacion:this.form.ordenVisualizacion,iconoSugerido:this.form.iconoSugerido.trim()||void 0,colorSugerido:this.form.colorSugerido||void 0,estaActiva:this.form.estaActiva};this.classificationService.updateTypification(this.typification.id,n).subscribe({next:i=>{this.saving.set(!1),this.save.emit(i)},error:i=>{console.error("Error al actualizar tipificaci\xF3n:",i),this.saving.set(!1),alert("Error al actualizar la tipificaci\xF3n.")}})}onCancel(){this.cancel.emit()}getDialogTitle(){return this.isEditMode?"Editar Tipificaci\xF3n":this.parentClassification?`Nueva Tipificaci\xF3n - Nivel ${this.parentClassification.nivelJerarquia+1}`:"Nueva Tipificaci\xF3n - Nivel 1"}openFieldConfig(){console.log("\u{1F527} Abriendo configuraci\xF3n de campos din\xE1micos"),this.showFieldConfig.set(!0)}onFieldConfigSave(n){console.log("\u{1F4BE} Guardando configuraci\xF3n de campos:",n),this.form.metadataSchema=n,this.showFieldConfig.set(!1)}onFieldConfigCancel(){console.log("\u274C Cancelando configuraci\xF3n de campos"),this.showFieldConfig.set(!1)}};s.\u0275fac=function(i){return new(i||s)(X(ne))},s.\u0275cmp=O({type:s,selectors:[["app-typification-form-dialog"]],inputs:{mode:"mode",typification:"typification",parentClassification:"parentClassification",defaultType:"defaultType",tenantId:"tenantId",portfolioId:"portfolioId"},outputs:{save:"save",cancel:"cancel"},decls:100,vars:36,consts:[[1,"fixed","inset-0","bg-black/50","dark:bg-black/70","flex","items-center","justify-center","z-50","p-4","transition-opacity","duration-300",3,"click"],[1,"bg-white","dark:bg-slate-900","rounded-lg","shadow-2xl","max-w-4xl","w-full","max-h-[90vh]","overflow-auto","transition-all","duration-300","transform",3,"click"],[1,"sticky","top-0","bg-gradient-to-r","from-blue-600","to-blue-700","dark:from-blue-700","dark:to-blue-800","text-white","px-6","py-4","flex","items-center","justify-between","rounded-t-lg","z-10"],[1,"text-xl","font-bold"],[1,"text-sm","text-blue-100","dark:text-blue-200"],[1,"p-2","hover:bg-white/20","rounded-lg","transition-colors",3,"click"],["name","x",3,"size"],[1,"p-6","space-y-6"],[1,"grid","grid-cols-2","gap-4"],[1,"block","text-sm","font-bold","text-gray-700","dark:text-gray-200","mb-2"],[1,"text-red-500"],["type","text","placeholder","Ej: CPC, ACP, PPR","maxlength","20",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","disabled:bg-gray-100","dark:disabled:bg-slate-700","disabled:cursor-not-allowed","text-sm",3,"ngModelChange","ngModel","disabled"],[1,"text-red-500","text-xs","mt-1"],["type","text","placeholder","Ej: Contacto con Cliente, Promesa de Pago","maxlength","255",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","text-sm",3,"ngModelChange","ngModel"],[1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","disabled:bg-gray-100","dark:disabled:bg-slate-700","disabled:cursor-not-allowed","text-sm",3,"ngModelChange","ngModel","disabled"],["value",""],[3,"value"],[1,"text-xs","font-normal","text-gray-500","dark:text-gray-400","ml-1"],["rows","3","placeholder","Descripci\xF3n detallada de la tipificaci\xF3n...",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","text-sm",3,"ngModelChange","ngModel"],[1,"block","text-sm","font-bold","text-gray-700","dark:text-gray-200","mb-3"],[1,"space-y-3"],[1,"grid","grid-cols-8","gap-2"],["type","button",3,"class","background-color","title"],[1,"flex","items-center","gap-3","p-3","bg-gray-50","dark:bg-slate-800","rounded-lg","border","border-gray-200","dark:border-gray-700"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-200"],["type","color",1,"h-12","w-24","border-2","border-gray-300","dark:border-gray-600","rounded-lg","cursor-pointer",3,"ngModelChange","ngModel"],[1,"flex-1","flex","items-center","gap-3"],[1,"w-10","h-10","rounded-lg","border-2","border-gray-300","dark:border-gray-600"],[1,"text-sm","font-mono","font-bold","text-gray-700","dark:text-gray-300"],[1,"grid","grid-cols-10","gap-2"],["type","button",3,"class","title"],[1,"flex","items-center","gap-3","p-3","bg-blue-50","dark:bg-blue-950/30","rounded-lg","border","border-blue-200","dark:border-blue-900"],[1,"text-xs","text-gray-500","dark:text-gray-400"],["type","number","min","0","step","10","placeholder","0, 10, 20, 30...",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","text-sm",3,"ngModelChange","ngModel"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1","flex","items-center","gap-1"],["name","alert-circle",3,"size"],[1,"bg-blue-50","dark:bg-blue-950/30","border","border-blue-200","dark:border-blue-900/50","rounded-lg","p-4"],[1,"sticky","bottom-0","bg-gray-50","dark:bg-slate-800","px-6","py-4","flex","justify-between","items-center","rounded-b-lg","border-t","border-gray-200","dark:border-gray-700"],["type","button",1,"px-4","py-2.5","text-indigo-600","dark:text-indigo-400","bg-indigo-50","dark:bg-indigo-950/30","border","border-indigo-300","dark:border-indigo-800","rounded-lg","hover:bg-indigo-100","dark:hover:bg-indigo-900/50","font-semibold","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","settings",3,"size"],[1,"flex","gap-3"],[1,"px-6","py-2.5","text-gray-700","dark:text-gray-200","bg-white","dark:bg-slate-700","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-50","dark:hover:bg-slate-600","font-semibold","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],[1,"px-6","py-2.5","bg-gradient-to-r","from-blue-600","to-blue-700","hover:from-blue-700","hover:to-blue-800","disabled:from-gray-400","disabled:to-gray-500","text-white","rounded-lg","font-semibold","transition-all","shadow-md","hover:shadow-lg","flex","items-center","gap-2","text-sm",3,"click","disabled"],[3,"isOpen","existingSchema"],["type","button",3,"click","title"],["name","check-circle",1,"text-white","drop-shadow-lg",3,"size"],[1,"text-gray-700","dark:text-gray-200",3,"name","size"],[1,"text-blue-600","dark:text-blue-400",3,"name","size"],[1,"text-sm","font-semibold","text-blue-800","dark:text-blue-200"],["type","button",1,"ml-auto","text-blue-600","dark:text-blue-400","hover:text-blue-800","dark:hover:text-blue-200",3,"click"],["type","checkbox","id","estaActiva",1,"w-5","h-5","text-blue-600","bg-gray-100","dark:bg-gray-700","border-gray-300","dark:border-gray-600","rounded","focus:ring-blue-500","cursor-pointer",3,"ngModelChange","ngModel"],["for","estaActiva",1,"text-sm","font-bold","text-gray-700","dark:text-gray-200","cursor-pointer","flex-1"],[1,"block","text-xs","font-normal","text-gray-500","dark:text-gray-400","mt-0.5"],[1,"flex","items-center","gap-2","text-blue-800","dark:text-blue-200","mb-1"],["name","git-branch",3,"size"],[1,"font-bold"],[1,"text-sm","text-blue-700","dark:text-blue-300"],[1,"font-semibold"],[1,"text-xs","opacity-75"],[1,"text-xs","text-blue-600","dark:text-blue-400","mt-1"],[1,"w-4","h-4","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],["name","save",3,"size"],[3,"save","cancel","isOpen","existingSchema"]],template:function(i,e){i&1&&(a(0,"div",0),_("click",function(){return e.onCancel()}),a(1,"div",1),_("click",function(c){return c.stopPropagation()}),a(2,"div",2)(3,"div")(4,"h2",3),d(5),r(),a(6,"p",4),d(7),r()(),a(8,"button",5),_("click",function(){return e.onCancel()}),x(9,"lucide-angular",6),r()(),a(10,"div",7)(11,"div",8)(12,"div")(13,"label",9),d(14," C\xF3digo "),a(15,"span",10),d(16,"*"),r()(),a(17,"input",11),T("ngModelChange",function(c){return v(e.form.codigo,c)||(e.form.codigo=c),c}),r(),h(18,Ye,2,1,"p",12),r(),a(19,"div")(20,"label",9),d(21," Nombre "),a(22,"span",10),d(23,"*"),r()(),a(24,"input",13),T("ngModelChange",function(c){return v(e.form.nombre,c)||(e.form.nombre=c),c}),r(),h(25,He,2,1,"p",12),r()(),a(26,"div")(27,"label",9),d(28," Tipo de Clasificaci\xF3n "),a(29,"span",10),d(30,"*"),r()(),a(31,"select",14),T("ngModelChange",function(c){return v(e.form.tipoClasificacion,c)||(e.form.tipoClasificacion=c),c}),a(32,"option",15),d(33,"-- Seleccionar --"),r(),a(34,"option",16),d(35,"Resultado de Contacto"),r(),a(36,"option",16),d(37,"Tipo de Gesti\xF3n"),r(),a(38,"option",16),d(39,"Modalidad de Pago"),r(),a(40,"option",16),d(41,"Tipo de Fraccionamiento"),r()(),h(42,Xe,2,1,"p",12),r(),a(43,"div")(44,"label",9),d(45," Descripci\xF3n "),a(46,"span",17),d(47,"(Opcional)"),r()(),a(48,"textarea",18),T("ngModelChange",function(c){return v(e.form.descripcion,c)||(e.form.descripcion=c),c}),r()(),a(49,"div")(50,"label",19),d(51," Color de Identificaci\xF3n "),a(52,"span",17),d(53,"(Selecciona el color que representar\xE1 esta tipificaci\xF3n)"),r()(),a(54,"div",20)(55,"div",21),D(56,Ze,2,6,"button",22,qe),r(),a(58,"div",23)(59,"label",24),d(60,"Color personalizado:"),r(),a(61,"input",25),T("ngModelChange",function(c){return v(e.form.colorSugerido,c)||(e.form.colorSugerido=c),c}),r(),a(62,"div",26),x(63,"div",27),a(64,"span",28),d(65),r()()()()(),a(66,"div")(67,"label",19),d(68," Icono Visual "),a(69,"span",17),d(70,"(Opcional - Selecciona un icono representativo)"),r()(),a(71,"div",20)(72,"div",29),D(73,Ke,2,5,"button",30,Ge),r(),h(75,Qe,6,4,"div",31)(76,et,2,0,"p",32),r()(),a(77,"div")(78,"label",9),d(79," Orden de Visualizaci\xF3n "),a(80,"span",17),d(81,"(Menor n\xFAmero aparece primero)"),r()(),a(82,"input",33),T("ngModelChange",function(c){return v(e.form.ordenVisualizacion,c)||(e.form.ordenVisualizacion=c),c}),r(),a(83,"p",34),x(84,"lucide-angular",35),d(85," Tip: Usa m\xFAltiplos de 10 (10, 20, 30...) para facilitar inserciones futuras "),r()(),h(86,tt,6,1,"div",23),h(87,it,13,4,"div",36),r(),a(88,"div",37)(89,"button",38),_("click",function(){return e.openFieldConfig()}),x(90,"lucide-angular",39),d(91," Configurar Campos Din\xE1micos "),r(),a(92,"div",40)(93,"button",41),_("click",function(){return e.onCancel()}),x(94,"lucide-angular",6),d(95," Cancelar "),r(),a(96,"button",42),_("click",function(){return e.onSave()}),h(97,nt,2,0)(98,ot,2,1),r()()()()(),h(99,at,1,2,"app-field-config-dialog",43)),i&2&&(l(5),M(e.getDialogTitle()),l(2),E(" ",e.isEditMode?"Modificar tipificaci\xF3n existente":"Crear nueva tipificaci\xF3n"," "),l(2),g("size",24),l(8),S("border-red-500",e.errors().codigo),C("ngModel",e.form.codigo),g("disabled",e.isEditMode),l(),y(e.errors().codigo?18:-1),l(6),S("border-red-500",e.errors().nombre),C("ngModel",e.form.nombre),l(),y(e.errors().nombre?25:-1),l(6),S("border-red-500",e.errors().tipoClasificacion),C("ngModel",e.form.tipoClasificacion),g("disabled",e.isEditMode||!!e.defaultType),l(3),g("value",e.ClassificationTypeV2.RESULTADO_CONTACTO),l(2),g("value",e.ClassificationTypeV2.TIPO_GESTION),l(2),g("value",e.ClassificationTypeV2.MODALIDAD_PAGO),l(2),g("value",e.ClassificationTypeV2.TIPO_FRACCIONAMIENTO),l(2),y(e.errors().tipoClasificacion?42:-1),l(6),C("ngModel",e.form.descripcion),l(8),V(e.presetColors),l(5),C("ngModel",e.form.colorSugerido),l(2),j("background-color",e.form.colorSugerido),l(2),M(e.form.colorSugerido),l(8),V(e.commonIcons),l(2),y(e.form.iconoSugerido?75:76),l(7),C("ngModel",e.form.ordenVisualizacion),l(2),g("size",12),l(2),y(e.isEditMode?86:-1),l(),y(e.parentClassification?87:-1),l(3),g("size",18),l(4),g("size",18),l(2),g("disabled",e.saving()),l(),y(e.saving()?97:98),l(2),y(e.showFieldConfig()?99:-1))},dependencies:[I,W,Y,H,q,ke,Q,G,$,ee,Ee,L,z,B,Ve],encapsulation:2});let o=s;return o})();var N=(function(o){return o.CONTACT_RESULT="CONTACT_RESULT",o.MANAGEMENT_TYPE="MANAGEMENT_TYPE",o.PAYMENT_TYPE="PAYMENT_TYPE",o.COMPLAINT_TYPE="COMPLAINT_TYPE",o.PAYMENT_SCHEDULE="PAYMENT_SCHEDULE",o.CUSTOM="CUSTOM",o})(N||{});var rt=(o,s)=>s.type;function lt(o,s){if(o&1&&(a(0,"p",16),d(1),r()),o&2){let t=m();l(),M(t.errors().code)}}function st(o,s){if(o&1&&(a(0,"p",16),d(1),r()),o&2){let t=m();l(),M(t.errors().name)}}function dt(o,s){if(o&1&&(a(0,"div",38)(1,"p",39),d(2,"Ejemplo:"),r(),a(3,"div",40)(4,"span",41),d(5),r(),a(6,"span",42),d(7),r()()()),o&2){let t=m().$implicit;l(5),M(t.code),l(2),M(t.name)}}function ct(o,s){o&1&&(a(0,"div",38)(1,"p",43),d(2,"No hay clasificaciones de este tipo a\xFAn"),r()())}function pt(o,s){if(o&1&&(a(0,"div",32)(1,"div",33)(2,"div",34)(3,"p",35),d(4),r(),a(5,"p",36),d(6),r()(),a(7,"span",37),d(8),r()(),h(9,dt,8,2,"div",38)(10,ct,3,0,"div",38),r()),o&2){let t=s.$implicit,n=m(2);S("border-blue-200",t.count>0)("dark:border-blue-900",t.count>0)("border-gray-200",t.count===0)("dark:border-gray-700",t.count===0)("opacity-60",t.count===0),l(3),S("text-blue-700",t.count>0)("dark:text-blue-300",t.count>0)("text-gray-500",t.count===0)("dark:text-gray-500",t.count===0),l(),E(" ",t.type," "),l(2),M(n.getTypeLabel(t.type)),l(),S("bg-blue-100",t.count>0)("dark:bg-blue-900/50",t.count>0)("text-blue-700",t.count>0)("dark:text-blue-300",t.count>0)("bg-gray-100",t.count===0)("dark:bg-gray-700",t.count===0)("text-gray-500",t.count===0)("dark:text-gray-400",t.count===0),l(),xe(" ",t.count," ",t.count===1?"clasificaci\xF3n":"clasificaciones"," "),l(),y(t.count>0?9:10)}}function mt(o,s){if(o&1&&(a(0,"div",22)(1,"div",27),x(2,"lucide-angular",28),a(3,"span",29),d(4,"Tipos de Clasificaci\xF3n en el Sistema:"),r()(),a(5,"div",30),D(6,pt,11,39,"div",31,rt),r()()),o&2){let t=m();l(2),g("size",16),l(4),V(t.typeExamples())}}function gt(o,s){o&1&&(a(0,"div",23)(1,"div",44),x(2,"lucide-angular",18),a(3,"span",45),d(4,"No hay clasificaciones existentes para mostrar como ejemplo."),r()()()),o&2&&(l(2),g("size",16))}function ut(o,s){o&1&&(x(0,"div",46),d(1," Creando... "))}function ft(o,s){o&1&&(x(0,"lucide-angular",47),d(1," Crear Categor\xEDa ")),o&2&&g("size",18)}var Ne=(()=>{let s=class s{constructor(){this.typifications=[],this.save=new U,this.cancel=new U,this.form={code:"",name:"",description:""},this.saving=w(!1),this.errors=w({}),this.typeExamples=w([])}ngOnInit(){this.buildTypeExamples()}ngOnChanges(n){n.typifications&&n.typifications.currentValue&&this.buildTypeExamples()}buildTypeExamples(){let n=new Map;Object.values(N).forEach(e=>{n.set(e,{codes:[],names:[],count:0})}),this.typifications.forEach(e=>{let p=e.classificationType;if(n.has(p)){let c=n.get(p);c.count++,c.codes.length<1&&(c.codes.push(e.code),c.names.push(e.name))}});let i=[];n.forEach((e,p)=>{i.push({type:p,code:e.codes[0]||"-",name:e.names[0]||"Sin ejemplos disponibles",count:e.count})}),this.typeExamples.set(i)}getTypeLabel(n){return{[N.CONTACT_RESULT]:"Resultado de Contacto",[N.MANAGEMENT_TYPE]:"Tipo de Gesti\xF3n",[N.PAYMENT_TYPE]:"Tipo de Pago",[N.COMPLAINT_TYPE]:"Tipo de Reclamo",[N.PAYMENT_SCHEDULE]:"Cronograma de Pagos",[N.CUSTOM]:"Personalizado"}[n]}validate(){let n={};return this.form.code.trim()?/^[A-Z_]+$/.test(this.form.code.trim())||(n.code="El c\xF3digo debe contener solo MAY\xDASCULAS y guiones bajos"):n.code="El c\xF3digo es requerido",this.form.name.trim()||(n.name="El nombre es requerido"),this.errors.set(n),Object.keys(n).length===0}onSave(){this.validate()&&(this.saving.set(!0),setTimeout(()=>{this.saving.set(!1),alert(`\u26A0\uFE0F Funcionalidad pendiente:

Para crear categor\xEDas din\xE1micamente, necesitas:

1. Backend: Crear tabla 'classification_types' en la BD
2. Backend: API REST para CRUD de tipos
3. Frontend: Actualizar enum ClassificationType din\xE1micamente

Por ahora, las categor\xEDas son enums fijos en el c\xF3digo.

Categor\xEDa a crear:
C\xF3digo: ${this.form.code}
Nombre: ${this.form.name}`),this.save.emit(this.form.name)},1e3))}onCancel(){this.cancel.emit()}};s.\u0275fac=function(i){return new(i||s)},s.\u0275cmp=O({type:s,selectors:[["app-category-form-dialog"]],inputs:{typifications:"typifications"},outputs:{save:"save",cancel:"cancel"},features:[_e],decls:54,vars:17,consts:[[1,"fixed","inset-0","bg-black/50","dark:bg-black/70","flex","items-center","justify-center","z-50","p-4","transition-opacity","duration-300",3,"click"],[1,"bg-white","dark:bg-slate-900","rounded-lg","shadow-2xl","max-w-2xl","w-full","max-h-[90vh]","overflow-auto","transition-all","duration-300","transform",3,"click"],[1,"sticky","top-0","bg-gradient-to-r","from-purple-600","to-purple-700","dark:from-purple-700","dark:to-purple-800","text-white","px-6","py-4","flex","items-center","justify-between","rounded-t-lg","z-10"],[1,"text-xl","font-bold"],[1,"text-sm","text-purple-100","dark:text-purple-200"],[1,"p-2","hover:bg-white/20","rounded-lg","transition-colors",3,"click"],["name","x",3,"size"],[1,"p-6","space-y-6"],[1,"bg-yellow-50","dark:bg-yellow-900/20","border-l-4","border-yellow-500","p-4","rounded"],[1,"flex","items-start","gap-3"],["name","alert-circle",1,"text-yellow-600","dark:text-yellow-400","flex-shrink-0","mt-0.5",3,"size"],[1,"text-sm","text-yellow-800","dark:text-yellow-200"],[1,"font-bold","mb-1"],[1,"block","text-sm","font-bold","text-gray-700","dark:text-gray-200","mb-2"],[1,"text-red-500"],["type","text","placeholder","Ej: CUSTOM_TYPE, NEW_CATEGORY","maxlength","50",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","uppercase","text-sm","font-mono",3,"ngModelChange","ngModel"],[1,"text-red-500","text-xs","mt-1"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1","flex","items-center","gap-1"],["name","info",3,"size"],["type","text","placeholder","Ej: M\xE9todo de Pago, Resultado de Llamada","maxlength","100",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","text-sm",3,"ngModelChange","ngModel"],[1,"text-xs","font-normal","text-gray-500","dark:text-gray-400","ml-1"],["rows","3","placeholder","Describe el prop\xF3sito de esta categor\xEDa y cu\xE1ndo debe ser usada...",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","text-sm",3,"ngModelChange","ngModel"],[1,"bg-blue-50","dark:bg-blue-950/30","border","border-blue-200","dark:border-blue-900/50","rounded-lg","p-4"],[1,"bg-yellow-50","dark:bg-yellow-950/30","border","border-yellow-200","dark:border-yellow-900/50","rounded-lg","p-4"],[1,"sticky","bottom-0","bg-gray-50","dark:bg-slate-800","px-6","py-4","flex","justify-end","gap-3","rounded-b-lg","border-t","border-gray-200","dark:border-gray-700"],[1,"px-6","py-2.5","text-gray-700","dark:text-gray-200","bg-white","dark:bg-slate-700","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-50","dark:hover:bg-slate-600","font-semibold","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],[1,"px-6","py-2.5","bg-gradient-to-r","from-purple-600","to-purple-700","hover:from-purple-700","hover:to-purple-800","disabled:from-gray-400","disabled:to-gray-500","text-white","rounded-lg","font-semibold","transition-all","shadow-md","hover:shadow-lg","flex","items-center","gap-2","text-sm",3,"click","disabled"],[1,"flex","items-center","gap-2","text-blue-800","dark:text-blue-200","mb-3"],["name","settings",3,"size"],[1,"font-bold","text-sm"],[1,"grid","grid-cols-1","gap-2","text-xs"],[1,"bg-white","dark:bg-slate-800","p-3","rounded","border",3,"border-blue-200","dark:border-blue-900","border-gray-200","dark:border-gray-700","opacity-60"],[1,"bg-white","dark:bg-slate-800","p-3","rounded","border"],[1,"flex","items-start","justify-between","mb-1"],[1,"flex-1"],[1,"font-mono","font-bold","mb-1"],[1,"text-gray-600","dark:text-gray-400","font-medium"],[1,"px-2","py-1","rounded","text-xs","font-semibold"],[1,"mt-2","pt-2","border-t","border-gray-200","dark:border-gray-700"],[1,"text-gray-500","dark:text-gray-400","text-xs","mb-1"],[1,"flex","items-center","gap-2"],[1,"font-mono","text-xs","bg-gray-100","dark:bg-gray-700","px-2","py-1","rounded","text-gray-700","dark:text-gray-300"],[1,"text-gray-600","dark:text-gray-400"],[1,"text-gray-400","dark:text-gray-500","text-xs","italic"],[1,"flex","items-center","gap-2","text-yellow-800","dark:text-yellow-200"],[1,"text-sm"],[1,"w-4","h-4","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],["name","save",3,"size"]],template:function(i,e){i&1&&(a(0,"div",0),_("click",function(){return e.onCancel()}),a(1,"div",1),_("click",function(c){return c.stopPropagation()}),a(2,"div",2)(3,"div")(4,"h2",3),d(5,"Nueva Categor\xEDa de Clasificaci\xF3n"),r(),a(6,"p",4),d(7," Crea un nuevo tipo de clasificaci\xF3n personalizado "),r()(),a(8,"button",5),_("click",function(){return e.onCancel()}),x(9,"lucide-angular",6),r()(),a(10,"div",7)(11,"div",8)(12,"div",9),x(13,"lucide-angular",10),a(14,"div",11)(15,"p",12),d(16,"\u26A0\uFE0F Advertencia Importante"),r(),a(17,"p"),d(18,"Las categor\xEDas son tipos de clasificaci\xF3n a nivel de sistema. Una vez creadas, no se pueden eliminar f\xE1cilmente ya que pueden estar siendo usadas por m\xFAltiples tipificaciones."),r()()()(),a(19,"div")(20,"label",13),d(21," C\xF3digo de Categor\xEDa "),a(22,"span",14),d(23,"*"),r()(),a(24,"input",15),T("ngModelChange",function(c){return v(e.form.code,c)||(e.form.code=c),c}),r(),h(25,lt,2,1,"p",16),a(26,"p",17),x(27,"lucide-angular",18),d(28," Usa MAY\xDASCULAS y guiones bajos (snake_case). Ejemplo: PAYMENT_METHOD, CALL_RESULT "),r()(),a(29,"div")(30,"label",13),d(31," Nombre Descriptivo "),a(32,"span",14),d(33,"*"),r()(),a(34,"input",19),T("ngModelChange",function(c){return v(e.form.name,c)||(e.form.name=c),c}),r(),h(35,st,2,1,"p",16),a(36,"p",17),x(37,"lucide-angular",18),d(38," Este ser\xE1 el nombre que ver\xE1n los usuarios en la interfaz "),r()(),a(39,"div")(40,"label",13),d(41," Descripci\xF3n "),a(42,"span",20),d(43,"(Opcional)"),r()(),a(44,"textarea",21),T("ngModelChange",function(c){return v(e.form.description,c)||(e.form.description=c),c}),r()(),h(45,mt,8,1,"div",22)(46,gt,5,1,"div",23),r(),a(47,"div",24)(48,"button",25),_("click",function(){return e.onCancel()}),x(49,"lucide-angular",6),d(50," Cancelar "),r(),a(51,"button",26),_("click",function(){return e.onSave()}),h(52,ut,2,0)(53,ft,2,1),r()()()()),i&2&&(l(9),g("size",24),l(4),g("size",20),l(11),S("border-red-500",e.errors().code),C("ngModel",e.form.code),l(),y(e.errors().code?25:-1),l(2),g("size",12),l(7),S("border-red-500",e.errors().name),C("ngModel",e.form.name),l(),y(e.errors().name?35:-1),l(2),g("size",12),l(7),C("ngModel",e.form.description),l(),y(e.typeExamples().length>0?45:46),l(4),g("size",18),l(2),g("disabled",e.saving()),l(),y(e.saving()?52:53))},dependencies:[I,W,q,$,ee,L,z,B],encapsulation:2});let o=s;return o})();var _t=(o,s,t)=>({node:o,depth:0,index:s,siblings:t,parent:null}),xt=(o,s,t,n,i)=>({node:o,depth:s,index:t,siblings:n,parent:i}),Oe=(o,s)=>s.typification.id;function bt(o,s){o&1&&(a(0,"div",2)(1,"div",31)(2,"div")(3,"div",32),d(4,"\xA1Cambio Guardado!"),r(),a(5,"div",33),d(6,"La configuraci\xF3n se actualiz\xF3 correctamente"),r()()()())}function ht(o,s){o&1&&(a(0,"span",13),d(1,"OSCURO"),r())}function yt(o,s){o&1&&(a(0,"span",14),d(1,"CLARO"),r())}function Ct(o,s){if(o&1&&(a(0,"option",20),d(1),r()),o&2){let t=s.$implicit;g("ngValue",t.id),l(),E(" ",t.tenantName," ")}}function vt(o,s){if(o&1){let t=k();a(0,"div")(1,"div",18),d(2,"Cliente"),r(),a(3,"select",19),T("ngModelChange",function(i){u(t);let e=m();return v(e.selectedTenantId,i)||(e.selectedTenantId=i),f(i)}),_("change",function(){u(t);let i=m();return f(i.onTenantChange())}),J(4,Ct,2,2,"option",21),r()(),x(5,"div",34)}if(o&2){let t=m();l(3),C("ngModel",t.selectedTenantId),l(),g("ngForOf",t.tenants)}}function Tt(o,s){if(o&1&&(a(0,"option",20),d(1),r()),o&2){let t=s.$implicit;g("ngValue",t.id),l(),E(" ",t.portfolioName," ")}}function wt(o,s){if(o&1){let t=k();a(0,"div")(1,"div",18),d(2,"Cartera"),r(),a(3,"select",35),T("ngModelChange",function(i){u(t);let e=m();return v(e.selectedPortfolioId,i)||(e.selectedPortfolioId=i),f(i)}),_("change",function(){u(t);let i=m();return f(i.onPortfolioChange())}),a(4,"option",20),d(5,"Todas las Carteras"),r(),J(6,Tt,2,2,"option",21),r()(),x(7,"div",34)}if(o&2){let t=m();l(3),C("ngModel",t.selectedPortfolioId),l(),g("ngValue",void 0),l(2),g("ngForOf",t.portfolios)}}function kt(o,s){if(o&1&&(a(0,"option",20),d(1),r()),o&2){let t=s.$implicit,n=m();g("ngValue",t),l(),E(" ",n.getTypeLabel(t)," ")}}function Et(o,s){if(o&1){let t=k();a(0,"app-typification-form-dialog",36),_("save",function(i){u(t);let e=m();return f(e.onClassificationSaved(i))})("cancel",function(){u(t);let i=m();return f(i.closeClassificationDialog())}),r()}if(o&2){let t=m();g("mode",t.classificationDialogMode())("typification",t.selectedClassificationForEdit())("parentClassification",t.parentClassificationForCreate())("defaultType",t.selectedType)("tenantId",t.selectedTenantId)("portfolioId",t.selectedPortfolioId)}}function St(o,s){if(o&1){let t=k();a(0,"app-category-form-dialog",37),_("save",function(i){u(t);let e=m();return f(e.onCategorySaved(i))})("cancel",function(){u(t);let i=m();return f(i.closeCategoryDialog())}),r()}if(o&2){let t=m();g("typifications",t.typifications)}}function Mt(o,s){o&1&&(a(0,"div",29)(1,"div",38),x(2,"div",39),a(3,"p",40),d(4,"Cargando tipificaciones..."),r()()())}function Ft(o,s){o&1&&(a(0,"div",42)(1,"p",44),d(2,"No hay tipificaciones configuradas"),r(),a(3,"p",45),d(4,"Comienza creando tu primera tipificaci\xF3n"),r()())}function Dt(o,s){if(o&1&&le(0,46),o&2){let t=s.$implicit,n=s.$index,i=m(3),e=se(48);g("ngTemplateOutlet",e)("ngTemplateOutletContext",be(2,_t,t,n,i.treeNodes))}}function Vt(o,s){if(o&1&&(a(0,"div",43),D(1,Dt,1,6,"ng-container",46,Oe),r()),o&2){let t=m(2);l(),V(t.treeNodes)}}function At(o,s){if(o&1&&(a(0,"div",30)(1,"div",41),h(2,Ft,5,0,"div",42)(3,Vt,3,0,"div",43),r()()),o&2){let t=m();l(2),y(t.treeNodes.length===0?2:3)}}function Pt(o,s){}function Nt(o,s){}function Ot(o,s){if(o&1){let t=k();a(0,"button",69),_("click",function(i){u(t);let e=m().node;return m().toggleNode(e.typification.id),f(i.stopPropagation())}),h(1,Pt,0,0)(2,Nt,0,0),r()}if(o&2){let t=m().node,n=m();l(),y(n.isExpanded(t.typification.id)?1:2)}}function It(o,s){o&1&&x(0,"div",54)}function zt(o,s){o&1&&(a(0,"div",60),d(1," Cust "),r())}function $t(o,s){if(o&1&&le(0,46),o&2){let t=s.$implicit,n=s.$index,i=m(2),e=i.node,p=i.depth;m();let c=se(48);g("ngTemplateOutlet",c)("ngTemplateOutletContext",he(2,xt,t,p+1,n,e.children,e))}}function Lt(o,s){if(o&1&&(a(0,"div",68),D(1,$t,1,8,"ng-container",46,Oe),r()),o&2){let t=m().node;l(),V(t.children)}}function Wt(o,s){if(o&1){let t=k();a(0,"div",47)(1,"div",48)(2,"div",49)(3,"div",50)(4,"button",51),_("click",function(i){let e=u(t),p=e.node,c=e.index,b=e.siblings,F=e.parent;return m().moveUp(p,b,c,F),f(i.stopPropagation())}),d(5," \u25B2 "),r(),a(6,"button",52),_("click",function(i){let e=u(t),p=e.node,c=e.index,b=e.siblings,F=e.parent;return m().moveDown(p,b,c,F),f(i.stopPropagation())}),d(7," \u25BC "),r()(),h(8,Ot,3,1,"button",53)(9,It,1,0,"div",54),a(10,"div",55),d(11),r(),a(12,"div",56)(13,"div",57),d(14),r(),a(15,"div",58),d(16),r()(),a(17,"div",59),d(18),r(),h(19,zt,2,0,"div",60),r(),a(20,"div",61)(21,"label",62),_("click",function(i){return u(t),f(i.stopPropagation())}),a(22,"input",63),_("change",function(i){let e=u(t).node;return m().toggleTypification(e,i),f(i.stopPropagation())}),r(),x(23,"div",64),r(),a(24,"button",65),_("click",function(i){let e=u(t).node;return m().openCreateChildDialog(e.typification),f(i.stopPropagation())}),r(),a(25,"button",66),_("click",function(i){let e=u(t).node;return m().openEditDialog(e.typification),f(i.stopPropagation())}),r(),a(26,"button",67),_("click",function(i){let e=u(t).node;return m().deleteTypification(e.typification),f(i.stopPropagation())}),r()()(),h(27,Lt,3,0,"div",68),r()}if(o&2){let t=s.node,n=s.depth,i=s.index,e=s.siblings,p=m();j("margin-left",n*16,"px"),l(),S("bg-green-50",t.config==null?null:t.config.isEnabled)("dark:bg-green-950/40",t.config==null?null:t.config.isEnabled)("hover:bg-green-100",t.config==null?null:t.config.isEnabled)("dark:hover:bg-green-900/50",t.config==null?null:t.config.isEnabled)("bg-slate-100",!(t.config!=null&&t.config.isEnabled))("dark:bg-slate-800/50",!(t.config!=null&&t.config.isEnabled))("hover:bg-slate-200",!(t.config!=null&&t.config.isEnabled))("dark:hover:bg-slate-700/50",!(t.config!=null&&t.config.isEnabled))("border-l-green-500",t.config==null?null:t.config.isEnabled)("dark:border-l-green-600",t.config==null?null:t.config.isEnabled)("border-l-slate-400",!(t.config!=null&&t.config.isEnabled))("dark:border-l-slate-600",!(t.config!=null&&t.config.isEnabled)),l(3),S("opacity-30",i===0)("cursor-not-allowed",i===0),g("disabled",i===0),l(2),S("opacity-30",i===e.length-1)("cursor-not-allowed",i===e.length-1),g("disabled",i===e.length-1),l(2),y(t.children&&t.children.length>0?8:9),l(2),j("background-color",t.typification.colorHex||"#6B7280"),l(),E(" ",(t.typification.code==null?null:t.typification.code.substring(0,2))||"NA"," "),l(3),E(" ",(t.config==null?null:t.config.effectiveName)||t.typification.name," "),l(2),E(" ",p.getTypeLabel(t.typification.classificationType)," "),l(2),E(" N",t.level," "),l(),y(t.config!=null&&t.config.customName?19:-1),l(2),g("title",t.config!=null&&t.config.isEnabled?"Desactivar visualizaci\xF3n":"Activar visualizaci\xF3n"),l(),g("checked",(t.config==null?null:t.config.isEnabled)===!0),l(4),S("opacity-30",t.typification.isSystem)("cursor-not-allowed",t.typification.isSystem),g("disabled",t.typification.isSystem),l(),y(p.isExpanded(t.typification.id)&&t.children&&t.children.length>0?27:-1)}}var Di=(()=>{let s=class s{constructor(n,i){this.classificationService=n,this.themeService=i,this.loading=w(!1),this.showSuccess=w(!1),this.showClassificationDialog=w(!1),this.showCategoryDialog=w(!1),this.classificationDialogMode=w("create"),this.selectedClassificationForEdit=w(void 0),this.parentClassificationForCreate=w(void 0),this.classificationTypes=Object.values(P),this.typifications=[],this.tenantConfigs=[],this.treeNodes=[],this.expandedNodes=new Set,this.tenants=[],this.portfolios=[]}ngOnInit(){this.loadTenants()}loadTenants(){this.classificationService.getAllTenants().subscribe({next:n=>{this.tenants=n,n.length>0&&(this.selectedTenantId=n[0].id,this.onTenantChange())},error:n=>{console.error("Error loading tenants:",n)}})}onTenantChange(){this.selectedPortfolioId=void 0,this.portfolios=[],this.typifications=[],this.treeNodes=[],this.selectedTenantId&&(this.loadPortfolios(),this.loadTypifications())}loadPortfolios(){this.selectedTenantId&&this.classificationService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:n=>{this.portfolios=n},error:n=>{console.error("Error loading portfolios:",n)}})}loadTypifications(){if(!this.selectedTenantId)return;this.loading.set(!0),(this.selectedType?this.classificationService.getTenantClassificationsByType(this.selectedTenantId,this.selectedType,this.selectedPortfolioId):this.classificationService.getTenantClassifications(this.selectedTenantId,this.selectedPortfolioId,!0)).subscribe({next:i=>{this.tenantConfigs=i,this.typifications=i.map(e=>e.tipificacion),this.buildTree(),this.loading.set(!1)},error:i=>{this.loading.set(!1),console.error("Error loading typifications:",i)}})}loadTenantConfigs(){if(!this.selectedTenantId)return;(this.selectedType?this.classificationService.getTenantClassificationsByType(this.selectedTenantId,this.selectedType,this.selectedPortfolioId):this.classificationService.getTenantClassifications(this.selectedTenantId,this.selectedPortfolioId)).subscribe({next:i=>{this.tenantConfigs=i,this.buildTree(),this.loading.set(!1)},error:i=>{console.error("Error loading tenant configs:",i),this.buildTree(),this.loading.set(!1)}})}buildTree(){let n=new Map;this.tenantConfigs.forEach(c=>{n.set(c.tipificacion.id,c)});let i=new Map;this.typifications.forEach(c=>{let b={typification:c,config:n.get(c.id),children:[],level:c.nivelJerarquia};i.set(c.id,b)});let e=[];this.typifications.forEach(c=>{let b=i.get(c.id),F=c.tipificacionPadre?.id;if(F){let A=i.get(F);A&&A.children.push(b)}else e.push(b)});let p=c=>{c.sort((b,F)=>{let A=b.typification.ordenVisualizacion||0,oe=F.typification.ordenVisualizacion||0;return A-oe}),c.forEach(b=>{b.children.length>0&&p(b.children)})};p(e),this.treeNodes=e,this.expandAll()}toggleNode(n){this.expandedNodes.has(n)?this.expandedNodes.delete(n):this.expandedNodes.add(n)}isExpanded(n){return this.expandedNodes.has(n)}expandAll(){this.typifications.forEach(n=>this.expandedNodes.add(n.id))}collapseAll(){this.expandedNodes.clear()}onTypeChange(){this.loadTypifications()}onPortfolioChange(){this.loadTypifications()}toggleTypification(n,i){if(!this.selectedTenantId)return;let e=i.target,p=e.checked;(p?this.classificationService.enableClassification(this.selectedTenantId,n.typification.id,this.selectedPortfolioId):this.classificationService.disableClassification(this.selectedTenantId,n.typification.id,this.selectedPortfolioId)).subscribe({next:()=>{this.showSuccessMessage(),this.loadTypifications()},error:b=>{console.error("Error toggling typification:",b),e.checked=!p}})}toggleDarkMode(){this.themeService.toggleTheme()}openCreateRootDialog(){this.classificationDialogMode.set("create"),this.selectedClassificationForEdit.set(void 0),this.parentClassificationForCreate.set(void 0),this.showClassificationDialog.set(!0)}openCreateChildDialog(n){this.classificationDialogMode.set("create"),this.selectedClassificationForEdit.set(void 0),this.parentClassificationForCreate.set(n),this.showClassificationDialog.set(!0)}openEditDialog(n){this.classificationDialogMode.set("edit"),this.selectedClassificationForEdit.set(n),this.parentClassificationForCreate.set(void 0),this.showClassificationDialog.set(!0)}closeClassificationDialog(){this.showClassificationDialog.set(!1),this.selectedClassificationForEdit.set(void 0),this.parentClassificationForCreate.set(void 0)}onClassificationSaved(n){this.showClassificationDialog.set(!1),this.selectedClassificationForEdit.set(void 0),this.parentClassificationForCreate.set(void 0),this.showSuccessMessage(),this.loadTypifications()}deleteTypification(n){if(n.esSistema){alert("No se pueden eliminar tipificaciones del sistema");return}confirm(`\xBFEst\xE1 seguro de eliminar la tipificaci\xF3n "${n.nombre}"?

Esta acci\xF3n no se puede deshacer.`)&&this.classificationService.deleteTypification(n.id).subscribe({next:()=>{this.showSuccessMessage(),this.loadTypifications()},error:i=>{console.error("Error al eliminar tipificaci\xF3n:",i),alert("Error al eliminar la tipificaci\xF3n. Puede que tenga dependencias.")}})}showSuccessMessage(){this.showSuccess.set(!0),setTimeout(()=>this.showSuccess.set(!1),3e3)}openCreateCategoryDialog(){this.showCategoryDialog.set(!0)}closeCategoryDialog(){this.showCategoryDialog.set(!1)}onCategorySaved(n){this.showCategoryDialog.set(!1),this.showSuccessMessage(),this.classificationTypes=Object.values(P)}getTypeLabel(n){return{[P.RESULTADO_CONTACTO]:"Resultado de Contacto",[P.TIPO_GESTION]:"Tipo de Gesti\xF3n",[P.MODALIDAD_PAGO]:"Modalidad de Pago",[P.TIPO_FRACCIONAMIENTO]:"Tipo de Fraccionamiento"}[n]}moveUp(n,i,e,p){e!==0&&([i[e-1],i[e]]=[i[e],i[e-1]],this.updateOrder(i))}moveDown(n,i,e,p){e!==i.length-1&&([i[e],i[e+1]]=[i[e+1],i[e]],this.updateOrder(i))}updateOrder(n){let i=n.map((e,p)=>({id:e.typification.id,ordenVisualizacion:p*10}));console.warn("updateOrder: endpoint no implementado en V2",i),this.showSuccessMessage()}};s.\u0275fac=function(i){return new(i||s)(X(ne),X(Fe))},s.\u0275cmp=O({type:s,selectors:[["app-typification-maintenance"]],decls:49,vars:13,consts:[["treeNodeTemplate",""],[1,"h-[100dvh]","bg-gradient-to-br","from-slate-50","via-blue-50","to-slate-100","dark:from-slate-950","dark:via-gray-950","dark:to-black","flex","flex-col","overflow-hidden","transition-colors","duration-300"],[1,"fixed","top-4","right-4","z-50","animate-[slideInRight_0.5s_ease-out]"],[1,"bg-gradient-to-r","from-slate-900","via-blue-900","to-slate-900","dark:from-slate-950","dark:via-blue-950","dark:to-slate-950","text-white","shadow-md","relative","overflow-hidden"],[1,"relative","px-3","py-1"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","gap-1.5"],[1,"bg-blue-500","dark:bg-blue-600","p-1","rounded"],[1,"text-sm","font-bold"],[1,"text-[9px]","text-blue-200","dark:text-blue-300","flex","items-center","gap-0.5"],[1,"flex","items-center","gap-2"],["title","Cambiar tema",3,"click"],[1,"text-[10px]","text-yellow-300","font-semibold"],[1,"text-[10px]","text-white","font-semibold"],[1,"bg-white","dark:bg-slate-900","border-b","border-blue-400","dark:border-slate-700","shadow-sm","relative","overflow-hidden","transition-colors","duration-300"],[1,"absolute","inset-0","bg-gradient-to-r","from-blue-50","dark:from-blue-950/50","to-transparent","opacity-50"],[1,"flex","items-center","gap-3","text-xs"],[1,"text-[9px]","text-gray-500","dark:text-white","uppercase","font-semibold"],[1,"text-xs","font-semibold","text-gray-800","dark:text-white","bg-transparent","border-none","focus:outline-none","cursor-pointer",3,"ngModelChange","change","ngModel"],[1,"bg-white","dark:bg-slate-800",3,"ngValue"],["class","bg-white dark:bg-slate-800",3,"ngValue",4,"ngFor","ngForOf"],[1,"flex","gap-2"],[1,"px-3","py-1","text-[10px]","bg-purple-600","hover:bg-purple-700","text-white","rounded","font-semibold","transition-colors","flex","items-center","gap-1",3,"click"],[1,"text-sm"],[1,"px-3","py-1","text-[10px]","bg-blue-600","hover:bg-blue-700","text-white","rounded","font-semibold","transition-colors","flex","items-center","gap-1",3,"click"],[1,"px-2","py-1","text-[10px]","text-slate-600","dark:text-slate-300","hover:text-blue-600","dark:hover:text-blue-400","hover:bg-blue-50","dark:hover:bg-blue-950/30","rounded","transition-colors","font-semibold",3,"click"],[3,"mode","typification","parentClassification","defaultType","tenantId","portfolioId"],[3,"typifications"],[1,"flex-1","flex","items-center","justify-center"],[1,"flex-1","overflow-auto","p-2"],[1,"bg-gradient-to-r","from-green-500","to-emerald-600","text-white","px-6","py-4","rounded-lg","shadow-2xl","flex","items-center","gap-3"],[1,"font-bold"],[1,"text-sm","opacity-90"],[1,"h-6","w-px","bg-gray-200","dark:bg-gray-700"],[1,"font-semibold","text-gray-800","dark:text-white","text-[10px]","bg-transparent","border-none","focus:outline-none","cursor-pointer",3,"ngModelChange","change","ngModel"],[3,"save","cancel","mode","typification","parentClassification","defaultType","tenantId","portfolioId"],[3,"save","cancel","typifications"],[1,"text-center"],[1,"inline-block","animate-spin","rounded-full","h-12","w-12","border-4","border-blue-500","border-t-transparent"],[1,"mt-4","text-slate-600","dark:text-slate-300","font-semibold"],[1,"typification-tree-container","bg-white","dark:bg-slate-900","rounded-lg","shadow-md","p-2","transition-colors","duration-300","border","border-slate-200","dark:border-slate-800"],[1,"text-center","py-20"],[1,"space-y-1"],[1,"text-slate-500","dark:text-slate-400","text-lg","font-semibold","mb-2"],[1,"text-slate-400","dark:text-slate-500","text-sm","mb-6"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"typification-item-wrapper"],[1,"typification-item","flex","items-center","justify-between","px-2","py-1.5","rounded","border-l-3","transition-colors","mb-1"],[1,"flex","items-center","gap-2","flex-1","min-w-0"],[1,"flex-shrink-0","flex","flex-col","gap-0.5"],["title","Subir",1,"w-5","h-5","flex","items-center","justify-center","text-slate-500","dark:text-slate-400","hover:text-blue-600","dark:hover:text-blue-400","hover:bg-blue-50","dark:hover:bg-blue-900/30","rounded","transition-colors","disabled:hover:bg-transparent","disabled:hover:text-slate-500","font-bold","text-xs",3,"click","disabled"],["title","Bajar",1,"w-5","h-5","flex","items-center","justify-center","text-slate-500","dark:text-slate-400","hover:text-blue-600","dark:hover:text-blue-400","hover:bg-blue-50","dark:hover:bg-blue-900/30","rounded","transition-colors","disabled:hover:bg-transparent","disabled:hover:text-slate-500","font-bold","text-xs",3,"click","disabled"],[1,"flex-shrink-0","w-5","h-5","flex","items-center","justify-center","text-slate-600","dark:text-slate-300","hover:bg-slate-200","dark:hover:bg-slate-700","rounded","transition-colors"],[1,"w-5","flex-shrink-0"],[1,"flex-shrink-0","w-6","h-6","rounded","flex","items-center","justify-center","text-white","text-[10px]","font-bold"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-slate-800","dark:text-slate-100","text-xs","truncate"],[1,"text-[9px]","text-slate-500","dark:text-slate-400","truncate"],[1,"flex-shrink-0","px-1.5","py-0.5","bg-blue-100","dark:bg-blue-900/40","text-blue-700","dark:text-blue-300","rounded","text-[9px]","font-bold"],[1,"flex-shrink-0","px-1.5","py-0.5","bg-orange-100","dark:bg-orange-900/40","text-orange-700","dark:text-orange-300","rounded","text-[9px]","font-bold"],[1,"flex","items-center","gap-1.5","ml-2","flex-shrink-0"],[1,"relative","inline-flex","items-center","cursor-pointer",3,"click","title"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-8","h-4","bg-gray-300","dark:bg-gray-600","peer-focus:outline-none","peer-focus:ring-2","peer-focus:ring-blue-500","rounded-full","peer","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-3","after:w-3","after:transition-all","peer-checked:bg-green-500"],["title","Agregar hijo",1,"w-5","h-5","flex","items-center","justify-center","text-green-600","dark:text-green-400","hover:bg-green-100","dark:hover:bg-green-900/30","rounded","transition-colors",3,"click"],["title","Editar",1,"w-5","h-5","flex","items-center","justify-center","text-blue-600","dark:text-blue-400","hover:bg-blue-100","dark:hover:bg-blue-900/30","rounded","transition-colors",3,"click"],["title","Eliminar",1,"w-5","h-5","flex","items-center","justify-center","text-red-600","dark:text-red-400","hover:bg-red-100","dark:hover:bg-red-900/30","rounded","transition-colors","disabled:hover:bg-transparent",3,"click","disabled"],[1,"mt-1","space-y-1"],[1,"flex-shrink-0","w-5","h-5","flex","items-center","justify-center","text-slate-600","dark:text-slate-300","hover:bg-slate-200","dark:hover:bg-slate-700","rounded","transition-colors",3,"click"]],template:function(i,e){if(i&1){let p=k();a(0,"div",1),h(1,bt,7,0,"div",2),a(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div")(7,"div",7),x(8,"div",8),a(9,"div")(10,"h1",9),d(11,"Mantenimiento de Tipificaciones"),r(),a(12,"p",10),d(13," Configuraci\xF3n de clasificaciones "),r()()()()(),a(14,"div",11)(15,"button",12),_("click",function(){return u(p),f(e.toggleDarkMode())}),h(16,ht,2,0,"span",13)(17,yt,2,0,"span",14),r()()()()(),a(18,"div",15),x(19,"div",16),a(20,"div",4)(21,"div",5)(22,"div",17),h(23,vt,6,2),h(24,wt,8,3),a(25,"div")(26,"div",18),d(27,"Tipo"),r(),a(28,"select",19),T("ngModelChange",function(b){return u(p),v(e.selectedType,b)||(e.selectedType=b),f(b)}),_("change",function(){return u(p),f(e.onTypeChange())}),a(29,"option",20),d(30,"Todos"),r(),J(31,kt,2,2,"option",21),r()()(),a(32,"div",22)(33,"button",23),_("click",function(){return u(p),f(e.openCreateCategoryDialog())}),a(34,"span",24),d(35,"+"),r(),d(36," Nueva Categor\xEDa "),r(),a(37,"button",25),_("click",function(){return u(p),f(e.openCreateRootDialog())}),d(38," Nueva Tipificaci\xF3n "),r(),a(39,"button",26),_("click",function(){return u(p),f(e.expandAll())}),d(40," Expandir todo "),r(),a(41,"button",26),_("click",function(){return u(p),f(e.collapseAll())}),d(42," Contraer todo "),r()()()()(),h(43,Et,1,6,"app-typification-form-dialog",27),h(44,St,1,1,"app-category-form-dialog",28),h(45,Mt,5,0,"div",29),h(46,At,4,1,"div",30),r(),J(47,Wt,28,52,"ng-template",null,0,ye)}i&2&&(l(),y(e.showSuccess()?1:-1),l(14),Z("flex items-center gap-1.5 px-2 py-1.5 rounded-lg transition-all duration-300 group border "+(e.themeService.isDarkMode()?"bg-yellow-500/20 hover:bg-yellow-500/30 border-yellow-500/40":"bg-blue-500/90 hover:bg-blue-600 border-blue-600")),l(),y(e.themeService.isDarkMode()?16:17),l(7),y(e.tenants.length>0?23:-1),l(),y(e.portfolios.length>0?24:-1),l(4),C("ngModel",e.selectedType),l(),g("ngValue",void 0),l(2),g("ngForOf",e.classificationTypes),l(12),y(e.showClassificationDialog()?43:-1),l(),y(e.showCategoryDialog()?44:-1),l(),y(e.loading()?45:-1),l(),y(e.loading()?-1:46))},dependencies:[I,ve,Te,W,Y,H,G,$,L,z,Pe,Ne],styles:[".classification-item[_ngcontent-%COMP%]{transition:transform .15s ease,box-shadow .15s ease;position:relative}.classification-item[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 4px #00000014}.dark[_nghost-%COMP%]   .classification-item[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .classification-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000004d}"]});let o=s;return o})();export{Di as TypificationMaintenanceComponent};
