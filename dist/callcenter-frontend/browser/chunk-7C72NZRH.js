import{a as re,b as y}from"./chunk-UNUS4HMI.js";import{A as ee,F as te,c as J,e as P,f as K,g as Q,h as A,j as M,l as W,o as X,r as Z}from"./chunk-7GV7UZOL.js";import{$b as k,_b as U}from"./chunk-W3UIH3CO.js";import{a as Y}from"./chunk-YQKVMPSG.js";import{I as _,Lb as d,Mb as i,Nb as o,Ob as m,T as G,Vb as j,Xb as b,Zb as f,a as R,ab as l,b as B,ca as N,dd as H,ed as O,ga as z,gb as v,jc as T,lc as s,mc as h,md as x,na as S,nb as p,nc as C,oa as F,oc as V,s as D,sb as g,sd as $,ud as q,vb as L}from"./chunk-SN4XSKG7.js";function pe(n,r){n&1&&(i(0,"tr",5)(1,"td",6)(2,"div",7),m(3,"lucide-icon",8),i(4,"span"),s(5,"No hay registros en la blacklist"),o()()()())}function ge(n,r){if(n&1&&(i(0,"tr",9)(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td"),s(6),o(),i(7,"td"),s(8),o(),i(9,"td"),s(10),o(),i(11,"td"),s(12),o()()),n&2){let c=r.$implicit;l(2),h(c.empresa),l(2),h(c.documento),l(2),h(c.email),l(2),h(c.telefono),l(2),h(c.fechaInicio),l(2),h(c.fechaFin)}}function fe(n,r){if(n&1){let c=j();i(0,"div",10)(1,"button",11),b("click",function(){S(c);let t=f();return F(t.previousPage())}),m(2,"lucide-icon",12),s(3," Anterior "),o(),i(4,"span",13),s(5),o(),i(6,"button",11),b("click",function(){S(c);let t=f();return F(t.nextPage())}),s(7," Siguiente "),m(8,"lucide-icon",14),o()()}if(n&2){let c=f();l(),d("disabled",c.currentPage===1),l(4),V(" P\xE1gina ",c.currentPage," de ",c.totalPages," "),l(),d("disabled",c.currentPage===c.totalPages)}}var ne=(()=>{let r=class r{constructor(){this.blacklistRows=[],this.currentPage=1,this.rowsPerPage=10}get paginatedRows(){let e=(this.currentPage-1)*this.rowsPerPage;return this.blacklistRows.slice(e,e+this.rowsPerPage)}get totalPages(){return Math.ceil(this.blacklistRows.length/this.rowsPerPage)}goToPage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}previousPage(){this.currentPage>1&&this.currentPage--}};r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=p({type:r,selectors:[["app-blacklist-table"]],inputs:{blacklistRows:"blacklistRows"},decls:20,vars:3,consts:[[1,"table-container"],[1,"blacklist-table"],["class","empty-row",4,"ngIf"],["class","data-row",4,"ngFor","ngForOf"],["class","pagination",4,"ngIf"],[1,"empty-row"],["colspan","6",1,"empty-cell"],[1,"empty-state"],["name","inbox"],[1,"data-row"],[1,"pagination"],[1,"pagination-btn",3,"click","disabled"],["name","chevron-left","size","18"],[1,"pagination-info"],["name","chevron-right","size","18"]],template:function(t,a){t&1&&(i(0,"div",0)(1,"table",1)(2,"thead")(3,"tr")(4,"th"),s(5,"Empresa"),o(),i(6,"th"),s(7,"Documento"),o(),i(8,"th"),s(9,"Email"),o(),i(10,"th"),s(11,"Tel\xE9fono"),o(),i(12,"th"),s(13,"Fecha de Inicio"),o(),i(14,"th"),s(15,"Fecha de Fin"),o()()(),i(16,"tbody"),g(17,pe,6,0,"tr",2)(18,ge,13,6,"tr",3),o()(),g(19,fe,9,4,"div",4),o()),t&2&&(l(17),d("ngIf",a.blacklistRows.length===0),l(),d("ngForOf",a.paginatedRows),l(),d("ngIf",a.blacklistRows.length>0))},dependencies:[x,H,O,k,U],styles:["body.light-theme[_nghost-%COMP%], body.light-theme   [_nghost-%COMP%]{--bg-primary: #ffffff;--text-primary: #2c3e50;--text-secondary: #7f8c8d;--border-color: #ddd;--hover-bg: #f8f9fa;--header-bg: #f5f5f5;--button-hover: #e0e0e0}body.dark-theme[_nghost-%COMP%], body.dark-theme   [_nghost-%COMP%]{--bg-primary: #1e1e1e;--text-primary: #e0e0e0;--text-secondary: #a8a8a8;--border-color: #444;--hover-bg: #2d2d2d;--header-bg: #2a2a2a;--button-hover: #3a3a3a}.table-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:1rem;padding:1.5rem;border-radius:8px;background:var(--bg-primary)}.blacklist-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.95rem;background-color:var(--bg-primary);border-radius:4px;overflow:hidden}.blacklist-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:var(--header-bg);border-bottom:2px solid var(--border-color)}.blacklist-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-weight:600;color:var(--text-primary);white-space:nowrap}.blacklist-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid var(--border-color);transition:background-color .2s ease}.blacklist-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.data-row[_ngcontent-%COMP%]:hover{background-color:var(--hover-bg)}.blacklist-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.empty-row[_ngcontent-%COMP%]   .empty-cell[_ngcontent-%COMP%]{padding:3rem 1rem!important}.empty-row[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.5rem;color:var(--text-secondary)}.empty-row[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   lucide-icon[_ngcontent-%COMP%]{width:48px;height:48px;opacity:.5}.empty-row[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-style:italic;font-size:.95rem}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:1rem;padding:1rem 0;border-top:1px solid var(--border-color);flex-wrap:wrap}.pagination-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.625rem 1.25rem;background-color:var(--header-bg);color:var(--text-primary);border:1px solid var(--border-color);border-radius:4px;cursor:pointer;font-size:.9rem;font-weight:500;transition:all .2s ease;white-space:nowrap}.pagination-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--button-hover);transform:translateY(-1px);border-color:var(--text-primary)}.pagination-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.pagination-btn[_ngcontent-%COMP%]   lucide-icon[_ngcontent-%COMP%]{width:18px;height:18px}.pagination-info[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.9rem;min-width:150px;text-align:center}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]{padding:1rem}.blacklist-table[_ngcontent-%COMP%]{font-size:.85rem}.blacklist-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .blacklist-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem}.pagination[_ngcontent-%COMP%]{flex-wrap:wrap;gap:.5rem}.pagination-btn[_ngcontent-%COMP%]{padding:.5rem .75rem;font-size:.85rem}.pagination-info[_ngcontent-%COMP%]{min-width:120px}}"]});let n=r;return n})();var I=(()=>{let r=class r{constructor(e){this.http=e,this.baseUrl=Y.webServiceUrl+"/blacklist",this.httpOptions={headers:new $({"Content-Type":"application/json"})}}handleError(e){let t="Ocurri\xF3 un error desconocido.";return typeof e.error=="string"?t=e.error:e.error&&e.error.message&&(t=e.error.message),console.error(`C\xF3digo de error: ${e.status}, mensaje: ${t}`),D(()=>({status:e.status,message:t}))}insertBlacklist(e){return this.http.post(this.baseUrl,e,B(R({},this.httpOptions),{responseType:"text"})).pipe(_(t=>this.handleError(t)))}getAllBlacklist(){return this.http.get(this.baseUrl+"/all",this.httpOptions).pipe(G(2),_(e=>this.handleError(e)))}getEntidadByDocumento(e){return this.http.get(this.baseUrl+"/entidad/"+e,{responseType:"text"}).pipe(_(t=>this.handleError(t)))}};r.\u0275fac=function(t){return new(t||r)(z(q))},r.\u0275prov=N({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();function be(n,r){if(n&1&&(i(0,"span",11),s(1),o()),n&2){let c=f();l(),C(" ",c.getFieldError("selectedProveedor")," ")}}function he(n,r){if(n&1&&(i(0,"span",11),s(1),o()),n&2){let c=f();l(),C(" ",c.getFieldError("documento")," ")}}function ve(n,r){if(n&1&&(i(0,"span",11),s(1),o()),n&2){let c=f();l(),C(" ",c.getFieldError("fechaFin")," ")}}function xe(n,r){n&1&&(i(0,"span"),s(1,"Guardar"),o())}function Pe(n,r){n&1&&(i(0,"span"),s(1,"Guardando..."),o())}var ie=(()=>{let r=class r{constructor(e,t){this.blacklistService=e,this.toastService=t,this.blacklistAdded=new L,this.formGroup=new A({}),this.proveedores=[],this.isLoading=!1}ngOnInit(){this.initializeForm(),this.loadProveedores()}initializeForm(){this.formGroup=new A({selectedProveedor:new M(null,P.required),documento:new M("",[P.required,P.pattern(/^\d+$/)]),fechaFin:new M("",[P.required,this.validateFutureDate.bind(this)])})}loadProveedores(){this.proveedores=[{label:"FINANCIERA OH",value:"FINANCIERA_OH"},{label:"TRAMO PROPIO",value:"TRAMO_PROPIO"}]}validateFutureDate(e){if(!e.value)return null;let t=new Date(e.value),a=new Date;return a.setHours(0,0,0,0),t<a?{fechaInvalida:!0}:null}insertarBlacklist(){if(!this.formGroup.valid){this.formGroup.markAllAsTouched(),this.toastService.error("Por favor completa todos los campos requeridos");return}let e=this.formGroup.value.selectedProveedor,t=this.formGroup.value.documento,a=new Date(this.formGroup.value.fechaFin).toISOString().split("T")[0];this.isLoading=!0,e==="TRAMO_PROPIO"?this.blacklistService.getEntidadByDocumento(t).subscribe({next:u=>{this.procesarBlacklist(e,t,a,u)},error:u=>{this.isLoading=!1,this.toastService.error(u?.message||"Documento no encontrado en Tramo Propio")}}):this.procesarBlacklist(e,t,a,"FUNO")}procesarBlacklist(e,t,a,u){let{cartera:le,subcartera:se}=this.mapProveedorToConfig(e),ce={empresa:e,cartera:le,subcartera:se,documento:t,fechaFin:a,entidad:u};this.blacklistService.insertBlacklist(ce).subscribe({next:()=>{let E=new Date().toISOString().split("T")[0];this.toastService.success(`Cliente DNI: ${t} agregado a Blacklist (${E} - ${a})`),this.formGroup.reset(),this.blacklistAdded.emit(),this.isLoading=!1},error:E=>{let de=E?.message||"Error al agregar a la blacklist";this.toastService.error(de),this.isLoading=!1}})}mapProveedorToConfig(e){return e==="FINANCIERA_OH"?{cartera:"FO_TRAMO 5",subcartera:"FO_TRAMO_5"}:{cartera:"TRAMO_PROPIO",subcartera:"TRAMO_PROPIO"}}getFieldError(e){let t=this.formGroup.get(e);if(t?.errors&&(t?.touched||t?.dirty)){if(t.errors.required)return"Este campo es requerido";if(t.errors.pattern)return"Solo se permiten n\xFAmeros";if(t.errors.fechaInvalida)return"La fecha debe ser igual o mayor a hoy"}return""}isFieldInvalid(e){let t=this.formGroup.get(e);return!!(t?.invalid&&(t?.touched||t?.dirty))}};r.\u0275fac=function(t){return new(t||r)(v(I),v(y))},r.\u0275cmp=p({type:r,selectors:[["app-add-blacklist-form"]],outputs:{blacklistAdded:"blacklistAdded"},decls:19,vars:12,consts:[[1,"form-container",3,"formGroup"],[1,"form-group"],["for","proveedor",1,"form-label"],["formControlName","selectedProveedor","placeholder","Selecciona un proveedor","id","proveedor",3,"options"],["class","error-message",4,"ngIf"],["for","documento",1,"form-label"],["type","text","id","documento","formControlName","documento","placeholder","Ingresa el documento","maxlength","20",1,"form-input"],["for","fechaFin",1,"form-label"],["type","date","id","fechaFin","formControlName","fechaFin",1,"form-input"],["type","button",1,"btn","btn-submit",3,"click","disabled"],[4,"ngIf"],[1,"error-message"]],template:function(t,a){t&1&&(i(0,"form",0)(1,"div",1)(2,"label",2),s(3,"Proveedor *"),o(),m(4,"app-custom-select",3),g(5,be,2,1,"span",4),o(),i(6,"div",1)(7,"label",5),s(8,"Documento *"),o(),m(9,"input",6),g(10,he,2,1,"span",4),o(),i(11,"div",1)(12,"label",7),s(13,"Fecha de Fin *"),o(),m(14,"input",8),g(15,ve,2,1,"span",4),o(),i(16,"button",9),b("click",function(){return a.insertarBlacklist()}),g(17,xe,2,0,"span",10)(18,Pe,2,0,"span",10),o()()),t&2&&(d("formGroup",a.formGroup),l(4),d("options",a.proveedores),l(),d("ngIf",a.isFieldInvalid("selectedProveedor")),l(4),T("invalid",a.isFieldInvalid("documento")),l(),d("ngIf",a.isFieldInvalid("documento")),l(4),T("invalid",a.isFieldInvalid("fechaFin")),l(),d("ngIf",a.isFieldInvalid("fechaFin")),l(),d("disabled",!a.formGroup.valid||a.isLoading),l(),d("ngIf",!a.isLoading),l(),d("ngIf",a.isLoading))},dependencies:[x,O,te,W,J,K,Q,ee,X,Z,re,k],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;padding:2rem;border-radius:8px;background:var(--color-surface);border:1px solid var(--color-border);box-shadow:0 1px 3px #0000001a}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-label[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text-primary);font-size:.95rem}.form-input[_ngcontent-%COMP%]{padding:.75rem 1rem;border:1px solid var(--color-border);border-radius:4px;font-size:1rem;background:var(--color-input-bg);color:var(--color-text-primary);transition:border-color .3s ease,box-shadow .3s ease}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 2px #3b82f61a}.form-input.invalid[_ngcontent-%COMP%]{border-color:var(--color-error);background-color:#ef44440d}.form-input.invalid[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 2px #ef44441a}.form-input[_ngcontent-%COMP%]::placeholder{color:var(--color-text-secondary)}.error-message[_ngcontent-%COMP%]{font-size:.85rem;color:var(--color-error);margin-top:.25rem}.btn[_ngcontent-%COMP%]{padding:.875rem 1.5rem;border:none;border-radius:4px;font-weight:600;font-size:1rem;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:.5rem}.btn.btn-submit[_ngcontent-%COMP%]{background:var(--color-primary);color:#fff}.btn.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--color-primary-dark);box-shadow:0 4px 6px #3b82f64d}.btn.btn-submit[_ngcontent-%COMP%]:disabled{background:var(--color-disabled);cursor:not-allowed;opacity:.6}.dark[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]{background:var(--color-surface-dark);border-color:var(--color-border-dark)}.dark[_nghost-%COMP%]   .form-label[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .form-label[_ngcontent-%COMP%]{color:var(--color-text-primary-dark)}.dark[_nghost-%COMP%]   .form-input[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .form-input[_ngcontent-%COMP%]{background:var(--color-input-bg-dark);color:var(--color-text-primary-dark);border-color:var(--color-border-dark)}.dark[_nghost-%COMP%]   .form-input[_ngcontent-%COMP%]::placeholder, .dark   [_nghost-%COMP%]   .form-input[_ngcontent-%COMP%]::placeholder{color:var(--color-text-secondary-dark)}"]});let n=r;return n})();var ae=(()=>{let r=class r{constructor(e,t){this.blacklistService=e,this.toastService=t,this.blacklistRows=[]}ngOnInit(){this.loadBlacklistRows()}loadBlacklistRows(){this.blacklistService.getAllBlacklist().subscribe({next:e=>{this.blacklistRows=e},error:e=>{console.error("Error al obtener la lista de blacklists",e),this.toastService.error("Error al cargar la blacklist")}})}};r.\u0275fac=function(t){return new(t||r)(v(I),v(y))},r.\u0275cmp=p({type:r,selectors:[["app-blacklist-page"]],decls:9,vars:1,consts:[[1,"blacklist-container"],[1,"header-section"],[1,"content-section"],[1,"form-wrapper"],[3,"blacklistAdded"],[1,"table-wrapper"],[3,"blacklistRows"]],template:function(t,a){t&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),s(3,"Gesti\xF3n de Blacklist"),o()(),i(4,"div",2)(5,"div",3)(6,"app-add-blacklist-form",4),b("blacklistAdded",function(){return a.loadBlacklistRows()}),o()(),i(7,"div",5),m(8,"app-blacklist-table",6),o()()()),t&2&&(l(8),d("blacklistRows",a.blacklistRows))},dependencies:[x,ie,ne],styles:["body.light-theme[_nghost-%COMP%], body.light-theme   [_nghost-%COMP%]{--bg-primary: #ffffff;--bg-secondary: #f5f5f5;--text-primary: #2c3e50;--text-secondary: #7f8c8d;--border-color: #ddd;--shadow: rgba(0, 0, 0, .1)}body.dark-theme[_nghost-%COMP%], body.dark-theme   [_nghost-%COMP%]{--bg-primary: #1e1e1e;--bg-secondary: #0f0f0f;--text-primary: #e0e0e0;--text-secondary: #a8a8a8;--border-color: #444;--shadow: rgba(0, 0, 0, .3)}.blacklist-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;padding:2rem;margin-top:5rem;margin-bottom:2rem;background-color:var(--bg-secondary);min-height:calc(100vh - 7rem)}.header-section[_ngcontent-%COMP%]{max-width:1350px;margin:0 auto;width:100%}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:700;color:var(--text-primary);letter-spacing:-.5px}.content-section[_ngcontent-%COMP%]{max-width:1350px;margin:0 auto;width:100%;display:flex;flex-direction:column;gap:1.5rem}.form-wrapper[_ngcontent-%COMP%]{background-color:var(--bg-primary);border-radius:8px;box-shadow:0 2px 8px var(--shadow);overflow:hidden}.table-wrapper[_ngcontent-%COMP%]{background-color:var(--bg-primary);border-radius:8px;box-shadow:0 2px 8px var(--shadow);overflow-x:auto}@media (max-width: 768px){.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}}@media (max-width: 1024px){.blacklist-container[_ngcontent-%COMP%]{gap:1.5rem;padding:1.5rem}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}}@media (max-width: 768px){.blacklist-container[_ngcontent-%COMP%]{padding:1rem;margin-top:4rem;gap:1rem}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.35rem}.content-section[_ngcontent-%COMP%]{gap:1rem}.form-wrapper[_ngcontent-%COMP%], .table-wrapper[_ngcontent-%COMP%]{border-radius:6px}}@media (max-width: 480px){.blacklist-container[_ngcontent-%COMP%]{padding:.75rem;margin-top:3.5rem}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.25rem}}"]});let n=r;return n})();var $e=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=p({type:r,selectors:[["app-blacklist"]],decls:1,vars:0,template:function(t,a){t&1&&m(0,"app-blacklist-page")},dependencies:[ae],encapsulation:2});let n=r;return n})();export{$e as BlacklistComponent};
