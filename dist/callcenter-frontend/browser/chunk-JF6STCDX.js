import{a as h}from"./chunk-YQKVMPSG.js";import{$ as p,R as o,S as u,U as a,X as c,g as r,nd as l,x as n}from"./chunk-FJ3LLV4S.js";var f=(()=>{let i=class i{constructor(t){this.http=t,this.apiUrl=`${h.gatewayUrl}/agent-status`,this.currentStatusSubject=new r(null),this.currentStatus$=this.currentStatusSubject.asObservable()}getAgentStatus(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(a(e=>{let m={idUsuario:e.idUsuario,estadoActual:e.estadoActual,estadoAnterior:e.estadoAnterior,timestampCambio:e.timestampCambio,tiempoEnEstadoMinutos:e.tiempoEnEstadoMinutos,notas:e.notas,sessionId:e.sessionId,segundosEnEstado:e.segundosEnEstado,colorIndicador:e.colorIndicador,porcentajeTiempo:e.porcentajeTiempo,excedeTiempoMaximo:e.excedeTiempoMaximo,tiempoMaximoSegundos:e.tiempoMaximoSegundos};this.currentStatusSubject.next(m)}))}changeStatus(t,e){return this.http.post(`${this.apiUrl}/${t}/cambiar-estado`,e).pipe(a(()=>{this.getAgentStatus(t).subscribe()}))}enterManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/entrar`,{}).pipe(a(()=>{this.getAgentStatus(t).subscribe()}))}exitManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/salir`,{}).pipe(a(()=>{this.getAgentStatus(t).subscribe()}))}getAvailableStates(){return this.http.get(`${this.apiUrl}/estados-disponibles`)}isAvailableForCalls(t){return this.http.get(`${this.apiUrl}/${t}/disponible-para-llamadas`)}startStatusPolling(t){return n(1e4).pipe(o(0),u(()=>this.getAgentStatus(t)))}clearCurrentStatus(){this.currentStatusSubject.next(null)}disconnectAgent(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(a(()=>{console.log(`[AgentStatusService] Agente ${t} marcado como desconectado`),this.currentStatusSubject.next(null)}))}getCurrentStatus(){return this.currentStatusSubject.value}finalizarTipificacion(t){return this.http.post(`${this.apiUrl}/${t}/sistema/finalizar-tipificacion`,{}).pipe(a(()=>{console.log(`[AgentStatusService] Tipificaci\xF3n finalizada para agente ${t}`),this.getAgentStatus(t).subscribe()}))}};i.\u0275fac=function(e){return new(e||i)(p(l))},i.\u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"});let s=i;return s})();export{f as a};
