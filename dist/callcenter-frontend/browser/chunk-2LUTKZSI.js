import{a as de,b as ce,c as me,d as pe,e as fe,f as ue,g as ge}from"./chunk-NIO5S27B.js";import"./chunk-DWS5BGBU.js";import"./chunk-JTEH3MVW.js";import"./chunk-WVFOCL7M.js";import{F as ne,G as ae}from"./chunk-FXKBI65G.js";import"./chunk-54NZV4UM.js";import{a as le,b as se}from"./chunk-FDTCQU4U.js";import{A as re,F as oe,c as Q,d as y,f as X,g as Z,h as j,j as M,l as ee,o as te,r as ie}from"./chunk-YEUR475X.js";import{Ob as C,Pb as E}from"./chunk-4F672BDH.js";import{a as K}from"./chunk-DF6EJM3T.js";import{I as D,Mb as d,Nb as n,Ob as o,Pb as m,T as H,Wb as U,Yb as x,_b as h,a as V,b as $,bb as a,da as P,ed as W,fd as w,ha as I,hb as u,kc as G,ld as b,mc as s,nc as p,oa as B,ob as v,oc as S,pa as N,rd as Y,s as R,tb as g,td as J,wb as q}from"./chunk-QOPKCBWK.js";function ye(r,i){r&1&&(n(0,"tr")(1,"td",10)(2,"div",11),m(3,"lucide-angular",12),n(4,"span",13),s(5,"No hay registros en la blacklist"),o()()()()),r&2&&(a(3),d("size",48))}function _e(r,i){if(r&1&&(n(0,"tr",14)(1,"td",15),s(2),o(),n(3,"td",16),s(4),o(),n(5,"td",15),s(6),o(),n(7,"td",15),s(8),o(),n(9,"td",15),s(10),o(),n(11,"td",15),s(12),o()()),r&2){let c=i.$implicit;a(2),p(c.empresa),a(2),p(c.documento),a(2),p(c.email||"-"),a(2),p(c.telefono||"-"),a(2),p(c.fechaInicio),a(2),p(c.fechaFin)}}function Pe(r,i){if(r&1){let c=U();n(0,"div",17)(1,"button",18),x("click",function(){B(c);let t=h();return N(t.previousPage())}),m(2,"lucide-angular",19),s(3," Anterior "),o(),n(4,"span",20),s(5," P\xE1gina "),n(6,"span",21),s(7),o(),s(8," de "),n(9,"span",21),s(10),o()(),n(11,"button",18),x("click",function(){B(c);let t=h();return N(t.nextPage())}),s(12," Siguiente "),m(13,"lucide-angular",22),o()()}if(r&2){let c=h();a(),d("disabled",c.currentPage===1),a(),d("size",16),a(5),p(c.currentPage),a(3),p(c.totalPages),a(),d("disabled",c.currentPage===c.totalPages),a(2),d("size",16)}}var ve=(()=>{let i=class i{constructor(){this.blacklistRows=[],this.currentPage=1,this.rowsPerPage=10}get paginatedRows(){let e=(this.currentPage-1)*this.rowsPerPage;return this.blacklistRows.slice(e,e+this.rowsPerPage)}get totalPages(){return Math.ceil(this.blacklistRows.length/this.rowsPerPage)}goToPage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}previousPage(){this.currentPage>1&&this.currentPage--}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=v({type:i,selectors:[["app-blacklist-table"]],inputs:{blacklistRows:"blacklistRows"},decls:22,vars:3,consts:[[1,"space-y-3"],[1,"overflow-hidden","rounded-lg","border","border-slate-700","bg-slate-900"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-slate-800","border-b","border-slate-700"],[1,"px-4","py-3","text-left","text-xs","font-semibold","text-slate-300","uppercase","tracking-wider"],[1,"divide-y","divide-slate-700"],[4,"ngIf"],["class","hover:bg-slate-800/50 transition-colors",4,"ngFor","ngForOf"],["class","flex items-center justify-between px-2",4,"ngIf"],["colspan","6",1,"px-4","py-12","text-center"],[1,"flex","flex-col","items-center","gap-2","text-slate-500"],["name","inbox",3,"size"],[1,"text-sm"],[1,"hover:bg-slate-800/50","transition-colors"],[1,"px-4","py-3","text-sm","text-slate-200"],[1,"px-4","py-3","text-sm","text-slate-200","font-mono"],[1,"flex","items-center","justify-between","px-2"],[1,"inline-flex","items-center","gap-1.5","px-3","py-2","bg-slate-800","hover:bg-slate-700","text-slate-300","text-sm","rounded","border","border-slate-600","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"click","disabled"],["name","chevron-left",3,"size"],[1,"text-sm","text-slate-400"],[1,"font-semibold","text-slate-200"],["name","chevron-right",3,"size"]],template:function(t,l){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead",4)(5,"tr")(6,"th",5),s(7,"Empresa"),o(),n(8,"th",5),s(9,"Documento"),o(),n(10,"th",5),s(11,"Email"),o(),n(12,"th",5),s(13,"Tel\xE9fono"),o(),n(14,"th",5),s(15,"Fecha Inicio"),o(),n(16,"th",5),s(17,"Fecha Fin"),o()()(),n(18,"tbody",6),g(19,ye,6,1,"tr",7)(20,_e,13,6,"tr",8),o()()()(),g(21,Pe,14,6,"div",9),o()),t&2&&(a(19),d("ngIf",l.blacklistRows.length===0),a(),d("ngForOf",l.paginatedRows),a(),d("ngIf",l.blacklistRows.length>0))},dependencies:[b,W,w,E,C],encapsulation:2});let r=i;return r})();var F=(()=>{let i=class i{constructor(e){this.http=e,this.baseUrl=K.webServiceUrl+"/blacklist",this.templateCanEdit=!1,this.httpOptions={headers:new Y({"Content-Type":"application/json"})}}handleError(e){let t="Ocurri\xF3 un error desconocido.";return typeof e.error=="string"?t=e.error:e.error&&e.error.message&&(t=e.error.message),console.error(`C\xF3digo de error: ${e.status}, mensaje: ${t}`),R(()=>({status:e.status,message:t}))}handleErrorGet(e){return typeof ErrorEvent<"u"&&e.error instanceof ErrorEvent?console.log(`An error occurred ${e.status}, body was: ${e.error.message}`):console.log(`Backend returned code ${e.status}, body was: ${e.error.message}`),R(()=>({status:e.status,message:e.error.message}))}insertBlacklist(e){return this.http.post(this.baseUrl,e,$(V({},this.httpOptions),{responseType:"text"})).pipe(D(this.handleError))}getAllBlacklist(){return this.http.get(this.baseUrl+"/all",this.httpOptions).pipe(H(2),D(this.handleErrorGet))}};i.\u0275fac=function(t){return new(t||i)(I(J))},i.\u0275prov=P({token:i,factory:i.\u0275fac,providedIn:"root"});let r=i;return r})();function Se(r,i){if(r&1&&(n(0,"p",10),s(1),o()),r&2){let c=h();a(),p(c.data.details)}}var Ee=(()=>{let i=class i{constructor(e,t){this.dialogRef=e,this.data=t}close(){this.dialogRef.close()}};i.\u0275fac=function(t){return new(t||i)(u(de),u(ce))},i.\u0275cmp=v({type:i,selectors:[["app-error-modal"]],decls:14,vars:5,consts:[[1,"error-modal"],[1,"error-header"],[1,"error-icon-container"],["name","alert-circle",1,"error-icon",3,"size"],["mat-dialog-title",""],[1,"error-message"],["class","error-details",4,"ngIf"],["align","end"],["mat-raised-button","","color","primary",3,"click"],["name","x",3,"size"],[1,"error-details"]],template:function(t,l){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),m(3,"lucide-angular",3),o(),n(4,"h2",4),s(5),o()(),n(6,"mat-dialog-content")(7,"p",5),s(8),o(),g(9,Se,2,1,"p",6),o(),n(10,"mat-dialog-actions",7)(11,"button",8),x("click",function(){return l.close()}),m(12,"lucide-angular",9),s(13," Cerrar "),o()()()),t&2&&(a(3),d("size",48),a(2),p(l.data.title||"Error"),a(3),p(l.data.message),a(),d("ngIf",l.data.details),a(3),d("size",18))},dependencies:[b,w,ge,pe,ue,fe,ae,ne,E,C],styles:[".error-modal[_ngcontent-%COMP%]{min-width:400px;max-width:500px;padding:24px;background:#fff;border-radius:12px}.error-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;margin-bottom:24px;text-align:center}.error-icon-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:80px;height:80px;background:linear-gradient(135deg,#ef4444,#dc2626);border-radius:50%;animation:_ngcontent-%COMP%_pulse 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1);box-shadow:0 0 #ef4444b3}50%{transform:scale(1.05);box-shadow:0 0 0 10px #ef444400}}.error-icon[_ngcontent-%COMP%]{color:#fff;width:48px;height:48px}h2[_ngcontent-%COMP%]{margin:0;color:#1f2937;font-size:24px;font-weight:600}mat-dialog-content[_ngcontent-%COMP%]{padding:0 8px;margin-bottom:24px}.error-message[_ngcontent-%COMP%]{font-size:16px;color:#4b5563;line-height:1.6;margin:0 0 12px;text-align:center}.error-details[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;background:#f3f4f6;padding:12px;border-radius:8px;margin:0;border-left:3px solid #ef4444;font-family:Courier New,monospace;white-space:pre-wrap;word-break:break-word}mat-dialog-actions[_ngcontent-%COMP%]{padding:0;margin:0;display:flex;justify-content:center}button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 24px;font-size:14px;font-weight:500;border-radius:8px;transition:all .3s ease}button[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #00000026}"]});let r=i;return r})();var O=(()=>{let i=class i{constructor(e){this.dialog=e}showError(e,t,l){let k={data:{title:t||"Error",message:e,details:l},panelClass:"error-modal-panel",backdropClass:"error-modal-backdrop",disableClose:!1,hasBackdrop:!0,width:"500px",maxWidth:"90vw"};this.dialog.open(Ee,k)}showConnectionError(){this.showError("No se pudo conectar con el servidor. Por favor, verifica tu conexi\xF3n a internet e intenta nuevamente.","Error de Conexi\xF3n")}showValidationError(e){this.showError(e,"Error de Validaci\xF3n")}showServerError(e){this.showError("Ocurri\xF3 un error en el servidor. Por favor, intenta nuevamente m\xE1s tarde.","Error del Servidor",e)}};i.\u0275fac=function(t){return new(t||i)(I(me))},i.\u0275prov=P({token:i,factory:i.\u0275fac,providedIn:"root"});let r=i;return r})();function Me(r,i){if(r&1&&(n(0,"span",13),s(1),o()),r&2){let c=h();a(),S(" ",c.getFieldError("selectedProveedor")," ")}}function Fe(r,i){if(r&1&&(n(0,"span",13),s(1),o()),r&2){let c=h();a(),S(" ",c.getFieldError("documento")," ")}}function Oe(r,i){if(r&1&&(n(0,"span",13),s(1),o()),r&2){let c=h();a(),S(" ",c.getFieldError("fechaFin")," ")}}function Te(r,i){r&1&&(n(0,"span"),s(1,"Agregar"),o())}function Ae(r,i){r&1&&(n(0,"span"),s(1,"Guardando..."),o())}var we=(()=>{let i=class i{constructor(e,t,l){this.blacklistService=e,this.toastService=t,this.errorModalService=l,this.blacklistAdded=new q,this.formGroup=new j({}),this.proveedores=[],this.isLoading=!1}ngOnInit(){this.initializeForm(),this.loadProveedores()}initializeForm(){this.formGroup=new j({selectedProveedor:new M(null,y.required),documento:new M("",[y.required,y.pattern(/^\d+$/)]),fechaFin:new M("",[y.required,this.validateFutureDate.bind(this)])})}loadProveedores(){this.proveedores=[{label:"FINANCIERA OH",value:"FINANCIERA_OH"},{label:"PROVEEDOR",value:"PROVEEDOR"}]}validateFutureDate(e){if(!e.value)return null;let t=new Date(e.value),l=new Date;return l.setHours(0,0,0,0),t<l?{fechaInvalida:!0}:null}insertarBlacklist(){if(!this.formGroup.valid){this.formGroup.markAllAsTouched(),this.toastService.error("Por favor completa todos los campos requeridos");return}let e=this.formGroup.value.selectedProveedor,{cartera:t,subcartera:l,entidad:k}=this.mapProveedorToConfig(e),z=new Date(this.formGroup.value.fechaFin).toISOString().split("T")[0],L=this.formGroup.value.documento,Ce={empresa:e,cartera:t,subcartera:l,documento:L,fechaFin:z,entidad:k};this.isLoading=!0,this.blacklistService.insertBlacklist(Ce).subscribe({next:()=>{let f=new Date().toISOString().split("T")[0];this.toastService.success(`Cliente DNI: ${L} agregado a Blacklist (${f} - ${z})`),this.formGroup.reset(),this.blacklistAdded.emit(),this.isLoading=!1},error:f=>{this.isLoading=!1;let T="Error al agregar a la blacklist",A;f?.error?.message?T=f.error.message:f?.message&&(T=f.message),f?.error?.details?A=f.error.details:f?.status&&(A=`C\xF3digo de error: ${f.status}`),this.errorModalService.showError(T,"Error al agregar a Blacklist",A)}})}mapProveedorToConfig(e){return e==="FINANCIERA_OH"?{cartera:"FO_TRAMO 5",subcartera:"FO_TRAMO_5",entidad:"FUNO"}:{cartera:"PROVEEDOR",subcartera:"PROVEEDOR",entidad:"PROVEEDOR"}}getFieldError(e){let t=this.formGroup.get(e);if(t?.errors&&(t?.touched||t?.dirty)){if(t.errors.required)return"Este campo es requerido";if(t.errors.pattern)return"Solo se permiten n\xFAmeros";if(t.errors.fechaInvalida)return"La fecha debe ser igual o mayor a hoy"}return""}isFieldInvalid(e){let t=this.formGroup.get(e);return!!(t?.invalid&&(t?.touched||t?.dirty))}};i.\u0275fac=function(t){return new(t||i)(u(F),u(se),u(O))},i.\u0275cmp=v({type:i,selectors:[["app-add-to-blacklist-form"]],outputs:{blacklistAdded:"blacklistAdded"},decls:21,vars:12,consts:[[1,"space-y-3",3,"formGroup"],[1,"flex","gap-3","items-start"],[1,"flex-1"],["for","proveedor",1,"block","text-xs","text-slate-400","mb-1.5"],["formControlName","selectedProveedor","placeholder","Selecciona un proveedor","id","proveedor",3,"options"],["class","text-xs text-red-400 mt-1 block",4,"ngIf"],["for","documento",1,"block","text-xs","text-slate-400","mb-1.5"],["type","text","id","documento","formControlName","documento","placeholder","Ingresa el documento","maxlength","20",1,"w-full","h-10","px-3","bg-slate-900","border","border-slate-700","rounded","text-slate-100","text-sm","placeholder:text-slate-500","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["for","fechaFin",1,"block","text-xs","text-slate-400","mb-1.5"],["type","date","id","fechaFin","formControlName","fechaFin",1,"w-full","h-10","px-3","bg-slate-900","border","border-slate-700","rounded","text-slate-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],[1,"pt-6"],["type","button",1,"h-10","inline-flex","items-center","gap-1.5","px-4","bg-gradient-to-r","from-red-600","to-red-700","hover:from-red-700","hover:to-red-800","text-white","text-sm","font-medium","rounded","transition-all","shadow-lg","hover:shadow-red-500/50","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"click","disabled"],[4,"ngIf"],[1,"text-xs","text-red-400","mt-1","block"]],template:function(t,l){t&1&&(n(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),s(4,"Proveedor *"),o(),m(5,"app-custom-select",4),g(6,Me,2,1,"span",5),o(),n(7,"div",2)(8,"label",6),s(9,"Documento *"),o(),m(10,"input",7),g(11,Fe,2,1,"span",5),o(),n(12,"div",2)(13,"label",8),s(14,"Fecha de Fin *"),o(),m(15,"input",9),g(16,Oe,2,1,"span",5),o(),n(17,"div",10)(18,"button",11),x("click",function(){return l.insertarBlacklist()}),g(19,Te,2,0,"span",12)(20,Ae,2,0,"span",12),o()()()()),t&2&&(d("formGroup",l.formGroup),a(5),d("options",l.proveedores),a(),d("ngIf",l.isFieldInvalid("selectedProveedor")),a(4),G("border-red-500",l.isFieldInvalid("documento")),a(),d("ngIf",l.isFieldInvalid("documento")),a(4),G("border-red-500",l.isFieldInvalid("fechaFin")),a(),d("ngIf",l.isFieldInvalid("fechaFin")),a(2),d("disabled",!l.formGroup.valid||l.isLoading),a(),d("ngIf",!l.isLoading),a(),d("ngIf",l.isLoading))},dependencies:[b,w,oe,ee,Q,X,Z,re,te,ie,le,E],styles:[".form[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:15px;align-items:center}.form-group[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.fecha-container[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column}.fecha-error[_ngcontent-%COMP%]{font-size:.8rem;color:#f44336;position:absolute;bottom:-35px;left:0}"]});let r=i;return r})();var dt=(()=>{let i=class i{constructor(e,t){this.blacklistService=e,this.errorModalService=t,this.blacklistRows=[]}ngOnInit(){this.loadBlacklistRows()}loadBlacklistRows(){this.blacklistService.getAllBlacklist().subscribe({next:e=>{this.blacklistRows=e},error:e=>{console.error("Error al obtener la lista de blacklists",e);let t="No se pudo cargar la lista de blacklist",l;e?.error?.message?t=e.error.message:e?.message&&(t=e.message),e?.status===0?(t="No se pudo conectar con el servidor",l="Verifica tu conexi\xF3n a internet o contacta al administrador"):e?.status&&(l=`C\xF3digo de error: ${e.status}`),this.errorModalService.showError(t,"Error al cargar Blacklist",l)}})}};i.\u0275fac=function(t){return new(t||i)(u(F),u(O))},i.\u0275cmp=v({type:i,selectors:[["app-blacklist-main-page"]],decls:14,vars:2,consts:[[1,"min-h-screen","bg-slate-950","p-4"],[1,"flex","items-center","gap-2","mb-3"],[1,"w-8","h-8","bg-gradient-to-br","from-red-600","to-red-700","rounded-lg","flex","items-center","justify-center"],["name","shield-ban",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-gray-400"],[1,"section"],[3,"blacklistAdded"],[1,"table-container"],[3,"blacklistRows"]],template:function(t,l){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),m(3,"lucide-angular",3),o(),n(4,"div")(5,"h1",4),s(6,"Blacklist Principal"),o(),n(7,"p",5),s(8,"Gesti\xF3n de contactos bloqueados"),o()()(),n(9,"div",6)(10,"div")(11,"app-add-to-blacklist-form",7),x("blacklistAdded",function(){return l.loadBlacklistRows()}),o()(),n(12,"div",8),m(13,"app-blacklist-table",9),o()()()),t&2&&(a(3),d("size",16),a(10),d("blacklistRows",l.blacklistRows))},dependencies:[b,E,C,we,ve],styles:["body[_ngcontent-%COMP%]{margin-top:7rem;margin-bottom:2rem}.section[_ngcontent-%COMP%]{max-width:1350px;margin:0 auto}.table-container[_ngcontent-%COMP%]{margin-top:2.4rem}"]});let r=i;return r})();export{dt as BlacklistMainPageComponent};
