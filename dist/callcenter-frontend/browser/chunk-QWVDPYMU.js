import{a as z}from"./chunk-BY2DM2ZC.js";import{b as A,e as L,h as j,s as W,u as B}from"./chunk-TFAMJCIP.js";import{$a as D,Cb as V,Db as F,Eb as _,Fb as n,Gb as e,Hb as p,Ob as M,Qb as f,Sb as c,Va as s,_c as I,a as S,b as N,dc as v,ec as l,fc as m,gb as k,gc as P,ja as u,jc as C,ka as g,kc as w,lc as T,ta as h,yb as x,zb as b}from"./chunk-UY3AUK24.js";var q=(r,d)=>d.id;function G(r,d){r&1&&(n(0,"div",23),p(1,"div",26),n(2,"p",27),l(3,"Cargando proveedores..."),e()())}function O(r,d){r&1&&l(0," Intenta con otro t\xE9rmino de b\xFAsqueda ")}function R(r,d){r&1&&l(0," Comienza creando tu primer proveedor ")}function X(r,d){if(r&1&&(n(0,"div",23),p(1,"div",28),n(2,"p",29),l(3,"No se encontraron proveedores"),e(),n(4,"p",30),x(5,O,1,0)(6,R,1,0),e()()),r&2){let a=c();s(5),b(a.searchTerm?5:6)}}function Y(r,d){if(r&1){let a=M();n(0,"tr",35)(1,"td",36)(2,"span",37),l(3),e()(),n(4,"td",36)(5,"span",38),l(6),e()(),n(7,"td",36)(8,"span",6),l(9),e()(),n(10,"td",36)(11,"label",39)(12,"input",40),f("change",function(){let i=u(a).$implicit,o=c(2);return g(o.toggleTenantStatus(i))}),e(),p(13,"div",41),e()(),n(14,"td",36)(15,"div",42)(16,"button",43),f("click",function(){let i=u(a).$implicit,o=c(2);return g(o.editTenant(i))}),e(),n(17,"button",44),f("click",function(){let i=u(a).$implicit,o=c(2);return g(o.deleteTenant(i))}),e()()()()}if(r&2){let a=d.$implicit;s(3),m(a.tenantCode),s(3),m(a.tenantName),s(3),m(a.businessName||"-"),s(3),_("checked",a.isActive),s(5),v(a.hasPortfolios?"text-gray-600 cursor-not-allowed":"text-red-400 hover:bg-slate-800 cursor-pointer"),_("disabled",a.hasPortfolios)("title",a.hasPortfolios?"No se puede eliminar: tiene carteras asociadas":"Eliminar")}}function Z(r,d){if(r&1&&(n(0,"div",24)(1,"table",31)(2,"thead",32)(3,"tr")(4,"th",33),l(5,"C\xF3digo"),e(),n(6,"th",33),l(7,"Nombre"),e(),n(8,"th",33),l(9,"Raz\xF3n Social"),e(),n(10,"th",33),l(11,"Estado"),e(),n(12,"th",33),l(13,"Acciones"),e()()(),n(14,"tbody",34),V(15,Y,18,8,"tr",35,q),e()()()),r&2){let a=c();s(15),F(a.filteredTenants())}}function H(r,d){if(r&1&&(n(0,"p",56),l(1),e()),r&2){let a=c(2);s(),m(a.getCodeErrorMessage())}}function J(r,d){r&1&&(n(0,"p",57),l(1,"C\xF3digo \xFAnico alfanum\xE9rico de m\xE1ximo 3 caracteres (no se puede cambiar despu\xE9s de crear)"),e())}function K(r,d){if(r&1&&(n(0,"p",56),l(1),e()),r&2){let a=c(2);s(),m(a.getNameErrorMessage())}}function Q(r,d){if(r&1&&(n(0,"p",56),l(1),e()),r&2){let a=c(2);s(),m(a.getBusinessNameErrorMessage())}}function U(r,d){r&1&&(n(0,"p",57),l(1,"Nombre legal de la empresa (opcional)"),e())}function $(r,d){if(r&1){let a=M();n(0,"div",25)(1,"div",45)(2,"div",46)(3,"div",2)(4,"div",47),p(5,"div",48),n(6,"div")(7,"h2",49),l(8),e(),n(9,"p",50),l(10,"Complete la informaci\xF3n del proveedor"),e()()(),n(11,"button",51),f("click",function(){u(a);let i=c();return g(i.closeDialog())}),e()()(),n(12,"div",52)(13,"div",53)(14,"div")(15,"label",54),l(16," C\xF3digo del Proveedor * "),e(),n(17,"input",55),T("ngModelChange",function(i){u(a);let o=c();return w(o.formData.tenantCode,i)||(o.formData.tenantCode=i),g(i)}),e(),x(18,H,2,1,"p",56)(19,J,2,0,"p",57),e(),n(20,"div")(21,"label",54),l(22," Nombre del Proveedor * "),e(),n(23,"input",58),T("ngModelChange",function(i){u(a);let o=c();return w(o.formData.tenantName,i)||(o.formData.tenantName=i),g(i)}),e(),x(24,K,2,1,"p",56),e(),n(25,"div")(26,"label",54),l(27," Raz\xF3n Social "),e(),n(28,"input",59),T("ngModelChange",function(i){u(a);let o=c();return w(o.formData.businessName,i)||(o.formData.businessName=i),g(i)}),e(),x(29,Q,2,1,"p",56)(30,U,2,0,"p",57),e()()(),n(31,"div",60)(32,"button",61),f("click",function(){u(a);let i=c();return g(i.closeDialog())}),l(33," Cancelar "),e(),n(34,"button",62),f("click",function(){u(a);let i=c();return g(i.saveTenant())}),l(35),e()()()()}if(r&2){let a=c();s(8),m(a.editingTenant()?"Editar Proveedor":"Nuevo Proveedor"),s(9),v(a.getCodeErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase"),C("ngModel",a.formData.tenantCode),_("disabled",a.editingTenant()!==null),s(),b(a.getCodeErrorMessage()?18:19),s(5),v(a.getNameErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"),C("ngModel",a.formData.tenantName),s(),b(a.getNameErrorMessage()?24:-1),s(4),v(a.getBusinessNameErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"),C("ngModel",a.formData.businessName),s(),b(a.getBusinessNameErrorMessage()?29:30),s(5),_("disabled",!a.canSave()),s(),P(" ",a.editingTenant()?"Guardar Cambios":"Crear Proveedor"," ")}}var le=(()=>{let d=class d{constructor(t){this.typificationService=t,this.tenants=h([]),this.filteredTenants=h([]),this.loading=h(!0),this.showDialog=h(!1),this.editingTenant=h(null),this.searchTerm="",this.formData={tenantCode:"",tenantName:"",businessName:""}}ngOnInit(){this.loadTenants()}loadTenants(){this.loading.set(!0),this.typificationService.getAllTenants().subscribe({next:t=>{this.tenants.set(t),this.filteredTenants.set(t),this.loading.set(!1)},error:t=>{console.error("Error loading tenants:",t),this.loading.set(!1)}})}filterTenants(){let t=this.searchTerm.toLowerCase();if(!t){this.filteredTenants.set(this.tenants());return}let i=this.tenants().filter(o=>o.tenantCode.toLowerCase().includes(t)||o.tenantName.toLowerCase().includes(t)||o.businessName&&o.businessName.toLowerCase().includes(t));this.filteredTenants.set(i)}getActiveTenants(){return this.tenants().filter(t=>t.isActive).length}getInactiveTenants(){return this.tenants().filter(t=>!t.isActive).length}openCreateDialog(){this.editingTenant.set(null),this.formData={tenantCode:"",tenantName:"",businessName:""},this.showDialog.set(!0)}editTenant(t){this.editingTenant.set(t),this.formData={tenantCode:t.tenantCode,tenantName:t.tenantName,businessName:t.businessName||""},this.showDialog.set(!0)}closeDialog(){this.showDialog.set(!1),this.editingTenant.set(null)}canSave(){return!(!this.formData.tenantCode.trim()||!this.formData.tenantName.trim()||this.getCodeErrorMessage()||this.getNameErrorMessage()||this.getBusinessNameErrorMessage())}getCodeErrorMessage(){return this.formData.tenantCode.trim()&&!this.editingTenant()&&this.tenants().some(i=>i.tenantCode.toLowerCase()===this.formData.tenantCode.trim().toLowerCase())?"Este c\xF3digo ya est\xE1 en uso":""}getNameErrorMessage(){if(!this.formData.tenantName.trim())return"";let t=this.editingTenant();return this.tenants().some(o=>(!t||o.id!==t.id)&&o.tenantName.toLowerCase()===this.formData.tenantName.trim().toLowerCase())?"Este nombre ya est\xE1 en uso":""}getBusinessNameErrorMessage(){if(!this.formData.businessName?.trim())return"";let t=this.editingTenant();return this.tenants().some(o=>(!t||o.id!==t.id)&&o.businessName&&o.businessName.toLowerCase()===this.formData.businessName.trim().toLowerCase())?"Esta raz\xF3n social ya est\xE1 en uso":""}saveTenant(){if(!this.canSave())return;let t=this.editingTenant();t?this.typificationService.updateTenant(t.id,this.formData).subscribe({next:()=>{this.loadTenants(),this.closeDialog()},error:i=>{console.error("Error updating tenant:",i),alert("Error al actualizar el proveedor")}}):this.typificationService.createTenant(this.formData).subscribe({next:()=>{this.loadTenants(),this.closeDialog()},error:i=>{console.error("Error creating tenant:",i),alert("Error al crear el proveedor. Verifique que el c\xF3digo no est\xE9 duplicado.")}})}toggleTenantStatus(t){let i=!t.isActive;confirm(`\xBFEst\xE1 seguro de ${i?"activar":"desactivar"} el proveedor "${t.tenantName}"?`)&&this.typificationService.updateTenant(t.id,N(S({},t),{isActive:i})).subscribe({next:()=>{this.loadTenants()},error:E=>{console.error("Error updating tenant status:",E),alert("Error al cambiar el estado del proveedor")}})}deleteTenant(t){if(t.hasPortfolios){alert("No se puede eliminar este proveedor porque tiene carteras asociadas.");return}confirm(`\xBFEst\xE1 seguro de eliminar el proveedor "${t.tenantName}"? Esta acci\xF3n no se puede deshacer.`)&&this.typificationService.deleteTenant(t.id).subscribe({next:()=>{this.loadTenants(),alert("Proveedor eliminado exitosamente")},error:i=>{console.error("Error deleting tenant:",i),alert("Error al eliminar el proveedor")}})}};d.\u0275fac=function(i){return new(i||d)(D(z))},d.\u0275cmp=k({type:d,selectors:[["app-tenant-maintenance"]],decls:50,vars:6,consts:[[1,"min-h-screen","bg-slate-950","p-6"],[1,"max-w-7xl","mx-auto","mb-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3","mb-2"],[1,"w-12","h-12","bg-gradient-to-br","from-blue-600","to-blue-700","rounded-xl","flex","items-center","justify-center","shadow-lg"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-gray-400"],[1,"flex","items-center","gap-2","px-5","py-2.5","bg-gradient-to-r","from-blue-600","to-blue-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","hover:scale-105","cursor-pointer",3,"click"],[1,"max-w-7xl","mx-auto","mb-6","grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"bg-slate-900","rounded-xl","p-5","shadow-sm","border","border-slate-800"],[1,"text-sm","text-gray-400","mb-1"],[1,"text-3xl","font-bold","text-white"],[1,"w-12","h-12","bg-blue-900/30","rounded-lg","flex","items-center","justify-center"],[1,"text-3xl","font-bold","text-green-400"],[1,"w-12","h-12","bg-green-900/30","rounded-lg","flex","items-center","justify-center"],[1,"text-3xl","font-bold","text-gray-500"],[1,"w-12","h-12","bg-slate-800","rounded-lg","flex","items-center","justify-center"],[1,"bg-slate-900","rounded-xl","p-4","shadow-sm","border","border-slate-800"],[1,"flex","items-center","gap-4"],[1,"flex-1","relative"],["type","text","placeholder","Buscar por c\xF3digo, nombre o raz\xF3n social...",1,"w-full","pl-12","pr-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"max-w-7xl","mx-auto"],[1,"bg-slate-900","rounded-xl","shadow-sm","border","border-slate-800","overflow-hidden"],[1,"p-12","text-center"],[1,"overflow-x-auto"],[1,"fixed","inset-0","bg-black/80","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"inline-block","w-8","h-8","border-4","border-blue-500","border-t-transparent","rounded-full","animate-spin"],[1,"mt-4","text-gray-400"],[1,"w-16","h-16","bg-slate-800","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-gray-300","mb-2"],[1,"text-sm","text-gray-500"],[1,"w-full"],[1,"bg-slate-800","border-b","border-slate-700"],[1,"px-6","py-3","text-left","text-xs","font-semibold","text-gray-400","uppercase","tracking-wider"],[1,"divide-y","divide-slate-800"],[1,"hover:bg-slate-800","transition-colors"],[1,"px-6","py-3"],[1,"font-mono","text-sm","font-semibold","text-white"],[1,"font-medium","text-white"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-slate-700","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-blue-800","rounded-full","peer","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-blue-600"],[1,"flex","items-center","gap-2"],["title","Editar",1,"p-2","text-blue-400","hover:bg-slate-800","rounded-lg","transition-colors","cursor-pointer",3,"click"],[1,"p-2","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled","title"],[1,"bg-slate-900","rounded-xl","shadow-2xl","max-w-2xl","w-full","max-h-[90vh]","overflow-hidden","border","border-slate-800"],[1,"bg-gradient-to-r","from-blue-600","to-blue-700","p-5","text-white"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-white/20","rounded-lg","flex","items-center","justify-center"],[1,"text-xl","font-bold"],[1,"text-blue-100","text-sm"],[1,"text-white/80","hover:text-white",3,"click"],[1,"p-6","overflow-y-auto","max-h-[calc(90vh-200px)]"],[1,"space-y-4"],[1,"block","text-sm","font-semibold","text-gray-300","mb-2"],["type","text","maxlength","3","placeholder","Ej: F01, ABC",3,"ngModelChange","ngModel","disabled"],[1,"text-xs","text-red-400","mt-1","font-semibold"],[1,"text-xs","text-gray-500","mt-1"],["type","text","placeholder","Ej: Financiera XYZ",3,"ngModelChange","ngModel"],["type","text","placeholder","Ej: Financiera XYZ S.A.C.",3,"ngModelChange","ngModel"],[1,"border-t","border-slate-800","p-4","flex","justify-end","gap-3","bg-slate-950"],[1,"px-5","py-2","text-gray-400","hover:bg-slate-800","hover:text-white","rounded-lg","font-medium","transition-colors",3,"click"],[1,"px-5","py-2","bg-gradient-to-r","from-blue-600","to-blue-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(i,o){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3),p(5,"div",4),n(6,"div")(7,"h1",5),l(8,"Gesti\xF3n de Proveedores"),e(),n(9,"p",6),l(10,"Administra los clientes y proveedores del sistema"),e()()()(),n(11,"button",7),f("click",function(){return o.openCreateDialog()}),n(12,"span"),l(13,"Nuevo Proveedor"),e()()()(),n(14,"div",8)(15,"div",9)(16,"div",2)(17,"div")(18,"p",10),l(19,"Total Proveedores"),e(),n(20,"p",11),l(21),e()(),p(22,"div",12),e()(),n(23,"div",9)(24,"div",2)(25,"div")(26,"p",10),l(27,"Activos"),e(),n(28,"p",13),l(29),e()(),p(30,"div",14),e()(),n(31,"div",9)(32,"div",2)(33,"div")(34,"p",10),l(35,"Inactivos"),e(),n(36,"p",15),l(37),e()(),p(38,"div",16),e()()(),n(39,"div",1)(40,"div",17)(41,"div",18)(42,"div",19)(43,"input",20),T("ngModelChange",function(y){return w(o.searchTerm,y)||(o.searchTerm=y),y}),f("ngModelChange",function(){return o.filterTenants()}),e()()()()(),n(44,"div",21)(45,"div",22),x(46,G,4,0,"div",23)(47,X,7,1,"div",23)(48,Z,17,0,"div",24),e()(),x(49,$,36,16,"div",25),e()),i&2&&(s(21),m(o.tenants().length),s(8),m(o.getActiveTenants()),s(8),m(o.getInactiveTenants()),s(6),C("ngModel",o.searchTerm),s(3),b(o.loading()?46:o.filteredTenants().length===0?47:48),s(3),b(o.showDialog()?49:-1))},dependencies:[I,B,A,L,W,j],styles:["[_nghost-%COMP%]{display:block}"]});let r=d;return r})();export{le as TenantMaintenanceComponent};
