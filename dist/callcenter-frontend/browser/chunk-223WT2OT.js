import{a as $e,b as ve}from"./chunk-KHMFQFBX.js";import{a as qe}from"./chunk-IHHTKGVG.js";import{a as Be}from"./chunk-4BQOIAP5.js";import{a as Ue}from"./chunk-LTATVL25.js";import{a as se}from"./chunk-F4ESQKJH.js";import{a as q,b as Re}from"./chunk-47DDE2XD.js";import"./chunk-TLWEWUTP.js";import{a as Me}from"./chunk-LSX2YIU7.js";import{c as we}from"./chunk-2JQMTGI5.js";import"./chunk-NO4444JX.js";import{D as xe,c as Fe,e as fe,j as be,l as Ne,r as Ae,s as Le,t as Ve,w as Oe}from"./chunk-5CXVSPU7.js";import{a as R}from"./chunk-CVSECBKN.js";import{$a as d,Ac as z,Db as Te,Eb as h,Fb as f,Fc as F,Gb as Se,Gc as Pe,I as _e,Ib as $,Jb as B,Kb as H,Lb as o,Mb as a,Nb as M,Ub as A,Wb as v,Yb as u,a as O,ac as ue,b as me,ba as W,bc as ge,cc as pe,fa as Y,fb as T,ga as ke,ic as he,id as ae,jc as D,jd as ne,kc as s,lc as U,ma as C,mb as X,mc as g,na as _,nc as le,pc as ee,qc as te,r as Ce,rc as ie,rd as Q,wa as b,yc as G,za as Ie}from"./chunk-3MKZGHO3.js";var oe=(()=>{let c=class c{constructor(e){this.http=e,this.baseUrl=`${R.tipificacionUrl}/payment-schedules`}createPaymentSchedule(e){return this.http.post(`${R.tipificacionUrl}/payments/schedules`,e)}getPaymentScheduleByManagementId(e){return this.http.get(`${this.baseUrl}/management/${e}`)}updateInstallmentStatus(e,t){return this.http.post(`${this.baseUrl}/installments/${e}/status`,t)}getInstallmentHistory(e){return this.http.get(`${this.baseUrl}/installments/${e}/history`)}getLatestStatusByManagement(e){return this.http.get(`${this.baseUrl}/management/${e}/latest-status`)}};c.\u0275fac=function(t){return new(t||c)(Y(Q))},c.\u0275prov=W({token:c,factory:c.\u0275fac,providedIn:"root"});let r=c;return r})();function Xe(r,c){if(r&1){let n=A();o(0,"div",17)(1,"div")(2,"label",13),s(3," Fecha de Pago * "),a(),o(4,"input",23),ie("ngModelChange",function(t){C(n);let i=u(2);return te(i.paymentDate,t)||(i.paymentDate=t),_(t)}),a()(),o(5,"div")(6,"label",13),s(7," Monto Pagado * "),a(),o(8,"div",24)(9,"span",25),s(10,"S/"),a(),o(11,"input",26),ie("ngModelChange",function(t){C(n);let i=u(2);return te(i.amountPaid,t)||(i.amountPaid=t),_(t)}),a()()()()}if(r&2){let n=u(2);d(4),ee("ngModel",n.paymentDate),d(7),ee("ngModel",n.amountPaid)}}function et(r,c){if(r&1&&(o(0,"div",19)(1,"span",27),s(2),a()()),r&2){let n=u(2);d(2),U(n.errorMessage())}}function tt(r,c){r&1&&(o(0,"span"),s(1,"Guardando..."),a())}function it(r,c){r&1&&(o(0,"span"),s(1,"Guardar"),a())}function at(r,c){if(r&1){let n=A();o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"h2",4),s(6,"Actualizar Estado de Cuota"),a(),o(7,"p",5),s(8),a()()(),o(9,"button",6),v("click",function(){C(n);let t=u();return _(t.close())}),a()(),o(10,"div",7)(11,"div",8)(12,"div",9)(13,"div")(14,"span",10),s(15,"Monto:"),a(),o(16,"span",11),s(17),G(18,"number"),a()(),o(19,"div")(20,"span",10),s(21,"Fecha Vencimiento:"),a(),o(22,"span",11),s(23),a()(),o(24,"div")(25,"span",10),s(26,"Estado Actual:"),a(),o(27,"span",12),s(28),a()()()(),o(29,"div")(30,"label",13),s(31," Nuevo Estado "),a(),o(32,"div",14)(33,"button",15),v("click",function(){C(n);let t=u();return _(t.selectedStatus.set("COMPLETADO"))}),o(34,"span",16),s(35,"Completado"),a()(),o(36,"button",15),v("click",function(){C(n);let t=u();return _(t.selectedStatus.set("VENCIDO"))}),o(37,"span",16),s(38,"Vencido"),a()(),o(39,"button",15),v("click",function(){C(n);let t=u();return _(t.selectedStatus.set("CANCELADO"))}),o(40,"span",16),s(41,"Cancelado"),a()()()(),h(42,Xe,12,2,"div",17),o(43,"div")(44,"label",13),s(45," Observaciones "),a(),o(46,"textarea",18),ie("ngModelChange",function(t){C(n);let i=u();return te(i.observations,t)||(i.observations=t),_(t)}),a()(),h(47,et,3,1,"div",19),a(),o(48,"div",20)(49,"button",21),v("click",function(){C(n);let t=u();return _(t.close())}),s(50," Cancelar "),a(),o(51,"button",22),v("click",function(){C(n);let t=u();return _(t.save())}),h(52,tt,2,0,"span")(53,it,2,0,"span"),a()()()()}if(r&2){let n,e,t,i,l,m=u();d(8),g("Cuota #",(n=m.installment())==null?null:n.installmentNumber),d(9),g(" S/ ",z(18,17,(e=m.installment())==null?null:e.amount,"1.2-2")," "),d(6),g(" ",m.formatDate((t=m.installment())==null?null:t.dueDate)," "),d(4),D(m.getStatusBadgeClass(((i=m.installment())==null?null:i.status)||"PENDIENTE")),d(),g(" ",((l=m.installment())==null?null:l.statusDescription)||"Pendiente"," "),d(5),D(m.selectedStatus()==="COMPLETADO"?"bg-green-100 dark:bg-green-900/30 border-green-500 dark:border-green-600 text-green-900 dark:text-green-300":"bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-green-400"),d(3),D(m.selectedStatus()==="VENCIDO"?"bg-red-100 dark:bg-red-900/30 border-red-500 dark:border-red-600 text-red-900 dark:text-red-300":"bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-red-400"),d(3),D(m.selectedStatus()==="CANCELADO"?"bg-gray-100 dark:bg-gray-700/30 border-gray-500 dark:border-gray-600 text-gray-900 dark:text-gray-300":"bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-gray-400"),d(3),f(m.selectedStatus()==="COMPLETADO"?42:-1),d(4),ee("ngModel",m.observations),d(),f(m.errorMessage()?47:-1),d(4),H("disabled",!m.canSave()||m.isSaving()),d(),f(m.isSaving()?52:53)}}var He=(()=>{let c=class c{constructor(e){this.paymentScheduleService=e,this.isOpen=b(!1),this.installment=b(null),this.managementId=b(0),this.selectedStatus=b(null),this.paymentDate="",this.amountPaid=null,this.observations="",this.isSaving=b(!1),this.errorMessage=b(null),this.canSave=F(()=>this.selectedStatus()?this.selectedStatus()==="COMPLETADO"?!!this.paymentDate&&this.amountPaid!==null&&this.amountPaid>0:!0:!1),Pe(()=>{this.isOpen()||this.resetForm()})}open(e,t){this.installment.set(e),this.managementId.set(t),this.isOpen.set(!0),this.amountPaid=e.amount;let i=new Date,l=i.getFullYear(),m=String(i.getMonth()+1).padStart(2,"0"),x=String(i.getDate()).padStart(2,"0"),p=String(i.getHours()).padStart(2,"0"),S=String(i.getMinutes()).padStart(2,"0");this.paymentDate=`${l}-${m}-${x}T${p}:${S}`}close(){this.isOpen.set(!1)}resetForm(){this.selectedStatus.set(null),this.paymentDate="",this.amountPaid=null,this.observations="",this.errorMessage.set(null),this.installment.set(null),this.managementId.set(0)}save(){let e=this.installment();if(!e||!this.canSave())return;this.isSaving.set(!0),this.errorMessage.set(null);let t={status:this.selectedStatus(),observations:this.observations||void 0,registeredBy:"USUARIO"};this.selectedStatus()==="COMPLETADO"&&(t.paymentDate=this.paymentDate,t.amountPaid=this.amountPaid),this.paymentScheduleService.updateInstallmentStatus(e.id,t).subscribe({next:()=>{console.log("\u2705 Estado de cuota actualizado exitosamente"),this.isSaving.set(!1),this.close(),this.onSave&&this.onSave(!0)},error:i=>{console.error("\u274C Error actualizando estado de cuota:",i),this.errorMessage.set("Error al actualizar el estado. Intente nuevamente."),this.isSaving.set(!1),this.onSave&&this.onSave(!1)}})}formatDate(e){return e?new Date(e).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}getStatusBadgeClass(e){switch(e.toUpperCase()){case"COMPLETED":case"COMPLETADO":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border border-green-300 dark:border-green-700";case"PENDING":case"PENDIENTE":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 border border-yellow-300 dark:border-yellow-700";case"OVERDUE":case"VENCIDO":return"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 border border-red-300 dark:border-red-700";case"CANCELLED":case"CANCELADO":return"bg-gray-100 dark:bg-gray-700/30 text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600";default:return"bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-300"}}};c.\u0275fac=function(t){return new(t||c)(T(oe))},c.\u0275cmp=X({type:c,selectors:[["app-installment-status-dialog"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","z-50","flex","items-center","justify-center","p-4","bg-black/50","backdrop-blur-sm","animate-fadeIn"],[1,"bg-white","dark:bg-slate-900","rounded-xl","shadow-2xl","max-w-2xl","w-full","max-h-[90vh]","overflow-hidden","flex","flex-col","animate-slideInUp","border","border-slate-200","dark:border-slate-700"],[1,"bg-gradient-to-r","from-purple-600","to-purple-700","dark:from-purple-700","dark:to-purple-800","text-white","px-6","py-4","flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-lg","font-bold"],[1,"text-sm","opacity-90"],["type","button",1,"p-2","hover:bg-white/20","rounded-lg","transition-colors",3,"click"],[1,"flex-1","overflow-y-auto","p-6","space-y-6"],[1,"bg-purple-50","dark:bg-purple-950/30","border","border-purple-200","dark:border-purple-800","rounded-lg","p-4"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"text-slate-600","dark:text-slate-400"],[1,"font-bold","text-purple-900","dark:text-purple-200","ml-2"],[1,"ml-2","px-2","py-0.5","rounded","text-xs","font-bold"],[1,"block","text-sm","font-semibold","text-slate-700","dark:text-slate-300","mb-2"],[1,"grid","grid-cols-3","gap-3"],["type","button",1,"border-2","rounded-lg","p-4","flex","flex-col","items-center","gap-2","transition-all",3,"click"],[1,"text-sm","font-bold"],[1,"space-y-4","p-4","bg-green-50","dark:bg-green-950/20","border","border-green-200","dark:border-green-800","rounded-lg"],["rows","3","placeholder","Ingrese notas o comentarios adicionales...",1,"w-full","px-3","py-2","text-sm","border","border-slate-300","dark:border-slate-600","rounded-lg","bg-white","dark:bg-slate-800","text-slate-900","dark:text-slate-100","focus:ring-2","focus:ring-purple-500","dark:focus:ring-purple-600","focus:border-transparent","placeholder:text-slate-400","dark:placeholder:text-slate-500",3,"ngModelChange","ngModel"],[1,"bg-red-50","dark:bg-red-950/30","border","border-red-200","dark:border-red-800","text-red-900","dark:text-red-300","px-4","py-3","rounded-lg","flex","items-start","gap-2"],[1,"px-6","py-4","bg-slate-50","dark:bg-slate-800/50","border-t","border-slate-200","dark:border-slate-700","flex","justify-end","gap-3"],["type","button",1,"px-4","py-2","text-sm","font-semibold","text-slate-700","dark:text-slate-300","hover:bg-slate-200","dark:hover:bg-slate-700","rounded-lg","transition-colors",3,"click"],["type","button",1,"px-4","py-2","text-sm","font-semibold","text-white","bg-gradient-to-r","from-purple-600","to-purple-700","hover:from-purple-700","hover:to-purple-800","rounded-lg","transition-all","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:from-purple-600","flex","items-center","gap-2",3,"click","disabled"],["type","datetime-local","required","",1,"w-full","px-3","py-2","text-sm","border","border-slate-300","dark:border-slate-600","rounded-lg","bg-white","dark:bg-slate-800","text-slate-900","dark:text-slate-100","focus:ring-2","focus:ring-green-500","dark:focus:ring-green-600","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"relative"],[1,"absolute","left-3","top-2","text-slate-500","dark:text-slate-400"],["type","number","step","0.01","required","",1,"w-full","pl-10","pr-3","py-2","text-sm","border","border-slate-300","dark:border-slate-600","rounded-lg","bg-white","dark:bg-slate-800","text-slate-900","dark:text-slate-100","focus:ring-2","focus:ring-green-500","dark:focus:ring-green-600","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"text-sm"]],template:function(t,i){t&1&&h(0,at,54,20,"div",0),t&2&&f(i.isOpen()?0:-1)},dependencies:[ne,xe,Fe,Ne,fe,Oe,be,ae],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.animate-fadeIn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.animate-slideInUp[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInUp .3s ease-out}"]});let r=c;return r})();var nt=["statusDialog"],Ge=(r,c)=>c.id;function ot(r,c){r&1&&(o(0,"div",9)(1,"div",10)(2,"span"),s(3,"Cargando estados..."),a()()())}function rt(r,c){if(r&1&&(o(0,"div",31),s(1),a()),r&2){let n=u().$implicit,e=u(2);d(),g(" ",e.formatDateTime(n.latestStatus.actualPaymentDate)," ")}}function lt(r,c){r&1&&(o(0,"div",36),s(1,"-"),a())}function st(r,c){r&1&&(o(0,"div",43)(1,"span"),s(2,"Cargando historial..."),a()())}function dt(r,c){if(r&1&&(o(0,"span",48),s(1),G(2,"number"),a()),r&2){let n=u().$implicit;d(),g(" S/ ",z(2,1,n.amountPaid,"1.2-2")," ")}}function ct(r,c){if(r&1&&(o(0,"div",49),s(1),a()),r&2){let n=u().$implicit;d(),g(" ",n.observations," ")}}function mt(r,c){if(r&1&&(o(0,"div",44)(1,"div",45),s(2),a(),o(3,"div",46)(4,"span",47),s(5),a(),h(6,dt,3,4,"span",48),h(7,ct,2,1,"div",49),a(),o(8,"div",50),s(9),a()()),r&2){let n=c.$implicit,e=u(5);d(2),g(" ",e.formatDateTime(n.changeDate)," "),d(2),D(e.getStatusBadgeClass(n.status)),d(),g(" ",n.statusDescription," "),d(),f(n.amountPaid?6:-1),d(),f(n.observations?7:-1),d(2),g(" ",n.registeredBy," ")}}function ut(r,c){if(r&1&&(o(0,"div",41),$(1,mt,10,7,"div",44,Ge),a()),r&2){let n=u(4);d(),B(n.installmentHistory())}}function gt(r,c){if(r&1&&(o(0,"tr")(1,"td",40)(2,"div",41)(3,"div",42)(4,"span"),s(5,"Historial de Estados"),a()(),h(6,st,3,0,"div",43)(7,ut,3,0,"div",41),a()()()),r&2){let n=u(3);d(6),f(n.isLoadingHistory()?6:n.installmentHistory()&&n.installmentHistory().length>0?7:-1)}}function pt(r,c){if(r&1){let n=A();o(0,"tr",26)(1,"td",27)(2,"div",28)(3,"div",29)(4,"span",30),s(5),a()()()(),o(6,"td",27)(7,"div",31),s(8),a()(),o(9,"td",32)(10,"div",33),s(11),G(12,"number"),a()(),o(13,"td",27)(14,"div",34)(15,"span",35),s(16),a()()(),o(17,"td",27),h(18,rt,2,1,"div",31)(19,lt,2,0,"div",36),a(),o(20,"td",27)(21,"div",37)(22,"button",38),v("click",function(){let t=C(n).$implicit,i=u(2);return _(i.openStatusDialog(t))}),a(),o(23,"button",39),v("click",function(){let t=C(n).$implicit,i=u(2);return _(i.toggleHistory(t.id))}),a()()()(),h(24,gt,8,1,"tr")}if(r&2){let n=c.$implicit,e=u(2);d(5),g(" ",n.installmentNumber," "),d(3),g(" ",e.formatDate(n.dueDate)," "),d(3),g(" S/ ",z(12,10,n.amount,"1.2-2")," "),d(4),D(e.getStatusBadgeClass((n.latestStatus==null?null:n.latestStatus.status)||"PENDIENTE")),d(),g(" ",(n.latestStatus==null?null:n.latestStatus.statusDescription)||"Pendiente"," "),d(2),f(n.latestStatus!=null&&n.latestStatus.actualPaymentDate?18:19),d(5),D(e.expandedHistory()===n.id?"bg-slate-200 dark:bg-slate-700":"hover:bg-slate-100 dark:hover:bg-slate-800"),d(),f(e.expandedHistory()===n.id&&e.installmentHistory()?24:-1)}}function ht(r,c){if(r&1&&(o(0,"div",11)(1,"table",12)(2,"thead",13)(3,"tr")(4,"th",14),s(5,"#"),a(),o(6,"th",14),s(7,"Fecha Vencimiento"),a(),o(8,"th",15),s(9,"Monto"),a(),o(10,"th",16),s(11,"Estado"),a(),o(12,"th",14),s(13,"Fecha Pago"),a(),o(14,"th",16),s(15,"Acciones"),a()()(),o(16,"tbody",17),$(17,pt,25,13,null,null,Ge),a()()(),o(19,"div",18)(20,"div",19)(21,"div",20)(22,"div",21),s(23,"Completadas"),a(),o(24,"div",22),s(25),a()(),o(26,"div",20)(27,"div",21),s(28,"Pendientes"),a(),o(29,"div",23),s(30),a()(),o(31,"div",20)(32,"div",21),s(33,"Vencidas"),a(),o(34,"div",24),s(35),a()(),o(36,"div",20)(37,"div",21),s(38,"Canceladas"),a(),o(39,"div",25),s(40),a()()()()),r&2){let n=u();d(17),B(n.installmentsWithStatus()),d(8),g(" ",n.summaryStats().completed," "),d(5),g(" ",n.summaryStats().pending," "),d(5),g(" ",n.summaryStats().overdue," "),d(5),g(" ",n.summaryStats().cancelled," ")}}var ze=(()=>{let c=class c{constructor(e){this.paymentScheduleService=e,this.managementId=0,this.schedule=b(null),this.latestStatuses=b([]),this.isLoading=b(!1),this.expandedHistory=b(null),this.installmentHistory=b(null),this.isLoadingHistory=b(!1),this.installmentsWithStatus=F(()=>{let t=this.schedule(),i=this.latestStatuses();return t?t.installments.map(l=>{let m=i.find(x=>x.installmentId===l.id);return me(O({},l),{latestStatus:m})}):[]}),this.summaryStats=F(()=>{let t=this.installmentsWithStatus();return{completed:t.filter(i=>["COMPLETED","COMPLETADO"].includes(i.latestStatus?.status||"")).length,pending:t.filter(i=>["PENDING","PENDIENTE"].includes(i.latestStatus?.status||"")).length,overdue:t.filter(i=>["OVERDUE","VENCIDO"].includes(i.latestStatus?.status||"")).length,cancelled:t.filter(i=>["CANCELLED","CANCELADO"].includes(i.latestStatus?.status||"")).length}})}ngOnChanges(e){e.managementId&&this.managementId&&this.loadSchedule()}loadSchedule(){this.isLoading.set(!0),this.paymentScheduleService.getPaymentScheduleByManagementId(this.managementId).subscribe({next:e=>{console.log("\u{1F4CA} Cronograma cargado:",e),this.schedule.set(e),this.loadLatestStatuses()},error:e=>{console.error("\u274C Error cargando cronograma:",e),this.isLoading.set(!1)}})}loadLatestStatuses(){this.paymentScheduleService.getLatestStatusByManagement(this.managementId).subscribe({next:e=>{console.log("\u{1F4CB} Estados m\xE1s recientes cargados:",e),this.latestStatuses.set(e),this.isLoading.set(!1)},error:e=>{console.error("\u274C Error cargando estados:",e),this.isLoading.set(!1)}})}openStatusDialog(e){this.statusDialog.open(e,this.managementId),this.statusDialog.onSave=t=>{t&&(this.loadLatestStatuses(),this.expandedHistory()===e.id&&this.loadInstallmentHistory(e.id))}}toggleHistory(e){this.expandedHistory()===e?(this.expandedHistory.set(null),this.installmentHistory.set(null)):(this.expandedHistory.set(e),this.loadInstallmentHistory(e))}loadInstallmentHistory(e){this.isLoadingHistory.set(!0),this.paymentScheduleService.getInstallmentHistory(e).subscribe({next:t=>{console.log("\u{1F4DC} Historial de cuota cargado:",t),this.installmentHistory.set(t),this.isLoadingHistory.set(!1)},error:t=>{console.error("\u274C Error cargando historial:",t),this.isLoadingHistory.set(!1)}})}formatDate(e){return new Date(e).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}formatDateTime(e){return new Date(e).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}getStatusBadgeClass(e){switch(e.toUpperCase()){case"COMPLETED":case"COMPLETADO":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border border-green-300 dark:border-green-700";case"PENDING":case"PENDIENTE":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 border border-yellow-300 dark:border-yellow-700";case"OVERDUE":case"VENCIDO":return"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 border border-red-300 dark:border-red-700";case"CANCELLED":case"CANCELADO":return"bg-gray-100 dark:bg-gray-700/30 text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600";default:return"bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-300"}}};c.\u0275fac=function(t){return new(t||c)(T(oe))},c.\u0275cmp=X({type:c,selectors:[["app-payment-schedule-view"]],viewQuery:function(t,i){if(t&1&&ue(nt,5),t&2){let l;ge(l=pe())&&(i.statusDialog=l.first)}},inputs:{managementId:"managementId"},features:[Ie],decls:19,vars:7,consts:[["statusDialog",""],[1,"bg-white","dark:bg-slate-900","rounded-xl","shadow-lg","border","border-slate-200","dark:border-slate-700","overflow-hidden"],[1,"bg-gradient-to-r","from-purple-600","to-purple-700","dark:from-purple-700","dark:to-purple-800","text-white","px-6","py-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-lg","font-bold"],[1,"text-sm","opacity-90"],[1,"text-right"],[1,"text-2xl","font-bold"],[1,"p-8","flex","items-center","justify-center"],[1,"flex","items-center","gap-3","text-slate-600","dark:text-slate-400"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-slate-50","dark:bg-slate-800/50","border-b","border-slate-200","dark:border-slate-700"],[1,"px-4","py-3","text-left","text-xs","font-bold","text-slate-700","dark:text-slate-300","uppercase","tracking-wider"],[1,"px-4","py-3","text-right","text-xs","font-bold","text-slate-700","dark:text-slate-300","uppercase","tracking-wider"],[1,"px-4","py-3","text-center","text-xs","font-bold","text-slate-700","dark:text-slate-300","uppercase","tracking-wider"],[1,"divide-y","divide-slate-200","dark:divide-slate-700"],[1,"px-6","py-4","bg-slate-50","dark:bg-slate-800/50","border-t","border-slate-200","dark:border-slate-700"],[1,"grid","grid-cols-4","gap-4","text-sm"],[1,"text-center"],[1,"text-slate-600","dark:text-slate-400","mb-1"],[1,"text-2xl","font-bold","text-green-600","dark:text-green-400"],[1,"text-2xl","font-bold","text-yellow-600","dark:text-yellow-400"],[1,"text-2xl","font-bold","text-red-600","dark:text-red-400"],[1,"text-2xl","font-bold","text-gray-600","dark:text-gray-400"],[1,"hover:bg-slate-50","dark:hover:bg-slate-800/50","transition-colors"],[1,"px-4","py-3"],[1,"flex","items-center","gap-2"],[1,"w-8","h-8","rounded-full","bg-purple-100","dark:bg-purple-900/30","flex","items-center","justify-center"],[1,"text-xs","font-bold","text-purple-700","dark:text-purple-300"],[1,"text-sm","text-slate-900","dark:text-slate-100"],[1,"px-4","py-3","text-right"],[1,"text-sm","font-bold","text-slate-900","dark:text-slate-100"],[1,"flex","justify-center"],[1,"px-2","py-1","rounded","text-xs","font-bold"],[1,"text-sm","text-slate-400","dark:text-slate-500"],[1,"flex","items-center","justify-center","gap-2"],["type","button","title","Actualizar estado",1,"p-1.5","hover:bg-purple-100","dark:hover:bg-purple-900/30","rounded","transition-colors",3,"click"],["type","button","title","Ver historial",1,"p-1.5","rounded","transition-colors",3,"click"],["colspan","6",1,"px-4","py-3","bg-slate-50","dark:bg-slate-800/50"],[1,"space-y-2"],[1,"flex","items-center","gap-2","text-sm","font-bold","text-slate-700","dark:text-slate-300","mb-2"],[1,"flex","items-center","gap-2","text-sm","text-slate-600","dark:text-slate-400","py-2"],[1,"flex","items-start","gap-3","text-xs","p-2","bg-white","dark:bg-slate-900","rounded","border","border-slate-200","dark:border-slate-700"],[1,"flex-shrink-0","w-24","text-slate-600","dark:text-slate-400"],[1,"flex-1"],[1,"px-2","py-0.5","rounded","font-bold"],[1,"ml-2","text-slate-700","dark:text-slate-300"],[1,"mt-1","text-slate-600","dark:text-slate-400"],[1,"flex-shrink-0","text-slate-500","dark:text-slate-500"]],template:function(t,i){if(t&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"h3",5),s(6,"Cronograma de Pagos"),a(),o(7,"p",6),s(8),a()()(),o(9,"div",7)(10,"div",6),s(11,"Monto Total"),a(),o(12,"div",8),s(13),G(14,"number"),a()()()(),h(15,ot,4,0,"div",9),h(16,ht,41,4),a(),M(17,"app-installment-status-dialog",null,0)),t&2){let l;d(8),g("",i.installmentsWithStatus().length," cuotas programadas"),d(5),g("S/ ",z(14,4,(l=i.schedule())==null?null:l.totalAmount,"1.2-2")),d(2),f(i.isLoading()?15:-1),d(),f(!i.isLoading()&&i.installmentsWithStatus().length>0?16:-1)}},dependencies:[ne,He,ae],encapsulation:2});let r=c;return r})();var We=(()=>{let c=class c{constructor(e){this.apiService=e,this.systemConfig={campana:{id:"CAMP-001",nombre:"Cartera Vencida Q3 2025",tipo:"Cobranza Temprana"},tipificaciones:{contacto:[{id:"CPC",codigo:"CPC",label:"Contacto con Cliente"},{id:"CTT",codigo:"CTT",label:"Contacto con Tercero"},{id:"NCL",codigo:"NCL",label:"No Contesta"},{id:"BZN",codigo:"BZN",label:"Buz\xF3n de Voz"},{id:"OCP",codigo:"OCP",label:"Ocupado"},{id:"FTN",codigo:"FTN",label:"Fuera de Tono"},{id:"NEQ",codigo:"NEQ",label:"N\xFAmero Equivocado"},{id:"TEL",codigo:"TEL",label:"Tel\xE9fono Inv\xE1lido"},{id:"CLG",codigo:"CLG",label:"Cliente Colg\xF3"},{id:"RCH",codigo:"RCH",label:"Rechaz\xF3 Llamada"}],gestion:[{id:"ACP",codigo:"ACP",label:"Acepta Compromiso de Pago",requiere_pago:!0,requiere_fecha:!0},{id:"PGR",codigo:"PGR",label:"Pago Realizado - Completo",requiere_pago:!0},{id:"PGP",codigo:"PGP",label:"Pago Parcial Realizado",requiere_pago:!0},{id:"PGT",codigo:"PGT",label:"Pago Total de Deuda",requiere_pago:!0},{id:"PPR",codigo:"PPR",label:"Pago Programado",requiere_pago:!0,requiere_fecha:!0},{id:"SRP",codigo:"SRP",label:"Solicita Refinanciamiento",requiere_seguimiento:!0},{id:"SQA",codigo:"SQA",label:"Solicita Quita o Descuento",requiere_seguimiento:!0},{id:"SCN",codigo:"SCN",label:"Solicita Congelamiento",requiere_seguimiento:!0},{id:"SPL",codigo:"SPL",label:"Solicita Ampliaci\xF3n de Plazo",requiere_seguimiento:!0},{id:"DPD",codigo:"DPD",label:"Disputa de Deuda",requiere_seguimiento:!0},{id:"NRD",codigo:"NRD",label:"No Reconoce Deuda",requiere_seguimiento:!0},{id:"DIF",codigo:"DIF",label:"Dificultad Financiera Temporal",requiere_seguimiento:!0},{id:"DSE",codigo:"DSE",label:"Desempleo",requiere_seguimiento:!0},{id:"ENF",codigo:"ENF",label:"Enfermedad/Incapacidad",requiere_seguimiento:!0},{id:"FLC",codigo:"FLC",label:"Fallecimiento del Titular",requiere_seguimiento:!0},{id:"RCL",codigo:"RCL",label:"Reclamo Registrado",requiere_seguimiento:!0},{id:"FRD",codigo:"FRD",label:"Reporte de Fraude",requiere_seguimiento:!0},{id:"NCB",codigo:"NCB",label:"Sin Capacidad de Pago",requiere_seguimiento:!0},{id:"VJE",codigo:"VJE",label:"Viaje/Fuera del Pa\xEDs",requiere_fecha:!0},{id:"SLL",codigo:"SLL",label:"Solicita Llamar Despu\xE9s",requiere_fecha:!0},{id:"NIN",codigo:"NIN",label:"No est\xE1 Interesado"},{id:"AGR",codigo:"AGR",label:"Cliente Agresivo/Hostil"},{id:"NBL",codigo:"NBL",label:"No Desea Ser Contactado"},{id:"LGL",codigo:"LGL",label:"Amenaza Legal"},{id:"CNV",codigo:"CNV",label:"Acepta Convenio de Pago",requiere_cronograma:!0,requiere_fecha:!0},{id:"CRO",codigo:"CRO",label:"Solicita Cronograma de Pagos",requiere_cronograma:!0,requiere_cuotas:!0},{id:"CPP",codigo:"CPP",label:"Convenio con Pago Parcial Inicial",requiere_cronograma:!0,requiere_monto_inicial:!0},{id:"CTT",codigo:"CTT",label:"Convenio a Plazo Total",requiere_cronograma:!0,requiere_periodicidad:!0},{id:"CCG",codigo:"CCG",label:"Convenio con Congelamiento",requiere_cronograma:!0,requiere_fecha:!0},{id:"CRF",codigo:"CRF",label:"Convenio con Refinanciamiento",requiere_cronograma:!0,requiere_seguimiento:!0},{id:"CQT",codigo:"CQT",label:"Convenio con Quita/Descuento",requiere_cronograma:!0,requiere_pago:!0},{id:"CAP",codigo:"CAP",label:"Convenio Aprobado por Supervisor",requiere_cronograma:!0,requiere_autorizacion:!0},{id:"CRC",codigo:"CRC",label:"Cliente Rechaza Convenio Propuesto",requiere_seguimiento:!0},{id:"CEV",codigo:"CEV",label:"Convenio en Evaluaci\xF3n",requiere_seguimiento:!0,requiere_fecha:!0}],motivo_no_pago:[{id:"FRE",label:"Falta de Recursos Econ\xF3micos"},{id:"DSP",label:"Desempleo Reciente"},{id:"RDS",label:"Reducci\xF3n de Salario"},{id:"EMR",label:"Emergencia M\xE9dica"},{id:"GSF",label:"Gastos Familiares Imprevistos"},{id:"OGS",label:"Otros Gastos Prioritarios"},{id:"NGC",label:"Negocio/Comercio en Crisis"},{id:"DCP",label:"Desconoce el Cargo/Producto"},{id:"IFC",label:"Inconformidad con Servicio"},{id:"FCC",label:"Fraude o Cargo no Reconocido"},{id:"OLV",label:"Olvido de Fecha de Pago"},{id:"PRG",label:"Problemas con M\xE9todo de Pago"},{id:"BNK",label:"Problemas Bancarios"},{id:"OTR",label:"Otro Motivo"}]},metodos_pago:[{id:"TDC",codigo:"TDC",label:"Tarjeta de Cr\xE9dito",icono:"\u{1F4B3}",requiere_ultimos4:!0},{id:"TDD",codigo:"TDD",label:"Tarjeta de D\xE9bito",icono:"\u{1F4B3}",requiere_ultimos4:!0},{id:"TRF",codigo:"TRF",label:"Transferencia Bancaria",icono:"\u{1F3E6}",requiere_banco:!0},{id:"DEP",codigo:"DEP",label:"Dep\xF3sito en Cuenta",icono:"\u{1F3E6}",requiere_banco:!0},{id:"EFE",codigo:"EFE",label:"Efectivo en Agencia",icono:"\u{1F4B5}",requiere_agencia:!0},{id:"CAU",codigo:"CAU",label:"Cargo Autom\xE1tico",icono:"\u{1F504}",requiere_autorizacion:!0},{id:"YPE",codigo:"YPE",label:"Yape",icono:"\u{1F4F1}",requiere_telefono:!0},{id:"PLN",codigo:"PLN",label:"Plin",icono:"\u{1F4F1}",requiere_telefono:!0},{id:"TNK",codigo:"TNK",label:"Tunki",icono:"\u{1F4F1}",requiere_telefono:!0},{id:"PGW",codigo:"PGW",label:"Pasarela Web/Link de Pago",icono:"\u{1F310}",requiere_email:!0}],bancos:["BCP - Banco de Cr\xE9dito del Per\xFA","BBVA","Interbank","Scotiabank","BanBif","Banco Pichincha","Banco Falabella","Banco Ripley","Banco Azteca","Otros"],cronograma_config:{periodicidades:[{id:"SEM",label:"Semanal",dias:7},{id:"QUI",label:"Quincenal",dias:15},{id:"MEN",label:"Mensual",dias:30},{id:"BIM",label:"Bimestral",dias:60},{id:"TRI",label:"Trimestral",dias:90}],tipos_cronograma:[{id:"FIJ",label:"Cuotas Fijas",descripcion:"Mismo monto cada cuota"},{id:"DEC",label:"Decreciente",descripcion:"Cuotas van disminuyendo"},{id:"ESC",label:"Escalonado",descripcion:"Cuotas aumentan gradualmente"},{id:"PER",label:"Personalizado",descripcion:"Montos espec\xEDficos por cuota"}],campos_requeridos:{requiere_cronograma:["numero_cuotas","periodicidad","fecha_primera_cuota"],requiere_cuotas:["numero_cuotas","monto_cuota"],requiere_monto_inicial:["monto_inicial","fecha_pago_inicial"],requiere_periodicidad:["periodicidad","dia_pago"],requiere_autorizacion:["supervisor_id","codigo_autorizacion"]},validaciones:{numero_cuotas_max:48,numero_cuotas_min:2,monto_minimo_cuota:50,porcentaje_quita_max:30,dias_gracia_max:90}}}}getSystemConfig(){return this.systemConfig}getCampaign(){return this.apiService.getActiveCampaign()||this.systemConfig.campana}getContactClassifications(){let e=this.apiService.tenantClassifications();if(e.length>0){let i=e.filter(l=>l.typification.tipoClasificacion==="CONTACT_RESULT"&&l.isEnabled).map(l=>({id:l.typification.id,codigo:l.typification.codigo,label:l.customName||l.typification.nombre}));if(i.length>0)return i}let t=this.apiService.getContactClassificationsForUI();return t.length>0?t:this.systemConfig.tipificaciones.contacto}getManagementClassifications(){let e=this.apiService.tenantClassifications();if(e.length>0){let i=e.filter(l=>l.isEnabled).map(l=>{let m=l.typification.metadataSchema?JSON.parse(l.typification.metadataSchema):{};return{id:String(l.typification.id),codigo:l.typification.codigo,label:l.customName||l.typification.nombre,requiere_pago:m.requiresPayment||!1,requiere_cronograma:m.requiresSchedule||!1,requiere_seguimiento:m.requiresFollowUp||!1,parentId:l.typification.parentTypificationId,hierarchyLevel:l.typification.nivelJerarquia,suggestsFullAmount:l.typification.suggestsFullAmount,allowsInstallmentSelection:l.typification.allowsInstallmentSelection,requiresManualAmount:l.typification.requiresManualAmount}});if(i.length>0)return i}let t=this.apiService.getManagementClassificationsForUI();return t.length>0?t:this.systemConfig.tipificaciones.gestion}getPaymentNoReasons(){return this.systemConfig.tipificaciones.motivo_no_pago}getPaymentMethods(){return this.systemConfig.metodos_pago}getBanks(){return this.systemConfig.bancos}getScheduleConfig(){return this.systemConfig.cronograma_config}getManagementClassificationById(e){return this.getManagementClassifications().find(l=>l.id==e)}};c.\u0275fac=function(t){return new(t||c)(Y(ve))},c.\u0275prov=W({token:c,factory:c.\u0275fac,providedIn:"root"});let r=c;return r})();var Qe=(()=>{let c=class c{constructor(e){this.http=e,this.baseUrl=`${R.tipificacionUrl}/managements`,this.scheduleUrl=`${R.tipificacionUrl}/payment-schedules`}createManagement(e){return this.http.post(this.baseUrl,e)}getManagementById(e){return this.http.get(`${this.baseUrl}/${e}`)}getManagementsByCustomer(e){return this.http.get(`${this.baseUrl}/customer/${e}`)}getManagementsByAdvisor(e){return this.http.get(`${this.baseUrl}/advisor/${e}`)}getActiveSchedulesByCustomer(e){return console.log("[SCHEDULE] Fetching active schedules for customer:",e),this.http.get(`${this.scheduleUrl}/customer/${e}/active`)}startCall(e,t){return this.http.post(`${this.baseUrl}/${e}/call/start`,t)}endCall(e,t){return this.http.post(`${this.baseUrl}/${e}/call/end`,t)}registerPayment(e,t){return this.http.post(`${this.baseUrl}/${e}/payment`,t)}};c.\u0275fac=function(t){return new(t||c)(Y(Q))},c.\u0275prov=W({token:c,factory:c.\u0275fac,providedIn:"root"});let r=c;return r})();var Ye=(()=>{let c=class c{constructor(){this.http=ke(Q),this.apiUrl=`${R.tipificacionUrl}/customer-outputs`}saveConfiguration(e){return this.http.post(`${this.apiUrl}/config`,e)}getConfiguration(e,t){let i={tenantId:e};return t!=null&&(i.portfolioId=t),this.http.get(`${this.apiUrl}/config`,{params:i})}};c.\u0275fac=function(t){return new(t||c)},c.\u0275prov=W({token:c,factory:c.\u0275fac,providedIn:"root"});let r=c;return r})();var Je=(()=>{let c=class c{constructor(e){this.http=e,this.apiUrl=`${R.apiUrl}/customers`}getAllCustomers(){return this.http.get(this.apiUrl)}getCustomerById(e){return this.http.get(`${this.apiUrl}/${e}`)}getCustomerByDocument(e){return this.http.get(`${this.apiUrl}/document/${e}`)}searchCustomers(e){return this.http.get(`${this.apiUrl}/search`,{params:{q:e}})}filterCustomers(e){return this.http.get(`${this.apiUrl}/filter`,{params:O({},e)})}createCustomer(e){return this.http.post(this.apiUrl,e)}updateCustomer(e,t){return this.http.put(`${this.apiUrl}/${e}`,t)}deleteCustomer(e){return this.http.delete(`${this.apiUrl}/${e}`)}getCustomerDetail(e,t){return this.http.get(`${this.apiUrl}/detail/${e}`,{params:{subPortfolioId:t.toString()}})}searchCustomerByCriteria(e,t,i){return this.http.get(`${this.apiUrl}/search-by`,{params:{tenantId:e.toString(),searchBy:t,value:i}})}searchCustomersByCriteria(e,t,i){return this.http.get(`${this.apiUrl}/search-by-multi`,{params:{tenantId:e.toString(),searchBy:t,value:i}})}searchCustomersAcrossAllTenants(e,t){return this.http.get(`${this.apiUrl}/search-all-tenants`,{params:{searchBy:e,value:t}})}getRecentCustomers(){return this.http.get(`${this.apiUrl}/recent`)}registerCustomerAccess(e){return this.http.post(`${this.apiUrl}/${e}/access`,{})}};c.\u0275fac=function(t){return new(t||c)(Y(Q))},c.\u0275prov=W({token:c,factory:c.\u0275fac,providedIn:"root"});let r=c;return r})();var _t=["dynamicFieldRendererComponent"],re=(r,c)=>c.id;function St(r,c){r&1&&(o(0,"div",2)(1,"div",57)(2,"div")(3,"div",58),s(4,"\xA1Gesti\xF3n Guardada!"),a(),o(5,"div",59),s(6,"Los datos se registraron correctamente"),a()()()())}function yt(r,c){r&1&&(o(0,"span",17),s(1,"OSCURO"),a())}function Et(r,c){r&1&&(o(0,"span",18),s(1,"CLARO"),a())}function Dt(r,c){r&1&&M(0,"div",62)}function kt(r,c){if(r&1){let n=A();o(0,"button",60),v("click",function(){let t=C(n).$implicit,i=u();return _(i.activeTab.set(t.id))}),o(1,"div",61),s(2),a(),h(3,Dt,1,0,"div",62),a()}if(r&2){let n=c.$implicit,e=u();D("flex-1 px-2 py-1.5 text-xs font-semibold transition-all duration-300 relative group "+(e.activeTab()===n.id?"text-blue-700 dark:text-blue-200 bg-blue-50 dark:bg-blue-950/50":"text-gray-700 dark:text-gray-100 hover:text-blue-700 dark:hover:text-blue-200 hover:bg-gray-50 dark:hover:bg-gray-800")),d(2),g(" ",n.label," "),d(),f(e.activeTab()===n.id?3:-1)}}function It(r,c){}function Tt(r,c){if(r&1&&(o(0,"div",66)(1,"div",67)(2,"div",68)(3,"div",69),h(4,It,0,0),s(5),a(),o(6,"div",70),s(7),a()()()()),r&2){let n=c.$implicit,e=u(2);he("col-span-1",!n.size||n.size==="small")("col-span-2",n.size==="medium")("col-span-3",n.size==="large")("col-span-4",n.size==="full")("bg-cyan-50",n.highlight&&!e.themeService.isDarkMode())("dark:bg-cyan-950/30",n.highlight&&e.themeService.isDarkMode())("border-cyan-300",n.highlight&&!e.themeService.isDarkMode())("dark:border-cyan-900/50",n.highlight&&e.themeService.isDarkMode())("bg-slate-50",!n.highlight&&!e.themeService.isDarkMode())("dark:bg-slate-900/50",!n.highlight&&e.themeService.isDarkMode())("border-slate-200",!n.highlight&&!e.themeService.isDarkMode())("dark:border-slate-700",!n.highlight&&e.themeService.isDarkMode()),d(3),he("text-cyan-800",n.highlight&&!e.themeService.isDarkMode())("dark:text-cyan-100",n.highlight&&e.themeService.isDarkMode())("text-slate-600",!n.highlight&&!e.themeService.isDarkMode())("dark:text-slate-400",!n.highlight&&e.themeService.isDarkMode()),d(),f(n.highlight?4:-1),d(),g(" ",n.label," "),d(),he("text-cyan-900",n.highlight&&!e.themeService.isDarkMode())("dark:text-cyan-50",n.highlight&&e.themeService.isDarkMode())("text-slate-900",!n.highlight&&!e.themeService.isDarkMode())("dark:text-white",!n.highlight&&e.themeService.isDarkMode()),d(),g(" ",e.formatFieldValue(e.getFieldValue(n.field),n.format)," ")}}function Pt(r,c){r&1&&(o(0,"div",65)(1,"p"),s(2,"No hay campos configurados para mostrar"),a(),o(3,"p",71),s(4,"Configure los campos en Mantenimiento > Salidas de Cliente"),a()())}function wt(r,c){if(r&1&&(o(0,"div",40)(1,"div",63),$(2,Tt,8,43,"div",64,re),a(),h(4,Pt,5,0,"div",65),a()),r&2){let n=u();d(2),B(n.customerOutputFields()),d(2),f(n.customerOutputFields().length===0?4:-1)}}function Mt(r,c){if(r&1&&(o(0,"div",40)(1,"div",72)(2,"div",73),s(3," Info. Producto "),a(),o(4,"div",74)(5,"div",75)(6,"span",76),s(7,"Producto:"),a(),o(8,"span",77),s(9),a()(),o(10,"div",75)(11,"span",76),s(12,"F. Desemb.:"),a(),o(13,"span",77),s(14),a()(),o(15,"div",75)(16,"span",76),s(17,"Monto:"),a(),o(18,"span",77),s(19),a()(),o(20,"div",75)(21,"span",76),s(22,"Plazo:"),a(),o(23,"span",77),s(24),a()(),o(25,"div",75)(26,"span",76),s(27,"Tasa:"),a(),o(28,"span",77),s(29),a()()()(),o(30,"div",78)(31,"div",79),s(32," Detalle Deuda "),a(),o(33,"div",74)(34,"div",80)(35,"span",81),s(36,"Capital:"),a(),o(37,"span",82),s(38),a()(),o(39,"div",80)(40,"span",81),s(41,"Intereses:"),a(),o(42,"span",82),s(43),a()(),o(44,"div",83)(45,"span",84),s(46,"Moras:"),a(),o(47,"span",85),s(48),a()(),o(49,"div",83)(50,"span",84),s(51,"G. Cobr.:"),a(),o(52,"span",85),s(53),a()(),M(54,"div",86),o(55,"div",87)(56,"span",85),s(57,"Total:"),a(),o(58,"span",85),s(59),a()()()()()),r&2){let n=u();d(9),U(n.customerData().cuenta.tipo_producto),d(5),U(n.customerData().cuenta.fecha_desembolso),d(5),g("S/ ",n.customerData().cuenta.monto_original.toFixed(2)),d(5),g("",n.customerData().cuenta.plazo_meses,"m"),d(5),g("",n.customerData().cuenta.tasa_interes,"%"),d(9),g("S/ ",n.customerData().deuda.saldo_capital.toFixed(2)),d(5),g("S/ ",n.customerData().deuda.intereses_vencidos.toFixed(2)),d(5),g("S/ ",n.customerData().deuda.mora_acumulada.toFixed(2)),d(5),g("S/ ",n.customerData().deuda.gastos_cobranza.toFixed(2)),d(6),g("S/ ",n.customerData().deuda.saldo_total.toFixed(2))}}function Ft(r,c){if(r&1){let n=A();o(0,"div",88)(1,"div")(2,"p",89),s(3,"Sin gestiones previas"),a(),o(4,"p",90),s(5," No hay gestiones registradas para este cliente "),a(),o(6,"p",91),s(7),a()(),o(8,"button",92),v("click",function(){C(n);let t=u(2);return _(t.loadManagementHistory())}),s(9," Recargar Historial "),a()()}if(r&2){let n=u(2);d(7),g(" Cliente: ",n.customerData().id_cliente," ")}}function Nt(r,c){if(r&1){let n=A();o(0,"div",101)(1,"div",102)(2,"div",103)(3,"span",104),s(4,"Cronograma"),a()(),o(5,"button",105),v("click",function(){C(n);let t=u().$implicit,i=u(3);return _(i.openScheduleDetail(t.id))}),s(6," Ver Detalle "),a()(),o(7,"div",106)(8,"div",75)(9,"span"),s(10),a(),o(11,"span",58),s(12),G(13,"number"),a()(),o(14,"div",107),s(15),a()()()}if(r&2){let n=u().$implicit;d(10),g("Cuotas: ",n.schedule.numberOfInstallments),d(2),g("S/ ",z(13,3,n.schedule.totalAmount,"1.2-2")),d(3),g(" ",n.schedule.installments.length," cuota(s) registrada(s) ")}}function At(r,c){if(r&1&&(o(0,"div",93)(1,"div",94)(2,"div",95),s(3),a(),o(4,"div",96),s(5),a()(),o(6,"div",74)(7,"div",97),s(8),a(),o(9,"div",98),s(10),a(),o(11,"div",99),s(12),a(),o(13,"div",100),s(14),a(),h(15,Nt,16,6,"div",101),a()()),r&2){let n=c.$implicit;d(3),g(" ",n.fecha," "),d(2),U(n.asesor),d(3),U(n.resultado),d(2),U(n.gestion),d(2),U(n.observacion),d(2),g("Duraci\xF3n: ",n.duracion),d(),f(n.schedule?15:-1)}}function Lt(r,c){if(r&1&&$(0,At,16,7,"div",93,Se),r&2){let n=u(2);B(n.historialGestiones())}}function Vt(r,c){if(r&1&&(o(0,"div",40),h(1,Ft,10,1,"div",88)(2,Lt,2,0),a()),r&2){let n=u();d(),f(n.historialGestiones().length===0?1:2)}}function Ot(r,c){if(r&1&&(o(0,"option",113),s(1),a()),r&2){let n=c.$implicit;H("value",n.id),d(),le("[",n.codigo,"] ",n.label)}}function Ut(r,c){r&1&&(o(0,"div",114),s(1," Requerido "),a())}function Rt(r,c){if(r&1){let n=A();o(0,"div",47)(1,"label",108),M(2,"div",109),s(3," Resultado de Contacto * "),a(),o(4,"div",110)(5,"select",111),ie("ngModelChange",function(t){C(n);let i=u();return te(i.managementForm.resultadoContacto,t)||(i.managementForm.resultadoContacto=t),_(t)}),v("ngModelChange",function(){C(n);let t=u();return _(t.onContactResultChange())}),o(6,"option",112),s(7,"-- Seleccionar resultado --"),a(),$(8,Ot,2,3,"option",113,re),a()(),h(10,Ut,2,0,"div",114),a()}if(r&2){let n=u();d(5),D("w-full p-2 pr-8 border rounded-lg font-semibold text-gray-700 dark:text-white appearance-none cursor-pointer transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-800 hover:border-blue-400 dark:hover:border-blue-600 text-xs "+(n.errors().resultadoContacto?"border-red-500 bg-red-50 dark:bg-red-950/30 dark:border-red-600":"border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-900")+" "+(n.managementForm.resultadoContacto?"bg-blue-50 dark:bg-blue-950/30 border-blue-400 dark:border-blue-600":"")),ee("ngModel",n.managementForm.resultadoContacto),d(3),B(n.contactClassifications()),d(2),f(n.errors().resultadoContacto?10:-1)}}function $t(r,c){if(r&1&&(o(0,"option",113),s(1),a()),r&2){let n=c.$implicit;H("value",n.id),d(),le("[",n.codigo,"] ",n.label)}}function Bt(r,c){r&1&&(o(0,"div",116),s(1," Requerido "),a())}function qt(r,c){if(r&1){let n=A();o(0,"div",115)(1,"label",108),M(2,"div"),s(3),a(),o(4,"div",110)(5,"select",111),v("ngModelChange",function(t){C(n);let i=u().$index,l=u(2);return _(l.onClassificationLevelChange(i,t))}),o(6,"option",112),s(7,"-- Seleccionar --"),a(),$(8,$t,2,3,"option",113,re),a()(),h(10,Bt,2,0,"div",116),a()}if(r&2){let n=u(),e=n.$implicit,t=n.$index,i=u(2);d(2),D("w-1.5 h-1.5 rounded-full "+(t===0?"bg-red-500":t===1?"bg-blue-500":t===2?"bg-purple-500":t===3?"bg-orange-500":"bg-green-500")),d(),le(" ",i.getDynamicLevelLabel(t),"",t===0?" *":""," "),d(2),D("w-full p-2 pr-8 border rounded-lg font-semibold text-gray-700 dark:text-white appearance-none cursor-pointer transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-green-200 dark:focus:ring-green-800 hover:border-green-500 text-xs "+(i.errors().tipoGestion&&t===0?"border-red-500 bg-red-50 dark:bg-red-950/30":"border-green-300 dark:border-green-700 bg-white dark:bg-gray-900")+" "+(i.selectedClassifications()[t]?"bg-green-100 dark:bg-green-950/30 border-green-500 dark:border-green-600":"")),H("ngModel",i.selectedClassifications()[t]),d(3),B(e),d(2),f(i.errors().tipoGestion&&t===0?10:-1)}}function jt(r,c){if(r&1&&h(0,qt,11,8,"div",115),r&2){let n=c.$index,e=u(2);f(e.shouldShowLevel(n)?0:-1)}}function Ht(r,c){if(r&1&&$(0,jt,1,1,null,null,Se),r&2){let n=u();B(n.hierarchyLevels())}}function Gt(r,c){r&1&&(o(0,"div",48)(1,"div",117)(2,"span",12),s(3,"Cargando campos adicionales..."),a()()())}function zt(r,c){r&1&&(o(0,"div",49)(1,"div",118)(2,"span",12),s(3,"Esta clasificaci\xF3n no tiene campos adicionales configurados"),a()()())}function Wt(r,c){if(r&1){let n=A();o(0,"app-dynamic-field-renderer",119,0),v("dataChange",function(t){C(n);let i=u();return _(i.onDynamicFieldsChange(t))}),a()}if(r&2){let n=u();H("schema",n.dynamicFieldsSchema())("externalUpdates",n.externalFieldUpdates())("selectedClassification",n.selectedClassification())}}function Qt(r,c){r&1&&(o(0,"div",51)(1,"div",120)(2,"span",121),s(3,"Cargando cronogramas pendientes..."),a()()())}function Yt(r,c){if(r&1&&(o(0,"div",134)(1,"div",15)(2,"span",135),s(3),a(),o(4,"span",136),s(5),a()(),o(6,"span",137),s(7),G(8,"number"),a()()),r&2){let n=u().$implicit;d(3),g("Cuota #",n.installmentNumber),d(2),g("Vence: ",n.dueDate),d(2),g("S/ ",z(8,3,n.amount,"1.2-2"))}}function Jt(r,c){if(r&1&&h(0,Yt,9,6,"div",134),r&2){let n=c.$index;f(n<3?0:-1)}}function Zt(r,c){if(r&1&&(o(0,"div",129),s(1),a()),r&2){let n=u().$implicit,e=u(2);d(),g(" + ",e.getPendingInstallments(n).length-3," cuotas m\xE1s ")}}function Kt(r,c){if(r&1){let n=A();o(0,"button",138),v("click",function(){C(n);let t=u(3);return _(t.applyNextInstallmentPayment())}),s(1," Usar Pr\xF3xima Cuota "),a()}}function Xt(r,c){if(r&1){let n=A();o(0,"button",139),v("click",function(){C(n);let t=u(3);return _(t.applyFullSchedulePayment())}),s(1),G(2,"number"),a()}if(r&2){let n=u().$implicit,e=u(2);d(),g(" Pagar Todo (S/ ",z(2,1,e.calculatePendingAmount(n),"1.2-2"),") ")}}function ei(r,c){if(r&1&&(o(0,"div",125)(1,"div",5)(2,"div",15)(3,"div",123),s(4),a(),o(5,"div",126),s(6," ACTIVO "),a()(),o(7,"div",123),s(8),G(9,"number"),a()(),o(10,"div",127)(11,"div",128),s(12,"Cuotas Pendientes"),a(),$(13,Jt,1,1,null,null,re),h(15,Zt,2,1,"div",129),a(),o(16,"div",130),h(17,Kt,2,0,"button",131),h(18,Xt,3,4,"button",132),a(),o(19,"div",133)(20,"span"),s(21,"El pago se aplicar\xE1 autom\xE1ticamente a las cuotas pendientes en orden de vencimiento"),a()()()),r&2){let n,e,t=c.$implicit,i=u(2);d(4),g(" ",t.scheduleType||"CRONOGRAMA"," "),d(4),g(" S/ ",z(9,5,t.totalAmount,"1.2-2")," "),d(5),B(i.getPendingInstallments(t)),d(2),f(i.getPendingInstallments(t).length>3?15:-1),d(2),f(((n=i.selectedClassification())==null?null:n.allowsInstallmentSelection)===!0?17:-1),d(),f(((e=i.selectedClassification())==null?null:e.suggestsFullAmount)===!0?18:-1)}}function ti(r,c){if(r&1&&(o(0,"div",52)(1,"div",5)(2,"div",15),M(3,"div",122),o(4,"div")(5,"h4",123),s(6,"Cronograma Activo Detectado"),a(),o(7,"p",124),s(8),a()()()(),$(9,ei,22,8,"div",125,re),a()),r&2){let n=u();d(8),g("Cliente tiene ",n.activeSchedules().length," cronograma(s) pendiente(s)"),d(),B(n.activeSchedules())}}function ii(r,c){r&1&&s(0," Guardando... ")}function ai(r,c){r&1&&s(0," Guardar Gesti\xF3n ")}function ni(r,c){if(r&1){let n=A();o(0,"div",56)(1,"div",140)(2,"div",141)(3,"div",6)(4,"div")(5,"h2",142),s(6,"Cronograma de Pagos"),a(),o(7,"p",59),s(8),a()()(),o(9,"button",143),v("click",function(){C(n);let t=u();return _(t.closeScheduleDetail())}),a()(),o(10,"div",144),M(11,"app-payment-schedule-view",145),a(),o(12,"div",146)(13,"button",147),v("click",function(){C(n);let t=u();return _(t.closeScheduleDetail())}),s(14," Cerrar "),a()()()()}if(r&2){let n=u();d(8),g("Gesti\xF3n ",n.scheduleManagementId()),d(3),H("managementId",n.scheduleManagementId())}}var ji=(()=>{let c=class c{constructor(e,t,i,l,m,x,p,S,j,J,Z,k,de){this.systemConfigService=e,this.managementService=t,this.paymentScheduleService=i,this.themeService=l,this.classificationService=m,this.apiSystemConfigService=x,this.customerOutputConfigService=p,this.customerService=S,this.router=j,this.http=J,this.sipService=Z,this.agentService=k,this.authService=de,this.callActive=b(!1),this.callDuration=b(0),this.saving=b(!1),this.showScheduleDetail=b(!1),this.scheduleManagementId=b(null),this.showOutputSelector=!1,this.errors=b({}),this.showSuccess=b(!1),this.animateEntry=b(!0),this.activeTab=b("cliente"),this.isTipifying=b(!1),this.historialGestiones=b([]),this.tenants=[],this.portfolios=[],this.testDocument="",this.testPhone="",this.customerOutputFields=b([]),this.campaign=F(()=>this.systemConfigService.getCampaign()),this.contactClassifications=F(()=>this.systemConfigService.getContactClassifications()),this.managementClassifications=F(()=>this.apiSystemConfigService.getManagementClassificationsForUI()),this.managementClassificationsHierarchical=F(()=>{let I=this.managementClassifications(),E=new Map,P=new Map;I.forEach(w=>{let L=String(w.id);E.set(L,w),P.set(L,[])}),I.forEach(w=>{if(w.parentId){let L=String(w.parentId),V=P.get(L);V&&V.push(w)}});let y=(w,L=0)=>{let V=[];return w.forEach(ce=>{V.push(me(O({},ce),{indentLevel:L,displayLabel:"  ".repeat(L)+(L>0?"\u2514\u2500 ":"")+`[${ce.codigo}] ${ce.label}`}));let Ze=String(ce.id),De=P.get(Ze)||[];De.length>0&&V.push(...y(De,L+1))}),V},N=I.filter(w=>!w.parentId);return y(N,0)}),this.paymentMethods=F(()=>this.systemConfigService.getPaymentMethods()),this.scheduleTypes=F(()=>this.systemConfigService.getScheduleConfig().tipos_cronograma),this.periodicities=F(()=>this.systemConfigService.getScheduleConfig().periodicidades),this.tabs=[{id:"cliente",label:"Cliente",icon:"user"},{id:"cuenta",label:"Cuenta",icon:"wallet"},{id:"historial",label:"Historial",icon:"history"}],this.managementForm={resultadoContacto:"",tipoGestion:"",clasificacionNivel1:"",clasificacionNivel2:"",clasificacionNivel3:"",motivoNoPago:"",metodoPago:"",montoPago:"",fechaCompromiso:"",horaCompromiso:"",ultimos4Tarjeta:"",bancoSeleccionado:"",observaciones:"",notasPrivadas:""},this.selectedClassifications=b([]),this.dynamicFields=b([]),this.dynamicFieldValues=b({}),this.isLoadingDynamicFields=b(!1),this.isLeafClassification=b(!1),this.dynamicFieldsSchema=b(null),this.externalFieldUpdates=b({}),this.activeSchedules=b([]),this.isLoadingSchedules=b(!1),this.showScheduleHelper=b(!1),this.selectedClassification=F(()=>{let I=this.selectedClassifications();if(I.length===0)return null;let E=I[I.length-1];if(!E)return null;let y=this.managementClassifications().find(N=>String(N.id)===String(E));return y&&(console.log("[DEBUG] Selected typification:",y),console.log("[DEBUG] suggestsFullAmount:",y.suggestsFullAmount),console.log("[DEBUG] allowsInstallmentSelection:",y.allowsInstallmentSelection),console.log("[DEBUG] requiresManualAmount:",y.requiresManualAmount)),y||null}),this.isFormValid=F(()=>{if(this.usesHierarchicalClassifications()){let E=this.selectedClassifications();if(E.length===0||!E[E.length-1])return!1;let P=E[E.length-1];if(this.managementClassifications().some(w=>w.parentId&&Number(w.parentId)===Number(P)))return console.log("[isFormValid] A\xFAn hay niveles por seleccionar"),!1}else if(!this.managementForm.resultadoContacto)return!1;let I=this.dynamicFieldsSchema();if(I&&I.fields&&I.fields.length>0){let E=this.dynamicFieldValues();for(let P of I.fields)if(P.required){let y=E[P.id];if(y==null||y===""||P.type==="table"&&(!Array.isArray(y)||y.length===0))return!1}}return!0}),this.hierarchyLevels=F(()=>{let I=this.managementClassifications(),E=this.selectedClassifications(),P=[];console.log("[hierarchyLevels] Total classifications:",I.length),console.log("[hierarchyLevels] Selected:",E);let y=I.filter(N=>N.hierarchyLevel===1||!N.parentId);console.log("[hierarchyLevels] Nivel 1 (roots):",y.length,y.map(N=>`${N.codigo} (ID:${N.id})`)),y.length>0&&P.push(y);for(let N=0;N<E.length;N++){let w=E[N];if(console.log(`[hierarchyLevels] Buscando hijos del nivel ${N+1}, parentId:`,w),w){let L=I.filter(V=>V.parentId&&Number(V.parentId)===Number(w));if(console.log(`[hierarchyLevels] Encontrados ${L.length} hijos:`,L.map(V=>`${V.codigo} (ID:${V.id}, parent:${V.parentId})`)),L.length>0)P.push(L);else{console.log("[hierarchyLevels] No se encontraron hijos, deteniendo b\xFAsqueda");break}}}return console.log("[hierarchyLevels] Total niveles construidos:",P.length),P}),this.scheduleForm={numeroCuotas:"",montoCuota:"",periodicidad:"",fechaPrimeraCuota:"",tipoCronograma:"",montoInicial:"",montoNegociado:"",cuotas:[]},this.customerData=b({id_cliente:"CLI-2025-0087453",nombre_completo:"GARC\xCDA RODRIGUEZ, CARMEN ROSA",tipo_documento:"DNI",numero_documento:"45621378",fecha_nacimiento:"15/03/1985",edad:40,contacto:{telefono_principal:"+51 987 654 321",telefono_alternativo:"+51 945 123 456",telefono_trabajo:"+51 01 4567890",email:"carmen.garcia@email.com",direccion:"Av. Los \xC1lamos 458, Dpto 302, San Borja, Lima"},cuenta:{numero_cuenta:"****5678",tipo_producto:"Pr\xE9stamo Personal",fecha_desembolso:"15/01/2024",monto_original:15e3,plazo_meses:24,tasa_interes:18.5},deuda:{saldo_capital:8750.5,intereses_vencidos:456.78,mora_acumulada:234.5,gastos_cobranza:120,saldo_total:9561.78,dias_mora:45,fecha_ultimo_pago:"15/10/2024",monto_ultimo_pago:458.33}}),this.callState=q.IDLE,this.isMuted=b(!1),this.incomingPhoneNumber=null}ngOnInit(){this.loadTenants(),this.loadManagementHistory();let e=this.sipService.getCallState();console.log("\u{1F4DE} [CollectionManagement] Estado inicial de llamada:",e),e===q.ACTIVE&&!this.callActive()&&(console.log("\u23F1\uFE0F Llamada ya est\xE1 activa, iniciando timer autom\xE1ticamente..."),this.callActive.set(!0),this.startCall()),this.callStateSubscription=this.sipService.onCallStatus.subscribe(t=>{if(console.log("\u{1F4DE} [CollectionManagement] Estado de llamada:",t),this.callState=t,t===q.ACTIVE&&!this.callActive()){this.callActive.set(!0),this.startCall();let i=this.authService.getCurrentUser();i?.id&&this.agentService.changeAgentStatus(i.id,{estado:se.EN_LLAMADA}).subscribe({next:()=>console.log("\u2705 Estado cambiado a EN_LLAMADA"),error:l=>console.error("\u274C Error cambiando estado:",l)})}if((t===q.ENDED||t===q.IDLE)&&this.callActive()){this.callActive.set(!1),this.isTipifying.set(!0),this.sipService.blockIncomingCallsMode(!0),console.log("\u{1F6AB} Bloqueando llamadas entrantes - agente en tipificaci\xF3n");let i=this.callDuration();this.callTimer&&(clearInterval(this.callTimer),this.callTimer=void 0),console.log(`\u{1F4DD} Llamada terminada (${i}s), cambiando a TIPIFICANDO`);let l=this.authService.getCurrentUser();l?.id&&this.agentService.changeAgentStatus(l.id,{estado:se.TIPIFICANDO}).subscribe({next:()=>console.log("\u2705 Estado cambiado a TIPIFICANDO - agente debe completar formulario"),error:m=>console.error("\u274C Error cambiando estado:",m)})}}),this.incomingCallSubscription=this.sipService.onIncomingCall.subscribe(t=>{console.log("\u{1F4F2} [CollectionManagement] Llamada entrante de:",t.from),this.incomingPhoneNumber=t.from,t.from&&this.autoLoadCustomerByPhone(t.from)})}autoLoadCustomerByPhone(e){console.log("\u{1F50D} [AUTO-LOAD] Buscando cliente por tel\xE9fono:",e),this.customerService.searchCustomersAcrossAllTenants("telefono",e).subscribe({next:t=>{t&&t.length>0?(console.log("\u2705 [AUTO-LOAD] Cliente encontrado:",t[0]),this.loadCustomerFromResource(t[0])):console.warn("\u26A0\uFE0F [AUTO-LOAD] No se encontr\xF3 cliente con tel\xE9fono:",e)},error:t=>{console.error("\u274C [AUTO-LOAD] Error buscando cliente:",t)}})}loadTenants(){let e=this.authService.getCurrentUser();console.log("[V2] Usuario actual:",e),e?.tenantId&&e?.portfolioId?(this.selectedTenantId=e.tenantId,this.selectedPortfolioId=e.portfolioId,console.log(`[V2] Usando asignaci\xF3n del usuario: tenant=${this.selectedTenantId}, portfolio=${this.selectedPortfolioId}`),this.reloadTypifications(),this.loadCustomerOutputConfig(),this.loadFirstCustomer()):(console.error("[V2] Usuario no tiene asignaci\xF3n de tenant/portfolio"),console.error("[V2] Valores recibidos:",{tenantId:e?.tenantId,portfolioId:e?.portfolioId}))}onTenantChange(){this.selectedPortfolioId=void 0,this.portfolios=[],this.selectedTenantId&&(this.loadPortfolios(),this.reloadTypifications(),this.loadCustomerOutputConfig(),this.loadFirstCustomer())}loadPortfolios(){this.selectedTenantId&&this.classificationService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:e=>{this.portfolios=e},error:e=>{console.error("Error loading portfolios:",e)}})}onPortfolioChange(){this.reloadTypifications(),this.loadCustomerOutputConfig()}reloadTypifications(){this.selectedTenantId&&this.apiSystemConfigService.setTenantAndPortfolio(this.selectedTenantId,this.selectedPortfolioId)}loadCustomerOutputConfig(){this.selectedTenantId&&(console.log("[TEMPORAL] loadCustomerOutputConfig - endpoint no existe, usando campos por defecto"),this.setDefaultOutputFields())}loadFirstCustomer(){let e=this.authService.getCurrentUser();if(!e||!e.sipExtension){console.error("\u274C No se pudo obtener la extensi\xF3n SIP del agente logueado"),this.loadClienteDetalle(475);return}console.log(`\u{1F4CB} Buscando llamada activa del agente con extensi\xF3n SIP ${e.sipExtension}...`),this.http.get(`${R.gatewayUrl}/autodialer/active-call/extension/${e.sipExtension}`).pipe(_e(t=>(console.warn("\u26A0\uFE0F No hay llamada activa o error consultando:",t),console.log("\u{1F4CB} Usando contacto de prueba 475"),Ce({contactId:475})))).subscribe({next:t=>{let i=t?.contactId;if(!i){console.warn("\u26A0\uFE0F No se obtuvo contactId de la llamada activa");return}console.log(`\u2705 Llamada activa encontrada, contactId: ${i}`),this.loadClienteDetalle(i)}})}loadClienteDetalle(e){console.log(`\u{1F4CB} Cargando datos del cliente para contacto ${e}...`),this.http.get(`${R.gatewayUrl}/contacts/${e}/cliente-detalle`).pipe(_e(t=>(console.error("\u274C Error cargando datos del cliente:",t),Ce(null)))).subscribe({next:t=>{t?(console.log("\u2705 Cliente cargado:",t),this.customerData.set({id:t.idCliente,id_cliente:`CLI-${t.idCliente}`,nombre_completo:t.nombreCompleto||"",tipo_documento:t.tipoDocumento||"DNI",numero_documento:t.documento||"",fecha_nacimiento:t.fechaNacimiento||"",edad:t.edad||0,contacto:{telefono_principal:t.telefonoPrincipal||"",telefono_alternativo:t.telefonoSecundario||"",telefono_trabajo:t.telefonoTrabajo||"",email:t.email||"",direccion:t.direccion||""},cuenta:{numero_cuenta:t.cuenta||"",tipo_producto:t.producto||"",fecha_desembolso:"",monto_original:0,plazo_meses:0,tasa_interes:0},deuda:{saldo_capital:t.deudaCapital||0,intereses_vencidos:0,mora_acumulada:0,gastos_cobranza:0,saldo_total:t.deudaTotal||0,dias_mora:t.diasMora||0,fecha_ultimo_pago:"",monto_ultimo_pago:0}}),console.log("\u2705 Datos del cliente actualizados en la UI")):console.log("\u26A0\uFE0F No se pudieron cargar los datos del cliente")}})}setDefaultOutputFields(){this.customerOutputFields.set([{id:"numero_documento",label:"DNI/Documento",field:"numero_documento",category:"personal",format:"text",highlight:!0,size:"medium"},{id:"nombre_completo",label:"Nombre Completo",field:"nombre_completo",category:"personal",format:"text",highlight:!1,size:"full"},{id:"telefono_principal",label:"Celular",field:"contacto.telefono_principal",category:"contact",format:"text",highlight:!1,size:"medium"},{id:"email",label:"Email",field:"contacto.email",category:"contact",format:"text",highlight:!1,size:"medium"},{id:"direccion",label:"Direcci\xF3n",field:"contacto.direccion",category:"contact",format:"text",highlight:!1,size:"full"},{id:"edad",label:"Edad",field:"edad",category:"personal",format:"number",highlight:!1,size:"small"},{id:"saldo_total",label:"Deuda Total",field:"deuda.saldo_total",category:"debt",format:"currency",highlight:!0,size:"small"},{id:"dias_mora",label:"D\xEDas de Mora",field:"deuda.dias_mora",category:"debt",format:"number",highlight:!0,size:"small"},{id:"numero_cuenta",label:"Nro. Cuenta",field:"cuenta.numero_cuenta",category:"account",format:"text",highlight:!1,size:"medium"},{id:"tipo_producto",label:"Producto",field:"cuenta.tipo_producto",category:"account",format:"text",highlight:!1,size:"medium"}])}loadManagementHistory(){let e=String(this.customerData().id);console.log("[HISTORIAL] Cargando historial para cliente ID:",e),this.managementService.getManagementsByCustomer(e).subscribe({next:t=>{console.log("[HISTORIAL] Gestiones recibidas del backend:",t),console.log("[HISTORIAL] Total de gestiones:",t.length);let i=t.map(l=>{let m=l.managementDate&&l.managementTime?`${l.managementDate} ${l.managementTime}`:new Date().toLocaleString("es-PE"),x={id:l.id,fecha:m,asesor:l.advisorId,resultado:"Gesti\xF3n realizada",gestion:l.level3Name||l.level2Name||l.level1Name||"-",observacion:l.observations||"Sin observaciones",duracion:"00:00:00",hasSchedule:l.typificationRequiresSchedule||!1,schedule:null};return x.hasSchedule&&this.paymentScheduleService.getPaymentScheduleByManagementId(l.id).subscribe({next:p=>{p&&(x.schedule=p)},error:()=>{}}),x});this.historialGestiones.set(i),console.log("[HISTORIAL] Historial establecido en signal:",this.historialGestiones())},error:t=>{console.error("[HISTORIAL] Error al cargar historial de gestiones:",t),console.error("[HISTORIAL] Detalles del error:",{status:t.status,statusText:t.statusText,message:t.message,url:t.url})}})}formatDateTime(e){let t=new Date(e),i=t.getDate().toString().padStart(2,"0"),l=(t.getMonth()+1).toString().padStart(2,"0"),m=t.getFullYear(),x=t.getHours().toString().padStart(2,"0"),p=t.getMinutes().toString().padStart(2,"0");return`${i}/${l}/${m} ${x}:${p}`}calculateCallDuration(e){return e.durationSeconds?this.formatTime(e.durationSeconds):"00:00:00"}ngOnDestroy(){this.callTimer&&clearInterval(this.callTimer),this.isTipifying()&&(this.isTipifying.set(!1),this.sipService.blockIncomingCallsMode(!1),console.log("\u{1F513} [ngOnDestroy] Desbloqueando llamadas entrantes al salir del componente")),this.callStateSubscription&&this.callStateSubscription.unsubscribe(),this.incomingCallSubscription&&this.incomingCallSubscription.unsubscribe()}cancelarTipificacion(){console.log("\u274C Cancelando tipificaci\xF3n..."),this.isTipifying.set(!1),this.sipService.blockIncomingCallsMode(!1),console.log("\u{1F513} Desbloqueando llamadas entrantes - tipificaci\xF3n cancelada");let t=this.authService.getCurrentUser()?.id||1;this.agentService.changeAgentStatus(t,{estado:se.DISPONIBLE}).subscribe({next:()=>{console.log("\u2705 Estado cambiado a DISPONIBLE, navegando al dashboard..."),this.router.navigate(["/dashboard"])},error:i=>{console.error("\u274C Error al cambiar estado:",i),this.router.navigate(["/dashboard"])}})}openScheduleDetail(e){this.scheduleManagementId.set(e),this.showScheduleDetail.set(!0)}closeScheduleDetail(){this.showScheduleDetail.set(!1),this.scheduleManagementId.set(null)}toggleCall(){this.callActive()?this.endCall():this.startCall()}startCall(){this.callActive.set(!0),this.callDuration.set(0),this.callStartTime=new Date().toISOString(),this.callTimer=window.setInterval(()=>{this.callDuration.update(e=>e+1)},1e3)}endCall(e=!1){console.log("\u{1F4F5} Finalizando llamada..."),this.sipService.hangup(),this.callActive.set(!1),this.callTimer&&(clearInterval(this.callTimer),this.callTimer=void 0),e&&this.router.navigate(["/agent-dashboard"])}formatTime(e){let t=Math.floor(e/3600),i=Math.floor(e%3600/60),l=e%60;return`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`}onContactResultChange(){this.managementForm.tipoGestion="",this.managementForm.motivoNoPago=""}onManagementTypeChange(){}showManagementType(){return this.managementForm.resultadoContacto==="CPC"||this.managementForm.resultadoContacto==="CTT"}usesHierarchicalClassifications(){let e=this.hierarchyLevels();return e.length>0&&e[0].length>0}getTypificationsForLevel(e){return this.hierarchyLevels()[e]||[]}onClassificationLevelChange(e,t){let i=[...this.selectedClassifications()];if(i[e]=t,this.selectedClassifications.set(i.slice(0,e+1)),e===0?(this.managementForm.clasificacionNivel1=t,this.managementForm.clasificacionNivel2="",this.managementForm.clasificacionNivel3=""):e===1?(this.managementForm.clasificacionNivel2=t,this.managementForm.clasificacionNivel3=""):e===2&&(this.managementForm.clasificacionNivel3=t),t){this.managementForm.tipoGestion=t;let l=Number(t);!isNaN(l)&&l>0?this.loadDynamicFields(l):(this.dynamicFields.set([]),this.dynamicFieldValues.set({}),this.isLeafClassification.set(!1))}else{let l=this.selectedClassifications().filter(m=>m).pop();this.managementForm.tipoGestion=l||"",this.dynamicFields.set([]),this.dynamicFieldValues.set({}),this.isLeafClassification.set(!1)}}loadDynamicFields(e){this.isLoadingDynamicFields.set(!0),this.apiSystemConfigService.getClassificationFields(e).subscribe({next:t=>{this.isLeafClassification.set(t.isLeaf),this.dynamicFields.set(t.fields||[]);let l={fields:(t.fields||[]).map((m,x)=>O({id:m.fieldCode,label:m.fieldName,type:m.fieldType.toLowerCase(),required:m.isRequired||!1,placeholder:m.description||"",helpText:m.description,displayOrder:m.displayOrder||0,options:m.options?m.options.map(p=>typeof p=="string"?{value:p,label:p}:{value:p.value||p,label:p.label||p}):void 0,min:m.validationRules?.min,max:m.validationRules?.max,minLength:m.validationRules?.minLength,maxLength:m.validationRules?.maxLength,columns:m.fieldType.toLowerCase()==="table"&&m.columns?m.columns.map(p=>({id:p.id||p.fieldCode,label:p.label||p.fieldName,type:(p.type||p.fieldType).toLowerCase(),required:p.required||p.isRequired||!1,options:p.options?p.options.map(S=>typeof S=="string"?{value:S,label:S}:{value:S.value||S,label:S.label||S}):void 0})):void 0,allowAddRow:m.fieldType.toLowerCase()==="table",allowDeleteRow:m.fieldType.toLowerCase()==="table",minRows:m.minRows||0,maxRows:m.maxRows},m.linkedToField&&{linkedToField:m.linkedToField}))};this.dynamicFieldsSchema.set(l),this.isLoadingDynamicFields.set(!1),this.checkAndLoadPaymentSchedules()},error:t=>{console.error("Error cargando campos din\xE1micos:",t),this.isLoadingDynamicFields.set(!1),this.isLeafClassification.set(!1),this.dynamicFields.set([]),this.dynamicFieldsSchema.set(null)}})}checkAndLoadPaymentSchedules(){let e=this.selectedClassifications();if(e.length===0){this.showScheduleHelper.set(!1);return}let t=e[e.length-1],l=this.managementClassifications().find(m=>m.id.toString()===t);l&&l.requiere_pago?(console.log("[SCHEDULE] Payment typification detected:",l.codigo),console.log("[DEBUG-SCHEDULE] Full typification object:",l),console.log("[DEBUG-SCHEDULE] suggestsFullAmount:",l.suggestsFullAmount),console.log("[DEBUG-SCHEDULE] allowsInstallmentSelection:",l.allowsInstallmentSelection),console.log("[DEBUG-SCHEDULE] requiresManualAmount:",l.requiresManualAmount),this.loadActiveSchedules()):(this.showScheduleHelper.set(!1),this.activeSchedules.set([]))}loadActiveSchedules(){let e=String(this.customerData().id);console.log("[SCHEDULE] Loading active schedules for customer ID:",e),this.isLoadingSchedules.set(!0),this.managementService.getActiveSchedulesByCustomer(e).subscribe({next:t=>{console.log("[SCHEDULE] Active schedules loaded:",t),this.activeSchedules.set(t),this.showScheduleHelper.set(t.length>0),this.isLoadingSchedules.set(!1),t.length>0&&this.suggestPaymentAmount(t[0])},error:t=>{console.error("[SCHEDULE] Error loading schedules:",t),this.isLoadingSchedules.set(!1),this.showScheduleHelper.set(!1)}})}suggestPaymentAmount(e){if(!e.installments||e.installments.length===0)return;let t=e.installments.filter(i=>i.status.status==="PENDING").sort((i,l)=>new Date(i.dueDate).getTime()-new Date(l.dueDate).getTime())[0];if(t){console.log("[SCHEDULE] Suggested payment amount:",t.amount),this.managementForm.montoPago||(this.managementForm.montoPago=t.amount.toFixed(2));let i=O({},this.dynamicFieldValues());i.monto_pagado||(i.monto_pagado=t.amount,this.dynamicFieldValues.set(i))}}applyFullSchedulePayment(){let e=this.activeSchedules();if(e.length===0)return;let t=e[0],i=this.calculatePendingAmount(t);console.log("[BUTTON] Pagar Todo clicked. Amount:",i);let l=this.dynamicFieldsSchema(),m=l?.fields.find(x=>x.type==="currency"||x.id.toLowerCase().includes("monto"));if(m){console.log("[BUTTON] Found monto field:",m.id);let x={};if(x[m.id]=i,l?.fields.some(S=>S.id==="saldo_pendiente")){x.saldo_pendiente=0,console.log("[BUTTON] Saldo pendiente ser\xE1 0 (pago total)");let S=O({},this.dynamicFieldValues());S[m.id]=i,S.saldo_pendiente=0,this.dynamicFieldValues.set(S)}this.externalFieldUpdates.set(x),console.log("[BUTTON] Updated externalFieldUpdates:",x),setTimeout(()=>this.externalFieldUpdates.set({}),100)}else console.warn("[BUTTON] No se encontr\xF3 campo de monto en el schema")}applyNextInstallmentPayment(){console.log("[BUTTON-PP] Usar Pr\xF3xima Cuota clicked!");let e=this.activeSchedules();if(console.log("[BUTTON-PP] Active schedules:",e),e.length===0){console.warn("[BUTTON-PP] No schedules found");return}let t=e[0];console.log("[BUTTON-PP] Using schedule:",t),console.log("[BUTTON-PP] Schedule installments:",t.installments);let i=t.installments.filter(m=>(console.log("[BUTTON-PP] Checking installment:",m,"Status:",m.status?.status),m.status.status==="PENDING"));console.log("[BUTTON-PP] Pending installments:",i);let l=i.sort((m,x)=>new Date(m.dueDate).getTime()-new Date(x.dueDate).getTime())[0];if(console.log("[BUTTON-PP] Next pending installment:",l),l){console.log("[BUTTON-PP] Usar Pr\xF3xima Cuota - Amount:",l.amount);let m=this.dynamicFieldsSchema(),x=m?.fields.find(p=>p.type==="currency"||p.id.toLowerCase().includes("monto"));if(x){console.log("[BUTTON-PP] Found monto field:",x.id);let p={};if(p[x.id]=l.amount,m?.fields.some(j=>j.id==="saldo_pendiente")){let j=this.calculatePendingAmount(t),J=Math.max(0,j-l.amount);p.saldo_pendiente=J,console.log("[BUTTON-PP] Saldo pendiente calculado:",J,"= Total",j,"- Monto",l.amount);let Z=O({},this.dynamicFieldValues());Z[x.id]=l.amount,Z.saldo_pendiente=J,this.dynamicFieldValues.set(Z)}this.externalFieldUpdates.set(p),console.log("[BUTTON-PP] Updated externalFieldUpdates:",p),setTimeout(()=>this.externalFieldUpdates.set({}),100)}else console.warn("[BUTTON-PP] No se encontr\xF3 campo de monto en el schema")}else console.warn("[BUTTON-PP] No pending installment found")}calculatePendingAmount(e){console.log("[CALC] Schedule:",e),console.log("[CALC] Installments:",e.installments);let t=e.installments.filter(l=>(console.log("[CALC] Installment status:",l.status,"Status value:",l.status?.status),l.status.status==="PENDING"));console.log("[CALC] Pending installments:",t);let i=t.reduce((l,m)=>l+m.amount,0);return console.log("[CALC] Total pending amount:",i),i}getPendingInstallments(e){return e.installments?e.installments.filter(t=>t.status.status==="PENDING").sort((t,i)=>new Date(t.dueDate).getTime()-new Date(i.dueDate).getTime()):[]}onDynamicFieldsChange(e){this.dynamicFieldValues.set(e),e.monto_pagado!==void 0&&e.monto_pagado!==null&&this.calculateAndUpdatePendingBalance(e.monto_pagado)}calculateAndUpdatePendingBalance(e){let t=this.activeSchedules();if(t.length===0){console.log("[SALDO] No hay cronogramas activos");return}let i=t[0],l=this.calculatePendingAmount(i),m=Math.max(0,l-(e||0));if(console.log("[SALDO] Total pendiente:",l),console.log("[SALDO] Monto pagado:",e),console.log("[SALDO] Saldo pendiente calculado:",m),this.dynamicFieldsSchema()?.fields.some(S=>S.id==="saldo_pendiente")){console.log("[SALDO] Actualizando campo saldo_pendiente con:",m);let S={saldo_pendiente:m};this.externalFieldUpdates.set(S);let j=O({},this.dynamicFieldValues());j.saldo_pendiente=m,this.dynamicFieldValues.set(j),setTimeout(()=>this.externalFieldUpdates.set({}),100)}}getDynamicLevelLabel(e){if(e===0){let m=this.hierarchyLevels()[0]||[];if(m.length===0)return"Nivel 1";let x=m.map(p=>p.codigo);return x.includes("RP")||x.includes("CSA")?"Tipo de Resultado":"Categor\xEDa Principal"}let t=e-1,i=this.selectedClassifications()[t];if(!i)return`Nivel ${e+1}`;let l=this.managementClassifications().find(m=>m.id==i);return l?e===1?{RP:"Intenci\xF3n de Pago",CSA:"Motivo de No Atenci\xF3n",SC:"Raz\xF3n de No Contacto",GA:"Tipo de Gesti\xF3n"}[l.codigo]||`Detalle de ${l.label}`:`Detalle de ${l.label}`:`Nivel ${e+1}`}shouldShowLevel(e){if(e===0)return this.usesHierarchicalClassifications();let t=e-1;return this.selectedClassifications()[t]?this.getTypificationsForLevel(e).length>0:!1}showPaymentSection(){return this.managementClassifications().find(t=>t.id===this.managementForm.tipoGestion)?.requiere_pago||!1}showScheduleSection(){return this.managementClassifications().find(t=>t.id===this.managementForm.tipoGestion)?.requiere_cronograma||!1}onInstallmentCountChange(){let e=parseInt(this.scheduleForm.numeroCuotas);if(isNaN(e)||e<1){this.scheduleForm.cuotas=[];return}let t=this.scheduleForm.cuotas.length;if(e>t)for(let i=t+1;i<=e;i++)this.scheduleForm.cuotas.push({numero:i,monto:"",fechaVencimiento:""});else e<t&&(this.scheduleForm.cuotas=this.scheduleForm.cuotas.slice(0,e),this.scheduleForm.cuotas.forEach((i,l)=>{i.numero=l+1}))}generateSchedule(){let e=parseInt(this.scheduleForm.numeroCuotas);if(isNaN(e)||e<1){alert("Por favor ingrese un n\xFAmero v\xE1lido de cuotas");return}this.scheduleForm.cuotas=[];for(let t=1;t<=e;t++)this.scheduleForm.cuotas.push({numero:t,monto:"",fechaVencimiento:""})}addInstallmentRow(){let e=this.scheduleForm.cuotas.length+1;this.scheduleForm.cuotas.push({numero:e,monto:"",fechaVencimiento:""}),this.scheduleForm.numeroCuotas=e.toString()}removeInstallmentRow(e){this.scheduleForm.cuotas.length>1&&(this.scheduleForm.cuotas.splice(e,1),this.scheduleForm.cuotas.forEach((t,i)=>{t.numero=i+1}),this.scheduleForm.numeroCuotas=this.scheduleForm.cuotas.length.toString())}getTodayDate(){let e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${l}`}loadMontoNegociadoFromOutput(e){let t=this.customerOutputFields().find(m=>m.id===e);if(!t)return;let i=t.field.split("."),l=this.customerData();for(let m of i)if(l&&typeof l=="object")l=l[m];else{l=null;break}l&&(this.scheduleForm.montoNegociado=l.toString())}toggleScheduleDetail(){this.showScheduleDetail.update(e=>!e)}saveManagement(){if(!this.validateForm())return;this.saving.set(!0);let e,t;if(this.usesHierarchicalClassifications()){let k=this.selectedClassifications(),de=this.managementClassifications(),I=k[k.length-1];if(t=de.find(E=>E.id.toString()===I),t?.parentId){let E=t.parentId;e=de.find(P=>P.id.toString()===E.toString())}else e=t}else e=this.contactClassifications().find(k=>k.id===this.managementForm.resultadoContacto),t=this.managementClassifications().find(k=>k.id===this.managementForm.tipoGestion);let i=this.selectedClassifications(),l=Number(i[0]),m=i[1]?Number(i[1]):null,x=i[2]?Number(i[2]):null,p=this.managementClassifications(),S=p.find(k=>k.id.toString()===i[0]),j=i[1]?p.find(k=>k.id.toString()===i[1]):null,J=i[2]?p.find(k=>k.id.toString()===i[2]):null,Z={customerId:String(this.customerData().id),advisorId:"ADV-001",tenantId:this.selectedTenantId,portfolioId:this.selectedPortfolioId||1,subPortfolioId:1,phone:this.customerData().contacto?.telefono_principal||"",level1Id:l,level1Name:S?.label||"",level2Id:m,level2Name:j?.label||null,level3Id:x,level3Name:J?.label||null,observations:this.managementForm.observaciones};this.managementService.createManagement(Z).subscribe({next:k=>{this.callStartTime&&this.callActive()&&this.registerCallToBackend(k.id),this.onSaveSuccess(e?.label||"",t?.label||"-")},error:k=>{console.error("Error al guardar gesti\xF3n:",k),this.saving.set(!1),alert("\u26A0\uFE0F Error al guardar la gesti\xF3n. Por favor intente nuevamente.")}})}registerCallToBackend(e){if(!this.callStartTime)return;let t={phoneNumber:this.customerData().contacto.telefono_principal,startTime:this.callStartTime};this.managementService.startCall(e,t).subscribe({next:i=>{if(!this.callActive()){let l={endTime:new Date().toISOString()};this.managementService.endCall(e,l).subscribe({next:()=>{},error:m=>console.error("Error al finalizar llamada:",m)})}},error:i=>{console.error("Error al registrar llamada:",i)}})}registerPaymentToBackend(e){if(!this.managementForm.montoPago||!this.managementForm.metodoPago)return;let t={amount:parseFloat(this.managementForm.montoPago),scheduledDate:new Date().toISOString().split("T")[0],paymentMethodType:this.managementForm.metodoPago,paymentMethodDetails:this.managementForm.ultimos4Tarjeta||void 0,voucherNumber:void 0,bankName:this.managementForm.bancoSeleccionado||void 0};this.managementService.registerPayment(e,t).subscribe({next:i=>{},error:i=>{console.error("Error al registrar pago:",i)}})}createScheduleToBackend(e){if(this.scheduleForm.cuotas.length===0)return;if(this.scheduleForm.cuotas.some(l=>!l.monto||!l.fechaVencimiento)){alert("\u26A0\uFE0F Por favor complete todos los montos y fechas de las cuotas");return}let i={customerId:String(this.customerData().id),managementId:e,scheduleType:this.scheduleForm.tipoCronograma,negotiatedAmount:this.scheduleForm.montoNegociado?parseFloat(this.scheduleForm.montoNegociado):null,installments:this.scheduleForm.cuotas.map(l=>({installmentNumber:l.numero,amount:parseFloat(l.monto),dueDate:l.fechaVencimiento}))};this.paymentScheduleService.createPaymentSchedule(i).subscribe({next:l=>{},error:l=>{console.error("Error al crear cronograma:",l),alert("\u26A0\uFE0F Error al crear el cronograma de pagos")}})}onSaveSuccess(e,t){this.saving.set(!1),this.showSuccess.set(!0),this.endCall(!1),this.loadManagementHistory(),this.managementForm={resultadoContacto:"",tipoGestion:"",clasificacionNivel1:"",clasificacionNivel2:"",clasificacionNivel3:"",motivoNoPago:"",metodoPago:"",montoPago:"",fechaCompromiso:"",horaCompromiso:"",ultimos4Tarjeta:"",bancoSeleccionado:"",observaciones:"",notasPrivadas:""},this.callDuration.set(0),this.callStartTime=void 0,this.activeTab.set("historial"),console.log("\u2705 Gesti\xF3n guardada, cambiando estado a DISPONIBLE..."),this.isTipifying.set(!1),this.sipService.blockIncomingCallsMode(!1),console.log("\u2705 Desbloqueando llamadas entrantes - tipificaci\xF3n completada");let l=this.authService.getCurrentUser()?.id||1;this.agentService.changeAgentStatus(l,{estado:se.DISPONIBLE}).subscribe({next:()=>{console.log("\u2705 Estado cambiado a DISPONIBLE"),setTimeout(()=>{this.showSuccess.set(!1),console.log("\u{1F504} Navegando a /agent-dashboard..."),this.router.navigate(["/agent-dashboard"])},2e3)},error:m=>{console.error("\u274C Error cambiando estado:",m),setTimeout(()=>{this.showSuccess.set(!1),this.router.navigate(["/agent-dashboard"])},2e3)}})}validateForm(){let e={};if(this.usesHierarchicalClassifications()){let i=this.selectedClassifications();if(i.length===0||!i[i.length-1])e.typification="Debe seleccionar una clasificaci\xF3n";else{let l=i[i.length-1];this.managementClassifications().some(p=>p.parentId&&Number(p.parentId)===Number(l))&&(e.typification="Debe completar todos los niveles de clasificaci\xF3n")}}else this.managementForm.resultadoContacto||(e.resultadoContacto="Requerido"),this.showManagementType()&&!this.managementForm.tipoGestion&&(e.tipoGestion="Requerido");let t=this.dynamicFieldsSchema();if(t&&t.fields&&t.fields.length>0){let i=this.dynamicFieldValues();for(let l of t.fields)if(l.required){let m=i[l.id];(m==null||m==="")&&(e[`dynamic_${l.id}`]=`${l.label} es requerido`),l.type==="table"&&(!Array.isArray(m)||m.length===0)&&(e[`dynamic_${l.id}`]=`${l.label} debe tener al menos una fila`)}}return this.errors.set(e),Object.keys(e).length>0?(alert("Por favor complete todos los campos requeridos"),!1):!0}calculateRemaining(){if(!this.managementForm.montoPago)return"0.00";let e=parseFloat(this.managementForm.montoPago);return(this.customerData().deuda.saldo_total-e).toFixed(2)}toggleDarkMode(){this.themeService.toggleTheme()}getFieldValue(e){let t=this.customerData();return t?e.split(".").reduce((i,l)=>i?.[l],t):null}formatFieldValue(e,t){if(e==null||e==="")return"-";switch(t){case"currency":return"S/ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",");case"number":return String(e);case"date":return typeof e=="string"?new Date(e).toLocaleDateString("es-PE"):String(e);default:return String(e)}}getContactClassificationLabel(e){let t=this.contactClassifications().find(l=>l.id===e);if(!t)return e;let i=t.label||t.codigo;return`[${t.codigo}] ${i}`}getManagementClassificationLabel(e){let t=this.managementClassifications().find(l=>l.id===e);if(!t)return e;let i=t.label||t.codigo;return`[${t.codigo}] ${i}`}getTableRows(e){let t=this.dynamicFieldValues()[e];return Array.isArray(t)?t:[]}addTableRow(e,t){if(!Array.isArray(t)){console.error("addTableRow: columns no es un array v\xE1lido",t);return}let i=O({},this.dynamicFieldValues());Array.isArray(i[e])||(i[e]=[]);let l=this.createEmptyTableRow(t);i[e].push(l),this.dynamicFieldValues.set(i)}removeTableRow(e,t){let i=O({},this.dynamicFieldValues());Array.isArray(i[e])&&(i[e].splice(t,1),this.dynamicFieldValues.set(i))}createEmptyTableRow(e){let t={};return e.forEach(i=>{i.type==="auto-number"?t[i.id]=null:i.type==="number"||i.type==="currency"?t[i.id]=i.defaultValue||0:(i.type,t[i.id]=i.defaultValue||"")}),t}searchByTestDocument(){if(!this.testDocument.trim()||!this.selectedTenantId){console.warn("[TEST] Documento vac\xEDo o tenant no seleccionado");return}console.log("[TEST] Buscando cliente por documento:",this.testDocument),this.customerService.searchCustomersByCriteria(this.selectedTenantId,"documento",this.testDocument).subscribe({next:e=>{e&&e.length>0?(console.log("[TEST] Cliente encontrado:",e[0]),this.loadCustomerFromResource(e[0])):(console.warn("[TEST] No se encontr\xF3 cliente con documento:",this.testDocument),alert("No se encontr\xF3 cliente con el documento: "+this.testDocument))},error:e=>{console.error("[TEST] Error buscando cliente:",e),alert("Error buscando cliente")}})}searchByTestPhone(){if(!this.testPhone.trim()||!this.selectedTenantId){console.warn("[TEST] Tel\xE9fono vac\xEDo o tenant no seleccionado");return}console.log("[TEST] Buscando cliente por tel\xE9fono:",this.testPhone),this.customerService.searchCustomersByCriteria(this.selectedTenantId,"telefono",this.testPhone).subscribe({next:e=>{e&&e.length>0?(console.log("[TEST] Cliente encontrado:",e[0]),this.loadCustomerFromResource(e[0])):(console.warn("[TEST] No se encontr\xF3 cliente con tel\xE9fono:",this.testPhone),alert("No se encontr\xF3 cliente con el tel\xE9fono: "+this.testPhone))},error:e=>{console.error("[TEST] Error buscando cliente:",e),alert("Error buscando cliente")}})}loadCustomerFromResource(e){console.log("[TEST] Cargando cliente:",e),this.customerData.set({id:e.id,id_cliente:e.documentNumber||e.identificationCode,nombre_completo:e.fullName||"",tipo_documento:e.documentType||"DNI",numero_documento:e.documentNumber||"",fecha_nacimiento:e.birthDate||"",edad:e.age||null,contacto:{telefono_principal:e.contactMethods?.find(t=>t.subtype==="telefono_principal")?.value||"",telefono_alternativo:e.contactMethods?.find(t=>t.subtype==="telefono_secundario")?.value||"",telefono_trabajo:e.contactMethods?.find(t=>t.subtype==="telefono_trabajo")?.value||"",email:e.contactMethods?.find(t=>t.contactType==="email")?.value||"",direccion:e.address||""},cuenta:{numero_cuenta:e.accountNumber||"",tipo_producto:"PR\xC9STAMO",fecha_desembolso:"2024-01-15",monto_original:e.principalAmount||0,plazo_meses:12,tasa_interes:2.5},deuda:{saldo_capital:e.principalAmount||0,intereses_vencidos:0,mora_acumulada:e.overdueAmount||0,gastos_cobranza:0,saldo_total:(e.principalAmount||0)+(e.overdueAmount||0),dias_mora:e.overdueDays||0,fecha_ultimo_pago:"",monto_ultimo_pago:0}}),this.loadManagementHistory(),console.log("[TEST] Cliente cargado exitosamente")}hangupCall(){console.log("\u{1F4F5} Colgando llamada..."),this.sipService.hangup()}toggleMute(){this.isMuted()?(console.log("\u{1F50A} Desmuteando..."),this.sipService.unmute(),this.isMuted.set(!1)):(console.log("\u{1F507} Muteando..."),this.sipService.mute(),this.isMuted.set(!0))}isInActiveCall(){return this.callState===q.ACTIVE}getCallStateText(){switch(this.callState){case q.IDLE:return"LISTO";case q.CONNECTING:return"CONECTANDO...";case q.RINGING:return"TIMBRANDO...";case q.ACTIVE:return"EN LLAMADA";case q.ENDED:return"FINALIZADA";default:return"DESCONOCIDO"}}};c.\u0275fac=function(t){return new(t||c)(T(We),T(Qe),T(oe),T(Be),T(qe),T(ve),T(Ye),T(Je),T(we),T(Q),T(Re),T(Ue),T(Me))},c.\u0275cmp=X({type:c,selectors:[["app-collection-management"]],viewQuery:function(t,i){if(t&1&&ue(_t,5),t&2){let l;ge(l=pe())&&(i.dynamicFieldRenderer=l.first)}},decls:107,vars:42,consts:[["dynamicFieldRendererComponent",""],[1,"h-[100dvh]","bg-gradient-to-br","from-slate-50","via-blue-50","to-slate-100","dark:from-slate-950","dark:via-gray-950","dark:to-black","flex","flex-col","overflow-hidden","transition-colors","duration-300"],[1,"fixed","top-4","right-4","z-50","animate-[slideInRight_0.5s_ease-out]"],[1,"bg-gradient-to-r","from-slate-900","via-blue-900","to-slate-900","dark:from-slate-950","dark:via-blue-950","dark:to-slate-950","text-white","shadow-md","relative","overflow-hidden"],[1,"relative","px-3","py-1"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","gap-1.5"],[1,"bg-blue-500","dark:bg-blue-600","p-1","rounded"],[1,"text-sm","font-bold"],[1,"text-[9px]","text-blue-200","dark:text-blue-300","flex","items-center","gap-0.5"],[1,"h-6","w-px","bg-white/20"],[1,"text-xs"],[1,"text-blue-200","dark:text-blue-300","text-[9px]"],[1,"font-semibold","text-white","text-xs"],[1,"flex","items-center","gap-2"],["title","Cambiar tema",3,"click"],[1,"text-[10px]","text-yellow-300","font-semibold"],[1,"text-[10px]","text-white","font-semibold"],[1,"text-right"],[1,"bg-white","dark:bg-slate-900","border-b","border-blue-400","dark:border-slate-700","shadow-sm","relative","overflow-hidden"],[1,"absolute","inset-0","bg-gradient-to-r","from-blue-50","dark:from-blue-950/50","to-transparent","opacity-50"],[1,"flex","items-center","gap-3","text-xs"],[1,"text-[9px]","text-gray-500","dark:text-white","uppercase","font-semibold","flex","items-center","gap-0.5"],[1,"text-xs","font-bold","text-gray-900","dark:text-white"],[1,"h-6","w-px","bg-gray-200","dark:bg-gray-700"],[1,"text-[9px]","text-gray-500","dark:text-white"],[1,"font-semibold","text-gray-800","dark:text-white","text-[10px]"],[1,"font-semibold","text-gray-800","dark:text-white","font-mono","text-[10px]"],[1,"text-right","bg-red-50","dark:bg-red-950/30","px-2","py-1","rounded","border","border-red-200","dark:border-red-900/50"],[1,"text-[9px]","text-red-600","dark:text-red-200","font-semibold","flex","items-center","justify-end","gap-0.5"],[1,"text-sm","font-bold","text-red-600","dark:text-red-100"],[1,"text-right","bg-orange-50","dark:bg-orange-950/30","px-2","py-1","rounded","border","border-orange-200","dark:border-orange-900/50"],[1,"text-[9px]","text-orange-600","dark:text-orange-200","font-semibold","flex","items-center","justify-end","gap-0.5"],[1,"text-sm","font-bold","text-orange-600","dark:text-orange-100"],[1,"flex-1","flex","overflow-hidden"],[1,"w-80","bg-white","dark:bg-slate-900","border-r","dark:border-slate-800","shadow-lg","overflow-hidden","flex","flex-col","transition-colors","duration-300"],[1,"flex","border-b","dark:border-slate-800","bg-slate-50","dark:bg-slate-950"],[3,"class"],[1,"flex-1","overflow-y-auto","p-2"],[1,"space-y-2"],[1,"flex-1","overflow-y-auto","bg-gradient-to-br","from-gray-50","via-slate-50","to-blue-50","dark:from-slate-900","dark:via-gray-900","dark:to-slate-900","transition-colors","duration-300"],[1,"p-3","space-y-2"],[1,"font-bold","text-gray-800","dark:text-white","flex","items-center","gap-2","text-xs"],[1,"flex","gap-2"],[3,"click","disabled"],[1,"px-4","py-1.5","bg-gradient-to-r","from-red-600","to-red-700","hover:from-red-700","hover:to-red-800","disabled:from-gray-400","disabled:to-gray-500","text-white","dark:text-white","disabled:text-gray-200","rounded-lg","font-bold","flex","items-center","gap-2","transition-all","duration-300","text-xs","shadow-md","hover:shadow-lg",3,"click","disabled"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-md","border","border-gray-200","dark:border-gray-700","p-2","hover:border-blue-300","dark:hover:border-blue-600","transition-colors","duration-300"],[1,"bg-indigo-50","dark:bg-indigo-950/20","border","border-indigo-200","dark:border-indigo-900/50","rounded-lg","shadow-md","p-3"],[1,"bg-gray-50","dark:bg-gray-900/20","border","border-gray-200","dark:border-gray-700","rounded-lg","shadow-md","p-3"],[3,"schema","externalUpdates","selectedClassification"],[1,"bg-purple-50","dark:bg-purple-950/20","border","border-purple-200","dark:border-purple-900/50","rounded-lg","shadow-md","p-3","animate-pulse"],[1,"bg-gradient-to-r","from-purple-50","to-indigo-50","dark:from-purple-950/30","dark:to-indigo-950/30","border-2","border-purple-300","dark:border-purple-700","rounded-lg","shadow-lg","p-3","space-y-2"],[1,"flex","gap-2","pt-2"],[1,"flex-1","bg-gradient-to-r","from-blue-600","to-blue-700","hover:from-blue-700","hover:to-blue-800","disabled:from-gray-400","disabled:to-gray-500","text-white","dark:text-white","disabled:text-gray-200","py-2","px-4","rounded-lg","font-bold","text-xs","flex","items-center","justify-center","gap-2","transition-all","duration-300","shadow-lg","hover:shadow-xl","disabled:cursor-not-allowed",3,"click","disabled","title"],[1,"px-6","bg-gradient-to-r","from-gray-400","to-gray-500","hover:from-gray-500","hover:to-gray-600","text-white","dark:text-white","py-2","rounded-lg","font-bold","text-xs","flex","items-center","justify-center","gap-2","transition-all","duration-300","shadow-md","hover:shadow-lg",3,"click"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","p-4","bg-black/50","backdrop-blur-sm","animate-fadeIn"],[1,"bg-gradient-to-r","from-green-500","to-emerald-600","text-white","px-6","py-4","rounded-lg","shadow-2xl","flex","items-center","gap-3"],[1,"font-bold"],[1,"text-sm","opacity-90"],[3,"click"],[1,"flex","items-center","justify-center","gap-1"],[1,"absolute","bottom-0","left-0","right-0","h-0.5","bg-blue-500"],[1,"grid","grid-cols-4","gap-2"],[1,"rounded-lg","border","p-2","transition-all",3,"col-span-1","col-span-2","col-span-3","col-span-4","bg-cyan-50","dark:bg-cyan-950/30","border-cyan-300","dark:border-cyan-900/50","bg-slate-50","dark:bg-slate-900/50","border-slate-200","dark:border-slate-700"],[1,"text-center","py-4","text-slate-500","dark:text-slate-400","text-xs"],[1,"rounded-lg","border","p-2","transition-all"],[1,"flex","items-start","justify-between","gap-2"],[1,"flex-1","min-w-0"],[1,"text-[9px]","font-bold","uppercase","tracking-wide","mb-0.5","flex","items-center","gap-1"],[1,"text-[11px]","font-bold","break-words"],[1,"text-[10px]","mt-1"],[1,"bg-slate-50","dark:bg-slate-900/50","border","border-slate-200","dark:border-slate-700","rounded-lg","p-2"],[1,"text-[10px]","font-bold","text-slate-800","dark:text-white","mb-1","flex","items-center","gap-1"],[1,"space-y-1","text-[10px]"],[1,"flex","justify-between"],[1,"text-slate-600","dark:text-slate-200"],[1,"font-bold","text-slate-900","dark:text-white"],[1,"bg-red-50","dark:bg-red-950/30","border","border-red-300","dark:border-red-900/50","rounded-lg","p-2"],[1,"text-[10px]","font-bold","text-red-800","dark:text-red-100","mb-1","flex","items-center","gap-1"],[1,"flex","justify-between","bg-white","dark:bg-gray-800/50","rounded","px-1"],[1,"text-red-700","dark:text-red-200"],[1,"font-bold","text-red-900","dark:text-white"],[1,"flex","justify-between","bg-white","rounded","px-1"],[1,"text-red-700"],[1,"font-bold","text-red-900"],[1,"h-px","bg-red-300","my-1"],[1,"flex","justify-between","bg-red-200","rounded","px-1","py-0.5"],[1,"text-center","py-8","space-y-3"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-200"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1"],[1,"text-xs","text-gray-400","dark:text-gray-500","mt-2"],[1,"px-4","py-2","bg-blue-500","hover:bg-blue-600","text-white","text-xs","rounded-lg","transition-colors","flex","items-center","gap-2","mx-auto",3,"click"],[1,"bg-gray-50","dark:bg-gray-800","border","border-gray-200","dark:border-gray-700","rounded-lg","p-2"],[1,"flex","justify-between","items-start","mb-1"],[1,"text-[9px]","font-bold","text-gray-700","dark:text-gray-100","flex","items-center","gap-1"],[1,"text-[9px]","text-gray-500","dark:text-gray-200","bg-gray-200","dark:bg-gray-700","px-1","rounded"],[1,"font-bold","text-blue-700","dark:text-blue-200","bg-blue-50","dark:bg-blue-950/30","px-2","py-0.5","rounded","inline-block"],[1,"font-semibold","text-green-700","dark:text-green-200","bg-green-50","dark:bg-green-950/30","px-2","py-0.5","rounded","inline-block","ml-1"],[1,"text-[9px]","text-gray-600","dark:text-gray-100","italic","mt-1","bg-white","dark:bg-gray-900","p-1","rounded","leading-tight"],[1,"text-[9px]","text-gray-500","dark:text-gray-100"],[1,"mt-2","p-2","bg-purple-50","dark:bg-purple-950/30","border","border-purple-200","dark:border-purple-800","rounded"],[1,"flex","items-center","justify-between","gap-1","mb-1"],[1,"flex","items-center","gap-1"],[1,"text-[9px]","font-bold","text-purple-900","dark:text-purple-200","uppercase"],["type","button",1,"text-[8px]","px-1.5","py-0.5","bg-purple-600","hover:bg-purple-700","text-white","rounded","transition-colors","font-bold",3,"click"],[1,"text-[9px]","text-purple-800","dark:text-purple-300"],[1,"text-[8px]","text-purple-600","dark:text-purple-400","mt-0.5"],[1,"block","font-bold","text-gray-800","dark:text-white","mb-1","text-[11px]","flex","items-center","gap-1"],[1,"w-1.5","h-1.5","bg-red-500","rounded-full"],[1,"relative"],[3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"text-red-600","text-[10px]","mt-1","flex","items-center","gap-1"],[1,"bg-green-50","dark:bg-green-950/30","rounded-lg","shadow-md","border","border-green-300","dark:border-green-900/50","p-2","mb-2","animate-[fadeIn_0.3s_ease-in]"],[1,"text-red-600","dark:text-red-400","text-[10px]","mt-1","flex","items-center","gap-1"],[1,"flex","items-center","justify-center","gap-2","text-indigo-600","dark:text-indigo-400"],[1,"flex","items-center","justify-center","gap-2","text-gray-500","dark:text-gray-400"],[3,"dataChange","schema","externalUpdates","selectedClassification"],[1,"flex","items-center","justify-center","gap-2","text-purple-600","dark:text-purple-400"],[1,"text-xs","font-semibold"],[1,"p-1.5","bg-purple-500","dark:bg-purple-600","rounded"],[1,"text-xs","font-bold","text-purple-900","dark:text-purple-100"],[1,"text-[9px]","text-purple-600","dark:text-purple-300"],[1,"bg-white","dark:bg-gray-800","rounded-lg","border","border-purple-200","dark:border-purple-700","p-2","space-y-2"],[1,"text-[9px]","px-1.5","py-0.5","bg-green-100","dark:bg-green-900/30","text-green-700","dark:text-green-300","rounded","font-semibold"],[1,"space-y-1"],[1,"text-[9px]","font-bold","text-gray-600","dark:text-gray-300","uppercase"],[1,"text-[9px]","text-center","text-gray-500","dark:text-gray-400","italic"],[1,"flex","gap-2","pt-1"],["type","button",1,"flex-1","px-3","py-1.5","bg-purple-600","hover:bg-purple-700","dark:bg-purple-700","dark:hover:bg-purple-600","text-white","text-[10px]","font-bold","rounded","transition-colors","flex","items-center","justify-center","gap-1"],["type","button",1,"flex-1","px-3","py-1.5","bg-indigo-600","hover:bg-indigo-700","dark:bg-indigo-700","dark:hover:bg-indigo-600","text-white","text-[10px]","font-bold","rounded","transition-colors","flex","items-center","justify-center","gap-1"],[1,"text-[9px]","text-purple-600","dark:text-purple-400","bg-purple-100","dark:bg-purple-900/20","p-1.5","rounded","flex","items-start","gap-1"],[1,"flex","items-center","justify-between","text-[10px]","bg-gray-50","dark:bg-gray-900","p-1.5","rounded"],[1,"font-semibold","text-gray-700","dark:text-gray-300"],[1,"text-gray-500","dark:text-gray-400"],[1,"font-bold","text-purple-700","dark:text-purple-300"],["type","button",1,"flex-1","px-3","py-1.5","bg-purple-600","hover:bg-purple-700","dark:bg-purple-700","dark:hover:bg-purple-600","text-white","text-[10px]","font-bold","rounded","transition-colors","flex","items-center","justify-center","gap-1",3,"click"],["type","button",1,"flex-1","px-3","py-1.5","bg-indigo-600","hover:bg-indigo-700","dark:bg-indigo-700","dark:hover:bg-indigo-600","text-white","text-[10px]","font-bold","rounded","transition-colors","flex","items-center","justify-center","gap-1",3,"click"],[1,"bg-white","dark:bg-slate-900","rounded-xl","shadow-2xl","max-w-6xl","w-full","max-h-[90vh]","overflow-hidden","flex","flex-col","animate-slideInUp"],[1,"bg-gradient-to-r","from-purple-600","to-purple-700","dark:from-purple-700","dark:to-purple-800","text-white","px-6","py-4","flex","items-center","justify-between"],[1,"text-lg","font-bold"],["type","button",1,"p-2","hover:bg-white/20","rounded-lg","transition-colors",3,"click"],[1,"flex-1","overflow-y-auto","p-6"],[3,"managementId"],[1,"px-6","py-4","bg-slate-50","dark:bg-slate-800/50","border-t","border-slate-200","dark:border-slate-700","flex","justify-end"],["type","button",1,"px-4","py-2","text-sm","font-semibold","text-slate-700","dark:text-slate-300","hover:bg-slate-200","dark:hover:bg-slate-700","rounded-lg","transition-colors",3,"click"]],template:function(t,i){t&1&&(o(0,"div",1),h(1,St,7,0,"div",2),o(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div")(7,"div",7),M(8,"div",8),o(9,"div")(10,"h1",9),s(11,"Gesti\xF3n de Cobranza"),a(),o(12,"p",10),s(13),a()()()(),M(14,"div",11),o(15,"div",12)(16,"div",13),s(17,"Asesor"),a(),o(18,"div",14),s(19,"Mar\xEDa Gonz\xE1lez Castro"),a()()(),o(20,"div",15)(21,"button",16),v("click",function(){return i.toggleDarkMode()}),h(22,yt,2,0,"span",17)(23,Et,2,0,"span",18),a(),M(24,"div",11),o(25,"div",19)(26,"div",13),s(27,"Estado"),a(),o(28,"div"),s(29),a()(),o(30,"div"),s(31),a()()()()(),o(32,"div",20),M(33,"div",21),o(34,"div",4)(35,"div",5)(36,"div",22)(37,"div")(38,"div",23),s(39," Cliente "),a(),o(40,"div",24),s(41),a()(),M(42,"div",25),o(43,"div")(44,"div",26),s(45,"Documento"),a(),o(46,"div",27),s(47),a()(),M(48,"div",25),o(49,"div")(50,"div",26),s(51,"ID Cliente"),a(),o(52,"div",28),s(53),a()(),M(54,"div",25),o(55,"div")(56,"div",26),s(57,"Cuenta"),a(),o(58,"div",27),s(59),a()()(),o(60,"div",15)(61,"div",29)(62,"div",30),s(63," Deuda "),a(),o(64,"div",31),s(65),a()(),o(66,"div",32)(67,"div",33),s(68," Mora "),a(),o(69,"div",34),s(70),a()()()()()(),o(71,"div",35)(72,"div",36)(73,"div",37),$(74,kt,4,4,"button",38,re),a(),o(76,"div",39)(77,"div"),h(78,wt,5,1,"div",40),h(79,Mt,60,10,"div",40),h(80,Vt,3,1,"div",40),a()()(),o(81,"div",41)(82,"div",42)(83,"div")(84,"div",5)(85,"h3",43),M(86,"div"),s(87," Control de Llamada "),a(),o(88,"div",44)(89,"button",45),v("click",function(){return i.toggleMute()}),s(90),a(),o(91,"button",46),v("click",function(){return i.endCall()}),s(92," Finalizar "),a()()()(),h(93,Rt,11,4,"div",47),h(94,Ht,2,0),h(95,Gt,4,0,"div",48),h(96,zt,4,0,"div",49),h(97,Wt,2,3,"app-dynamic-field-renderer",50),h(98,Qt,4,0,"div",51),h(99,ti,11,1,"div",52),o(100,"div",53)(101,"button",54),v("click",function(){return i.saveManagement()}),h(102,ii,1,0)(103,ai,1,0),a(),o(104,"button",55),v("click",function(){return i.cancelarTipificacion()}),s(105," Cancelar "),a()()()()(),h(106,ni,15,2,"div",56),a()),t&2&&(d(),f(i.showSuccess()?1:-1),d(12),g(" ",i.campaign().nombre," "),d(8),D("flex items-center gap-1.5 px-2 py-1.5 rounded-lg transition-all duration-300 group border "+(i.themeService.isDarkMode()?"bg-yellow-500/20 hover:bg-yellow-500/30 border-yellow-500/40":"bg-blue-500/90 hover:bg-blue-600 border-blue-600")),Te("aria-label",i.themeService.isDarkMode()?"Activar modo claro":"Activar modo oscuro"),d(),f(i.themeService.isDarkMode()?22:23),d(6),D("font-semibold text-xs transition-all duration-300 "+(i.callActive()?"text-green-400 animate-pulse":i.isTipifying()?"text-yellow-400":"text-slate-300 dark:text-slate-200")),d(),g(" ",i.callActive()?"\u25CF EN LLAMADA":i.isTipifying()?"\u270E TIPIFICANDO":"\u25CB DISPONIBLE"," "),d(),D("px-3 py-1 rounded font-mono text-base font-bold transition-all duration-300 "+(i.callActive()?"bg-gradient-to-r from-red-600 to-red-700 animate-pulse":"bg-slate-800/50 dark:bg-gray-900/80")),d(),g(" ",i.formatTime(i.callDuration())," "),d(10),U(i.customerData().nombre_completo),d(6),le("",i.customerData().tipo_documento,": ",i.customerData().numero_documento),d(6),U(i.customerData().id_cliente),d(6),U(i.customerData().cuenta.numero_cuenta),d(6),g("S/ ",i.customerData().deuda.saldo_total.toFixed(2)),d(5),U(i.customerData().deuda.dias_mora),d(4),B(i.tabs),d(4),f(i.activeTab()==="cliente"?78:-1),d(),f(i.activeTab()==="cuenta"?79:-1),d(),f(i.activeTab()==="historial"?80:-1),d(3),D("bg-white dark:bg-gray-800 rounded-lg shadow-md border p-2 transition-colors duration-300 "+(i.callActive()?"border-green-400 dark:border-green-500":"border-gray-200 dark:border-gray-700")),d(3),D("p-1 rounded transition-all duration-300 "+(i.callActive()?"bg-green-100 dark:bg-green-900/30 animate-pulse":"bg-blue-100 dark:bg-blue-900/30")),d(3),D("px-4 py-1.5 rounded-lg font-bold flex items-center gap-2 transition-all duration-300 text-xs shadow-md hover:shadow-lg "+(i.callActive()?i.isMuted()?"bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white":"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white":"bg-gray-400 text-gray-200 cursor-not-allowed")),H("disabled",!i.callActive()),d(),g(" ",i.isMuted()?"\u{1F507} Activar":"\u{1F50A} Silenciar"," "),d(),H("disabled",!i.callActive()),d(2),f(i.usesHierarchicalClassifications()?-1:93),d(),f(i.usesHierarchicalClassifications()?94:-1),d(),f(i.isLoadingDynamicFields()?95:-1),d(),f(!i.isLoadingDynamicFields()&&i.isLeafClassification()&&i.dynamicFields().length===0?96:-1),d(),f(!i.isLoadingDynamicFields()&&i.isLeafClassification()&&i.dynamicFieldsSchema()?97:-1),d(),f(i.isLoadingSchedules()?98:-1),d(),f(!i.isLoadingSchedules()&&i.showScheduleHelper()&&i.activeSchedules().length>0?99:-1),d(2),H("disabled",i.saving()||!i.isFormValid())("title","Guardando: "+i.saving()+" | V\xE1lido: "+i.isFormValid()),d(),f(i.saving()?102:103),d(4),f(i.showScheduleDetail()&&i.scheduleManagementId()?106:-1))},dependencies:[ne,xe,Le,Ve,Ae,fe,be,$e,ze,ae],styles:["@keyframes _ngcontent-%COMP%_slideInRight{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}"]});let r=c;return r})();export{ji as CollectionManagementPage};
