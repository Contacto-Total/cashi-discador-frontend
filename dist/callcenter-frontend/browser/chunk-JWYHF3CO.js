import{a as Z}from"./chunk-FYJX7DO7.js";import{a as ee}from"./chunk-LL26DHMR.js";import{a as U,b as K,c as Q,d as R,e as X,f as Y}from"./chunk-UVU2MZPI.js";import"./chunk-PXL5Y6WR.js";import"./chunk-HQPDVYNW.js";import{a as $}from"./chunk-ZP3TNI7E.js";import{E as H,f as j,k as B,s as J,t as G,u as q}from"./chunk-7GV7UZOL.js";import{$b as W,_b as L}from"./chunk-W3UIH3CO.js";import"./chunk-YQKVMPSG.js";import{Fb as x,Gb as C,Jb as v,Kb as y,Lb as m,Mb as t,Nb as i,Ob as u,Vb as F,Xb as f,Zb as b,a as T,ab as r,b as k,gb as w,kc as O,lc as l,mc as A,md as z,na as h,nb as V,nc as S,oa as _,oc as M,qc as P,rc as E,sb as N,sc as D,xa as g}from"./chunk-SN4XSKG7.js";var I=(o,d)=>d.id;function te(o,d){o&1&&(u(0,"div",16),t(1,"span"),l(2,"Guardando..."),i())}function ie(o,d){o&1&&(u(0,"lucide-angular",17),t(1,"span"),l(2,"Guardar Cambios"),i()),o&2&&m("size",18)}function ne(o,d){if(o&1&&(t(0,"option",13),l(1),i()),o&2){let a=d.$implicit;m("value",a.id),r(),M("",a.tenantName," (",a.tenantCode,")")}}function oe(o,d){if(o&1&&(t(0,"option",13),l(1),i()),o&2){let a=d.$implicit;m("value",a.id),r(),M("",a.portfolioName," (",a.portfolioCode,")")}}function re(o,d){if(o&1&&(t(0,"option",13),l(1),i()),o&2){let a=d.$implicit;m("value",a.id),r(),M("",a.subPortfolioName," (",a.subPortfolioCode,")")}}function ae(o,d){o&1&&(t(0,"div",25),u(1,"div",26),t(2,"p",27),l(3,"Cargando campos de montos..."),i()())}function le(o,d){o&1&&(t(0,"div",25)(1,"div",28),u(2,"lucide-angular",29),i(),t(3,"p",30),l(4,"No se encontraron campos de montos"),i(),t(5,"p",31),l(6," Esta subcartera no tiene campos num\xE9ricos decimales configurados "),i()()),o&2&&(r(2),m("size",32))}function se(o,d){o&1&&u(0,"div",52)}function de(o,d){if(o&1){let a=F();t(0,"div",38)(1,"div",39)(2,"div",40),u(3,"lucide-angular",41),i(),t(4,"div",42),l(5),i(),t(6,"div",43)(7,"div",44),l(8),i(),t(9,"div",45),l(10),i()(),t(11,"div",46),l(12),i()(),t(13,"label",47)(14,"input",48),f("change",function(){let s=h(a).$implicit,e=b(3);return _(e.toggleVisibility(s))}),i(),u(15,"div",49),t(16,"span",50),l(17),i()(),N(18,se,1,0,"div",51),i()}if(o&2){let a=d.$implicit,n=d.$index;r(3),m("size",20),r(2),S(" ",n+1," "),r(3),A(a.nombre),r(2),A(a.codigo),r(2),S(" ",a.tipoSql," "),r(2),m("checked",a.isVisible),r(2),O(a.isVisible?"text-amber-400":"text-gray-500"),r(),S(" ",a.isVisible?"Visible":"Oculto"," ")}}function me(o,d){if(o&1){let a=F();t(0,"div",32)(1,"div",2)(2,"span",33),l(3),i(),t(4,"div",34)(5,"button",35),f("click",function(){h(a);let s=b(2);return _(s.toggleAll(!0))}),l(6," Mostrar todos "),i(),t(7,"button",36),f("click",function(){h(a);let s=b(2);return _(s.toggleAll(!1))}),l(8," Ocultar todos "),i()()()(),t(9,"div",37),f("cdkDropListDropped",function(s){h(a);let e=b(2);return _(e.drop(s))}),v(10,de,19,9,"div",38,I),i()}if(o&2){let a=b(2);r(3),S(" ",a.amountFields().length," campos de montos encontrados "),r(7),y(a.amountFields())}}function ce(o,d){if(o&1&&(t(0,"div",1)(1,"div",18)(2,"div",19),u(3,"lucide-angular",20),t(4,"div")(5,"p",21),l(6,"Instrucciones"),i(),t(7,"ul",22)(8,"li"),l(9,"Use los toggles para mostrar u ocultar cada campo de monto en el panel de deuda"),i(),t(10,"li"),l(11,"Arrastre los campos para cambiar el orden de visualizaci\xF3n"),i(),t(12,"li"),l(13,'Los cambios se guardan al hacer clic en "Guardar Cambios"'),i()()()()()(),t(14,"div",23)(15,"div",24),x(16,ae,4,0,"div",25)(17,le,7,1,"div",25)(18,me,12,1),i()()),o&2){let a=b();r(3),m("size",20),r(13),C(a.loading()?16:a.amountFields().length===0?17:18)}}function pe(o,d){o&1&&(t(0,"div",15),u(1,"lucide-angular",53),t(2,"span"),l(3,"Cambios guardados exitosamente"),i()()),o&2&&(r(),m("size",20))}var Pe=(()=>{let d=class d{constructor(n,s,e){this.typificationService=n,this.portfolioService=s,this.managementService=e,this.tenants=g([]),this.portfolios=g([]),this.subPortfolios=g([]),this.amountFields=g([]),this.originalFields=g([]),this.loading=g(!1),this.saving=g(!1),this.showSuccess=g(!1),this.selectedTenantId=0,this.selectedPortfolioId=0,this.selectedSubPortfolioId=0}ngOnInit(){this.loadTenants()}loadTenants(){this.typificationService.getAllTenants().subscribe({next:n=>{this.tenants.set(n)},error:n=>{console.error("Error loading tenants:",n)}})}onTenantChange(){this.selectedPortfolioId=0,this.selectedSubPortfolioId=0,this.portfolios.set([]),this.subPortfolios.set([]),this.amountFields.set([]),this.originalFields.set([]),this.selectedTenantId>0&&this.loadPortfolios()}loadPortfolios(){this.portfolioService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:n=>{this.portfolios.set(n)},error:n=>{console.error("Error loading portfolios:",n)}})}onPortfolioChange(){this.selectedSubPortfolioId=0,this.subPortfolios.set([]),this.amountFields.set([]),this.originalFields.set([]),this.selectedPortfolioId>0&&this.loadSubPortfolios()}loadSubPortfolios(){this.portfolioService.getSubPortfoliosByPortfolio(this.selectedPortfolioId).subscribe({next:n=>{this.subPortfolios.set(n)},error:n=>{console.error("Error loading subportfolios:",n)}})}onSubPortfolioChange(){this.amountFields.set([]),this.originalFields.set([]),this.selectedSubPortfolioId>0&&this.loadAmountFields()}loadAmountFields(){this.loading.set(!0),this.managementService.getMontoCabeceras(this.selectedSubPortfolioId).subscribe({next:n=>{let e=[...n].sort((c,p)=>(c.ordenMonto||0)-(p.ordenMonto||0)).map(c=>k(T({},c),{isVisible:c.esVisibleMonto===1||c.esVisibleMonto===void 0||c.esVisibleMonto===null}));this.amountFields.set(e),this.originalFields.set(JSON.parse(JSON.stringify(e))),this.loading.set(!1)},error:n=>{console.error("Error loading amount fields:",n),this.loading.set(!1)}})}toggleVisibility(n){n.isVisible=!n.isVisible,this.amountFields.set([...this.amountFields()])}toggleAll(n){let s=this.amountFields().map(e=>k(T({},e),{isVisible:n}));this.amountFields.set(s)}drop(n){let s=[...this.amountFields()];U(s,n.previousIndex,n.currentIndex),this.amountFields.set(s)}hasChanges(){let n=this.amountFields(),s=this.originalFields();if(n.length!==s.length)return!0;for(let e=0;e<n.length;e++)if(n[e].id!==s[e].id||n[e].isVisible!==s[e].isVisible)return!0;return!1}saveChanges(){if(!this.hasChanges()||this.saving())return;this.saving.set(!0);let n=this.amountFields().map((s,e)=>({id:s.id,esVisibleMonto:s.isVisible?1:0,ordenMonto:e*10}));this.managementService.updateAmountVisibility(this.selectedSubPortfolioId,n).subscribe({next:()=>{this.saving.set(!1),this.showSuccessMessage(),this.originalFields.set(JSON.parse(JSON.stringify(this.amountFields())))},error:s=>{console.error("Error saving changes:",s),this.saving.set(!1),alert("Error al guardar los cambios")}})}showSuccessMessage(){this.showSuccess.set(!0),setTimeout(()=>this.showSuccess.set(!1),3e3)}};d.\u0275fac=function(s){return new(s||d)(w(ee),w($),w(Z))},d.\u0275cmp=V({type:d,selectors:[["app-amount-display-config"]],decls:44,vars:13,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","p-6"],[1,"max-w-5xl","mx-auto","mb-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-2","mb-2"],[1,"w-8","h-8","bg-amber-600","rounded-lg","flex","items-center","justify-center"],["name","eye",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-gray-400"],[1,"flex","items-center","gap-2","px-5","py-2.5","bg-gradient-to-r","from-emerald-600","to-emerald-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","hover:scale-105","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","cursor-pointer",3,"click","disabled"],[1,"bg-slate-900","rounded-xl","p-4","shadow-sm","border","border-slate-800"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-semibold","text-gray-300","mb-2"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-amber-500",3,"ngModelChange","ngModel"],[3,"value"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-amber-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],[1,"fixed","bottom-6","right-6","bg-emerald-600","text-white","px-6","py-3","rounded-lg","shadow-lg","flex","items-center","gap-3","animate-slide-in"],[1,"w-4","h-4","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],["name","save",3,"size"],[1,"bg-amber-900/20","border","border-amber-700/50","rounded-xl","p-4"],[1,"flex","items-start","gap-3"],["name","info",1,"text-amber-400","mt-0.5","flex-shrink-0",3,"size"],[1,"text-amber-200","text-sm","font-medium"],[1,"text-amber-200/70","text-sm","mt-1","space-y-1"],[1,"max-w-5xl","mx-auto"],[1,"bg-slate-900","rounded-xl","shadow-sm","border","border-slate-800","overflow-hidden"],[1,"p-12","text-center"],[1,"inline-block","w-8","h-8","border-4","border-amber-500","border-t-transparent","rounded-full","animate-spin"],[1,"mt-4","text-gray-400"],[1,"w-16","h-16","bg-slate-800","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],["name","dollar-sign",1,"text-gray-600",3,"size"],[1,"text-gray-300","mb-2"],[1,"text-sm","text-gray-500"],[1,"bg-slate-800","border-b","border-slate-700","px-6","py-3"],[1,"text-sm","font-semibold","text-gray-300"],[1,"flex","items-center","gap-4"],[1,"text-xs","text-emerald-400","hover:text-emerald-300","transition-colors",3,"click"],[1,"text-xs","text-red-400","hover:text-red-300","transition-colors",3,"click"],["cdkDropList","",1,"divide-y","divide-slate-800",3,"cdkDropListDropped"],["cdkDrag","",1,"flex","items-center","justify-between","px-6","py-4","hover:bg-slate-800/50","transition-colors","cursor-move"],[1,"flex","items-center","gap-4","flex-1"],["cdkDragHandle","",1,"text-slate-600","hover:text-slate-400","cursor-grab","active:cursor-grabbing"],["name","grip-vertical",3,"size"],[1,"w-8","h-8","bg-slate-800","rounded-lg","flex","items-center","justify-center","text-sm","font-bold","text-slate-400"],[1,"flex-1"],[1,"font-medium","text-white"],[1,"text-xs","text-gray-500","font-mono"],[1,"px-2","py-1","bg-slate-800","rounded","text-xs","text-gray-400"],[1,"relative","inline-flex","items-center","cursor-pointer","ml-4"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-slate-700","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-amber-800","rounded-full","peer","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-amber-600"],[1,"ml-3","text-sm","font-medium"],["class","bg-amber-900/20 border-2 border-dashed border-amber-500 rounded-lg h-16",4,"cdkDragPlaceholder"],[1,"bg-amber-900/20","border-2","border-dashed","border-amber-500","rounded-lg","h-16"],["name","check-circle",3,"size"]],template:function(s,e){s&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"div",4),u(6,"lucide-angular",5),i(),t(7,"div")(8,"h1",6),l(9,"Campos de Montos a Mostrar"),i(),t(10,"p",7),l(11,"Configure qu\xE9 campos de importes se muestran en el panel de deuda"),i()()()(),t(12,"button",8),f("click",function(){return e.saveChanges()}),x(13,te,3,0)(14,ie,3,1),i()()(),t(15,"div",1)(16,"div",9)(17,"div",10)(18,"div")(19,"label",11),l(20," Proveedor "),i(),t(21,"select",12),D("ngModelChange",function(p){return E(e.selectedTenantId,p)||(e.selectedTenantId=p),p}),f("ngModelChange",function(){return e.onTenantChange()}),t(22,"option",13),l(23,"Seleccione un proveedor..."),i(),v(24,ne,2,3,"option",13,I),i()(),t(26,"div")(27,"label",11),l(28," Cartera "),i(),t(29,"select",14),D("ngModelChange",function(p){return E(e.selectedPortfolioId,p)||(e.selectedPortfolioId=p),p}),f("ngModelChange",function(){return e.onPortfolioChange()}),t(30,"option",13),l(31,"Seleccione una cartera..."),i(),v(32,oe,2,3,"option",13,I),i()(),t(34,"div")(35,"label",11),l(36," Subcartera "),i(),t(37,"select",14),D("ngModelChange",function(p){return E(e.selectedSubPortfolioId,p)||(e.selectedSubPortfolioId=p),p}),f("ngModelChange",function(){return e.onSubPortfolioChange()}),t(38,"option",13),l(39,"Seleccione una subcartera..."),i(),v(40,re,2,3,"option",13,I),i()()()()(),x(42,ce,19,2),x(43,pe,4,1,"div",15),i()),s&2&&(r(6),m("size",16),r(6),m("disabled",!e.hasChanges()||e.saving()),r(),C(e.saving()?13:14),r(8),P("ngModel",e.selectedTenantId),r(),m("value",0),r(2),y(e.tenants()),r(5),P("ngModel",e.selectedPortfolioId),m("disabled",e.selectedTenantId===0),r(),m("value",0),r(2),y(e.portfolios()),r(5),P("ngModel",e.selectedSubPortfolioId),m("disabled",e.selectedPortfolioId===0),r(),m("value",0),r(2),y(e.subPortfolios()),r(2),C(e.selectedSubPortfolioId>0?42:-1),r(),C(e.showSuccess()?43:-1))},dependencies:[z,H,G,q,J,j,B,W,L,Y,R,Q,K,X],styles:["@keyframes _ngcontent-%COMP%_slide-in{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}.animate-slide-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in .3s ease-out}.cdk-drag-preview[_ngcontent-%COMP%]{background:#1e293b;border-radius:.5rem;box-shadow:0 25px 50px -12px #00000080;border:1px solid #334155}.cdk-drag-animating[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"]});let o=d;return o})();export{Pe as AmountDisplayConfigComponent};
