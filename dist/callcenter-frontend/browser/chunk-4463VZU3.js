import{a as Qe,b as Ue}from"./chunk-HFM63KZ2.js";import{c as le}from"./chunk-2JQMTGI5.js";import"./chunk-NO4444JX.js";import{C as L,D as Be,E as Fe,b as we,c as Ae,d as Me,e as Ce,f as Se,j as Te,k as De,l as Ee,n as Oe,q as Le,r as Re,s as Ne,t as Ve,u as Pe,v as Ie}from"./chunk-5CXVSPU7.js";import{Fa as pe,Ia as be,La as he,Ma as fe,O as ue,S as ce,X as ge,_a as ye,bb as xe,e as se,ha as me,ob as ve,pb as _e,x as de}from"./chunk-7OAV6HC2.js";import{a as ke}from"./chunk-CVSECBKN.js";import{$a as d,Bc as re,Fc as V,K as F,Kb as m,Lb as n,Mb as a,N as J,Nb as f,O as z,Rb as W,Sb as q,Ub as D,Wb as v,X as Q,Yb as b,a as N,ac as H,b as I,ba as G,bc as K,cc as Y,cd as ie,dd as ne,fa as $,ga as S,gc as X,jc as E,jd as ae,kc as u,lc as M,ma as y,mb as j,mc as B,na as x,pc as Z,qc as ee,rb as T,rc as te,rd as oe,v as U,wa as w}from"./chunk-3MKZGHO3.js";var Je=(()=>{let p=class p{constructor(e){this.http=e,this.root=`${ke.webServiceUrl}/plantillas/sms`,this.dynamicQueryUrl=`${this.root}/dynamic-query`,this.exportUrl=`${this.root}/export`,this.precheckUrl=`${this.root}/precheck`,this.previewInitUrl=`${this.root}/preview/init`,this.previewChooseUrl=`${this.root}/preview/choose`,this.previewSkipUrl=`${this.root}/preview/skip`,this.previewDlUrl=`${this.root}/preview/download`}run(e){return this.http.post(this.dynamicQueryUrl,e)}precheck(e,t){return this.http.post(this.precheckUrl,{query:e,template:t})}export(e,t){let r=N({},e);return r.limit==null&&delete r.limit,r.selectAll=!0,r.template=t,this.http.post(this.exportUrl,r,{responseType:"blob"})}previewInit(e,t,r){let i={query:I(N({},e),{template:t}),candidatas:r};return this.http.post(this.previewInitUrl,i)}previewChoose(e,t){return this.http.post(this.previewChooseUrl,{sessionId:e,variableElegida:t})}previewSkip(e){return this.http.post(this.previewSkipUrl,{sessionId:e})}previewDownload(e){return this.http.post(this.previewDlUrl,{sessionId:e},{responseType:"blob"})}previewDownloadBase(e){return this.http.get(`${this.root}/preview/${e}/download-base`,{responseType:"blob"})}};p.\u0275fac=function(t){return new(t||p)($(oe))},p.\u0275prov=G({token:p,factory:p.\u0275fac,providedIn:"root"});let s=p;return s})();var $e=["tplArea"];function je(s,p){if(s&1){let l=D();n(0,"button",46),v("click",function(){let t=y(l).$implicit,r=b(3);return x(r.toggleChip(t.key,t.affectsSelects!==!1))}),u(1),a()}if(s&2){let l=p.$implicit,e=b(3);E(e.isActive(l.key)?"px-3.5 py-2 rounded-lg text-white text-xs font-bold bg-gradient-to-r from-blue-600 to-violet-600 hover:from-blue-700 hover:to-violet-700 shadow-md shadow-blue-500/25 hover:shadow-lg hover:shadow-blue-500/35 transition-all cursor-pointer":"px-3.5 py-2 rounded-lg text-gray-700 dark:text-gray-300 text-xs font-semibold bg-white dark:bg-gray-700 hover:bg-blue-50 dark:hover:bg-gray-600 hover:text-blue-700 dark:hover:text-blue-300 border border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 transition-all cursor-pointer shadow-sm disabled:opacity-50 disabled:cursor-not-allowed"),m("disabled",e.isChipDisabled(l.key)),d(),B(" ",l.label," ")}}function We(s,p){if(s&1&&(W(0),n(1,"div",42)(2,"div",43),u(3),a(),n(4,"div",44),T(5,je,2,4,"button",45),a()(),q()),s&2){let l=p.$implicit;d(3),M(l.title),d(2),m("ngForOf",l.items)}}function qe(s,p){s&1&&(n(0,"div",47)(1,"div",48)(2,"label",49),u(3,"Sumar importe:"),a(),f(4,"input",50),a()())}function He(s,p){if(s&1&&(n(0,"div",39)(1,"div",16),T(2,We,6,2,"ng-container",40),a(),T(3,qe,5,0,"div",41),a()),s&2){let l=b();d(2),m("ngForOf",l.chipGroups),d(),m("ngIf",l.selectedChips.has("LTD")||l.selectedChips.has("LTDE")||l.selectedChips.has("LTD_LTDE"))}}function Ke(s,p){if(s&1&&(n(0,"option",60),u(1),a()),s&2){let l=p.$implicit;m("value",l.key),d(),M(l.label)}}function Ye(s,p){if(s&1&&(n(0,"div",61),f(1,"input",62),n(2,"label",63),f(3,"input",64),n(4,"span",65),u(5),a()(),n(6,"span",66),u(7),a(),n(8,"label",63),f(9,"input",67),n(10,"span",65),u(11),a()(),f(12,"input",68),a()),s&2){let l,e,t,r=b().$implicit,i=b(2);d(5),M((l=r.get("inclusiveMin"))!=null&&l.value?"\u2264":"<"),d(2),M(i.fieldLabel((e=r.get("field"))==null?null:e.value)),d(4),M((t=r.get("inclusiveMax"))!=null&&t.value?"\u2264":"<")}}function Xe(s,p){if(s&1&&(n(0,"div",61)(1,"span",66),u(2),a(),n(3,"label",63),f(4,"input",64),n(5,"span",65),u(6),a()(),f(7,"input",73),a()),s&2){let l,e,t=b(2).$implicit,r=b(2);d(2),M(r.fieldLabel((l=t.get("field"))==null?null:l.value)),d(4),M((e=t.get("inclusiveMin"))!=null&&e.value?"\u2265":">")}}function Ze(s,p){if(s&1&&(n(0,"div",61)(1,"span",66),u(2),a(),n(3,"label",63),f(4,"input",67),n(5,"span",65),u(6),a()(),f(7,"input",74),a()),s&2){let l,e,t=b(2).$implicit,r=b(2);d(2),M(r.fieldLabel((l=t.get("field"))==null?null:l.value)),d(4),M((e=t.get("inclusiveMax"))!=null&&e.value?"\u2264":"<")}}function et(s,p){if(s&1){let l=D();n(0,"div")(1,"div",69)(2,"button",28),v("click",function(){y(l);let t=b().index,r=b(2);return x(r.changeOperator(t,"gt"))}),u(3," Mayor que "),a(),n(4,"button",28),v("click",function(){y(l);let t=b().index,r=b(2);return x(r.changeOperator(t,"lt"))}),u(5," Menor que "),a()(),n(6,"div",70),T(7,Xe,8,2,"div",58)(8,Ze,8,2,"div",58),a(),n(9,"label",71)(10,"input",72),v("change",function(t){y(l);let r=b().index,i=b(2);return x(i.toggleInterval(r,t.target.checked))}),a(),n(11,"span"),u(12,"Usar como intervalo"),a()()()}if(s&2){let l,e,t,r,i,o=b().$implicit;d(2),E(((l=o.get("mode"))==null?null:l.value)==="gt"?"flex-1 px-3 py-2 rounded-lg text-white text-sm font-bold bg-gradient-to-r from-blue-600 to-violet-600 shadow-md shadow-blue-500/25 transition-all cursor-pointer":"flex-1 px-3 py-2 rounded-lg text-gray-700 dark:text-gray-300 text-sm font-semibold bg-white dark:bg-gray-700 hover:bg-blue-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 transition-all cursor-pointer shadow-sm"),d(2),E(((e=o.get("mode"))==null?null:e.value)==="lt"?"flex-1 px-3 py-2 rounded-lg text-white text-sm font-bold bg-gradient-to-r from-blue-600 to-violet-600 shadow-md shadow-blue-500/25 transition-all cursor-pointer":"flex-1 px-3 py-2 rounded-lg text-gray-700 dark:text-gray-300 text-sm font-semibold bg-white dark:bg-gray-700 hover:bg-blue-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 transition-all cursor-pointer shadow-sm"),d(3),m("ngIf",(t=o.get("useMin"))==null?null:t.value),d(),m("ngIf",(r=o.get("useMax"))==null?null:r.value),d(2),m("checked",((i=o.get("useMin"))==null?null:i.value)&&((i=o.get("useMax"))==null?null:i.value))}}function tt(s,p){if(s&1){let l=D();n(0,"div",53)(1,"div",54)(2,"select",55),T(3,Ke,2,2,"option",56),a(),n(4,"button",57),v("click",function(){let t=y(l).index,r=b(2);return x(r.removeRange(t))}),f(5,"lucide-angular",14),a()(),T(6,Ye,13,3,"div",58)(7,et,13,7,"div",59),a()}if(s&2){let l,e,t=p.$implicit,r=b(2);m("formGroup",t),d(3),m("ngForOf",r.rangeFields),d(2),m("img",r.Trash2)("size",14),d(),m("ngIf",((l=t.get("useMin"))==null?null:l.value)&&((l=t.get("useMax"))==null?null:l.value)),d(),m("ngIf",!((e=t.get("useMin"))!=null&&e.value&&((e=t.get("useMax"))!=null&&e.value)))}}function rt(s,p){if(s&1){let l=D();n(0,"div",39)(1,"button",51),v("click",function(){y(l);let t=b();return x(t.addRange())}),f(2,"lucide-angular",14),u(3," A\xF1adir rango "),a(),n(4,"div",16),T(5,tt,8,6,"div",52),a()()}if(s&2){let l=b();d(2),m("img",l.Plus)("size",16),d(3),m("ngForOf",l.rangosFA.controls)}}function it(s,p){if(s&1){let l=D();n(0,"div",39)(1,"div",75)(2,"label",76)(3,"input",77),v("change",function(t){y(l);let r=b();return x(r.toggleCond(t,"PROMESAS_HOY"))}),a(),n(4,"span",78),u(5,"Promesas para hoy"),a()(),n(6,"label",76)(7,"input",77),v("change",function(t){y(l);let r=b();return x(r.toggleCond(t,"PROMESAS_MANANA"))}),a(),n(8,"span",78),u(9,"Promesas para ma\xF1ana"),a()(),n(10,"label",76)(11,"input",77),v("change",function(t){y(l);let r=b();return x(r.toggleCond(t,"PROMESAS_MANANA2"))}),a(),n(12,"span",78),u(13,"Promesas para pasado ma\xF1ana"),a()(),n(14,"label",76)(15,"input",77),v("change",function(t){y(l);let r=b();return x(r.toggleCond(t,"PROMESAS_ROTAS"))}),a(),n(16,"span",78),u(17,"Promesas rotas"),a()()()()}}function nt(s,p){s&1&&(n(0,"div",39)(1,"div",79)(2,"label",76),f(3,"input",80),n(4,"span",78),u(5,"Sin contenido"),a()(),n(6,"label",76),f(7,"input",81),n(8,"span",78),u(9,"Excluir promesas periodo actual"),a()(),n(10,"label",76),f(11,"input",82),n(12,"span",78),u(13,"Excluir compromisos"),a()(),n(14,"label",76),f(15,"input",83),n(16,"span",78),u(17,"Excluir blacklist"),a()()(),n(18,"div",84)(19,"div",48)(20,"label",49),u(21,"L\xEDmite de filas:"),a(),f(22,"input",85),a()()())}function at(s,p){if(s&1&&(n(0,"div",86),u(1),a()),s&2){let l=b();d(),B(" ",l.previewText()," ")}}function ot(s,p){s&1&&(n(0,"div",87),u(1," Configura tu consulta para ver una vista previa "),a())}function lt(s,p){if(s&1){let l=D();n(0,"button",88),v("click",function(){y(l);let t=b();return x(t.refreshPreview())}),u(1," Actualizar preview "),a()}if(s&2){let l=b();m("disabled",l.previewMode()!=="manual"||l.loadingPreview())}}function st(s,p){if(s&1&&(n(0,"div",89)(1,"div",90),f(2,"div",91),n(3,"p",92),u(4),a()()()),s&2){let l=b();d(4),M(l.loadingPreview()?"Cargando previsualizaci\xF3n...":l.loadingExport()?"Generando Excel...":"Guardando combo...")}}function dt(s,p){if(s&1){let l=D();n(0,"div",89)(1,"div",90)(2,"div",93),u(3,"\u26A0\uFE0F"),a(),n(4,"h3",94),u(5,"Atenci\xF3n"),a(),n(6,"p",95),u(7),a(),n(8,"button",96),v("click",function(){y(l);let t=b();return x(t.closeAlert())}),u(9,"Entendido"),a()()()}if(s&2){let l=b();d(7),M(l.alertMessage())}}function ut(s,p){if(s&1){let l=D();n(0,"div",89)(1,"div",90)(2,"div",93),u(3,"\u2713"),a(),n(4,"h3",94),u(5,"\xC9xito"),a(),n(6,"p",95),u(7),a(),n(8,"button",97),v("click",function(){y(l);let t=b();return x(t.closeSuccess())}),u(9,"Aceptar"),a()()()}if(s&2){let l=b();d(7),M(l.successMessage())}}function ct(s,p){if(s&1){let l=D();n(0,"div",89)(1,"div",98)(2,"h3",99),u(3,"Generaci\xF3n Guiada"),a(),n(4,"p",100),u(5,"\xBFCu\xE1ntas rondas deseas generar?"),a(),n(6,"input",101),te("ngModelChange",function(t){y(l);let r=b();return ee(r.roundCount,t)||(r.roundCount=t),x(t)}),a(),n(7,"div",102)(8,"button",103),v("click",function(){y(l);let t=b();return x(t.closeRoundWizard())}),u(9,"Cancelar"),a(),n(10,"button",104),v("click",function(){y(l);let t=b();return x(t.confirmGenerate())}),u(11,"Generar"),a()()()()}if(s&2){let l=b();d(6),Z("ngModel",l.roundCount)}}var gt=/\{([A-Z0-9_]+)\}/gi,P=/\{([A-Z0-9_]+)\}/g,Lt=(()=>{let p=class p{constructor(){this.fbRef=S(L),this.api=S(Je),this.comboApi=S(Qe),this.router=S(le),this.sampleRow=w(null),this.Settings=fe,this.Filter=ge,this.Plus=pe,this.Trash2=xe,this.ListChecks=me,this.Ban=se,this.FileText=ce,this.Table=ye,this.Eye=ue,this.Send=he,this.Save=be,this.XCircle=de,this.activeTab="variables",this.loadingModal=w({isOpen:!1,data:null}),this.alertModal=w({isOpen:!1,data:null}),this.successModal=w({isOpen:!1,data:null}),this.roundWizardModal=w({isOpen:!1,data:null}),this.rangeFields=[{key:"DEUDA_TOTAL",label:"Deuda total"},{key:"CAPITAL",label:"Capital"},{key:"SALDO_MORA",label:"Saldo mora"},{key:"BAJA30",label:"Baja 30"},{key:"LTD",label:"LTD"},{key:"LTDE",label:"LTDE"},{key:"PKM",label:"PKM"},{key:"DIASMORA",label:"D\xEDas mora"}],this.selects=new Set,this.condiciones=new Set,this.chipGroups=[{key:"cliente",title:"Cliente",items:[{key:"NOMBRE",label:"Nombre",affectsSelects:!0},{key:"NOMBRECOMPLETO",label:"Nombre completo",affectsSelects:!0},{key:"EMAIL",label:"Correo",affectsSelects:!0},{key:"NUMCUENTAPMCP",label:"N\xB0 de Cuenta",affectsSelects:!0}]},{key:"financiero",title:"Financiero",items:[{key:"LTD",label:"LTD",affectsSelects:!0},{key:"LTDE",label:"LTDE",affectsSelects:!0},{key:"LTD_LTDE",label:"LTD y LTDE",affectsSelects:!0},{key:"BAJA30",label:"Baja 30",affectsSelects:!0},{key:"MORA",label:"Saldo Mora",affectsSelects:!0},{key:"BAJA30_SALDOMORA",label:"Baja 30 y Saldo Mora",affectsSelects:!0},{key:"PKM",label:"PKM",affectsSelects:!0},{key:"CAPITAL",label:"Capital",affectsSelects:!0},{key:"DEUDA_TOTAL",label:"Deuda Total",affectsSelects:!0}]},{key:"fechas",title:"Fechas",items:[{key:"DIASMORA",label:"D\xEDas mora",affectsSelects:!0},{key:"HOY",label:"Hoy",affectsSelects:!1},{key:"MANANA",label:"Ma\xF1ana",affectsSelects:!1}]}],this.chips=this.chipGroups.flatMap(e=>e.items),this.selectedChips=new Set,this.previewText=V(()=>{let e=this.tplSig(),t=this.sampleRow();return this.renderTemplate(e,t)}),this.form=S(L).nonNullable.group({tramo:"3",noContenido:!1,excluirPromesasPeriodoActual:!0,excluirCompromisos:!0,excluirBlacklist:!0,limit:1e3,nombre:S(L).nonNullable.control(""),plantillaTexto:S(L).nonNullable.control(""),descripcion:S(L).nonNullable.control(""),importeExtra:S(L).nonNullable.control(0),rangos:S(L).array([])}),this.tplSig=Ue(this.form.controls.plantillaTexto.valueChanges.pipe(Q(this.form.controls.plantillaTexto.value??"")),{initialValue:this.form.controls.plantillaTexto.value??""}),this.rows=w([]),this.cols=w([]),this.Math=Math,this.tokensInText=w(new Set),this.affectsMap=new Map(this.chipGroups.flatMap(e=>e.items.map(t=>[this.mapVar(t.key),t.affectsSelects!==!1]))),this.previewMode=w("manual"),this.loadingPreview=w(!1),this.loadingExport=w(!1),this.loadingSave=w(!1),this.lastHash=w(""),this.pendingPreview=V(()=>this.previewMode()==="manual"&&this.hash(this.currentQueryForPreview())!==this.lastHash()),this.alertMessage=V(()=>this.alertModal().isOpen?this.alertModal().data?.message||"":null),this.successMessage=V(()=>this.successModal().isOpen?this.successModal().data?.message||"":null),this.showRoundWizard=V(()=>this.roundWizardModal().isOpen),this.roundCount=1}insertAtCursor(e){let t=this.form.controls.plantillaTexto,r=this.tplArea?.nativeElement;if(!r){let A=t.value??"",R=A&&!A.endsWith(" ")?" ":"";t.setValue(A+R+e),t.markAsDirty();return}let i=t.value??"",o=r.selectionStart??i.length,g=r.selectionEnd??o,c=i.slice(0,o),_=i.slice(g),h=(c.length&&!/\s$/.test(c)?" ":"")+e,C=c+h+_;t.setValue(C),t.markAsDirty();let O=(c+h).length;setTimeout(()=>{r.focus(),r.selectionStart=r.selectionEnd=O},0)}isSelected(e){return this.selectedChips.has(e)}aliasKeys(e){let t=e.toUpperCase();switch(t){case"MORA":case"SALDO_MORA":return["SALDO_MORA","MORA","SALDO MORA"];case"BAJA30":return["BAJA30","BAJA_30","BAJA 30"];case"BAJA30_SALDOMORA":return["BAJA30_SALDOMORA","BAJA30_SALDO_MORA","BAJA 30 SALDO MORA"];case"DEUDA_TOTAL":return["DEUDA_TOTAL","DEUDA TOTAL"];case"LTD_LTDE":return["LTD_LTDE","LTD+LTDE","LTD LTDE"];case"NOMBRECOMPLETO":return["NOMBRECOMPLETO","NOMBRE COMPLETO"];case"EMAIL":return["EMAIL"];case"NUMCUENTAPMCP":return["NUMCUENTAPMCP","NUMCUENTA_PMCP","NUM_CUENTA_PMCP","NUMCUENTA PMCP","N\xB0 CUENTA PMCP"];case"DIASMORA":return["DIASMORA","DIAS_MORA","DIAS MORA"];default:return[t,t.replace(/\s+/g,"_")]}}mapVar(e){let t=e.toUpperCase();return t==="MORA"?"SALDO_MORA":t}getVal(e,t){let r=this.aliasKeys(this.mapVar(t));for(let i of r)if(e.hasOwnProperty(i))return e[i]}hasMeaningfulValue(e,t){let r=this.getVal(e,t);return r==null?!1:typeof r=="string"?r.trim().length>0:typeof r=="number"?r>0:!0}requiredColumnsForPreview(){let e=Array.from(this.selects),r=((this.form.controls.plantillaTexto.value??"").match(P)||[]).map(g=>g.slice(1,-1)),i=Array.from(new Set([...e,...r])).map(g=>this.mapVar(g)),o=new Set(["LTD","LTDE","LTD_LTDE","BAJA30","SALDO_MORA","BAJA30_SALDOMORA","CAPITAL","DEUDA_TOTAL","PKM"]);return Array.from(new Set(e.map(g=>this.mapVar(g)))).filter(g=>o.has(g))}preferredColumnsForPreview(){let t=((this.form.controls.plantillaTexto.value??"").match(P)||[]).map(i=>this.mapVar(i.slice(1,-1))),r=new Set(this.requiredColumnsForPreview());return Array.from(new Set(t.filter(i=>!r.has(i))))}pickBestRow(e,t,r){let i=e,o=i.filter(k=>t.every(h=>this.hasMeaningfulValue(k,h)));if(o.length)return o.sort((k,h)=>{let C=r.reduce((A,R)=>A+(this.hasMeaningfulValue(k,R)?1:0),0);return r.reduce((A,R)=>A+(this.hasMeaningfulValue(h,R)?1:0),0)-C}),o[0];let g=null,c=-1,_=-1;for(let k of i){let h=t.reduce((O,A)=>O+(this.hasMeaningfulValue(k,A)?1:0),0),C=r.reduce((O,A)=>O+(this.hasMeaningfulValue(k,A)?1:0),0);(h>c||h===c&&C>_)&&(g=k,c=h,_=C)}return g??e[0]??null}toggleChip(e,t=!0){this.selectedChips.has(e)?(this.selectedChips.delete(e),t&&this.selects.delete(e),this.removePlaceholder(e)):((e==="BAJA30"||e==="MORA")&&this.selectedChips.has("BAJA30_SALDOMORA")&&(this.selectedChips.delete("BAJA30_SALDOMORA"),this.selects.delete("BAJA30_SALDOMORA"),this.removePlaceholder("BAJA30_SALDOMORA")),e==="BAJA30_SALDOMORA"&&(this.selectedChips.has("BAJA30")&&(this.selectedChips.delete("BAJA30"),this.selects.delete("BAJA30"),this.removePlaceholder("BAJA30")),this.selectedChips.has("MORA")&&(this.selectedChips.delete("MORA"),this.selects.delete("MORA"),this.removePlaceholder("MORA"))),(e==="LTD"||e==="LTDE")&&this.forceDeselect("LTD_LTDE"),e==="LTD_LTDE"&&(this.forceDeselect("LTD"),this.forceDeselect("LTDE")),this.selectedChips.add(e),t&&this.selects.add(e),this.insertPlaceholderOnce(e)),this.hasTopUpSelect()||this.form.controls.importeExtra.setValue(0),this.fetchSampleRow()}normalizeRow(e){let t={};return Object.keys(e||{}).forEach(r=>{let i=r.replace(/\s+/g,"_").toUpperCase();t[i]=e[r]}),t}fetchSampleRow(){this.previewMode()==="auto"&&this.triggerPreview()}renderTemplate(e,t){if(!e)return"";if(!t)return e;let r=this.normalizeRow(t),i=k=>String(k??"").trim().split(/\s+/)[0]||"",o=k=>{let h=Number(k);return Number.isFinite(h)?Math.trunc(h).toLocaleString("es-PE"):""},g=new Date,c=new Date(g.getTime()+1440*60*1e3),_=k=>k.toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit"});return e.replace(P,(k,h)=>{switch(h){case"NOMBRE":return i(this.getVal(r,"NOMBRE"));case"HOY":return _(g);case"MANANA":return _(c);case"DIASMORA":case"LTD":case"LTDE":case"LTD_LTDE":case"BAJA30":case"SALDO_MORA":case"BAJA30_SALDOMORA":case"CAPITAL":case"DEUDA_TOTAL":case"PKM":return o(this.getVal(r,h));default:let C=this.getVal(r,h);return C===void 0?"":String(C)}})}expandWithAliases(e){let t=new Set;return e.forEach(r=>this.aliasKeys(r).forEach(i=>t.add(i))),Array.from(t)}ngOnInit(){this.form.valueChanges.pipe(Q(this.form.getRawValue()),F(300),U(t=>({tramo:t.tramo,importeExtra:t.importeExtra,plantillaTexto:t.plantillaTexto,selects:Array.from(this.selects),condiciones:Array.from(this.condiciones)})),J((t,r)=>JSON.stringify(t)===JSON.stringify(r))).subscribe(()=>{this.syncChipsWithTemplate(),this.previewMode()==="auto"&&this.triggerPreview()}),this.form.controls.plantillaTexto.valueChanges.pipe(F(200)).subscribe(()=>{this.syncChipsWithTemplate(),this.previewMode()==="auto"&&this.triggerPreview()}),this.syncChipsWithTemplate(),this.previewMode()==="auto"&&this.triggerPreview()}insertPlaceholderOnce(e){let r=this.form.controls.plantillaTexto.value??"";new RegExp(`\\{${e}\\}(?!\\w)`,"i").test(r)||this.insertAtCursor(`{${e}}`)}hasTopUpSelect(){return this.selectedChips.has("LTD")||this.selectedChips.has("LTDE")||this.selectedChips.has("LTD_LTDE")}get rangosFA(){return this.form.get("rangos")}validateMinLTMax(){return e=>{let t=e,r=t.get("min")?.value,i=t.get("max")?.value;return r!=null&&i!=null&&Number(r)>Number(i)?{rangeOrder:!0}:null}}makeRange(){return this.fbRef.nonNullable.group({field:this.fbRef.nonNullable.control("DEUDA_TOTAL",{validators:[Me.required]}),mode:this.fbRef.nonNullable.control("gt"),useMin:this.fbRef.nonNullable.control(!0),min:this.fbRef.control(null),inclusiveMin:this.fbRef.nonNullable.control(!1),useMax:this.fbRef.nonNullable.control(!1),max:this.fbRef.control(null),inclusiveMax:this.fbRef.nonNullable.control(!0)},{validators:[this.validateRange()]})}changeOperator(e,t){let r=this.rangosFA.at(e);r.get("mode")?.setValue(t),t==="gt"?(r.get("useMin")?.setValue(!0),r.get("useMax")?.setValue(!1),r.get("max")?.setValue(null)):(r.get("useMin")?.setValue(!1),r.get("useMax")?.setValue(!0),r.get("min")?.setValue(null))}toggleUseMin(e,t){let r=this.rangosFA.at(e);r.get("useMin")?.setValue(t),t||r.get("min")?.setValue(null)}toggleUseMax(e,t){let r=this.rangosFA.at(e);r.get("useMax")?.setValue(t),t||r.get("max")?.setValue(null)}toggleInterval(e,t){t&&(this.toggleUseMin(e,!0),this.toggleUseMax(e,!0))}validateRange(){return e=>{let t=e,r=!!t.get("useMin")?.value,i=!!t.get("useMax")?.value,o=t.get("min")?.value,g=t.get("max")?.value;return!r&&!i?{noBoundSelected:!0}:r&&(o==null||o==="")?{minRequired:!0}:i&&(g==null||g==="")?{maxRequired:!0}:r&&i&&Number(o)>Number(g)?{rangeOrder:!0}:null}}addRange(){this.rangosFA.push(this.makeRange())}removeRange(e){this.rangosFA.removeAt(e)}onSelectChange(e,t){let r=e.target;r.checked?(this.selects.add(r.value),this.insertPlaceholder(t)):(this.selects.delete(r.value),this.removePlaceholder(t))}toggleCond(e,t){e.target.checked?this.condiciones.add(t):this.condiciones.delete(t),this.fetchSampleRow()}buildBody(e){let t=this.form.getRawValue(),r=Array.from(this.selects).map(h=>h==="MORA"?"SALDO_MORA":h),i=new Set(["PROMESAS_HOY","PROMESAS_MANANA","PROMESAS_MANANA2","PROMESAS_ROTAS"]),o=Array.from(this.condiciones).filter(h=>i.has(h)),c=Array.from(this.extractTokens()).filter(h=>this.affectsMap.get(h));r=Array.from(new Set([...r,...c]));let _=this.hasTopUpSelect()&&Number(t.importeExtra)>0?Math.trunc(Number(t.importeExtra)):null,k=this.rangosFA.controls.map(h=>{let C=String(h.get("field")?.value||"").toUpperCase(),O=!!h.get("useMin")?.value,A=!!h.get("useMax")?.value,R=h.get("min")?.value,ze=h.get("max")?.value;return{field:C,min:O?Number(R):void 0,max:A?Number(ze):void 0,inclusiveMin:!!h.get("inclusiveMin")?.value,inclusiveMax:!!h.get("inclusiveMax")?.value}}).filter(h=>h.min!=null||h.max!=null);return{selects:r,tramo:t.tramo,condiciones:o,restricciones:{noContenido:!!t.noContenido,excluirPromesasPeriodoActual:!!t.excluirPromesasPeriodoActual,excluirCompromisos:!!t.excluirCompromisos,excluirBlacklist:!!t.excluirBlacklist},limit:e?Number(t.limit||1e3):void 0,importeExtra:_,rangos:k.length?k:void 0}}ejecutar(){let e=this.buildBody(!0);this.api.run(e).subscribe(t=>{this.rows.set(t),this.cols.set(t.length?Object.keys(t[0]):[])})}alert(e,t="Aviso"){this.alertModal.set({isOpen:!0,data:{title:t,message:e}})}compactQuery(e){let t=N({},e);return t.limit==null&&delete t.limit,t.importeExtra==null&&delete t.importeExtra,delete t.plantillaTexto,t}exportar(){let e=this.buildBody(!1),t=this.compactQuery(e),r=I(N({},t),{selectAll:!0}),i=(this.form.controls.plantillaTexto.value??"").trim();if(!i){this.alert("Ingresa un texto de SMS antes de exportar.","Falta texto");return}this.loadingModal.set({isOpen:!0,data:{title:"Generando Excel\u2026",subtitle:"Preparando datos y creando archivo"}}),this.api.precheck(r,i).subscribe({next:o=>{if(!o.ok){this.loadingModal.set({isOpen:!1,data:null});let g=`${o.excedidos} ${o.excedidos===1?"fila":"filas"} superan ${o.limite} caracteres.`,c=(o.ejemplos??[]).map(_=>`\u2022 ${_.len} caracteres \u2014 DNI: ${_.documento||"(sin DNI)"}`).join(`
`);this.alert(`${g}

Primeros ${Math.min((o.ejemplos??[]).length,3)} casos:
${c}`,"Mensaje demasiado largo");return}this.api.export(r,i).pipe(z(()=>this.loadingModal.set({isOpen:!1,data:null}))).subscribe({next:g=>{let c=URL.createObjectURL(g),_=document.createElement("a");_.href=c,_.download=`sms report ${new Date().toISOString().slice(0,10)}.xlsx`,document.body.appendChild(_),_.click(),_.remove(),URL.revokeObjectURL(c),this.showSuccess("Exportaci\xF3n exitosa","Tu archivo se gener\xF3 correctamente.")},error:g=>{let c=g?.status===422?g?.error?.message||"No hay filas para exportar con los filtros seleccionados.":g?.error?.message||g?.message||"Ocurri\xF3 un error al exportar.";this.alert(c,g?.status===422?"Sin resultados":"Error")}})},error:o=>{this.loadingModal.set({isOpen:!1,data:null});let g=o?.error?.message||o?.message||"No se pudo validar el SMS.";this.alert(g,"Error en precheck")}})}insertPlaceholder(e){this.insertAtCursor(`{${e}}`)}mapRangosForPayload(){return this.rangosFA.controls.map(e=>{let t=String(e.get("field")?.value||"").toUpperCase(),r=!!e.get("useMin")?.value,i=!!e.get("useMax")?.value,o=e.get("min")?.value,g=e.get("max")?.value;return{field:t,min:r?Number(o):void 0,max:i?Number(g):void 0,inclusiveMin:!!e.get("inclusiveMin")?.value,inclusiveMax:!!e.get("inclusiveMax")?.value}}).filter(e=>e.min!=null||e.max!=null)}guardarCombo(){let e=this.form.getRawValue(),t=this.hasTopUpSelect()&&Number(e.importeExtra)>0?Math.trunc(Number(e.importeExtra)):null,r=this.mapRangosForPayload(),i={name:e.nombre,plantillaName:e.nombre,descripcion:e.descripcion,tramo:e.tramo,selects:Array.from(this.selects),condiciones:Array.from(this.condiciones),restricciones:{noContenido:!!e.noContenido,excluirPromesasPeriodoActual:!!e.excluirPromesasPeriodoActual,excluirCompromisos:!!e.excluirCompromisos,excluirBlacklist:!!e.excluirBlacklist},plantillaTexto:e.plantillaTexto,importeExtra:t,rangos:r.length?r:void 0};this.comboApi.createCombo(i).subscribe({next:o=>{this.form.reset({tramo:"3",excluirPromesasPeriodoActual:!0,excluirCompromisos:!0,excluirBlacklist:!0,limit:1e3,nombre:"",plantillaTexto:"",descripcion:""}),this.selects.clear(),this.condiciones.clear(),this.rows.set([]),this.cols.set([]),this.showSuccess("Guardado","El combo se guard\xF3 correctamente."),setTimeout(()=>{this.router.navigate(["/SMS"])},1800)},error:o=>{let g=o?.error?.message||o?.message||"No se pudo guardar el combo.";this.alert(g,"Error")}})}Cancel(){this.router.navigate(["/List-sms"])}removePlaceholder(e){let t=this.form.controls.plantillaTexto,r=t.value??"",i=new RegExp(`\\{${e}\\}`,"g"),o=r.replace(i,"");o=o.replace(/\s{2,}/g," ").replace(/\s+([.,;:!?])/g,"$1").trim(),o!==r&&(t.setValue(o),t.markAsDirty())}fieldLabel(e){let t=String(e||"").toUpperCase();return this.rangeFields.find(i=>i.key===t)?.label??t}showSuccess(e,t,r=1800){this.successModal.set({isOpen:!0,data:{title:e,message:t,autoCloseMs:r}})}forceDeselect(e,t=!0){this.selectedChips.has(e)&&(this.selectedChips.delete(e),t&&this.selects.delete(e),this.removePlaceholder(e))}isChipDisabled(e){return this.isActive(e)?!1:e==="LTD_LTDE"?this.isActive("LTD")||this.isActive("LTDE"):e==="LTD"||e==="LTDE"?this.isActive("LTD_LTDE"):e==="BAJA30_SALDOMORA"?this.isActive("BAJA30")||this.isActive("MORA"):e==="BAJA30"||e==="MORA"?this.isActive("BAJA30_SALDOMORA"):!1}extractTokens(){let t=((this.form.controls.plantillaTexto.value??"").match(P)||[]).map(r=>this.mapVar(r.slice(1,-1)));return new Set(t)}syncChipsWithText(){let e=this.extractTokens();this.tokensInText.set(e);for(let t of Array.from(this.selectedChips)){let r=this.mapVar(t);(this.affectsMap.get(r)??!0)&&!e.has(r)&&(this.selectedChips.delete(t),this.selects.delete(t==="MORA"?"SALDO_MORA":t))}}isActive(e){return this.selectedChips.has(e)||this.tokensInText().has(this.mapVar(e))}chipMeta(e){for(let t of this.chipGroups){let r=t.items.find(i=>i.key===e);if(r)return r}}affectsSelects(e){return this.chipMeta(e)?.affectsSelects!==!1}syncChipsWithTemplate(){let e=this.form.controls.plantillaTexto.value??"",t=new Set;for(let c of e.matchAll(gt))t.add(String(c[1]).toUpperCase());t.has("SALDO_MORA")&&t.add("MORA"),t.has("MORA")&&t.add("SALDO_MORA"),this.tokensInText.set(new Set(t));let r=c=>t.has(c.toUpperCase()),i=c=>{this.selectedChips.has(c)||(this.selectedChips.add(c),this.affectsSelects(c)&&this.selects.add(c==="MORA"?"SALDO_MORA":c))},o=c=>{this.selectedChips.has(c)&&(this.selectedChips.delete(c),this.affectsSelects(c)&&this.selects.delete(c==="MORA"?"SALDO_MORA":c))};r("BAJA30_SALDOMORA")?(i("BAJA30_SALDOMORA"),o("BAJA30"),o("MORA")):(o("BAJA30_SALDOMORA"),r("BAJA30")?i("BAJA30"):o("BAJA30"),r("MORA")?i("MORA"):o("MORA")),r("LTD_LTDE")?(i("LTD_LTDE"),o("LTD"),o("LTDE")):(o("LTD_LTDE"),r("LTD")?i("LTD"):o("LTD"),r("LTDE")?i("LTDE"):o("LTDE"));let g=new Set(["BAJA30","MORA","BAJA30_SALDOMORA","LTD","LTDE","LTD_LTDE"]);for(let c of this.chipGroups)for(let _ of c.items)g.has(_.key)||(r(_.key)?i(_.key):o(_.key));this.hasTopUpSelect()||this.form.controls.importeExtra.setValue(0)}generarGuiado(){let e=(this.form.controls.plantillaTexto.value??"").trim();if(!e){this.alert("Ingresa un texto de SMS antes de generar.","Falta texto");return}let t=this.buildBody(!1),r=this.compactQuery(t),o=Array.from(this.extractTokens()).filter(c=>this.affectsMap.get(c));r.selects=Array.from(new Set([...r.selects||[],...o]));let g=["BAJA30","SALDO_MORA","BAJA30_SALDOMORA","LTD","LTDE","LTD_LTDE","PKM","CAPITAL"];this.loadingModal.set({isOpen:!0,data:{title:"Preparando cohorte\u2026",subtitle:"Calculando variables candidatas"}}),this.api.previewInit(r,e,g).subscribe({next:c=>{this.loadingModal.set({isOpen:!1,data:null}),this.roundWizardModal.set({isOpen:!0,data:{sessionId:c.sessionId,init:c,template:e}})},error:c=>{this.loadingModal.set({isOpen:!1,data:null});let _=c?.error?.message||c?.message||"No se pudo iniciar el guiado.";this.alert(_,"Error")}})}triggerPreview(){let e=this.currentQueryForPreview(),t=this.hash(e);if(t===this.lastHash()&&this.sampleRow())return;this.lastHash.set(t),this.loadingPreview.set(!0);let r=this.requiredColumnsForPreview(),i=this.preferredColumnsForPreview();this.api.run(e).subscribe({next:o=>{let g=this.pickBestRow(o||[],r,i);this.sampleRow.set(g??null),this.loadingPreview.set(!1)},error:()=>{this.sampleRow.set(null),this.loadingPreview.set(!1)}})}refreshPreview(){this.triggerPreview()}setMode(e){this.previewMode.set(e),e==="auto"&&this.triggerPreview()}hash(e){let t={tramo:e.tramo,selects:[...e.selects||[]].sort(),condiciones:[...e.condiciones||[]].sort(),restricciones:e.restricciones,importeExtra:e.importeExtra??null};return JSON.stringify(t)}currentQueryForPreview(){let e=this.buildBody(!0),t=this.form.controls.plantillaTexto.value??"",r=Array.from(new Set((t.match(P)||[]).map(i=>this.mapVar(i.slice(1,-1)))));return e.selects=Array.from(new Set([...e.selects||[],...r])),e.selects=Array.from(new Set([...e.selects||[],...this.expandWithAliases(e.selects||[])])),e}onLoadingModalClosed(){this.loadingModal.set({isOpen:!1,data:null})}onAlertModalClosed(){this.alertModal.set({isOpen:!1,data:null})}onSuccessModalClosed(){this.successModal.set({isOpen:!1,data:null})}onRoundWizardModalClosed(){this.roundWizardModal.set({isOpen:!1,data:null})}closeAlert(){this.alertModal.set({isOpen:!1,data:null})}closeSuccess(){this.successModal.set({isOpen:!1,data:null})}closeRoundWizard(){this.roundWizardModal.set({isOpen:!1,data:null})}confirmGenerate(){console.log(`Generando ${this.roundCount} rondas`),this.closeRoundWizard()}};p.\u0275fac=function(t){return new(t||p)},p.\u0275cmp=j({type:p,selectors:[["app-dyn-query"]],viewQuery:function(t,r){if(t&1&&H($e,5),t&2){let i;K(i=Y())&&(r.tplArea=i.first)}},decls:81,vars:51,consts:[["tplArea",""],["noPreview",""],[1,"bg-gray-50","dark:bg-gray-900","min-h-screen","pt-24","px-8"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],["formControlName","tramo",1,"px-3","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","font-medium","cursor-pointer","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm",3,"formGroup"],["value","3"],["value","5"],["value","CONTACTO_TOTAL"],[1,"grid","grid-cols-[1fr_380px]","gap-3","items-start"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-lg","border","border-gray-200","dark:border-gray-700","overflow-hidden"],[3,"formGroup"],[1,"flex","border-b","border-gray-200","dark:border-gray-700","bg-gray-50","dark:bg-gray-800/50"],["type","button",1,"flex-1","flex","items-center","justify-center","gap-1.5","px-4","py-3","text-sm","font-medium","transition-all","cursor-pointer","border-b-2",3,"click"],[3,"img","size"],["class","p-4 animate-fade-in",4,"ngIf"],[1,"space-y-3"],[1,"flex","items-center","gap-2","p-4","border-b","border-gray-200","dark:border-gray-700","bg-gray-50","dark:bg-gray-800/50"],[1,"text-blue-600","dark:text-blue-400",3,"img","size"],[1,"text-sm","font-bold","text-gray-900","dark:text-white"],[1,"p-4"],["formControlName","plantillaTexto","placeholder","Escribe tu mensaje SMS aqu\xED. Usa los chips para insertar variables como {NOMBRE}, {LTD}, etc.","rows","6",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm","resize-none",3,"formGroup"],[1,"flex","items-center","justify-between","mt-2"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400"],[1,"text-xs","font-bold"],[1,"flex","items-center","justify-between","p-4","border-b","border-gray-200","dark:border-gray-700","bg-gray-50","dark:bg-gray-800/50"],[1,"flex","items-center","gap-2"],[1,"flex","gap-1","bg-gray-200","dark:bg-gray-700","rounded-lg","p-1"],["type","button",3,"click"],["class","p-3 bg-gradient-to-r from-blue-600 to-violet-600 text-white rounded-lg text-sm leading-relaxed shadow-lg min-h-[80px]",4,"ngIf","ngIfElse"],["type","button","class","w-full mt-3 px-4 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 hover:border-gray-400 dark:hover:border-gray-500 transition-all cursor-pointer shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",3,"disabled","click",4,"ngIf"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-lg","border","border-gray-200","dark:border-gray-700","p-4","space-y-3"],["type","button",1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2.5","bg-gradient-to-r","from-blue-600","to-violet-600","hover:from-blue-700","hover:to-violet-700","text-white","rounded-lg","text-sm","font-medium","transition-all","shadow-lg","shadow-blue-500/20","hover:shadow-xl","hover:shadow-blue-500/30","cursor-pointer",3,"click"],["type","button",1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2.5","bg-gray-100","dark:bg-gray-700","border","border-gray-300","dark:border-gray-600","rounded-lg","text-gray-700","dark:text-gray-300","text-sm","font-medium","hover:bg-gray-200","dark:hover:bg-gray-600","hover:border-gray-400","dark:hover:border-gray-500","transition-all","cursor-pointer","shadow-sm",3,"click"],[1,"pt-3","border-t","border-gray-200","dark:border-gray-700","space-y-2"],["type","text","formControlName","nombre","placeholder","Nombre del combo",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm",3,"formGroup"],["formControlName","descripcion","placeholder","Descripci\xF3n (opcional)","rows","2",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm","resize-none",3,"formGroup"],["type","button",1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2.5","bg-gradient-to-r","from-green-600","to-emerald-600","hover:from-green-700","hover:to-emerald-700","text-white","rounded-lg","text-sm","font-medium","transition-all","shadow-lg","shadow-green-500/20","hover:shadow-xl","hover:shadow-green-500/30","cursor-pointer",3,"click"],["class","fixed inset-0 bg-black/60 dark:bg-black/70 z-[2000] flex items-center justify-center animate-fade-in",4,"ngIf"],[1,"p-4","animate-fade-in"],[4,"ngFor","ngForOf"],["class","mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",4,"ngIf"],[1,"border-b","border-gray-200","dark:border-gray-700","pb-3","last:border-0","last:pb-0"],[1,"text-xs","font-bold","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","mb-2"],[1,"flex","flex-wrap","gap-2"],["type","button",3,"class","disabled","click",4,"ngFor","ngForOf"],["type","button",3,"click","disabled"],[1,"mt-4","pt-4","border-t","border-gray-200","dark:border-gray-700"],[1,"flex","items-center","gap-3"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300"],["type","number","min","0","step","1","formControlName","importeExtra","placeholder","0",1,"px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm","w-32"],["type","button",1,"flex","items-center","gap-2","px-4","py-2","bg-gradient-to-r","from-blue-600","to-violet-600","hover:from-blue-700","hover:to-violet-700","text-white","rounded-lg","text-sm","font-medium","transition-all","shadow-lg","shadow-blue-500/20","hover:shadow-xl","hover:shadow-blue-500/30","cursor-pointer","mb-4",3,"click"],["class","bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl p-4 shadow-sm hover:shadow-md transition-all",3,"formGroup",4,"ngFor","ngForOf"],[1,"bg-white","dark:bg-gray-700","border","border-gray-200","dark:border-gray-600","rounded-xl","p-4","shadow-sm","hover:shadow-md","transition-all",3,"formGroup"],[1,"flex","items-center","justify-between","mb-3"],["formControlName","field",1,"flex-1","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","font-medium","cursor-pointer","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm"],[3,"value",4,"ngFor","ngForOf"],["type","button","title","Eliminar",1,"ml-2","p-2","bg-red-50","dark:bg-red-900/30","border","border-red-300","dark:border-red-700","rounded-lg","text-red-700","dark:text-red-300","hover:bg-red-100","dark:hover:bg-red-900/50","hover:border-red-400","dark:hover:border-red-600","transition-all","cursor-pointer",3,"click"],["class","flex items-center gap-2 flex-wrap",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"flex","items-center","gap-2","flex-wrap"],["type","number","formControlName","min","placeholder","m\xEDn",1,"w-24","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm"],[1,"flex","items-center","gap-1","cursor-pointer"],["type","checkbox","formControlName","inclusiveMin",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","dark:focus:ring-blue-600","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600"],[1,"text-lg","font-bold","text-gray-700","dark:text-gray-300"],[1,"px-3","py-1","bg-blue-100","dark:bg-blue-900/30","border","border-blue-300","dark:border-blue-800/50","text-blue-700","dark:text-blue-300","rounded-md","text-sm","font-bold"],["type","checkbox","formControlName","inclusiveMax",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","dark:focus:ring-blue-600","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600"],["type","number","formControlName","max","placeholder","m\xE1x",1,"w-24","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm"],[1,"flex","gap-2","mb-3"],[1,"space-y-2","mb-3"],[1,"flex","items-center","gap-2","cursor-pointer","text-sm","text-gray-700","dark:text-gray-300"],["type","checkbox",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","dark:focus:ring-blue-600","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600",3,"change","checked"],["type","number","formControlName","min","placeholder","valor",1,"w-32","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm"],["type","number","formControlName","max","placeholder","valor",1,"w-32","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[1,"flex","items-center","gap-3","p-3","bg-white","dark:bg-gray-700","border","border-gray-200","dark:border-gray-600","rounded-lg","cursor-pointer","hover:bg-blue-50","dark:hover:bg-gray-600","hover:border-blue-400","dark:hover:border-blue-500","transition-all","shadow-sm"],["type","checkbox",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","dark:focus:ring-blue-600","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600",3,"change"],[1,"text-sm","font-medium","text-gray-700","dark:text-gray-300"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3","mb-4"],["type","checkbox","formControlName","noContenido",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","dark:focus:ring-blue-600","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600"],["type","checkbox","formControlName","excluirPromesasPeriodoActual",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","dark:focus:ring-blue-600","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600"],["type","checkbox","formControlName","excluirCompromisos",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","dark:focus:ring-blue-600","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600"],["type","checkbox","formControlName","excluirBlacklist",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","dark:focus:ring-blue-600","dark:ring-offset-gray-800","focus:ring-2","dark:bg-gray-700","dark:border-gray-600"],[1,"pt-4","border-t","border-gray-200","dark:border-gray-700"],["type","number","min","1","formControlName","limit","placeholder","1000",1,"px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm","w-32"],[1,"p-3","bg-gradient-to-r","from-blue-600","to-violet-600","text-white","rounded-lg","text-sm","leading-relaxed","shadow-lg","min-h-[80px]"],[1,"p-8","text-center","text-sm","text-gray-500","dark:text-gray-400","bg-gray-50","dark:bg-gray-900/50","rounded-lg","border","border-gray-200","dark:border-gray-700","border-dashed","min-h-[80px]","flex","items-center","justify-center"],["type","button",1,"w-full","mt-3","px-4","py-2","bg-gray-100","dark:bg-gray-700","border","border-gray-300","dark:border-gray-600","rounded-lg","text-gray-700","dark:text-gray-300","text-sm","font-medium","hover:bg-gray-200","dark:hover:bg-gray-600","hover:border-gray-400","dark:hover:border-gray-500","transition-all","cursor-pointer","shadow-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"fixed","inset-0","bg-black/60","dark:bg-black/70","z-[2000]","flex","items-center","justify-center","animate-fade-in"],[1,"bg-white","dark:bg-gray-800","rounded-lg","p-6","max-w-md","w-11/12","shadow-2xl","text-center","animate-scale-in","border","border-gray-200","dark:border-gray-700"],[1,"w-10","h-10","border-3","border-gray-300","dark:border-gray-600","border-t-blue-600","dark:border-t-blue-400","rounded-full","animate-spin","mx-auto","mb-4"],[1,"text-base","font-bold","text-gray-900","dark:text-gray-100"],[1,"text-4xl","mb-3"],[1,"text-lg","font-bold","text-gray-900","dark:text-gray-100","mb-2"],[1,"text-sm","text-gray-700","dark:text-gray-300","mb-4","whitespace-pre-line"],["type","button",1,"w-full","px-4","py-2","bg-gradient-to-r","from-blue-600","to-violet-600","hover:from-blue-700","hover:to-violet-700","text-white","rounded-lg","text-sm","font-medium","transition-all","shadow-lg",3,"click"],["type","button",1,"w-full","px-4","py-2","bg-gradient-to-r","from-green-600","to-emerald-600","hover:from-green-700","hover:to-emerald-700","text-white","rounded-lg","text-sm","font-medium","transition-all","shadow-lg",3,"click"],[1,"bg-white","dark:bg-gray-800","rounded-lg","p-6","max-w-md","w-11/12","shadow-2xl","animate-scale-in","border","border-gray-200","dark:border-gray-700"],[1,"text-xl","font-bold","text-gray-900","dark:text-gray-100","mb-2"],[1,"text-sm","text-gray-700","dark:text-gray-300","mb-4"],["type","number","min","1","max","10","placeholder","N\xFAmero de rondas",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","dark:focus:ring-blue-400","focus:border-blue-500","dark:focus:border-blue-400","transition-all","hover:border-gray-400","dark:hover:border-gray-500","shadow-sm","mb-4",3,"ngModelChange","ngModel"],[1,"flex","gap-3"],["type","button",1,"flex-1","px-4","py-2","bg-gray-100","dark:bg-gray-700","border","border-gray-300","dark:border-gray-600","rounded-lg","text-gray-700","dark:text-gray-300","text-sm","font-medium","hover:bg-gray-200","dark:hover:bg-gray-600","hover:border-gray-400","dark:hover:border-gray-500","transition-all","cursor-pointer","shadow-sm",3,"click"],["type","button",1,"flex-1","px-4","py-2","bg-gradient-to-r","from-blue-600","to-violet-600","hover:from-blue-700","hover:to-violet-700","text-white","rounded-lg","text-sm","font-medium","transition-all","shadow-lg","shadow-blue-500/20","hover:shadow-xl","hover:shadow-blue-500/30","cursor-pointer",3,"click"]],template:function(t,r){if(t&1){let i=D();n(0,"div",2)(1,"div",3)(2,"h1",4),u(3,"Consulta Din\xE1mica SMS"),a(),n(4,"select",5)(5,"option",6),u(6,"Tramo 3"),a(),n(7,"option",7),u(8,"Tramo 5"),a(),n(9,"option",8),u(10,"Cartera Propia"),a()()(),n(11,"div",9)(12,"div",10)(13,"form",11)(14,"div",12)(15,"button",13),v("click",function(){return y(i),x(r.activeTab="variables")}),f(16,"lucide-angular",14),u(17," Variables "),a(),n(18,"button",13),v("click",function(){return y(i),x(r.activeTab="rangos")}),f(19,"lucide-angular",14),u(20," Rangos "),a(),n(21,"button",13),v("click",function(){return y(i),x(r.activeTab="condiciones")}),f(22,"lucide-angular",14),u(23," Condiciones "),a(),n(24,"button",13),v("click",function(){return y(i),x(r.activeTab="restricciones")}),f(25,"lucide-angular",14),u(26," Restricciones "),a()(),T(27,He,4,2,"div",15)(28,rt,6,3,"div",15)(29,it,18,0,"div",15)(30,nt,23,0,"div",15),a()(),n(31,"div",16)(32,"div",10)(33,"div",17),f(34,"lucide-angular",18),n(35,"span",19),u(36,"Plantilla SMS"),a()(),n(37,"div",20),f(38,"textarea",21,0),n(40,"div",22)(41,"span",23),u(42,"Caracteres:"),a(),n(43,"span",24),u(44),a()()()(),n(45,"div",10)(46,"div",25)(47,"div",26),f(48,"lucide-angular",18),n(49,"span",19),u(50,"Vista Previa"),a()(),n(51,"div",27)(52,"button",28),v("click",function(){return y(i),x(r.setMode("manual"))}),u(53," Manual "),a(),n(54,"button",28),v("click",function(){return y(i),x(r.setMode("auto"))}),u(55," Auto "),a()()(),n(56,"div",20),T(57,at,2,1,"div",29)(58,ot,2,0,"ng-template",null,1,re)(60,lt,2,1,"button",30),a()(),n(61,"div",31)(62,"button",32),v("click",function(){return y(i),x(r.generarGuiado())}),f(63,"lucide-angular",14),u(64," Generar Guiado "),a(),n(65,"button",33),v("click",function(){return y(i),x(r.exportar())}),f(66,"lucide-angular",14),u(67," Exportar Excel "),a(),n(68,"div",34),f(69,"input",35)(70,"textarea",36),n(71,"button",37),v("click",function(){return y(i),x(r.guardarCombo())}),f(72,"lucide-angular",14),u(73," Guardar Combo "),a()(),n(74,"button",33),v("click",function(){return y(i),x(r.Cancel())}),f(75,"lucide-angular",14),u(76," Cancelar "),a()()()()(),T(77,st,5,1,"div",38)(78,dt,10,1,"div",38)(79,ut,10,1,"div",38)(80,ct,12,1,"div",38)}if(t&2){let i,o,g=X(59);d(4),m("formGroup",r.form),d(9),m("formGroup",r.form),d(2),E(r.activeTab==="variables"?"border-blue-600 dark:border-blue-400 text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),d(),m("img",r.Settings)("size",16),d(2),E(r.activeTab==="rangos"?"border-blue-600 dark:border-blue-400 text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),d(),m("img",r.Filter)("size",16),d(2),E(r.activeTab==="condiciones"?"border-blue-600 dark:border-blue-400 text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),d(),m("img",r.ListChecks)("size",16),d(2),E(r.activeTab==="restricciones"?"border-blue-600 dark:border-blue-400 text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),d(),m("img",r.Ban)("size",16),d(2),m("ngIf",r.activeTab==="variables"),d(),m("ngIf",r.activeTab==="rangos"),d(),m("ngIf",r.activeTab==="condiciones"),d(),m("ngIf",r.activeTab==="restricciones"),d(4),m("img",r.FileText)("size",18),d(4),m("formGroup",r.form),d(5),E((((i=r.form.get("plantillaTexto"))==null||i.value==null?null:i.value.length)||0)>160?"text-red-600 dark:text-red-400":"text-blue-700 dark:text-blue-400"),d(),B(" ",((o=r.form.get("plantillaTexto"))==null||o.value==null?null:o.value.length)||0,"/160 "),d(4),m("img",r.Eye)("size",18),d(4),E(r.previewMode()==="manual"?"px-3 py-1 rounded-md text-xs font-bold bg-white dark:bg-gray-600 text-blue-700 dark:text-blue-300 shadow-sm transition-all":"px-3 py-1 rounded-md text-xs font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 transition-all"),d(2),E(r.previewMode()==="auto"?"px-3 py-1 rounded-md text-xs font-bold bg-white dark:bg-gray-600 text-blue-700 dark:text-blue-300 shadow-sm transition-all":"px-3 py-1 rounded-md text-xs font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 transition-all"),d(3),m("ngIf",r.previewText())("ngIfElse",g),d(3),m("ngIf",r.previewMode()==="manual"),d(3),m("img",r.Send)("size",18),d(3),m("img",r.Table)("size",18),d(3),m("formGroup",r.form),d(),m("formGroup",r.form),d(2),m("img",r.Save)("size",18),d(3),m("img",r.XCircle)("size",18),d(2),m("ngIf",r.loadingPreview()||r.loadingExport()||r.loadingSave()),d(),m("ngIf",r.alertMessage()),d(),m("ngIf",r.successMessage()),d(),m("ngIf",r.showRoundWizard())}},dependencies:[ae,ie,ne,Fe,De,Ne,Ve,Ae,Ee,we,Re,Ce,Se,Ie,Pe,Oe,Le,Be,Te,_e,ve],encapsulation:2});let s=p;return s})();export{Lt as DynQueryComponent};
