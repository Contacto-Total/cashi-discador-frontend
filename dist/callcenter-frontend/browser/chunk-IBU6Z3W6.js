import{a as ze,b as Ie}from"./chunk-6OTBVSWY.js";import{a as Ve}from"./chunk-WCH2SBI5.js";import{A as _e,E as j,b as te,c as q,f as W,k as U,m as ue,s as G,t as Y,u as X,w as fe}from"./chunk-YEUR475X.js";import{Ob as $,Pb as L}from"./chunk-4F672BDH.js";import{a as Q}from"./chunk-DF6EJM3T.js";import{Ba as Ee,Dc as ve,Gb as b,Hb as y,Ic as me,Kb as E,Lb as F,Lc as ee,Mb as g,Mc as A,Nb as a,Ob as r,Pb as _,Vb as se,Wb as k,Yb as x,_b as c,a as he,b as Ce,bb as l,da as re,ed as De,ha as le,hb as J,hd as Pe,ia as de,ic as ce,jc as R,kc as P,lc as Z,ld as N,mc as s,nc as D,oa as u,ob as I,oc as S,pa as f,pc as pe,rc as v,sc as T,sd as O,tb as oe,tc as w,td as ge,wb as K,xc as ae,ya as C,yc as Fe,zc as Me}from"./chunk-QOPKCBWK.js";var B=(function(o){return o.RESULTADO_CONTACTO="RESULTADO_CONTACTO",o.TIPO_GESTION="TIPO_GESTION",o.MODALIDAD_PAGO="MODALIDAD_PAGO",o.TIPO_FRACCIONAMIENTO="TIPO_FRACCIONAMIENTO",o})(B||{}),Te=(function(o){return o.DATE="DATE",o.NUMBER="NUMBER",o.TEXT="TEXT",o.TEXTAREA="TEXTAREA",o.CHIP_SELECT="CHIP_SELECT",o})(Te||{});var Be=o=>[o],Re=o=>({fields:o}),ye=(o,d)=>d.id;function He(o,d){if(o&1&&(a(0,"option",24),s(1),r()),o&2){let e=d.$implicit;g("value",e.typeCode),l(),D(e.typeName)}}function qe(o,d){if(o&1&&(a(0,"option",24),s(1),r()),o&2){let e=d.$implicit;g("value",e.typeCode),l(),D(e.typeName)}}function Ge(o,d){if(o&1){let e=k();a(0,"div",41)(1,"input",42),w("ngModelChange",function(i){let n=u(e).$implicit;return T(n.id,i)||(n.id=i),f(i)}),r(),a(2,"input",43),w("ngModelChange",function(i){let n=u(e).$implicit;return T(n.label,i)||(n.label=i),f(i)}),r(),a(3,"div",44)(4,"select",45),w("ngModelChange",function(i){let n=u(e).$implicit;return T(n.type,i)||(n.type=i),f(i)}),E(5,qe,2,2,"option",24,ye),r(),a(7,"button",46),x("click",function(){let i=u(e).$index,n=c(2).$implicit,p=c(2);return f(p.removeColumn(n,i))}),_(8,"lucide-angular",37),r()()()}if(o&2){let e=d.$implicit,t=c(4);l(),v("ngModel",e.id),l(),v("ngModel",e.label),l(2),v("ngModel",e.type),l(),F(t.columnFieldTypes()),l(3),g("size",16)}}function Ye(o,d){if(o&1){let e=k();a(0,"div",29)(1,"div",38)(2,"h4",39),s(3,"Columnas de la Tabla"),r(),a(4,"button",40),x("click",function(){u(e);let i=c().$implicit,n=c(2);return f(n.addColumn(i))}),s(5," + Agregar Columna "),r()(),E(6,Ge,9,4,"div",41,ye),r()}if(o&2){let e=c().$implicit;l(6),F(e.columns)}}function Xe(o,d){if(o&1){let e=k();a(0,"div",9)(1,"div",17)(2,"div",18)(3,"div",19)(4,"div")(5,"label",20),s(6," ID del Campo "),r(),a(7,"input",21),w("ngModelChange",function(i){let n=u(e).$implicit;return T(n.id,i)||(n.id=i),f(i)}),r()(),a(8,"div")(9,"label",20),s(10," Etiqueta "),r(),a(11,"input",22),w("ngModelChange",function(i){let n=u(e).$implicit;return T(n.label,i)||(n.label=i),f(i)}),r()()(),a(12,"div",19)(13,"div")(14,"label",20),s(15," Tipo de Campo "),r(),a(16,"select",23),w("ngModelChange",function(i){let n=u(e).$implicit;return T(n.type,i)||(n.type=i),f(i)}),x("ngModelChange",function(){let i=u(e).$implicit,n=c(2);return f(n.onFieldTypeChange(i))}),E(17,He,2,2,"option",24,ye),r()(),a(19,"div",25)(20,"label",26)(21,"input",27),w("ngModelChange",function(i){let n=u(e).$implicit;return T(n.required,i)||(n.required=i),f(i)}),r(),a(22,"span",28),s(23," Campo Requerido "),r()()()(),b(24,Ye,8,0,"div",29),a(25,"div")(26,"label",20),s(27," Texto de Ayuda (opcional) "),r(),a(28,"input",30),w("ngModelChange",function(i){let n=u(e).$implicit;return T(n.helpText,i)||(n.helpText=i),f(i)}),r()(),a(29,"div",31)(30,"div",32),_(31,"lucide-angular",33),a(32,"h5",34),s(33,"Vista Previa"),r()(),a(34,"app-dynamic-field-renderer",35),x("dataChange",function(i){u(e);let n=c(2);return f(n.onPreviewDataChange(i))}),r()()(),a(35,"button",36),x("click",function(){let i=u(e).$index,n=c(2);return f(n.removeField(i))}),_(36,"lucide-angular",37),r()()()}if(o&2){let e=d.$implicit,t=c(2);l(7),v("ngModel",e.id),l(4),v("ngModel",e.label),l(5),v("ngModel",e.type),l(),F(t.fieldTypes()),l(4),v("ngModel",e.required),l(3),y(e.type==="table"?24:-1),l(4),v("ngModel",e.helpText),l(3),g("size",16),l(3),g("schema",ae(11,Re,ae(9,Be,e))),l(2),g("size",20)}}function Je(o,d){o&1&&(a(0,"div",10)(1,"p"),s(2,"No hay campos configurados"),r(),a(3,"p",47),s(4,'Haz clic en "Agregar Campo" para empezar'),r()())}function Ze(o,d){if(o&1){let e=k();a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),_(4,"lucide-angular",4),s(5," Configurar Campos Personalizados "),r(),a(6,"button",5),x("click",function(){u(e);let i=c();return f(i.handleCancel())}),_(7,"lucide-angular",6),r()(),a(8,"div",7)(9,"div",8),E(10,Xe,37,13,"div",9,ye),b(12,Je,5,0,"div",10),r(),a(13,"button",11),x("click",function(){u(e);let i=c();return f(i.addField())}),_(14,"lucide-angular",12),s(15," Agregar Campo "),r()(),a(16,"div",13)(17,"button",14),x("click",function(){u(e);let i=c();return f(i.handleCancel())}),s(18," Cancelar "),r(),a(19,"button",15),x("click",function(){u(e);let i=c();return f(i.handleSave())}),_(20,"lucide-angular",16),s(21," Guardar Configuraci\xF3n "),r()()()()}if(o&2){let e=c();l(4),g("size",24),l(3),g("size",24),l(3),F(e.fields()),l(2),y(e.fields().length===0?12:-1),l(2),g("size",20),l(6),g("size",20)}}var Ae=(()=>{let d=class d{constructor(){this.apiSystemConfigService=de(Ie),this.isOpen=A.required(),this.existingSchema=A(null),this.save=ee(),this.cancel=ee(),this.fields=C([]),this.fieldTypes=C([]),this.columnFieldTypes=C([]),this.apiSystemConfigService.getFieldTypesForMainFields().subscribe(t=>{this.fieldTypes.set(t)}),this.apiSystemConfigService.getFieldTypesForTableColumns().subscribe(t=>{this.columnFieldTypes.set(t)}),me(()=>{let t=this.existingSchema();if(t&&t.fields){let i=JSON.parse(JSON.stringify(t.fields)).map(n=>Ce(he({},n),{type:n.type?.toLowerCase()||"text",columns:n.columns?.map(p=>Ce(he({},p),{type:p.type?.toLowerCase()||"text"}))}));this.fields.set(i)}else this.fields.set([])})}addField(){let t={id:`field_${Date.now()}`,label:"Nuevo Campo",type:"text",required:!1,displayOrder:this.fields().length};this.fields.update(i=>[...i,t])}removeField(t){this.fields.update(i=>i.filter((n,p)=>p!==t))}onFieldTypeChange(t){t.type==="table"&&((!t.columns||t.columns.length===0)&&(t.columns=[{id:"cuota",label:"Cuota",type:"auto-number",required:!0},{id:"fecha",label:"Fecha",type:"date",required:!0},{id:"monto",label:"Monto",type:"currency",required:!0}]),t.allowAddRow=!0,t.allowDeleteRow=!0)}addColumn(t){t.columns||(t.columns=[]);let i={id:`column_${Date.now()}`,label:"Nueva Columna",type:"text"};t.columns.push(i),this.fields.set([...this.fields()])}removeColumn(t,i){t.columns&&(t.columns.splice(i,1),this.fields.set([...this.fields()]))}handleSave(){let t={fields:this.fields()};this.save.emit(t)}handleCancel(){this.cancel.emit()}onPreviewDataChange(t){}};d.\u0275fac=function(i){return new(i||d)},d.\u0275cmp=I({type:d,selectors:[["app-field-config-dialog"]],inputs:{isOpen:[1,"isOpen"],existingSchema:[1,"existingSchema"]},outputs:{save:"save",cancel:"cancel"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-xl","max-w-4xl","w-full","max-h-[90vh]","flex","flex-col"],[1,"flex","items-center","justify-between","p-6","border-b","border-gray-200","dark:border-gray-700"],[1,"text-xl","font-bold","text-gray-900","dark:text-white","flex","items-center","gap-2"],["name","settings",1,"text-blue-600",3,"size"],["type","button",1,"text-gray-400","hover:text-gray-600","dark:hover:text-gray-300",3,"click"],["name","x",3,"size"],[1,"flex-1","overflow-y-auto","p-6","space-y-4"],[1,"space-y-3"],[1,"bg-gray-50","dark:bg-gray-700","p-4","rounded-lg","border","border-gray-200","dark:border-gray-600"],[1,"text-center","py-8","text-gray-500","dark:text-gray-400"],["type","button",1,"w-full","py-3","border-2","border-dashed","border-gray-300","dark:border-gray-600","rounded-lg","text-gray-600","dark:text-gray-400","hover:border-blue-500","hover:text-blue-500","dark:hover:border-blue-400","dark:hover:text-blue-400","transition-colors","flex","items-center","justify-center","gap-2",3,"click"],["name","plus",3,"size"],[1,"flex","items-center","justify-end","gap-3","p-6","border-t","border-gray-200","dark:border-gray-700"],["type","button",1,"px-4","py-2","text-gray-700","dark:text-gray-300","bg-gray-100","dark:bg-gray-700","rounded-lg","hover:bg-gray-200","dark:hover:bg-gray-600",3,"click"],["type","button",1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","flex","items-center","gap-2",3,"click"],["name","save",3,"size"],[1,"flex","items-start","justify-between","gap-4"],[1,"flex-1","space-y-3"],[1,"grid","grid-cols-2","gap-3"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],["type","text","placeholder","payment_schedule",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],["type","text","placeholder","Cronograma de Pago",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","items-cent","er","pt-6"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"text-sm","font-medium","text-gray-700","dark:text-gray-300"],[1,"mt-4","p-4","bg-white","dark:bg-gray-800","rounded","border","border-gray-300","dark:border-gray-600"],["type","text","placeholder","Instrucciones para el usuario...",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"mt-4","p-4","bg-gradient-to-br","from-purple-50","to-blue-50","dark:from-purple-950/30","dark:to-blue-950/30","rounded-lg","border-2","border-purple-200","dark:border-purple-800"],[1,"flex","items-center","gap-2","mb-3"],["name","eye",1,"text-purple-600","dark:text-purple-400",3,"size"],[1,"text-xs","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide"],[3,"dataChange","schema"],["type","button",1,"text-red-600","hover:text-red-800","dark:text-red-400","dark:hover:text-red-300",3,"click"],["name","trash-2",3,"size"],[1,"flex","items-center","justify-between","mb-3"],[1,"font-medium","text-gray-900","dark:text-white"],["type","button",1,"text-sm","px-3","py-1","bg-blue-600","text-white","rounded","hover:bg-blue-700",3,"click"],[1,"grid","grid-cols-3","gap-2","mb-2"],["type","text","placeholder","ID",1,"px-2","py-1","text-sm","border","border-gray-300","dark:border-gray-600","rounded","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],["type","text","placeholder","Etiqueta",1,"px-2","py-1","text-sm","border","border-gray-300","dark:border-gray-600","rounded","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],[1,"flex","gap-1"],[1,"flex-1","px-2","py-1","text-sm","border","border-gray-300","dark:border-gray-600","rounded","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white",3,"ngModelChange","ngModel"],["type","button",1,"px-2","text-red-600","hover:text-red-800",3,"click"],[1,"text-sm"]],template:function(i,n){i&1&&b(0,Ze,22,5,"div",0),i&2&&y(n.isOpen()?0:-1)},dependencies:[N,j,Y,X,q,te,G,W,U,L,$,ze],styles:["[_nghost-%COMP%]{display:contents}"]});let o=d;return o})();var ne=(()=>{let d=class d{constructor(t){this.http=t,this.catalogUrl=`${Q.gatewayUrl}/v2/typifications/catalog`,this.configUrl=`${Q.gatewayUrl}/v2/typifications/config`}getAllClassifications(){return this.http.get(`${this.catalogUrl}`)}getActiveClassifications(){return this.http.get(`${this.catalogUrl}/active`)}getTypificationsByType(t){return this.http.get(`${this.catalogUrl}/type/${t}`)}getTypificationsByLevel(t){return this.http.get(`${this.catalogUrl}/level/${t}`)}getTypificationsByParent(t){return this.http.get(`${this.catalogUrl}/${t}/children`)}getClassificationById(t){return this.http.get(`${this.catalogUrl}/${t}`)}getRootTypifications(){return this.http.get(`${this.catalogUrl}/roots`)}createTypification(t){return this.http.post(`${this.catalogUrl}`,t)}updateTypification(t,i){return this.http.put(`${this.catalogUrl}/${t}`,i)}deleteTypification(t){return this.http.delete(`${this.catalogUrl}/${t}`)}activateTypification(t){return this.http.put(`${this.catalogUrl}/${t}/activate`,{})}deactivateTypification(t){return this.http.put(`${this.catalogUrl}/${t}/deactivate`,{})}getTenantClassifications(t,i,n){let p=new O;return n&&(p=p.set("includeDisabled","true")),i?this.http.get(`${this.configUrl}/tenant/${t}/portfolio/${i}`,{params:p}):this.http.get(`${this.configUrl}/tenant/${t}`,{params:p})}getTenantClassificationsByType(t,i,n){let p=new O;return n&&(p=p.set("portfolioId",n.toString())),this.http.get(`${this.configUrl}/tenant/${t}/type/${i}`,{params:p})}getEffectiveTypifications(t,i,n){return this.http.get(`${this.configUrl}/effective/tenant/${t}/portfolio/${i}/subportfolio/${n}`)}updateTenantTypificationConfig(t,i){return this.http.put(`${this.configUrl}/${t}`,i)}enableClassification(t,i,n,p,m){let h=new O().set("userId",m?.toString()||"1");return p&&n?this.http.post(`${this.configUrl}/tenant/${t}/portfolio/${n}/subportfolio/${p}/typification/${i}/enable`,{},{params:h}):n?this.http.post(`${this.configUrl}/tenant/${t}/portfolio/${n}/typification/${i}/enable`,{},{params:h}):this.http.post(`${this.configUrl}/tenant/${t}/typification/${i}/enable`,{},{params:h})}disableClassification(t,i,n,p,m){let h=new O().set("userId",m?.toString()||"1");return p&&n?this.http.post(`${this.configUrl}/tenant/${t}/portfolio/${n}/subportfolio/${p}/typification/${i}/disable`,{},{params:h}):n?this.http.post(`${this.configUrl}/tenant/${t}/portfolio/${n}/typification/${i}/disable`,{},{params:h}):this.http.post(`${this.configUrl}/tenant/${t}/typification/${i}/disable`,{},{params:h})}getAllTenants(){return this.http.get(`${Q.webServiceUrl}/v1/system-config/tenants`)}getPortfoliosByTenant(t){return this.http.get(`${Q.webServiceUrl}/v1/system-config/tenants/${t}/portfolios`)}getSubPortfoliosByPortfolio(t){return this.http.get(`${this.configUrl}/portfolios/${t}/subportfolios`)}getAdditionalFields(t){return this.http.get(`${this.catalogUrl}/${t}/additional-fields`)}saveAdditionalFields(t,i){return this.http.put(`${this.catalogUrl}/${t}/additional-fields`,i)}getTypificationFieldsWithValues(t,i,n,p){let m=new O;return n&&(m=m.set("portfolioId",n.toString())),p&&(m=m.set("clientId",p.toString())),this.http.get(`${this.configUrl}/tenant/${t}/typifications/${i}/fields`,{params:m})}getDynamicTableColumns(t,i,n){let p=new O().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",n.toString());return this.http.get(`${this.configUrl}/dynamic-table-columns`,{params:p})}generarOpcionesCampo(t,i,n,p){let m=new O().set("tenantId",i.toString()).set("portfolioId",n.toString()).set("subPortfolioId",p.toString());return this.http.get(`${this.catalogUrl}/campo/${t}/opciones/generar`,{params:m})}inicializarOpcionesCampo(t,i,n,p){let m=new O().set("tenantId",i.toString()).set("portfolioId",n.toString()).set("subPortfolioId",p.toString());return this.http.post(`${this.catalogUrl}/campo/${t}/opciones/inicializar`,{},{params:m})}getOpcionesCampo(t){return this.http.get(`${this.catalogUrl}/campo/${t}/opciones`)}getOpcionesHabilitadas(t){return this.http.get(`${this.catalogUrl}/campo/${t}/opciones/habilitadas`)}configurarOpciones(t){return this.http.put(`${this.catalogUrl}/campo/opciones/configurar`,t)}getOpcionesConValores(t,i,n,p,m){let h=new O().set("tenantId",i.toString()).set("portfolioId",n.toString()).set("subPortfolioId",p.toString()).set("clientId",m.toString());return this.http.get(`${this.catalogUrl}/campo/${t}/opciones/valores`,{params:h})}buildClassificationTree(t){let i=new Map,n=[];t.forEach(m=>{i.set(m.id,{typification:m,children:[],level:m.nivelJerarquia})}),t.forEach(m=>{let h=i.get(m.id),V=m.tipificacionPadre?.id;if(V){let M=i.get(V);M&&M.children.push(h)}else n.push(h)});let p=m=>{m.children.length>0&&(m.children.sort((h,V)=>{let M=h.typification.ordenVisualizacion||0,z=V.typification.ordenVisualizacion||0;return M-z}),m.children.forEach(h=>p(h)))};return n.forEach(m=>p(m)),n}};d.\u0275fac=function(i){return new(i||d)(le(ge))},d.\u0275prov=re({token:d,factory:d.\u0275fac,providedIn:"root"});let o=d;return o})();var Ke=(o,d)=>d.hex,et=(o,d)=>d.name;function tt(o,d){if(o&1&&(a(0,"p",12),s(1),r()),o&2){let e=c();l(),D(e.errors().codigo)}}function it(o,d){if(o&1&&(a(0,"p",12),s(1),r()),o&2){let e=c();l(),D(e.errors().nombre)}}function nt(o,d){if(o&1&&(a(0,"p",12),s(1),r()),o&2){let e=c();l(),D(e.errors().tipoClasificacion)}}function ot(o,d){o&1&&_(0,"lucide-angular",46),o&2&&g("size",20)}function at(o,d){if(o&1){let e=k();a(0,"button",45),x("click",function(){let i=u(e).$implicit,n=c();return f(n.form.colorSugerido=i.hex)}),b(1,ot,1,1,"lucide-angular",46),r()}if(o&2){let e=d.$implicit,t=c();Z("w-12 h-12 rounded-lg border-2 transition-all hover:scale-110 flex items-center justify-center "+(t.form.colorSugerido===e.hex?"border-gray-900 dark:border-white ring-2 ring-offset-2 ring-gray-900 dark:ring-white":"border-gray-300 dark:border-gray-600")),R("background-color",e.hex),g("title",e.name),l(),y(t.form.colorSugerido===e.hex?1:-1)}}function rt(o,d){if(o&1){let e=k();a(0,"button",45),x("click",function(){let i=u(e).$implicit,n=c();return f(n.form.iconoSugerido=i.name)}),_(1,"lucide-angular",47),r()}if(o&2){let e=d.$implicit,t=c();Z("p-2.5 rounded-lg border-2 transition-all hover:bg-gray-100 dark:hover:bg-slate-700 flex items-center justify-center "+(t.form.iconoSugerido===e.name?"border-blue-500 bg-blue-50 dark:bg-blue-950/30 ring-2 ring-blue-300":"border-gray-300 dark:border-gray-600")),g("title",e.label),l(),g("name",e.name)("size",18)}}function lt(o,d){if(o&1){let e=k();a(0,"div",32),_(1,"lucide-angular",48),a(2,"span",49),s(3),r(),a(4,"button",50),x("click",function(){u(e);let i=c();return f(i.form.iconoSugerido="")}),_(5,"lucide-angular",6),r()()}if(o&2){let e=c();l(),g("name",e.form.iconoSugerido)("size",28),l(2),S("Icono seleccionado: ",e.form.iconoSugerido),l(2),g("size",18)}}function dt(o,d){o&1&&(a(0,"p",33),s(1,"No has seleccionado ning\xFAn icono"),r())}function st(o,d){if(o&1){let e=k();a(0,"div",23)(1,"input",51),w("ngModelChange",function(i){u(e);let n=c();return T(n.form.estaActiva,i)||(n.form.estaActiva=i),f(i)}),r(),a(2,"label",52),s(3," Tipificaci\xF3n Activa "),a(4,"span",53),s(5,"Desmarca para desactivar temporalmente esta tipificaci\xF3n"),r()()()}if(o&2){let e=c();l(),v("ngModel",e.form.estaActiva)}}function ct(o,d){if(o&1&&(a(0,"div",37)(1,"div",54),_(2,"lucide-angular",55),a(3,"span",56),s(4,"Tipificaci\xF3n Hijo"),r()(),a(5,"p",57)(6,"span",58),s(7,"Padre:"),r(),s(8),a(9,"span",59),s(10),r()(),a(11,"p",60),s(12),r()()),o&2){let e=c();l(2),g("size",16),l(6),S(" ",e.parentClassification.nombre," "),l(2),S("(",e.parentClassification.codigo,")"),l(2),S(" Esta tipificaci\xF3n ser\xE1 nivel ",e.parentClassification.nivelJerarquia+1," en la jerarqu\xEDa ")}}function pt(o,d){o&1&&(_(0,"div",61),s(1," Guardando... "))}function mt(o,d){o&1&&(_(0,"lucide-angular",62),s(1," Guardar ")),o&2&&g("size",18)}function gt(o,d){if(o&1){let e=k();a(0,"app-field-config-dialog",63),x("save",function(i){u(e);let n=c();return f(n.onFieldConfigSave(i))})("cancel",function(){u(e);let i=c();return f(i.onFieldConfigCancel())}),r()}if(o&2){let e=c();g("isOpen",e.showFieldConfig())("existingSchema",e.form.metadataSchema||null)}}var Oe=(()=>{let d=class d{constructor(t){this.classificationService=t,this.mode="create",this.save=new K,this.cancel=new K,this.ClassificationTypeV2=B,this.isEditMode=!1,this.form={codigo:"",nombre:"",tipoClasificacion:"",descripcion:"",ordenVisualizacion:0,iconoSugerido:"",colorSugerido:"#3B82F6",estaActiva:!0},this.showFieldConfig=C(!1),this.presetColors=[{hex:"#3B82F6",name:"Azul"},{hex:"#10B981",name:"Verde"},{hex:"#EF4444",name:"Rojo"},{hex:"#F59E0B",name:"Naranja"},{hex:"#8B5CF6",name:"Violeta"},{hex:"#EC4899",name:"Rosa"},{hex:"#6366F1",name:"\xCDndigo"},{hex:"#14B8A6",name:"Turquesa"},{hex:"#F97316",name:"Naranja Oscuro"},{hex:"#06B6D4",name:"Cyan"},{hex:"#84CC16",name:"Lima"},{hex:"#A855F7",name:"P\xFArpura"},{hex:"#64748B",name:"Gris"},{hex:"#0EA5E9",name:"Azul Cielo"},{hex:"#22C55E",name:"Verde Claro"},{hex:"#DC2626",name:"Rojo Oscuro"}],this.commonIcons=[{name:"phone",label:"Tel\xE9fono"},{name:"phone-call",label:"Llamada"},{name:"phone-incoming",label:"Llamada Entrante"},{name:"phone-outgoing",label:"Llamada Saliente"},{name:"phone-missed",label:"Llamada Perdida"},{name:"check-circle",label:"\xC9xito"},{name:"x-circle",label:"Error"},{name:"alert-circle",label:"Alerta"},{name:"alert-triangle",label:"Advertencia"},{name:"info",label:"Informaci\xF3n"},{name:"user",label:"Usuario"},{name:"users",label:"Usuarios"},{name:"user-check",label:"Usuario Verificado"},{name:"user-x",label:"Usuario Rechazado"},{name:"credit-card",label:"Tarjeta"},{name:"dollar-sign",label:"Dinero"},{name:"banknote",label:"Billete"},{name:"coins",label:"Monedas"},{name:"calendar",label:"Calendario"},{name:"calendar-check",label:"Fecha Confirmada"},{name:"calendar-x",label:"Fecha Cancelada"},{name:"clock",label:"Reloj"},{name:"timer",label:"Temporizador"},{name:"mail",label:"Correo"},{name:"message-square",label:"Mensaje"},{name:"message-circle",label:"Chat"},{name:"file-text",label:"Documento"},{name:"file-check",label:"Documento Aprobado"},{name:"file-x",label:"Documento Rechazado"},{name:"building",label:"Edificio"},{name:"home",label:"Casa"},{name:"wallet",label:"Billetera"},{name:"briefcase",label:"Malet\xEDn"},{name:"trending-up",label:"Tendencia Positiva"},{name:"trending-down",label:"Tendencia Negativa"},{name:"thumbs-up",label:"Me gusta"},{name:"thumbs-down",label:"No me gusta"},{name:"star",label:"Estrella"},{name:"heart",label:"Coraz\xF3n"},{name:"bell",label:"Campana"},{name:"bell-off",label:"Silenciar"},{name:"settings",label:"Configuraci\xF3n"},{name:"shield",label:"Seguridad"},{name:"shield-check",label:"Verificado"},{name:"lock",label:"Bloqueado"},{name:"unlock",label:"Desbloqueado"},{name:"map-pin",label:"Ubicaci\xF3n"},{name:"navigation",label:"Navegaci\xF3n"},{name:"send",label:"Enviar"},{name:"download",label:"Descargar"},{name:"upload",label:"Subir"},{name:"plus-circle",label:"Agregar"},{name:"minus-circle",label:"Quitar"},{name:"edit",label:"Editar"},{name:"trash",label:"Eliminar"},{name:"archive",label:"Archivar"},{name:"bookmark",label:"Marcador"},{name:"tag",label:"Etiqueta"},{name:"flag",label:"Bandera"},{name:"zap",label:"Rayo"},{name:"target",label:"Objetivo"}],this.saving=C(!1),this.errors=C({})}ngOnInit(){this.isEditMode=this.mode==="edit",this.defaultType&&(this.form.tipoClasificacion=this.defaultType),this.isEditMode&&this.typification&&(this.form={codigo:this.typification.codigo,nombre:this.typification.nombre,tipoClasificacion:this.typification.tipoClasificacion,descripcion:this.typification.descripcion||"",ordenVisualizacion:this.typification.ordenVisualizacion||0,iconoSugerido:this.typification.iconoSugerido||"",colorSugerido:this.typification.colorSugerido||"#3B82F6",estaActiva:this.typification.estaActiva})}validate(){let t={};return this.form.codigo.trim()||(t.codigo="El c\xF3digo es requerido"),this.form.nombre.trim()||(t.nombre="El nombre es requerido"),this.form.tipoClasificacion||(t.tipoClasificacion="El tipo de clasificaci\xF3n es requerido"),this.errors.set(t),Object.keys(t).length===0}onSave(){this.validate()&&(this.saving.set(!0),this.isEditMode&&this.typification?this.updateTypification():this.createTypification())}createTypification(){let t={codigo:this.form.codigo.trim(),nombre:this.form.nombre.trim(),tipoClasificacion:this.form.tipoClasificacion,idTipificacionPadre:this.parentClassification?this.parentClassification.id:void 0,descripcion:this.form.descripcion.trim()||void 0,ordenVisualizacion:this.form.ordenVisualizacion,iconoSugerido:this.form.iconoSugerido.trim()||void 0,colorSugerido:this.form.colorSugerido||void 0};this.classificationService.createTypification(t).subscribe({next:i=>{console.log("\u2705 Clasificaci\xF3n creada:",i),this.tenantId?(console.log(`\u{1F504} Auto-habilitando clasificaci\xF3n ${i.id} para tenant ${this.tenantId}`),this.classificationService.enableClassification(this.tenantId,i.id,this.portfolioId).subscribe({next:()=>{console.log("\u2705 Clasificaci\xF3n auto-habilitada para el tenant"),this.saving.set(!1),this.save.emit(i)},error:n=>{console.error("\u26A0\uFE0F Error al auto-habilitar (pero la clasificaci\xF3n se cre\xF3):",n),this.saving.set(!1),this.save.emit(i)}})):(this.saving.set(!1),this.save.emit(i))},error:i=>{console.error("Error al crear tipificaci\xF3n:",i),this.saving.set(!1),alert("Error al crear la tipificaci\xF3n. Verifique que el c\xF3digo no est\xE9 duplicado.")}})}updateTypification(){if(!this.typification)return;let t={nombre:this.form.nombre.trim(),descripcion:this.form.descripcion.trim()||void 0,ordenVisualizacion:this.form.ordenVisualizacion,iconoSugerido:this.form.iconoSugerido.trim()||void 0,colorSugerido:this.form.colorSugerido||void 0,estaActiva:this.form.estaActiva};this.classificationService.updateTypification(this.typification.id,t).subscribe({next:i=>{this.saving.set(!1),this.save.emit(i)},error:i=>{console.error("Error al actualizar tipificaci\xF3n:",i),this.saving.set(!1),alert("Error al actualizar la tipificaci\xF3n.")}})}onCancel(){this.cancel.emit()}getDialogTitle(){return this.isEditMode?"Editar Tipificaci\xF3n":this.parentClassification?`Nueva Tipificaci\xF3n - Nivel ${this.parentClassification.nivelJerarquia+1}`:"Nueva Tipificaci\xF3n - Nivel 1"}openFieldConfig(){console.log("\u{1F527} Abriendo configuraci\xF3n de campos din\xE1micos"),this.showFieldConfig.set(!0)}onFieldConfigSave(t){console.log("\u{1F4BE} Guardando configuraci\xF3n de campos:",t),this.form.metadataSchema=t,this.showFieldConfig.set(!1)}onFieldConfigCancel(){console.log("\u274C Cancelando configuraci\xF3n de campos"),this.showFieldConfig.set(!1)}};d.\u0275fac=function(i){return new(i||d)(J(ne))},d.\u0275cmp=I({type:d,selectors:[["app-typification-form-dialog"]],inputs:{mode:"mode",typification:"typification",parentClassification:"parentClassification",defaultType:"defaultType",tenantId:"tenantId",portfolioId:"portfolioId"},outputs:{save:"save",cancel:"cancel"},decls:101,vars:37,consts:[[1,"fixed","inset-0","bg-black/50","dark:bg-black/70","flex","items-center","justify-center","z-50","p-4","transition-opacity","duration-300",3,"click"],[1,"bg-white","dark:bg-slate-900","rounded-lg","shadow-2xl","max-w-4xl","w-full","max-h-[90vh]","overflow-auto","transition-all","duration-300","transform",3,"click"],[1,"sticky","top-0","bg-gradient-to-r","from-blue-600","to-blue-700","dark:from-blue-700","dark:to-blue-800","text-white","px-6","py-4","flex","items-center","justify-between","rounded-t-lg","z-10"],[1,"text-xl","font-bold"],[1,"text-sm","text-blue-100","dark:text-blue-200"],[1,"p-2","hover:bg-white/20","rounded-lg","transition-colors",3,"click"],["name","x",3,"size"],[1,"p-6","space-y-6"],[1,"grid","grid-cols-2","gap-4"],[1,"block","text-sm","font-bold","text-gray-700","dark:text-gray-200","mb-2"],[1,"text-red-500"],["type","text","placeholder","Ej: CPC, ACP, PPR","maxlength","20",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","disabled:bg-gray-100","dark:disabled:bg-slate-700","disabled:cursor-not-allowed","text-sm",3,"ngModelChange","ngModel","disabled"],[1,"text-red-500","text-xs","mt-1"],["type","text","placeholder","Ej: Contacto con Cliente, Promesa de Pago","maxlength","255",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","text-sm",3,"ngModelChange","ngModel"],[1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","disabled:bg-gray-100","dark:disabled:bg-slate-700","disabled:cursor-not-allowed","text-sm",3,"ngModelChange","ngModel","disabled"],["value",""],[3,"value"],[1,"text-xs","font-normal","text-gray-500","dark:text-gray-400","ml-1"],["rows","3","placeholder","Descripci\xF3n detallada de la tipificaci\xF3n...",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","text-sm",3,"ngModelChange","ngModel"],[1,"block","text-sm","font-bold","text-gray-700","dark:text-gray-200","mb-3"],[1,"space-y-3"],[1,"grid","grid-cols-8","gap-2"],["type","button",3,"class","background-color","title"],[1,"flex","items-center","gap-3","p-3","bg-gray-50","dark:bg-slate-800","rounded-lg","border","border-gray-200","dark:border-gray-700"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-200"],["type","color",1,"h-12","w-24","border-2","border-gray-300","dark:border-gray-600","rounded-lg","cursor-pointer",3,"ngModelChange","ngModel"],[1,"flex-1","flex","items-center","gap-3"],[1,"w-10","h-10","rounded-lg","border-2","border-gray-300","dark:border-gray-600"],[1,"text-sm","font-mono","font-bold","text-gray-700","dark:text-gray-300"],[1,"max-h-64","overflow-y-auto","border","border-gray-200","dark:border-gray-700","rounded-lg","p-3","bg-gray-50","dark:bg-slate-800/50"],[1,"grid","grid-cols-8","md:grid-cols-10","lg:grid-cols-12","gap-2"],["type","button",3,"class","title"],[1,"flex","items-center","gap-3","p-3","bg-blue-50","dark:bg-blue-950/30","rounded-lg","border","border-blue-200","dark:border-blue-900"],[1,"text-xs","text-gray-500","dark:text-gray-400"],["type","number","min","0","step","10","placeholder","0, 10, 20, 30...",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","text-sm",3,"ngModelChange","ngModel"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1","flex","items-center","gap-1"],["name","alert-circle",3,"size"],[1,"bg-blue-50","dark:bg-blue-950/30","border","border-blue-200","dark:border-blue-900/50","rounded-lg","p-4"],[1,"sticky","bottom-0","bg-gray-50","dark:bg-slate-800","px-6","py-4","flex","justify-between","items-center","rounded-b-lg","border-t","border-gray-200","dark:border-gray-700"],["type","button",1,"px-4","py-2.5","text-indigo-600","dark:text-indigo-400","bg-indigo-50","dark:bg-indigo-950/30","border","border-indigo-300","dark:border-indigo-800","rounded-lg","hover:bg-indigo-100","dark:hover:bg-indigo-900/50","font-semibold","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","settings",3,"size"],[1,"flex","gap-3"],[1,"px-6","py-2.5","text-gray-700","dark:text-gray-200","bg-white","dark:bg-slate-700","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-50","dark:hover:bg-slate-600","font-semibold","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],[1,"px-6","py-2.5","bg-gradient-to-r","from-blue-600","to-blue-700","hover:from-blue-700","hover:to-blue-800","disabled:from-gray-400","disabled:to-gray-500","text-white","rounded-lg","font-semibold","transition-all","shadow-md","hover:shadow-lg","flex","items-center","gap-2","text-sm",3,"click","disabled"],[3,"isOpen","existingSchema"],["type","button",3,"click","title"],["name","check-circle",1,"text-white","drop-shadow-lg",3,"size"],[1,"text-gray-700","dark:text-gray-200",3,"name","size"],[1,"text-blue-600","dark:text-blue-400",3,"name","size"],[1,"text-sm","font-semibold","text-blue-800","dark:text-blue-200"],["type","button",1,"ml-auto","text-blue-600","dark:text-blue-400","hover:text-blue-800","dark:hover:text-blue-200",3,"click"],["type","checkbox","id","estaActiva",1,"w-5","h-5","text-blue-600","bg-gray-100","dark:bg-gray-700","border-gray-300","dark:border-gray-600","rounded","focus:ring-blue-500","cursor-pointer",3,"ngModelChange","ngModel"],["for","estaActiva",1,"text-sm","font-bold","text-gray-700","dark:text-gray-200","cursor-pointer","flex-1"],[1,"block","text-xs","font-normal","text-gray-500","dark:text-gray-400","mt-0.5"],[1,"flex","items-center","gap-2","text-blue-800","dark:text-blue-200","mb-1"],["name","git-branch",3,"size"],[1,"font-bold"],[1,"text-sm","text-blue-700","dark:text-blue-300"],[1,"font-semibold"],[1,"text-xs","opacity-75"],[1,"text-xs","text-blue-600","dark:text-blue-400","mt-1"],[1,"w-4","h-4","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],["name","save",3,"size"],[3,"save","cancel","isOpen","existingSchema"]],template:function(i,n){i&1&&(a(0,"div",0),x("click",function(){return n.onCancel()}),a(1,"div",1),x("click",function(m){return m.stopPropagation()}),a(2,"div",2)(3,"div")(4,"h2",3),s(5),r(),a(6,"p",4),s(7),r()(),a(8,"button",5),x("click",function(){return n.onCancel()}),_(9,"lucide-angular",6),r()(),a(10,"div",7)(11,"div",8)(12,"div")(13,"label",9),s(14," C\xF3digo "),a(15,"span",10),s(16,"*"),r()(),a(17,"input",11),w("ngModelChange",function(m){return T(n.form.codigo,m)||(n.form.codigo=m),m}),r(),b(18,tt,2,1,"p",12),r(),a(19,"div")(20,"label",9),s(21," Nombre "),a(22,"span",10),s(23,"*"),r()(),a(24,"input",13),w("ngModelChange",function(m){return T(n.form.nombre,m)||(n.form.nombre=m),m}),r(),b(25,it,2,1,"p",12),r()(),a(26,"div")(27,"label",9),s(28," Tipo de Clasificaci\xF3n "),a(29,"span",10),s(30,"*"),r()(),a(31,"select",14),w("ngModelChange",function(m){return T(n.form.tipoClasificacion,m)||(n.form.tipoClasificacion=m),m}),a(32,"option",15),s(33,"-- Seleccionar --"),r(),a(34,"option",16),s(35,"Resultado de Contacto"),r(),a(36,"option",16),s(37,"Tipo de Gesti\xF3n"),r(),a(38,"option",16),s(39,"Modalidad de Pago"),r(),a(40,"option",16),s(41,"Tipo de Fraccionamiento"),r()(),b(42,nt,2,1,"p",12),r(),a(43,"div")(44,"label",9),s(45," Descripci\xF3n "),a(46,"span",17),s(47,"(Opcional)"),r()(),a(48,"textarea",18),w("ngModelChange",function(m){return T(n.form.descripcion,m)||(n.form.descripcion=m),m}),r()(),a(49,"div")(50,"label",19),s(51," Color de Identificaci\xF3n "),a(52,"span",17),s(53,"(Selecciona el color que representar\xE1 esta tipificaci\xF3n)"),r()(),a(54,"div",20)(55,"div",21),E(56,at,2,6,"button",22,Ke),r(),a(58,"div",23)(59,"label",24),s(60,"Color personalizado:"),r(),a(61,"input",25),w("ngModelChange",function(m){return T(n.form.colorSugerido,m)||(n.form.colorSugerido=m),m}),r(),a(62,"div",26),_(63,"div",27),a(64,"span",28),s(65),r()()()()(),a(66,"div")(67,"label",19),s(68," Icono Visual "),a(69,"span",17),s(70),r()(),a(71,"div",20)(72,"div",29)(73,"div",30),E(74,rt,2,5,"button",31,et),r()(),b(76,lt,6,4,"div",32)(77,dt,2,0,"p",33),r()(),a(78,"div")(79,"label",9),s(80," Orden de Visualizaci\xF3n "),a(81,"span",17),s(82,"(Menor n\xFAmero aparece primero)"),r()(),a(83,"input",34),w("ngModelChange",function(m){return T(n.form.ordenVisualizacion,m)||(n.form.ordenVisualizacion=m),m}),r(),a(84,"p",35),_(85,"lucide-angular",36),s(86," Tip: Usa m\xFAltiplos de 10 (10, 20, 30...) para facilitar inserciones futuras "),r()(),b(87,st,6,1,"div",23),b(88,ct,13,4,"div",37),r(),a(89,"div",38)(90,"button",39),x("click",function(){return n.openFieldConfig()}),_(91,"lucide-angular",40),s(92," Configurar Campos Din\xE1micos "),r(),a(93,"div",41)(94,"button",42),x("click",function(){return n.onCancel()}),_(95,"lucide-angular",6),s(96," Cancelar "),r(),a(97,"button",43),x("click",function(){return n.onSave()}),b(98,pt,2,0)(99,mt,2,1),r()()()()(),b(100,gt,1,2,"app-field-config-dialog",44)),i&2&&(l(5),D(n.getDialogTitle()),l(2),S(" ",n.isEditMode?"Modificar tipificaci\xF3n existente":"Crear nueva tipificaci\xF3n"," "),l(2),g("size",24),l(8),P("border-red-500",n.errors().codigo),v("ngModel",n.form.codigo),g("disabled",n.isEditMode),l(),y(n.errors().codigo?18:-1),l(6),P("border-red-500",n.errors().nombre),v("ngModel",n.form.nombre),l(),y(n.errors().nombre?25:-1),l(6),P("border-red-500",n.errors().tipoClasificacion),v("ngModel",n.form.tipoClasificacion),g("disabled",n.isEditMode||!!n.defaultType),l(3),g("value",n.ClassificationTypeV2.RESULTADO_CONTACTO),l(2),g("value",n.ClassificationTypeV2.TIPO_GESTION),l(2),g("value",n.ClassificationTypeV2.MODALIDAD_PAGO),l(2),g("value",n.ClassificationTypeV2.TIPO_FRACCIONAMIENTO),l(2),y(n.errors().tipoClasificacion?42:-1),l(6),v("ngModel",n.form.descripcion),l(8),F(n.presetColors),l(5),v("ngModel",n.form.colorSugerido),l(2),R("background-color",n.form.colorSugerido),l(2),D(n.form.colorSugerido),l(5),S("(",n.commonIcons.length," iconos disponibles)"),l(4),F(n.commonIcons),l(2),y(n.form.iconoSugerido?76:77),l(7),v("ngModel",n.form.ordenVisualizacion),l(2),g("size",12),l(2),y(n.isEditMode?87:-1),l(),y(n.parentClassification?88:-1),l(3),g("size",18),l(4),g("size",18),l(2),g("disabled",n.saving()),l(),y(n.saving()?98:99),l(2),y(n.showFieldConfig()?100:-1))},dependencies:[N,j,Y,X,q,ue,te,G,W,_e,fe,U,L,$,Ae],encapsulation:2});let o=d;return o})();var H=(function(o){return o.CONTACT_RESULT="CONTACT_RESULT",o.MANAGEMENT_TYPE="MANAGEMENT_TYPE",o.PAYMENT_TYPE="PAYMENT_TYPE",o.COMPLAINT_TYPE="COMPLAINT_TYPE",o.PAYMENT_SCHEDULE="PAYMENT_SCHEDULE",o.CUSTOM="CUSTOM",o})(H||{});var $e=(()=>{let d=class d{constructor(t){this.http=t,this.baseUrl=`${Q.gatewayUrl}/classification-types`}getActiveTypes(){return this.http.get(`${this.baseUrl}/active`)}getAllTypes(){return this.http.get(`${this.baseUrl}`)}getTypeById(t){return this.http.get(`${this.baseUrl}/${t}`)}getTypeByCode(t){return this.http.get(`${this.baseUrl}/code/${t}`)}createType(t){return this.http.post(`${this.baseUrl}`,t)}updateType(t,i){return this.http.put(`${this.baseUrl}/${t}`,i)}deleteType(t){return this.http.delete(`${this.baseUrl}/${t}`)}deactivateType(t){return this.http.patch(`${this.baseUrl}/${t}/deactivate`,{})}};d.\u0275fac=function(i){return new(i||d)(le(ge))},d.\u0275prov=re({token:d,factory:d.\u0275fac,providedIn:"root"});let o=d;return o})();var ft=(o,d)=>d.type;function _t(o,d){if(o&1&&(a(0,"p",16),s(1),r()),o&2){let e=c();l(),D(e.errors().code)}}function xt(o,d){if(o&1&&(a(0,"p",16),s(1),r()),o&2){let e=c();l(),D(e.errors().name)}}function bt(o,d){if(o&1&&(a(0,"div",38)(1,"p",39),s(2,"Ejemplo:"),r(),a(3,"div",40)(4,"span",41),s(5),r(),a(6,"span",42),s(7),r()()()),o&2){let e=c().$implicit;l(5),D(e.code),l(2),D(e.name)}}function yt(o,d){o&1&&(a(0,"div",38)(1,"p",43),s(2,"No hay clasificaciones de este tipo a\xFAn"),r()())}function ht(o,d){if(o&1&&(a(0,"div",32)(1,"div",33)(2,"div",34)(3,"p",35),s(4),r(),a(5,"p",36),s(6),r()(),a(7,"span",37),s(8),r()(),b(9,bt,8,2,"div",38)(10,yt,3,0,"div",38),r()),o&2){let e=d.$implicit,t=c(2);P("border-blue-200",e.count>0)("dark:border-blue-900",e.count>0)("border-gray-200",e.count===0)("dark:border-gray-700",e.count===0)("opacity-60",e.count===0),l(3),P("text-blue-700",e.count>0)("dark:text-blue-300",e.count>0)("text-gray-500",e.count===0)("dark:text-gray-500",e.count===0),l(),S(" ",e.type," "),l(2),D(t.getTypeLabel(e.type)),l(),P("bg-blue-100",e.count>0)("dark:bg-blue-900/50",e.count>0)("text-blue-700",e.count>0)("dark:text-blue-300",e.count>0)("bg-gray-100",e.count===0)("dark:bg-gray-700",e.count===0)("text-gray-500",e.count===0)("dark:text-gray-400",e.count===0),l(),pe(" ",e.count," ",e.count===1?"clasificaci\xF3n":"clasificaciones"," "),l(),y(e.count>0?9:10)}}function Ct(o,d){if(o&1&&(a(0,"div",22)(1,"div",27),_(2,"lucide-angular",28),a(3,"span",29),s(4,"Tipos de Clasificaci\xF3n en el Sistema:"),r()(),a(5,"div",30),E(6,ht,11,39,"div",31,ft),r()()),o&2){let e=c();l(2),g("size",16),l(4),F(e.typeExamples())}}function vt(o,d){o&1&&(a(0,"div",23)(1,"div",44),_(2,"lucide-angular",18),a(3,"span",45),s(4,"No hay clasificaciones existentes para mostrar como ejemplo."),r()()()),o&2&&(l(2),g("size",16))}function Tt(o,d){o&1&&(_(0,"div",46),s(1," Creando... "))}function wt(o,d){o&1&&(_(0,"lucide-angular",47),s(1," Crear Categor\xEDa ")),o&2&&g("size",18)}var Le=(()=>{let d=class d{constructor(t){this.classificationTypeService=t,this.typifications=[],this.save=new K,this.cancel=new K,this.form={code:"",name:"",description:""},this.saving=C(!1),this.errors=C({}),this.typeExamples=C([])}ngOnInit(){this.buildTypeExamples()}ngOnChanges(t){t.typifications&&t.typifications.currentValue&&this.buildTypeExamples()}buildTypeExamples(){let t=new Map;Object.values(H).forEach(n=>{t.set(n,{codes:[],names:[],count:0})}),this.typifications.forEach(n=>{let p=n.classificationType;if(t.has(p)){let m=t.get(p);m.count++,m.codes.length<1&&(m.codes.push(n.code),m.names.push(n.name))}});let i=[];t.forEach((n,p)=>{i.push({type:p,code:n.codes[0]||"-",name:n.names[0]||"Sin ejemplos disponibles",count:n.count})}),this.typeExamples.set(i)}getTypeLabel(t){return{[H.CONTACT_RESULT]:"Resultado de Contacto",[H.MANAGEMENT_TYPE]:"Tipo de Gesti\xF3n",[H.PAYMENT_TYPE]:"Tipo de Pago",[H.COMPLAINT_TYPE]:"Tipo de Reclamo",[H.PAYMENT_SCHEDULE]:"Cronograma de Pagos",[H.CUSTOM]:"Personalizado"}[t]}validate(){let t={};return this.form.code.trim()?/^[A-Z_]+$/.test(this.form.code.trim())||(t.code="El c\xF3digo debe contener solo MAY\xDASCULAS y guiones bajos"):t.code="El c\xF3digo es requerido",this.form.name.trim()||(t.name="El nombre es requerido"),this.errors.set(t),Object.keys(t).length===0}onSave(){if(!this.validate())return;this.saving.set(!0);let t={code:this.form.code.trim(),name:this.form.name.trim(),description:this.form.description.trim()||void 0,isActive:!0,isSystem:!1,displayOrder:0};this.classificationTypeService.createType(t).subscribe({next:i=>{console.log("\u2705 Tipo de clasificaci\xF3n creado:",i),this.saving.set(!1),this.save.emit(i.code)},error:i=>{console.error("\u274C Error creando tipo de clasificaci\xF3n:",i),this.saving.set(!1);let n=i.error||i.message||"Error desconocido al crear la categor\xEDa";alert(`\u274C Error al crear la categor\xEDa:

${n}`)}})}onCancel(){this.cancel.emit()}};d.\u0275fac=function(i){return new(i||d)(J($e))},d.\u0275cmp=I({type:d,selectors:[["app-category-form-dialog"]],inputs:{typifications:"typifications"},outputs:{save:"save",cancel:"cancel"},features:[Ee],decls:54,vars:17,consts:[[1,"fixed","inset-0","bg-black/50","dark:bg-black/70","flex","items-center","justify-center","z-50","p-4","transition-opacity","duration-300",3,"click"],[1,"bg-white","dark:bg-slate-900","rounded-lg","shadow-2xl","max-w-2xl","w-full","max-h-[90vh]","overflow-auto","transition-all","duration-300","transform",3,"click"],[1,"sticky","top-0","bg-gradient-to-r","from-purple-600","to-purple-700","dark:from-purple-700","dark:to-purple-800","text-white","px-6","py-4","flex","items-center","justify-between","rounded-t-lg","z-10"],[1,"text-xl","font-bold"],[1,"text-sm","text-purple-100","dark:text-purple-200"],[1,"p-2","hover:bg-white/20","rounded-lg","transition-colors",3,"click"],["name","x",3,"size"],[1,"p-6","space-y-6"],[1,"bg-yellow-50","dark:bg-yellow-900/20","border-l-4","border-yellow-500","p-4","rounded"],[1,"flex","items-start","gap-3"],["name","alert-circle",1,"text-yellow-600","dark:text-yellow-400","flex-shrink-0","mt-0.5",3,"size"],[1,"text-sm","text-yellow-800","dark:text-yellow-200"],[1,"font-bold","mb-1"],[1,"block","text-sm","font-bold","text-gray-700","dark:text-gray-200","mb-2"],[1,"text-red-500"],["type","text","placeholder","Ej: CUSTOM_TYPE, NEW_CATEGORY","maxlength","50",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","uppercase","text-sm","font-mono",3,"ngModelChange","ngModel"],[1,"text-red-500","text-xs","mt-1"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1","flex","items-center","gap-1"],["name","info",3,"size"],["type","text","placeholder","Ej: M\xE9todo de Pago, Resultado de Llamada","maxlength","100",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","text-sm",3,"ngModelChange","ngModel"],[1,"text-xs","font-normal","text-gray-500","dark:text-gray-400","ml-1"],["rows","3","placeholder","Describe el prop\xF3sito de esta categor\xEDa y cu\xE1ndo debe ser usada...",1,"w-full","px-4","py-2.5","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-purple-500","focus:border-transparent","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100","placeholder:text-gray-400","dark:placeholder:text-gray-500","text-sm",3,"ngModelChange","ngModel"],[1,"bg-blue-50","dark:bg-blue-950/30","border","border-blue-200","dark:border-blue-900/50","rounded-lg","p-4"],[1,"bg-yellow-50","dark:bg-yellow-950/30","border","border-yellow-200","dark:border-yellow-900/50","rounded-lg","p-4"],[1,"sticky","bottom-0","bg-gray-50","dark:bg-slate-800","px-6","py-4","flex","justify-end","gap-3","rounded-b-lg","border-t","border-gray-200","dark:border-gray-700"],[1,"px-6","py-2.5","text-gray-700","dark:text-gray-200","bg-white","dark:bg-slate-700","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-50","dark:hover:bg-slate-600","font-semibold","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],[1,"px-6","py-2.5","bg-gradient-to-r","from-purple-600","to-purple-700","hover:from-purple-700","hover:to-purple-800","disabled:from-gray-400","disabled:to-gray-500","text-white","rounded-lg","font-semibold","transition-all","shadow-md","hover:shadow-lg","flex","items-center","gap-2","text-sm",3,"click","disabled"],[1,"flex","items-center","gap-2","text-blue-800","dark:text-blue-200","mb-3"],["name","settings",3,"size"],[1,"font-bold","text-sm"],[1,"grid","grid-cols-1","gap-2","text-xs"],[1,"bg-white","dark:bg-slate-800","p-3","rounded","border",3,"border-blue-200","dark:border-blue-900","border-gray-200","dark:border-gray-700","opacity-60"],[1,"bg-white","dark:bg-slate-800","p-3","rounded","border"],[1,"flex","items-start","justify-between","mb-1"],[1,"flex-1"],[1,"font-mono","font-bold","mb-1"],[1,"text-gray-600","dark:text-gray-400","font-medium"],[1,"px-2","py-1","rounded","text-xs","font-semibold"],[1,"mt-2","pt-2","border-t","border-gray-200","dark:border-gray-700"],[1,"text-gray-500","dark:text-gray-400","text-xs","mb-1"],[1,"flex","items-center","gap-2"],[1,"font-mono","text-xs","bg-gray-100","dark:bg-gray-700","px-2","py-1","rounded","text-gray-700","dark:text-gray-300"],[1,"text-gray-600","dark:text-gray-400"],[1,"text-gray-400","dark:text-gray-500","text-xs","italic"],[1,"flex","items-center","gap-2","text-yellow-800","dark:text-yellow-200"],[1,"text-sm"],[1,"w-4","h-4","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],["name","save",3,"size"]],template:function(i,n){i&1&&(a(0,"div",0),x("click",function(){return n.onCancel()}),a(1,"div",1),x("click",function(m){return m.stopPropagation()}),a(2,"div",2)(3,"div")(4,"h2",3),s(5,"Nueva Categor\xEDa de Clasificaci\xF3n"),r(),a(6,"p",4),s(7," Crea un nuevo tipo de clasificaci\xF3n personalizado "),r()(),a(8,"button",5),x("click",function(){return n.onCancel()}),_(9,"lucide-angular",6),r()(),a(10,"div",7)(11,"div",8)(12,"div",9),_(13,"lucide-angular",10),a(14,"div",11)(15,"p",12),s(16,"\u26A0\uFE0F Advertencia Importante"),r(),a(17,"p"),s(18,"Las categor\xEDas son tipos de clasificaci\xF3n a nivel de sistema. Una vez creadas, no se pueden eliminar f\xE1cilmente ya que pueden estar siendo usadas por m\xFAltiples tipificaciones."),r()()()(),a(19,"div")(20,"label",13),s(21," C\xF3digo de Categor\xEDa "),a(22,"span",14),s(23,"*"),r()(),a(24,"input",15),w("ngModelChange",function(m){return T(n.form.code,m)||(n.form.code=m),m}),r(),b(25,_t,2,1,"p",16),a(26,"p",17),_(27,"lucide-angular",18),s(28," Usa MAY\xDASCULAS y guiones bajos (snake_case). Ejemplo: PAYMENT_METHOD, CALL_RESULT "),r()(),a(29,"div")(30,"label",13),s(31," Nombre Descriptivo "),a(32,"span",14),s(33,"*"),r()(),a(34,"input",19),w("ngModelChange",function(m){return T(n.form.name,m)||(n.form.name=m),m}),r(),b(35,xt,2,1,"p",16),a(36,"p",17),_(37,"lucide-angular",18),s(38," Este ser\xE1 el nombre que ver\xE1n los usuarios en la interfaz "),r()(),a(39,"div")(40,"label",13),s(41," Descripci\xF3n "),a(42,"span",20),s(43,"(Opcional)"),r()(),a(44,"textarea",21),w("ngModelChange",function(m){return T(n.form.description,m)||(n.form.description=m),m}),r()(),b(45,Ct,8,1,"div",22)(46,vt,5,1,"div",23),r(),a(47,"div",24)(48,"button",25),x("click",function(){return n.onCancel()}),_(49,"lucide-angular",6),s(50," Cancelar "),r(),a(51,"button",26),x("click",function(){return n.onSave()}),b(52,Tt,2,0)(53,wt,2,1),r()()()()),i&2&&(l(9),g("size",24),l(4),g("size",20),l(11),P("border-red-500",n.errors().code),v("ngModel",n.form.code),l(),y(n.errors().code?25:-1),l(2),g("size",12),l(7),P("border-red-500",n.errors().name),v("ngModel",n.form.name),l(),y(n.errors().name?35:-1),l(2),g("size",12),l(7),v("ngModel",n.form.description),l(),y(n.typeExamples().length>0?45:46),l(4),g("size",18),l(2),g("disabled",n.saving()),l(),y(n.saving()?52:53))},dependencies:[N,j,q,W,_e,U,L,$],encapsulation:2});let o=d;return o})();var We=(o,d)=>d.id,kt=(o,d)=>d.codigoOpcion;function St(o,d){o&1&&(a(0,"div",19),_(1,"lucide-angular",22),s(2," Cargando subcarteras... "),r()),o&2&&(l(),g("size",16))}function Et(o,d){if(o&1&&(a(0,"option",24),s(1),r()),o&2){let e=d.$implicit;g("ngValue",e.id),l(),D(e.nombre||e.nombreSubcartera)}}function Ft(o,d){if(o&1){let e=k();a(0,"select",23),w("ngModelChange",function(i){u(e);let n=c(3);return T(n.selectedSubPortfolioId,i)||(n.selectedSubPortfolioId=i),f(i)}),x("ngModelChange",function(i){u(e);let n=c(3);return f(n.onSubPortfolioChange(i))}),a(1,"option",24),s(2,"-- Seleccione una subcartera --"),r(),E(3,Et,2,2,"option",24,We),r()}if(o&2){let e=c(3);v("ngModel",e.selectedSubPortfolioId),l(),g("ngValue",void 0),l(2),F(e.subPortfolios())}}function Mt(o,d){o&1&&(a(0,"p",21),s(1," No hay subcarteras disponibles para este portfolio "),r())}function Dt(o,d){if(o&1&&(a(0,"div",11)(1,"label",17),_(2,"lucide-angular",18),s(3," Seleccionar Subcartera "),r(),b(4,St,3,1,"div",19)(5,Ft,5,2,"select",20)(6,Mt,2,0,"p",21),r()),o&2){let e=c(2);l(2),g("size",16),l(2),y(e.loadingSubPortfolios()?4:e.subPortfolios().length>0?5:6)}}function Pt(o,d){o&1&&(a(0,"div",19),_(1,"lucide-angular",22),s(2," Cargando campos... "),r()),o&2&&(l(),g("size",16))}function Vt(o,d){if(o&1&&(a(0,"option",24),s(1),r()),o&2){let e=d.$implicit;g("ngValue",e.id),l(),pe("",e.labelCampo||e.nombreCampo," (ID: ",e.id,")")}}function zt(o,d){if(o&1){let e=k();a(0,"select",23),w("ngModelChange",function(i){u(e);let n=c(3);return T(n.selectedCampoId,i)||(n.selectedCampoId=i),f(i)}),x("ngModelChange",function(i){u(e);let n=c(3);return f(n.onCampoChange(i))}),a(1,"option",24),s(2,"-- Seleccione un campo tipo CHIP_SELECT --"),r(),E(3,Vt,2,3,"option",24,We),r()}if(o&2){let e=c(3);v("ngModel",e.selectedCampoId),l(),g("ngValue",void 0),l(2),F(e.additionalFields())}}function It(o,d){o&1&&(a(0,"div",26),_(1,"lucide-angular",27),a(2,"p",28),s(3,"Esta tipificaci\xF3n no tiene campos adicionales de tipo CHIP_SELECT"),r()()),o&2&&(l(),g("size",24))}function At(o,d){if(o&1&&(a(0,"div",11)(1,"label",17),_(2,"lucide-angular",25),s(3," Seleccionar Campo a Configurar "),r(),b(4,Pt,3,1,"div",19)(5,zt,5,2,"select",20)(6,It,4,1,"div",26),r()),o&2){let e=c(2);l(2),g("size",16),l(2),y(e.loadingFields()?4:e.additionalFields().length>0?5:6)}}function Nt(o,d){if(o&1){let e=k();a(0,"button",36),x("click",function(){u(e);let i=c(3);return f(i.inicializarOpciones())}),_(1,"lucide-angular",37),s(2," Cargar Opciones "),r()}o&2&&(l(),g("size",16))}function Ot(o,d){o&1&&(a(0,"div",33),_(1,"lucide-angular",38),r()),o&2&&(l(),g("size",48))}function $t(o,d){o&1&&(a(0,"div",34),_(1,"lucide-angular",39),a(2,"p"),s(3,'Haga clic en "Cargar Opciones" para ver los campos disponibles'),r()()),o&2&&(l(),g("size",48))}function Lt(o,d){o&1&&(a(0,"span",51),s(1," Input Manual "),r())}function Wt(o,d){if(o&1&&(a(0,"span",52),s(1),r()),o&2){let e=c().$implicit;l(),S(" ",e.campoTablaDinamica," ")}}function Ut(o,d){o&1&&(_(0,"lucide-angular",54),a(1,"span",55),s(2,"Habilitada"),r()),o&2&&g("size",16)}function jt(o,d){o&1&&(_(0,"lucide-angular",56),a(1,"span",57),s(2,"Deshabilitada"),r()),o&2&&g("size",16)}function Bt(o,d){if(o&1){let e=k();a(0,"div",41)(1,"div",45)(2,"label",46)(3,"input",47),w("ngModelChange",function(i){let n=u(e).$implicit;return T(n.estaHabilitada,i)||(n.estaHabilitada=i),f(i)}),r(),_(4,"div",48),r(),a(5,"div",49)(6,"span",50),s(7),r(),b(8,Lt,2,0,"span",51)(9,Wt,2,1,"span",52),r(),a(10,"div",53),b(11,Ut,3,1)(12,jt,3,1),r()()()}if(o&2){let e=d.$implicit;l(3),v("ngModel",e.estaHabilitada),l(4),S(" ",e.labelOpcion," "),l(),y(e.codigoOpcion==="personalizado"?8:9),l(3),y(e.estaHabilitada?11:12)}}function Rt(o,d){if(o&1&&(a(0,"div",40),E(1,Bt,13,4,"div",41,kt),r(),a(3,"div",42)(4,"p",43),_(5,"lucide-angular",44),a(6,"strong"),s(7),r(),s(8," de "),a(9,"strong"),s(10),r(),s(11," opciones habilitadas "),r()()),o&2){let e=c(3);l(),F(e.opciones()),l(4),g("size",16),l(2),D(e.getOpcionesHabilitadasCount()),l(3),D(e.opciones().length)}}function Ht(o,d){o&1&&(a(0,"div",35),_(1,"lucide-angular",58),a(2,"p"),s(3,"No se encontraron campos num\xE9ricos en esta subcartera"),r()()),o&2&&(l(),g("size",48))}function qt(o,d){if(o&1&&(a(0,"div",12)(1,"div",29)(2,"h3",30),_(3,"lucide-angular",31),s(4),r(),b(5,Nt,3,1,"button",32),r(),b(6,Ot,2,1,"div",33)(7,$t,4,1,"div",34)(8,Rt,12,3)(9,Ht,4,1,"div",35),r()),o&2){let e=c(2);l(3),g("size",20),l(),S(" Opciones para: ",e.getSelectedCampoName()," "),l(),y(!e.opcionesInicializadas()&&!e.loadingOpciones()?5:-1),l(),y(e.loadingOpciones()?6:e.opciones().length===0&&!e.opcionesInicializadas()?7:e.opciones().length>0?8:9)}}function Gt(o,d){if(o&1){let e=k();a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),_(4,"lucide-angular",4),s(5),r(),a(6,"button",5),x("click",function(){u(e);let i=c();return f(i.handleCancel())}),_(7,"lucide-angular",6),r()(),a(8,"div",7)(9,"div",8)(10,"p",9),_(11,"lucide-angular",10),a(12,"strong"),s(13,"Instrucciones:"),r(),s(14," Seleccione una subcartera para ver los campos de monto disponibles. Active los toggles de las opciones que desea que el agente pueda seleccionar. "),r()(),b(15,Dt,7,2,"div",11),b(16,At,7,2,"div",11),b(17,qt,10,4,"div",12),r(),a(18,"div",13)(19,"button",14),x("click",function(){u(e);let i=c();return f(i.handleCancel())}),s(20," Cancelar "),r(),a(21,"button",15),x("click",function(){u(e);let i=c();return f(i.handleSave())}),_(22,"lucide-angular",16),s(23," Guardar Configuraci\xF3n "),r()()()()}if(o&2){let e=c();l(4),g("size",24),l(),S(" Configurar Campos Adicionales - ",e.typificationName()," "),l(2),g("size",24),l(4),g("size",16),l(4),y(e.portfolioId()?15:-1),l(),y(e.selectedSubPortfolioId()?16:-1),l(),y(e.selectedSubPortfolioId()&&e.selectedCampoId()?17:-1),l(4),g("disabled",!e.selectedSubPortfolioId()||!e.selectedCampoId()||e.opciones().length===0||e.loadingOpciones()),l(),g("size",20)}}var Ue=(()=>{let d=class d{constructor(){this.isOpen=A.required(),this.typificationName=A(""),this.typificationId=A.required(),this.tenantId=A.required(),this.portfolioId=A(void 0),this.subPortfolioId=A(void 0),this.close=ee(),this.save=ee(),this.opciones=C([]),this.loadingOpciones=C(!1),this.opcionesInicializadas=C(!1),this.subPortfolios=C([]),this.loadingSubPortfolios=C(!1),this.selectedSubPortfolioId=C(void 0),this.additionalFields=C([]),this.loadingFields=C(!1),this.selectedCampoId=C(void 0),this.typificationService=de(ne),me(()=>{this.isOpen()&&(console.log("Dialog opened with:",{typificationId:this.typificationId(),tenantId:this.tenantId(),portfolioId:this.portfolioId(),subPortfolioId:this.subPortfolioId()}),this.loadSubPortfolios(),this.loadAdditionalFields())})}loadAdditionalFields(){let t=this.typificationId();t&&(this.loadingFields.set(!0),this.typificationService.getAdditionalFields(t).subscribe({next:i=>{let n=i.filter(p=>p.tipoCampo===Te.CHIP_SELECT);this.additionalFields.set(n),this.loadingFields.set(!1),console.log("CHIP_SELECT fields loaded:",n.length),n.length===1&&this.selectedCampoId.set(n[0].id)},error:i=>{console.error("Error loading additional fields:",i),this.additionalFields.set([]),this.loadingFields.set(!1)}}))}loadSubPortfolios(){let t=this.portfolioId();if(!t){console.warn("No portfolio selected, cannot load subportfolios");return}this.loadingSubPortfolios.set(!0),this.typificationService.getSubPortfoliosByPortfolio(t).subscribe({next:i=>{this.subPortfolios.set(i),this.loadingSubPortfolios.set(!1),this.subPortfolioId()&&this.selectedSubPortfolioId.set(this.subPortfolioId())},error:i=>{console.error("Error loading subportfolios:",i),this.subPortfolios.set([]),this.loadingSubPortfolios.set(!1)}})}onSubPortfolioChange(t){this.selectedSubPortfolioId.set(t),this.opciones.set([]),this.opcionesInicializadas.set(!1)}onCampoChange(t){this.selectedCampoId.set(t),this.opciones.set([]),this.opcionesInicializadas.set(!1)}inicializarOpciones(){let t=this.tenantId(),i=this.portfolioId(),n=this.selectedSubPortfolioId(),p=this.selectedCampoId();if(!t||!i||!n||!p){console.warn("Faltan par\xE1metros para inicializar opciones",{tenantId:t,portfolioId:i,subPortfolioId:n,campoId:p});return}this.loadingOpciones.set(!0),this.typificationService.getOpcionesCampo(p).subscribe({next:m=>{m&&m.length>0?(this.opciones.set(m),this.opcionesInicializadas.set(!0),this.loadingOpciones.set(!1),console.log("Opciones cargadas para campo",p,":",m.length)):this.inicializarNuevasOpciones(p,t,i,n)},error:m=>{console.error("Error cargando opciones para campo",p,", intentando inicializar:",m),this.inicializarNuevasOpciones(p,t,i,n)}})}inicializarNuevasOpciones(t,i,n,p){this.typificationService.inicializarOpcionesCampo(t,i,n,p).subscribe({next:m=>{this.opciones.set(m),this.opcionesInicializadas.set(!0),this.loadingOpciones.set(!1),console.log("Opciones inicializadas:",m.length)},error:m=>{console.error("Error inicializando opciones:",m),this.opciones.set([]),this.opcionesInicializadas.set(!1),this.loadingOpciones.set(!1)}})}getOpcionesHabilitadasCount(){return this.opciones().filter(t=>t.estaHabilitada).length}handleCancel(){this.close.emit()}handleSave(){let t=this.selectedCampoId(),i=this.opciones();if(!t||i.length===0){console.warn("No hay opciones para guardar");return}let n={idCampo:t,opciones:i.map(p=>({codigoOpcion:p.codigoOpcion,estaHabilitada:p.estaHabilitada,ordenVisualizacion:p.ordenVisualizacion}))};this.typificationService.configurarOpciones(n).subscribe({next:p=>{console.log("Opciones guardadas exitosamente para campo",t,":",p.length),this.opciones.set(p),this.save.emit()},error:p=>{console.error("Error guardando opciones:",p)}})}getSelectedCampoName(){let t=this.selectedCampoId();if(!t)return"";let i=this.additionalFields().find(n=>n.id===t);return i?.labelCampo||i?.nombreCampo||""}};d.\u0275fac=function(i){return new(i||d)},d.\u0275cmp=I({type:d,selectors:[["app-typification-additional-fields-dialog"]],inputs:{isOpen:[1,"isOpen"],typificationName:[1,"typificationName"],typificationId:[1,"typificationId"],tenantId:[1,"tenantId"],portfolioId:[1,"portfolioId"],subPortfolioId:[1,"subPortfolioId"]},outputs:{close:"close",save:"save"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-xl","max-w-4xl","w-full","max-h-[90vh]","flex","flex-col"],[1,"flex","items-center","justify-between","p-6","border-b","border-gray-200","dark:border-gray-700"],[1,"text-xl","font-bold","text-gray-900","dark:text-white","flex","items-center","gap-2"],["name","settings",1,"text-blue-600",3,"size"],["type","button",1,"text-gray-400","hover:text-gray-600","dark:hover:text-gray-300",3,"click"],["name","x",3,"size"],[1,"flex-1","overflow-y-auto","p-6","space-y-4"],[1,"p-4","bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg"],[1,"text-sm","text-blue-700","dark:text-blue-400","flex","items-center","gap-2"],["name","info",3,"size"],[1,"p-4","bg-gray-50","dark:bg-gray-700","border","border-gray-200","dark:border-gray-600","rounded-lg"],[1,"space-y-3"],[1,"flex","justify-end","gap-3","p-6","border-t","border-gray-200","dark:border-gray-700"],["type","button",1,"px-4","py-2","border","border-gray-300","dark:border-gray-600","text-gray-700","dark:text-gray-300","rounded-lg","hover:bg-gray-50","dark:hover:bg-gray-700",3,"click"],["type","button",1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["name","save",3,"size"],[1,"block","text-sm","font-bold","text-gray-700","dark:text-gray-300","mb-2","flex","items-center","gap-2"],["name","database",1,"text-blue-600",3,"size"],[1,"flex","items-center","gap-2","py-2","text-sm","text-gray-600","dark:text-gray-400"],[1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white","text-sm",3,"ngModel"],[1,"text-sm","text-gray-600","dark:text-gray-400"],["name","loader",1,"animate-spin",3,"size"],[1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","bg-white","dark:bg-gray-800","text-gray-900","dark:text-white","text-sm",3,"ngModelChange","ngModel"],[3,"ngValue"],["name","list",1,"text-purple-600",3,"size"],[1,"text-center","py-4","text-yellow-600","dark:text-yellow-400"],["name","alert-triangle",1,"mx-auto","mb-2",3,"size"],[1,"text-sm"],[1,"flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white","flex","items-center","gap-2"],["name","list-checks",1,"text-green-600",3,"size"],["type","button",1,"flex","items-center","gap-2","px-3","py-1.5","bg-green-600","text-white","rounded-lg","hover:bg-green-700","text-sm"],[1,"flex","items-center","justify-center","py-12"],[1,"text-center","py-12","text-gray-500","dark:text-gray-400"],[1,"text-center","py-12","text-yellow-600","dark:text-yellow-400"],["type","button",1,"flex","items-center","gap-2","px-3","py-1.5","bg-green-600","text-white","rounded-lg","hover:bg-green-700","text-sm",3,"click"],["name","refresh-cw",3,"size"],["name","loader",1,"animate-spin","text-blue-600",3,"size"],["name","inbox",1,"mx-auto","mb-4","opacity-50",3,"size"],[1,"space-y-2"],[1,"flex","items-center","justify-between","p-3","bg-gray-50","dark:bg-gray-700","rounded-lg","border","border-gray-200","dark:border-gray-600"],[1,"mt-4","p-3","bg-green-50","dark:bg-green-900/20","border","border-green-200","dark:border-green-800","rounded-lg"],[1,"text-sm","text-green-700","dark:text-green-400","flex","items-center","gap-2"],["name","check",3,"size"],[1,"flex","items-center","gap-3","flex-1"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"ngModelChange","ngModel"],[1,"w-11","h-6","bg-gray-300","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-blue-300","dark:peer-focus:ring-blue-800","rounded-full","peer","dark:bg-gray-600","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","dark:border-gray-600","peer-checked:bg-blue-600"],[1,"flex","items-center","gap-2","flex-1"],[1,"text-sm","font-medium","text-gray-900","dark:text-white"],[1,"px-2","py-0.5","bg-purple-100","dark:bg-purple-900/30","text-purple-800","dark:text-purple-300","text-xs","font-semibold","rounded-full"],[1,"px-2","py-0.5","bg-green-100","dark:bg-green-900/30","text-green-800","dark:text-green-300","text-xs","font-medium","rounded-full"],[1,"flex","items-center","gap-1"],["name","check-circle",1,"text-green-600",3,"size"],[1,"text-xs","text-green-600","dark:text-green-400","font-medium"],["name","x-circle",1,"text-gray-400",3,"size"],[1,"text-xs","text-gray-500","dark:text-gray-400"],["name","alert-triangle",1,"mx-auto","mb-4",3,"size"]],template:function(i,n){i&1&&b(0,Gt,24,9,"div",0),i&2&&y(n.isOpen()?0:-1)},dependencies:[N,j,Y,X,te,G,W,U,L,$],encapsulation:2});let o=d;return o})();var Yt=(o,d,e)=>({node:o,depth:0,index:d,siblings:e,parent:null}),Xt=o=>({node:o}),Jt=(o,d,e,t,i)=>({node:o,depth:d,index:e,siblings:t,parent:i}),we=(o,d)=>d.typification.id,je=(o,d)=>d.hex;function Zt(o,d){o&1&&(a(0,"div",3)(1,"div",33)(2,"div")(3,"div",34),s(4,"\xA1Cambio Guardado!"),r(),a(5,"div",35),s(6,"La configuraci\xF3n se actualiz\xF3 correctamente"),r()()()())}function Qt(o,d){o&1&&(a(0,"span",14),s(1,"OSCURO"),r())}function Kt(o,d){o&1&&(a(0,"span",15),s(1,"CLARO"),r())}function ei(o,d){if(o&1&&(a(0,"option",21),s(1),r()),o&2){let e=d.$implicit;g("ngValue",e.id),l(),S(" ",e.tenantName," ")}}function ti(o,d){if(o&1){let e=k();a(0,"div")(1,"div",19),s(2,"Cliente"),r(),a(3,"select",20),w("ngModelChange",function(i){u(e);let n=c();return T(n.selectedTenantId,i)||(n.selectedTenantId=i),f(i)}),x("change",function(){u(e);let i=c();return f(i.onTenantChange())}),oe(4,ei,2,2,"option",22),r()(),_(5,"div",36)}if(o&2){let e=c();l(3),v("ngModel",e.selectedTenantId),l(),g("ngForOf",e.tenants)}}function ii(o,d){if(o&1&&(a(0,"option",21),s(1),r()),o&2){let e=d.$implicit;g("ngValue",e.id),l(),S(" ",e.portfolioName," ")}}function ni(o,d){if(o&1){let e=k();a(0,"div")(1,"div",19),s(2,"Cartera"),r(),a(3,"select",37),w("ngModelChange",function(i){u(e);let n=c();return T(n.selectedPortfolioId,i)||(n.selectedPortfolioId=i),f(i)}),x("change",function(){u(e);let i=c();return f(i.onPortfolioChange())}),a(4,"option",21),s(5,"Todas las Carteras"),r(),oe(6,ii,2,2,"option",22),r()(),_(7,"div",36)}if(o&2){let e=c();l(3),v("ngModel",e.selectedPortfolioId),l(),g("ngValue",void 0),l(2),g("ngForOf",e.portfolios)}}function oi(o,d){if(o&1&&(a(0,"option",21),s(1),r()),o&2){let e=d.$implicit,t=c();g("ngValue",e),l(),S(" ",t.getTypeLabel(e)," ")}}function ai(o,d){if(o&1){let e=k();a(0,"app-typification-form-dialog",38),x("save",function(i){u(e);let n=c();return f(n.onClassificationSaved(i))})("cancel",function(){u(e);let i=c();return f(i.closeClassificationDialog())}),r()}if(o&2){let e=c();g("mode",e.classificationDialogMode())("typification",e.selectedClassificationForEdit())("parentClassification",e.parentClassificationForCreate())("defaultType",e.selectedType)("tenantId",e.selectedTenantId)("portfolioId",e.selectedPortfolioId)}}function ri(o,d){if(o&1){let e=k();a(0,"app-category-form-dialog",39),x("save",function(i){u(e);let n=c();return f(n.onCategorySaved(i))})("cancel",function(){u(e);let i=c();return f(i.closeCategoryDialog())}),r()}if(o&2){let e=c();g("typifications",e.typifications)}}function li(o,d){if(o&1){let e=k();a(0,"app-typification-additional-fields-dialog",40),x("save",function(){u(e);let i=c();return f(i.onAdditionalFieldsSaved())})("close",function(){u(e);let i=c();return f(i.closeAdditionalFieldsDialog())}),r()}if(o&2){let e,t,i=c();g("isOpen",i.showAdditionalFieldsDialog())("typificationName",((e=i.selectedTypificationForFields())==null?null:e.nombre)||"")("typificationId",(t=i.selectedTypificationForFields())==null?null:t.id)("tenantId",i.selectedTenantId)("portfolioId",i.selectedPortfolioId)("subPortfolioId",void 0)}}function di(o,d){o&1&&(a(0,"div",31)(1,"div",41),_(2,"div",42),a(3,"p",43),s(4,"Cargando tipificaciones..."),r()()())}function si(o,d){o&1&&(a(0,"div",45)(1,"p",46),s(2,"No hay tipificaciones configuradas"),r(),a(3,"p",47),s(4,"Comienza creando tu primera tipificaci\xF3n"),r()())}function ci(o,d){if(o&1&&se(0,49),o&2){let e=d.$implicit,t=d.$index,i=c(4),n=ce(49);g("ngTemplateOutlet",n)("ngTemplateOutletContext",Fe(2,Yt,e,t,i.treeNodes))}}function pi(o,d){if(o&1&&(a(0,"div",48),E(1,ci,1,6,"ng-container",49,we),r()),o&2){let e=c(3);l(),F(e.treeNodes)}}function mi(o,d){if(o&1&&se(0,49),o&2){let e=d.$implicit;c(4);let t=ce(51);g("ngTemplateOutlet",t)("ngTemplateOutletContext",ae(2,Xt,e))}}function gi(o,d){if(o&1&&(a(0,"div",48),E(1,mi,1,4,"ng-container",49,we),r()),o&2){let e=c(3);l(),F(e.getFilteredNodes(e.treeNodes))}}function ui(o,d){if(o&1&&b(0,pi,3,0,"div",48)(1,gi,3,0,"div",48),o&2){let e=c(2);y(e.selectedType?1:0)}}function fi(o,d){if(o&1&&(a(0,"div",32)(1,"div",44),b(2,si,5,0,"div",45)(3,ui,2,1),r()()),o&2){let e=c();l(2),y(e.treeNodes.length===0?2:3)}}function _i(o,d){}function xi(o,d){}function bi(o,d){if(o&1){let e=k();a(0,"button",65),x("click",function(i){u(e);let n=c(2).node;return c().toggleNode(n.typification.id),f(i.stopPropagation())}),b(1,_i,0,0)(2,xi,0,0),r()}if(o&2){let e=c(2).node,t=c();l(),y(t.isExpanded(e.typification.id)?1:2)}}function yi(o,d){o&1&&_(0,"div",57)}function hi(o,d){if(o&1&&_(0,"lucide-angular",59),o&2){let e=c(2).node,t=c();g("name",t.getEffectiveValue(e.config,e.typification,"icono"))("size",t.matchesTypeFilter(e.typification)?18:14)}}function Ci(o,d){if(o&1&&s(0),o&2){let e=c(2).node;S(" ",(e.typification.codigo==null?null:e.typification.codigo.substring(0,2))||"NA"," ")}}function vi(o,d){o&1&&(a(0,"span",66),s(1,"PERSONALIZADO"),r())}function Ti(o,d){if(o&1&&(a(0,"div",62),s(1),b(2,vi,2,0,"span",66),r()),o&2){let e=c(2).node,t=c();l(),S(" ",t.getTypeLabel(e.typification.tipoClasificacion)," "),l(),y(t.hasCustomizations(e.config)?2:-1)}}function wi(o,d){if(o&1){let e=k();a(0,"button",80),x("click",function(i){u(e);let n=c(3).node,p=c();return f(p.resetCustomization(n,i))}),_(1,"lucide-angular",81),r()}o&2&&(l(),g("size",14))}function ki(o,d){if(o&1){let e=k();a(0,"div",64)(1,"label",67),x("click",function(i){return u(e),f(i.stopPropagation())}),a(2,"input",68),x("change",function(i){u(e);let n=c(2).node;return c().toggleTypification(n,i),f(i.stopPropagation())}),r(),_(3,"div",69),r(),a(4,"button",70),x("click",function(i){u(e);let n=c(2).node,p=c();return f(p.startEdit(n,i))}),s(5," EDITAR "),r(),b(6,wi,2,1,"button",71),a(7,"button",72),x("click",function(i){u(e);let n=c(2).node;return c().openCreateChildDialog(n.typification),f(i.stopPropagation())}),_(8,"lucide-angular",73),r(),a(9,"button",74),x("click",function(i){u(e);let n=c(2).node;return c().openAdditionalFieldsDialog(n.typification),f(i.stopPropagation())}),_(10,"lucide-angular",75),r(),a(11,"button",76),x("click",function(i){u(e);let n=c(2).node;return c().openEditDialog(n.typification),f(i.stopPropagation())}),_(12,"lucide-angular",77),r(),a(13,"button",78),x("click",function(i){u(e);let n=c(2).node;return c().deleteTypification(n.typification),f(i.stopPropagation())}),_(14,"lucide-angular",79),r()()}if(o&2){let e=c(2).node,t=c();l(),g("title",e.config!=null&&e.config.estaHabilitada?"Desactivar":"Activar"),l(),g("checked",(e.config==null?null:e.config.estaHabilitada)===!0),l(4),y(t.hasCustomizations(e.config)?6:-1),l(2),g("size",14),l(2),g("size",14),l(2),g("size",14),l(),P("opacity-30",e.typification.esSistema)("cursor-not-allowed",e.typification.esSistema),g("disabled",e.typification.esSistema),l(),g("size",14)}}function Si(o,d){if(o&1&&(a(0,"div",54)(1,"div",55),b(2,bi,3,1,"button",56)(3,yi,1,0,"div",57),a(4,"div",58),b(5,hi,1,2,"lucide-angular",59)(6,Ci,1,1),r(),a(7,"div",60)(8,"div",61),s(9),r(),b(10,Ti,3,2,"div",62),r(),a(11,"div",63),s(12),r()(),b(13,ki,15,12,"div",64),r()),o&2){let e=c().node,t=c();P("py-1",t.matchesTypeFilter(e.typification))("py-0",!t.matchesTypeFilter(e.typification))("opacity-40",!t.matchesTypeFilter(e.typification))("scale-95",!t.matchesTypeFilter(e.typification))("bg-green-50",(e.config==null?null:e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("dark:bg-green-950/40",(e.config==null?null:e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("hover:bg-green-100",(e.config==null?null:e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("dark:hover:bg-green-900/50",(e.config==null?null:e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("bg-slate-100",!(e.config!=null&&e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("dark:bg-slate-800/50",!(e.config!=null&&e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("hover:bg-slate-200",!(e.config!=null&&e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("dark:hover:bg-slate-700/50",!(e.config!=null&&e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("bg-gray-50",!t.matchesTypeFilter(e.typification))("dark:bg-gray-900/20",!t.matchesTypeFilter(e.typification))("border-l-green-500",(e.config==null?null:e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("dark:border-l-green-600",(e.config==null?null:e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("border-l-slate-400",!(e.config!=null&&e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("dark:border-l-slate-600",!(e.config!=null&&e.config.estaHabilitada)&&t.matchesTypeFilter(e.typification))("border-l-gray-300",!t.matchesTypeFilter(e.typification))("dark:border-l-gray-700",!t.matchesTypeFilter(e.typification))("ring-2",t.hasCustomizations(e.config)&&t.matchesTypeFilter(e.typification))("ring-purple-400",t.hasCustomizations(e.config)&&t.matchesTypeFilter(e.typification))("dark:ring-purple-600",t.hasCustomizations(e.config)&&t.matchesTypeFilter(e.typification)),l(2),y(e.children&&e.children.length>0?2:3),l(2),R("background-color",t.getEffectiveValue(e.config,e.typification,"color")||"#6B7280"),P("w-8",t.matchesTypeFilter(e.typification))("h-8",t.matchesTypeFilter(e.typification))("text-xs",t.matchesTypeFilter(e.typification))("w-6",!t.matchesTypeFilter(e.typification))("h-6",!t.matchesTypeFilter(e.typification))("text-[9px]",!t.matchesTypeFilter(e.typification)),l(),y(t.getEffectiveValue(e.config,e.typification,"icono")?5:6),l(3),P("text-sm",t.matchesTypeFilter(e.typification))("text-slate-800",t.matchesTypeFilter(e.typification))("dark:text-slate-100",t.matchesTypeFilter(e.typification))("text-xs",!t.matchesTypeFilter(e.typification))("text-gray-500",!t.matchesTypeFilter(e.typification))("dark:text-gray-500",!t.matchesTypeFilter(e.typification)),l(),S(" ",t.getEffectiveValue(e.config,e.typification,"nombre")," "),l(),y(t.matchesTypeFilter(e.typification)?10:-1),l(),P("text-[10px]",t.matchesTypeFilter(e.typification))("text-[8px]",!t.matchesTypeFilter(e.typification)),l(),S(" N",e.level," "),l(),y(t.matchesTypeFilter(e.typification)?13:-1)}}function Ei(o,d){if(o&1){let e=k();a(0,"button",95),x("click",function(){let i=u(e).$implicit,n=c(3);return f(n.editingForm().colorPersonalizado=i.hex)}),r()}if(o&2){let e=d.$implicit,t=c(3);Z("w-6 h-6 rounded border-2 transition-all "+(t.editingForm().colorPersonalizado===e.hex?"border-gray-900 dark:border-white ring-2 ring-purple-500":"border-gray-300")),R("background-color",e.hex),g("title",e.name)}}function Fi(o,d){o&1&&_(0,"div",93)}function Mi(o,d){if(o&1){let e=k();a(0,"div",52)(1,"div",82)(2,"div",83)(3,"label",84),s(4,"Color"),r(),a(5,"div",85),E(6,Ei,1,5,"button",86,je),r()(),a(8,"div",87)(9,"div")(10,"label",84),s(11,"Nombre Personalizado"),r(),a(12,"input",88),w("ngModelChange",function(i){u(e);let n=c(2);return T(n.editingForm().nombrePersonalizado,i)||(n.editingForm().nombrePersonalizado=i),f(i)}),r()(),a(13,"div")(14,"label",84),s(15,"Descripci\xF3n (Opcional)"),r(),a(16,"textarea",89),w("ngModelChange",function(i){u(e);let n=c(2);return T(n.editingForm().descripcionPersonalizada,i)||(n.editingForm().descripcionPersonalizada=i),f(i)}),s(17,"              "),r()(),a(18,"div")(19,"label",84),s(20,"Orden"),r(),a(21,"input",90),w("ngModelChange",function(i){u(e);let n=c(2);return T(n.editingForm().ordenVisualizacionPersonalizado,i)||(n.editingForm().ordenVisualizacionPersonalizado=i),f(i)}),r()()(),a(22,"div",91)(23,"button",92),x("click",function(){u(e);let i=c().node,n=c();return f(n.saveEdit(i))}),b(24,Fi,1,0,"div",93),s(25," GUARDAR "),r(),a(26,"button",94),x("click",function(){u(e);let i=c(2);return f(i.cancelEdit())}),s(27," CANCELAR "),r()()()()}if(o&2){let e=c(2);l(6),F(e.presetColors),l(6),v("ngModel",e.editingForm().nombrePersonalizado),l(4),v("ngModel",e.editingForm().descripcionPersonalizada),l(5),v("ngModel",e.editingForm().ordenVisualizacionPersonalizado),l(2),g("disabled",e.savingEdit()),l(),y(e.savingEdit()?24:-1),l(2),g("disabled",e.savingEdit())}}function Di(o,d){if(o&1&&se(0,49),o&2){let e=d.$implicit,t=d.$index,i=c(2),n=i.node,p=i.depth;c();let m=ce(49);g("ngTemplateOutlet",m)("ngTemplateOutletContext",Me(2,Jt,e,p+1,t,n.children,n))}}function Pi(o,d){if(o&1&&(a(0,"div",53),E(1,Di,1,8,"ng-container",49,we),r()),o&2){let e=c().node;l(),F(e.children)}}function Vi(o,d){if(o&1&&(a(0,"div",50),b(1,Si,14,82,"div",51),b(2,Mi,28,6,"div",52),b(3,Pi,3,0,"div",53),r()),o&2){let e=d.node,t=d.depth,i=c();R("margin-left",t*16,"px"),l(),y(i.isEditing(e.config==null?null:e.config.id)?-1:1),l(),y(i.isEditing(e.config==null?null:e.config.id)&&i.editingForm()?2:-1),l(),y(i.isExpanded(e.typification.id)&&e.children&&e.children.length>0?3:-1)}}function zi(o,d){if(o&1&&_(0,"lucide-angular",59),o&2){let e=c(2).node,t=c();g("name",t.getEffectiveValue(e.config,e.typification,"icono"))("size",20)}}function Ii(o,d){if(o&1&&s(0),o&2){let e=c(2).node;S(" ",(e.typification.codigo==null?null:e.typification.codigo.substring(0,2))||"NA"," ")}}function Ai(o,d){if(o&1&&(a(0,"div",100),s(1),r()),o&2){let e=c(2).node,t=c();l(),S(" ",t.getParentBreadcrumb(e)," ")}}function Ni(o,d){o&1&&(a(0,"span",102),s(1,"PERSONALIZADO"),r())}function Oi(o,d){if(o&1){let e=k();a(0,"button",80),x("click",function(i){u(e);let n=c(2).node,p=c();return f(p.resetCustomization(n,i))}),_(1,"lucide-angular",81),r()}o&2&&(l(),g("size",14))}function $i(o,d){if(o&1){let e=k();a(0,"div",97)(1,"div",98)(2,"div",99),b(3,zi,1,2,"lucide-angular",59)(4,Ii,1,1),r(),a(5,"div",60),b(6,Ai,2,1,"div",100),a(7,"div",101),s(8),r(),b(9,Ni,2,0,"span",102),r(),a(10,"div",103),s(11),r()(),a(12,"div",104)(13,"label",67),x("click",function(i){return u(e),f(i.stopPropagation())}),a(14,"input",68),x("change",function(i){u(e);let n=c().node;return c().toggleTypification(n,i),f(i.stopPropagation())}),r(),_(15,"div",69),r(),a(16,"button",70),x("click",function(i){u(e);let n=c().node,p=c();return f(p.startEdit(n,i))}),s(17," EDITAR "),r(),b(18,Oi,2,1,"button",71),a(19,"button",72),x("click",function(i){u(e);let n=c().node;return c().openCreateChildDialog(n.typification),f(i.stopPropagation())}),_(20,"lucide-angular",73),r(),a(21,"button",74),x("click",function(i){u(e);let n=c().node;return c().openAdditionalFieldsDialog(n.typification),f(i.stopPropagation())}),_(22,"lucide-angular",75),r(),a(23,"button",76),x("click",function(i){u(e);let n=c().node;return c().openEditDialog(n.typification),f(i.stopPropagation())}),_(24,"lucide-angular",77),r(),a(25,"button",78),x("click",function(i){u(e);let n=c().node;return c().deleteTypification(n.typification),f(i.stopPropagation())}),_(26,"lucide-angular",79),r()()()}if(o&2){let e=c().node,t=c();P("bg-green-50",e.config==null?null:e.config.estaHabilitada)("dark:bg-green-950/40",e.config==null?null:e.config.estaHabilitada)("hover:bg-green-100",e.config==null?null:e.config.estaHabilitada)("dark:hover:bg-green-900/50",e.config==null?null:e.config.estaHabilitada)("bg-slate-100",!(e.config!=null&&e.config.estaHabilitada))("dark:bg-slate-800/50",!(e.config!=null&&e.config.estaHabilitada))("hover:bg-slate-200",!(e.config!=null&&e.config.estaHabilitada))("dark:hover:bg-slate-700/50",!(e.config!=null&&e.config.estaHabilitada))("border-l-green-500",e.config==null?null:e.config.estaHabilitada)("dark:border-l-green-600",e.config==null?null:e.config.estaHabilitada)("border-l-slate-400",!(e.config!=null&&e.config.estaHabilitada))("dark:border-l-slate-600",!(e.config!=null&&e.config.estaHabilitada))("ring-2",t.hasCustomizations(e.config))("ring-purple-400",t.hasCustomizations(e.config))("dark:ring-purple-600",t.hasCustomizations(e.config)),l(2),R("background-color",t.getEffectiveValue(e.config,e.typification,"color")||"#6B7280"),l(),y(t.getEffectiveValue(e.config,e.typification,"icono")?3:4),l(3),y(t.getParentBreadcrumb(e)?6:-1),l(2),S(" ",t.getEffectiveValue(e.config,e.typification,"nombre")," "),l(),y(t.hasCustomizations(e.config)?9:-1),l(2),S(" N",e.level," "),l(2),g("title",e.config!=null&&e.config.estaHabilitada?"Desactivar":"Activar"),l(),g("checked",(e.config==null?null:e.config.estaHabilitada)===!0),l(4),y(t.hasCustomizations(e.config)?18:-1),l(2),g("size",14),l(2),g("size",14),l(2),g("size",14),l(),P("opacity-30",e.typification.esSistema)("cursor-not-allowed",e.typification.esSistema),g("disabled",e.typification.esSistema),l(),g("size",14)}}function Li(o,d){if(o&1){let e=k();a(0,"button",95),x("click",function(){let i=u(e).$implicit,n=c(3);return f(n.editingForm().colorPersonalizado=i.hex)}),r()}if(o&2){let e=d.$implicit,t=c(3);Z("w-6 h-6 rounded border-2 transition-all "+(t.editingForm().colorPersonalizado===e.hex?"border-gray-900 dark:border-white ring-2 ring-purple-500":"border-gray-300")),R("background-color",e.hex),g("title",e.name)}}function Wi(o,d){o&1&&_(0,"div",93)}function Ui(o,d){if(o&1){let e=k();a(0,"div",52)(1,"div",82)(2,"div",83)(3,"label",84),s(4,"Color"),r(),a(5,"div",85),E(6,Li,1,5,"button",86,je),r()(),a(8,"div",87)(9,"div")(10,"label",84),s(11,"Nombre Personalizado"),r(),a(12,"input",88),w("ngModelChange",function(i){u(e);let n=c(2);return T(n.editingForm().nombrePersonalizado,i)||(n.editingForm().nombrePersonalizado=i),f(i)}),r()(),a(13,"div")(14,"label",84),s(15,"Descripci\xF3n (Opcional)"),r(),a(16,"textarea",89),w("ngModelChange",function(i){u(e);let n=c(2);return T(n.editingForm().descripcionPersonalizada,i)||(n.editingForm().descripcionPersonalizada=i),f(i)}),s(17,"              "),r()(),a(18,"div")(19,"label",84),s(20,"Orden"),r(),a(21,"input",90),w("ngModelChange",function(i){u(e);let n=c(2);return T(n.editingForm().ordenVisualizacionPersonalizado,i)||(n.editingForm().ordenVisualizacionPersonalizado=i),f(i)}),r()()(),a(22,"div",91)(23,"button",92),x("click",function(){u(e);let i=c().node,n=c();return f(n.saveEdit(i))}),b(24,Wi,1,0,"div",93),s(25," GUARDAR "),r(),a(26,"button",94),x("click",function(){u(e);let i=c(2);return f(i.cancelEdit())}),s(27," CANCELAR "),r()()()()}if(o&2){let e=c(2);l(6),F(e.presetColors),l(6),v("ngModel",e.editingForm().nombrePersonalizado),l(4),v("ngModel",e.editingForm().descripcionPersonalizada),l(5),v("ngModel",e.editingForm().ordenVisualizacionPersonalizado),l(2),g("disabled",e.savingEdit()),l(),y(e.savingEdit()?24:-1),l(2),g("disabled",e.savingEdit())}}function ji(o,d){if(o&1&&(a(0,"div",50),b(1,$i,27,49,"div",96),b(2,Ui,28,6,"div",52),r()),o&2){let e=d.node,t=c();l(),y(t.isEditing(e.config==null?null:e.config.id)?-1:1),l(),y(t.isEditing(e.config==null?null:e.config.id)&&t.editingForm()?2:-1)}}var jn=(()=>{let d=class d{constructor(t,i){this.classificationService=t,this.themeService=i,this.loading=C(!1),this.showSuccess=C(!1),this.showClassificationDialog=C(!1),this.showCategoryDialog=C(!1),this.showAdditionalFieldsDialog=C(!1),this.classificationDialogMode=C("create"),this.selectedClassificationForEdit=C(void 0),this.selectedTypificationForFields=C(void 0),this.additionalFieldsForEdit=C([]),this.parentClassificationForCreate=C(void 0),this.classificationTypes=Object.values(B),this.typifications=[],this.tenantConfigs=[],this.treeNodes=[],this.expandedNodes=new Set,this.tenants=[],this.portfolios=[],this.editingNodeId=C(null),this.editingForm=C(null),this.savingEdit=C(!1),this.presetColors=[{hex:"#3B82F6",name:"Azul"},{hex:"#10B981",name:"Verde"},{hex:"#EF4444",name:"Rojo"},{hex:"#F59E0B",name:"Naranja"},{hex:"#8B5CF6",name:"Violeta"},{hex:"#EC4899",name:"Rosa"},{hex:"#6366F1",name:"\xCDndigo"},{hex:"#14B8A6",name:"Turquesa"}],this.commonIcons=["phone","phone-call","check-circle","x-circle","alert-circle","user","users","credit-card","dollar-sign","calendar","clock","mail","message-square","file-text","building","wallet"]}ngOnInit(){this.loadTenants()}loadTenants(){this.classificationService.getAllTenants().subscribe({next:t=>{this.tenants=t,t.length>0&&(this.selectedTenantId=t[0].id,this.onTenantChange())},error:t=>{console.error("Error loading tenants:",t)}})}onTenantChange(){this.selectedPortfolioId=void 0,this.portfolios=[],this.typifications=[],this.treeNodes=[],this.selectedTenantId&&(this.loadPortfolios(),this.loadTypifications())}loadPortfolios(){this.selectedTenantId&&this.classificationService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:t=>{this.portfolios=t},error:t=>{console.error("Error loading portfolios:",t)}})}loadTypifications(){if(!this.selectedTenantId)return;this.loading.set(!0),(this.selectedType?this.classificationService.getTenantClassificationsByType(this.selectedTenantId,this.selectedType,this.selectedPortfolioId):this.classificationService.getTenantClassifications(this.selectedTenantId,this.selectedPortfolioId,!0)).subscribe({next:i=>{this.tenantConfigs=i,this.typifications=i.map(n=>n.tipificacion),this.buildTree(),this.loading.set(!1)},error:i=>{this.loading.set(!1),console.error("Error loading typifications:",i)}})}loadTenantConfigs(){if(!this.selectedTenantId)return;(this.selectedType?this.classificationService.getTenantClassificationsByType(this.selectedTenantId,this.selectedType,this.selectedPortfolioId):this.classificationService.getTenantClassifications(this.selectedTenantId,this.selectedPortfolioId)).subscribe({next:i=>{this.tenantConfigs=i,this.buildTree(),this.loading.set(!1)},error:i=>{console.error("Error loading tenant configs:",i),this.buildTree(),this.loading.set(!1)}})}buildTree(){let t=new Map;this.tenantConfigs.forEach(m=>{t.set(m.tipificacion.id,m)});let i=new Map;this.typifications.forEach(m=>{let h={typification:m,config:t.get(m.id),children:[],level:m.nivelJerarquia};i.set(m.id,h)});let n=[];this.typifications.forEach(m=>{let h=i.get(m.id),V=m.parentTypificationId||m.tipificacionPadre?.id;if(V){let M=i.get(V);M?M.children.push(h):n.push(h)}else n.push(h)});let p=m=>{m.sort((h,V)=>{let M=h.typification.ordenVisualizacion||0,z=V.typification.ordenVisualizacion||0;return M-z}),m.forEach(h=>{h.children.length>0&&p(h.children)})};p(n),this.treeNodes=n,this.expandAll()}toggleNode(t){this.expandedNodes.has(t)?this.expandedNodes.delete(t):this.expandedNodes.add(t)}isExpanded(t){return this.expandedNodes.has(t)}expandAll(){this.typifications.forEach(t=>this.expandedNodes.add(t.id))}collapseAll(){this.expandedNodes.clear()}onTypeChange(){this.loadTypifications()}onPortfolioChange(){this.loadTypifications()}toggleTypification(t,i){if(!this.selectedTenantId)return;let n=i.target,p=n.checked;(p?this.classificationService.enableClassification(this.selectedTenantId,t.typification.id,this.selectedPortfolioId):this.classificationService.disableClassification(this.selectedTenantId,t.typification.id,this.selectedPortfolioId)).subscribe({next:()=>{this.showSuccessMessage(),this.loadTypifications()},error:h=>{console.error("Error toggling typification:",h),n.checked=!p}})}toggleDarkMode(){this.themeService.toggleTheme()}openCreateRootDialog(){this.classificationDialogMode.set("create"),this.selectedClassificationForEdit.set(void 0),this.parentClassificationForCreate.set(void 0),this.showClassificationDialog.set(!0)}openCreateChildDialog(t){this.classificationDialogMode.set("create"),this.selectedClassificationForEdit.set(void 0),this.parentClassificationForCreate.set(t),this.showClassificationDialog.set(!0)}openEditDialog(t){this.classificationDialogMode.set("edit"),this.selectedClassificationForEdit.set(t),this.parentClassificationForCreate.set(void 0),this.showClassificationDialog.set(!0)}closeClassificationDialog(){this.showClassificationDialog.set(!1),this.selectedClassificationForEdit.set(void 0),this.parentClassificationForCreate.set(void 0)}onClassificationSaved(t){this.showClassificationDialog.set(!1),this.selectedClassificationForEdit.set(void 0),this.parentClassificationForCreate.set(void 0),this.showSuccessMessage(),this.loadTypifications()}openAdditionalFieldsDialog(t){this.selectedTypificationForFields.set(t),this.loading.set(!0),this.classificationService.getAdditionalFields(t.id).subscribe({next:i=>{this.additionalFieldsForEdit.set(i),this.showAdditionalFieldsDialog.set(!0),this.loading.set(!1)},error:i=>{console.error("Error loading additional fields:",i),this.additionalFieldsForEdit.set([]),this.showAdditionalFieldsDialog.set(!0),this.loading.set(!1)}})}closeAdditionalFieldsDialog(){this.showAdditionalFieldsDialog.set(!1),this.selectedTypificationForFields.set(void 0),this.additionalFieldsForEdit.set([])}onAdditionalFieldsSaved(){console.log("Campos adicionales guardados exitosamente"),this.showAdditionalFieldsDialog.set(!1),this.selectedTypificationForFields.set(void 0),this.additionalFieldsForEdit.set([]),this.showSuccessMessage()}deleteTypification(t){if(t.esSistema){alert("No se pueden eliminar tipificaciones del sistema");return}let i=`\xBFEst\xE1 seguro de eliminar la tipificaci\xF3n "${t.nombre}"?

Esto la eliminar\xE1 del cat\xE1logo global y afectar\xE1 a TODAS las carteras.

Esta acci\xF3n no se puede deshacer.`;confirm(i)&&this.classificationService.deleteTypification(t.id).subscribe({next:()=>{this.showSuccessMessage(),this.loadTypifications()},error:n=>{console.error("Error al eliminar tipificaci\xF3n:",n),alert("Error al eliminar la tipificaci\xF3n.")}})}showSuccessMessage(){this.showSuccess.set(!0),setTimeout(()=>this.showSuccess.set(!1),3e3)}openCreateCategoryDialog(){this.showCategoryDialog.set(!0)}closeCategoryDialog(){this.showCategoryDialog.set(!1)}onCategorySaved(t){this.showCategoryDialog.set(!1),this.showSuccessMessage(),this.classificationTypes=Object.values(B)}getTypeLabel(t){return{[B.RESULTADO_CONTACTO]:"Resultado de Contacto",[B.TIPO_GESTION]:"Tipo de Gesti\xF3n",[B.MODALIDAD_PAGO]:"Modalidad de Pago",[B.TIPO_FRACCIONAMIENTO]:"Tipo de Fraccionamiento"}[t]}moveUp(t,i,n,p){n!==0&&([i[n-1],i[n]]=[i[n],i[n-1]],this.updateOrder(i))}moveDown(t,i,n,p){n!==i.length-1&&([i[n],i[n+1]]=[i[n+1],i[n]],this.updateOrder(i))}updateOrder(t){let i=t.map((n,p)=>({id:n.typification.id,ordenVisualizacion:p*10}));console.warn("updateOrder: endpoint no implementado en V2",i),this.showSuccessMessage()}startEdit(t,i){i.stopPropagation();let n=t.config,p=t.typification;this.editingNodeId.set(n?.id||null),this.editingForm.set({nombrePersonalizado:n?.nombrePersonalizado||p.nombre,descripcionPersonalizada:n?.descripcionPersonalizada||p.descripcion||"",colorPersonalizado:n?.colorPersonalizado||p.colorSugerido||"#3B82F6",iconoPersonalizado:n?.iconoPersonalizado||p.iconoSugerido||"",ordenVisualizacionPersonalizado:n?.ordenVisualizacionPersonalizado||p.ordenVisualizacion||0})}cancelEdit(){this.editingNodeId.set(null),this.editingForm.set(null)}saveEdit(t){if(!this.editingForm()||!t.config)return;this.savingEdit.set(!0);let i=this.editingForm(),n={nombrePersonalizado:i.nombrePersonalizado!==t.typification.nombre?i.nombrePersonalizado:void 0,descripcionPersonalizada:i.descripcionPersonalizada!==(t.typification.descripcion||"")?i.descripcionPersonalizada:void 0,colorPersonalizado:i.colorPersonalizado!==(t.typification.colorSugerido||"#3B82F6")?i.colorPersonalizado:void 0,iconoPersonalizado:i.iconoPersonalizado!==(t.typification.iconoSugerido||"")?i.iconoPersonalizado:void 0,ordenVisualizacionPersonalizado:i.ordenVisualizacionPersonalizado!==(t.typification.ordenVisualizacion||0)?i.ordenVisualizacionPersonalizado:void 0};this.classificationService.updateTenantTypificationConfig(t.config.id,n).subscribe({next:()=>{this.savingEdit.set(!1),this.editingNodeId.set(null),this.editingForm.set(null),this.showSuccessMessage(),this.loadTypifications()},error:p=>{console.error("Error al guardar personalizaci\xF3n:",p),this.savingEdit.set(!1),alert("Error al guardar los cambios")}})}resetCustomization(t,i){if(i.stopPropagation(),!t.config||!confirm("\xBFResetear a valores del cat\xE1logo global?"))return;let n={nombrePersonalizado:void 0,descripcionPersonalizada:void 0,colorPersonalizado:void 0,iconoPersonalizado:void 0,ordenVisualizacionPersonalizado:void 0};this.classificationService.updateTenantTypificationConfig(t.config.id,n).subscribe({next:()=>{this.showSuccessMessage(),this.loadTypifications()},error:p=>{console.error("Error al resetear personalizaci\xF3n:",p),alert("Error al resetear personalizaci\xF3n")}})}isEditing(t){return t!==void 0&&this.editingNodeId()===t}hasCustomizations(t){return t?!!(t.nombrePersonalizado||t.descripcionPersonalizada||t.colorPersonalizado||t.iconoPersonalizado||t.ordenVisualizacionPersonalizado!==null):!1}getEffectiveValue(t,i,n){let p=n+"Personalizado",m=n==="nombre"?"nombre":n==="color"?"colorSugerido":n==="icono"?"iconoSugerido":n;return t?.[p]||i[m]||""}matchesTypeFilter(t){return this.selectedType?t.tipoClasificacion===this.selectedType:!0}nodeOrChildrenMatch(t){return!this.selectedType||this.matchesTypeFilter(t.typification)?!0:t.children.some(i=>this.nodeOrChildrenMatch(i))}getParentBreadcrumb(t){let i=[],n=t,p=(h,V)=>{for(let M of h){if(M.children.some(ke=>ke.typification.id===V))return M;let z=p(M.children,V);if(z)return z}return null};if(n.typification.parentTypificationId||n.typification.tipificacionPadre?.id){let h=p(this.treeNodes,n.typification.id);if(h){let V=M=>{let z=[];if(M.typification.parentTypificationId||M.typification.tipificacionPadre?.id){let Se=p(this.treeNodes,M.typification.id);Se&&z.push(...V(Se))}return z.push(this.getEffectiveValue(M.config,M.typification,"nombre")),z};return V(h).join(" > ")}}return""}getFilteredNodes(t){if(!this.selectedType)return t;let i=[],n=p=>{for(let m of p)this.matchesTypeFilter(m.typification)&&i.push(m),m.children.length>0&&n(m.children)};return n(t),i}};d.\u0275fac=function(i){return new(i||d)(J(ne),J(Ve))},d.\u0275cmp=I({type:d,selectors:[["app-typification-maintenance"]],decls:52,vars:14,consts:[["treeNodeTemplate",""],["flatNodeTemplate",""],[1,"h-[100dvh]","bg-gradient-to-br","from-slate-50","via-blue-50","to-slate-100","dark:from-slate-950","dark:via-gray-950","dark:to-black","flex","flex-col","overflow-hidden","transition-colors","duration-300"],[1,"fixed","top-4","right-4","z-50","animate-[slideInRight_0.5s_ease-out]"],[1,"bg-gradient-to-r","from-slate-900","via-blue-900","to-slate-900","dark:from-slate-950","dark:via-blue-950","dark:to-slate-950","text-white","shadow-md","relative","overflow-hidden"],[1,"relative","px-3","py-1"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","gap-1.5"],[1,"bg-blue-500","dark:bg-blue-600","p-1","rounded"],[1,"text-sm","font-bold"],[1,"text-[9px]","text-blue-200","dark:text-blue-300","flex","items-center","gap-0.5"],[1,"flex","items-center","gap-2"],["title","Cambiar tema",3,"click"],[1,"text-[10px]","text-yellow-300","font-semibold"],[1,"text-[10px]","text-white","font-semibold"],[1,"bg-white","dark:bg-slate-900","border-b","border-blue-400","dark:border-slate-700","shadow-sm","relative","overflow-hidden","transition-colors","duration-300"],[1,"absolute","inset-0","bg-gradient-to-r","from-blue-50","dark:from-blue-950/50","to-transparent","opacity-50"],[1,"flex","items-center","gap-3","text-xs"],[1,"text-[9px]","text-gray-500","dark:text-white","uppercase","font-semibold"],[1,"text-xs","font-semibold","text-gray-800","dark:text-white","bg-transparent","border-none","focus:outline-none","cursor-pointer",3,"ngModelChange","change","ngModel"],[1,"bg-white","dark:bg-slate-800",3,"ngValue"],["class","bg-white dark:bg-slate-800",3,"ngValue",4,"ngFor","ngForOf"],[1,"flex","gap-2"],[1,"px-3","py-1","text-[10px]","bg-purple-600","hover:bg-purple-700","text-white","rounded","font-semibold","transition-colors","flex","items-center","gap-1",3,"click"],[1,"text-sm"],[1,"px-3","py-1","text-[10px]","bg-blue-600","hover:bg-blue-700","text-white","rounded","font-semibold","transition-colors","flex","items-center","gap-1",3,"click"],[1,"px-2","py-1","text-[10px]","text-slate-600","dark:text-slate-300","hover:text-blue-600","dark:hover:text-blue-400","hover:bg-blue-50","dark:hover:bg-blue-950/30","rounded","transition-colors","font-semibold",3,"click"],[3,"mode","typification","parentClassification","defaultType","tenantId","portfolioId"],[3,"typifications"],[3,"isOpen","typificationName","typificationId","tenantId","portfolioId","subPortfolioId"],[1,"flex-1","flex","items-center","justify-center"],[1,"flex-1","overflow-auto","p-2"],[1,"bg-gradient-to-r","from-green-500","to-emerald-600","text-white","px-6","py-4","rounded-lg","shadow-2xl","flex","items-center","gap-3"],[1,"font-bold"],[1,"text-sm","opacity-90"],[1,"h-6","w-px","bg-gray-200","dark:bg-gray-700"],[1,"font-semibold","text-gray-800","dark:text-white","text-[10px]","bg-transparent","border-none","focus:outline-none","cursor-pointer",3,"ngModelChange","change","ngModel"],[3,"save","cancel","mode","typification","parentClassification","defaultType","tenantId","portfolioId"],[3,"save","cancel","typifications"],[3,"save","close","isOpen","typificationName","typificationId","tenantId","portfolioId","subPortfolioId"],[1,"text-center"],[1,"inline-block","animate-spin","rounded-full","h-12","w-12","border-4","border-blue-500","border-t-transparent"],[1,"mt-4","text-slate-600","dark:text-slate-300","font-semibold"],[1,"typification-tree-container","bg-white","dark:bg-slate-900","rounded-lg","shadow-md","p-2","transition-colors","duration-300","border","border-slate-200","dark:border-slate-800"],[1,"text-center","py-20"],[1,"text-slate-500","dark:text-slate-400","text-lg","font-semibold","mb-2"],[1,"text-slate-400","dark:text-slate-500","text-sm","mb-6"],[1,"space-y-1"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"typification-item-wrapper"],[1,"typification-item","flex","items-center","justify-between","px-2","rounded","border-l-3","mb-1","transition-all","duration-300",3,"py-1","py-0","opacity-40","scale-95","bg-green-50","dark:bg-green-950/40","hover:bg-green-100","dark:hover:bg-green-900/50","bg-slate-100","dark:bg-slate-800/50","hover:bg-slate-200","dark:hover:bg-slate-700/50","bg-gray-50","dark:bg-gray-900/20","border-l-green-500","dark:border-l-green-600","border-l-slate-400","dark:border-l-slate-600","border-l-gray-300","dark:border-l-gray-700","ring-2","ring-purple-400","dark:ring-purple-600"],[1,"bg-purple-50","dark:bg-purple-950/40","border-2","border-purple-400","dark:border-purple-600","rounded-lg","p-3","mb-2","shadow-lg"],[1,"mt-1","space-y-1"],[1,"typification-item","flex","items-center","justify-between","px-2","rounded","border-l-3","mb-1","transition-all","duration-300"],[1,"flex","items-center","gap-2","flex-1","min-w-0"],[1,"flex-shrink-0","w-5","h-5","flex","items-center","justify-center","text-slate-600","dark:text-slate-300","hover:bg-slate-200","dark:hover:bg-slate-700","rounded","transition-colors"],[1,"w-5","flex-shrink-0"],[1,"flex-shrink-0","rounded","flex","items-center","justify-center","text-white","font-bold","shadow-sm","transition-all"],[3,"name","size"],[1,"flex-1","min-w-0"],[1,"font-semibold","truncate","transition-all"],[1,"text-[10px]","text-slate-500","dark:text-slate-400","truncate"],[1,"flex-shrink-0","px-2","py-0.5","bg-blue-100","dark:bg-blue-900/40","text-blue-700","dark:text-blue-300","rounded","font-bold","transition-all"],[1,"flex","items-center","gap-1.5","ml-2","flex-shrink-0"],[1,"flex-shrink-0","w-5","h-5","flex","items-center","justify-center","text-slate-600","dark:text-slate-300","hover:bg-slate-200","dark:hover:bg-slate-700","rounded","transition-colors",3,"click"],[1,"ml-1","px-1","py-0.5","bg-purple-100","dark:bg-purple-900/40","text-purple-700","dark:text-purple-300","rounded","text-[9px]","font-bold"],[1,"relative","inline-flex","items-center","cursor-pointer",3,"click","title"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-9","h-5","bg-gray-300","dark:bg-gray-600","peer-focus:outline-none","peer-focus:ring-2","peer-focus:ring-blue-500","rounded-full","peer","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-4","after:w-4","after:transition-all","peer-checked:bg-green-500"],["title","Personalizar para esta cartera",1,"px-2","py-1","text-[10px]","bg-purple-600","hover:bg-purple-700","text-white","rounded","font-semibold","transition-colors",3,"click"],["title","Resetear a valores del cat\xE1logo",1,"w-6","h-6","flex","items-center","justify-center","text-orange-600","dark:text-orange-400","hover:bg-orange-100","dark:hover:bg-orange-900/30","rounded","transition-colors"],["title","Agregar hijo",1,"w-6","h-6","flex","items-center","justify-center","text-green-600","dark:text-green-400","hover:bg-green-100","dark:hover:bg-green-900/30","rounded","transition-colors",3,"click"],["name","plus-circle",3,"size"],["title","Configurar Campos Adicionales",1,"w-6","h-6","flex","items-center","justify-center","text-purple-600","dark:text-purple-400","hover:bg-purple-100","dark:hover:bg-purple-900/30","rounded","transition-colors",3,"click"],["name","settings",3,"size"],["title","Editar cat\xE1logo global",1,"w-6","h-6","flex","items-center","justify-center","text-blue-600","dark:text-blue-400","hover:bg-blue-100","dark:hover:bg-blue-900/30","rounded","transition-colors",3,"click"],["name","edit-2",3,"size"],["title","Eliminar",1,"w-6","h-6","flex","items-center","justify-center","text-red-600","dark:text-red-400","hover:bg-red-100","dark:hover:bg-red-900/30","rounded","transition-colors","disabled:hover:bg-transparent",3,"click","disabled"],["name","trash-2",3,"size"],["title","Resetear a valores del cat\xE1logo",1,"w-6","h-6","flex","items-center","justify-center","text-orange-600","dark:text-orange-400","hover:bg-orange-100","dark:hover:bg-orange-900/30","rounded","transition-colors",3,"click"],["name","corner-up-left",3,"size"],[1,"flex","items-start","gap-3"],[1,"flex-shrink-0"],[1,"block","text-[10px]","font-bold","text-gray-700","dark:text-gray-200","mb-1"],[1,"flex","gap-1","flex-wrap","max-w-[120px]"],["type","button",3,"class","background-color","title"],[1,"flex-1","space-y-2"],["type","text","placeholder","Nombre",1,"w-full","px-2","py-1","text-sm","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-2","focus:ring-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel"],["rows","2","placeholder","Descripci\xF3n",1,"w-full","px-2","py-1","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-2","focus:ring-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel"],["type","number","min","0","step","10",1,"w-24","px-2","py-1","text-sm","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-2","focus:ring-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel"],[1,"flex-shrink-0","flex","flex-col","gap-1"],[1,"px-3","py-1.5","bg-green-600","hover:bg-green-700","disabled:bg-gray-400","text-white","rounded","font-semibold","text-xs","transition-colors","flex","items-center","gap-1",3,"click","disabled"],[1,"w-3","h-3","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],[1,"px-3","py-1.5","bg-gray-600","hover:bg-gray-700","disabled:bg-gray-400","text-white","rounded","font-semibold","text-xs","transition-colors",3,"click","disabled"],["type","button",3,"click","title"],[1,"typification-item","flex","items-center","justify-between","px-3","py-2","rounded","border-l-3","mb-1","transition-all","duration-300",3,"bg-green-50","dark:bg-green-950/40","hover:bg-green-100","dark:hover:bg-green-900/50","bg-slate-100","dark:bg-slate-800/50","hover:bg-slate-200","dark:hover:bg-slate-700/50","border-l-green-500","dark:border-l-green-600","border-l-slate-400","dark:border-l-slate-600","ring-2","ring-purple-400","dark:ring-purple-600"],[1,"typification-item","flex","items-center","justify-between","px-3","py-2","rounded","border-l-3","mb-1","transition-all","duration-300"],[1,"flex","items-center","gap-3","flex-1","min-w-0"],[1,"flex-shrink-0","w-10","h-10","rounded","flex","items-center","justify-center","text-white","text-sm","font-bold","shadow-sm"],[1,"text-[10px]","text-gray-500","dark:text-gray-400","truncate","mb-0.5"],[1,"font-semibold","text-slate-800","dark:text-slate-100","text-base","truncate"],[1,"inline-block","mt-0.5","px-1.5","py-0.5","bg-purple-100","dark:bg-purple-900/40","text-purple-700","dark:text-purple-300","rounded","text-[9px]","font-bold"],[1,"flex-shrink-0","px-2","py-1","bg-blue-100","dark:bg-blue-900/40","text-blue-700","dark:text-blue-300","rounded","text-xs","font-bold"],[1,"flex","items-center","gap-1.5","ml-3","flex-shrink-0"]],template:function(i,n){if(i&1){let p=k();a(0,"div",2),b(1,Zt,7,0,"div",3),a(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7)(6,"div")(7,"div",8),_(8,"div",9),a(9,"div")(10,"h1",10),s(11,"Mantenimiento de Tipificaciones"),r(),a(12,"p",11),s(13," Configuraci\xF3n de clasificaciones "),r()()()()(),a(14,"div",12)(15,"button",13),x("click",function(){return u(p),f(n.toggleDarkMode())}),b(16,Qt,2,0,"span",14)(17,Kt,2,0,"span",15),r()()()()(),a(18,"div",16),_(19,"div",17),a(20,"div",5)(21,"div",6)(22,"div",18),b(23,ti,6,2),b(24,ni,8,3),a(25,"div")(26,"div",19),s(27,"Tipo"),r(),a(28,"select",20),w("ngModelChange",function(h){return u(p),T(n.selectedType,h)||(n.selectedType=h),f(h)}),x("change",function(){return u(p),f(n.onTypeChange())}),a(29,"option",21),s(30,"Todos"),r(),oe(31,oi,2,2,"option",22),r()()(),a(32,"div",23)(33,"button",24),x("click",function(){return u(p),f(n.openCreateCategoryDialog())}),a(34,"span",25),s(35,"+"),r(),s(36," Nueva Categor\xEDa "),r(),a(37,"button",26),x("click",function(){return u(p),f(n.openCreateRootDialog())}),s(38," Nueva Tipificaci\xF3n "),r(),a(39,"button",27),x("click",function(){return u(p),f(n.expandAll())}),s(40," Expandir todo "),r(),a(41,"button",27),x("click",function(){return u(p),f(n.collapseAll())}),s(42," Contraer todo "),r()()()()(),b(43,ai,1,6,"app-typification-form-dialog",28),b(44,ri,1,1,"app-category-form-dialog",29),b(45,li,1,6,"app-typification-additional-fields-dialog",30),b(46,di,5,0,"div",31),b(47,fi,4,1,"div",32),r(),oe(48,Vi,4,5,"ng-template",null,0,ve)(50,ji,3,2,"ng-template",null,1,ve)}i&2&&(l(),y(n.showSuccess()?1:-1),l(14),Z("flex items-center gap-1.5 px-2 py-1.5 rounded-lg transition-all duration-300 group border "+(n.themeService.isDarkMode()?"bg-yellow-500/20 hover:bg-yellow-500/30 border-yellow-500/40":"bg-blue-500/90 hover:bg-blue-600 border-blue-600")),l(),y(n.themeService.isDarkMode()?16:17),l(7),y(n.tenants.length>0?23:-1),l(),y(n.portfolios.length>0?24:-1),l(4),v("ngModel",n.selectedType),l(),g("ngValue",void 0),l(2),g("ngForOf",n.classificationTypes),l(12),y(n.showClassificationDialog()?43:-1),l(),y(n.showCategoryDialog()?44:-1),l(),y(n.showAdditionalFieldsDialog()?45:-1),l(),y(n.loading()?46:-1),l(),y(n.loading()?-1:47))},dependencies:[N,De,Pe,j,Y,X,q,ue,G,W,fe,U,L,$,Oe,Le,Ue],styles:[".classification-item[_ngcontent-%COMP%]{transition:transform .15s ease,box-shadow .15s ease;position:relative}.classification-item[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 4px #00000014}.dark[_nghost-%COMP%]   .classification-item[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .classification-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000004d}"]});let o=d;return o})();export{jn as TypificationMaintenanceComponent};
