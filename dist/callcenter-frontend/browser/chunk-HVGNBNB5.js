import{b as L}from"./chunk-ZMI7PURB.js";import{a as B,b as R}from"./chunk-GEADHBDI.js";import"./chunk-2KUQMYY5.js";import{a as F}from"./chunk-4VH3R5HS.js";import{a as I,b as A,c as k,d as D,e as T}from"./chunk-A4SFNORY.js";import"./chunk-XCDAWB4O.js";import{B as V,C as j,z as U}from"./chunk-3LCGNP6X.js";import"./chunk-FI2LHONG.js";import"./chunk-23OTUMEK.js";import{a as O,c as E}from"./chunk-FYMDUG3I.js";import"./chunk-3ZQDWBF5.js";import"./chunk-R365LOCT.js";import{Rb as w,Sb as z}from"./chunk-PSICT5GB.js";import"./chunk-YQKVMPSG.js";import{$a as i,E as S,Kb as a,Lb as e,Mb as t,Nb as s,Ub as M,Wb as u,Yb as m,dd as y,fb as x,kc as n,lc as v,ld as P,ma as g,mb as b,mc as h,na as f,rb as _}from"./chunk-FWGUXTKY.js";function H(l,d){l&1&&(e(0,"div",6),s(1,"div",7),e(2,"p"),n(3,"Cargando detalles de la llamada..."),t()())}function N(l,d){l&1&&(e(0,"div",41),s(1,"div",7),e(2,"span"),n(3,"Conectando..."),t()())}function Y(l,d){if(l&1){let r=M();e(0,"div",42)(1,"button",43),u("click",function(){g(r);let c=m(2);return f(c.toggleMute())}),s(2,"lucide-angular",12),n(3),t(),e(4,"button",44),u("click",function(){g(r);let c=m(2);return f(c.disconnectSupervision())}),s(5,"lucide-angular",45),n(6," Desconectar "),t()()}if(l&2){let r=m(2);i(),a("color",r.isMuted?"warn":""),i(),a("name",r.isMuted?"mic-off":"mic")("size",20),i(),h(" ",r.isMuted?"Activar Micr\xF3fono":"Silenciar"," "),i(2),a("size",20)}}function W(l,d){if(l&1){let r=M();e(0,"div",8)(1,"mat-card",9)(2,"mat-card-header")(3,"mat-card-title"),n(4,"Estado de la Supervisi\xF3n"),t()(),e(5,"mat-card-content")(6,"div",10)(7,"mat-chip",11),s(8,"lucide-angular",12),n(9),t(),e(10,"div",13),s(11,"lucide-angular",14),e(12,"span"),n(13),t()()()()(),e(14,"mat-card",15)(15,"mat-card-header")(16,"mat-card-title"),n(17,"Informaci\xF3n de la Llamada"),t()(),e(18,"mat-card-content")(19,"div",16)(20,"div",17),s(21,"lucide-angular",18),e(22,"div")(23,"div",19),n(24,"Agente"),t(),e(25,"div",20),n(26),t(),e(27,"div",21),n(28),t()()(),e(29,"div",17),s(30,"lucide-angular",22),e(31,"div")(32,"div",19),n(33,"Cliente"),t(),e(34,"div",20),n(35),t(),e(36,"div",21),n(37),t()()()()()(),e(38,"mat-card",23)(39,"mat-card-header")(40,"mat-card-title"),n(41,"Modos de Supervisi\xF3n"),t()(),e(42,"mat-card-content")(43,"div",24)(44,"button",25),u("click",function(){g(r);let c=m();return f(c.startSpyMode())}),s(45,"lucide-angular",26),e(46,"div",27)(47,"span",28),n(48,"Vig\xEDa"),t(),e(49,"span",29),n(50,"Solo escuchar"),t()()(),e(51,"button",30),u("click",function(){g(r);let c=m();return f(c.startWhisperMode())}),s(52,"lucide-angular",31),e(53,"div",27)(54,"span",28),n(55,"Susurro"),t(),e(56,"span",29),n(57,"Hablar al agente"),t()()(),e(58,"button",32),u("click",function(){g(r);let c=m();return f(c.startBargeMode())}),s(59,"lucide-angular",33),e(60,"div",27)(61,"span",28),n(62,"Tripartita"),t(),e(63,"span",29),n(64,"Unirse a la llamada"),t()()()(),_(65,N,4,0,"div",34)(66,Y,7,5,"div",35),t()(),e(67,"mat-card",36)(68,"mat-card-header")(69,"mat-card-title"),n(70,"Instrucciones"),t()(),e(71,"mat-card-content")(72,"div",37),s(73,"lucide-angular",38),e(74,"div")(75,"strong"),n(76,"Vig\xEDa:"),t(),n(77," Escuchas la conversaci\xF3n entre agente y cliente. Nadie puede escucharte. "),t()(),e(78,"div",37),s(79,"lucide-angular",39),e(80,"div")(81,"strong"),n(82,"Susurro:"),t(),n(83," Hablas solo con el agente. El cliente no puede escucharte. "),t()(),e(84,"div",37),s(85,"lucide-angular",40),e(86,"div")(87,"strong"),n(88,"Tripartita:"),t(),n(89," Te unes como participante completo. Todos se escuchan. "),t()()()()()}if(l&2){let r=m();i(7),a("color",r.getModeColor())("highlighted",r.currentMode!=="none"),i(),a("name",r.currentMode!=="none"?"eye":"eye-off")("size",16),i(),h(" ",r.getModeLabel()," "),i(2),a("size",20),i(2),v(r.formatDuration(r.callDuration)),i(8),a("size",24),i(5),v(r.call.agentName),i(2),h("Ext: ",r.call.agentExtension),i(2),a("size",24),i(5),v(r.call.clientNumber),i(2),v(r.call.callState),i(7),a("disabled",r.currentMode!=="none"||r.isConnecting),i(),a("size",20),i(6),a("disabled",r.currentMode!=="none"||r.isConnecting),i(),a("size",20),i(6),a("disabled",r.currentMode!=="none"||r.isConnecting),i(),a("size",20),i(6),a("ngIf",r.isConnecting),i(),a("ngIf",r.currentMode!=="none"),i(7),a("size",24),i(6),a("size",24),i(6),a("size",24)}}var ce=(()=>{let d=class d{constructor(o,c,p,C){this.route=o,this.router=c,this.adminService=p,this.sipService=C,this.call=null,this.currentMode="none",this.isConnecting=!1,this.isMuted=!1,this.callDuration=0,this.callUuid="",this.sipRegistered=!1}ngOnInit(){if(this.callUuid=this.route.snapshot.paramMap.get("callUuid")||"",!this.callUuid){console.error("No call UUID provided"),this.router.navigate(["/admin/monitoring"]);return}this.loadCallDetails(),this.initializeAdminSip(),this.startDurationTimer()}ngOnDestroy(){this.timerSubscription&&this.timerSubscription.unsubscribe(),this.currentMode!=="none"&&this.disconnectSupervision(),this.sipService.disableAutoAnswer(),this.sipRegistered&&this.sipService.unregister()}loadCallDetails(){this.adminService.getActiveCall(this.callUuid).subscribe({next:o=>{this.call=o,this.callDuration=o.duration},error:o=>{console.error("Error loading call details:",o),this.router.navigate(["/admin/monitoring"])}})}initializeAdminSip(){let o={extension:"1000",password:"admin1234",wsUrl:"cobranza.contactototal.com.pe:7443",domain:"cobranza.contactototal.com.pe"};console.log("\u{1F527} Initializing admin SIP with extension 1000"),this.sipService.enableAutoAnswer(),this.sipService.register(o.extension,o.password,o.wsUrl,o.domain).then(()=>{console.log("\u2705 Admin SIP registered successfully with auto-answer enabled"),this.sipRegistered=!0}).catch(c=>{console.error("\u274C Admin SIP registration failed:",c)})}startDurationTimer(){this.timerSubscription=S(1e3).subscribe(()=>{this.callDuration++})}startSpyMode(){if(this.currentMode!=="none"){alert("Ya est\xE1s en modo de supervisi\xF3n. Desconecta primero.");return}this.isConnecting=!0,console.log("\u{1F575}\uFE0F Starting SPY mode for call:",this.callUuid),this.adminService.spyCall(this.callUuid).subscribe({next:()=>{console.log("\u2705 SPY mode activated"),this.currentMode="spy",this.isConnecting=!1},error:o=>{console.error("\u274C Error starting spy mode:",o),this.isConnecting=!1,alert("Error al iniciar modo Vig\xEDa")}})}startWhisperMode(){if(this.currentMode!=="none"){alert("Ya est\xE1s en modo de supervisi\xF3n. Desconecta primero.");return}this.isConnecting=!0,console.log("\u{1F5E3}\uFE0F Starting WHISPER mode for call:",this.callUuid),this.adminService.whisperCall(this.callUuid).subscribe({next:()=>{console.log("\u2705 WHISPER mode activated"),this.currentMode="whisper",this.isConnecting=!1},error:o=>{console.error("\u274C Error starting whisper mode:",o),this.isConnecting=!1,alert("Error al iniciar modo Susurro")}})}startBargeMode(){if(this.currentMode!=="none"){alert("Ya est\xE1s en modo de supervisi\xF3n. Desconecta primero.");return}this.isConnecting=!0,console.log("\u{1F4DE} Starting BARGE mode for call:",this.callUuid),this.adminService.bargeCall(this.callUuid).subscribe({next:()=>{console.log("\u2705 BARGE mode activated"),this.currentMode="barge",this.isConnecting=!1},error:o=>{console.error("\u274C Error starting barge mode:",o),this.isConnecting=!1,alert("Error al iniciar modo Tripartita")}})}disconnectSupervision(){console.log("\u{1F50C} Disconnecting from supervision"),this.sipService.hangup(),this.currentMode="none",this.isMuted=!1}toggleMute(){this.isMuted=!this.isMuted,this.isMuted?this.sipService.mute():this.sipService.unmute(),console.log(this.isMuted?"\u{1F507} Muted":"\u{1F50A} Unmuted")}goBack(){this.router.navigate(["/admin/monitoring"])}formatDuration(o){let c=Math.floor(o/60),p=o%60;return`${c.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`}getModeLabel(){switch(this.currentMode){case"spy":return"Vig\xEDa";case"whisper":return"Susurro";case"barge":return"Tripartita";default:return"Sin conexi\xF3n"}}getModeColor(){switch(this.currentMode){case"spy":return"accent";case"whisper":return"primary";case"barge":return"warn";default:return""}}};d.\u0275fac=function(c){return new(c||d)(x(O),x(E),x(F),x(L))},d.\u0275cmp=b({type:d,selectors:[["app-admin-call-supervision"]],decls:8,vars:3,consts:[[1,"supervision-container"],[1,"supervision-header"],["mat-icon-button","",3,"click"],["name","arrow-left",3,"size"],["class","loading-container",4,"ngIf"],["class","call-details-container",4,"ngIf"],[1,"loading-container"],[1,"w-8","h-8","border-4","border-blue-500","border-t-transparent","rounded-full","animate-spin"],[1,"call-details-container"],[1,"status-card"],[1,"status-info"],[3,"color","highlighted"],[3,"name","size"],[1,"duration"],["name","clock",3,"size"],[1,"info-card"],[1,"info-grid"],[1,"info-item"],["name","user",3,"size"],[1,"info-label"],[1,"info-value"],[1,"info-sublabel"],["name","phone",3,"size"],[1,"controls-card"],[1,"mode-buttons"],["mat-raised-button","","color","accent",1,"mode-button",3,"click","disabled"],["name","eye",3,"size"],[1,"button-content"],[1,"mode-name"],[1,"mode-description"],["mat-raised-button","","color","primary",1,"mode-button",3,"click","disabled"],["name","mic",3,"size"],["mat-raised-button","","color","warn",1,"mode-button",3,"click","disabled"],["name","users",3,"size"],["class","connecting-status",4,"ngIf"],["class","active-controls",4,"ngIf"],[1,"instructions-card"],[1,"instruction-item"],["name","eye",1,"text-blue-500",3,"size"],["name","mic",1,"text-green-500",3,"size"],["name","users",1,"text-red-500",3,"size"],[1,"connecting-status"],[1,"active-controls"],["mat-raised-button","",3,"click","color"],["mat-raised-button","","color","warn",3,"click"],["name","phone-off",3,"size"]],template:function(c,p){c&1&&(e(0,"div",0)(1,"div",1)(2,"button",2),u("click",function(){return p.goBack()}),s(3,"lucide-angular",3),t(),e(4,"h2"),n(5,"Supervisi\xF3n de Llamada"),t()(),_(6,H,4,0,"div",4)(7,W,90,24,"div",5),t()),c&2&&(i(3),a("size",20),i(3),a("ngIf",!p.call),i(),a("ngIf",p.call))},dependencies:[P,y,T,I,k,D,A,j,V,U,R,B,z,w],styles:[".supervision-container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.supervision-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:24px}.supervision-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:500}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;gap:20px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#666}.call-details-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.status-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding-top:16px}.status-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px}.status-info[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]{font-size:14px}.status-info[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.duration[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:18px;font-weight:500}.duration[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#666}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px;padding:8px 0}.info-item[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-start}.info-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3f51b5;margin-top:4px}.info-label[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase;margin-bottom:4px}.info-value[_ngcontent-%COMP%]{font-size:18px;font-weight:500;margin-bottom:2px}.info-sublabel[_ngcontent-%COMP%]{font-size:14px;color:#888}.mode-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:20px}.mode-button[_ngcontent-%COMP%]{min-height:80px!important;display:flex!important;flex-direction:column!important;align-items:center!important;justify-content:center!important;gap:8px!important;padding:16px!important}.mode-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px}.button-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.mode-name[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.mode-description[_ngcontent-%COMP%]{font-size:12px;opacity:.8}.connecting-status[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:16px;padding:20px;background-color:#f5f5f5;border-radius:4px;margin-bottom:16px}.active-controls[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;padding:20px;background-color:#e3f2fd;border-radius:4px}.active-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:160px}.instruction-item[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-start;padding:12px 0}.instruction-item[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #e0e0e0}.instruction-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-top:2px}.instruction-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}@media (max-width: 768px){.supervision-container[_ngcontent-%COMP%]{padding:12px}.mode-buttons[_ngcontent-%COMP%], .info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.active-controls[_ngcontent-%COMP%]{flex-direction:column}.active-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]});let l=d;return l})();export{ce as AdminCallSupervision};
