import{a as G}from"./chunk-LL26DHMR.js";import{A as B,E as q,c as P,f as j,k as W}from"./chunk-7GV7UZOL.js";import{Zb as I,_b as L}from"./chunk-NUMEWRMA.js";import"./chunk-YQKVMPSG.js";import{Fb as b,Gb as h,Jb as z,Kb as V,Lb as c,Mb as t,Nb as e,Ob as u,Vb as M,Xb as f,Zb as m,a as S,ab as o,b as N,gb as D,kc as _,lc as s,mc as p,md as A,na as g,nb as k,nc as F,oa as x,qc as C,rc as w,sc as y,xa as v}from"./chunk-SN4XSKG7.js";var R=(l,d)=>d.id;function X(l,d){l&1&&(t(0,"div",29),u(1,"div",32),t(2,"p",33),s(3,"Cargando proveedores..."),e()())}function Y(l,d){l&1&&s(0," Intenta con otro t\xE9rmino de b\xFAsqueda ")}function Z(l,d){l&1&&s(0," Comienza creando tu primer proveedor ")}function O(l,d){if(l&1&&(t(0,"div",29)(1,"div",34),u(2,"lucide-angular",35),e(),t(3,"p",36),s(4,"No se encontraron proveedores"),e(),t(5,"p",37),b(6,Y,1,0)(7,Z,1,0),e()()),l&2){let a=m();o(2),c("size",32),o(4),h(a.searchTerm?6:7)}}function H(l,d){if(l&1){let a=M();t(0,"tr",42)(1,"td",43)(2,"span",44),s(3),e()(),t(4,"td",43)(5,"span",45),s(6),e()(),t(7,"td",43)(8,"span",46),s(9),e()(),t(10,"td",43)(11,"label",47)(12,"input",48),f("change",function(){let i=g(a).$implicit,r=m(2);return x(r.toggleTenantStatus(i))}),e(),u(13,"div",49),e()(),t(14,"td",43)(15,"div",50)(16,"button",51),f("click",function(){let i=g(a).$implicit,r=m(2);return x(r.editTenant(i))}),u(17,"lucide-angular",52),e(),t(18,"button",53),f("click",function(){let i=g(a).$implicit,r=m(2);return x(r.deleteTenant(i))}),u(19,"lucide-angular",54),e()()()()}if(l&2){let a=d.$implicit;o(3),p(a.tenantCode),o(3),p(a.tenantName),o(3),p(a.businessName||"-"),o(3),c("checked",a.isActive),o(5),c("size",18),o(),_(a.hasPortfolios?"text-gray-600 cursor-not-allowed":"text-red-400 hover:text-red-500 cursor-pointer"),c("disabled",a.hasPortfolios)("title",a.hasPortfolios?"No se puede eliminar: tiene carteras asociadas":"Eliminar"),o(),c("size",18)}}function J(l,d){if(l&1&&(t(0,"div",30)(1,"table",38)(2,"thead",39)(3,"tr")(4,"th",40),s(5,"C\xF3digo"),e(),t(6,"th",40),s(7,"Nombre"),e(),t(8,"th",40),s(9,"Raz\xF3n Social"),e(),t(10,"th",40),s(11,"Estado"),e(),t(12,"th",40),s(13,"Acciones"),e()()(),t(14,"tbody",41),z(15,H,20,10,"tr",42,R),e()()()),l&2){let a=m();o(15),V(a.filteredTenants())}}function K(l,d){if(l&1&&(t(0,"p",67),s(1),e()),l&2){let a=m(2);o(),p(a.getCodeErrorMessage())}}function Q(l,d){l&1&&(t(0,"p",68),s(1,"C\xF3digo \xFAnico alfanum\xE9rico de m\xE1ximo 3 caracteres (no se puede cambiar despu\xE9s de crear)"),e())}function U(l,d){if(l&1&&(t(0,"p",67),s(1),e()),l&2){let a=m(2);o(),p(a.getNameErrorMessage())}}function $(l,d){if(l&1&&(t(0,"p",67),s(1),e()),l&2){let a=m(2);o(),p(a.getBusinessNameErrorMessage())}}function ee(l,d){l&1&&(t(0,"p",68),s(1,"Nombre legal de la empresa (opcional)"),e())}function te(l,d){if(l&1){let a=M();t(0,"div",31)(1,"div",55)(2,"div",56)(3,"div",2)(4,"div",50)(5,"div",57),u(6,"lucide-angular",58),e(),t(7,"div")(8,"h2",59),s(9),e(),t(10,"p",60),s(11,"Complete la informaci\xF3n del proveedor"),e()()(),t(12,"button",61),f("click",function(){g(a);let i=m();return x(i.closeDialog())}),u(13,"lucide-angular",62),e()()(),t(14,"div",63)(15,"div",64)(16,"div")(17,"label",65),s(18," C\xF3digo del Proveedor * "),e(),t(19,"input",66),y("ngModelChange",function(i){g(a);let r=m();return w(r.formData.tenantCode,i)||(r.formData.tenantCode=i),x(i)}),e(),b(20,K,2,1,"p",67)(21,Q,2,0,"p",68),e(),t(22,"div")(23,"label",65),s(24," Nombre del Proveedor * "),e(),t(25,"input",69),y("ngModelChange",function(i){g(a);let r=m();return w(r.formData.tenantName,i)||(r.formData.tenantName=i),x(i)}),e(),b(26,U,2,1,"p",67),e(),t(27,"div")(28,"label",65),s(29," Raz\xF3n Social "),e(),t(30,"input",70),y("ngModelChange",function(i){g(a);let r=m();return w(r.formData.businessName,i)||(r.formData.businessName=i),x(i)}),e(),b(31,$,2,1,"p",67)(32,ee,2,0,"p",68),e()()(),t(33,"div",71)(34,"button",72),f("click",function(){g(a);let i=m();return x(i.closeDialog())}),s(35," Cancelar "),e(),t(36,"button",73),f("click",function(){g(a);let i=m();return x(i.saveTenant())}),s(37),e()()()()}if(l&2){let a=m();o(6),c("size",20),o(3),p(a.editingTenant()?"Editar Proveedor":"Nuevo Proveedor"),o(4),c("size",20),o(6),_(a.getCodeErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase"),C("ngModel",a.formData.tenantCode),c("disabled",a.editingTenant()!==null),o(),h(a.getCodeErrorMessage()?20:21),o(5),_(a.getNameErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"),C("ngModel",a.formData.tenantName),o(),h(a.getNameErrorMessage()?26:-1),o(4),_(a.getBusinessNameErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"),C("ngModel",a.formData.businessName),o(),h(a.getBusinessNameErrorMessage()?31:32),o(5),c("disabled",!a.canSave()),o(),F(" ",a.editingTenant()?"Guardar Cambios":"Crear Proveedor"," ")}}var ue=(()=>{let d=class d{constructor(n){this.typificationService=n,this.tenants=v([]),this.filteredTenants=v([]),this.loading=v(!0),this.showDialog=v(!1),this.editingTenant=v(null),this.searchTerm="",this.formData={tenantCode:"",tenantName:"",businessName:""}}ngOnInit(){this.loadTenants()}loadTenants(){this.loading.set(!0),this.typificationService.getAllTenants().subscribe({next:n=>{this.tenants.set(n),this.filteredTenants.set(n),this.loading.set(!1)},error:n=>{console.error("Error loading tenants:",n),this.loading.set(!1)}})}filterTenants(){let n=this.searchTerm.toLowerCase();if(!n){this.filteredTenants.set(this.tenants());return}let i=this.tenants().filter(r=>r.tenantCode.toLowerCase().includes(n)||r.tenantName.toLowerCase().includes(n)||r.businessName&&r.businessName.toLowerCase().includes(n));this.filteredTenants.set(i)}getActiveTenants(){return this.tenants().filter(n=>n.isActive).length}getInactiveTenants(){return this.tenants().filter(n=>!n.isActive).length}openCreateDialog(){this.editingTenant.set(null),this.formData={tenantCode:"",tenantName:"",businessName:""},this.showDialog.set(!0)}editTenant(n){this.editingTenant.set(n),this.formData={tenantCode:n.tenantCode,tenantName:n.tenantName,businessName:n.businessName||""},this.showDialog.set(!0)}closeDialog(){this.showDialog.set(!1),this.editingTenant.set(null)}canSave(){return!(!this.formData.tenantCode.trim()||!this.formData.tenantName.trim()||this.getCodeErrorMessage()||this.getNameErrorMessage()||this.getBusinessNameErrorMessage())}getCodeErrorMessage(){return this.formData.tenantCode.trim()&&!this.editingTenant()&&this.tenants().some(i=>i.tenantCode.toLowerCase()===this.formData.tenantCode.trim().toLowerCase())?"Este c\xF3digo ya est\xE1 en uso":""}getNameErrorMessage(){if(!this.formData.tenantName.trim())return"";let n=this.editingTenant();return this.tenants().some(r=>(!n||r.id!==n.id)&&r.tenantName.toLowerCase()===this.formData.tenantName.trim().toLowerCase())?"Este nombre ya est\xE1 en uso":""}getBusinessNameErrorMessage(){if(!this.formData.businessName?.trim())return"";let n=this.editingTenant();return this.tenants().some(r=>(!n||r.id!==n.id)&&r.businessName&&r.businessName.toLowerCase()===this.formData.businessName.trim().toLowerCase())?"Esta raz\xF3n social ya est\xE1 en uso":""}saveTenant(){if(!this.canSave())return;let n=this.editingTenant();n?this.typificationService.updateTenant(n.id,this.formData).subscribe({next:()=>{this.loadTenants(),this.closeDialog()},error:i=>{console.error("Error updating tenant:",i),alert("Error al actualizar el proveedor")}}):this.typificationService.createTenant(this.formData).subscribe({next:()=>{this.loadTenants(),this.closeDialog()},error:i=>{console.error("Error creating tenant:",i),alert("Error al crear el proveedor. Verifique que el c\xF3digo no est\xE9 duplicado.")}})}toggleTenantStatus(n){let i=!n.isActive;confirm(`\xBFEst\xE1 seguro de ${i?"activar":"desactivar"} el proveedor "${n.tenantName}"?`)&&this.typificationService.updateTenant(n.id,N(S({},n),{isActive:i})).subscribe({next:()=>{this.loadTenants()},error:E=>{console.error("Error updating tenant status:",E),alert("Error al cambiar el estado del proveedor")}})}deleteTenant(n){if(n.hasPortfolios){alert("No se puede eliminar este proveedor porque tiene carteras asociadas.");return}confirm(`\xBFEst\xE1 seguro de eliminar el proveedor "${n.tenantName}"? Esta acci\xF3n no se puede deshacer.`)&&this.typificationService.deleteTenant(n.id).subscribe({next:()=>{this.loadTenants(),alert("Proveedor eliminado exitosamente")},error:i=>{console.error("Error deleting tenant:",i),alert("Error al eliminar el proveedor")}})}};d.\u0275fac=function(i){return new(i||d)(D(G))},d.\u0275cmp=k({type:d,selectors:[["app-tenant-maintenance"]],decls:56,vars:12,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","p-6"],[1,"max-w-7xl","mx-auto","mb-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-2","mb-2"],[1,"w-8","h-8","bg-cyan-600","rounded-lg","flex","items-center","justify-center"],["name","building-2",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-gray-400"],[1,"flex","items-center","gap-2","px-5","py-2.5","bg-gradient-to-r","from-blue-600","to-blue-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","hover:scale-105","cursor-pointer",3,"click"],["name","plus",3,"size"],[1,"max-w-7xl","mx-auto","mb-6","grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"bg-slate-900","rounded-xl","p-5","shadow-sm","border","border-slate-800"],[1,"text-sm","text-gray-400","mb-1"],[1,"text-3xl","font-bold","text-white"],[1,"w-12","h-12","bg-blue-900/30","rounded-lg","flex","items-center","justify-center"],["name","building-2",1,"text-blue-400",3,"size"],[1,"text-3xl","font-bold","text-green-400"],[1,"w-12","h-12","bg-green-900/30","rounded-lg","flex","items-center","justify-center"],["name","check-circle",1,"text-green-400",3,"size"],[1,"text-3xl","font-bold","text-gray-500"],[1,"w-12","h-12","bg-slate-800","rounded-lg","flex","items-center","justify-center"],["name","x-circle",1,"text-gray-500",3,"size"],[1,"bg-slate-900","rounded-xl","p-4","shadow-sm","border","border-slate-800"],[1,"flex","items-center","gap-4"],[1,"flex-1","relative"],["name","search",1,"absolute","left-3","top-1/2","-translate-y-1/2","text-gray-500",3,"size"],["type","text","placeholder","Buscar por c\xF3digo, nombre o raz\xF3n social...",1,"w-full","pl-12","pr-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"max-w-7xl","mx-auto"],[1,"bg-slate-900","rounded-xl","shadow-sm","border","border-slate-800","overflow-hidden"],[1,"p-12","text-center"],[1,"overflow-x-auto"],[1,"fixed","inset-0","bg-black/80","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"inline-block","w-8","h-8","border-4","border-blue-500","border-t-transparent","rounded-full","animate-spin"],[1,"mt-4","text-gray-400"],[1,"w-16","h-16","bg-slate-800","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],["name","building-2",1,"text-gray-600",3,"size"],[1,"text-gray-300","mb-2"],[1,"text-sm","text-gray-500"],[1,"w-full"],[1,"bg-slate-800","border-b","border-slate-700"],[1,"px-6","py-3","text-left","text-xs","font-semibold","text-gray-400","uppercase","tracking-wider"],[1,"divide-y","divide-slate-800"],[1,"hover:bg-slate-800","transition-colors"],[1,"px-6","py-3"],[1,"font-mono","text-sm","font-semibold","text-white"],[1,"font-medium","text-white"],[1,"text-sm","text-gray-400"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-slate-700","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-blue-800","rounded-full","peer","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-blue-600"],[1,"flex","items-center","gap-3"],["title","Editar",1,"text-blue-400","hover:text-blue-500","transition-colors","cursor-pointer",3,"click"],["name","edit",3,"size"],[1,"transition-colors","disabled:opacity-50",3,"click","disabled","title"],["name","trash-2",3,"size"],[1,"bg-slate-900","rounded-xl","shadow-2xl","max-w-2xl","w-full","max-h-[90vh]","overflow-hidden","border","border-slate-800"],[1,"bg-gradient-to-r","from-blue-600","to-blue-700","p-5","text-white"],[1,"w-10","h-10","bg-white/20","rounded-lg","flex","items-center","justify-center"],["name","building-2",3,"size"],[1,"text-xl","font-bold"],[1,"text-blue-100","text-sm"],[1,"text-white/80","hover:text-white",3,"click"],["name","x",3,"size"],[1,"p-6","overflow-y-auto","max-h-[calc(90vh-200px)]"],[1,"space-y-4"],[1,"block","text-sm","font-semibold","text-gray-300","mb-2"],["type","text","maxlength","3","placeholder","Ej: F01, ABC",3,"ngModelChange","ngModel","disabled"],[1,"text-xs","text-red-400","mt-1","font-semibold"],[1,"text-xs","text-gray-500","mt-1"],["type","text","placeholder","Ej: Financiera XYZ",3,"ngModelChange","ngModel"],["type","text","placeholder","Ej: Financiera XYZ S.A.C.",3,"ngModelChange","ngModel"],[1,"border-t","border-slate-800","p-4","flex","justify-end","gap-3","bg-slate-950"],[1,"px-5","py-2","text-gray-400","hover:bg-slate-800","hover:text-white","rounded-lg","font-medium","transition-colors",3,"click"],[1,"px-5","py-2","bg-gradient-to-r","from-blue-600","to-blue-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(i,r){i&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"div",4),u(6,"lucide-angular",5),e(),t(7,"div")(8,"h1",6),s(9,"Proveedores"),e(),t(10,"p",7),s(11,"Gesti\xF3n de proveedores de telefon\xEDa"),e()()()(),t(12,"button",8),f("click",function(){return r.openCreateDialog()}),u(13,"lucide-angular",9),t(14,"span"),s(15,"Nuevo Proveedor"),e()()()(),t(16,"div",10)(17,"div",11)(18,"div",2)(19,"div")(20,"p",12),s(21,"Total Proveedores"),e(),t(22,"p",13),s(23),e()(),t(24,"div",14),u(25,"lucide-angular",15),e()()(),t(26,"div",11)(27,"div",2)(28,"div")(29,"p",12),s(30,"Activos"),e(),t(31,"p",16),s(32),e()(),t(33,"div",17),u(34,"lucide-angular",18),e()()(),t(35,"div",11)(36,"div",2)(37,"div")(38,"p",12),s(39,"Inactivos"),e(),t(40,"p",19),s(41),e()(),t(42,"div",20),u(43,"lucide-angular",21),e()()()(),t(44,"div",1)(45,"div",22)(46,"div",23)(47,"div",24),u(48,"lucide-angular",25),t(49,"input",26),y("ngModelChange",function(T){return w(r.searchTerm,T)||(r.searchTerm=T),T}),f("ngModelChange",function(){return r.filterTenants()}),e()()()()(),t(50,"div",27)(51,"div",28),b(52,X,4,0,"div",29)(53,O,8,2,"div",29)(54,J,17,0,"div",30),e()(),b(55,te,38,18,"div",31),e()),i&2&&(o(6),c("size",16),o(7),c("size",18),o(10),p(r.tenants().length),o(2),c("size",24),o(7),p(r.getActiveTenants()),o(2),c("size",24),o(7),p(r.getInactiveTenants()),o(2),c("size",24),o(5),c("size",20),o(),C("ngModel",r.searchTerm),o(3),h(r.loading()?52:r.filteredTenants().length===0?53:54),o(3),h(r.showDialog()?55:-1))},dependencies:[A,q,P,j,B,W,L,I],encapsulation:2});let l=d;return l})();export{ue as TenantMaintenanceComponent};
