import{a as T}from"./chunk-PX4P7MZL.js";import{a as l,b as N,c as L}from"./chunk-F4ESQKJH.js";import{a as I}from"./chunk-KAKL3FYD.js";import{c as A}from"./chunk-IW4UZOVV.js";import"./chunk-UXRZVQCL.js";import{pc as E,qc as w}from"./chunk-3IYT5ASU.js";import"./chunk-YQKVMPSG.js";import"./chunk-72Z2NTOL.js";import{Kb as g,Lb as o,Mb as a,Nb as M,Ub as P,Wb as u,Yb as h,ab as s,cd as k,dd as v,gb as b,hc as O,ic as x,kc as i,lc as p,ld as y,ma as m,mc as S,na as _,nb as f,sb as C}from"./chunk-BDAG5FYU.js";function D(r,d){r&1&&(o(0,"div",10),M(1,"div",11),o(2,"p"),i(3,"Cargando estado..."),a()())}function z(r,d){if(r&1){let e=P();o(0,"div",12)(1,"p"),i(2),a(),o(3,"button",13),u("click",function(){m(e);let n=h();return _(n.loadAgentStatus((n.currentStatus==null?null:n.currentStatus.idUsuario)||0))}),i(4," Reintentar "),a()()}if(r&2){let e=h();s(2),p(e.error)}}function U(r,d){if(r&1){let e=P();o(0,"button",29),u("click",function(){let n=m(e).$implicit,c=h(2);return _(c.changeStatus(n))}),M(1,"div",30),o(2,"span"),i(3),a()()}if(r&2){let e=d.$implicit,t=h(2);O("border-color",t.getStateColor(e)),x("active",t.isCurrentState(e))("disabled",!t.canChangeToState(e)||t.loading),g("disabled",!t.canChangeToState(e)||t.loading),s(),O("background-color",t.getStateColor(e)),s(2),p(t.stateLabels[e])}}function F(r,d){r&1&&(o(0,"p",31),i(1," Est\xE1s en modo manual. Ve al softphone para hacer llamadas. "),a())}function V(r,d){if(r&1){let e=P();o(0,"div",14)(1,"div",15)(2,"div",16)(3,"h2"),i(4,"Estado Actual"),a(),o(5,"div",17)(6,"div",18),i(7),a()()()(),o(8,"div",19)(9,"div",20)(10,"h2"),i(11,"Cambiar Estado"),a(),o(12,"p",21),i(13,"Selecciona tu estado actual"),a(),o(14,"div",22),C(15,U,4,10,"button",23),a()(),o(16,"div",24)(17,"h2"),i(18,"Llamadas Manuales"),a(),o(19,"p",21),i(20,"Inicia el modo manual para realizar llamadas"),a(),o(21,"button",25),u("click",function(){m(e);let n=h();return _(n.enterManualMode())}),o(22,"span",26),M(23,"lucide-angular",27),a(),o(24,"span"),i(25,"LLAMAR MANUAL"),a()(),C(26,F,2,0,"p",28),a()()()}if(r&2){let e=h();s(6),O("background-color",e.getStateColor(e.currentStatus.estadoActual)),s(),S(" ",e.stateLabels[e.currentStatus.estadoActual]," "),s(8),g("ngForOf",e.manualStates),s(6),g("disabled",e.loading||e.currentStatus.estadoActual===e.AgentState.EN_LLAMADA||e.currentStatus.estadoActual===e.AgentState.TIPIFICANDO),s(2),g("size",20),s(3),g("ngIf",e.currentStatus.estadoActual===e.AgentState.EN_MANUAL)}}var Q=(()=>{let d=class d{constructor(t,n,c){this.agentStatusService=t,this.authService=n,this.router=c,this.currentStatus=null,this.agentName="",this.loading=!1,this.error=null,this.AgentState=l,this.stateLabels=N,this.manualStates=L}ngOnInit(){let t=this.authService.getCurrentUser();if(!t){this.router.navigate(["/login"]);return}this.agentName=t.firstName+" "+t.lastName||t.username,this.loadAgentStatus(t.id),this.statusSubscription=this.agentStatusService.startStatusPolling(t.id).subscribe()}ngOnDestroy(){this.statusSubscription&&this.statusSubscription.unsubscribe()}loadAgentStatus(t){this.loading=!0,this.error=null,this.agentStatusService.getAgentStatus(t).subscribe({next:n=>{this.currentStatus={idUsuario:n.idUsuario,estadoActual:n.estadoActual,estadoAnterior:n.estadoAnterior,timestampCambio:n.timestampCambio,tiempoEnEstadoMinutos:n.tiempoEnEstadoMinutos,notas:n.notas,sessionId:n.sessionId},this.loading=!1},error:n=>{console.error("Error loading agent status:",n),this.error="Error al cargar el estado del agente",this.loading=!1}}),this.agentStatusService.currentStatus$.subscribe(n=>{n&&(this.currentStatus=n)})}changeStatus(t){!this.currentStatus||this.loading||(this.loading=!0,this.error=null,this.agentStatusService.changeStatus(this.currentStatus.idUsuario,{estado:t,notas:`Cambio manual a ${this.stateLabels[t]}`}).subscribe({next:()=>{this.loading=!1},error:n=>{console.error("Error changing status:",n),this.error="Error al cambiar el estado",this.loading=!1}}))}enterManualMode(){!this.currentStatus||this.loading||(this.loading=!0,this.error=null,this.agentStatusService.enterManualMode(this.currentStatus.idUsuario).subscribe({next:()=>{this.loading=!1,this.router.navigate(["/dialer"])},error:t=>{console.error("Error entering manual mode:",t),this.error="Error al entrar en modo manual",this.loading=!1}}))}getStateColor(t){return{[l.DISPONIBLE]:"#4caf50",[l.EN_REUNION]:"#ff9800",[l.REFRIGERIO]:"#2196f3",[l.SSHH]:"#9c27b0",[l.EN_LLAMADA]:"#f44336",[l.TIPIFICANDO]:"#ff5722",[l.EN_MANUAL]:"#607d8b"}[t]||"#757575"}isCurrentState(t){return this.currentStatus?.estadoActual===t}canChangeToState(t){return this.currentStatus?.estadoActual===l.EN_LLAMADA||this.currentStatus?.estadoActual===l.TIPIFICANDO?!1:this.manualStates.includes(t)}logout(){this.authService.logout(),this.router.navigate(["/login"])}};d.\u0275fac=function(n){return new(n||d)(b(T),b(I),b(A))},d.\u0275cmp=f({type:d,selectors:[["app-agent-status-dashboard"]],decls:15,vars:4,consts:[[1,"dashboard-container"],[1,"dashboard-header"],[1,"header-content"],[1,"agent-info"],[1,"agent-name"],[1,"logout-btn",3,"click"],[1,"dashboard-main"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","status-dashboard",4,"ngIf"],[1,"loading-state"],[1,"spinner"],[1,"error-state"],[3,"click"],[1,"status-dashboard"],[1,"status-card"],[1,"status-card-content"],[1,"current-status"],[1,"status-badge"],[1,"action-cards"],[1,"change-status-section"],[1,"section-subtitle"],[1,"status-buttons"],["class","status-btn",3,"active","disabled","border-color","click",4,"ngFor","ngForOf"],[1,"manual-calling-section"],[1,"manual-call-btn",3,"click","disabled"],[1,"btn-icon"],["name","phone-call",3,"size"],["class","manual-call-note",4,"ngIf"],[1,"status-btn",3,"click","disabled"],[1,"status-btn-icon"],[1,"manual-call-note"]],template:function(n,c){n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),i(4,"Panel de Asesor"),a(),o(5,"div",3)(6,"span",4),i(7),a(),o(8,"button",5),u("click",function(){return c.logout()}),o(9,"span"),i(10,"Cerrar Sesi\xF3n"),a()()()()(),o(11,"div",6),C(12,D,4,0,"div",7)(13,z,5,1,"div",8)(14,V,27,7,"div",9),a()()),n&2&&(s(7),p(c.agentName),s(5),g("ngIf",c.loading&&!c.currentStatus),s(),g("ngIf",c.error),s(),g("ngIf",c.currentStatus&&!c.loading))},dependencies:[y,k,v,w,E],styles:[".dashboard-container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(to bottom right,#0f172a,#1e293b,#0f172a);display:flex;flex-direction:column}.dashboard-header[_ngcontent-%COMP%]{background:#1e293b;border-bottom:1px solid #334155;box-shadow:0 2px 10px #0000004d;padding:.8rem 1.5rem}.header-content[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.3rem;color:#fff;font-weight:600}.agent-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.agent-name[_ngcontent-%COMP%]{font-size:1rem;color:#94a3b8;font-weight:500}.logout-btn[_ngcontent-%COMP%]{display:none;background:#ef4444;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:6px;cursor:pointer;font-size:.9rem;font-weight:500;transition:background .3s}.logout-btn[_ngcontent-%COMP%]:hover{background:#dc2626}.dashboard-main[_ngcontent-%COMP%]{flex:1;padding:1rem;max-width:1400px;width:100%;margin:0 auto}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;color:#94a3b8}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid #334155;border-top-color:#10b981;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-state[_ngcontent-%COMP%]{background:#ef444426;color:#ef4444;padding:2rem;border-radius:8px;border:1px solid rgba(239,68,68,.3);text-align:center}.error-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem;background:#10b981;color:#fff;border:none;padding:.6rem 1.5rem;border-radius:6px;cursor:pointer;font-weight:500;transition:background .3s}.error-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#059669}.status-dashboard[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem;max-width:900px;margin:0 auto}.action-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem}.status-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e293b,#0f172a);border:1px solid #334155;border-radius:12px;padding:1.5rem 2rem;box-shadow:0 8px 32px #0000004d;text-align:center}.status-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.status-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:.95rem;color:#94a3b8;text-transform:uppercase;letter-spacing:1.5px;font-weight:500}.current-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.75rem 2.5rem;border-radius:50px;color:#fff;font-size:1.2rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;box-shadow:0 6px 20px #00000040;animation:_ngcontent-%COMP%_statusPulse 3s ease-in-out infinite}@keyframes _ngcontent-%COMP%_statusPulse{0%,to{transform:scale(1)}50%{transform:scale(1.02)}}.change-status-section[_ngcontent-%COMP%]{background:#1e293b;border:1px solid #334155;border-radius:12px;padding:1.25rem;box-shadow:0 4px 20px #00000040;display:flex;flex-direction:column;height:100%}.change-status-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:1rem;color:#fff;font-weight:600}.section-subtitle[_ngcontent-%COMP%]{margin:0 0 1rem;color:#64748b;font-size:.8rem}.status-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:.6rem;flex:1}.status-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem;background:#0a0e27;border:2px solid #334155;padding:.65rem .9rem;border-radius:10px;cursor:pointer;font-size:.85rem;font-weight:500;color:#94a3b8;transition:all .25s ease}.status-btn[_ngcontent-%COMP%]:hover:not(.disabled){transform:translateY(-2px);box-shadow:0 4px 12px #10b98133;background:#10b9811a;color:#10b981}.status-btn.active[_ngcontent-%COMP%]{border-width:2px;background:#10b98126;color:#10b981;box-shadow:0 4px 15px #10b9814d}.status-btn.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.status-btn-icon[_ngcontent-%COMP%]{width:18px;height:18px;border-radius:50%;flex-shrink:0}.manual-calling-section[_ngcontent-%COMP%]{background:#1e293b;border:1px solid #334155;border-radius:12px;padding:1.25rem;box-shadow:0 4px 20px #00000040;display:flex;flex-direction:column}.manual-calling-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:1rem;color:#fff;font-weight:600}.manual-call-btn[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;gap:.6rem;background:linear-gradient(135deg,#10b981,#059669);color:#fff;border:none;padding:1rem 1.5rem;border-radius:10px;cursor:pointer;font-size:.95rem;font-weight:600;margin-top:auto;transition:all .25s ease}.manual-call-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px #10b98166}.manual-call-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;transform:none}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center}.manual-call-note[_ngcontent-%COMP%]{margin-top:.75rem;padding:.75rem 1rem;background:#10b9811a;border-left:3px solid #10B981;border-radius:6px;color:#10b981;font-weight:500;font-size:.85rem}@media (max-width: 768px){.status-dashboard[_ngcontent-%COMP%]{gap:1rem}.action-cards[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.dashboard-header[_ngcontent-%COMP%]{padding:1rem}.header-content[_ngcontent-%COMP%]{flex-direction:column;gap:.75rem;text-align:center}.dashboard-main[_ngcontent-%COMP%]{padding:1rem}.status-buttons[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}.status-badge[_ngcontent-%COMP%]{font-size:1.1rem;padding:.7rem 2rem}.status-card[_ngcontent-%COMP%]{padding:1.25rem 1.5rem}}@media (max-width: 480px){.status-buttons[_ngcontent-%COMP%]{grid-template-columns:1fr}.status-badge[_ngcontent-%COMP%]{font-size:1rem;padding:.6rem 1.5rem}}body.light-theme[_nghost-%COMP%]   .dashboard-container[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .dashboard-container[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .dashboard-container[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .dashboard-container[_ngcontent-%COMP%]{background:linear-gradient(to bottom right,#f8fafc,#f1f5f9,#f8fafc)}body.light-theme[_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid #e2e8f0;box-shadow:0 2px 10px #0000000f}body.light-theme[_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#0f172a}body.light-theme[_nghost-%COMP%]   .agent-name[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .agent-name[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .agent-name[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .agent-name[_ngcontent-%COMP%]{color:#475569}body.light-theme[_nghost-%COMP%]   .status-card[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .status-card[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .status-card[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .status-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff,#f8fafc);border:1px solid #e2e8f0;box-shadow:0 4px 20px #0000000f}body.light-theme[_nghost-%COMP%]   .change-status-section[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .change-status-section[_ngcontent-%COMP%], body.light-theme[_nghost-%COMP%]   .manual-calling-section[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .manual-calling-section[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .change-status-section[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .change-status-section[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .manual-calling-section[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .manual-calling-section[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;box-shadow:0 4px 20px #0000000f}body.light-theme[_nghost-%COMP%]   .status-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .status-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .status-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .status-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#64748b}body.light-theme[_nghost-%COMP%]   .change-status-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .change-status-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], body.light-theme[_nghost-%COMP%]   .manual-calling-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .manual-calling-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .change-status-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .change-status-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .manual-calling-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .manual-calling-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#0f172a}body.light-theme[_nghost-%COMP%]   .section-subtitle[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .section-subtitle[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .section-subtitle[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .section-subtitle[_ngcontent-%COMP%]{color:#94a3b8}body.light-theme[_nghost-%COMP%]   .status-btn[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .status-btn[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .status-btn[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .status-btn[_ngcontent-%COMP%]{background:#f8fafc;border:2px solid #e2e8f0;color:#475569}body.light-theme[_nghost-%COMP%]   .status-btn[_ngcontent-%COMP%]:hover:not(.disabled), body.light-theme   [_nghost-%COMP%]   .status-btn[_ngcontent-%COMP%]:hover:not(.disabled), html:not(.dark)[_nghost-%COMP%]   .status-btn[_ngcontent-%COMP%]:hover:not(.disabled), html:not(.dark)   [_nghost-%COMP%]   .status-btn[_ngcontent-%COMP%]:hover:not(.disabled){background:#10b98114;color:#059669;box-shadow:0 4px 12px #10b9811f}body.light-theme[_nghost-%COMP%]   .status-btn.active[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .status-btn.active[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .status-btn.active[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .status-btn.active[_ngcontent-%COMP%]{background:#10b9811f;color:#059669;box-shadow:0 4px 15px #10b98126}body.light-theme[_nghost-%COMP%]   .manual-call-note[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .manual-call-note[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .manual-call-note[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .manual-call-note[_ngcontent-%COMP%]{background:#10b98114;color:#059669}body.light-theme[_nghost-%COMP%]   .loading-state[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .loading-state[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .loading-state[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .loading-state[_ngcontent-%COMP%]{color:#64748b}body.light-theme[_nghost-%COMP%]   .spinner[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .spinner[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .spinner[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .spinner[_ngcontent-%COMP%]{border:4px solid #e2e8f0;border-top-color:#10b981}body.light-theme[_nghost-%COMP%]   .error-state[_ngcontent-%COMP%], body.light-theme   [_nghost-%COMP%]   .error-state[_ngcontent-%COMP%], html:not(.dark)[_nghost-%COMP%]   .error-state[_ngcontent-%COMP%], html:not(.dark)   [_nghost-%COMP%]   .error-state[_ngcontent-%COMP%]{background:#ef444414;border:1px solid rgba(239,68,68,.15)}"]});let r=d;return r})();export{Q as AgentStatusDashboardComponent};
