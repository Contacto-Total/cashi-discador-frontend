import{a as be,b as ve,c as G}from"./chunk-4F4PQCC5.js";import{a as _e}from"./chunk-TATL7MOR.js";import{a as xe}from"./chunk-QEFW7LKZ.js";import{a as he}from"./chunk-VVSSGT66.js";import{E as ge,f as ce,k as me,s as pe,t as ue,u as fe}from"./chunk-2YC26MZ7.js";import{pc as de,qc as se}from"./chunk-YLTLMO6P.js";import"./chunk-YQKVMPSG.js";import"./chunk-LYMJIISJ.js";import{Eb as re,Fb as N,Gb as I,Hb as Z,Jb as L,Kb as P,Lb as g,Mb as n,Nb as a,Ob as _,Vb as Q,Xb as W,Zb as y,bb as r,g as J,hb as K,jc as ae,lc as d,mc as j,md as le,na as U,nc as z,oa as q,ob as oe,oc as Y,qc as ee,rc as te,sc as ie,xa as T}from"./chunk-BMTIWWAP.js";var X=(t,c)=>c.id,Ee=(t,c)=>c.rowIndex;function De(t,c){t&1&&(n(0,"div",0),_(1,"div",20),n(2,"div",21)(3,"div",22)(4,"div",23),_(5,"div",24)(6,"div",25),a(),n(7,"div",26)(8,"h3",27),d(9,"Importando datos..."),a(),n(10,"p",28),d(11,"Por favor espere, este proceso puede tardar varios minutos dependiendo de la cantidad de registros."),a()(),n(12,"div",29),_(13,"div",30),a(),n(14,"p",31),d(15,"No cierre esta ventana"),a()()()())}function we(t,c){if(t&1&&(n(0,"option",14),d(1),a()),t&2){let i=c.$implicit;g("value",i.id),r(),Y("",i.tenantCode," - ",i.tenantName)}}function Ne(t,c){if(t&1&&(n(0,"option",14),d(1),a()),t&2){let i=c.$implicit;g("value",i.id),r(),Y("",i.portfolioCode," - ",i.portfolioName)}}function Ie(t,c){if(t&1&&(n(0,"option",14),d(1),a()),t&2){let i=c.$implicit;g("value",i.id),r(),Y("",i.subPortfolioCode," - ",i.subPortfolioName)}}function Te(t,c){if(t&1&&(n(0,"div",47)(1,"div",44)(2,"span",31),d(3,"Total:"),a(),n(4,"span",56),d(5),a()(),n(6,"div",44),_(7,"lucide-angular",57),n(8,"span",58),d(9),a()(),n(10,"div",44),_(11,"lucide-angular",59),n(12,"span",60),d(13),a()()()),t&2){let i=y(2);r(5),j(i.importedData().length),r(2),g("size",12),r(2),j(i.validData().length),r(2),g("size",12),r(2),j(i.invalidData().length)}}function Le(t,c){if(t&1&&(n(0,"span",31),d(1),a()),t&2){let i=y(2);r(),z("",i.previewHeaders().length," columnas")}}function Pe(t,c){t&1&&(n(0,"th",52),d(1,"Estado"),a())}function Me(t,c){if(t&1&&_(0,"lucide-angular",62),t&2){let i=y().$implicit;g("size",12)("title","Campo transformado desde: "+i.sourceField)}}function Fe(t,c){if(t&1&&(n(0,"th",53)(1,"div",61),N(2,Me,1,2,"lucide-angular",62),n(3,"div",63)(4,"span",64),d(5),a(),n(6,"span",65),d(7),a()()()()),t&2){let i=c.$implicit;g("title",i.dataType+(i.format?" ("+i.format+")":"")),r(2),I(i.sourceField&&i.regexPattern?2:-1),r(3),j(i.headerName),r(2),Y("",i.dataType,"",i.format?" ("+i.format+")":"")}}function ke(t,c){if(t&1&&(n(0,"tr",54)(1,"td",66)(2,"div",67),_(3,"lucide-angular",68),n(4,"span",69),d(5,"No hay datos. Importa un archivo Excel para ver los datos aqu\xED."),a()()()()),t&2){let i=y(2);r(),re("colspan",i.previewHeaders().length+1),r(2),g("size",24)}}function $e(t,c){if(t&1&&(n(0,"td",77),d(1),a()),t&2){let i=c.$implicit,e=y().$implicit;ae("text-gray-500",!e[i.headerName]),r(),z(" ",e[i.headerName]||"NULL"," ")}}function ze(t,c){if(t&1&&(n(0,"tr",70)(1,"td",72),d(2),a(),n(3,"td",73)(4,"span",74),_(5,"lucide-angular",75),d(6," V\xE1lido "),a()(),L(7,$e,2,3,"td",76,X),a()),t&2){let i=c.$index,e=y(3);r(2),j(i+1),r(3),g("size",10),r(2),P(e.previewHeaders())}}function He(t,c){if(t&1&&(n(0,"td",77),d(1),a()),t&2){let i=c.$implicit,e=y().$implicit;ae("text-gray-500",!e.data[i.headerName]),r(),z(" ",e.data[i.headerName]||"NULL"," ")}}function Ae(t,c){if(t&1&&(n(0,"tr",71)(1,"td",72),d(2),a(),n(3,"td",73)(4,"span",78),_(5,"lucide-angular",79),d(6," Error "),a()(),L(7,He,2,3,"td",76,X),a()),t&2){let i=c.$implicit,e=c.$index,o=y(3);r(2),j(o.validData().length+e+1),r(2),g("title",i.error),r(),g("size",10),r(2),P(o.previewHeaders())}}function Ve(t,c){if(t&1&&(L(0,ze,9,2,"tr",70,Z),L(2,Ae,9,3,"tr",71,Z)),t&2){let i=y(2);P(i.validData()),r(2),P(i.invalidData())}}function Be(t,c){if(t&1&&(n(0,"div",95),d(1),a()),t&2){let i=c.$implicit;r(),z(" ",i," ")}}function We(t,c){if(t&1&&(n(0,"div",80)(1,"div",89),_(2,"lucide-angular",90),n(3,"div",91)(4,"h3",92),d(5,"Errores al Importar Datos"),a(),n(6,"p",93),d(7," La importaci\xF3n fall\xF3 debido a los siguientes errores. No se insert\xF3 ning\xFAn dato. "),a(),n(8,"div",94),L(9,Be,2,1,"div",95,Z),a()()()()),t&2){let i=y(3);r(2),g("size",24),r(7),P(i.backendErrors())}}function Oe(t,c){if(t&1&&(n(0,"span",102),d(1),a()),t&2){let i=c.$implicit;r(),z(" Fila ",i.rowIndex," ")}}function Re(t,c){if(t&1&&(n(0,"div",81)(1,"div",89),_(2,"lucide-angular",96),n(3,"div",91)(4,"h3",97),d(5),a(),n(6,"p",98),d(7," Los siguientes registros tienen el campo DOCUMENTO vac\xEDo o nulo: "),a(),n(8,"p",99),d(9," Estos registros no ser\xE1n sincronizados a la tabla de clientes. "),a(),n(10,"div",100)(11,"div",101),L(12,Oe,2,1,"span",102,Ee),a()()()()()),t&2){let i=y(3);r(2),g("size",20),r(3),z(" Registros sin DOCUMENTO (",i.recordsWithNullDocumento().length,") "),r(7),P(i.recordsWithNullDocumento())}}function je(t,c){if(t&1&&(n(0,"p",84)(1,"span",85),d(2),a(),d(3),a()),t&2){let i=c.$implicit,e=c.$index,o=y(4);r(2),z("Fila ",o.validData().length+e+1,":"),r(),z(" ",i.error," ")}}function Xe(t,c){if(t&1&&(n(0,"div",82)(1,"div",89),_(2,"lucide-angular",103),n(3,"div",91)(4,"h3",104),d(5,"Registros con Errores"),a(),n(6,"div",105),L(7,je,4,2,"p",84,Z),a()()()()),t&2){let i=y(3);r(2),g("size",20),r(5),P(i.invalidData())}}function Ue(t,c){t&1&&(n(0,"span",85),d(1,"La importaci\xF3n fall\xF3. Corrija los errores e intente nuevamente."),a())}function qe(t,c){if(t&1&&(n(0,"span",106),d(1),a(),d(2," listo(s) para importar ")),t&2){let i=y(3);r(),z("",i.validData().length," registro(s)")}}function Ze(t,c){t&1&&(n(0,"span",85),d(1,"No hay registros v\xE1lidos para importar"),a())}function Ye(t,c){if(t&1){let i=Q();n(0,"button",107),W("click",function(){U(i);let o=y(3);return q(o.confirmImport())}),d(1," Confirmar Importaci\xF3n "),a()}}function Ge(t,c){if(t&1){let i=Q();n(0,"div",55),N(1,We,11,1,"div",80),N(2,Re,14,2,"div",81),N(3,Xe,9,1,"div",82),n(4,"div",83)(5,"div",84),N(6,Ue,2,0,"span",85)(7,qe,3,1)(8,Ze,2,0,"span",85),a(),n(9,"div",86)(10,"button",87),W("click",function(){U(i);let o=y(2);return q(o.clearImportedData())}),d(11," Cancelar "),a(),N(12,Ye,2,0,"button",88),a()()()}if(t&2){let i=y(2);r(),I(i.backendErrors().length>0?1:-1),r(),I(i.recordsWithNullDocumento().length>0?2:-1),r(),I(i.invalidData().length>0?3:-1),r(3),I(i.backendErrors().length>0?6:i.validData().length>0?7:8),r(6),I(i.validData().length>0&&i.backendErrors().length===0?12:-1)}}function Je(t,c){if(t&1){let i=Q();n(0,"div",18)(1,"div",32)(2,"div")(3,"h2",33),d(4,"Importaci\xF3n de Datos"),a(),n(5,"p",34),d(6," Sube un archivo Excel con los datos para esta subcartera "),a()(),n(7,"div",35)(8,"button",36),W("click",function(){U(i);let o=y();return q(o.downloadDataTemplate())}),_(9,"lucide-angular",37),n(10,"span"),d(11,"Descargar Plantilla"),a()(),n(12,"label",38),_(13,"lucide-angular",39),n(14,"span"),d(15,"Importar Datos"),a(),n(16,"input",40),W("change",function(o){U(i);let s=y();return q(s.onDataFileSelected(o))}),a()()()(),n(17,"div",41)(18,"div",42)(19,"div",43)(20,"div",44),_(21,"lucide-angular",45),n(22,"span",46),d(23," Tabla de Datos "),a()(),N(24,Te,14,5,"div",47)(25,Le,2,1,"span",31),a()(),n(26,"div",48)(27,"table",49)(28,"thead",50)(29,"tr")(30,"th",51),d(31,"#"),a(),N(32,Pe,2,0,"th",52),L(33,Fe,8,5,"th",53,X),a()(),n(35,"tbody"),N(36,ke,6,2,"tr",54)(37,Ve,4,0),a()()()(),N(38,Ge,13,5,"div",55),a()}if(t&2){let i=y();r(9),g("size",16),r(4),g("size",16),r(8),g("size",16),r(3),I(i.importedData().length>0?24:25),r(8),I(i.importedData().length>0?32:-1),r(),P(i.previewHeaders()),r(3),I(i.importedData().length===0?36:37),r(2),I(i.importedData().length>0?38:-1)}}function Ke(t,c){t&1&&(n(0,"div",19)(1,"div",89),_(2,"lucide-angular",108),n(3,"div")(4,"h3",109),d(5,"No hay cabeceras configuradas"),a(),n(6,"p",28),d(7," Primero debes configurar las cabeceras para esta subcartera en el m\xF3dulo de Mantenimiento. "),a()()()()),t&2&&(r(2),g("size",20))}var mt=(()=>{let c=class c{constructor(e,o,s){this.tenantService=e,this.portfolioService=o,this.headerConfigService=s,this.tenants=T([]),this.portfolios=T([]),this.subPortfolios=T([]),this.selectedTenantId=0,this.selectedPortfolioId=0,this.selectedSubPortfolioId=0,this.previewHeaders=T([]),this.headersAreSaved=T(!1),this.importedData=T([]),this.validData=T([]),this.invalidData=T([]),this.backendErrors=T([]),this.isLoading=T(!1),this.recordsWithNullDocumento=T([])}ngOnInit(){this.loadTenants()}loadTenants(){this.tenantService.getAllTenants().subscribe({next:e=>{this.tenants.set(e)},error:e=>{console.error("Error cargando proveedores:",e),alert("Error al cargar los proveedores")}})}onTenantChange(e){this.selectedTenantId=e,this.selectedPortfolioId=0,this.selectedSubPortfolioId=0,this.portfolios.set([]),this.subPortfolios.set([]),this.previewHeaders.set([]),this.headersAreSaved.set(!1),e>0&&this.loadPortfoliosByTenant(e)}loadPortfoliosByTenant(e){this.portfolioService.getPortfoliosByTenant(e).subscribe({next:o=>{this.portfolios.set(o)},error:o=>{console.error("Error cargando carteras:",o),alert("Error al cargar las carteras")}})}onPortfolioChange(e){this.selectedPortfolioId=e,this.selectedSubPortfolioId=0,this.subPortfolios.set([]),this.previewHeaders.set([]),this.headersAreSaved.set(!1),e>0&&this.loadSubPortfoliosByPortfolio(e)}loadSubPortfoliosByPortfolio(e){this.portfolioService.getSubPortfoliosByPortfolio(e).subscribe({next:o=>{this.subPortfolios.set(o)},error:o=>{console.error("Error cargando subcarteras:",o),alert("Error al cargar las subcarteras")}})}onSubPortfolioChange(e){e>0?this.loadHeadersForSubPortfolio(e):(this.previewHeaders.set([]),this.headersAreSaved.set(!1))}loadHeadersForSubPortfolio(e){this.headerConfigService.getBySubPortfolioAndLoadType(e,"ACTUALIZACION").subscribe({next:o=>{this.previewHeaders.set(o),this.headersAreSaved.set(o.length>0)},error:o=>{console.error("Error cargando cabeceras:",o),this.previewHeaders.set([]),this.headersAreSaved.set(!1)}})}downloadDataTemplate(){return J(this,null,function*(){if(this.previewHeaders().length===0){alert("No hay cabeceras configuradas para generar la plantilla de datos");return}let e=this.previewHeaders().map(p=>p.headerName),o=G.book_new(),s=G.aoa_to_sheet([e]);s["!cols"]=e.map(p=>({wch:Math.max(p.length+2,15)})),G.book_append_sheet(o,s,"Datos");let l=`plantilla-datos-${this.subPortfolios().find(p=>p.id===this.selectedSubPortfolioId)?.subPortfolioCode||"subcartera"}.xlsx`;ve(o,l),alert("Plantilla de datos descargada exitosamente.")})}onDataFileSelected(e){return J(this,null,function*(){let o=e.target.files[0];if(!o)return;if(o.name.toLowerCase().endsWith(".csv")){this.parseCSVFile(o),e.target.value="";return}let l=new FileReader;l.onload=p=>J(this,null,function*(){try{let S=new Uint8Array(p.target.result),w=be(S,{type:"array"}),b=w.Sheets[w.SheetNames[0]],F=G.sheet_to_json(b,{header:1});if(F.length===0){alert("El archivo Excel est\xE1 vac\xEDo");return}let B=F[0].map(m=>String(m).toLowerCase()),k=this.previewHeaders(),H={},A=[];if(k.forEach((m,$)=>{let h=B.findIndex(u=>u===m.headerName.toLowerCase());h!==-1?H[h]=$:m.sourceField&&m.regexPattern||A.push(m)}),A.length>0){let m=A.map(h=>h.headerName).join(", ");if(!confirm(`\u26A0\uFE0F ADVERTENCIA: Faltan las siguientes columnas en el archivo Excel:

${m}

Estas columnas se guardar\xE1n como NULL.

\xBFDesea continuar con la importaci\xF3n?`))return}let O=F.slice(1);if(O.length===0){alert("El archivo Excel no contiene datos (solo cabeceras)");return}let x=[],M=[];O.forEach((m,$)=>{let h={},u="";k.forEach((f,v)=>{let V=Object.keys(H).find(E=>H[parseInt(E)]===v);if(V!==void 0){let E=m[parseInt(V)];if(E!=null&&String(E).trim()!=="")try{if(f.dataType==="FECHA"&&typeof E=="number"){let ye=new Date(1899,11,30).getTime()+E*24*60*60*1e3,Ce=new Date(ye),Se=f.format||"dd/MM/yyyy";h[f.headerName]=this.formatDateByPattern(Ce,Se)}else if(f.dataType==="FECHA"&&E instanceof Date){let ne=f.format||"dd/MM/yyyy";h[f.headerName]=this.formatDateByPattern(E,ne)}else h[f.headerName]=String(E).trim()}catch{u=`Error procesando columna ${f.headerName}`,h[f.headerName]=String(E)}else h[f.headerName]=null}else h[f.headerName]=null}),k.forEach(f=>{if(f.sourceField&&f.regexPattern)try{let v=h[f.sourceField];if(v){let V=new RegExp(f.regexPattern),E=String(v).match(V);E?h[f.headerName]=E[1]||E[0]:h[f.headerName]=null}else h[f.headerName]=null}catch(v){console.error(`Error aplicando regex en ${f.headerName}:`,v),h[f.headerName]=null}}),Object.values(h).some(f=>f!==null&&f!=="")?u?M.push({error:u,data:h}):x.push(h):M.push({error:"Fila vac\xEDa - no contiene datos",data:h})});let D=[];x.forEach((m,$)=>{let h=m.DOCUMENTO||m.documento||m.Documento;(h==null||String(h).trim()==="")&&D.push({rowIndex:$+1,data:m})}),this.importedData.set([...x,...M.map(m=>m.data)]),this.validData.set(x),this.invalidData.set(M),this.recordsWithNullDocumento.set(D),console.log("Previsualizaci\xF3n de datos:",{total:O.length,v\u00E1lidos:x.length,inv\u00E1lidos:M.length,sinDocumento:D.length})}catch(S){console.error("Error procesando el archivo:",S),alert("Error al procesar el archivo Excel")}}),l.readAsArrayBuffer(o),e.target.value=""})}parseCSVFile(e){let o=new FileReader;o.onload=s=>{try{let l=s.target.result.split(`
`).map(x=>x.trim()).filter(x=>x.length>0);if(l.length===0){alert("El archivo CSV est\xE1 vac\xEDo");return}let p=l[0],S=";";p.includes(";")?S=";":p.includes(",")?S=",":p.includes("|")?S="|":p.includes("	")&&(S="	");let w=l[0].split(S).map(x=>x.trim().toLowerCase()),b=this.previewHeaders(),F={},B=[];if(b.forEach((x,M)=>{let D=w.findIndex(m=>m===x.headerName.toLowerCase());D!==-1?F[D]=M:x.sourceField&&x.regexPattern||B.push(x)}),B.length>0){let x=B.map(D=>D.headerName).join(", ");if(!confirm(`\u26A0\uFE0F ADVERTENCIA: Faltan las siguientes columnas en el archivo CSV:

${x}

Estas columnas se guardar\xE1n como NULL.

\xBFDesea continuar con la importaci\xF3n?`))return}let k=l.slice(1);if(k.length===0){alert("El archivo CSV no contiene datos (solo cabeceras)");return}let H=[],A=[];k.forEach((x,M)=>{let D=x.split(S).map(u=>u.trim()),m={},$="";b.forEach((u,R)=>{let f=Object.keys(F).find(v=>F[parseInt(v)]===R);if(f!==void 0){let v=D[parseInt(f)];if(v!=null&&v!=="")try{if(u.dataType==="FECHA"){let V=this.parseCSVDate(v,u.format||"dd/MM/yyyy");V?m[u.headerName]=V:($=`Valor no es fecha v\xE1lida para campo ${u.headerName}: ${v} (formato esperado: ${u.format||"dd/MM/yyyy"})`,m[u.headerName]=v)}else m[u.headerName]=v}catch(V){$=`Error procesando columna ${u.headerName}: ${V}`,m[u.headerName]=v}else m[u.headerName]=null}else m[u.headerName]=null}),b.forEach(u=>{if(u.sourceField&&u.regexPattern)try{let R=m[u.sourceField];if(R){let f=new RegExp(u.regexPattern),v=String(R).match(f);v?m[u.headerName]=v[1]||v[0]:m[u.headerName]=null}else m[u.headerName]=null}catch(R){console.error(`Error aplicando regex en ${u.headerName}:`,R),m[u.headerName]=null}}),Object.values(m).some(u=>u!==null&&u!=="")?$?A.push({error:$,data:m}):H.push(m):A.push({error:"Fila vac\xEDa - no contiene datos",data:m})});let O=[];H.forEach((x,M)=>{let D=x.DOCUMENTO||x.documento||x.Documento;(D==null||String(D).trim()==="")&&O.push({rowIndex:M+1,data:x})}),this.importedData.set([...H,...A.map(x=>x.data)]),this.validData.set(H),this.invalidData.set(A),this.recordsWithNullDocumento.set(O),console.log("Previsualizaci\xF3n de datos CSV:",{total:k.length,v\u00E1lidos:H.length,inv\u00E1lidos:A.length,sinDocumento:O.length})}catch(C){console.error("Error procesando el archivo CSV:",C),alert("Error al procesar el archivo CSV")}},o.readAsText(e)}parseCSVDate(e,o){try{let s=o.replace(/dd/g,"\\d{2}").replace(/MM/g,"\\d{2}").replace(/yyyy/g,"\\d{4}").replace(/yy/g,"\\d{2}").replace(/HH/g,"\\d{2}").replace(/mm/g,"\\d{2}").replace(/ss/g,"\\d{2}");if(new RegExp("^"+s+"$").test(e.trim()))return e.trim();let l=e.split(/[-\/\s:]/);if(l.length<3)return null;let p,S,w,b=0,F=0,B=0;if(o.startsWith("dd")?(p=parseInt(l[0]),S=parseInt(l[1]),w=parseInt(l[2])):o.startsWith("MM")?(S=parseInt(l[0]),p=parseInt(l[1]),w=parseInt(l[2])):(w=parseInt(l[0]),S=parseInt(l[1]),p=parseInt(l[2])),l.length>3&&(b=parseInt(l[3])||0,F=parseInt(l[4])||0,B=parseInt(l[5])||0),isNaN(p)||isNaN(S)||isNaN(w)||p<1||p>31||S<1||S>12||w<1900)return null;let k=new Date(w,S-1,p,b,F,B);return isNaN(k.getTime())?null:this.formatDateByPattern(k,o)}catch(s){return console.error("Error parseando fecha:",s),null}}formatDateByPattern(e,o){let s=e.getFullYear(),C=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0"),p=String(e.getHours()).padStart(2,"0"),S=String(e.getMinutes()).padStart(2,"0"),w=String(e.getSeconds()).padStart(2,"0"),b=o;return b=b.replace(/yyyy/g,String(s)),b=b.replace(/yy/g,String(s).slice(-2)),b=b.replace(/MM/g,C),b=b.replace(/dd/g,l),b=b.replace(/HH/g,p),b=b.replace(/mm/g,S),b=b.replace(/ss/g,w),b}simplifyBackendError(e){let o=e.match(/Fila (\d+):/),s=o?o[1]:"?";if(e.includes("doesn't have a default value")){let l=e.match(/Field '([^']+)'/),p=l?l[1]:"desconocido";return`Fila ${s}: El campo '${p}' est\xE1 vac\xEDo pero es obligatorio. Por favor, proporcione un valor.`}if(e.includes("cannot be null")||e.includes("Column")&&e.includes("cannot be null")){let l=e.match(/Column '([^']+)'/)||e.match(/Field '([^']+)'/),p=l?l[1]:"desconocido";return`Fila ${s}: El campo '${p}' no puede estar vac\xEDo. Es un campo obligatorio.`}if(e.includes("Data too long")||e.includes("too long for column")){let l=e.match(/column '([^']+)'/)||e.match(/Field '([^']+)'/),p=l?l[1]:"desconocido";return`Fila ${s}: El valor del campo '${p}' es demasiado largo. Reduzca el tama\xF1o del texto.`}if(e.includes("Incorrect date")||e.includes("Incorrect datetime")){let l=e.match(/column '([^']+)'/)||e.match(/Field '([^']+)'/),p=l?l[1]:"desconocido";return`Fila ${s}: El campo '${p}' tiene un formato de fecha incorrecto. Verifique el formato.`}if(e.includes("Duplicate entry")){let l=e.match(/Duplicate entry '([^']+)'/),p=l?l[1]:"desconocido";return`Fila ${s}: El valor '${p}' ya existe en la base de datos. No se permiten duplicados.`}if(e.includes("Incorrect integer")||e.includes("Incorrect decimal")){let l=e.match(/column '([^']+)'/)||e.match(/Field '([^']+)'/),p=l?l[1]:"desconocido";return`Fila ${s}: El campo '${p}' debe contener un n\xFAmero v\xE1lido.`}if(e.includes("foreign key constraint fails")||e.includes("Cannot add or update a child row"))return`Fila ${s}: Hay una referencia a un dato que no existe en el sistema. Verifique los datos relacionados.`;let C=e.match(/Fila \d+: Error al insertar datos: (.+?)(?:\s*;|$)/);return C?`Fila ${s}: ${C[1]}`:e.length>200?e.substring(0,200)+"...":e}clearImportedData(){this.importedData.set([]),this.validData.set([]),this.invalidData.set([]),this.backendErrors.set([]),this.recordsWithNullDocumento.set([])}confirmImport(){let e=this.validData();if(e.length===0){alert("No hay datos v\xE1lidos para importar");return}console.log("Datos transformados listos para importar:",e),console.log("Subcartera ID:",this.selectedSubPortfolioId),this.isLoading.set(!0),this.backendErrors.set([]),this.headerConfigService.importData(this.selectedSubPortfolioId,"ACTUALIZACION",e).subscribe({next:o=>{if(this.isLoading.set(!1),console.log("Respuesta del servidor:",o),o.errors&&o.errors.length>0){let s=o.errors.map(C=>this.simplifyBackendError(C));this.backendErrors.set(s),console.error("Errores del backend:",o.errors)}else alert(`\u2705 Se importaron ${o.insertedRows||e.length} filas de datos exitosamente a la tabla din\xE1mica.`),this.clearImportedData()},error:o=>{if(this.isLoading.set(!1),console.error("Error HTTP al importar datos:",o),o.error?.errors&&Array.isArray(o.error.errors)){let s=o.error.errors.map(C=>this.simplifyBackendError(C));this.backendErrors.set(s)}else this.backendErrors.set([`Error de conexi\xF3n: ${o.error?.message||o.message}`])}})}};c.\u0275fac=function(o){return new(o||c)(K(xe),K(he),K(_e))},c.\u0275cmp=oe({type:c,selectors:[["app-daily-load"]],decls:43,vars:14,consts:[[1,"fixed","inset-0","z-50","flex","items-center","justify-center"],[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","p-6"],[1,"max-w-7xl","mx-auto"],[1,"mb-8"],[1,"flex","items-center","gap-2","mb-2"],[1,"w-8","h-8","bg-orange-600","rounded-lg","flex","items-center","justify-center"],["name","calendar",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-gray-400"],[1,"bg-slate-900","rounded-lg","p-3","shadow-sm","border","border-slate-800","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-3"],[1,"block","text-xs","font-semibold","text-gray-300","mb-1.5"],["name","building-2",1,"inline","mr-1",3,"size"],[1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white","text-sm","focus:outline-none","focus:ring-2","focus:ring-green-500",3,"ngModelChange","ngModel"],[3,"value"],["name","folder",1,"inline","mr-1",3,"size"],[1,"w-full","px-3","py-2","bg-slate-800","border","border-slate-700","rounded-lg","text-white","text-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],["name","folder-tree",1,"inline","mr-1",3,"size"],[1,"bg-slate-800","border","border-slate-700","rounded-xl","p-6"],[1,"bg-yellow-900/20","border","border-yellow-700/50","rounded-xl","p-6"],[1,"absolute","inset-0","bg-black/60","backdrop-blur-sm"],[1,"relative","bg-slate-800","rounded-2xl","p-8","shadow-2xl","border","border-slate-700","max-w-md","w-full","mx-4"],[1,"flex","flex-col","items-center","gap-6"],[1,"relative"],[1,"w-16","h-16","border-4","border-slate-600","rounded-full"],[1,"absolute","top-0","left-0","w-16","h-16","border-4","border-green-500","rounded-full","border-t-transparent","animate-spin"],[1,"text-center"],[1,"text-xl","font-bold","text-white","mb-2"],[1,"text-gray-400","text-sm"],[1,"w-full","bg-slate-700","rounded-full","h-2","overflow-hidden"],[1,"bg-gradient-to-r","from-green-500","to-emerald-400","h-full","rounded-full","animate-pulse",2,"width","100%"],[1,"text-xs","text-gray-500"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-4","mb-4"],[1,"text-xl","font-bold","text-white"],[1,"text-gray-400","text-sm","mt-1"],[1,"flex","flex-col","sm:flex-row","gap-2"],[1,"flex","items-center","gap-2","px-4","py-2","bg-purple-600","text-white","rounded-lg","hover:bg-purple-700","transition-all","font-medium","text-sm","cursor-pointer",3,"click"],["name","file-text",3,"size"],[1,"flex","items-center","gap-2","px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-all","font-medium","cursor-pointer","text-sm"],["name","folder-open",3,"size"],["type","file","accept",".xlsx,.xls,.csv",1,"hidden",3,"change"],[1,"bg-slate-900","border","border-slate-700","rounded-lg","overflow-hidden"],[1,"px-4","py-2","bg-slate-800","border-b","border-slate-700"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-2"],["name","table",1,"text-green-400",3,"size"],[1,"text-sm","font-semibold","text-gray-300"],[1,"flex","items-center","gap-4"],[1,"overflow-auto",2,"max-height","500px"],[1,"w-full","text-xs","border-collapse"],[1,"bg-slate-800","sticky","top-0","z-10"],[1,"px-3","py-2","text-left","font-semibold","text-gray-300","border-r","border-slate-700","bg-slate-800",2,"min-width","50px"],[1,"px-3","py-2","text-left","font-semibold","text-gray-300","border-r","border-slate-700","bg-slate-800",2,"min-width","80px"],[1,"px-3","py-2","text-left","font-semibold","text-gray-300","border-r","border-slate-700","bg-slate-800",2,"min-width","150px",3,"title"],[1,"border-b","border-slate-700"],[1,"space-y-4","mt-4"],[1,"text-xs","font-bold","text-white"],["name","check-circle",1,"text-green-400",3,"size"],[1,"text-xs","font-bold","text-green-400"],["name","x-circle",1,"text-red-400",3,"size"],[1,"text-xs","font-bold","text-red-400"],[1,"flex","items-center","gap-1.5"],["name","sparkles",1,"text-amber-400","flex-shrink-0",3,"size","title"],[1,"flex","flex-col","gap-0.5"],[1,"font-semibold"],[1,"text-[10px]","text-green-400","font-normal"],[1,"px-3","py-8","text-center","text-gray-500","bg-slate-800/30"],[1,"flex","flex-col","items-center","gap-2"],["name","inbox",1,"text-gray-600",3,"size"],[1,"text-sm"],[1,"border-b","border-slate-700","hover:bg-slate-800/50"],[1,"border-b","border-slate-700","hover:bg-slate-800/50","bg-red-900/10"],[1,"px-3","py-2","text-gray-400","border-r","border-slate-700","bg-slate-800/30"],[1,"px-3","py-2","border-r","border-slate-700"],[1,"inline-flex","items-center","gap-1","px-2","py-0.5","bg-green-900/30","text-green-400","rounded","text-[10px]"],["name","check",3,"size"],[1,"px-3","py-2","text-gray-300","border-r","border-slate-700",3,"text-gray-500"],[1,"px-3","py-2","text-gray-300","border-r","border-slate-700"],[1,"inline-flex","items-center","gap-1","px-2","py-0.5","bg-red-900/30","text-red-400","rounded","text-[10px]",3,"title"],["name","x",3,"size"],[1,"bg-red-900/30","border-2","border-red-700","rounded-xl","p-4"],[1,"bg-amber-50","dark:bg-amber-900/20","border","border-amber-200","dark:border-amber-700/50","rounded-lg","p-4"],[1,"bg-red-900/20","border","border-red-700/50","rounded-lg","p-4"],[1,"flex","justify-between","items-center"],[1,"text-sm","text-gray-400"],[1,"text-red-400"],[1,"flex","gap-3"],[1,"px-4","py-2","bg-slate-700","text-white","rounded-lg","hover:bg-slate-600","transition-all","font-medium","text-sm",3,"click"],[1,"px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-all","font-medium","text-sm"],[1,"flex","items-start","gap-3"],["name","x-circle",1,"text-red-500","flex-shrink-0","mt-1",3,"size"],[1,"flex-1"],[1,"text-red-500","font-bold","text-lg","mb-2"],[1,"text-red-300","text-sm","mb-3"],[1,"bg-red-950/50","rounded-lg","p-3","max-h-60","overflow-y-auto"],[1,"text-red-200","text-xs","font-mono","mb-2","pb-2","border-b","border-red-800/50","last:border-0"],["name","alert-triangle",1,"text-amber-600","dark:text-amber-400","mt-0.5",3,"size"],[1,"text-amber-700","dark:text-amber-400","font-semibold","mb-2"],[1,"text-amber-600","dark:text-gray-400","text-sm","mb-1"],[1,"text-amber-700","dark:text-amber-300","text-sm","font-medium","mb-2"],[1,"bg-amber-100","dark:bg-amber-950/30","rounded-lg","p-3","max-h-40","overflow-y-auto"],[1,"flex","flex-wrap","gap-2"],[1,"inline-flex","items-center","px-2","py-1","bg-amber-200","dark:bg-amber-800/40","text-amber-800","dark:text-amber-300","rounded","text-xs","font-mono"],["name","alert-circle",1,"text-red-400","mt-0.5",3,"size"],[1,"text-red-400","font-semibold","mb-2"],[1,"space-y-1"],[1,"text-green-400"],[1,"px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-all","font-medium","text-sm",3,"click"],["name","alert-circle",1,"text-yellow-500","mt-0.5",3,"size"],[1,"text-yellow-500","font-semibold","mb-1"]],template:function(o,s){o&1&&(N(0,De,16,0,"div",0),n(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),_(6,"lucide-angular",6),a(),n(7,"div")(8,"h1",7),d(9,"Carga Diaria"),a(),n(10,"p",8),d(11,"Importaci\xF3n diaria de actualizaciones"),a()()()(),n(12,"div",9)(13,"div",10)(14,"div")(15,"label",11),_(16,"lucide-angular",12),d(17," Proveedor "),a(),n(18,"select",13),ie("ngModelChange",function(l){return te(s.selectedTenantId,l)||(s.selectedTenantId=l),l}),W("ngModelChange",function(l){return s.onTenantChange(l)}),n(19,"option",14),d(20,"Seleccione un proveedor..."),a(),L(21,we,2,3,"option",14,X),a()(),n(23,"div")(24,"label",11),_(25,"lucide-angular",15),d(26," Cartera "),a(),n(27,"select",16),ie("ngModelChange",function(l){return te(s.selectedPortfolioId,l)||(s.selectedPortfolioId=l),l}),W("ngModelChange",function(l){return s.onPortfolioChange(l)}),n(28,"option",14),d(29,"Seleccione una cartera..."),a(),L(30,Ne,2,3,"option",14,X),a()(),n(32,"div")(33,"label",11),_(34,"lucide-angular",17),d(35," Subcartera "),a(),n(36,"select",16),ie("ngModelChange",function(l){return te(s.selectedSubPortfolioId,l)||(s.selectedSubPortfolioId=l),l}),W("ngModelChange",function(l){return s.onSubPortfolioChange(l)}),n(37,"option",14),d(38,"Seleccione una subcartera..."),a(),L(39,Ie,2,3,"option",14,X),a()()()(),N(41,Je,39,7,"div",18)(42,Ke,8,1,"div",19),a()()),o&2&&(I(s.isLoading()?0:-1),r(6),g("size",16),r(10),g("size",16),r(2),ee("ngModel",s.selectedTenantId),r(),g("value",0),r(2),P(s.tenants()),r(4),g("size",16),r(2),ee("ngModel",s.selectedPortfolioId),g("disabled",s.selectedTenantId===0),r(),g("value",0),r(2),P(s.portfolios()),r(4),g("size",16),r(2),ee("ngModel",s.selectedSubPortfolioId),g("disabled",s.selectedPortfolioId===0),r(),g("value",0),r(2),P(s.subPortfolios()),r(2),I(s.selectedSubPortfolioId>0&&s.headersAreSaved()?41:s.selectedSubPortfolioId>0&&!s.headersAreSaved()?42:-1))},dependencies:[le,ge,ue,fe,pe,ce,me,se,de],styles:["[_nghost-%COMP%]{display:block}"]});let t=c;return t})();export{mt as DailyLoadComponent};
