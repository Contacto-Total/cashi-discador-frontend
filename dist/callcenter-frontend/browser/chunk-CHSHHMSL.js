import{a as ie,b as re}from"./chunk-QQITVTSN.js";import{E as te,c as K,d as k,e as Q,f as W,g as R,i as _,k as X,n as Y,q as Z,z as ee}from"./chunk-5CXVSPU7.js";import{ob as y,pb as v}from"./chunk-7OAV6HC2.js";import{a as J}from"./chunk-CVSECBKN.js";import{$a as a,I,Kb as c,Lb as o,Mb as i,Nb as m,T as L,Ub as $,Wb as g,Yb as f,a as G,b as N,ba as V,cd as H,dd as w,fa as j,fb as b,ic as A,jd as x,kc as l,lc as p,ma as T,mb as h,mc as E,na as O,pd as q,rb as u,rd as U,s as S,ub as z}from"./chunk-3MKZGHO3.js";function me(r,n){r&1&&(o(0,"tr")(1,"td",10)(2,"div",11),m(3,"lucide-angular",12),o(4,"span",13),l(5,"No hay registros en la blacklist"),i()()()()),r&2&&(a(3),c("size",48))}function pe(r,n){if(r&1&&(o(0,"tr",14)(1,"td",15),l(2),i(),o(3,"td",16),l(4),i(),o(5,"td",15),l(6),i(),o(7,"td",15),l(8),i(),o(9,"td",15),l(10),i(),o(11,"td",15),l(12),i()()),r&2){let d=n.$implicit;a(2),p(d.empresa),a(2),p(d.documento),a(2),p(d.email||"-"),a(2),p(d.telefono||"-"),a(2),p(d.fechaInicio),a(2),p(d.fechaFin)}}function ue(r,n){if(r&1){let d=$();o(0,"div",17)(1,"button",18),g("click",function(){T(d);let t=f();return O(t.previousPage())}),m(2,"lucide-angular",19),l(3," Anterior "),i(),o(4,"span",20),l(5," P\xE1gina "),o(6,"span",21),l(7),i(),l(8," de "),o(9,"span",21),l(10),i()(),o(11,"button",18),g("click",function(){T(d);let t=f();return O(t.nextPage())}),l(12," Siguiente "),m(13,"lucide-angular",22),i()()}if(r&2){let d=f();a(),c("disabled",d.currentPage===1),a(),c("size",16),a(5),p(d.currentPage),a(3),p(d.totalPages),a(),c("disabled",d.currentPage===d.totalPages),a(2),c("size",16)}}var ne=(()=>{let n=class n{constructor(){this.blacklistRows=[],this.currentPage=1,this.rowsPerPage=10}get paginatedRows(){let e=(this.currentPage-1)*this.rowsPerPage;return this.blacklistRows.slice(e,e+this.rowsPerPage)}get totalPages(){return Math.ceil(this.blacklistRows.length/this.rowsPerPage)}goToPage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}previousPage(){this.currentPage>1&&this.currentPage--}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=h({type:n,selectors:[["app-blacklist-table"]],inputs:{blacklistRows:"blacklistRows"},decls:22,vars:3,consts:[[1,"space-y-3"],[1,"overflow-hidden","rounded-lg","border","border-slate-700","bg-slate-900"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-slate-800","border-b","border-slate-700"],[1,"px-4","py-3","text-left","text-xs","font-semibold","text-slate-300","uppercase","tracking-wider"],[1,"divide-y","divide-slate-700"],[4,"ngIf"],["class","hover:bg-slate-800/50 transition-colors",4,"ngFor","ngForOf"],["class","flex items-center justify-between px-2",4,"ngIf"],["colspan","6",1,"px-4","py-12","text-center"],[1,"flex","flex-col","items-center","gap-2","text-slate-500"],["name","inbox",3,"size"],[1,"text-sm"],[1,"hover:bg-slate-800/50","transition-colors"],[1,"px-4","py-3","text-sm","text-slate-200"],[1,"px-4","py-3","text-sm","text-slate-200","font-mono"],[1,"flex","items-center","justify-between","px-2"],[1,"inline-flex","items-center","gap-1.5","px-3","py-2","bg-slate-800","hover:bg-slate-700","text-slate-300","text-sm","rounded","border","border-slate-600","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"click","disabled"],["name","chevron-left",3,"size"],[1,"text-sm","text-slate-400"],[1,"font-semibold","text-slate-200"],["name","chevron-right",3,"size"]],template:function(t,s){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead",4)(5,"tr")(6,"th",5),l(7,"Empresa"),i(),o(8,"th",5),l(9,"Documento"),i(),o(10,"th",5),l(11,"Email"),i(),o(12,"th",5),l(13,"Tel\xE9fono"),i(),o(14,"th",5),l(15,"Fecha Inicio"),i(),o(16,"th",5),l(17,"Fecha Fin"),i()()(),o(18,"tbody",6),u(19,me,6,1,"tr",7)(20,pe,13,6,"tr",8),i()()()(),u(21,ue,14,6,"div",9),i()),t&2&&(a(19),c("ngIf",s.blacklistRows.length===0),a(),c("ngForOf",s.paginatedRows),a(),c("ngIf",s.blacklistRows.length>0))},dependencies:[x,H,w,v,y],encapsulation:2});let r=n;return r})();var C=(()=>{let n=class n{constructor(e){this.http=e,this.baseUrl=J.webServiceUrl+"/blacklist",this.templateCanEdit=!1,this.httpOptions={headers:new q({"Content-Type":"application/json"})}}handleError(e){let t="Ocurri\xF3 un error desconocido.";return typeof e.error=="string"?t=e.error:e.error&&e.error.message&&(t=e.error.message),console.error(`C\xF3digo de error: ${e.status}, mensaje: ${t}`),S(()=>({status:e.status,message:t}))}handleErrorGet(e){return typeof ErrorEvent<"u"&&e.error instanceof ErrorEvent?console.log(`An error occurred ${e.status}, body was: ${e.error.message}`):console.log(`Backend returned code ${e.status}, body was: ${e.error.message}`),S(()=>({status:e.status,message:e.error.message}))}insertBlacklist(e){return this.http.post(this.baseUrl,e,N(G({},this.httpOptions),{responseType:"text"})).pipe(I(this.handleError))}getAllBlacklist(){return this.http.get(this.baseUrl+"/all",this.httpOptions).pipe(L(2),I(this.handleErrorGet))}};n.\u0275fac=function(t){return new(t||n)(j(U))},n.\u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();function fe(r,n){if(r&1&&(o(0,"span",13),l(1),i()),r&2){let d=f();a(),E(" ",d.getFieldError("selectedProveedor")," ")}}function ge(r,n){if(r&1&&(o(0,"span",13),l(1),i()),r&2){let d=f();a(),E(" ",d.getFieldError("documento")," ")}}function he(r,n){if(r&1&&(o(0,"span",13),l(1),i()),r&2){let d=f();a(),E(" ",d.getFieldError("fechaFin")," ")}}function xe(r,n){r&1&&(o(0,"span"),l(1,"Agregar"),i())}function ve(r,n){r&1&&(o(0,"span"),l(1,"Guardando..."),i())}var ae=(()=>{let n=class n{constructor(e,t){this.blacklistService=e,this.toastService=t,this.blacklistAdded=new z,this.formGroup=new R({}),this.proveedores=[],this.isLoading=!1}ngOnInit(){this.initializeForm(),this.loadProveedores()}initializeForm(){this.formGroup=new R({selectedProveedor:new _(null,k.required),documento:new _("",[k.required,k.pattern(/^\d+$/)]),fechaFin:new _("",[k.required,this.validateFutureDate.bind(this)])})}loadProveedores(){this.proveedores=[{label:"FINANCIERA OH",value:"FINANCIERA_OH"},{label:"PROVEEDOR",value:"PROVEEDOR"}]}validateFutureDate(e){if(!e.value)return null;let t=new Date(e.value),s=new Date;return s.setHours(0,0,0,0),t<s?{fechaInvalida:!0}:null}insertarBlacklist(){if(!this.formGroup.valid){this.formGroup.markAllAsTouched(),this.toastService.error("Por favor completa todos los campos requeridos");return}let e=this.formGroup.value.selectedProveedor,{cartera:t,subcartera:s,entidad:P}=this.mapProveedorToConfig(e),M=new Date(this.formGroup.value.fechaFin).toISOString().split("T")[0],D=this.formGroup.value.documento,le={empresa:e,cartera:t,subcartera:s,documento:D,fechaFin:M,entidad:P};this.isLoading=!0,this.blacklistService.insertBlacklist(le).subscribe({next:()=>{let F=new Date().toISOString().split("T")[0];this.toastService.success(`Cliente DNI: ${D} agregado a Blacklist (${F} - ${M})`),this.formGroup.reset(),this.blacklistAdded.emit(),this.isLoading=!1},error:F=>{let se=F?.message||"Error al agregar a la blacklist";this.toastService.error(se),this.isLoading=!1}})}mapProveedorToConfig(e){return e==="FINANCIERA_OH"?{cartera:"FO_TRAMO 5",subcartera:"FO_TRAMO_5",entidad:"FUNO"}:{cartera:"PROVEEDOR",subcartera:"PROVEEDOR",entidad:"PROVEEDOR"}}getFieldError(e){let t=this.formGroup.get(e);if(t?.errors&&(t?.touched||t?.dirty)){if(t.errors.required)return"Este campo es requerido";if(t.errors.pattern)return"Solo se permiten n\xFAmeros";if(t.errors.fechaInvalida)return"La fecha debe ser igual o mayor a hoy"}return""}isFieldInvalid(e){let t=this.formGroup.get(e);return!!(t?.invalid&&(t?.touched||t?.dirty))}};n.\u0275fac=function(t){return new(t||n)(b(C),b(re))},n.\u0275cmp=h({type:n,selectors:[["app-add-to-blacklist-form"]],outputs:{blacklistAdded:"blacklistAdded"},decls:21,vars:12,consts:[[1,"space-y-3",3,"formGroup"],[1,"flex","gap-3","items-start"],[1,"flex-1"],["for","proveedor",1,"block","text-xs","text-slate-400","mb-1.5"],["formControlName","selectedProveedor","placeholder","Selecciona un proveedor","id","proveedor",3,"options"],["class","text-xs text-red-400 mt-1 block",4,"ngIf"],["for","documento",1,"block","text-xs","text-slate-400","mb-1.5"],["type","text","id","documento","formControlName","documento","placeholder","Ingresa el documento","maxlength","20",1,"w-full","h-10","px-3","bg-slate-900","border","border-slate-700","rounded","text-slate-100","text-sm","placeholder:text-slate-500","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["for","fechaFin",1,"block","text-xs","text-slate-400","mb-1.5"],["type","date","id","fechaFin","formControlName","fechaFin",1,"w-full","h-10","px-3","bg-slate-900","border","border-slate-700","rounded","text-slate-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],[1,"pt-6"],["type","button",1,"h-10","inline-flex","items-center","gap-1.5","px-4","bg-gradient-to-r","from-red-600","to-red-700","hover:from-red-700","hover:to-red-800","text-white","text-sm","font-medium","rounded","transition-all","shadow-lg","hover:shadow-red-500/50","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"click","disabled"],[4,"ngIf"],[1,"text-xs","text-red-400","mt-1","block"]],template:function(t,s){t&1&&(o(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),l(4,"Proveedor *"),i(),m(5,"app-custom-select",4),u(6,fe,2,1,"span",5),i(),o(7,"div",2)(8,"label",6),l(9,"Documento *"),i(),m(10,"input",7),u(11,ge,2,1,"span",5),i(),o(12,"div",2)(13,"label",8),l(14,"Fecha de Fin *"),i(),m(15,"input",9),u(16,he,2,1,"span",5),i(),o(17,"div",10)(18,"button",11),g("click",function(){return s.insertarBlacklist()}),u(19,xe,2,0,"span",12)(20,ve,2,0,"span",12),i()()()()),t&2&&(c("formGroup",s.formGroup),a(5),c("options",s.proveedores),a(),c("ngIf",s.isFieldInvalid("selectedProveedor")),a(4),A("border-red-500",s.isFieldInvalid("documento")),a(),c("ngIf",s.isFieldInvalid("documento")),a(4),A("border-red-500",s.isFieldInvalid("fechaFin")),a(),c("ngIf",s.isFieldInvalid("fechaFin")),a(2),c("disabled",!s.formGroup.valid||s.isLoading),a(),c("ngIf",!s.isLoading),a(),c("ngIf",s.isLoading))},dependencies:[x,w,te,X,K,Q,W,ee,Y,Z,ie,v],styles:[".form[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:15px;align-items:center}.form-group[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.fecha-container[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column}.fecha-error[_ngcontent-%COMP%]{font-size:.8rem;color:#f44336;position:absolute;bottom:-35px;left:0}"]});let r=n;return r})();var je=(()=>{let n=class n{constructor(e){this.blacklistService=e,this.blacklistRows=[]}ngOnInit(){this.loadBlacklistRows()}loadBlacklistRows(){this.blacklistService.getAllBlacklist().subscribe(e=>{this.blacklistRows=e},e=>{console.error("Error al obtener la lista de blacklists",e)})}};n.\u0275fac=function(t){return new(t||n)(b(C))},n.\u0275cmp=h({type:n,selectors:[["app-blacklist-main-page"]],decls:14,vars:2,consts:[[1,"min-h-screen","bg-slate-950","p-4"],[1,"flex","items-center","gap-2","mb-3"],[1,"w-8","h-8","bg-gradient-to-br","from-red-600","to-red-700","rounded-lg","flex","items-center","justify-center"],["name","shield-ban",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-gray-400"],[1,"section"],[3,"blacklistAdded"],[1,"table-container"],[3,"blacklistRows"]],template:function(t,s){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),m(3,"lucide-angular",3),i(),o(4,"div")(5,"h1",4),l(6,"Blacklist Principal"),i(),o(7,"p",5),l(8,"Gesti\xF3n de contactos bloqueados"),i()()(),o(9,"div",6)(10,"div")(11,"app-add-to-blacklist-form",7),g("blacklistAdded",function(){return s.loadBlacklistRows()}),i()(),o(12,"div",8),m(13,"app-blacklist-table",9),i()()()),t&2&&(a(3),c("size",16),a(10),c("blacklistRows",s.blacklistRows))},dependencies:[x,v,y,ae,ne],styles:["body[_ngcontent-%COMP%]{margin-top:7rem;margin-bottom:2rem}.section[_ngcontent-%COMP%]{max-width:1350px;margin:0 auto}.table-container[_ngcontent-%COMP%]{margin-top:2.4rem}"]});let r=n;return r})();export{je as BlacklistMainPageComponent};
