import{a as F,b as D,g as J}from"./chunk-PKFBRZD7.js";import"./chunk-RIMEIBS7.js";import"./chunk-VUSOBWTB.js";import{E as Q}from"./chunk-E2JO3TS2.js";import{lc as G,mc as Z}from"./chunk-RTTQIKVQ.js";import{a as B}from"./chunk-YQKVMPSG.js";import{c as q}from"./chunk-72Z2NTOL.js";import{Eb as _,Fb as h,Hb as L,Ib as S,Jb as P,Kb as c,Lb as a,Mb as s,Nb as p,Nc as U,Ub as v,Wb as C,Yb as d,_ as N,a as k,ab as r,b as T,ba as j,fa as $,gb as V,ic as z,jc as E,kc as m,lc as M,ld as W,ma as x,mc as w,n as R,na as f,nb as A,wa as b,wb as H}from"./chunk-BDAG5FYU.js";var K=(()=>{let l=class l{constructor(e){this.http=e,this.menuItemsSubject=new R([]),this.menuItems$=this.menuItemsSubject.asObservable(),this.apiUrl=`${B.apiUrl}/menu`}loadVisibleMenu(){return this.http.get(`${this.apiUrl}/visible`).pipe(N(e=>this.menuItemsSubject.next(e)))}getMenuItems(){return this.menuItemsSubject.value}getMenuConfigForRole(e){return this.http.get(`${this.apiUrl}/config/${e}`)}getAllRolesConfig(){return this.http.get(`${this.apiUrl}/config/all`)}updateMenuConfig(e){return this.http.put(`${this.apiUrl}/config`,e)}updateMenuItemParent(e,t){return this.http.put(`${this.apiUrl}/item/${e}/parent`,{codigoPadre:t})}clearMenu(){this.menuItemsSubject.next([])}};l.\u0275fac=function(t){return new(t||l)($(q))},l.\u0275prov=j({token:l,factory:l.\u0275fac,providedIn:"root"});let i=l;return i})();var O=(i,l)=>l.codigo;function te(i,l){if(i&1){let n=v();a(0,"button",13),C("click",function(){let t=x(n).$implicit,o=d();return f(o.selectRole(t))}),m(1),s()}if(i&2){let n=l.$implicit,e=d();E(e.selectedRole()===n?"bg-indigo-600 text-white":"bg-slate-800 text-gray-300 hover:bg-slate-700"),r(),w(" ",e.roleLabels[n]," ")}}function ie(i,l){i&1&&(a(0,"div",11),p(1,"lucide-angular",14),s()),i&2&&(r(),c("size",32))}function ne(i,l){i&1&&p(0,"lucide-angular",33),i&2&&c("size",12)}function oe(i,l){i&1&&(a(0,"span",36),m(1,"dropdown"),s())}function re(i,l){if(i&1){let n=v();a(0,"button",43),C("click",function(){x(n);let t=d().$implicit,o=d(2);return f(o.openParentModal(t))}),p(1,"lucide-angular",44),s()}i&2&&(r(),c("size",14))}function ae(i,l){if(i&1){let n=v();a(0,"button",45),C("click",function(){x(n);let t=d().$implicit,o=d(2);return f(o.removeParent(t))}),p(1,"lucide-angular",46),s()}i&2&&(r(),c("size",14))}function le(i,l){if(i&1){let n=v();a(0,"div",31)(1,"div",32),_(2,ne,1,1,"lucide-angular",33),p(3,"lucide-angular",34),a(4,"span",35),m(5),s(),_(6,oe,2,0,"span",36),a(7,"span",37),m(8),s()(),a(9,"div",38),_(10,re,2,1,"button",39),_(11,ae,2,1,"button",40),a(12,"button",41),C("click",function(){let t=x(n).$implicit,o=d(2);return f(o.moveToHidden(t))}),p(13,"lucide-angular",42),s()()()}if(i&2){let n=l.$implicit,e=d(2);z("ml-6",e.isChild(n)),r(2),h(e.isChild(n)?2:-1),r(),E(e.isChild(n)?"text-indigo-300":"text-indigo-400"),c("name",n.icono)("size",16),r(),E(e.isChild(n)?"text-gray-200":"text-white font-medium"),r(),M(n.etiqueta),r(),h(n.tipo==="DROPDOWN"?6:-1),r(2),w("#",n.orden),r(2),h(n.tipo!=="DROPDOWN"?10:-1),r(),h(e.isChild(n)?11:-1),r(2),c("size",14)}}function se(i,l){i&1&&(a(0,"div",23),p(1,"lucide-angular",42),a(2,"p",47),m(3,"No hay elementos visibles"),s()()),i&2&&(r(),c("size",32))}function de(i,l){i&1&&p(0,"lucide-angular",49),i&2&&c("size",12)}function ce(i,l){i&1&&(a(0,"span",52),m(1,"dropdown"),s())}function me(i,l){if(i&1){let n=v();a(0,"button",43),C("click",function(){x(n);let t=d().$implicit,o=d(2);return f(o.openParentModal(t))}),p(1,"lucide-angular",44),s()}i&2&&(r(),c("size",14))}function ue(i,l){if(i&1){let n=v();a(0,"button",45),C("click",function(){x(n);let t=d().$implicit,o=d(2);return f(o.removeParent(t))}),p(1,"lucide-angular",46),s()}i&2&&(r(),c("size",14))}function pe(i,l){if(i&1){let n=v();a(0,"div",48)(1,"div",32),_(2,de,1,1,"lucide-angular",49),p(3,"lucide-angular",50),a(4,"span",51),m(5),s(),_(6,ce,2,0,"span",52),a(7,"span",53),m(8),s()(),a(9,"div",38),_(10,me,2,1,"button",39),_(11,ue,2,1,"button",40),a(12,"button",54),C("click",function(){let t=x(n).$implicit,o=d(2);return f(o.moveToVisible(t))}),p(13,"lucide-angular",55),s()()()}if(i&2){let n=l.$implicit,e=d(2);z("ml-6",e.isChild(n)),r(2),h(e.isChild(n)?2:-1),r(),c("name",n.icono)("size",16),r(2),M(n.etiqueta),r(),h(n.tipo==="DROPDOWN"?6:-1),r(2),w("#",n.orden),r(2),h(n.tipo!=="DROPDOWN"?10:-1),r(),h(e.isChild(n)?11:-1),r(2),c("size",14)}}function ge(i,l){i&1&&(a(0,"div",23),p(1,"lucide-angular",56),a(2,"p",47),m(3,"Todos los elementos son visibles"),s()()),i&2&&(r(),c("size",32))}function _e(i,l){i&1&&p(0,"lucide-angular",29),i&2&&c("size",16)}function he(i,l){i&1&&p(0,"lucide-angular",30),i&2&&c("size",16)}function xe(i,l){if(i&1){let n=v();a(0,"div",15)(1,"div",16)(2,"div",17),p(3,"lucide-angular",18),a(4,"h2",19),m(5,"Elementos Visibles"),s(),a(6,"span",20),m(7),s()(),a(8,"div",21),S(9,le,14,15,"div",22,O),_(11,se,4,1,"div",23),s()(),a(12,"div",16)(13,"div",17),p(14,"lucide-angular",24),a(15,"h2",19),m(16,"Elementos Ocultos"),s(),a(17,"span",20),m(18),s()(),a(19,"div",21),S(20,pe,14,11,"div",25,O),_(22,ge,4,1,"div",23),s()()(),a(23,"div",26)(24,"button",27),C("click",function(){x(n);let t=d();return f(t.cancel())}),m(25," Cancelar "),s(),a(26,"button",28),C("click",function(){x(n);let t=d();return f(t.save())}),_(27,_e,1,1,"lucide-angular",29)(28,he,1,1,"lucide-angular",30),m(29," Guardar Cambios "),s()()}if(i&2){let n=d();r(3),c("size",18),r(4),w("(",n.visibleItems().length,")"),r(2),P(n.visibleFlat()),r(2),h(n.visibleItems().length===0?11:-1),r(3),c("size",18),r(4),w("(",n.hiddenItems().length,")"),r(2),P(n.hiddenFlat()),r(2),h(n.hiddenItems().length===0?22:-1),r(2),c("disabled",!n.hasChanges()),r(2),c("disabled",!n.hasChanges()||n.saving()),r(),h(n.saving()?27:28)}}function fe(i,l){if(i&1&&(a(0,"div",65)(1,"span",20),m(2,"Padre actual:"),s(),a(3,"span",69),m(4),s()()),i&2){let n=d(),e=d(2);r(4),M(e.getParentLabel(n.codigoPadre))}}function Ce(i,l){i&1&&p(0,"lucide-angular",74),i&2&&c("size",14)}function be(i,l){if(i&1){let n=v();a(0,"button",71),C("click",function(){x(n);let t=d().$implicit,o=d(3);return f(o.assignParent(t.codigo))}),p(1,"lucide-angular",72),a(2,"span",73),m(3),s(),_(4,Ce,1,1,"lucide-angular",74),s()}if(i&2){let n=d().$implicit,e=d();E(e.codigoPadre===n.codigo?"border-indigo-500 bg-indigo-500/10":"border-slate-700"),r(),c("name",n.icono)("size",16),r(2),M(n.etiqueta),r(),h(e.codigoPadre===n.codigo?4:-1)}}function ve(i,l){if(i&1&&_(0,be,5,6,"button",70),i&2){let n=l.$implicit,e=d();h(n.codigo!==e.codigo?0:-1)}}function Ie(i,l){if(i&1){let n=v();a(0,"p",63),m(1," Selecciona el dropdown padre para: "),a(2,"span",64),m(3),s()(),_(4,fe,5,1,"div",65),a(5,"div",66)(6,"button",67),C("click",function(){x(n);let t=d(2);return f(t.assignParent(null))}),p(7,"lucide-angular",68),a(8,"span",51),m(9,"Sin padre (elemento raiz)"),s()(),S(10,ve,1,1,null,null,O),s()}if(i&2){let n=l,e=d(2);r(3),M(n.etiqueta),r(),h(n.codigoPadre?4:-1),r(3),c("size",16),r(3),P(e.availableParents())}}function ye(i,l){if(i&1){let n=v();a(0,"div",57),C("click",function(){x(n);let t=d();return f(t.closeParentModal())}),a(1,"div",58),C("click",function(t){return x(n),f(t.stopPropagation())}),a(2,"div",59)(3,"h3",60),m(4,"Asignar Padre"),s(),a(5,"button",61),C("click",function(){x(n);let t=d();return f(t.closeParentModal())}),p(6,"lucide-angular",62),s()(),_(7,Ie,12,3),s()()}if(i&2){let n,e=d();r(6),c("size",20),r(),h((n=e.itemToAssignParent())?7:-1,n)}}var De=(()=>{let l=class l{constructor(e,t,o){this.menuService=e,this.cdr=t,this.ngZone=o,this.roles=["ADMIN","SUPERVISOR","AGENT","COORDINADOR"],this.selectedRole=b("SUPERVISOR"),this.allItems=b([]),this.visibleItems=b([]),this.hiddenItems=b([]),this.showParentModal=b(!1),this.itemToAssignParent=b(null),this.loading=b(!1),this.saving=b(!1),this.hasChanges=b(!1),this.roleLabels={ADMIN:"Administrador",SUPERVISOR:"Supervisor",AGENT:"Agente",COORDINADOR:"Coordinador"},this.visibleFlat=b([]),this.hiddenFlat=b([]),this.availableParents=b([])}ngOnInit(){this.loadRoleConfig(this.selectedRole())}selectRole(e){this.hasChanges()&&!confirm("Hay cambios sin guardar. \xBFDesea continuar?")||(this.selectedRole.set(e),this.loadRoleConfig(e))}loadRoleConfig(e){this.loading.set(!0),this.menuService.getMenuConfigForRole(e).subscribe({next:t=>{let o=[],g=[],u=[];t.forEach(I=>{let y=T(k({},I),{visible:I.visible??!1});o.push(y),I.visible?g.push(y):u.push(y)}),this.allItems.set(o),this.visibleItems.set(g),this.hiddenItems.set(u),this.ngZone.run(()=>{this.availableParents.set(o.filter(I=>I.tipo==="DROPDOWN")),this.recalculateHierarchies(),this.hasChanges.set(!1),this.loading.set(!1)})},error:t=>{console.error("Error loading menu config:",t),this.loading.set(!1),alert("Error al cargar la configuracion del menu")}})}recalculateHierarchies(){this.visibleFlat.set(this.buildFlatList(this.visibleItems())),this.hiddenFlat.set(this.buildFlatList(this.hiddenItems()))}buildFlatList(e){let t=[],o=new Map;e.forEach(u=>{u.codigoPadre&&(o.has(u.codigoPadre)||o.set(u.codigoPadre,[]),o.get(u.codigoPadre).push(u))});let g=e.filter(u=>!u.codigoPadre);return g.sort((u,I)=>u.orden-I.orden),g.forEach(u=>{t.push(u);let I=o.get(u.codigo)||[];I.sort((y,X)=>y.orden-X.orden),I.forEach(y=>t.push(y))}),t}isChild(e){return!!e.codigoPadre}dropVisible(e){if(e.previousContainer===e.container){let t=[...this.visibleItems()];F(t,e.previousIndex,e.currentIndex),this.visibleItems.set(t)}else{let t=[...this.hiddenItems()],o=[...this.visibleItems()];D(t,o,e.previousIndex,e.currentIndex),this.hiddenItems.set(t),this.visibleItems.set(o)}this.updateOrders(),this.recalculateHierarchies(),this.hasChanges.set(!0)}dropHidden(e){if(e.previousContainer===e.container){let t=[...this.hiddenItems()];F(t,e.previousIndex,e.currentIndex),this.hiddenItems.set(t)}else{let t=[...this.visibleItems()],o=[...this.hiddenItems()];D(t,o,e.previousIndex,e.currentIndex),this.visibleItems.set(t),this.hiddenItems.set(o)}this.updateOrders(),this.recalculateHierarchies(),this.hasChanges.set(!0)}moveToVisible(e){let t=[...this.hiddenItems()],o=[...this.visibleItems()],g=t.findIndex(u=>u.codigo===e.codigo);g>-1&&(t.splice(g,1),e.visible=!0,o.push(e)),this.hiddenItems.set(t),this.visibleItems.set(o),this.updateOrders(),this.recalculateHierarchies(),this.hasChanges.set(!0)}moveToHidden(e){let t=[...this.hiddenItems()],o=[...this.visibleItems()],g=o.findIndex(u=>u.codigo===e.codigo);g>-1&&(o.splice(g,1),e.visible=!1,t.push(e)),this.visibleItems.set(o),this.hiddenItems.set(t),this.updateOrders(),this.recalculateHierarchies(),this.hasChanges.set(!0)}updateOrders(){let e=this.visibleItems(),t=this.hiddenItems();e.forEach((o,g)=>{o.orden=g+1,o.visible=!0}),t.forEach((o,g)=>{o.orden=g+1,o.visible=!1})}save(){this.saving.set(!0);let e=[...this.visibleItems(),...this.hiddenItems()],t={rol:this.selectedRole(),permissions:e.map(o=>({menuCodigo:o.codigo,visible:o.visible,orden:o.orden}))};this.menuService.updateMenuConfig(t).subscribe({next:()=>{this.saving.set(!1),this.hasChanges.set(!1),alert("Configuracion guardada correctamente")},error:o=>{console.error("Error saving config:",o),this.saving.set(!1),alert("Error al guardar la configuracion")}})}cancel(){this.hasChanges()&&confirm("\xBFDescartar los cambios?")&&this.loadRoleConfig(this.selectedRole())}getItemTypeLabel(e){return e==="DROPDOWN"?"(dropdown)":""}openParentModal(e){this.itemToAssignParent.set(e),this.showParentModal.set(!0)}closeParentModal(){this.showParentModal.set(!1),this.itemToAssignParent.set(null)}assignParent(e){let t=this.itemToAssignParent();t&&this.menuService.updateMenuItemParent(t.codigo,e).subscribe({next:()=>{let o=g=>g.map(u=>u.codigo===t.codigo?T(k({},u),{codigoPadre:e}):u);t.visible?this.visibleItems.set(o(this.visibleItems())):this.hiddenItems.set(o(this.hiddenItems())),this.allItems.set(o(this.allItems())),this.recalculateHierarchies(),this.closeParentModal()},error:o=>{console.error("Error updating parent:",o),alert("Error al actualizar el padre")}})}removeParent(e){this.menuService.updateMenuItemParent(e.codigo,null).subscribe({next:()=>{let t=o=>o.map(g=>g.codigo===e.codigo?T(k({},g),{codigoPadre:null}):g);e.visible?this.visibleItems.set(t(this.visibleItems())):this.hiddenItems.set(t(this.hiddenItems())),this.allItems.set(t(this.allItems())),this.recalculateHierarchies()},error:t=>{console.error("Error removing parent:",t),alert("Error al quitar el padre")}})}getParentLabel(e){if(!e)return"";let t=this.allItems().find(o=>o.codigo===e);return t?t.etiqueta:e}};l.\u0275fac=function(t){return new(t||l)(V(K),V(U),V(H))},l.\u0275cmp=A({type:l,selectors:[["app-menu-configuration"]],decls:18,vars:3,consts:[[1,"h-[calc(100dvh-56px)]","bg-slate-950","overflow-hidden","flex","flex-col"],[1,"flex-1","overflow-y-auto"],[1,"p-4","max-w-[1400px]","mx-auto"],[1,"mb-4"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-gradient-to-br","from-indigo-600","to-indigo-700","rounded-lg","flex","items-center","justify-center"],["name","menu",1,"text-white",3,"size"],[1,"text-xl","font-bold","text-white"],[1,"text-sm","text-gray-400"],[1,"flex","gap-2","mb-4"],[1,"px-4","py-2","rounded-lg","text-sm","font-semibold","transition-colors",3,"class"],[1,"flex","items-center","justify-center","py-12"],[1,"fixed","inset-0","bg-black/60","flex","items-center","justify-center","z-50"],[1,"px-4","py-2","rounded-lg","text-sm","font-semibold","transition-colors",3,"click"],["name","loader-2",1,"text-indigo-400","animate-spin",3,"size"],[1,"grid","grid-cols-2","gap-4"],[1,"bg-slate-900","rounded-lg","border","border-slate-800","p-4"],[1,"flex","items-center","gap-2","mb-3"],["name","eye",1,"text-green-400",3,"size"],[1,"text-sm","font-bold","text-white"],[1,"text-xs","text-gray-400"],[1,"min-h-[400px]","p-2","bg-slate-800/50","rounded-lg","border-2","border-dashed","border-slate-700"],[1,"flex","items-center","justify-between","p-2","mb-1","bg-slate-800","rounded","border","border-slate-700","hover:border-indigo-500/50","group",3,"ml-6"],[1,"flex","flex-col","items-center","justify-center","py-8","text-gray-500"],["name","eye-off",1,"text-red-400",3,"size"],[1,"flex","items-center","justify-between","p-2","mb-1","bg-slate-800","rounded","border","border-slate-700","hover:border-indigo-500/50","group","opacity-60","hover:opacity-100",3,"ml-6"],[1,"mt-4","flex","justify-end","gap-2"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","text-sm","font-semibold","transition-colors",3,"click","disabled"],[1,"px-4","py-2","bg-indigo-600","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","text-sm","font-semibold","transition-colors","flex","items-center","gap-2",3,"click","disabled"],["name","loader-2",1,"animate-spin",3,"size"],["name","save",3,"size"],[1,"flex","items-center","justify-between","p-2","mb-1","bg-slate-800","rounded","border","border-slate-700","hover:border-indigo-500/50","group"],[1,"flex","items-center","gap-2"],["name","corner-down-right",1,"text-gray-500",3,"size"],[3,"name","size"],[1,"text-sm"],[1,"text-xs","bg-indigo-500/20","text-indigo-300","px-1.5","py-0.5","rounded"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","gap-1"],["title","Asignar padre",1,"p-1","text-gray-400","hover:text-indigo-400"],["title","Quitar padre",1,"p-1","text-gray-400","hover:text-yellow-400"],["title","Ocultar",1,"p-1","text-gray-400","hover:text-red-400",3,"click"],["name","eye-off",3,"size"],["title","Asignar padre",1,"p-1","text-gray-400","hover:text-indigo-400",3,"click"],["name","folder-tree",3,"size"],["title","Quitar padre",1,"p-1","text-gray-400","hover:text-yellow-400",3,"click"],["name","unlink",3,"size"],[1,"text-sm","mt-2"],[1,"flex","items-center","justify-between","p-2","mb-1","bg-slate-800","rounded","border","border-slate-700","hover:border-indigo-500/50","group","opacity-60","hover:opacity-100"],["name","corner-down-right",1,"text-gray-600",3,"size"],[1,"text-gray-400",3,"name","size"],[1,"text-sm","text-gray-300"],[1,"text-xs","bg-gray-500/20","text-gray-400","px-1.5","py-0.5","rounded"],[1,"text-xs","text-gray-600"],["title","Mostrar",1,"p-1","text-gray-400","hover:text-green-400",3,"click"],["name","eye",3,"size"],["name","check-circle",3,"size"],[1,"fixed","inset-0","bg-black/60","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-slate-900","rounded-lg","border","border-slate-700","p-4","w-96","max-w-[90vw]",3,"click"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-bold","text-white"],[1,"text-gray-400","hover:text-white",3,"click"],["name","x",3,"size"],[1,"text-sm","text-gray-400","mb-4"],[1,"text-white","font-medium"],[1,"mb-3","p-2","bg-slate-800","rounded","border","border-slate-700"],[1,"space-y-2","max-h-60","overflow-y-auto"],[1,"w-full","flex","items-center","gap-2","p-2","bg-slate-800","hover:bg-slate-700","rounded","border","border-slate-700","text-left","transition-colors",3,"click"],["name","minus-circle",1,"text-gray-400",3,"size"],[1,"text-sm","text-indigo-400","ml-2"],[1,"w-full","flex","items-center","gap-2","p-2","bg-slate-800","hover:bg-slate-700","rounded","border","text-left","transition-colors",3,"class"],[1,"w-full","flex","items-center","gap-2","p-2","bg-slate-800","hover:bg-slate-700","rounded","border","text-left","transition-colors",3,"click"],[1,"text-indigo-400",3,"name","size"],[1,"text-sm","text-white"],["name","check",1,"text-indigo-400","ml-auto",3,"size"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),p(6,"lucide-angular",6),s(),a(7,"div")(8,"h1",7),m(9,"Configuracion de Menu"),s(),a(10,"p",8),m(11,"Configura la visibilidad del menu por rol"),s()()()(),a(12,"div",9),S(13,te,2,3,"button",10,L),s(),_(15,ie,2,1,"div",11)(16,xe,30,9),s()()(),_(17,ye,8,2,"div",12)),t&2&&(r(6),c("size",20),r(7),P(o.roles),r(2),h(o.loading()?15:16),r(2),h(o.showParentModal()?17:-1))},dependencies:[W,Q,Z,G,J],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;background:#1e293b;border:1px solid #6366f1}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.3}.cdk-drag-animating[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-receiving[_ngcontent-%COMP%]{border-color:#6366f1!important;background:#6366f11a!important}"]});let i=l;return i})();export{De as MenuConfigurationComponent};
