import{a as X}from"./chunk-IHHTKGVG.js";import{a as U}from"./chunk-YWILVLMO.js";import{D as Q,b as F,c as L,e as W,f as j,h as B,j as q,k as O,r as G,s as R,t as H,w as J,z as K}from"./chunk-5CXVSPU7.js";import{ob as k,pb as z}from"./chunk-7OAV6HC2.js";import"./chunk-CVSECBKN.js";import{$a as n,Eb as v,Fb as w,Ib as T,Jb as N,Kb as c,Lb as o,Mb as r,Nb as u,Ub as y,Wb as g,Yb as p,fb as D,jc as M,jd as A,kc as l,lc as x,ma as m,mb as I,mc as S,na as f,nc as V,pc as h,qc as _,rc as C,wa as E}from"./chunk-3MKZGHO3.js";var Y=(s,d)=>d.id;function Z(s,d){if(s&1&&(o(0,"option",13),l(1),r()),s&2){let i=d.$implicit;c("value",i.id),n(),V("",i.tenantName," (",i.tenantCode,")")}}function $(s,d){if(s&1){let i=y();o(0,"tr",37)(1,"td",38)(2,"div",39),u(3,"lucide-angular",20),o(4,"span",40),l(5),r()()(),o(6,"td",41)(7,"div",42),l(8),r()(),o(9,"td",41)(10,"div",43),l(11),r()(),o(12,"td",38)(13,"label",44)(14,"input",45),g("change",function(){let e=m(i).$implicit,a=p(2);return f(a.togglePortfolioStatus(e))}),r(),u(15,"div",46),r()(),o(16,"td",47)(17,"div",48)(18,"button",49),g("click",function(){let e=m(i).$implicit,a=p(2);return f(a.openEditDialog(e))}),u(19,"lucide-angular",50),r(),o(20,"button",51),g("click",function(){let e=m(i).$implicit,a=p(2);return f(a.deletePortfolio(e))}),u(21,"lucide-angular",52),r()()()()}if(s&2){let i=d.$implicit;n(3),c("size",16),n(2),x(i.portfolioCode),n(3),x(i.portfolioName),n(3),S(" ",i.description||"Sin descripci\xF3n"," "),n(3),c("checked",i.isActive),n(5),c("size",18),n(),M(i.hasSubPortfolios?"text-gray-600 cursor-not-allowed":"text-red-400 hover:text-red-500 cursor-pointer"),c("disabled",i.hasSubPortfolios)("title",i.hasSubPortfolios?"No se puede eliminar: tiene subcarteras asociadas":"Eliminar"),n(),c("size",18)}}function ee(s,d){s&1&&(o(0,"tr")(1,"td",53),l(2," No se encontraron carteras "),r()())}function te(s,d){if(s&1){let i=y();o(0,"div",15)(1,"div",16)(2,"div",2)(3,"div")(4,"p",17),l(5,"Total Carteras"),r(),o(6,"p",18),l(7),r()(),o(8,"div",19),u(9,"lucide-angular",20),r()()(),o(10,"div",16)(11,"div",2)(12,"div")(13,"p",17),l(14,"Activas"),r(),o(15,"p",21),l(16),r()(),o(17,"div",22),u(18,"lucide-angular",23),r()()(),o(19,"div",16)(20,"div",2)(21,"div")(22,"p",17),l(23,"Inactivas"),r(),o(24,"p",24),l(25),r()(),o(26,"div",25),u(27,"lucide-angular",26),r()()()(),o(28,"div",1)(29,"div",10)(30,"div",27),u(31,"lucide-angular",28),o(32,"input",29),C("ngModelChange",function(e){m(i);let a=p();return _(a.searchTerm,e)||(a.searchTerm=e),f(e)}),r()()()(),o(33,"div",30)(34,"div",31)(35,"div",32)(36,"table",33)(37,"thead",34)(38,"tr")(39,"th",35),l(40," C\xF3digo "),r(),o(41,"th",35),l(42," Nombre "),r(),o(43,"th",35),l(44," Descripci\xF3n "),r(),o(45,"th",35),l(46," Estado "),r(),o(47,"th",35),l(48," Acciones "),r()()(),o(49,"tbody",36),T(50,$,22,11,"tr",37,Y,!1,ee,3,0,"tr"),r()()()()()}if(s&2){let i=p();n(7),x(i.portfolios().length),n(2),c("size",24),n(7),x(i.getActivePortfolios()),n(2),c("size",24),n(7),x(i.getInactivePortfolios()),n(2),c("size",24),n(4),c("size",18),n(),h("ngModel",i.searchTerm),n(18),N(i.filteredPortfolios())}}function ie(s,d){if(s&1&&(o(0,"p",61),l(1),r()),s&2){let i=p(2);n(),x(i.getCodeErrorMessage())}}function oe(s,d){s&1&&(o(0,"p",62),l(1,"C\xF3digo \xFAnico de m\xE1ximo 3 caracteres"),r())}function re(s,d){if(s&1&&(o(0,"p",61),l(1),r()),s&2){let i=p(2);n(),x(i.getNameErrorMessage())}}function ne(s,d){if(s&1){let i=y();o(0,"div",48)(1,"input",68),C("ngModelChange",function(e){m(i);let a=p(2);return _(a.formData.isActive,e)||(a.formData.isActive=e),f(e)}),r(),o(2,"label",69),l(3," Cartera activa "),r()()}if(s&2){let i=p(2);n(),h("ngModel",i.formData.isActive)}}function ae(s,d){if(s&1){let i=y();o(0,"div",14)(1,"div",54)(2,"div",55)(3,"h2",56),l(4),r(),o(5,"button",57),g("click",function(){m(i);let e=p();return f(e.closeDialog())}),u(6,"lucide-angular",58),r()(),o(7,"form",59),g("ngSubmit",function(){m(i);let e=p();return f(e.savePortfolio())}),o(8,"div")(9,"label",11),l(10," C\xF3digo de Cartera * "),r(),o(11,"input",60),C("ngModelChange",function(e){m(i);let a=p();return _(a.formData.portfolioCode,e)||(a.formData.portfolioCode=e),f(e)}),r(),v(12,ie,2,1,"p",61)(13,oe,2,0,"p",62),r(),o(14,"div")(15,"label",11),l(16," Nombre de Cartera * "),r(),o(17,"input",63),C("ngModelChange",function(e){m(i);let a=p();return _(a.formData.portfolioName,e)||(a.formData.portfolioName=e),f(e)}),r(),v(18,re,2,1,"p",61),r(),o(19,"div")(20,"label",11),l(21," Descripci\xF3n "),r(),o(22,"textarea",64),C("ngModelChange",function(e){m(i);let a=p();return _(a.formData.description,e)||(a.formData.description=e),f(e)}),r()(),v(23,ne,4,1,"div",48),o(24,"div",65)(25,"button",66),g("click",function(){m(i);let e=p();return f(e.closeDialog())}),l(26," Cancelar "),r(),o(27,"button",67),l(28),r()()()()()}if(s&2){let i=p();n(4),S(" ",i.isEditMode?"Editar Cartera":"Nueva Cartera"," "),n(2),c("size",20),n(5),M(i.getCodeErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase"),h("ngModel",i.formData.portfolioCode),c("disabled",i.isEditMode),n(),w(i.getCodeErrorMessage()?12:13),n(5),M(i.getNameErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"),h("ngModel",i.formData.portfolioName),n(),w(i.getNameErrorMessage()?18:-1),n(4),h("ngModel",i.formData.description),n(),w(i.isEditMode?23:-1),n(4),c("disabled",i.isEditMode?!i.formData.portfolioName:!i.canSave()),n(),S(" ",i.isEditMode?"Actualizar":"Crear"," ")}}var _e=(()=>{let d=class d{constructor(t,e){this.portfolioService=t,this.typificationService=e,this.tenants=E([]),this.portfolios=E([]),this.filteredPortfolios=E([]),this.selectedTenantId=0,this.searchTerm="",this.showDialog=!1,this.isEditMode=!1,this.selectedPortfolio=null,this.formData={portfolioCode:"",portfolioName:"",description:"",isActive:!0},this.watchSearchTerm()}ngOnInit(){this.loadTenants()}loadTenants(){this.typificationService.getAllTenants().subscribe({next:t=>{this.tenants.set(t)},error:t=>{console.error("Error loading tenants:",t)}})}onTenantChange(){this.selectedTenantId>0?this.loadPortfolios():(this.portfolios.set([]),this.filteredPortfolios.set([]))}loadPortfolios(){this.portfolioService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:t=>{this.portfolios.set(t),this.filterPortfolios()},error:t=>{console.error("Error loading portfolios:",t)}})}watchSearchTerm(){setInterval(()=>{this.filterPortfolios()},300)}filterPortfolios(){let t=this.searchTerm.toLowerCase().trim();if(!t){this.filteredPortfolios.set(this.portfolios());return}let e=this.portfolios().filter(a=>a.portfolioCode.toLowerCase().includes(t)||a.portfolioName.toLowerCase().includes(t)||a.description&&a.description.toLowerCase().includes(t));this.filteredPortfolios.set(e)}getActivePortfolios(){return this.portfolios().filter(t=>t.isActive).length}getInactivePortfolios(){return this.portfolios().filter(t=>!t.isActive).length}openCreateDialog(){this.isEditMode=!1,this.selectedPortfolio=null,this.formData={portfolioCode:"",portfolioName:"",description:"",isActive:!0},this.showDialog=!0}openEditDialog(t){this.isEditMode=!0,this.selectedPortfolio=t,this.formData={portfolioCode:t.portfolioCode,portfolioName:t.portfolioName,description:t.description||"",isActive:t.isActive},this.showDialog=!0}closeDialog(){this.showDialog=!1,this.isEditMode=!1,this.selectedPortfolio=null}isCodeDuplicated(){return!this.formData.portfolioCode.trim()||this.isEditMode?!1:this.portfolios().filter(e=>e.tenantId===this.selectedTenantId).some(e=>e.portfolioCode.toLowerCase()===this.formData.portfolioCode.trim().toLowerCase())}isNameDuplicated(){if(!this.formData.portfolioName.trim())return!1;let t=this.portfolios().filter(e=>e.tenantId===this.selectedTenantId);return this.isEditMode&&this.selectedPortfolio?t.some(e=>e.id!==this.selectedPortfolio.id&&e.portfolioName.toLowerCase()===this.formData.portfolioName.trim().toLowerCase()):t.some(e=>e.portfolioName.toLowerCase()===this.formData.portfolioName.trim().toLowerCase())}getCodeErrorMessage(){return this.formData.portfolioCode.trim()&&this.isCodeDuplicated()?"Este c\xF3digo ya est\xE1 en uso en este proveedor":""}getNameErrorMessage(){return this.formData.portfolioName.trim()&&this.isNameDuplicated()?"Este nombre ya est\xE1 en uso en este proveedor":""}canSave(){return!(!this.formData.portfolioCode.trim()||!this.formData.portfolioName.trim()||this.isCodeDuplicated()||this.isNameDuplicated())}savePortfolio(){if(!(!this.canSave()&&!this.isEditMode))if(this.isEditMode&&this.selectedPortfolio){let t={portfolioName:this.formData.portfolioName,description:this.formData.description||void 0,isActive:this.formData.isActive};this.portfolioService.updatePortfolio(this.selectedPortfolio.id,t).subscribe({next:()=>{this.closeDialog(),this.loadPortfolios()},error:e=>{console.error("Error updating portfolio:",e),alert("Error al actualizar la cartera: "+(e.error?.message||e.message))}})}else{let t={tenantId:this.selectedTenantId,portfolioCode:this.formData.portfolioCode,portfolioName:this.formData.portfolioName,description:this.formData.description||void 0};this.portfolioService.createPortfolio(t).subscribe({next:()=>{this.closeDialog(),this.loadPortfolios()},error:e=>{console.error("Error creating portfolio:",e),alert("Error al crear la cartera: "+(e.error?.message||e.message))}})}}togglePortfolioStatus(t){let e=!t.isActive,a={portfolioName:t.portfolioName,description:t.description,isActive:e};this.portfolioService.updatePortfolio(t.id,a).subscribe({next:()=>{this.loadPortfolios()},error:b=>{console.error("Error toggling portfolio status:",b),alert("Error al cambiar el estado de la cartera: "+(b.error?.message||b.message))}})}deletePortfolio(t){if(t.hasSubPortfolios){alert("No se puede eliminar esta cartera porque tiene subcarteras asociadas.");return}confirm(`\xBFEst\xE1 seguro de que desea eliminar la cartera "${t.portfolioName}"? Esta acci\xF3n no se puede deshacer.`)&&this.portfolioService.deletePortfolio(t.id).subscribe({next:()=>{this.loadPortfolios(),alert("Cartera eliminada exitosamente")},error:e=>{console.error("Error deleting portfolio:",e),alert("Error al eliminar la cartera: "+(e.error?.message||e.message))}})}};d.\u0275fac=function(e){return new(e||d)(D(U),D(X))},d.\u0275cmp=I({type:d,selectors:[["app-portfolio-maintenance"]],decls:27,vars:7,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","p-6"],[1,"max-w-7xl","mx-auto","mb-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-2","mb-2"],[1,"w-8","h-8","bg-teal-600","rounded-lg","flex","items-center","justify-center"],["name","briefcase",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-gray-400"],[1,"flex","items-center","gap-2","px-5","py-2.5","bg-gradient-to-r","from-purple-600","to-purple-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","hover:scale-105","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","cursor-pointer",3,"click","disabled"],["name","plus",3,"size"],[1,"bg-slate-900","rounded-xl","p-4","shadow-sm","border","border-slate-800"],[1,"block","text-sm","font-semibold","text-gray-300","mb-2"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[3,"value"],[1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","p-4","z-50"],[1,"max-w-7xl","mx-auto","mb-6","grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"bg-slate-900","rounded-xl","p-5","shadow-sm","border","border-slate-800"],[1,"text-sm","text-gray-400","mb-1"],[1,"text-3xl","font-bold","text-white"],[1,"w-12","h-12","bg-purple-900/30","rounded-lg","flex","items-center","justify-center"],["name","folder",1,"text-purple-400",3,"size"],[1,"text-3xl","font-bold","text-green-400"],[1,"w-12","h-12","bg-green-900/30","rounded-lg","flex","items-center","justify-center"],["name","check-circle",1,"text-green-400",3,"size"],[1,"text-3xl","font-bold","text-red-400"],[1,"w-12","h-12","bg-red-900/30","rounded-lg","flex","items-center","justify-center"],["name","x-circle",1,"text-red-400",3,"size"],[1,"relative"],["name","search",1,"absolute","left-3","top-1/2","transform","-translate-y-1/2","text-gray-400",3,"size"],["type","text","placeholder","Buscar carteras por c\xF3digo, nombre o tipo...",1,"w-full","pl-12","pr-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"max-w-7xl","mx-auto"],[1,"bg-slate-900","rounded-xl","shadow-sm","border","border-slate-800","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-slate-800"],[1,"bg-slate-800"],[1,"px-6","py-4","text-left","text-xs","font-semibold","text-gray-300","uppercase","tracking-wider"],[1,"divide-y","divide-slate-800"],[1,"hover:bg-slate-800/50","transition-colors"],[1,"px-6","py-4","whitespace-nowrap"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-medium","text-white"],[1,"px-6","py-4"],[1,"text-sm","text-white","font-medium"],[1,"text-sm","text-gray-400","max-w-xs","truncate"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-slate-700","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-purple-800","rounded-full","peer","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-purple-600"],[1,"px-6","py-4","whitespace-nowrap","text-sm"],[1,"flex","items-center","gap-3"],[1,"text-blue-400","hover:text-blue-500","transition-colors","cursor-pointer",3,"click"],["name","edit",3,"size"],[1,"transition-colors","disabled:opacity-50",3,"click","disabled","title"],["name","trash-2",3,"size"],["colspan","5",1,"px-6","py-8","text-center","text-gray-500"],[1,"bg-slate-900","rounded-xl","shadow-xl","max-w-md","w-full","border","border-slate-800"],[1,"flex","items-center","justify-between","p-6","border-b","border-slate-800"],[1,"text-xl","font-bold","text-white"],[1,"text-gray-400","hover:text-white","transition-colors",3,"click"],["name","x",3,"size"],[1,"p-6","space-y-4",3,"ngSubmit"],["type","text","name","portfolioCode","required","","maxlength","3","placeholder","Ej: C01, ABC",3,"ngModelChange","ngModel","disabled"],[1,"text-xs","text-red-400","mt-1","font-semibold"],[1,"text-xs","text-gray-500","mt-1"],["type","text","name","portfolioName","required","","maxlength","255","placeholder","Ej: Cartera de Consumo",3,"ngModelChange","ngModel"],["name","description","rows","3","placeholder","Descripci\xF3n de la cartera...",1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-purple-500","resize-none",3,"ngModelChange","ngModel"],[1,"flex","gap-3","pt-4"],["type","button",1,"flex-1","px-4","py-2.5","bg-slate-800","text-white","rounded-lg","font-semibold","hover:bg-slate-700","transition-colors",3,"click"],["type","submit",1,"flex-1","px-4","py-2.5","bg-gradient-to-r","from-purple-600","to-purple-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],["type","checkbox","name","isActive","id","isActive",1,"w-4","h-4","text-purple-600","bg-slate-800","border-slate-700","rounded","focus:ring-purple-500",3,"ngModelChange","ngModel"],["for","isActive",1,"text-sm","text-gray-300"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"div",4),u(6,"lucide-angular",5),r(),o(7,"div")(8,"h1",6),l(9,"Carteras"),r(),o(10,"p",7),l(11,"Administraci\xF3n de carteras de cobranza"),r()()()(),o(12,"button",8),g("click",function(){return a.openCreateDialog()}),u(13,"lucide-angular",9),o(14,"span"),l(15,"Nueva Cartera"),r()()()(),o(16,"div",1)(17,"div",10)(18,"label",11),l(19," Seleccionar Proveedor "),r(),o(20,"select",12),C("ngModelChange",function(P){return _(a.selectedTenantId,P)||(a.selectedTenantId=P),P}),g("ngModelChange",function(){return a.onTenantChange()}),o(21,"option",13),l(22,"Seleccione un proveedor..."),r(),T(23,Z,2,3,"option",13,Y),r()()(),v(25,te,53,9),r(),v(26,ae,29,15,"div",14)),e&2&&(n(6),c("size",16),n(6),c("disabled",a.selectedTenantId===0),n(),c("size",18),n(7),h("ngModel",a.selectedTenantId),n(),c("value",0),n(2),N(a.tenants()),n(2),w(a.selectedTenantId>0?25:-1),n(),w(a.showDialog?26:-1))},dependencies:[A,Q,O,R,H,L,F,G,W,j,J,K,q,B,z,k],encapsulation:2});let s=d;return s})();export{_e as PortfolioMaintenanceComponent};
