import{a as L}from"./chunk-A45DFSUZ.js";import{a as Y}from"./chunk-6LMWXMMV.js";import{c as q}from"./chunk-IW4UZOVV.js";import"./chunk-UXRZVQCL.js";import{pc as U,qc as V}from"./chunk-3IYT5ASU.js";import{a as H}from"./chunk-YQKVMPSG.js";import{b as y,c as R}from"./chunk-72Z2NTOL.js";import{Eb as v,Fb as _,H as I,Ib as x,J as w,Jb as C,Kb as c,Lb as r,M as E,Mb as a,Nb as p,Ub as B,Wb as b,Y as T,Yb as S,ab as s,ba as O,fa as D,gb as f,hc as j,ic as F,kc as l,lc as g,ld as A,m as k,ma as z,na as N,nb as $,r as P,wa as h}from"./chunk-BDAG5FYU.js";var G=(()=>{let i=class i{constructor(e){this.http=e,this.apiUrl=`${H.apiUrl}/client-search`}findClientByDocumento(e,n,t,u){let m=new y().set("tenantId",e.toString()).set("portfolioId",n.toString()).set("subPortfolioId",t.toString()).set("documento",u);return this.http.get(`${this.apiUrl}/find`,{params:m})}searchClientsByDocumento(e,n,t,u,m=10){let J=new y().set("tenantId",e.toString()).set("portfolioId",n.toString()).set("subPortfolioId",t.toString()).set("documento",u).set("limit",m.toString());return this.http.get(`${this.apiUrl}/search`,{params:J})}};i.\u0275fac=function(n){return new(n||i)(D(R))},i.\u0275prov=O({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var M=(o,i)=>i.id,W=(o,i)=>i.documento;function X(o,i){if(o&1&&(r(0,"option",16),l(1),a()),o&2){let d=i.$implicit;c("value",d.id),s(),g(d.tenantName)}}function Z(o,i){if(o&1&&(r(0,"option",16),l(1),a()),o&2){let d=i.$implicit;c("value",d.id),s(),g(d.portfolioName)}}function ee(o,i){if(o&1&&(r(0,"option",16),l(1),a()),o&2){let d=i.$implicit;c("value",d.id),s(),g(d.subPortfolioName)}}function te(o,i){o&1&&(r(0,"div",17),p(1,"lucide-angular",26),r(2,"span",27),l(3,"Selecciona inquilino, cartera y subcartera para buscar clientes"),a()()),o&2&&(s(),c("size",16))}function ne(o,i){o&1&&(p(0,"lucide-angular",28),l(1," Buscando... ")),o&2&&c("size",16)}function oe(o,i){o&1&&(p(0,"lucide-angular",29),l(1," Buscar ")),o&2&&c("size",16)}function ie(o,i){if(o&1){let d=B();r(0,"div",31),b("click",function(){let n=z(d).$implicit,t=S(2);return N(t.selectClient(n))}),r(1,"span",32),l(2),a(),r(3,"span",33),l(4),a(),r(5,"span",34),l(6),a(),p(7,"lucide-angular",35),a()}if(o&2){let d=i.$implicit,e=i.$index,n=S(2);j("animation-delay",e*50+"ms"),s(2),g(d.documento),s(2),g(n.getClientName(d)),s(2),g(n.getClientPhone(d)),s(),c("size",16)}}function re(o,i){if(o&1&&(r(0,"div",24),x(1,ie,8,6,"div",30,W),a()),o&2){let d=S();s(),C(d.searchResults())}}function ae(o,i){if(o&1&&(r(0,"div",25),p(1,"lucide-angular",36),r(2,"span",37),l(3),a()()),o&2){let d=S();s(),c("size",16),s(2),g(d.searchError())}}var xe=(()=>{let i=class i{constructor(e,n,t,u){this.router=e,this.clientSearchService=n,this.tenantService=t,this.portfolioService=u,this.tenants=[],this.portfolios=[],this.subPortfolios=[],this.selectedTenantId=h(null),this.selectedPortfolioId=h(null),this.selectedSubPortfolioId=h(null),this.loadingTenants=h(!1),this.loadingPortfolios=h(!1),this.loadingSubPortfolios=h(!1),this.searchDocument=h(""),this.searchResults=h([]),this.searching=h(!1),this.searchError=h(""),this.searchSubject=new k}ngOnInit(){this.setupSearchAutocomplete(),this.loadTenants()}loadTenants(){this.loadingTenants.set(!0),this.tenantService.getAllTenants().subscribe({next:e=>{this.tenants=e,this.loadingTenants.set(!1)},error:e=>{console.error("Error cargando inquilinos:",e),this.loadingTenants.set(!1)}})}onTenantChange(e){this.selectedTenantId.set(e),this.selectedPortfolioId.set(null),this.selectedSubPortfolioId.set(null),this.portfolios=[],this.subPortfolios=[],this.clearSearch(),e&&(this.loadingPortfolios.set(!0),this.portfolioService.getPortfoliosByTenant(e).subscribe({next:n=>{this.portfolios=n.filter(t=>t.isActive),this.loadingPortfolios.set(!1)},error:n=>{console.error("Error cargando carteras:",n),this.loadingPortfolios.set(!1)}}))}onPortfolioChange(e){this.selectedPortfolioId.set(e),this.selectedSubPortfolioId.set(null),this.subPortfolios=[],this.clearSearch(),e&&(this.loadingSubPortfolios.set(!0),this.portfolioService.getSubPortfoliosByPortfolio(e).subscribe({next:n=>{this.subPortfolios=n.filter(t=>t.isActive),this.loadingSubPortfolios.set(!1)},error:n=>{console.error("Error cargando subcarteras:",n),this.loadingSubPortfolios.set(!1)}}))}onSubPortfolioChange(e){this.selectedSubPortfolioId.set(e),this.clearSearch()}canSearch(){return this.selectedTenantId()!==null&&this.selectedPortfolioId()!==null&&this.selectedSubPortfolioId()!==null}setupSearchAutocomplete(){this.searchSubject.pipe(w(300),E(),T(e=>!e||e.length<3||!this.canSearch()?P([]):(this.searching.set(!0),this.searchError.set(""),this.clientSearchService.searchClientsByDocumento(this.selectedTenantId(),this.selectedPortfolioId(),this.selectedSubPortfolioId(),e,10).pipe(I(n=>(console.error("Error buscando clientes:",n),this.searchError.set("Error al buscar clientes"),P([]))))))).subscribe(e=>{this.searching.set(!1),this.searchResults.set(e)})}onSearchInput(e){let n=e.target.value;this.searchDocument.set(n),this.searchSubject.next(n)}searchByDocument(){let e=this.searchDocument();if(!e){this.searchError.set("Ingresa un documento para buscar");return}if(!this.canSearch()){this.searchError.set("Selecciona inquilino, cartera y subcartera primero");return}this.searching.set(!0),this.searchError.set(""),this.clientSearchService.findClientByDocumento(this.selectedTenantId(),this.selectedPortfolioId(),this.selectedSubPortfolioId(),e).subscribe({next:n=>{this.searching.set(!1),this.navigateToCollectionManagement(n)},error:n=>{this.searching.set(!1),n.status===404?this.searchError.set("Cliente no encontrado con ese documento"):this.searchError.set("Error al buscar el cliente"),console.error("Error:",n)}})}selectClient(e){this.navigateToCollectionManagement(e)}navigateToCollectionManagement(e){this.router.navigate(["/collection-management"],{queryParams:{documento:e.documento,tenantId:this.selectedTenantId(),portfolioId:this.selectedPortfolioId(),subPortfolioId:this.selectedSubPortfolioId(),source:"manual"}})}clearSearch(){this.searchDocument.set(""),this.searchResults.set([]),this.searchError.set("")}getClientName(e){if(e.nombre)return e.nombre;let n=e.nombres||"",t=e.apellidos||"";return`${n} ${t}`.trim()||"Sin nombre"}getClientPhone(e){return e.telefono||e.telefono_1||e.telefono_2||"Sin tel\xE9fono"}};i.\u0275fac=function(n){return new(n||i)(f(q),f(G),f(L),f(Y))},i.\u0275cmp=$({type:i,selectors:[["app-manual-management"]],decls:54,vars:20,consts:[[1,"min-h-screen","bg-gray-100","dark:bg-slate-950","p-4","transition-colors","duration-300"],[1,"flex","items-center","gap-2","mb-3","animate-fade-in"],[1,"w-8","h-8","bg-gradient-to-br","from-blue-600","to-blue-700","rounded-lg","flex","items-center","justify-center","shadow-lg","shadow-blue-500/20","hover:shadow-blue-500/40","hover:scale-110","transition-all","duration-300"],["name","clipboard-edit",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-slate-800","dark:text-white","transition-colors","duration-300"],[1,"text-xs","text-slate-500","dark:text-gray-400","transition-colors","duration-300"],[1,"section"],[1,"bg-white","dark:bg-slate-900","rounded-xl","border","border-slate-200","dark:border-slate-800","p-4","mb-4","shadow-sm","hover:shadow-md","transition-all","duration-300","animate-slide-in"],[1,"flex","items-center","gap-2","mb-4"],["name","building-2",1,"text-blue-500","dark:text-blue-400","transition-colors","duration-300",3,"size"],[1,"text-sm","font-semibold","text-slate-800","dark:text-white","transition-colors","duration-300"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"transform","hover:scale-[1.02]","transition-transform","duration-200"],[1,"block","text-xs","text-slate-500","dark:text-gray-400","mb-1.5","transition-colors","duration-300"],[1,"w-full","bg-slate-100","dark:bg-slate-800","border","border-slate-300","dark:border-slate-700","rounded-lg","px-3","py-2","text-sm","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","disabled:opacity-50","transition-all","duration-200","hover:border-blue-400","cursor-pointer",3,"change","value","disabled"],["value",""],[3,"value"],[1,"flex","items-center","gap-2","mt-3","px-3","py-2","bg-amber-100","dark:bg-amber-500/10","border","border-amber-300","dark:border-amber-500/20","rounded-lg","transition-all","duration-300","animate-pulse-subtle"],[1,"bg-white","dark:bg-slate-900","rounded-xl","border","border-slate-200","dark:border-slate-800","p-4","shadow-sm","hover:shadow-md","transition-all","duration-300","animate-slide-in-delayed"],["name","search",1,"text-green-500","dark:text-green-400","transition-colors","duration-300",3,"size"],[1,"flex","gap-3"],[1,"flex-1","relative","group"],["type","text","placeholder","Ingresa el documento del cliente (DNI/C\xE9dula)",1,"w-full","bg-slate-100","dark:bg-slate-800","border","border-slate-300","dark:border-slate-700","rounded-lg","px-4","py-2.5","text-sm","text-slate-800","dark:text-white","placeholder-slate-400","dark:placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","disabled:opacity-50","transition-all","duration-200","hover:border-green-400","group-hover:shadow-sm",3,"input","keyup.enter","value","disabled"],[1,"px-5","py-2.5","bg-gradient-to-r","from-green-600","to-green-700","hover:from-green-500","hover:to-green-600","disabled:from-gray-400","disabled:to-gray-500","dark:disabled:from-gray-600","dark:disabled:to-gray-700","text-white","text-sm","font-semibold","rounded-lg","transition-all","duration-300","flex","items-center","gap-2","disabled:cursor-not-allowed","hover:shadow-lg","hover:shadow-green-500/30","hover:scale-105","active:scale-95",3,"click","disabled"],[1,"mt-3","bg-slate-100","dark:bg-slate-800","border","border-slate-300","dark:border-slate-700","rounded-lg","overflow-hidden","max-h-48","overflow-y-auto","shadow-inner","transition-all","duration-300","animate-scale-in"],[1,"flex","items-center","gap-2","mt-3","px-3","py-2","bg-red-100","dark:bg-red-500/10","border","border-red-300","dark:border-red-500/20","rounded-lg","transition-all","duration-300","animate-shake"],["name","info",1,"text-amber-600","dark:text-amber-400","transition-colors","duration-300",3,"size"],[1,"text-xs","text-amber-700","dark:text-amber-400","transition-colors","duration-300"],["name","loader-2",1,"animate-spin",3,"size"],["name","search",3,"size"],[1,"flex","items-center","gap-4","px-4","py-3","hover:bg-slate-200","dark:hover:bg-slate-700","cursor-pointer","border-b","border-slate-300","dark:border-slate-700","last:border-b-0","transition-all","duration-200","hover:pl-6",3,"animation-delay"],[1,"flex","items-center","gap-4","px-4","py-3","hover:bg-slate-200","dark:hover:bg-slate-700","cursor-pointer","border-b","border-slate-300","dark:border-slate-700","last:border-b-0","transition-all","duration-200","hover:pl-6",3,"click"],[1,"text-blue-600","dark:text-blue-400","font-semibold","text-sm","min-w-[100px]","transition-colors","duration-200"],[1,"flex-1","text-slate-800","dark:text-white","text-sm","transition-colors","duration-200"],[1,"text-slate-500","dark:text-gray-400","text-xs","transition-colors","duration-200"],["name","chevron-right",1,"text-slate-400","dark:text-slate-500","opacity-0","group-hover:opacity-100","transition-all","duration-200",3,"size"],["name","alert-circle",1,"text-red-500","dark:text-red-400","transition-colors","duration-300",3,"size"],[1,"text-xs","text-red-600","dark:text-red-400","transition-colors","duration-300"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),p(3,"lucide-angular",3),a(),r(4,"div")(5,"h1",4),l(6,"Gesti\xF3n Manual"),a(),r(7,"p",5),l(8,"Busca un cliente por documento para tipificar"),a()()(),r(9,"div",6)(10,"div",7)(11,"div",8),p(12,"lucide-angular",9),r(13,"span",10),l(14,"Seleccionar Contexto"),a()(),r(15,"div",11)(16,"div",12)(17,"label",13),l(18,"Inquilino"),a(),r(19,"select",14),b("change",function(m){return t.onTenantChange(m.target.value)}),r(20,"option",15),l(21,"Seleccionar..."),a(),x(22,X,2,2,"option",16,M),a()(),r(24,"div",12)(25,"label",13),l(26,"Cartera"),a(),r(27,"select",14),b("change",function(m){return t.onPortfolioChange(m.target.value)}),r(28,"option",15),l(29,"Seleccionar..."),a(),x(30,Z,2,2,"option",16,M),a()(),r(32,"div",12)(33,"label",13),l(34,"Subcartera"),a(),r(35,"select",14),b("change",function(m){return t.onSubPortfolioChange(m.target.value)}),r(36,"option",15),l(37,"Seleccionar..."),a(),x(38,ee,2,2,"option",16,M),a()()(),v(40,te,4,1,"div",17),a(),r(41,"div",18)(42,"div",8),p(43,"lucide-angular",19),r(44,"span",10),l(45,"Buscar Cliente"),a()(),r(46,"div",20)(47,"div",21)(48,"input",22),b("input",function(m){return t.onSearchInput(m)})("keyup.enter",function(){return t.searchByDocument()}),a()(),r(49,"button",23),b("click",function(){return t.searchByDocument()}),v(50,ne,2,1)(51,oe,2,1),a()(),v(52,re,3,0,"div",24),v(53,ae,4,2,"div",25),a()()()),n&2&&(s(3),c("size",16),s(9),c("size",18),s(7),c("value",t.selectedTenantId())("disabled",t.loadingTenants()),s(3),C(t.tenants),s(5),c("value",t.selectedPortfolioId())("disabled",!t.selectedTenantId()||t.loadingPortfolios()),s(3),C(t.portfolios),s(5),c("value",t.selectedSubPortfolioId())("disabled",!t.selectedPortfolioId()||t.loadingSubPortfolios()),s(3),C(t.subPortfolios),s(2),_(t.canSearch()?-1:40),s(),F("opacity-50",!t.canSearch())("pointer-events-none",!t.canSearch()),s(2),c("size",18),s(5),c("value",t.searchDocument())("disabled",!t.canSearch()),s(),c("disabled",t.searching()||!t.canSearch()),s(),_(t.searching()?50:51),s(2),_(t.searchResults().length>0?52:-1),s(),_(t.searchError()?53:-1))},dependencies:[A,V,U],styles:[".section[_ngcontent-%COMP%]{max-width:900px;margin:0 auto}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translate(-20px)}to{opacity:1;transform:translate(0)}}@keyframes _ngcontent-%COMP%_scaleIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}10%,30%,50%,70%,90%{transform:translate(-4px)}20%,40%,60%,80%{transform:translate(4px)}}@keyframes _ngcontent-%COMP%_pulseSubtle{0%,to{opacity:1}50%{opacity:.7}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .4s ease-out forwards}.animate-slide-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .5s ease-out forwards}.animate-slide-in-delayed[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .5s ease-out .1s forwards;opacity:0}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scaleIn .3s ease-out forwards}.animate-shake[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_shake .5s ease-in-out}.animate-pulse-subtle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulseSubtle 2s ease-in-out infinite}*[_ngcontent-%COMP%]{transition-property:background-color,border-color,color,fill,stroke,box-shadow;transition-timing-function:ease-in-out;transition-duration:.2s}select[_ngcontent-%COMP%]:hover:not(:disabled), input[_ngcontent-%COMP%]:hover:not(:disabled){box-shadow:0 0 0 3px #3b82f61a}select[_ngcontent-%COMP%]:focus, input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #3b82f633}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#94a3b8;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#64748b}html.dark[_nghost-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, html.dark   [_nghost-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#475569}html.dark[_nghost-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, html.dark   [_nghost-%COMP%]   .overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#64748b}"]});let o=i;return o})();export{xe as ManualManagementComponent};
