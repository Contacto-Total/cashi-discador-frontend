import{a as F}from"./chunk-HOBXXKMH.js";import{f as R}from"./chunk-SFI2AKG2.js";import{$ as v,C as O,Gb as u,Hb as r,Ib as i,Jb as M,Qb as _,Sb as p,Ub as m,V as A,W as P,Wc as L,Xa as c,Xc as y,Y as g,ad as D,bb as f,da as I,dc as x,ec as w,gc as o,hc as C,ib as N,ic as k,id as T,ka as b,la as h,ld as U,m as E,nb as S}from"./chunk-GC56KPP7.js";var s=(function(n){return n.DISPONIBLE="DISPONIBLE",n.EN_REUNION="EN_REUNION",n.REFRIGERIO="REFRIGERIO",n.SSHH="SSHH",n.EN_LLAMADA="EN_LLAMADA",n.TIPIFICANDO="TIPIFICANDO",n.EN_MANUAL="EN_MANUAL",n})(s||{}),$={[s.DISPONIBLE]:"Disponible",[s.EN_REUNION]:"En Reuni\xF3n",[s.REFRIGERIO]:"Refrigerio",[s.SSHH]:"Ba\xF1o",[s.EN_LLAMADA]:"En Llamada",[s.TIPIFICANDO]:"Tipificando",[s.EN_MANUAL]:"Modo Manual"},z=[s.DISPONIBLE,s.EN_REUNION,s.REFRIGERIO,s.SSHH];var j=(()=>{let l=class l{constructor(t){this.http=t,this.apiUrl=`${U.gatewayUrl}/agent-status`,this.currentStatusSubject=new E(null),this.currentStatus$=this.currentStatusSubject.asObservable()}getAgentStatus(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(g(e=>{let d={idUsuario:e.idUsuario,estadoActual:e.estadoActual,estadoAnterior:e.estadoAnterior,timestampCambio:e.timestampCambio,tiempoEnEstadoMinutos:e.tiempoEnEstadoMinutos,notas:e.notas,sessionId:e.sessionId};this.currentStatusSubject.next(d)}))}changeStatus(t,e){return this.http.post(`${this.apiUrl}/${t}/cambiar-estado`,e).pipe(g(()=>{this.getAgentStatus(t).subscribe()}))}enterManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/entrar`,{}).pipe(g(()=>{this.getAgentStatus(t).subscribe()}))}exitManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/salir`,{}).pipe(g(()=>{this.getAgentStatus(t).subscribe()}))}getAvailableStates(){return this.http.get(`${this.apiUrl}/estados-disponibles`)}isAvailableForCalls(t){return this.http.get(`${this.apiUrl}/${t}/disponible-para-llamadas`)}startStatusPolling(t){return O(3e4).pipe(A(0),P(()=>this.getAgentStatus(t)))}clearCurrentStatus(){this.currentStatusSubject.next(null)}getCurrentStatus(){return this.currentStatusSubject.value}};l.\u0275fac=function(e){return new(e||l)(I(T))},l.\u0275prov=v({token:l,factory:l.\u0275fac,providedIn:"root"});let n=l;return n})();function V(n,l){n&1&&(r(0,"div",10),M(1,"div",11),r(2,"p"),o(3,"Cargando estado..."),i()())}function G(n,l){if(n&1){let a=_();r(0,"div",12)(1,"p"),o(2),i(),r(3,"button",13),p("click",function(){b(a);let e=m();return h(e.loadAgentStatus((e.currentStatus==null?null:e.currentStatus.idUsuario)||0))}),o(4," Reintentar "),i()()}if(n&2){let a=m();c(2),C(a.error)}}function Y(n,l){if(n&1){let a=_();r(0,"button",29),p("click",function(){let e=b(a).$implicit,d=m(2);return h(d.changeStatus(e))}),M(1,"div",30),r(2,"span"),o(3),i()()}if(n&2){let a=l.$implicit,t=m(2);x("border-color",t.getStateColor(a)),w("active",t.isCurrentState(a))("disabled",!t.canChangeToState(a)||t.loading),u("disabled",!t.canChangeToState(a)||t.loading),c(),x("background-color",t.getStateColor(a)),c(2),C(t.stateLabels[a])}}function W(n,l){n&1&&(r(0,"p",31),o(1," Est\xE1s en modo manual. Ve al softphone para hacer llamadas. "),i())}function q(n,l){if(n&1){let a=_();r(0,"div",14)(1,"div",15)(2,"div",16)(3,"h2"),o(4,"Estado Actual"),i(),r(5,"div",17)(6,"div",18),o(7),i()()(),r(8,"div",19)(9,"h3"),o(10,"\u2139\uFE0F Informaci\xF3n"),i(),r(11,"ul")(12,"li")(13,"strong"),o(14,"Disponible:"),i(),o(15," Recibir\xE1s llamadas autom\xE1ticas"),i(),r(16,"li")(17,"strong"),o(18,"En Reuni\xF3n/Refrigerio/Ba\xF1o:"),i(),o(19," No recibir\xE1s llamadas"),i(),r(20,"li")(21,"strong"),o(22,"Modo Manual:"),i(),o(23," Puedes llamar, pero no recibes autom\xE1ticas"),i()()()(),r(24,"div",20)(25,"div",21)(26,"h2"),o(27,"Cambiar Estado"),i(),r(28,"p",22),o(29,"Selecciona tu estado actual"),i(),r(30,"div",23),S(31,Y,4,10,"button",24),i()(),r(32,"div",25)(33,"h2"),o(34,"Llamadas Manuales"),i(),r(35,"p",22),o(36,"Inicia el modo manual para realizar llamadas"),i(),r(37,"button",26),p("click",function(){b(a);let e=m();return h(e.enterManualMode())}),r(38,"span",27),o(39,"\u{1F4DE}"),i(),r(40,"span"),o(41,"LLAMAR MANUAL"),i()(),S(42,W,2,0,"p",28),i()()()}if(n&2){let a=m();c(6),x("background-color",a.getStateColor(a.currentStatus.estadoActual)),c(),k(" ",a.stateLabels[a.currentStatus.estadoActual]," "),c(24),u("ngForOf",a.manualStates),c(6),u("disabled",a.loading||a.currentStatus.estadoActual===a.AgentState.EN_LLAMADA||a.currentStatus.estadoActual===a.AgentState.TIPIFICANDO),c(5),u("ngIf",a.currentStatus.estadoActual===a.AgentState.EN_MANUAL)}}var ot=(()=>{let l=class l{constructor(t,e,d){this.agentStatusService=t,this.authService=e,this.router=d,this.currentStatus=null,this.agentName="",this.loading=!1,this.error=null,this.AgentState=s,this.stateLabels=$,this.manualStates=z}ngOnInit(){let t=this.authService.getCurrentUser();if(!t){this.router.navigate(["/login"]);return}this.agentName=t.firstName+" "+t.lastName||t.username,this.loadAgentStatus(t.id),this.statusSubscription=this.agentStatusService.startStatusPolling(t.id).subscribe()}ngOnDestroy(){this.statusSubscription&&this.statusSubscription.unsubscribe()}loadAgentStatus(t){this.loading=!0,this.error=null,this.agentStatusService.getAgentStatus(t).subscribe({next:e=>{this.currentStatus={idUsuario:e.idUsuario,estadoActual:e.estadoActual,estadoAnterior:e.estadoAnterior,timestampCambio:e.timestampCambio,tiempoEnEstadoMinutos:e.tiempoEnEstadoMinutos,notas:e.notas,sessionId:e.sessionId},this.loading=!1},error:e=>{console.error("Error loading agent status:",e),this.error="Error al cargar el estado del agente",this.loading=!1}}),this.agentStatusService.currentStatus$.subscribe(e=>{e&&(this.currentStatus=e)})}changeStatus(t){!this.currentStatus||this.loading||(this.loading=!0,this.error=null,this.agentStatusService.changeStatus(this.currentStatus.idUsuario,{estado:t,notas:`Cambio manual a ${this.stateLabels[t]}`}).subscribe({next:()=>{this.loading=!1},error:e=>{console.error("Error changing status:",e),this.error="Error al cambiar el estado",this.loading=!1}}))}enterManualMode(){!this.currentStatus||this.loading||(this.loading=!0,this.error=null,this.agentStatusService.enterManualMode(this.currentStatus.idUsuario).subscribe({next:()=>{this.loading=!1,this.router.navigate(["/dialer"])},error:t=>{console.error("Error entering manual mode:",t),this.error="Error al entrar en modo manual",this.loading=!1}}))}getStateColor(t){return{[s.DISPONIBLE]:"#4caf50",[s.EN_REUNION]:"#ff9800",[s.REFRIGERIO]:"#2196f3",[s.SSHH]:"#9c27b0",[s.EN_LLAMADA]:"#f44336",[s.TIPIFICANDO]:"#ff5722",[s.EN_MANUAL]:"#607d8b"}[t]||"#757575"}isCurrentState(t){return this.currentStatus?.estadoActual===t}canChangeToState(t){return this.currentStatus?.estadoActual===s.EN_LLAMADA||this.currentStatus?.estadoActual===s.TIPIFICANDO?!1:this.manualStates.includes(t)}logout(){this.authService.logout(),this.router.navigate(["/login"])}};l.\u0275fac=function(e){return new(e||l)(f(j),f(F),f(R))},l.\u0275cmp=N({type:l,selectors:[["app-agent-status-dashboard"]],decls:15,vars:4,consts:[[1,"dashboard-container"],[1,"dashboard-header"],[1,"header-content"],[1,"agent-info"],[1,"agent-name"],[1,"logout-btn",3,"click"],[1,"dashboard-main"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","status-dashboard",4,"ngIf"],[1,"loading-state"],[1,"spinner"],[1,"error-state"],[3,"click"],[1,"status-dashboard"],[1,"left-column"],[1,"status-card"],[1,"current-status"],[1,"status-badge"],[1,"info-card"],[1,"right-column"],[1,"change-status-section"],[1,"section-subtitle"],[1,"status-buttons"],["class","status-btn",3,"active","disabled","border-color","click",4,"ngFor","ngForOf"],[1,"manual-calling-section"],[1,"manual-call-btn",3,"click","disabled"],[1,"btn-icon"],["class","manual-call-note",4,"ngIf"],[1,"status-btn",3,"click","disabled"],[1,"status-btn-icon"],[1,"manual-call-note"]],template:function(e,d){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),o(4,"Panel de Asesor"),i(),r(5,"div",3)(6,"span",4),o(7),i(),r(8,"button",5),p("click",function(){return d.logout()}),r(9,"span"),o(10,"Cerrar Sesi\xF3n"),i()()()()(),r(11,"div",6),S(12,V,4,0,"div",7)(13,G,5,1,"div",8)(14,q,43,6,"div",9),i()()),e&2&&(c(7),C(d.agentName),c(5),u("ngIf",d.loading&&!d.currentStatus),c(),u("ngIf",d.error),c(),u("ngIf",d.currentStatus&&!d.loading))},dependencies:[D,L,y],styles:[".dashboard-container[_ngcontent-%COMP%]{min-height:100vh;background:#0a0e27;display:flex;flex-direction:column}.dashboard-header[_ngcontent-%COMP%]{background:#1e293b;border-bottom:1px solid #334155;box-shadow:0 2px 10px #0000004d;padding:.8rem 1.5rem}.header-content[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.3rem;color:#fff;font-weight:600}.agent-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.agent-name[_ngcontent-%COMP%]{font-size:1rem;color:#94a3b8;font-weight:500}.logout-btn[_ngcontent-%COMP%]{display:none;background:#ef4444;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:6px;cursor:pointer;font-size:.9rem;font-weight:500;transition:background .3s}.logout-btn[_ngcontent-%COMP%]:hover{background:#dc2626}.dashboard-main[_ngcontent-%COMP%]{flex:1;padding:1rem;max-width:1400px;width:100%;margin:0 auto}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;color:#94a3b8}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid #334155;border-top-color:#10b981;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-state[_ngcontent-%COMP%]{background:#ef444426;color:#ef4444;padding:2rem;border-radius:8px;border:1px solid rgba(239,68,68,.3);text-align:center}.error-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem;background:#10b981;color:#fff;border:none;padding:.6rem 1.5rem;border-radius:6px;cursor:pointer;font-weight:500;transition:background .3s}.error-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#059669}.status-dashboard[_ngcontent-%COMP%]{display:grid;grid-template-columns:350px 1fr;gap:1rem;align-items:start}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.status-card[_ngcontent-%COMP%]{background:#1e293b;border:1px solid #334155;border-radius:8px;padding:1.2rem;box-shadow:0 4px 20px #0000004d}.status-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1rem;color:#fff}.current-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:0}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.6rem 2rem;border-radius:50px;color:#fff;font-size:1.1rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;box-shadow:0 4px 15px #0003}.change-status-section[_ngcontent-%COMP%]{background:#1e293b;border:1px solid #334155;border-radius:8px;padding:1.2rem;box-shadow:0 4px 20px #0000004d}.change-status-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .3rem;font-size:1rem;color:#fff}.section-subtitle[_ngcontent-%COMP%]{margin:0 0 1rem;color:#94a3b8;font-size:.85rem}.status-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.7rem}.status-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.7rem;background:#0a0e27;border:2px solid #334155;padding:.7rem 1rem;border-radius:8px;cursor:pointer;font-size:.9rem;font-weight:500;color:#94a3b8;transition:all .3s}.status-btn[_ngcontent-%COMP%]:hover:not(.disabled){transform:translateY(-2px);box-shadow:0 4px 12px #10b98133;background:#10b9811a;color:#10b981}.status-btn.active[_ngcontent-%COMP%]{border-width:2px;background:#10b98126;color:#10b981;box-shadow:0 4px 15px #10b9814d}.status-btn.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.status-btn-icon[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%}.manual-calling-section[_ngcontent-%COMP%]{background:#1e293b;border:1px solid #334155;border-radius:8px;padding:1.2rem;box-shadow:0 4px 20px #0000004d}.manual-calling-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .3rem;font-size:1rem;color:#fff}.manual-call-btn[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;gap:.5rem;background:#10b981;color:#fff;border:none;padding:.7rem 1.2rem;border-radius:8px;cursor:pointer;font-size:.9rem;font-weight:600;margin-top:.7rem;transition:all .3s}.manual-call-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px #10b98166;background:#059669}.manual-call-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-icon[_ngcontent-%COMP%]{font-size:1.2rem}.manual-call-note[_ngcontent-%COMP%]{margin-top:.7rem;padding:.7rem;background:#10b9811a;border-left:4px solid #10B981;border-radius:4px;color:#10b981;font-weight:500;font-size:.85rem}.info-card[_ngcontent-%COMP%]{background:#1e293b;border:1px solid #334155;border-radius:8px;padding:1.2rem;box-shadow:0 4px 20px #0000004d}.info-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .7rem;font-size:.95rem;color:#fff}.info-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.info-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.4rem 0;color:#94a3b8;font-size:.85rem}.info-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#10b981}@media (max-width: 1024px){.status-dashboard[_ngcontent-%COMP%]{grid-template-columns:1fr}.left-column[_ngcontent-%COMP%]{max-width:100%}}@media (max-width: 768px){.dashboard-header[_ngcontent-%COMP%]{padding:1rem}.header-content[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;text-align:center}.dashboard-main[_ngcontent-%COMP%]{padding:1rem}.status-buttons[_ngcontent-%COMP%]{grid-template-columns:1fr}.status-badge[_ngcontent-%COMP%]{font-size:1rem;padding:.6rem 1.5rem}}"]});let n=l;return n})();export{ot as AgentStatusDashboardComponent};
