import{a as ae,b as ne,c as re,d as oe,e as le,f as de,g as se,h as me,i as pe,j as ce,k as ue,l as ge,m as A}from"./chunk-SJGC7I2I.js";import{a as ie}from"./chunk-ZL45YB4K.js";import{Zb as Y,_b as ee}from"./chunk-NUMEWRMA.js";import{a as te}from"./chunk-YQKVMPSG.js";import{Ac as y,Bc as P,E as M,Fb as L,Gb as N,Hc as G,Jb as W,Kb as H,Lb as p,Mb as e,Nb as t,Ob as l,Z as V,Zb as _,a as w,ab as a,b as z,bc as U,ca as F,cc as Q,dc as Z,ga as R,gb as B,kc as I,lc as r,ld as J,mc as b,md as K,nb as $,nc as C,oc as q,ud as X,xa as D,zc as h}from"./chunk-SN4XSKG7.js";var be=(()=>{let d=class d{constructor(i){this.http=i,this.baseUrl=`${te.gatewayUrl}/dashboard/payments`}getDashboard(){return console.log("[DASHBOARD] Obteniendo m\xE9tricas de pagos..."),this.http.get(this.baseUrl)}};d.\u0275fac=function(n){return new(n||d)(R(X))},d.\u0275prov=F({token:d,factory:d.\u0275fac,providedIn:"root"});let s=d;return s})();var fe=(s,d)=>d.agenteId;function ve(s,d){s&1&&(e(0,"div",6),l(1,"div",8),t())}function ye(s,d){if(s&1&&(e(0,"div",7),r(1),t()),s&2){let x=_();a(),C(" ",x.error()," ")}}function Ce(s,d){if(s&1&&(e(0,"div",54)(1,"div",57),r(2),t(),e(3,"div",58)(4,"p",59),r(5),t(),e(6,"p",60),r(7),h(8,"number"),t()(),e(9,"div",61)(10,"p",62),r(11),t(),e(12,"p",60),r(13),t()()()),s&2){let x=d.$implicit,i=d.$index,n=_(2);a(),I(i===0?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400":i===1?"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300":i===2?"bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400"),a(),C(" ",i+1," "),a(3),b(x.nombreAgente),a(2),q(" ",x.promesasRegistradas," promesas \xB7 ",P(8,8,x.tasaCumplimiento,"1.0-0"),"% cumplimiento "),a(4),b(n.formatCurrency(x.montoTotal)),a(2),C("",x.cantidadPagos," pagos")}}function ke(s,d){s&1&&(e(0,"div",55),l(1,"lucide-angular",63),e(2,"p"),r(3,"No hay datos de agentes"),t()()),s&2&&(a(),p("size",32))}function Se(s,d){if(s&1&&(e(0,"div",9)(1,"div",10)(2,"div",11)(3,"div")(4,"p",12),r(5,"Pagos Banco"),t(),e(6,"p",13),r(7),h(8,"number"),t(),e(9,"p",14),r(10),t()(),e(11,"div",15),l(12,"lucide-angular",16),t()()(),e(13,"div",10)(14,"div",11)(15,"div")(16,"p",12),r(17,"Conciliados"),t(),e(18,"p",17),r(19),h(20,"number"),t(),e(21,"p",18),r(22),t()(),e(23,"div",19),l(24,"lucide-angular",20),t()()(),e(25,"div",10)(26,"div",11)(27,"div")(28,"p",12),r(29,"Pagos Voluntarios"),t(),e(30,"p",21),r(31),h(32,"number"),t(),e(33,"p",22),r(34),t()(),e(35,"div",23),l(36,"lucide-angular",24),t()()(),e(37,"div",10)(38,"div",11)(39,"div")(40,"p",12),r(41,"Sin Verificar"),t(),e(42,"p",25),r(43),h(44,"number"),t(),e(45,"p",26),r(46),t()(),e(47,"div",27),l(48,"lucide-angular",28),t()()()(),e(49,"div",9)(50,"div",10)(51,"div",11)(52,"div")(53,"p",12),r(54,"Total Promesas"),t(),e(55,"p",13),r(56),h(57,"number"),t(),e(58,"p",29),r(59),t()(),e(60,"div",30),l(61,"lucide-angular",31),t()()(),e(62,"div",10)(63,"div",11)(64,"div")(65,"p",12),r(66,"Cumplidas"),t(),e(67,"p",17),r(68),h(69,"number"),t()(),e(70,"div",19),l(71,"lucide-angular",32),t()()(),e(72,"div",10)(73,"div",11)(74,"div")(75,"p",12),r(76,"Vencidas"),t(),e(77,"p",25),r(78),h(79,"number"),t()(),e(80,"div",27),l(81,"lucide-angular",33),t()()(),e(82,"div",10)(83,"div",11)(84,"div")(85,"p",12),r(86,"Tasa Cumplimiento"),t(),e(87,"p",34),r(88),h(89,"number"),t()(),e(90,"div",35),l(91,"lucide-angular",36),t()()()(),e(92,"div",37)(93,"div",10)(94,"h3",38),l(95,"lucide-angular",39),r(96," Estado de Conciliaci\xF3n "),t(),e(97,"div",40),l(98,"canvas",41),t(),e(99,"div",42)(100,"div",43),l(101,"div",44),e(102,"span",45),r(103,"Conciliados"),t()(),e(104,"div",43),l(105,"div",46),e(106,"span",45),r(107,"Voluntarios"),t()(),e(108,"div",43),l(109,"div",47),e(110,"span",45),r(111,"Sin Verificar"),t()()()(),e(112,"div",10)(113,"h3",38),l(114,"lucide-angular",48),r(115," Estado de Promesas "),t(),e(116,"div",40),l(117,"canvas",41),t(),e(118,"div",42)(119,"div",43),l(120,"div",44),e(121,"span",45),r(122,"Cumplidas"),t()(),e(123,"div",43),l(124,"div",49),e(125,"span",45),r(126,"Pendientes"),t()(),e(127,"div",43),l(128,"div",47),e(129,"span",45),r(130,"Vencidas"),t()()()()(),e(131,"div",37)(132,"div",10)(133,"h3",38),l(134,"lucide-angular",50),r(135," Tendencia de Pagos (\xDAltimos 30 d\xEDas) "),t(),e(136,"div",51),l(137,"canvas",41),t()(),e(138,"div",10)(139,"h3",38),l(140,"lucide-angular",52),r(141," Top Agentes por Monto "),t(),e(142,"div",53),W(143,Ce,14,11,"div",54,fe,!1,ke,4,1,"div",55),t()()(),e(146,"div",10)(147,"h3",38),l(148,"lucide-angular",56),r(149," Distribuci\xF3n por Banco "),t(),e(150,"div",51),l(151,"canvas",41),t()()),s&2){let x,i,n,c,m,v,f,g,u,k,S,E,O,T,j,o=_();a(7),b(y(8,41,(x=o.dashboard())==null?null:x.totalPagosBanco)),a(3),b(o.formatCurrency((i=o.dashboard())==null?null:i.montoTotalBanco)),a(2),p("size",24),a(7),b(y(20,43,(n=o.dashboard())==null?null:n.pagosConciliados)),a(3),b(o.formatCurrency((c=o.dashboard())==null?null:c.montoConciliado)),a(2),p("size",24),a(7),b(y(32,45,(m=o.dashboard())==null?null:m.pagosPorFuera)),a(3),b(o.formatCurrency((v=o.dashboard())==null?null:v.montoPorFuera)),a(2),p("size",24),a(7),b(y(44,47,(f=o.dashboard())==null?null:f.pagosNoVerificados)),a(3),b(o.formatCurrency((g=o.dashboard())==null?null:g.montoNoVerificado)),a(2),p("size",24),a(8),b(y(57,49,(u=o.dashboard())==null?null:u.totalPromesas)),a(3),b(o.formatCurrency((k=o.dashboard())==null?null:k.montoPrometido)),a(2),p("size",24),a(7),b(y(69,51,(S=o.dashboard())==null?null:S.promesasCumplidas)),a(3),p("size",24),a(7),b(y(79,53,(E=o.dashboard())==null?null:E.promesasVencidas)),a(3),p("size",24),a(6),I(o.getTasaClass(((O=o.dashboard())==null?null:O.tasaCumplimiento)||0)),a(),C(" ",P(89,55,(T=o.dashboard())==null?null:T.tasaCumplimiento,"1.1-1"),"% "),a(3),p("size",24),a(4),p("size",20),a(3),p("type","doughnut")("data",o.conciliacionChartData)("options",o.doughnutChartOptions),a(16),p("size",20),a(3),p("type","doughnut")("data",o.promesasChartData)("options",o.doughnutChartOptions),a(17),p("size",20),a(3),p("type","line")("data",o.tendenciaChartData)("options",o.lineChartOptions),a(3),p("size",20),a(3),H((j=o.dashboard())==null?null:j.topAgentes),a(5),p("size",20),a(3),p("type","bar")("data",o.bancosChartData)("options",o.barChartOptions)}}oe.register(ne,le,ae,me,re,de,se,ue,ge,ce,pe);var Fe=(()=>{let d=class d{constructor(i,n){this.dashboardService=i,this.themeService=n,this.dashboard=D(null),this.loading=D(!0),this.error=D(null),this.chartsReady=!1,this.doughnutChartOptions={},this.lineChartOptions={},this.barChartOptions={},this.conciliacionChartData={labels:[],datasets:[]},this.promesasChartData={labels:[],datasets:[]},this.tendenciaChartData={labels:[],datasets:[]},this.bancosChartData={labels:[],datasets:[]},this.buildChartOptions(),G(()=>{let c=this.themeService.isDarkMode();console.log("[DASHBOARD] Tema cambiado:",c?"dark":"light"),this.buildChartOptions(),this.chartsReady&&this.forceChartsUpdate()})}ngAfterViewInit(){this.chartsReady=!0}buildChartOptions(){let i=this.themeService.isDarkMode(),n=i?"#e2e8f0":"#374151",c=i?"rgba(148, 163, 184, 0.2)":"rgba(156, 163, 175, 0.3)",m=i?"#1e293b":"#ffffff",v=i?"#334155":"#e5e7eb";this.doughnutChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:m,titleColor:n,bodyColor:n,borderColor:v,borderWidth:1,callbacks:{label:f=>{let g=f.parsed||0,u=f.dataset.data.reduce((S,E)=>S+E,0),k=u>0?(g/u*100).toFixed(1):"0";return`${f.label}: ${g} (${k}%)`}}}}},this.lineChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{color:n}},tooltip:{backgroundColor:m,titleColor:n,bodyColor:n,borderColor:v,borderWidth:1}},scales:{y:{beginAtZero:!0,grid:{color:c},ticks:{color:n}},x:{grid:{display:!1},ticks:{color:n}}}},this.barChartOptions={responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1},tooltip:{backgroundColor:m,titleColor:n,bodyColor:n,borderColor:v,borderWidth:1}},scales:{x:{beginAtZero:!0,grid:{color:c},ticks:{color:n}},y:{grid:{display:!1},ticks:{color:n}}}}}forceChartsUpdate(){if(this.charts){let i=this.themeService.isDarkMode(),n=i?"#e2e8f0":"#374151",c=i?"rgba(148, 163, 184, 0.2)":"rgba(156, 163, 175, 0.3)",m=i?"#1e293b":"#ffffff",v=i?"#334155":"#e5e7eb";this.charts.forEach(f=>{if(f.chart){let g=f.chart;g.options.plugins?.tooltip&&(g.options.plugins.tooltip.backgroundColor=m,g.options.plugins.tooltip.titleColor=n,g.options.plugins.tooltip.bodyColor=n,g.options.plugins.tooltip.borderColor=v),g.options.plugins?.legend?.labels&&(g.options.plugins.legend.labels.color=n);let u=g.options.scales;u&&(u.x&&(u.x.ticks=z(w({},u.x.ticks),{color:n}),u.x.grid&&(u.x.grid.color=c)),u.y&&(u.y.ticks=z(w({},u.y.ticks),{color:n}),u.y.grid&&(u.y.grid.color=c))),g.update("none")}})}}ngOnInit(){this.loadDashboard(),this.startPolling()}ngOnDestroy(){this.pollingSubscription?.unsubscribe()}loadDashboard(){this.loading.set(!0),this.error.set(null),this.dashboardService.getDashboard().subscribe({next:i=>{this.dashboard.set(i),this.updateCharts(i),this.loading.set(!1)},error:i=>{console.error("[DASHBOARD] Error cargando dashboard:",i),this.error.set("Error al cargar el dashboard. Intente nuevamente."),this.loading.set(!1)}})}startPolling(){this.pollingSubscription=M(6e4).pipe(V(()=>this.dashboardService.getDashboard())).subscribe({next:i=>{this.dashboard.set(i),this.updateCharts(i)},error:i=>console.error("[DASHBOARD] Error en polling:",i)})}updateCharts(i){this.conciliacionChartData={labels:["Conciliados","Voluntarios","Sin Verificar"],datasets:[{data:[i.pagosConciliados,i.pagosPorFuera,i.pagosNoVerificados],backgroundColor:["#22c55e","#f59e0b","#ef4444"],borderWidth:0}]},this.promesasChartData={labels:["Cumplidas","Pendientes","Vencidas"],datasets:[{data:[i.promesasCumplidas,i.promesasPendientes,i.promesasVencidas],backgroundColor:["#22c55e","#3b82f6","#ef4444"],borderWidth:0}]};let n=[...i.tendenciaDiaria||[]].reverse().slice(-15);this.tendenciaChartData={labels:n.map(m=>this.formatDate(m.fecha)),datasets:[{label:"Banco",data:n.map(m=>m.cantidadBanco),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.4},{label:"Agente",data:n.map(m=>m.cantidadAgente),borderColor:"#22c55e",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0,tension:.4}]};let c=i.distribucionBancos||[];this.bancosChartData={labels:c.map(m=>m.banco||"OTRO"),datasets:[{data:c.map(m=>m.monto),backgroundColor:["#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef"],borderWidth:0}]}}formatCurrency(i){return i==null?"S/ 0.00":"S/ "+i.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})}formatDate(i){if(!i)return"";let n=i.split(/[\/\-]/);return n.length>=2?`${n[0]}/${n[1]}`:i}getTasaClass(i){return i>=70?"text-green-600 dark:text-green-400":i>=40?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}};d.\u0275fac=function(n){return new(n||d)(B(be),B(ie))},d.\u0275cmp=$({type:d,selectors:[["app-payments-dashboard"]],viewQuery:function(n,c){if(n&1&&U(A,5),n&2){let m;Q(m=Z())&&(c.charts=m)}},decls:11,vars:2,consts:[[1,"min-h-screen","bg-gray-50","dark:bg-slate-900","p-6"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white","flex","items-center","gap-3"],[1,"w-10","h-10","bg-gradient-to-br","from-blue-500","to-indigo-600","rounded-xl","flex","items-center","justify-center"],["name","bar-chart-3",1,"text-white",3,"size"],[1,"text-gray-500","dark:text-gray-400","mt-1"],[1,"flex","items-center","justify-center","h-64"],[1,"bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-800","rounded-lg","p-4","text-red-700","dark:text-red-300"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-500"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4","mb-6"],[1,"bg-white","dark:bg-slate-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-slate-700","p-5"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white"],[1,"text-sm","text-blue-600","dark:text-blue-400","font-medium"],[1,"w-12","h-12","bg-blue-100","dark:bg-blue-900/30","rounded-full","flex","items-center","justify-center"],["name","building-2",1,"text-blue-600","dark:text-blue-400",3,"size"],[1,"text-2xl","font-bold","text-green-600","dark:text-green-400"],[1,"text-sm","text-green-600","dark:text-green-400","font-medium"],[1,"w-12","h-12","bg-green-100","dark:bg-green-900/30","rounded-full","flex","items-center","justify-center"],["name","check-circle",1,"text-green-600","dark:text-green-400",3,"size"],[1,"text-2xl","font-bold","text-amber-600","dark:text-amber-400"],[1,"text-sm","text-amber-600","dark:text-amber-400","font-medium"],[1,"w-12","h-12","bg-amber-100","dark:bg-amber-900/30","rounded-full","flex","items-center","justify-center"],["name","user-check",1,"text-amber-600","dark:text-amber-400",3,"size"],[1,"text-2xl","font-bold","text-red-600","dark:text-red-400"],[1,"text-sm","text-red-600","dark:text-red-400","font-medium"],[1,"w-12","h-12","bg-red-100","dark:bg-red-900/30","rounded-full","flex","items-center","justify-center"],["name","alert-triangle",1,"text-red-600","dark:text-red-400",3,"size"],[1,"text-sm","text-indigo-600","dark:text-indigo-400","font-medium"],[1,"w-12","h-12","bg-indigo-100","dark:bg-indigo-900/30","rounded-full","flex","items-center","justify-center"],["name","handshake",1,"text-indigo-600","dark:text-indigo-400",3,"size"],["name","badge-check",1,"text-green-600","dark:text-green-400",3,"size"],["name","clock",1,"text-red-600","dark:text-red-400",3,"size"],[1,"text-2xl","font-bold"],[1,"w-12","h-12","bg-purple-100","dark:bg-purple-900/30","rounded-full","flex","items-center","justify-center"],["name","trending-up",1,"text-purple-600","dark:text-purple-400",3,"size"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-6"],[1,"text-lg","font-semibold","text-gray-800","dark:text-white","mb-4","flex","items-center","gap-2"],["name","pie-chart",1,"text-blue-500",3,"size"],[1,"h-64","flex","items-center","justify-center"],["baseChart","",3,"type","data","options"],[1,"mt-4","flex","flex-wrap","justify-center","gap-4"],[1,"flex","items-center","gap-2"],[1,"w-3","h-3","rounded-full","bg-green-500"],[1,"text-sm","text-gray-600","dark:text-gray-400"],[1,"w-3","h-3","rounded-full","bg-amber-500"],[1,"w-3","h-3","rounded-full","bg-red-500"],["name","target",1,"text-indigo-500",3,"size"],[1,"w-3","h-3","rounded-full","bg-blue-500"],["name","trending-up",1,"text-green-500",3,"size"],[1,"h-64"],["name","trophy",1,"text-yellow-500",3,"size"],[1,"space-y-3","max-h-72","overflow-y-auto"],[1,"flex","items-center","gap-3","p-3","rounded-lg","bg-gray-50","dark:bg-slate-700/50"],[1,"text-center","py-8","text-gray-500","dark:text-gray-400"],["name","landmark",1,"text-blue-500",3,"size"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","text-sm","font-bold"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-gray-800","dark:text-white","truncate"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-right"],[1,"text-sm","font-bold","text-green-600","dark:text-green-400"],["name","users",1,"mx-auto","mb-2","opacity-50",3,"size"]],template:function(n,c){n&1&&(e(0,"div",0)(1,"div",1)(2,"h1",2)(3,"div",3),l(4,"lucide-angular",4),t(),r(5," Dashboard de Pagos y Conciliaci\xF3n "),t(),e(6,"p",5),r(7,"M\xE9tricas consolidadas de pagos bancarios, agentes y promesas"),t()(),L(8,ve,2,0,"div",6)(9,ye,2,1,"div",7)(10,Se,152,58),t()),n&2&&(a(4),p("size",24),a(4),N(c.loading()?8:c.error()?9:10))},dependencies:[K,ee,Y,A,J],styles:["[_nghost-%COMP%]{display:block}"]});let s=d;return s})();export{Fe as PaymentsDashboardComponent};
