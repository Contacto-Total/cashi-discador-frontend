import{a as se,b as le}from"./chunk-IUTVFJ43.js";import{E as ae,c as re,f as oe,k as ne}from"./chunk-7GV7UZOL.js";import{Tb as te,V as K,Vb as ie,Xb as z,Yb as W,aa as Y,gb as ee,r as Z}from"./chunk-BJ2AUU2F.js";import{a as L}from"./chunk-YQKVMPSG.js";import{I as y,Lb as p,Mb as n,Nb as o,Ob as x,T,Vb as R,Xb as f,Zb as c,a as k,ab as s,b as D,ca as V,dd as X,ed as J,ga as I,gb as G,jc as q,lc as d,mc as A,md as Q,na as h,nb as H,nc as S,oa as g,pc as $,qc as v,rc as C,s as M,sb as b,sc as w,sd as P,ud as F}from"./chunk-SN4XSKG7.js";var de=(()=>{let l=class l{constructor(e){this.http=e,this.baseUrl=L.webServiceUrl+"/gestion/historica/audios",this.httpOptions={headers:new P({"Content-Type":"application/json"})}}handleError(e){return typeof ErrorEvent<"u"&&e.error instanceof ErrorEvent?console.log(`An error occurred ${e.status}, body was: ${e.error.message}`):console.log(`Backend returned code ${e.status}, body was: ${e.error.message}`),M(()=>({status:e.status,message:e.error.message}))}getGestionHistoricaAudiosByTramo(e){return this.http.post(this.baseUrl+"/tramo",e,this.httpOptions).pipe(T(2),y(this.handleError))}getGestionHistoricaAudiosByDateRange(e){return this.http.post(this.baseUrl+"/date/range",e,this.httpOptions).pipe(T(2),y(this.handleError))}getGestionHistoricaAudiosByDocumento(e){return this.http.post(this.baseUrl+"/documento",e,this.httpOptions).pipe(T(2),y(this.handleError))}getGestionHistoricaAudiosByTelefono(e){return this.http.post(this.baseUrl+"/telefono",e,this.httpOptions).pipe(T(2),y(this.handleError))}};l.\u0275fac=function(t){return new(t||l)(I(F))},l.\u0275prov=V({token:l,factory:l.\u0275fac,providedIn:"root"});let a=l;return a})();var pe=(()=>{let l=class l{constructor(e){this.http=e,this.baseUrl=L.webServiceUrl+"/recording",this.fileHttpOptions={headers:new P({"Content-Type":"application/json"}),responseType:"blob"}}handleError(e){return typeof ErrorEvent<"u"&&e.error instanceof ErrorEvent?console.log(`An error occurred ${e.status}, body was: ${e.error.message}`):console.log(`Backend returned code ${e.status}, body was: ${e.error.message}`),M(()=>({status:e.status,message:e.error.message}))}downloadGestionHistoricaAudioFileByName(e){return console.log("Download Request:",e),this.http.post(this.baseUrl+"/download/historico/audio",e,D(k({},this.fileHttpOptions),{responseType:"blob"})).pipe(T(2),y(this.handleError))}downloadGestionHistoricaAudioFiles(e){return this.http.post(this.baseUrl+"/download/historico/audio/zip",e,D(k({},this.fileHttpOptions),{responseType:"blob"})).pipe(T(2),y(this.handleError))}};l.\u0275fac=function(t){return new(t||l)(I(F))},l.\u0275prov=V({token:l,factory:l.\u0275fac,providedIn:"root"});let a=l;return a})();var ue=(()=>{let l=class l{constructor(e){this.http=e,this.baseUrl=L.webServiceUrl+"/audio/evaluation",this.fileHttpOptions={headers:new P({"Content-Type":"application/json"}),responseType:"blob"}}handleError(e){return typeof ErrorEvent<"u"&&e.error instanceof ErrorEvent?console.log(`An error occurred ${e.status}, body was: ${e.error.message}`):console.log(`Backend returned code ${e.status}, body was: ${e.error.message}`),M(()=>({status:e.status,message:e.error.message}))}downloadGestionHistoricaReporteFile(e){return this.http.post(this.baseUrl+"/create",e,D(k({},this.fileHttpOptions),{responseType:"blob"})).pipe(T(2),y(this.handleError))}downloadGestionHistoricaReporteFiles(e){return this.http.post(this.baseUrl+"/create/zip",e,D(k({},this.fileHttpOptions),{responseType:"blob"})).pipe(T(2),y(this.handleError))}};l.\u0275fac=function(t){return new(t||l)(I(F))},l.\u0275prov=V({token:l,factory:l.\u0275fac,providedIn:"root"});let a=l;return a})();function xe(a,l){a&1&&(n(0,"div",18),x(1,"div",19),o())}function be(a,l){if(a&1){let i=R();n(0,"div",10)(1,"div",20)(2,"label",4),d(3,"Fecha Inicio"),o(),n(4,"div",21)(5,"input",22),w("ngModelChange",function(t){h(i);let r=c();return C(r.startDate,t)||(r.startDate=t),g(t)}),f("change",function(){h(i);let t=c();return g(t.validateDates())}),o()()(),n(6,"div",20)(7,"label",4),d(8,"Fecha Fin"),o(),n(9,"div",21)(10,"input",22),w("ngModelChange",function(t){h(i);let r=c();return C(r.endDate,t)||(r.endDate=t),g(t)}),f("change",function(){h(i);let t=c();return g(t.validateDates())}),o()()(),n(11,"button",23),f("click",function(){h(i);let t=c();return g(t.searchByDates())}),x(12,"lucide-angular",13),d(13," Buscar "),o()()}if(a&2){let i=c();s(5),v("ngModel",i.startDate),s(5),v("ngModel",i.endDate),s(2),p("img",i.Search)("size",16)}}function ve(a,l){if(a&1){let i=R();n(0,"div",10)(1,"div",24)(2,"label",4),d(3,"Documento"),o(),n(4,"input",25),w("ngModelChange",function(t){h(i);let r=c();return C(r.documento,t)||(r.documento=t),g(t)}),o()(),n(5,"button",23),f("click",function(){h(i);let t=c();return g(t.searchByDocumento())}),x(6,"lucide-angular",13),d(7," Buscar "),o()()}if(a&2){let i=c();s(4),v("ngModel",i.documento),s(2),p("img",i.Search)("size",16)}}function Ce(a,l){if(a&1){let i=R();n(0,"div",10)(1,"div",24)(2,"label",4),d(3,"Tel\xE9fono"),o(),n(4,"input",26),w("ngModelChange",function(t){h(i);let r=c();return C(r.telefono,t)||(r.telefono=t),g(t)}),o()(),n(5,"button",23),f("click",function(){h(i);let t=c();return g(t.searchByTelefono())}),x(6,"lucide-angular",13),d(7," Buscar "),o()()}if(a&2){let i=c();s(4),v("ngModel",i.telefono),s(2),p("img",i.Search)("size",16)}}function we(a,l){if(a&1&&(n(0,"div",27),d(1),o()),a&2){let i=c();s(),S(" ",i.errorMessage," ")}}function ye(a,l){if(a&1&&(n(0,"span",54),d(1),o()),a&2){let i=c(2);s(),S(" ",i.sortOrder===1?"\u25B2":"\u25BC"," ")}}function Te(a,l){if(a&1&&(n(0,"span",54),d(1),o()),a&2){let i=c(2);s(),S(" ",i.sortOrder===1?"\u25B2":"\u25BC"," ")}}function Se(a,l){if(a&1&&(n(0,"span",54),d(1),o()),a&2){let i=c(2);s(),S(" ",i.sortOrder===1?"\u25B2":"\u25BC"," ")}}function Ee(a,l){if(a&1&&(n(0,"span",54),d(1),o()),a&2){let i=c(2);s(),S(" ",i.sortOrder===1?"\u25B2":"\u25BC"," ")}}function Re(a,l){if(a&1&&(n(0,"span",54),d(1),o()),a&2){let i=c(2);s(),S(" ",i.sortOrder===1?"\u25B2":"\u25BC"," ")}}function Ae(a,l){if(a&1&&(n(0,"span",54),d(1),o()),a&2){let i=c(2);s(),S(" ",i.sortOrder===1?"\u25B2":"\u25BC"," ")}}function Oe(a,l){if(a&1){let i=R();n(0,"button",62),f("click",function(){h(i);let t=c().$implicit,r=c(2);return g(r.downloadReport(t))}),x(1,"lucide-angular",13),o()}if(a&2){let i=c(3);s(),p("img",i.FileSpreadsheet)("size",14)}}function ke(a,l){if(a&1){let i=R();n(0,"tr",55)(1,"td",56),d(2),o(),n(3,"td",56),d(4),o(),n(5,"td",56),d(6),o(),n(7,"td",56),d(8),o(),n(9,"td",56),d(10),o(),n(11,"td",57)(12,"span",58),d(13),o()(),n(14,"td",56),d(15),o(),n(16,"td",59)(17,"button",60),f("click",function(){let t=h(i).$implicit,r=c(2);return g(r.downloadAudio(t))}),x(18,"lucide-angular",13),o()(),n(19,"td",59),b(20,Oe,2,2,"button",61),o()()}if(a&2){let i=l.$implicit,e=c(2);s(2),A(i.documento),s(2),A(i.cartera),s(2),A(i.telefono),s(2),A(i.fechagestion),s(2),A(i.horagestion),s(3),S(" ",i.resultado," "),s(2),A(i.solucion),s(3),p("img",e.Volume2)("size",14),s(2),p("ngIf",e.canDownloadReport(i.resultado))}}function De(a,l){if(a&1){let i=R();n(0,"button",63),f("click",function(){let t=h(i).$implicit,r=c(2);return g(r.goToPage(t))}),d(1),o()}if(a&2){let i=l.$implicit,e=c(2);q("bg-blue-600",i===e.currentPage)("border-blue-600",i===e.currentPage)("bg-slate-700",i!==e.currentPage)("border-slate-600",i!==e.currentPage)("hover:bg-slate-600",i!==e.currentPage),s(),S(" ",i," ")}}function Me(a,l){if(a&1){let i=R();n(0,"div",28)(1,"div",29)(2,"table",30)(3,"thead",31)(4,"tr",32)(5,"th",33)(6,"div",21),x(7,"lucide-angular",34),n(8,"input",35),w("ngModelChange",function(t){h(i);let r=c();return C(r.filterDocumento,t)||(r.filterDocumento=t),g(t)}),f("input",function(){h(i);let t=c();return g(t.applyFilters())}),o()()(),n(9,"th",33)(10,"app-custom-select",36),w("ngModelChange",function(t){h(i);let r=c();return C(r.filterCartera,t)||(r.filterCartera=t),g(t)}),f("selectionChange",function(){h(i);let t=c();return g(t.applyFilters())}),o()(),n(11,"th",33)(12,"div",21),x(13,"lucide-angular",34),n(14,"input",37),w("ngModelChange",function(t){h(i);let r=c();return C(r.filterTelefono,t)||(r.filterTelefono=t),g(t)}),f("input",function(){h(i);let t=c();return g(t.applyFilters())}),o()()(),x(15,"th",33)(16,"th",33),n(17,"th",33)(18,"app-custom-select",36),w("ngModelChange",function(t){h(i);let r=c();return C(r.filterResultado,t)||(r.filterResultado=t),g(t)}),f("selectionChange",function(){h(i);let t=c();return g(t.applyFilters())}),o()(),x(19,"th",33),n(20,"th",38)(21,"button",39),f("click",function(){h(i);let t=c();return g(t.clearFilters())}),x(22,"lucide-angular",13),o()(),x(23,"th",33),o(),n(24,"tr")(25,"th",40),f("click",function(){h(i);let t=c();return g(t.sort("documento"))}),d(26," DNI "),b(27,ye,2,1,"span",41),o(),n(28,"th",40),f("click",function(){h(i);let t=c();return g(t.sort("cartera"))}),d(29," Tramo "),b(30,Te,2,1,"span",41),o(),n(31,"th",40),f("click",function(){h(i);let t=c();return g(t.sort("telefono"))}),d(32," Tel\xE9fono "),b(33,Se,2,1,"span",41),o(),n(34,"th",40),f("click",function(){h(i);let t=c();return g(t.sort("fechagestion"))}),d(35," Fecha "),b(36,Ee,2,1,"span",41),o(),n(37,"th",40),f("click",function(){h(i);let t=c();return g(t.sort("horagestion"))}),d(38," Hora "),b(39,Re,2,1,"span",41),o(),n(40,"th",40),f("click",function(){h(i);let t=c();return g(t.sort("resultado"))}),d(41," Resultado "),b(42,Ae,2,1,"span",41),o(),n(43,"th",42),d(44,"Soluci\xF3n"),o(),n(45,"th",43),d(46,"Audio"),o(),n(47,"th",43),d(48,"Reporte"),o()()(),n(49,"tbody"),b(50,ke,21,10,"tr",44),o()()(),n(51,"div",45)(52,"div",46),d(53),o(),n(54,"div",47)(55,"button",48),f("click",function(){h(i);let t=c();return g(t.goToPage(1))}),d(56," \xAB "),o(),n(57,"button",48),f("click",function(){h(i);let t=c();return g(t.goToPage(t.currentPage-1))}),d(58," \u2039 "),o(),b(59,De,2,11,"button",49),n(60,"button",48),f("click",function(){h(i);let t=c();return g(t.goToPage(t.currentPage+1))}),d(61," \u203A "),o(),n(62,"button",48),f("click",function(){h(i);let t=c();return g(t.goToPage(t.totalPages))}),d(63," \xBB "),o()(),n(64,"div",50)(65,"label",51),d(66,"Filas por p\xE1gina:"),o(),n(67,"div",52)(68,"app-custom-select",53),w("ngModelChange",function(t){h(i);let r=c();return C(r.pageSize,t)||(r.pageSize=t),g(t)}),f("selectionChange",function(t){h(i);let r=c();return g(r.onPageSizeChange(t))}),o()()()()()}if(a&2){let i=c();s(7),p("img",i.Search)("size",14),s(),v("ngModel",i.filterDocumento),s(2),p("options",i.tramos),v("ngModel",i.filterCartera),p("compact",!0),s(3),p("img",i.Search)("size",14),s(),v("ngModel",i.filterTelefono),s(4),p("options",i.resultados),v("ngModel",i.filterResultado),p("compact",!0),s(4),p("img",i.X)("size",14),s(5),p("ngIf",i.sortField==="documento"),s(3),p("ngIf",i.sortField==="cartera"),s(3),p("ngIf",i.sortField==="telefono"),s(3),p("ngIf",i.sortField==="fechagestion"),s(3),p("ngIf",i.sortField==="horagestion"),s(3),p("ngIf",i.sortField==="resultado"),s(8),p("ngForOf",i.paginatedGestiones),s(3),$(" Mostrando ",(i.currentPage-1)*i.pageSize+1," a ",i.Math.min(i.currentPage*i.pageSize,i.filteredGestiones.length)," de ",i.filteredGestiones.length," registros "),s(2),p("disabled",i.currentPage===1),s(2),p("disabled",i.currentPage===1),s(2),p("ngForOf",i.getPageNumbers()),s(),p("disabled",i.currentPage===i.totalPages),s(2),p("disabled",i.currentPage===i.totalPages),s(6),p("options",i.pageSizeOptions),v("ngModel",i.pageSize)}}function Ve(a,l){a&1&&(n(0,"div",64)(1,"p",65),d(2,"No hay grabaciones para mostrar. Realiza una b\xFAsqueda para ver resultados."),o()())}var me=(()=>{let l=class l{constructor(e,t,r,m){this.gestionHistoricaAudiosService=e,this.ftpService=t,this.audioEvaluacionService=r,this.toastService=m,this.Volume2=te,this.FileSpreadsheet=Y,this.Download=K,this.Search=ee,this.Calendar=Z,this.X=ie,this.Math=Math,this.gestiones=[],this.filteredGestiones=[],this.paginatedGestiones=[],this.initialValue=[],this.currentPage=1,this.pageSize=5,this.totalPages=1,this.pageSizeOptions=[{label:"5",value:5},{label:"10",value:10},{label:"20",value:20}],this.startDate="",this.endDate="",this.documento="",this.telefono="",this.errorMessage="",this.filterDocumento="",this.filterTelefono="",this.filterCartera="",this.filterResultado="",this.resultados=[],this.tramos=[],this.tipoBusqueda=[{label:"Fechas",value:"fechas"},{label:"Documento",value:"documento"},{label:"Telefono",value:"telefono"}],this.selectedTipoBusqueda="fechas",this.selectedTramo="todos",this.sortField="",this.sortOrder=0,this.isLoading=!1,this.isDownloadingMassive=!1}ngOnInit(){this.tramos=[{label:"Todos",value:"todos"},{label:"Tramo 3",value:"FO_TRAMO 3"},{label:"Tramo 5",value:"FO_TRAMO 5"},{label:"Cartera Propia",value:"TRAMO"}],this.resultados=[{label:"Todos",value:""},{label:"FUERA DE SERVICIO - NO EXISTE",value:"FUERA DE SERVICIO - NO EXISTE"},{label:"APAGADO",value:"APAGADO"},{label:"NO CONTESTA",value:"NO CONTESTA"},{label:"MSJ VOZ - SMS - WSP - BAJO PUERTA",value:"MSJ VOZ - SMS - WSP - BAJO PUERTA"},{label:"EQUIVOCADO",value:"EQUIVOCADO"},{label:"CONTACTO CON TERCEROS",value:"CONTACTO CON TERCEROS"},{label:"CONTACTO CON TITULAR O ENCARGADO",value:"CONTACTO CON TITULAR O ENCARGADO"},{label:"OPORTUNIDAD DE PAGO",value:"OPORTUNIDAD DE PAGO"},{label:"FRACCIONADO O ARMADAS",value:"FRACCIONADO O ARMADAS"},{label:"PROMESA DE PAGO",value:"PROMESA DE PAGO"},{label:"RECORDATORIO DE PAGO",value:"RECORDATORIO DE PAGO"},{label:"CONFIRMACION DE ABONO",value:"CONFIRMACION DE ABONO"},{label:"CANCELACION PARCIAL",value:"CANCELACION PARCIAL"},{label:"CANCELACION TOTAL",value:"CANCELACION TOTAL"},{label:"CANCELACION NO REPORTADAS O APLICADAS",value:"CANCELACION NO REPORTADAS O APLICADAS"},{label:"FALLECIDO",value:"FALLECIDO"}]}changeTypeSearch(){this.startDate="",this.endDate="",this.documento="",this.telefono="",this.errorMessage=""}validateDates(){if(this.errorMessage="",this.startDate&&this.endDate){let e=new Date(this.startDate),t=new Date(this.endDate);if(e>t){this.errorMessage="La fecha de inicio debe ser anterior a la fecha de fin.";return}let r=Math.abs(t.getTime()-e.getTime());Math.ceil(r/(1e3*60*60*24))>2&&(this.errorMessage="La diferencia entre las fechas no puede ser mayor a 2 d\xEDas.")}else this.errorMessage="Por favor, selecciona ambas fechas."}searchByDates(){if(!this.startDate||!this.endDate){this.toastService.error("Por favor, selecciona ambas fechas.");return}if(this.errorMessage){this.toastService.error("Verificar la validaci\xF3n de las fechas.");return}this.isLoading=!0;let e={tramo:this.selectedTramo,startDate:this.startDate,endDate:this.endDate};this.gestionHistoricaAudiosService.getGestionHistoricaAudiosByDateRange(e).subscribe({next:t=>{this.gestiones=t,this.initialValue=[...t],this.applyFilters(),this.isLoading=!1,this.toastService.success(`Se encontraron ${t.length} grabaciones.`)},error:t=>{console.log(t),this.toastService.error("No se pudo cargar los datos."),this.isLoading=!1}})}searchByDocumento(){if(!this.documento){this.toastService.error("Por favor, ingresa un documento.");return}this.isLoading=!0;let e={tramo:this.selectedTramo,documento:this.documento};this.gestionHistoricaAudiosService.getGestionHistoricaAudiosByDocumento(e).subscribe({next:t=>{this.gestiones=t,this.initialValue=[...t],this.applyFilters(),this.isLoading=!1,this.toastService.success(`Se encontraron ${t.length} grabaciones.`)},error:t=>{console.log(t),this.toastService.error("No se pudo cargar los datos."),this.isLoading=!1}})}searchByTelefono(){if(!this.telefono){this.toastService.error("Por favor, ingresa un tel\xE9fono.");return}this.isLoading=!0;let e={tramo:this.selectedTramo,telefono:this.telefono};this.gestionHistoricaAudiosService.getGestionHistoricaAudiosByTelefono(e).subscribe({next:t=>{this.gestiones=t,this.initialValue=[...t],this.applyFilters(),this.isLoading=!1,this.toastService.success(`Se encontraron ${t.length} grabaciones.`)},error:t=>{console.log(t),this.toastService.error("No se pudo cargar los datos."),this.isLoading=!1}})}applyFilters(){let e=[...this.gestiones];this.filterDocumento&&(e=e.filter(t=>t.documento.toLowerCase().includes(this.filterDocumento.toLowerCase()))),this.filterTelefono&&(e=e.filter(t=>t.telefono.toLowerCase().includes(this.filterTelefono.toLowerCase()))),this.filterCartera&&(e=e.filter(t=>t.cartera===this.filterCartera)),this.filterResultado&&(e=e.filter(t=>t.resultado===this.filterResultado)),this.filteredGestiones=e,this.currentPage=1,this.updatePagination()}clearFilters(){this.filterDocumento="",this.filterTelefono="",this.filterCartera="",this.filterResultado="",this.applyFilters()}sort(e){if(this.sortField===e){if(this.sortOrder===1)this.sortOrder=-1;else if(this.sortOrder===-1){this.sortOrder=0,this.sortField="",this.filteredGestiones=[...this.gestiones],this.applyFilters();return}}else this.sortField=e,this.sortOrder=1;this.filteredGestiones.sort((t,r)=>{let m=t[e],u=r[e],_=0;return m==null&&u!=null?_=-1:m!=null&&u==null?_=1:m==null&&u==null?_=0:typeof m=="string"&&typeof u=="string"?_=m.localeCompare(u):_=m<u?-1:m>u?1:0,this.sortOrder*_}),this.updatePagination()}updatePagination(){this.totalPages=Math.ceil(this.filteredGestiones.length/this.pageSize),this.currentPage>this.totalPages&&(this.currentPage=1);let e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;this.paginatedGestiones=this.filteredGestiones.slice(e,t)}onPageSizeChange(e){this.pageSize=e,this.currentPage=1,this.updatePagination()}goToPage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e,this.updatePagination())}getPageNumbers(){let e=[],r=Math.max(1,this.currentPage-Math.floor(2.5)),m=Math.min(this.totalPages,r+5-1);m-r<4&&(r=Math.max(1,m-5+1));for(let u=r;u<=m;u++)e.push(u);return e}downloadAudio(e){let t=typeof e.anio=="string"?e.anio.split(","):[e.anio],r=typeof e.mes=="string"?e.mes.split(","):[e.mes],m=typeof e.dia=="string"?e.dia.split(","):[e.dia],u=typeof e.nombre=="string"?e.nombre.split(","):[e.nombre];for(let _=0;_<t.length;_++){let B=e.fechagestion.replace(/-/g,""),E={anio:t[_],mes:r[_],dia:m[_],nombre:u[_],fecha:B,resultado:e.resultado,telefono:e.telefono,documento:e.documento,cliente:e.cliente,asesor:e.usuarioregistra};this.ftpService.downloadGestionHistoricaAudioFileByName(E).subscribe({next:N=>{let U=window.URL.createObjectURL(N),O=document.createElement("a");O.href=U,_>0?O.download=`audio-${B}-${e.resultado}-${e.telefono}-${e.documento}-${e.cliente}-${e.usuarioregistra}(${_}).WAV`:O.download=`audio-${B}-${e.resultado}-${e.telefono}-${e.documento}-${e.cliente}-${e.usuarioregistra}.WAV`,document.body.appendChild(O),O.click(),window.URL.revokeObjectURL(U),document.body.removeChild(O),this.toastService.success("Audio descargado correctamente.")},error:N=>{this.toastService.error("No se encontr\xF3 el audio."),console.log(N)}})}}downloadReport(e){let t={dni:e.documento,cliente:e.cliente,telefono:e.telefono,fecha:e.fechagestion,asesor:e.usuarioregistra,resultado:e.resultado,gestionHistoricaAudioIdx:e.idx},r=e.fechagestion.replace(/-/g,"");this.audioEvaluacionService.downloadGestionHistoricaReporteFile(t).subscribe({next:m=>{let u=window.URL.createObjectURL(m),_=document.createElement("a");_.href=u,_.download=`reporte-${r}-${e.resultado}-${e.telefono}-${e.documento}-${e.cliente}-${e.usuarioregistra}.xlsx`,document.body.appendChild(_),_.click(),window.URL.revokeObjectURL(u),document.body.removeChild(_),this.toastService.success("Reporte descargado correctamente.")},error:m=>{this.toastService.error("No se encontr\xF3 el reporte en la base de datos."),console.log(m)}})}massiveDownloadAudios(){let e=this.filteredGestiones.length>0?this.filteredGestiones:this.gestiones;if(e.length===0){this.toastService.error("No hay datos para descargar.");return}this.isDownloadingMassive=!0,this.toastService.info("Procesando descarga masiva de audios...");let t=[];e.forEach(r=>{let m=typeof r.anio=="string"?r.anio.split(","):[r.anio],u=typeof r.mes=="string"?r.mes.split(","):[r.mes],_=typeof r.dia=="string"?r.dia.split(","):[r.dia],B=typeof r.nombre=="string"?r.nombre.split(","):[r.nombre];for(let E=0;E<m.length;E++){let N=r.fechagestion.replace(/-/g,""),U={anio:m[E],mes:u[E],dia:_[E],nombre:B[E],fecha:N,resultado:r.resultado,telefono:r.telefono,documento:r.documento,cliente:r.cliente,asesor:r.usuarioregistra};t.push(U)}}),this.ftpService.downloadGestionHistoricaAudioFiles(t).subscribe({next:r=>{let m=window.URL.createObjectURL(r),u=document.createElement("a");u.href=m,u.download="audios.zip",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(m),document.body.removeChild(u),this.isDownloadingMassive=!1,this.toastService.success("Los audios fueron descargados correctamente.")},error:r=>{console.log(r),this.isDownloadingMassive=!1,this.toastService.error("Un error ha ocurrido al realizar la descarga.")}})}massiveDownloadReports(){let e=this.filteredGestiones.length>0?this.filteredGestiones:this.gestiones;if(e.length===0){this.toastService.error("No hay datos para descargar.");return}this.isDownloadingMassive=!0,this.toastService.info("Procesando descarga masiva de reportes...");let t=[];e.forEach(r=>{let m={dni:r.documento,cliente:r.cliente,telefono:r.telefono,fecha:r.fechagestion,asesor:r.usuarioregistra,resultado:r.resultado,gestionHistoricaAudioIdx:r.idx};t.push(m)}),this.audioEvaluacionService.downloadGestionHistoricaReporteFiles(t).subscribe({next:r=>{let m=window.URL.createObjectURL(r),u=document.createElement("a");u.href=m,u.download="reportes.zip",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(m),document.body.removeChild(u),this.isDownloadingMassive=!1,this.toastService.success("Los reportes fueron descargados correctamente.")},error:r=>{console.log(r),this.isDownloadingMassive=!1,this.toastService.error("Un error ha ocurrido al realizar la descarga.")}})}canDownloadReport(e){return e==="PROMESA DE PAGO"||e==="CONTACTO CON TITULAR O ENCARGADO"}};l.\u0275fac=function(t){return new(t||l)(G(de),G(pe),G(ue),G(le))},l.\u0275cmp=H({type:l,selectors:[["app-recordings-tracker"]],decls:30,vars:17,consts:[["class","fixed inset-0 bg-black/50 flex items-center justify-center z-50",4,"ngIf"],[1,"bg-slate-800","p-3","rounded-lg","mb-3"],[1,"flex","gap-2","overflow-x-auto"],[1,"flex","flex-col","gap-1","w-[140px]","flex-shrink-0"],[1,"text-slate-400","text-xs","font-medium"],["placeholder","Seleccionar tramo",3,"ngModelChange","options","ngModel"],[1,"flex","flex-col","gap-1","w-[160px]","flex-shrink-0"],["placeholder","Tipo de b\xFAsqueda",3,"ngModelChange","selectionChange","options","ngModel"],["class","flex gap-2 items-end flex-shrink-0",4,"ngIf"],[1,"w-px","bg-slate-700","self-stretch","flex-shrink-0"],[1,"flex","gap-2","items-end","flex-shrink-0"],[1,"flex","flex-col","gap-1"],[1,"h-10","inline-flex","items-center","gap-1.5","px-3","bg-gradient-to-r","from-indigo-600","to-indigo-700","hover:from-indigo-700","hover:to-indigo-800","text-white","text-sm","font-medium","rounded","transition-all","hover:-translate-y-0.5","hover:shadow-lg","hover:shadow-indigo-500/40","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:translate-y-0","whitespace-nowrap","cursor-pointer",3,"click","disabled"],[3,"img","size"],[1,"h-10","inline-flex","items-center","gap-1.5","px-3","bg-gradient-to-r","from-emerald-600","to-emerald-700","hover:from-emerald-700","hover:to-emerald-800","text-white","text-sm","font-medium","rounded","transition-all","hover:-translate-y-0.5","hover:shadow-lg","hover:shadow-emerald-500/40","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:translate-y-0","whitespace-nowrap","cursor-pointer",3,"click","disabled"],["class","mt-2 p-2 bg-red-500/10 border border-red-500/30 text-red-400 rounded text-xs",4,"ngIf"],["class","bg-slate-800 p-3 rounded-lg",4,"ngIf"],["class","bg-slate-800 p-8 rounded-lg text-center",4,"ngIf"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50"],[1,"w-12","h-12","border-4","border-slate-700","border-t-blue-500","rounded-full","animate-spin"],[1,"flex","flex-col","gap-1","w-[150px]"],[1,"relative"],["type","date",1,"w-full","h-10","pl-3","pr-2","bg-slate-900","border","border-slate-700","rounded","text-slate-100","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],[1,"h-10","inline-flex","items-center","gap-1.5","px-3","bg-gradient-to-r","from-blue-600","to-blue-700","hover:from-blue-700","hover:to-blue-800","text-white","text-sm","font-medium","rounded","transition-all","hover:-translate-y-0.5","hover:shadow-lg","hover:shadow-blue-500/40","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:translate-y-0","whitespace-nowrap","cursor-pointer",3,"click"],[1,"flex","flex-col","gap-1","w-[180px]"],["type","text","placeholder","Ingrese documento",1,"w-full","h-10","px-3","bg-slate-900","border","border-slate-700","rounded","text-slate-100","text-sm","placeholder:text-slate-500","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],["type","text","placeholder","Ingrese tel\xE9fono",1,"w-full","h-10","px-3","bg-slate-900","border","border-slate-700","rounded","text-slate-100","text-sm","placeholder:text-slate-500","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"mt-2","p-2","bg-red-500/10","border","border-red-500/30","text-red-400","rounded","text-xs"],[1,"bg-slate-800","p-3","rounded-lg"],[1,"overflow-x-auto","rounded","border","border-slate-700"],[1,"w-full","border-collapse","text-xs"],[1,"bg-slate-900"],[1,"border-b","border-slate-700"],[1,"px-2","py-2"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-slate-500","pointer-events-none",3,"img","size"],["type","text","placeholder","DNI...",1,"w-full","pl-7","pr-2","py-1.5","bg-slate-800","border","border-slate-600","rounded","text-slate-100","text-xs","placeholder:text-slate-500","focus:outline-none","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","input","ngModel"],["placeholder","Filtrar...",3,"ngModelChange","selectionChange","options","ngModel","compact"],["type","text","placeholder","Tel\xE9fono...",1,"w-full","pl-7","pr-2","py-1.5","bg-slate-800","border","border-slate-600","rounded","text-slate-100","text-xs","placeholder:text-slate-500","focus:outline-none","focus:ring-1","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","input","ngModel"],[1,"px-2","py-2","text-center"],["title","Limpiar filtros",1,"inline-flex","items-center","justify-center","w-full","px-2","py-1.5","bg-slate-700","hover:bg-slate-600","text-slate-300","text-xs","rounded","transition-colors","cursor-pointer",3,"click"],[1,"px-2","py-2.5","text-left","text-slate-400","font-semibold","border-b-2","border-slate-700","whitespace-nowrap","cursor-pointer","select-none","hover:text-blue-400","transition-colors",3,"click"],["class","ml-1 text-[10px] text-blue-400",4,"ngIf"],[1,"px-2","py-2.5","text-left","text-slate-400","font-semibold","border-b-2","border-slate-700","whitespace-nowrap"],[1,"px-2","py-2.5","text-center","text-slate-400","font-semibold","border-b-2","border-slate-700","w-12"],["class","transition-colors even:bg-slate-900/30 hover:bg-blue-500/10",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","mt-3","gap-3","overflow-x-auto"],[1,"text-slate-400","text-xs","whitespace-nowrap","flex-shrink-0"],[1,"flex","gap-1.5","flex-shrink-0"],[1,"min-w-[28px]","px-2","py-1","bg-slate-700","hover:bg-slate-600","border","border-slate-600","disabled:opacity-50","disabled:cursor-not-allowed","text-slate-100","text-xs","rounded","transition-colors","cursor-pointer",3,"click","disabled"],["class","min-w-[28px] px-2 py-1 border text-white text-xs rounded transition-colors cursor-pointer",3,"bg-blue-600","border-blue-600","bg-slate-700","border-slate-600","hover:bg-slate-600","click",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2","flex-shrink-0"],[1,"text-slate-400","text-xs","whitespace-nowrap"],[1,"w-16"],[3,"ngModelChange","selectionChange","options","ngModel"],[1,"ml-1","text-[10px]","text-blue-400"],[1,"transition-colors","even:bg-slate-900/30","hover:bg-blue-500/10"],[1,"px-2","py-2","text-slate-200","border-b","border-slate-700"],[1,"px-2","py-2","border-b","border-slate-700"],[1,"inline-block","px-2","py-0.5","bg-blue-500/10","border","border-blue-500/30","text-blue-400","rounded","text-[10px]","font-medium","whitespace-nowrap"],[1,"px-2","py-2","text-center","border-b","border-slate-700"],["title","Descargar audio",1,"inline-flex","items-center","justify-center","w-7","h-7","bg-indigo-500/10","hover:bg-indigo-500/20","text-indigo-300","rounded","transition-all","hover:-translate-y-0.5","hover:shadow-md","hover:shadow-indigo-500/30","cursor-pointer",3,"click"],["class","inline-flex items-center justify-center w-7 h-7 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-300 rounded transition-all hover:-translate-y-0.5 hover:shadow-md hover:shadow-emerald-500/30 cursor-pointer","title","Descargar reporte",3,"click",4,"ngIf"],["title","Descargar reporte",1,"inline-flex","items-center","justify-center","w-7","h-7","bg-emerald-500/10","hover:bg-emerald-500/20","text-emerald-300","rounded","transition-all","hover:-translate-y-0.5","hover:shadow-md","hover:shadow-emerald-500/30","cursor-pointer",3,"click"],[1,"min-w-[28px]","px-2","py-1","border","text-white","text-xs","rounded","transition-colors","cursor-pointer",3,"click"],[1,"bg-slate-800","p-8","rounded-lg","text-center"],[1,"text-slate-400","text-sm"]],template:function(t,r){t&1&&(n(0,"div"),b(1,xe,2,0,"div",0),n(2,"div",1)(3,"div",2)(4,"div",3)(5,"label",4),d(6,"Tramo"),o(),n(7,"app-custom-select",5),w("ngModelChange",function(u){return C(r.selectedTramo,u)||(r.selectedTramo=u),u}),o()(),n(8,"div",6)(9,"label",4),d(10,"Tipo de B\xFAsqueda"),o(),n(11,"app-custom-select",7),w("ngModelChange",function(u){return C(r.selectedTipoBusqueda,u)||(r.selectedTipoBusqueda=u),u}),f("selectionChange",function(){return r.changeTypeSearch()}),o()(),b(12,be,14,4,"div",8)(13,ve,8,3,"div",8)(14,Ce,8,3,"div",8),x(15,"div",9),n(16,"div",10)(17,"div",11)(18,"label",4),d(19,"Descargar de forma masiva"),o(),n(20,"div",10)(21,"button",12),f("click",function(){return r.massiveDownloadAudios()}),x(22,"lucide-angular",13),d(23," Audios "),o(),n(24,"button",14),f("click",function(){return r.massiveDownloadReports()}),x(25,"lucide-angular",13),d(26," Reportes "),o()()()()(),b(27,we,2,1,"div",15),o(),b(28,Me,69,31,"div",16)(29,Ve,3,0,"div",17),o()),t&2&&(s(),p("ngIf",r.isLoading),s(6),p("options",r.tramos),v("ngModel",r.selectedTramo),s(4),p("options",r.tipoBusqueda),v("ngModel",r.selectedTipoBusqueda),s(),p("ngIf",r.selectedTipoBusqueda==="fechas"),s(),p("ngIf",r.selectedTipoBusqueda==="documento"),s(),p("ngIf",r.selectedTipoBusqueda==="telefono"),s(7),p("disabled",r.isDownloadingMassive||r.gestiones.length===0),s(),p("img",r.Volume2)("size",16),s(2),p("disabled",r.isDownloadingMassive||r.gestiones.length===0),s(),p("img",r.FileSpreadsheet)("size",16),s(2),p("ngIf",r.errorMessage),s(),p("ngIf",r.gestiones.length>0),s(),p("ngIf",r.gestiones.length===0&&!r.isLoading))},dependencies:[Q,X,J,ae,re,oe,ne,W,z,se],encapsulation:2});let a=l;return a})();var tt=(()=>{let l=class l{};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=H({type:l,selectors:[["app-recordings-page"]],decls:10,vars:1,consts:[[1,"min-h-screen","bg-slate-950","p-4"],[1,"flex","items-center","gap-2","mb-3"],[1,"w-8","h-8","bg-gradient-to-br","from-indigo-600","to-indigo-700","rounded-lg","flex","items-center","justify-center"],["name","headphones",1,"text-white!",3,"size"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-gray-400"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),x(3,"lucide-angular",3),o(),n(4,"div")(5,"h1",4),d(6,"Grabaciones Hist\xF3ricas"),o(),n(7,"p",5),d(8,"B\xFAsqueda y descarga de grabaciones de llamadas"),o()()(),x(9,"app-recordings-tracker"),o()),t&2&&(s(3),p("size",16))},dependencies:[me,W,z],encapsulation:2});let a=l;return a})();export{tt as RecordingsPageComponent};
