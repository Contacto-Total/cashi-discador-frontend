import{a as Y,b as ee,c as te,d as ie,e as ne,f as ae,g as re,h as oe,i as le,j as de,k as se,l as me,m as ce}from"./chunk-SJGC7I2I.js";import{a as X}from"./chunk-ZL45YB4K.js";import{Zb as J,_b as K}from"./chunk-NUMEWRMA.js";import{a as Q}from"./chunk-YQKVMPSG.js";import{Ac as v,Bc as M,E as j,Fb as C,Gb as y,Gc as B,Hc as H,Jb as $,Kb as L,Lb as p,Mb as e,Nb as t,Ob as d,Oc as U,Z as V,Zb as f,ab as n,ca as F,ga as N,gb as T,kc as A,lc as a,ld as Z,mc as g,md as q,nb as R,nc as w,oc as W,ud as G,xa as D,zc as x}from"./chunk-SN4XSKG7.js";var pe=(()=>{let l=class l{constructor(i){this.http=i,this.baseUrl=`${Q.gatewayUrl}/dashboard/payments`}getDashboard(){return console.log("[DASHBOARD] Obteniendo m\xE9tricas de pagos..."),this.http.get(this.baseUrl)}};l.\u0275fac=function(c){return new(c||l)(N(G))},l.\u0275prov=F({token:l,factory:l.\u0275fac,providedIn:"root"});let r=l;return r})();var be=(r,l)=>l.agenteId;function xe(r,l){r&1&&(e(0,"div",6),d(1,"div",8),t())}function he(r,l){if(r&1&&(e(0,"div",7),a(1),t()),r&2){let m=f();n(),w(" ",m.error()," ")}}function fe(r,l){if(r&1&&d(0,"canvas",41),r&2){let m=f(2);p("type","doughnut")("data",m.conciliacionChartData)("options",m.doughnutChartOptions())}}function ve(r,l){if(r&1&&d(0,"canvas",41),r&2){let m=f(2);p("type","doughnut")("data",m.promesasChartData)("options",m.doughnutChartOptions())}}function Ce(r,l){if(r&1&&d(0,"canvas",41),r&2){let m=f(2);p("type","line")("data",m.tendenciaChartData)("options",m.lineChartOptions())}}function ye(r,l){if(r&1&&(e(0,"div",54)(1,"div",57),a(2),t(),e(3,"div",58)(4,"p",59),a(5),t(),e(6,"p",60),a(7),x(8,"number"),t()(),e(9,"div",61)(10,"p",62),a(11),t(),e(12,"p",60),a(13),t()()()),r&2){let m=l.$implicit,i=l.$index,c=f(2);n(),A(i===0?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400":i===1?"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300":i===2?"bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400"),n(),w(" ",i+1," "),n(3),g(m.nombreAgente),n(2),W(" ",m.promesasRegistradas," promesas \xB7 ",M(8,8,m.tasaCumplimiento,"1.0-0"),"% cumplimiento "),n(4),g(c.formatCurrency(m.montoTotal)),n(2),w("",m.cantidadPagos," pagos")}}function ke(r,l){r&1&&(e(0,"div",55),d(1,"lucide-angular",63),e(2,"p"),a(3,"No hay datos de agentes"),t()()),r&2&&(n(),p("size",32))}function Se(r,l){if(r&1&&d(0,"canvas",41),r&2){let m=f(2);p("type","bar")("data",m.bancosChartData)("options",m.barChartOptions())}}function _e(r,l){if(r&1&&(e(0,"div",9)(1,"div",10)(2,"div",11)(3,"div")(4,"p",12),a(5,"Pagos Banco"),t(),e(6,"p",13),a(7),x(8,"number"),t(),e(9,"p",14),a(10),t()(),e(11,"div",15),d(12,"lucide-angular",16),t()()(),e(13,"div",10)(14,"div",11)(15,"div")(16,"p",12),a(17,"Conciliados"),t(),e(18,"p",17),a(19),x(20,"number"),t(),e(21,"p",18),a(22),t()(),e(23,"div",19),d(24,"lucide-angular",20),t()()(),e(25,"div",10)(26,"div",11)(27,"div")(28,"p",12),a(29,"Pagos Voluntarios"),t(),e(30,"p",21),a(31),x(32,"number"),t(),e(33,"p",22),a(34),t()(),e(35,"div",23),d(36,"lucide-angular",24),t()()(),e(37,"div",10)(38,"div",11)(39,"div")(40,"p",12),a(41,"Sin Verificar"),t(),e(42,"p",25),a(43),x(44,"number"),t(),e(45,"p",26),a(46),t()(),e(47,"div",27),d(48,"lucide-angular",28),t()()()(),e(49,"div",9)(50,"div",10)(51,"div",11)(52,"div")(53,"p",12),a(54,"Total Promesas"),t(),e(55,"p",13),a(56),x(57,"number"),t(),e(58,"p",29),a(59),t()(),e(60,"div",30),d(61,"lucide-angular",31),t()()(),e(62,"div",10)(63,"div",11)(64,"div")(65,"p",12),a(66,"Cumplidas"),t(),e(67,"p",17),a(68),x(69,"number"),t()(),e(70,"div",19),d(71,"lucide-angular",32),t()()(),e(72,"div",10)(73,"div",11)(74,"div")(75,"p",12),a(76,"Vencidas"),t(),e(77,"p",25),a(78),x(79,"number"),t()(),e(80,"div",27),d(81,"lucide-angular",33),t()()(),e(82,"div",10)(83,"div",11)(84,"div")(85,"p",12),a(86,"Tasa Cumplimiento"),t(),e(87,"p",34),a(88),x(89,"number"),t()(),e(90,"div",35),d(91,"lucide-angular",36),t()()()(),e(92,"div",37)(93,"div",10)(94,"h3",38),d(95,"lucide-angular",39),a(96," Estado de Conciliaci\xF3n "),t(),e(97,"div",40),C(98,fe,1,3,"canvas",41),t(),e(99,"div",42)(100,"div",43),d(101,"div",44),e(102,"span",45),a(103,"Conciliados"),t()(),e(104,"div",43),d(105,"div",46),e(106,"span",45),a(107,"Voluntarios"),t()(),e(108,"div",43),d(109,"div",47),e(110,"span",45),a(111,"Sin Verificar"),t()()()(),e(112,"div",10)(113,"h3",38),d(114,"lucide-angular",48),a(115," Estado de Promesas "),t(),e(116,"div",40),C(117,ve,1,3,"canvas",41),t(),e(118,"div",42)(119,"div",43),d(120,"div",44),e(121,"span",45),a(122,"Cumplidas"),t()(),e(123,"div",43),d(124,"div",49),e(125,"span",45),a(126,"Pendientes"),t()(),e(127,"div",43),d(128,"div",47),e(129,"span",45),a(130,"Vencidas"),t()()()()(),e(131,"div",37)(132,"div",10)(133,"h3",38),d(134,"lucide-angular",50),a(135," Tendencia de Pagos (\xDAltimos 30 d\xEDas) "),t(),e(136,"div",51),C(137,Ce,1,3,"canvas",41),t()(),e(138,"div",10)(139,"h3",38),d(140,"lucide-angular",52),a(141," Top Agentes por Monto "),t(),e(142,"div",53),$(143,ye,14,11,"div",54,be,!1,ke,4,1,"div",55),t()()(),e(146,"div",10)(147,"h3",38),d(148,"lucide-angular",56),a(149," Distribuci\xF3n por Banco "),t(),e(150,"div",51),C(151,Se,1,3,"canvas",41),t()()),r&2){let m,i,c,b,o,u,k,S,h,_,E,P,z,I,O,s=f();n(7),g(v(8,33,(m=s.dashboard())==null?null:m.totalPagosBanco)),n(3),g(s.formatCurrency((i=s.dashboard())==null?null:i.montoTotalBanco)),n(2),p("size",24),n(7),g(v(20,35,(c=s.dashboard())==null?null:c.pagosConciliados)),n(3),g(s.formatCurrency((b=s.dashboard())==null?null:b.montoConciliado)),n(2),p("size",24),n(7),g(v(32,37,(o=s.dashboard())==null?null:o.pagosPorFuera)),n(3),g(s.formatCurrency((u=s.dashboard())==null?null:u.montoPorFuera)),n(2),p("size",24),n(7),g(v(44,39,(k=s.dashboard())==null?null:k.pagosNoVerificados)),n(3),g(s.formatCurrency((S=s.dashboard())==null?null:S.montoNoVerificado)),n(2),p("size",24),n(8),g(v(57,41,(h=s.dashboard())==null?null:h.totalPromesas)),n(3),g(s.formatCurrency((_=s.dashboard())==null?null:_.montoPrometido)),n(2),p("size",24),n(7),g(v(69,43,(E=s.dashboard())==null?null:E.promesasCumplidas)),n(3),p("size",24),n(7),g(v(79,45,(P=s.dashboard())==null?null:P.promesasVencidas)),n(3),p("size",24),n(6),A(s.getTasaClass(((z=s.dashboard())==null?null:z.tasaCumplimiento)||0)),n(),w(" ",M(89,47,(I=s.dashboard())==null?null:I.tasaCumplimiento,"1.1-1"),"% "),n(3),p("size",24),n(4),p("size",20),n(3),y(s.showCharts()?98:-1),n(16),p("size",20),n(3),y(s.showCharts()?117:-1),n(17),p("size",20),n(3),y(s.showCharts()?137:-1),n(3),p("size",20),n(3),L((O=s.dashboard())==null?null:O.topAgentes),n(5),p("size",20),n(3),y(s.showCharts()?151:-1)}}ie.register(ee,ne,Y,oe,te,ae,re,se,me,de,le);var Fe=(()=>{let l=class l{constructor(i,c,b){this.dashboardService=i,this.themeService=c,this.cdr=b,this.dashboard=D(null),this.loading=D(!0),this.error=D(null),this.showCharts=D(!0),this.isDark=B(()=>this.themeService.isDarkMode()),this.doughnutChartOptions=B(()=>{let o=this.themeService.isDarkMode(),u=o?"#e2e8f0":"#1f2937";return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:o?"#1e293b":"#ffffff",titleColor:u,bodyColor:u,borderColor:o?"#334155":"#d1d5db",borderWidth:1,callbacks:{label:h=>{let _=h.parsed||0,E=h.dataset.data.reduce((z,I)=>z+I,0),P=E>0?(_/E*100).toFixed(1):"0";return`${h.label}: ${_} (${P}%)`}}}}}}),this.lineChartOptions=B(()=>{let o=this.themeService.isDarkMode(),u=o?"#e2e8f0":"#1f2937";return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{color:u}},tooltip:{backgroundColor:o?"#1e293b":"#ffffff",titleColor:u,bodyColor:u,borderColor:o?"#334155":"#d1d5db",borderWidth:1}},scales:{y:{beginAtZero:!0,grid:{color:o?"rgba(148, 163, 184, 0.2)":"rgba(107, 114, 128, 0.3)"},ticks:{color:u}},x:{grid:{display:!1},ticks:{color:u}}}}}),this.barChartOptions=B(()=>{let o=this.themeService.isDarkMode(),u=o?"#e2e8f0":"#1f2937";return{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1},tooltip:{backgroundColor:o?"#1e293b":"#ffffff",titleColor:u,bodyColor:u,borderColor:o?"#334155":"#d1d5db",borderWidth:1}},scales:{x:{beginAtZero:!0,grid:{color:o?"rgba(148, 163, 184, 0.2)":"rgba(107, 114, 128, 0.3)"},ticks:{color:u}},y:{grid:{display:!1},ticks:{color:u}}}}}),this.conciliacionChartData={labels:[],datasets:[]},this.promesasChartData={labels:[],datasets:[]},this.tendenciaChartData={labels:[],datasets:[]},this.bancosChartData={labels:[],datasets:[]},H(()=>{let o=this.themeService.isDarkMode();console.log("[DASHBOARD] Tema detectado:",o?"dark":"light"),this.showCharts.set(!1),this.cdr.detectChanges(),setTimeout(()=>{this.showCharts.set(!0),this.cdr.detectChanges()},50)})}ngOnInit(){this.loadDashboard(),this.startPolling()}ngOnDestroy(){this.pollingSubscription?.unsubscribe()}loadDashboard(){this.loading.set(!0),this.error.set(null),this.dashboardService.getDashboard().subscribe({next:i=>{this.dashboard.set(i),this.updateCharts(i),this.loading.set(!1)},error:i=>{console.error("[DASHBOARD] Error cargando dashboard:",i),this.error.set("Error al cargar el dashboard. Intente nuevamente."),this.loading.set(!1)}})}startPolling(){this.pollingSubscription=j(6e4).pipe(V(()=>this.dashboardService.getDashboard())).subscribe({next:i=>{this.dashboard.set(i),this.updateCharts(i)},error:i=>console.error("[DASHBOARD] Error en polling:",i)})}updateCharts(i){this.conciliacionChartData={labels:["Conciliados","Voluntarios","Sin Verificar"],datasets:[{data:[i.pagosConciliados,i.pagosPorFuera,i.pagosNoVerificados],backgroundColor:["#22c55e","#f59e0b","#ef4444"],borderWidth:0}]},this.promesasChartData={labels:["Cumplidas","Pendientes","Vencidas"],datasets:[{data:[i.promesasCumplidas,i.promesasPendientes,i.promesasVencidas],backgroundColor:["#22c55e","#3b82f6","#ef4444"],borderWidth:0}]};let c=[...i.tendenciaDiaria||[]].reverse().slice(-15);this.tendenciaChartData={labels:c.map(o=>this.formatDate(o.fecha)),datasets:[{label:"Banco",data:c.map(o=>o.cantidadBanco),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.4},{label:"Agente",data:c.map(o=>o.cantidadAgente),borderColor:"#22c55e",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0,tension:.4}]};let b=i.distribucionBancos||[];this.bancosChartData={labels:b.map(o=>o.banco||"OTRO"),datasets:[{data:b.map(o=>o.monto),backgroundColor:["#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef"],borderWidth:0}]}}formatCurrency(i){return i==null?"S/ 0.00":"S/ "+i.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})}formatDate(i){if(!i)return"";let c=i.split(/[\/\-]/);return c.length>=2?`${c[0]}/${c[1]}`:i}getTasaClass(i){return i>=70?"text-green-600 dark:text-green-400":i>=40?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}};l.\u0275fac=function(c){return new(c||l)(T(pe),T(X),T(U))},l.\u0275cmp=R({type:l,selectors:[["app-payments-dashboard"]],decls:11,vars:2,consts:[[1,"min-h-screen","bg-gray-50","dark:bg-slate-900","p-6"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white","flex","items-center","gap-3"],[1,"w-10","h-10","bg-gradient-to-br","from-blue-500","to-indigo-600","rounded-xl","flex","items-center","justify-center"],["name","bar-chart-3",1,"text-white",3,"size"],[1,"text-gray-500","dark:text-gray-400","mt-1"],[1,"flex","items-center","justify-center","h-64"],[1,"bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-800","rounded-lg","p-4","text-red-700","dark:text-red-300"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-500"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4","mb-6"],[1,"bg-white","dark:bg-slate-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-slate-700","p-5"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white"],[1,"text-sm","text-blue-600","dark:text-blue-400","font-medium"],[1,"w-12","h-12","bg-blue-100","dark:bg-blue-900/30","rounded-full","flex","items-center","justify-center"],["name","building-2",1,"text-blue-600","dark:text-blue-400",3,"size"],[1,"text-2xl","font-bold","text-green-600","dark:text-green-400"],[1,"text-sm","text-green-600","dark:text-green-400","font-medium"],[1,"w-12","h-12","bg-green-100","dark:bg-green-900/30","rounded-full","flex","items-center","justify-center"],["name","check-circle",1,"text-green-600","dark:text-green-400",3,"size"],[1,"text-2xl","font-bold","text-amber-600","dark:text-amber-400"],[1,"text-sm","text-amber-600","dark:text-amber-400","font-medium"],[1,"w-12","h-12","bg-amber-100","dark:bg-amber-900/30","rounded-full","flex","items-center","justify-center"],["name","user-check",1,"text-amber-600","dark:text-amber-400",3,"size"],[1,"text-2xl","font-bold","text-red-600","dark:text-red-400"],[1,"text-sm","text-red-600","dark:text-red-400","font-medium"],[1,"w-12","h-12","bg-red-100","dark:bg-red-900/30","rounded-full","flex","items-center","justify-center"],["name","alert-triangle",1,"text-red-600","dark:text-red-400",3,"size"],[1,"text-sm","text-indigo-600","dark:text-indigo-400","font-medium"],[1,"w-12","h-12","bg-indigo-100","dark:bg-indigo-900/30","rounded-full","flex","items-center","justify-center"],["name","handshake",1,"text-indigo-600","dark:text-indigo-400",3,"size"],["name","badge-check",1,"text-green-600","dark:text-green-400",3,"size"],["name","clock",1,"text-red-600","dark:text-red-400",3,"size"],[1,"text-2xl","font-bold"],[1,"w-12","h-12","bg-purple-100","dark:bg-purple-900/30","rounded-full","flex","items-center","justify-center"],["name","trending-up",1,"text-purple-600","dark:text-purple-400",3,"size"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-6"],[1,"text-lg","font-semibold","text-gray-800","dark:text-white","mb-4","flex","items-center","gap-2"],["name","pie-chart",1,"text-blue-500",3,"size"],[1,"h-64","flex","items-center","justify-center"],["baseChart","",3,"type","data","options"],[1,"mt-4","flex","flex-wrap","justify-center","gap-4"],[1,"flex","items-center","gap-2"],[1,"w-3","h-3","rounded-full","bg-green-500"],[1,"text-sm","text-gray-600","dark:text-gray-400"],[1,"w-3","h-3","rounded-full","bg-amber-500"],[1,"w-3","h-3","rounded-full","bg-red-500"],["name","target",1,"text-indigo-500",3,"size"],[1,"w-3","h-3","rounded-full","bg-blue-500"],["name","trending-up",1,"text-green-500",3,"size"],[1,"h-64"],["name","trophy",1,"text-yellow-500",3,"size"],[1,"space-y-3","max-h-72","overflow-y-auto"],[1,"flex","items-center","gap-3","p-3","rounded-lg","bg-gray-50","dark:bg-slate-700/50"],[1,"text-center","py-8","text-gray-500","dark:text-gray-400"],["name","landmark",1,"text-blue-500",3,"size"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","text-sm","font-bold"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-gray-800","dark:text-white","truncate"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-right"],[1,"text-sm","font-bold","text-green-600","dark:text-green-400"],["name","users",1,"mx-auto","mb-2","opacity-50",3,"size"]],template:function(c,b){c&1&&(e(0,"div",0)(1,"div",1)(2,"h1",2)(3,"div",3),d(4,"lucide-angular",4),t(),a(5," Dashboard de Pagos y Conciliaci\xF3n "),t(),e(6,"p",5),a(7,"M\xE9tricas consolidadas de pagos bancarios, agentes y promesas"),t()(),C(8,xe,2,0,"div",6)(9,he,2,1,"div",7)(10,_e,152,50),t()),c&2&&(n(4),p("size",24),n(4),y(b.loading()?8:b.error()?9:10))},dependencies:[q,K,J,ce,Z],styles:["[_nghost-%COMP%]{display:block}"]});let r=l;return r})();export{Fe as PaymentsDashboardComponent};
