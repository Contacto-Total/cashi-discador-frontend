import{A as Se,B as ve,E as ae,b as Ce,c as te,f as ne,k as ie,m as oe,s as ye,t as be,u as we,v as Me,w as re,x as ke,y as Fe,z as De}from"./chunk-7GV7UZOL.js";import{Rb as xe,Sb as he}from"./chunk-FO4EYWPG.js";import{a as F}from"./chunk-YQKVMPSG.js";import{$ as H,Eb as pe,Fb as h,Fc as fe,Gb as C,Gc as z,Hb as ue,Hc as G,I as U,Ib as me,Jb as A,Kb as V,Kc as de,Lb as x,Lc as j,Mb as c,Nb as d,Ob as R,Vb as y,Xb as T,Zb as a,a as O,ab as p,ca as K,ga as Q,jc as ge,kc as J,lc as g,mc as P,md as Z,na as _,nb as X,nc as W,oa as f,oc as _e,qc as w,r as q,rc as M,sc as k,td as E,ud as ee,vb as le,xa as S}from"./chunk-SN4XSKG7.js";var Ae=(o,l)=>l.field,Ve=(o,l)=>l.numeroCuota;function Re(o,l){if(o&1&&(c(0,"span",12),g(1),d()),o&2){let n=a().$implicit;J(n.restriccionFecha==="DENTRO_MES"?"bg-amber-100 dark:bg-amber-900/50 text-amber-700 dark:text-amber-300":"bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300"),p(),W(" ",n.restriccionFecha==="DENTRO_MES"?"Este mes":"Pr\xF3x. mes+"," ")}}function Ee(o,l){if(o&1){let n=y();c(0,"button",8),T("click",function(){let t=_(n).$implicit,i=a();return f(i.selectAmount(t.value,t.field,t.restriccionFecha))}),c(1,"span",9),g(2),d(),c(3,"span",10),g(4),d(),h(5,Re,2,3,"span",11),d()}if(o&2){let n=l.$implicit,e=a();J("flex flex-col items-center p-3 border-2 rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md "+(e.selectedField()===n.field&&!e.isCustomAmount()?"border-blue-500 bg-blue-500 dark:bg-blue-600 text-white shadow-lg shadow-blue-500/30":"border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:border-blue-400 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-slate-600")),p(2),P(n.label),p(2),P(e.formatCurrency(n.value)),p(),C(n.restriccionFecha&&n.restriccionFecha!=="SIN_RESTRICCION"?5:-1)}}function Pe(o,l){if(o&1){let n=y();c(0,"input",16),k("ngModelChange",function(t){_(n);let i=a(2);return M(i.customAmountValue,t)||(i.customAmountValue=t),f(t)}),T("ngModelChange",function(t){_(n);let i=a(2);return f(i.onCustomAmountChange(t))})("click",function(t){return _(n),f(t.stopPropagation())}),d()}if(o&2){let n=a(2);w("ngModel",n.customAmountValue)}}function Ie(o,l){o&1&&R(0,"lucide-angular",15),o&2&&x("size",16)}function qe(o,l){if(o&1){let n=y();c(0,"button",8),T("click",function(){_(n);let t=a();return f(t.enableCustomAmount())}),c(1,"span",13),g(2,"Otro monto"),d(),h(3,Pe,1,1,"input",14)(4,Ie,1,1,"lucide-angular",15),d()}if(o&2){let n=a();J("flex flex-col items-center p-3 border-2 rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md "+(n.isCustomAmount()?"border-purple-500 bg-purple-500 dark:bg-purple-600 text-white shadow-lg shadow-purple-500/30":"border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:border-purple-400 dark:hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-slate-600")),p(3),C(n.isCustomAmount()?3:4)}}function Ue(o,l){if(o&1){let n=y();c(0,"button",8),T("click",function(){let t=_(n).$implicit,i=a(2);return f(i.setInstallments(t))}),g(1),d()}if(o&2){let n=l.$implicit,e=a(2);J("px-4 py-2 border-2 rounded-lg cursor-pointer transition-all duration-200 text-sm font-medium hover:shadow-md "+(e.numberOfInstallments()===n?"border-emerald-500 bg-emerald-500 dark:bg-emerald-600 text-white shadow-lg shadow-emerald-500/30":"border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:border-emerald-400 dark:hover:border-emerald-500 hover:bg-emerald-50 dark:hover:bg-slate-600")),p(),_e(" ",n," ",n===1?"cuota":"cuotas"," ")}}function Ne(o,l){if(o&1&&(c(0,"div",1)(1,"label",2)(2,"div",17),R(3,"lucide-angular",18),d(),g(4," N\xFAmero de Cuotas "),d(),c(5,"div",19),A(6,Ue,2,4,"button",6,me),d()()),o&2){let n=a();p(3),x("size",14),p(3),V(n.installmentOptions)}}function Oe(o,l){if(o&1&&(c(0,"div",31),R(1,"lucide-angular",32),c(2,"span"),g(3),d()()),o&2){let n=a(2);J(n.selectedRestriccion()==="DENTRO_MES"?"bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300 border border-amber-200 dark:border-amber-800":"bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 border border-purple-200 dark:border-purple-800"),p(),x("size",14),p(2),P(n.dateRestrictionInfo().message)}}function We(o,l){if(o&1){let n=y();c(0,"div",24)(1,"div",33),R(2,"lucide-angular",34),g(3),d(),c(4,"div",27)(5,"label",35),g(6,"Monto:"),d(),c(7,"input",36),k("ngModelChange",function(t){let i=_(n).$implicit;return M(i.monto,t)||(i.monto=t),f(t)}),T("ngModelChange",function(){let t=_(n).$implicit,i=a(2);return f(i.onInstallmentAmountChange(t.numeroCuota))}),d()(),c(8,"div",27)(9,"label",35),g(10,"Fecha:"),d(),c(11,"input",37),k("ngModelChange",function(t){let i=_(n).$implicit;return M(i.fechaPago,t)||(i.fechaPago=t),f(t)}),T("ngModelChange",function(){_(n);let t=a(2);return f(t.onInstallmentChange())}),d()()()}if(o&2){let n=l.$implicit,e=a(2);p(2),x("size",14),p(),W(" Cuota ",n.numeroCuota," "),p(4),w("ngModel",n.monto),x("min",1),p(4),w("ngModel",n.fechaPago),x("min",e.dateRestrictionInfo().minDate)("max",e.dateRestrictionInfo().maxDate)}}function Le(o,l){if(o&1&&(c(0,"div",30)(1,"span"),g(2,"Monto por cuota:"),d(),c(3,"span",38),g(4),d()()),o&2){let n=a(2);p(4),P(n.formatCurrency(n.amountPerInstallment()))}}function Be(o,l){if(o&1&&(c(0,"div",7)(1,"label",2)(2,"div",20),R(3,"lucide-angular",21),d(),g(4," Detalle del Cronograma "),d(),h(5,Oe,4,4,"div",22),c(6,"div",23),A(7,We,12,7,"div",24,Ve),d(),c(9,"div",25)(10,"div",26)(11,"span",27),R(12,"lucide-angular",28),g(13," Monto Total: "),d(),c(14,"span",29),g(15),d()(),h(16,Le,5,1,"div",30),d()()),o&2){let n=a();p(3),x("size",14),p(2),C(n.dateRestrictionInfo().message?5:-1),p(2),V(n.installments()),p(5),x("size",16),p(3),P(n.formatCurrency(n.totalAmount())),p(),C(n.numberOfInstallments()>1?16:-1)}}var Te=(()=>{let l=class l{constructor(){this.availableAmounts=j([]),this.maxInstallments=6,this.scheduleChange=new le,this.customAmountSelected=new le,this.selectedAmount=S(0),this.selectedField=S(void 0),this.selectedRestriccion=S("SIN_RESTRICCION"),this.numberOfInstallments=S(1),this.installments=S([]),this.customAmountValue=0,this._isCustomAmount=S(!1),this.amountOptions=z(()=>this.availableAmounts()),this.dateRestrictionInfo=z(()=>{let e=this.selectedRestriccion(),t=new Date,i=t.getMonth(),r=t.getFullYear(),s=new Date(r,i+1,0),m=new Date(r,i+1,1),u=b=>{let N=b.getFullYear(),L=String(b.getMonth()+1).padStart(2,"0"),I=String(b.getDate()).padStart(2,"0");return`${N}-${L}-${I}`};switch(e){case"DENTRO_MES":return{minDate:u(t),maxDate:u(s),message:`Solo fechas dentro del mes actual (hasta ${s.toLocaleDateString("es-PE")})`};case"FUERA_MES":return{minDate:u(m),maxDate:void 0,message:`Solo fechas a partir del ${m.toLocaleDateString("es-PE")}`};default:return{minDate:u(t),maxDate:void 0,message:void 0}}}),this.regularAmountOptions=z(()=>this.availableAmounts().filter(e=>e.field!=="personalizado")),this.hasCustomOption=z(()=>this.availableAmounts().some(e=>e.field==="personalizado")),this.totalAmount=z(()=>this.installments().reduce((e,t)=>e+(t.monto||0),0)),this.amountPerInstallment=z(()=>{let e=this.numberOfInstallments(),t=this.selectedAmount();return e>0?t/e:0}),this.installmentOptions=[],this.minDate="",this.MIN_CUOTA_AMOUNT=1}ngOnInit(){this.installmentOptions=Array.from({length:this.maxInstallments},(t,i)=>i+1);let e=new Date;this.minDate=this.formatDateToYYYYMMDD(e)}isCustomAmount(){return this._isCustomAmount()}selectAmount(e,t,i){this._isCustomAmount.set(!1),this.selectedAmount.set(e),this.selectedField.set(t),this.selectedRestriccion.set(i||"SIN_RESTRICCION"),this.generateInstallments(),this.customAmountSelected.emit(!1)}getRestriccionForField(e){return this.availableAmounts().find(i=>i.field===e)?.restriccionFecha||"SIN_RESTRICCION"}enableCustomAmount(){this._isCustomAmount.set(!0),this.selectedField.set(void 0),this.customAmountSelected.emit(!0),this.customAmountValue>0&&(this.selectedAmount.set(this.customAmountValue),this.generateInstallments())}onCustomAmountChange(e){this.customAmountValue=e,this.selectedAmount.set(e),this.generateInstallments()}setInstallments(e){this.numberOfInstallments.set(e),this.generateInstallments()}generateInstallments(){let e=this.selectedAmount(),t=this.numberOfInstallments();if(e<=0||t<=0){this.installments.set([]),this.emitChange();return}let i=Math.floor(e/t*100)/100,r=Math.round((e-i*t)*100)/100,s=[],m=this.selectedRestriccion(),u,b=new Date,N=b.getMonth(),L=b.getFullYear();m==="FUERA_MES"?u=new Date(L,N+1,1):(u=new Date(b),u.setDate(u.getDate()+1));let I=m==="DENTRO_MES"?new Date(L,N+1,0):null;for(let $=0;$<t;$++){let D;if(m==="DENTRO_MES"&&I){let B=Math.max(1,I.getDate()-u.getDate()),Y=Math.floor(B/t);D=new Date(u),D.setDate(u.getDate()+Y*$),D>I&&(D=new Date(I))}else m==="FUERA_MES"?(D=new Date(u),D.setDate(D.getDate()+30*$)):(D=new Date(b),D.setDate(D.getDate()+30*($+1)));let v=$===t-1?i+r:i;s.push({numeroCuota:$+1,monto:v,fechaPago:this.formatDateToYYYYMMDD(D)})}this.installments.set(s),this.emitChange()}onInstallmentChange(){this.emitChange()}onInstallmentAmountChange(e){let t=this.installments(),i=this.selectedAmount(),r=t.length,s=e-1,m=t[s];m.monto<this.MIN_CUOTA_AMOUNT&&(m.monto=this.MIN_CUOTA_AMOUNT);let u=0;for(let v=0;v<s;v++)u+=t[v].monto||0;let N=(r-e)*this.MIN_CUOTA_AMOUNT,L=i-u-N;if(m.monto>L&&(m.monto=Math.max(this.MIN_CUOTA_AMOUNT,Math.floor(L*100)/100)),e>=r){this.installments.set([...t]),this.emitChange();return}let I=0;for(let v=0;v<e;v++)I+=t[v].monto||0;let $=i-I,D=r-e;if($<D*this.MIN_CUOTA_AMOUNT){let v=Math.floor($/D*100)/100;for(let B=e;B<r;B++)t[B].monto=Math.max(this.MIN_CUOTA_AMOUNT,v)}else{let v=Math.floor($/D*100)/100,B=Math.round(($-v*D)*100)/100;for(let Y=e;Y<r;Y++)t[Y].monto=Y===r-1?v+B:v}this.installments.set([...t]),this.emitChange()}emitChange(){let e=this.installments();if(e.length===0){this.scheduleChange.emit(null);return}let t={montoTotal:this.selectedAmount(),numeroCuotas:this.numberOfInstallments(),cuotas:e,campoMontoOrigen:this.selectedField()};this.scheduleChange.emit(t)}formatCurrency(e){return new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(e)}formatDateToYYYYMMDD(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=X({type:l,selectors:[["app-payment-schedule"]],inputs:{availableAmounts:[1,"availableAmounts"],maxInstallments:"maxInstallments"},outputs:{scheduleChange:"scheduleChange",customAmountSelected:"customAmountSelected"},decls:12,vars:4,consts:[[1,"payment-schedule-container","bg-slate-100","dark:bg-slate-800/50","border","border-slate-200","dark:border-slate-700","rounded-xl","p-4","transition-colors","duration-300"],[1,"field-group","mb-5"],[1,"flex","items-center","gap-2","font-semibold","text-slate-700","dark:text-slate-200","text-sm","mb-3","transition-colors","duration-300"],[1,"w-6","h-6","bg-emerald-100","dark:bg-emerald-900/50","rounded-lg","flex","items-center","justify-center","transition-colors","duration-300"],["name","wallet",1,"text-emerald-600","dark:text-emerald-400",3,"size"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-4","xl:grid-cols-6","gap-2"],["type","button",3,"class"],[1,"field-group"],["type","button",3,"click"],[1,"text-[10px]","opacity-70","leading-tight","text-center"],[1,"text-sm","font-bold","mt-1"],[1,"text-[8px]","mt-1","px-1.5","py-0.5","rounded-full",3,"class"],[1,"text-[8px]","mt-1","px-1.5","py-0.5","rounded-full"],[1,"text-[10px]","opacity-70"],["type","number","placeholder","0.00","min","0","step","0.01",1,"w-full","mt-1","px-2","py-1","border","border-white/30","rounded","text-center","text-sm","font-bold","bg-white/90","dark:bg-slate-800","text-slate-800","dark:text-white",3,"ngModel"],["name","edit-3",1,"mt-1",3,"size"],["type","number","placeholder","0.00","min","0","step","0.01",1,"w-full","mt-1","px-2","py-1","border","border-white/30","rounded","text-center","text-sm","font-bold","bg-white/90","dark:bg-slate-800","text-slate-800","dark:text-white",3,"ngModelChange","click","ngModel"],[1,"w-6","h-6","bg-blue-100","dark:bg-blue-900/50","rounded-lg","flex","items-center","justify-center","transition-colors","duration-300"],["name","calendar-days",1,"text-blue-600","dark:text-blue-400",3,"size"],[1,"flex","flex-wrap","gap-2"],[1,"w-6","h-6","bg-amber-100","dark:bg-amber-900/50","rounded-lg","flex","items-center","justify-center","transition-colors","duration-300"],["name","list-ordered",1,"text-amber-600","dark:text-amber-400",3,"size"],[1,"mb-3","px-3","py-2","rounded-lg","text-xs","flex","items-center","gap-2",3,"class"],[1,"bg-white","dark:bg-slate-700/50","rounded-xl","border","border-slate-200","dark:border-slate-600","overflow-hidden","transition-colors","duration-300"],[1,"grid","grid-cols-1","sm:grid-cols-[100px_1fr_1fr]","gap-3","p-3","border-b","border-slate-100","dark:border-slate-600","last:border-b-0","items-center","transition-colors","duration-300"],[1,"mt-4","p-4","bg-emerald-50","dark:bg-emerald-900/30","rounded-xl","border","border-emerald-200","dark:border-emerald-800","transition-colors","duration-300"],[1,"flex","justify-between","items-center","text-sm","text-emerald-700","dark:text-emerald-300"],[1,"flex","items-center","gap-2"],["name","calculator",3,"size"],[1,"text-lg","font-bold"],[1,"flex","justify-between","items-center","text-sm","text-emerald-600","dark:text-emerald-400","mt-2","pt-2","border-t","border-emerald-200","dark:border-emerald-700"],[1,"mb-3","px-3","py-2","rounded-lg","text-xs","flex","items-center","gap-2"],["name","info",3,"size"],[1,"font-bold","text-blue-600","dark:text-blue-400","text-sm","flex","items-center","gap-2"],["name","hash",3,"size"],[1,"text-xs","text-slate-500","dark:text-slate-400","min-w-[50px]"],["type","number","step","0.01",1,"flex-1","px-3","py-2","border","border-slate-200","dark:border-slate-500","rounded-lg","text-sm","bg-slate-50","dark:bg-slate-600","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","duration-200",3,"ngModelChange","ngModel","min"],["type","date",1,"flex-1","px-3","py-2","border","border-slate-200","dark:border-slate-500","rounded-lg","text-sm","bg-slate-50","dark:bg-slate-600","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","duration-200",3,"ngModelChange","ngModel","min","max"],[1,"font-semibold"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"div",1)(2,"label",2)(3,"div",3),R(4,"lucide-angular",4),d(),g(5," Seleccionar Monto "),d(),c(6,"div",5),A(7,Ee,6,5,"button",6,Ae),h(9,qe,5,3,"button",6),d()(),h(10,Ne,8,1,"div",1),h(11,Be,17,5,"div",7),d()),t&2&&(p(4),x("size",14),p(3),V(i.regularAmountOptions()),p(2),C(i.hasCustomOption()?9:-1),p(),C(i.selectedAmount()>0?10:-1),p(),C(i.installments().length>0?11:-1))},dependencies:[Z,ae,te,oe,ne,re,ie,he,xe],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out forwards}input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{filter:invert(0)}html.dark[_nghost-%COMP%]   input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator, html.dark   [_nghost-%COMP%]   input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{filter:invert(1)}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{opacity:1}"]});let o=l;return o})();var ce=(o,l)=>l.id,ze=(o,l)=>l.value,je=(o,l)=>l.value||l;function Ye(o,l){o&1&&(c(0,"span",6),g(1,"*"),d())}function He(o,l){if(o&1&&(c(0,"p",7),g(1),d()),o&2){let n=a().$implicit;p(),P(n.helpText)}}function Je(o,l){if(o&1){let n=y();c(0,"input",21),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);w("ngModel",e.fieldData()[n.id]),x("placeholder",n.placeholder||"")("required",n.required??!1)("minlength",n.minLength??null)("maxlength",n.maxLength??null)}}function Ge(o,l){if(o&1){let n=y();c(0,"input",22),T("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return f(r.updateFieldValue(i.id,t))}),d()}if(o&2){let n=a().$implicit,e=a(2);x("ngModel",e.fieldData()[n.id])("placeholder",n.placeholder||"")("required",n.required??!1)("min",n.min??null)("max",n.max??null)}}function Ke(o,l){if(o&1){let n=y();c(0,"div",10)(1,"span",23),g(2,"S/"),d(),c(3,"input",24),T("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return f(r.updateFieldValue(i.id,t))}),d()()}if(o&2){let n=a().$implicit,e=a(2);p(3),x("ngModel",e.fieldData()[n.id])("placeholder",n.placeholder||"0.00")("required",n.required??!1)("min",n.min||0)}}function Qe(o,l){if(o&1){let n=y();c(0,"input",25),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);w("ngModel",e.fieldData()[n.id]),x("required",n.required??!1)}}function Xe(o,l){if(o&1){let n=y();c(0,"input",26),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);w("ngModel",e.fieldData()[n.id]),x("required",n.required??!1)}}function Ze(o,l){if(o&1&&(c(0,"option",29),g(1),d()),o&2){let n=l.$implicit;x("value",n.value),p(),P(n.label)}}function et(o,l){if(o&1){let n=y();c(0,"select",27),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),c(1,"option",28),g(2,"-- Seleccionar --"),d(),A(3,Ze,2,2,"option",29,ze),d()}if(o&2){let n=a().$implicit,e=a(2);w("ngModel",e.fieldData()[n.id]),x("required",n.required??!1),p(3),V(n.options)}}function tt(o,l){if(o&1){let n=y();c(0,"textarea",30),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);w("ngModel",e.fieldData()[n.id]),x("placeholder",n.placeholder||"")("required",n.required??!1)("minlength",n.minLength??null)("maxlength",n.maxLength??null)}}function nt(o,l){if(o&1){let n=y();c(0,"div",15)(1,"input",31),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d(),c(2,"span",32),g(3),d()()}if(o&2){let n=a().$implicit,e=a(2);p(),w("ngModel",e.fieldData()[n.id]),x("required",n.required??!1),p(2),P(n.placeholder||"Marcar si aplica")}}function it(o,l){if(o&1){let n=y();c(0,"div",10)(1,"span",23),g(2,"\u{1F4F1}"),d(),c(3,"input",33),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()()}if(o&2){let n=a().$implicit,e=a(2);p(3),w("ngModel",e.fieldData()[n.id]),x("placeholder",n.placeholder||"999 999 999")("required",n.required??!1)}}function ot(o,l){if(o&1){let n=y();c(0,"input",34),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);w("ngModel",e.fieldData()[n.id]),x("required",n.required??!1)}}function rt(o,l){if(o&1){let n=y();c(0,"input",35),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);w("ngModel",e.fieldData()[n.id]),x("placeholder",n.placeholder||"ejemplo@correo.com")("required",n.required??!1)}}function at(o,l){if(o&1){let n=y();c(0,"input",36),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);w("ngModel",e.fieldData()[n.id]),x("placeholder",n.placeholder||"https://ejemplo.com")("required",n.required??!1)}}function lt(o,l){if(o&1){let n=y();c(0,"app-payment-schedule",37),T("scheduleChange",function(t){_(n);let i=a().$implicit,r=a(2);return f(r.onPaymentScheduleChange(i.id,t))})("customAmountSelected",function(t){_(n);let i=a(3);return f(i.onCustomAmountSelected(t))}),d()}if(o&2){let n=a().$implicit,e=a(2);x("availableAmounts",e.getPaymentAmountOptions(n))("maxInstallments",6)}}function dt(o,l){o&1&&(c(0,"span",46),g(1,"*"),d())}function st(o,l){if(o&1&&(c(0,"th",41),g(1),h(2,dt,2,0,"span",46),d()),o&2){let n=l.$implicit;p(),W(" ",n.label," "),p(),C(n.required?2:-1)}}function ct(o,l){o&1&&R(0,"th",42)}function pt(o,l){if(o&1&&(c(0,"div",49),g(1),d()),o&2){let n=a(2).$index;p(),W(" ",n+1," ")}}function ut(o,l){if(o&1){let n=y();c(0,"input",56),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;w("ngModel",e[n.id]),x("required",n.required??!1)}}function mt(o,l){if(o&1){let n=y();c(0,"input",57),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;w("ngModel",e[n.id]),x("required",n.required??!1)}}function gt(o,l){if(o&1){let n=y();c(0,"div",10)(1,"span",58),g(2,"S/"),d(),c(3,"input",59),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),f(t)}),d()()}if(o&2){let n=a().$implicit,e=a().$implicit;p(3),w("ngModel",e[n.id]),x("required",n.required??!1)}}function _t(o,l){if(o&1){let n=y();c(0,"input",60),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit,t=a(4);w("ngModel",e[n.id]),x("required",n.required??!1)("min",t.getMinDate(n))("max",t.getMaxDate(n))}}function ft(o,l){if(o&1){let n=y();c(0,"input",61),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;w("ngModel",e[n.id]),x("required",n.required??!1)}}function xt(o,l){if(o&1){let n=y();c(0,"input",62),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;w("ngModel",e[n.id]),x("required",n.required??!1)}}function ht(o,l){if(o&1&&(c(0,"option",29),g(1),d()),o&2){let n=l.$implicit;x("value",n.value||n),p(),W(" ",n.label||n," ")}}function Ct(o,l){if(o&1){let n=y();c(0,"select",63),k("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),f(t)}),c(1,"option",28),g(2,"Seleccionar..."),d(),A(3,ht,2,2,"option",29,je),d()}if(o&2){let n=a().$implicit,e=a().$implicit;w("ngModel",e[n.id]),x("required",n.required??!1),p(3),V(n.options)}}function yt(o,l){if(o&1&&(c(0,"td",47),h(1,pt,2,1,"div",49)(2,ut,1,2,"input",50)(3,mt,1,2,"input",51)(4,gt,4,2,"div",10)(5,_t,1,4,"input",52)(6,ft,1,2,"input",53)(7,xt,1,2,"input",54)(8,Ct,5,2,"select",55),d()),o&2){let n=l.$implicit;p(),C(n.type==="auto-number"?1:n.type==="text"?2:n.type==="number"?3:n.type==="currency"?4:n.type==="date"?5:n.type==="time"?6:n.type==="phone"?7:n.type==="select"?8:-1)}}function bt(o,l){if(o&1){let n=y();c(0,"td",48)(1,"button",64),T("click",function(){_(n);let t=a().$index,i=a(2).$implicit,r=a(2);return f(r.removeTableRow(i.id,t))}),d()()}}function wt(o,l){if(o&1&&(c(0,"tr",44),A(1,yt,9,1,"td",47,ce),h(3,bt,2,0,"td",48),d()),o&2){let n=a(2).$implicit;p(),V(n.columns),p(2),C(n.allowDeleteRow?3:-1)}}function Mt(o,l){if(o&1&&(c(0,"tr")(1,"td",65)(2,"div",66),R(3,"div",67),c(4,"p",68),g(5,"No hay registros en la tabla"),d(),c(6,"p",69),g(7,'Haz clic en "Agregar Fila" para comenzar'),d()()()()),o&2){let n=a(2).$implicit;p(),pe("colspan",n.columns.length+(n.allowDeleteRow?1:0))}}function kt(o,l){if(o&1){let n=y();c(0,"div",45)(1,"button",70),T("click",function(){_(n);let t=a(2).$implicit,i=a(2);return f(i.addTableRow(t.id,t.columns||[]))}),g(2," Agregar Fila "),d()()}}function Ft(o,l){if(o&1&&(c(0,"div",20)(1,"div",38)(2,"table",39)(3,"thead")(4,"tr",40),A(5,st,3,2,"th",41,ce),h(7,ct,1,0,"th",42),d()(),c(8,"tbody",43),A(9,wt,4,1,"tr",44,ue),h(11,Mt,8,1,"tr"),d()()(),h(12,kt,3,0,"div",45),d()),o&2){let n=a().$implicit,e=a(2);p(5),V(n.columns),p(2),C(n.allowDeleteRow?7:-1),p(2),V(e.getTableRows(n.id)),p(2),C(e.getTableRows(n.id).length===0?11:-1),p(),C(n.allowAddRow&&(!n.maxRows||e.getTableRows(n.id).length<n.maxRows)?12:-1)}}function Dt(o,l){if(o&1&&(c(0,"div")(1,"label",5),g(2),h(3,Ye,2,0,"span",6),d(),h(4,He,2,1,"p",7),h(5,Je,1,5,"input",8),h(6,Ge,1,5,"input",9),h(7,Ke,4,4,"div",10),h(8,Qe,1,2,"input",11),h(9,Xe,1,2,"input",12),h(10,et,5,2,"select",13),h(11,tt,1,5,"textarea",14),h(12,nt,4,3,"div",15),h(13,it,4,3,"div",10),h(14,ot,1,2,"input",16),h(15,rt,1,3,"input",17),h(16,at,1,3,"input",18),h(17,lt,1,2,"app-payment-schedule",19),h(18,Ft,13,3,"div",20),d()),o&2){let n=l.$implicit;ge("md:col-span-2",n.type==="table"||n.type==="textarea"||n.type==="payment_schedule"),p(2),W(" ",n.label," "),p(),C(n.required?3:-1),p(),C(n.helpText?4:-1),p(),C(n.type==="text"?5:-1),p(),C(n.type==="number"?6:-1),p(),C(n.type==="currency"?7:-1),p(),C(n.type==="date"?8:-1),p(),C(n.type==="datetime"?9:-1),p(),C(n.type==="select"?10:-1),p(),C(n.type==="textarea"?11:-1),p(),C(n.type==="checkbox"?12:-1),p(),C(n.type==="phone"?13:-1),p(),C(n.type==="time"?14:-1),p(),C(n.type==="email"?15:-1),p(),C(n.type==="url"?16:-1),p(),C(n.type==="payment_schedule"?17:-1),p(),C(n.type==="table"?18:-1)}}function St(o,l){if(o&1&&(c(0,"div",0)(1,"div",1)(2,"h3",2),g(3,"Campos Adicionales"),d()(),c(4,"div",3),A(5,Dt,19,19,"div",4,ce),d()()),o&2){let n=a();p(5),V(n.schema().fields)}}var Bt=(()=>{let l=class l{constructor(){this.schema=j(null),this.externalUpdates=j({}),this.selectedClassification=j(null),this.customerAmounts=j([]),this.fieldData=S({}),this.dataChange=de(),this.customAmountDetected=de(),G(()=>{let e=this.schema();if(e&&e.fields){console.log("[DynamicFieldRenderer] Schema received with fields:",e.fields.map(i=>({id:i.id,type:i.type,label:i.label})));let t={};e.fields.forEach(i=>{if(console.log(`[DynamicFieldRenderer] Processing field: ${i.id}, type: ${i.type}`),i.type==="table"){let r=i.minRows||0;t[i.id]=Array.from({length:r},()=>this.createEmptyTableRow(i.columns||[]))}else i.type==="checkbox"?t[i.id]=!1:i.type==="payment_schedule"?t[i.id]=null:t[i.id]=""}),this.fieldData.set(t)}}),G(()=>{let e=this.externalUpdates();if(e&&Object.keys(e).length>0){console.log("[DynamicField] Received external updates:",e);let t=fe(()=>O({},this.fieldData())),i=!1;Object.keys(e).forEach(r=>{e[r]!==void 0&&e[r]!==null&&t[r]!==e[r]&&(t[r]=e[r],i=!0)}),i?(console.log("[DynamicField] Applying updates to fieldData"),this.fieldData.set(t)):console.log("[DynamicField] No changes detected, skipping update")}}),G(()=>{let e=this.fieldData(),t=this.schema();if(!t?.fields)return;t.fields.filter(r=>r.type==="table"&&r.linkedToField).forEach(r=>{let s=r.linkedToField,m=e[s];if(console.log(`\u{1F517} Sincronizaci\xF3n n\xFAmero\u2192tabla: "${s}"=${m} \u2192 tabla="${r.id}"`),m&&typeof m=="number"&&m>0){let u=this.getTableRows(r.id),b=Math.floor(m);console.log(`   Filas actuales: ${u.length}, Filas objetivo: ${b}`),u.length!==b&&(console.log(`   \u2705 Ajustando tabla de ${u.length} a ${b} filas`),this.adjustTableRows(r.id,b,r.columns||[]))}})}),G(()=>{this.dataChange.emit(this.fieldData())})}updateFieldValue(e,t){let i=O({},this.fieldData());typeof t=="string"&&t!==""&&!isNaN(Number(t))?i[e]=Number(t):i[e]=t,this.fieldData.set(i),this.checkLinkedTables(e,i)}checkLinkedTables(e,t){let i=this.schema();if(!i?.fields)return;i.fields.filter(s=>s.type==="table"&&s.linkedToField===e).forEach(s=>{let m=t[e];if(m&&typeof m=="number"&&m>0){let u=this.getTableRows(s.id),b=Math.floor(m);u.length!==b&&this.adjustTableRows(s.id,b,s.columns||[])}})}getTableRows(e){let t=this.fieldData()[e];return Array.isArray(t)?t:[]}addTableRow(e,t){let i=O({},this.fieldData());Array.isArray(i[e])||(i[e]=[]);let r=this.createEmptyTableRow(t);i[e].push(r);let s=i[e].length;console.log(`\u2795 Tabla\u2192N\xFAmero: Agregada fila, total=${s}`),this.fieldData.set(i),this.updateLinkedFieldFromTable(e,s)}removeTableRow(e,t){let i=O({},this.fieldData());if(Array.isArray(i[e])){let r=i[e].length,s=this.selectedClassification();if(s?.codigo==="PF"){if(r<=2){alert("Los Pagos Fraccionados requieren m\xEDnimo 2 cuotas. No se puede eliminar m\xE1s filas.");return}}else if(s?.codigo==="CF"&&r<=1){alert("Los Convenios requieren m\xEDnimo 1 cuota. No se puede eliminar esta fila.");return}i[e].splice(t,1);let m=i[e].length;console.log(`\u2796 Tabla\u2192N\xFAmero: Eliminada fila, total=${m}`),this.fieldData.set(i),this.updateLinkedFieldFromTable(e,m)}}updateLinkedFieldFromTable(e,t){let i=this.schema();if(console.log(`\u{1F50D} updateLinkedFieldFromTable: tableFieldId="${e}", rowCount=${t}`),!i?.fields){console.log("   \u274C No hay schema o fields");return}let r=i.fields.find(b=>b.id===e);if(console.log("   Campo tabla encontrado:",r),!r||r.type!=="table"){console.log("   \u274C Campo no encontrado o no es tabla");return}let s=r.linkedToField;if(console.log(`   linkedToField="${s}"`),!s){console.log("   \u274C No hay linkedToField definido");return}let m=O({},this.fieldData()),u=m[s];console.log(`   Valor actual del campo vinculado: ${u}`),u!==t?(m[s]=t,this.fieldData.set(m),console.log(`   \u2705 Campo "${s}" actualizado: ${u} \u2192 ${t}`)):console.log(`   \u26A0\uFE0F El valor ya es ${t}, no se actualiza`)}adjustTableRows(e,t,i){let r=O({},this.fieldData());Array.isArray(r[e])||(r[e]=[]);let s=r[e],m=s.length;if(t>m)for(let u=m;u<t;u++)s.push(this.createEmptyTableRow(i));else t<m&&s.splice(t);this.fieldData.set(r)}getTodayDate(){let e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`}getEndOfMonthDate(){let e=new Date,t=e.getFullYear(),i=e.getMonth(),r=new Date(t,i+1,0).getDate(),s=String(i+1).padStart(2,"0"),m=String(r).padStart(2,"0");return`${t}-${s}-${m}`}getMinDate(e){let t=e.minDate;return t==="today"?this.getTodayDate():t}getMaxDate(e){return this.selectedClassification()?.codigo==="PF"?this.getEndOfMonthDate():e.maxDate}createEmptyTableRow(e){let t={};return e.forEach(i=>{i.type==="auto-number"?t[i.id]=null:i.type==="number"||i.type==="currency"?t[i.id]=i.defaultValue||0:(i.type,t[i.id]=i.defaultValue||"")}),t}getData(){return this.fieldData()}setData(e){this.fieldData.set(e)}getPaymentAmountOptions(e){let t=this.customerAmounts();return t&&t.length>0?(console.log("[DynamicFieldRenderer] Using customer amounts:",t),t):e.options&&e.options.length>0?e.options.map(i=>({label:i.label||String(i.value),value:typeof i.value=="number"?i.value:parseFloat(String(i.value))||0,field:i.field})):(console.log("[DynamicFieldRenderer] No customer amounts, using defaults"),[{label:"Sin datos de deuda",value:0,field:"default"}])}onPaymentScheduleChange(e,t){let i=O({},this.fieldData());i[e]=t,this.fieldData.set(i),console.log("[DynamicField] Payment schedule changed:",e,t)}onCustomAmountSelected(e){console.log("[DynamicField] Custom amount selected:",e),this.customAmountDetected.emit(e)}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=X({type:l,selectors:[["app-dynamic-field-renderer"]],inputs:{schema:[1,"schema"],externalUpdates:[1,"externalUpdates"],selectedClassification:[1,"selectedClassification"],customerAmounts:[1,"customerAmounts"]},outputs:{dataChange:"dataChange",customAmountDetected:"customAmountDetected"},decls:1,vars:1,consts:[[1,"bg-purple-50","dark:bg-purple-950/20","border","border-purple-200","dark:border-purple-900/50","rounded-lg","shadow-md","p-3"],[1,"flex","items-center","gap-2","text-purple-800","dark:text-purple-200","mb-3","pb-2","border-b","border-purple-200","dark:border-purple-800"],[1,"font-bold","text-xs","uppercase","tracking-wide"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[3,"md:col-span-2"],[1,"text-[11px]","font-bold","text-gray-800","dark:text-gray-100","mb-1","flex","items-center","gap-1"],[1,"text-red-500","text-xs"],[1,"text-[9px]","text-gray-500","dark:text-gray-400","mb-1","italic"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","min","max"],[1,"relative"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],[1,"flex","items-center","gap-2"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],[3,"availableAmounts","maxInstallments"],[1,"rounded-lg","border","border-purple-200","dark:border-purple-800/50","overflow-hidden","shadow-sm"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min","max"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-gray-500","dark:text-gray-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["value",""],[3,"value"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","checkbox",1,"w-4","h-4","text-purple-600","bg-gray-100","dark:bg-gray-700","border-gray-300","dark:border-gray-600","rounded","focus:ring-purple-500","cursor-pointer",3,"ngModelChange","ngModel","required"],[1,"text-xs","text-gray-700","dark:text-gray-300"],["type","tel","pattern","[0-9]{9}","maxlength","9",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],[3,"scheduleChange","customAmountSelected","availableAmounts","maxInstallments"],[1,"overflow-x-auto"],[1,"w-full","border-collapse"],[1,"bg-gradient-to-r","from-purple-50","to-purple-100","dark:from-purple-950/50","dark:to-purple-900/30"],[1,"px-3","py-2","text-left","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700"],[1,"px-3","py-2","text-center","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700","w-16"],[1,"bg-white","dark:bg-slate-800"],[1,"border-b","border-purple-100","dark:border-purple-900/30","hover:bg-purple-50/50","dark:hover:bg-purple-950/20","transition-colors"],[1,"border-t","border-purple-300","dark:border-purple-700","p-2","from-purple-100/70","to-white","dark:from-purple-950/40","dark:to-purple-800/60"],[1,"text-red-500","ml-0.5"],[1,"px-3","py-2"],[1,"px-3","py-2","text-center"],[1,"flex","items-center","justify-center","w-7","h-7","rounded-full","bg-purple-100","dark:bg-purple-900/30","text-[11px]","font-bold","text-purple-700","dark:text-purple-300"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-purple-600","dark:text-purple-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-6","pr-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","button","title","Eliminar fila",1,"inline-flex","items-center","justify-center","w-7","h-7","rounded-full","hover:bg-red-50","dark:hover:bg-red-900/20","text-red-500","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","transition-colors",3,"click"],[1,"px-4","py-12","text-center"],[1,"flex","flex-col","items-center","gap-2"],[1,"w-12","h-12","rounded-full","bg-purple-100","dark:bg-purple-900/30","flex","items-center","justify-center"],[1,"text-[11px]","text-gray-500","dark:text-gray-400","font-medium"],[1,"text-[10px]","text-gray-400","dark:text-gray-500"],["type","button",1,"w-full","py-1.5","px-3","border","border-dashed","border-purple-400","dark:border-purple-600","rounded-lg","text-purple-900/50","dark:text-purple-300","hover:bg-purple-100","dark:hover:bg-purple-900/50","hover:border-purple-600","dark:hover:border-purple-400","transition-all","flex","items-center","justify-center","gap-2","text-[11px]","font-semibold",3,"click"]],template:function(t,i){t&1&&h(0,St,7,0,"div",0),t&2&&C(i.schema()&&i.schema().fields&&i.schema().fields.length>0?0:-1)},dependencies:[Z,ae,be,we,te,oe,Ce,ye,ne,ke,De,Se,ve,Fe,re,Me,ie,Te],styles:["[_nghost-%COMP%]{display:contents}"]});let o=l;return o})();var Kt=(()=>{let l=class l{constructor(e){this.http=e,this.baseUrl=`${F.tipificacionUrl}/system-config`,this.classificationsUrl=`${F.tipificacionUrl}/typifications`,this.contactClassifications=S([]),this.managementClassifications=S([]),this.campaigns=S([]),this.tenantClassifications=S([]),this.isLoading=S(!1),this.isLoaded=S(!1)}setTenantAndPortfolio(e,t,i){this.tenantClassifications.set([]),this.contactClassifications.set([]),this.managementClassifications.set([]),this.currentTenantId=e,this.currentPortfolioId=t,this.currentSubPortfolioId=i,this.loadTenantClassifications(),this.loadTypificationsFromCatalog()}loadAllData(){this.isLoading.set(!0),Promise.all([this.loadTenantClassifications(),this.loadTypificationsFromCatalog()]).finally(()=>{this.isLoading.set(!1),this.isLoaded.set(!0)})}loadTypificationsFromCatalog(){return new Promise(e=>{if(!this.currentTenantId){console.warn("[V2] No se puede cargar tipificaciones sin tenant configurado"),e();return}let t=this.currentSubPortfolioId||0,i=this.currentPortfolioId||0,r=`${F.gatewayUrl}/v2/typifications/config/effective/tenant/${this.currentTenantId}/portfolio/${i}/subportfolio/${t}`;console.log("[V2] Cargando tipificaciones efectivas desde:",r),this.http.get(r).pipe(H(s=>{console.log("[V2] Tipificaciones efectivas cargadas:",s);let m=s.map(u=>({id:u.id,codigo:u.codigo,label:u.nombre,requiresPayment:!1,requiresSchedule:!1,requiresFollowUp:!1,parentId:u.parentTypificationId,hierarchyLevel:u.nivelJerarquia,suggestsFullAmount:u.suggestsFullAmount??null,allowsInstallmentSelection:u.allowsInstallmentSelection??null,requiresManualAmount:u.requiresManualAmount??null}));this.managementClassifications.set(m),console.log("[V2] Nivel 1:",m.filter(u=>u.hierarchyLevel===1).map(u=>`${u.codigo} (${u.label})`)),console.log("[V2] Nivel 2:",m.filter(u=>u.hierarchyLevel===2).map(u=>`${u.codigo} -> parent:${u.parentId}`)),console.log("[V2] Nivel 3:",m.filter(u=>u.hierarchyLevel===3).map(u=>`${u.codigo} -> parent:${u.parentId}`)),console.log("[V2] Nivel 4:",m.filter(u=>u.hierarchyLevel===4).map(u=>`${u.codigo} -> parent:${u.parentId}`))}),U(s=>(console.error("[V2] Error cargando tipificaciones efectivas:",s),this.managementClassifications.set([]),q([])))).subscribe(()=>e())})}loadTenantClassifications(){return new Promise(e=>{if(!this.currentTenantId){e();return}console.log("[TEMPORAL] loadTenantClassifications - endpoint /tenants/.../typifications no existe");let t=[];this.tenantClassifications.set(t),this.contactClassifications.set([]),this.managementClassifications.set([]),e()})}loadContactClassifications(){return new Promise(e=>{this.http.get(`${this.baseUrl}/contact-typifications`).pipe(H(t=>{this.contactClassifications.set(t)}),U(t=>(console.error("Error cargando tipificaciones de contacto:",t),q([])))).subscribe(()=>e())})}loadManagementClassifications(){return new Promise(e=>{this.http.get(`${this.baseUrl}/management-typifications`).pipe(H(t=>{this.managementClassifications.set(t)}),U(t=>(console.error("Error cargando tipificaciones de gesti\xF3n:",t),q([])))).subscribe(()=>e())})}loadActiveCampaigns(){return new Promise(e=>{this.http.get(`${this.baseUrl}/campaigns/active`).pipe(H(t=>{this.campaigns.set(t)}),U(t=>(console.error("Error cargando campa\xF1as:",t),q([])))).subscribe(()=>e())})}refresh(){this.loadAllData()}getContactClassificationsForUI(){return this.contactClassifications().map(e=>({id:e.codigo,codigo:e.codigo,label:e.label,isSuccessful:e.isSuccessful}))}getManagementClassificationsForUI(){return this.managementClassifications().map(e=>({id:String(e.id),codigo:e.codigo,label:e.label,requiere_pago:e.requiresPayment,requiere_cronograma:e.requiresSchedule,requiere_seguimiento:e.requiresFollowUp,parentId:e.parentId,hierarchyLevel:e.hierarchyLevel,suggestsFullAmount:e.suggestsFullAmount,allowsInstallmentSelection:e.allowsInstallmentSelection,requiresManualAmount:e.requiresManualAmount}))}getActiveCampaign(){let e=this.campaigns();return e.length>0?{id:e[0].campaignId,nombre:e[0].nombre,tipo:e[0].campaignType}:null}getClassificationFields(e){if(!this.currentTenantId)throw new Error("No hay tenant configurado");let t=`${F.gatewayUrl}/v2/typifications/config/tenant/${this.currentTenantId}/typifications/${e}/fields`;return this.currentPortfolioId&&(t+=`?portfolioId=${this.currentPortfolioId}`),console.log("[V2] Cargando campos din\xE1micos desde:",t),this.http.get(t).pipe(H(i=>{console.log("[V2] Campos din\xE1micos cargados:",i)}),U(i=>(console.error("[V2] Error cargando campos din\xE1micos:",i),q({typificationId:e,isLeaf:!1,fields:[]}))))}getAllFieldTypes(){let e=`${F.tipificacionUrl}/field-types`;return this.http.get(e).pipe(U(t=>(console.error("Error cargando tipos de campo:",t),q([]))))}getFieldTypesForMainFields(){let e=`${F.tipificacionUrl}/field-types/main-fields`;return this.http.get(e).pipe(U(t=>(console.error("Error cargando tipos para campos principales:",t),q([]))))}getFieldTypesForTableColumns(){let e=`${F.tipificacionUrl}/field-types/table-columns`;return this.http.get(e).pipe(U(t=>(console.error("Error cargando tipos para columnas de tabla:",t),q([]))))}};l.\u0275fac=function(t){return new(t||l)(Q(ee))},l.\u0275prov=K({token:l,factory:l.\u0275fac,providedIn:"root"});let o=l;return o})();var en=(()=>{let l=class l{constructor(e){this.http=e,this.catalogUrl=`${F.gatewayUrl}/v2/typifications/catalog`,this.configUrl=`${F.gatewayUrl}/v2/typifications/config`}getAllClassifications(){return this.http.get(`${this.catalogUrl}`)}getActiveClassifications(){return this.http.get(`${this.catalogUrl}/active`)}getTypificationsByType(e){return this.http.get(`${this.catalogUrl}/type/${e}`)}getTypificationsByLevel(e){return this.http.get(`${this.catalogUrl}/level/${e}`)}getTypificationsByParent(e){return this.http.get(`${this.catalogUrl}/${e}/children`)}getClassificationById(e){return this.http.get(`${this.catalogUrl}/${e}`)}getRootTypifications(){return this.http.get(`${this.catalogUrl}/roots`)}createTypification(e){return this.http.post(`${this.catalogUrl}`,e)}updateTypification(e,t){return this.http.put(`${this.catalogUrl}/${e}`,t)}deleteTypification(e){return this.http.delete(`${this.catalogUrl}/${e}`)}activateTypification(e){return this.http.put(`${this.catalogUrl}/${e}/activate`,{})}deactivateTypification(e){return this.http.put(`${this.catalogUrl}/${e}/deactivate`,{})}getTenantClassifications(e,t,i){let r=new E;return i&&(r=r.set("includeDisabled","true")),t?this.http.get(`${this.configUrl}/tenant/${e}/portfolio/${t}`,{params:r}):this.http.get(`${this.configUrl}/tenant/${e}`,{params:r})}getTenantClassificationsByType(e,t,i){let r=new E;return i&&(r=r.set("portfolioId",i.toString())),this.http.get(`${this.configUrl}/tenant/${e}/type/${t}`,{params:r})}getEffectiveTypifications(e,t,i){return this.http.get(`${this.configUrl}/effective/tenant/${e}/portfolio/${t}/subportfolio/${i}`)}updateTenantTypificationConfig(e,t){return this.http.put(`${this.configUrl}/${e}`,t)}enableClassification(e,t,i,r,s){let m=new E().set("userId",s?.toString()||"1");return r&&i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/subportfolio/${r}/typification/${t}/enable`,{},{params:m}):i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/typification/${t}/enable`,{},{params:m}):this.http.post(`${this.configUrl}/tenant/${e}/typification/${t}/enable`,{},{params:m})}disableClassification(e,t,i,r,s){let m=new E().set("userId",s?.toString()||"1");return r&&i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/subportfolio/${r}/typification/${t}/disable`,{},{params:m}):i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/typification/${t}/disable`,{},{params:m}):this.http.post(`${this.configUrl}/tenant/${e}/typification/${t}/disable`,{},{params:m})}getAllTenants(){return this.http.get(`${F.webServiceUrl}/v1/system-config/tenants`)}getPortfoliosByTenant(e){return this.http.get(`${F.webServiceUrl}/v1/system-config/tenants/${e}/portfolios`)}getSubPortfoliosByPortfolio(e){return this.http.get(`${this.configUrl}/portfolios/${e}/subportfolios`)}getAdditionalFields(e){return this.http.get(`${this.catalogUrl}/${e}/additional-fields`)}saveAdditionalFields(e,t){return this.http.put(`${this.catalogUrl}/${e}/additional-fields`,t)}getTypificationFieldsWithValues(e,t,i,r){let s=new E;return i&&(s=s.set("portfolioId",i.toString())),r&&(s=s.set("clientId",r.toString())),this.http.get(`${this.configUrl}/tenant/${e}/typifications/${t}/fields`,{params:s})}getDynamicTableColumns(e,t,i){let r=new E().set("tenantId",e.toString()).set("portfolioId",t.toString()).set("subPortfolioId",i.toString());return this.http.get(`${this.configUrl}/dynamic-table-columns`,{params:r})}generarOpcionesCampo(e,t,i,r){let s=new E().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",r.toString());return this.http.get(`${this.catalogUrl}/campo/${e}/opciones/generar`,{params:s})}inicializarOpcionesCampo(e,t,i,r){let s=new E().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",r.toString());return this.http.post(`${this.catalogUrl}/campo/${e}/opciones/inicializar`,{},{params:s})}getOpcionesCampo(e){return this.http.get(`${this.catalogUrl}/campo/${e}/opciones`)}getOpcionesHabilitadas(e){return this.http.get(`${this.catalogUrl}/campo/${e}/opciones/habilitadas`)}configurarOpciones(e){return this.http.put(`${this.catalogUrl}/campo/opciones/configurar`,e)}getOpcionesConValores(e,t,i,r,s){let m=new E().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",r.toString()).set("clientId",s.toString());return this.http.get(`${this.catalogUrl}/campo/${e}/opciones/valores`,{params:m})}createPaymentSchedule(e){return this.http.post(`${F.gatewayUrl}/v2/management-records/payment-schedule`,e)}getPaymentSchedulesByClient(e){return this.http.get(`${F.gatewayUrl}/v2/management-records/payment-schedule/client/${e}`)}getPaymentScheduleByGroup(e){return this.http.get(`${F.gatewayUrl}/v2/management-records/payment-schedule/group/${e}`)}updatePaymentStatus(e,t,i,r){let s=new E().set("estadoPago",t);return i!==void 0&&(s=s.set("montoPagadoReal",i.toString())),r&&(s=s.set("fechaPagoReal",r)),this.http.put(`${F.gatewayUrl}/v2/management-records/${e}/payment-status`,{},{params:s})}buildClassificationTree(e){let t=new Map,i=[];e.forEach(s=>{t.set(s.id,{typification:s,children:[],level:s.nivelJerarquia})}),e.forEach(s=>{let m=t.get(s.id),u=s.tipificacionPadre?.id;if(u){let b=t.get(u);b&&b.children.push(m)}else i.push(m)});let r=s=>{s.children.length>0&&(s.children.sort((m,u)=>{let b=m.typification.ordenVisualizacion||0,N=u.typification.ordenVisualizacion||0;return b-N}),s.children.forEach(m=>r(m)))};return i.forEach(s=>r(s)),i}};l.\u0275fac=function(t){return new(t||l)(Q(ee))},l.\u0275prov=K({token:l,factory:l.\u0275fac,providedIn:"root"});let o=l;return o})();export{Bt as a,Kt as b,en as c};
