import{a as K}from"./chunk-ZVYV4CZP.js";import{a as Q}from"./chunk-TOF5Z5NO.js";import{a as H}from"./chunk-C2YMI7ET.js";import{b as W,e as k,f as A,g as D,h as N,i as B,j as L,m as z,n as R,o as j,p as q,q as G,r as J,x as U}from"./chunk-2GTPXCMV.js";import{d as V,f as T}from"./chunk-AKFV6NFL.js";import{Gb as m,Hb as n,Ib as i,Jb as I,Qb as w,Sb as h,Ub as s,Xa as l,Xc as E,Yc as F,bb as C,bd as O,gc as a,hc as M,ib as y,ic as P,jc as v,ka as p,la as g,lc as f,mc as u,nb as x,nc as _,z as S}from"./chunk-RD2OXGLD.js";function Y(d,c){if(d&1&&(n(0,"div",6),a(1),i()),d&2){let t=s();l(),P("\u274C ",t.error)}}function Z(d,c){if(d&1&&(n(0,"div",7),I(1,"div",8),n(2,"p"),a(3),i()()),d&2){let t=s();l(3),M(t.isEditMode?"Cargando campa\xF1a...":"Guardando...")}}function $(d,c){if(d&1&&(n(0,"option",20),a(1),i()),d&2){let t=c.$implicit;m("ngValue",t.id),l(),v(" ",t.tenantCode," - ",t.tenantName," ")}}function ee(d,c){if(d&1&&(n(0,"option",20),a(1),i()),d&2){let t=c.$implicit;m("ngValue",t.id),l(),v(" ",t.portfolioCode," - ",t.portfolioName," ")}}function te(d,c){if(d&1&&(n(0,"option",20),a(1),i()),d&2){let t=c.$implicit;m("ngValue",t.id),l(),v(" ",t.subPortfolioCode," - ",t.subPortfolioName," ")}}function ne(d,c){if(d&1){let t=w();n(0,"div",9)(1,"form",10),h("ngSubmit",function(){p(t);let e=s();return g(e.onSubmit())}),n(2,"div",11)(3,"h2"),a(4,"\u{1F4CB} Informaci\xF3n B\xE1sica"),i(),n(5,"div",12)(6,"label",13),a(7,"Nombre de la Campa\xF1a *"),i(),n(8,"input",14),_("ngModelChange",function(e){p(t);let o=s();return u(o.campaign.name,e)||(o.campaign.name=e),g(e)}),i()(),n(9,"div",12)(10,"label",15),a(11,"Descripci\xF3n"),i(),n(12,"textarea",16),_("ngModelChange",function(e){p(t);let o=s();return u(o.campaign.description,e)||(o.campaign.description=e),g(e)}),i()()(),n(13,"div",11)(14,"h2"),a(15,"\u{1F3E2} Asignaci\xF3n"),i(),n(16,"div",17)(17,"div",12)(18,"label",18),a(19,"Proveedor (Inquilino) *"),i(),n(20,"select",19),_("ngModelChange",function(e){p(t);let o=s();return u(o.selectedTenantId,e)||(o.selectedTenantId=e),g(e)}),h("ngModelChange",function(){p(t);let e=s();return g(e.onTenantChange())}),n(21,"option",20),a(22,"Seleccione un proveedor..."),i(),x(23,$,2,3,"option",21),i()(),n(24,"div",12)(25,"label",22),a(26,"Cartera *"),i(),n(27,"select",23),_("ngModelChange",function(e){p(t);let o=s();return u(o.selectedPortfolioId,e)||(o.selectedPortfolioId=e),g(e)}),h("ngModelChange",function(){p(t);let e=s();return g(e.onPortfolioChange())}),n(28,"option",20),a(29,"Seleccione una cartera..."),i(),x(30,ee,2,3,"option",21),i()()(),n(31,"div",12)(32,"label",24),a(33,"Subcartera *"),i(),n(34,"select",25),_("ngModelChange",function(e){p(t);let o=s();return u(o.selectedSubPortfolioId,e)||(o.selectedSubPortfolioId=e),g(e)}),n(35,"option",20),a(36,"Seleccione una subcartera..."),i(),x(37,te,2,3,"option",21),i()()(),n(38,"div",11)(39,"h2"),a(40,"\u{1F4DE} Configuraci\xF3n de Discado"),i(),n(41,"div",17)(42,"div",12)(43,"label",26),a(44,"Modo de Discado"),i(),n(45,"select",27),_("ngModelChange",function(e){p(t);let o=s();return u(o.campaign.dialMode,e)||(o.campaign.dialMode=e),g(e)}),n(46,"option",28),a(47,"Manual"),i(),n(48,"option",29),a(49,"Progresivo"),i(),n(50,"option",30),a(51,"Predictivo"),i()()(),n(52,"div",12)(53,"label",31),a(54,"Intentos M\xE1ximos"),i(),n(55,"input",32),_("ngModelChange",function(e){p(t);let o=s();return u(o.campaign.maxAttempts,e)||(o.campaign.maxAttempts=e),g(e)}),i(),n(56,"small"),a(57,"N\xFAmero m\xE1ximo de intentos por contacto (1-10)"),i()()(),n(58,"div",17)(59,"div",12)(60,"label",33),a(61,"Intervalo de Reintento (minutos)"),i(),n(62,"input",34),_("ngModelChange",function(e){p(t);let o=s();return u(o.campaign.retryInterval,e)||(o.campaign.retryInterval=e),g(e)}),i(),n(63,"small"),a(64,"Tiempo de espera entre reintentos"),i()(),n(65,"div",12)(66,"label",35),a(67,"Intensidad de Discado"),i(),n(68,"input",36),_("ngModelChange",function(e){p(t);let o=s();return u(o.campaign.intensidad,e)||(o.campaign.intensidad=e),g(e)}),i(),n(69,"small"),a(70,"Llamadas simult\xE1neas por agente (1-100). Ej: 50 con 10 agentes = 5 llamadas/agente"),i()()(),n(71,"div",12)(72,"label",37),a(73,"Caller ID"),i(),n(74,"input",38),_("ngModelChange",function(e){p(t);let o=s();return u(o.campaign.callerId,e)||(o.campaign.callerId=e),g(e)}),i(),n(75,"small"),a(76,"N\xFAmero que se mostrar\xE1 a los contactos"),i()()(),n(77,"div",39)(78,"button",40),h("click",function(){p(t);let e=s();return g(e.onCancel())}),a(79," Cancelar "),i(),n(80,"button",41),a(81),i()()()()}if(d&2){let t=s();l(8),f("ngModel",t.campaign.name),l(4),f("ngModel",t.campaign.description),l(8),f("ngModel",t.selectedTenantId),l(),m("ngValue",0),l(2),m("ngForOf",t.tenants),l(4),f("ngModel",t.selectedPortfolioId),m("disabled",t.selectedTenantId===0),l(),m("ngValue",0),l(2),m("ngForOf",t.portfolios),l(4),f("ngModel",t.selectedSubPortfolioId),m("disabled",t.selectedPortfolioId===0),l(),m("ngValue",0),l(2),m("ngForOf",t.subPortfolios),l(8),f("ngModel",t.campaign.dialMode),l(10),f("ngModel",t.campaign.maxAttempts),l(7),f("ngModel",t.campaign.retryInterval),l(6),f("ngModel",t.campaign.intensidad),l(6),f("ngModel",t.campaign.callerId),l(6),m("disabled",t.loading),l(),P(" ",t.isEditMode?"Actualizar Campa\xF1a":"Crear Campa\xF1a"," ")}}var ge=(()=>{let c=class c{constructor(r,e,o,b,X){this.campaignService=r,this.tenantService=e,this.portfolioService=o,this.router=b,this.route=X,this.campaign={name:"",description:"",status:"DRAFT",dialMode:"PROGRESSIVE",maxAttempts:3,retryInterval:60,intensidad:50,tenantId:void 0,portfolioId:void 0,subPortfolioId:void 0},this.isEditMode=!1,this.loading=!1,this.error=null,this.campaignId=null,this.tenants=[],this.portfolios=[],this.subPortfolios=[],this.selectedTenantId=0,this.selectedPortfolioId=0,this.selectedSubPortfolioId=0}ngOnInit(){this.loadTenants(),this.route.params.subscribe(r=>{r.id&&(this.isEditMode=!0,this.campaignId=+r.id,this.loadCampaign(this.campaignId))})}loadTenants(){this.tenantService.getAllTenants().subscribe({next:r=>{this.tenants=r.filter(e=>e.isActive)},error:r=>console.error("Error loading tenants:",r)})}onTenantChange(){this.selectedPortfolioId=0,this.selectedSubPortfolioId=0,this.portfolios=[],this.subPortfolios=[],this.selectedTenantId>0&&this.portfolioService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:r=>{this.portfolios=r.filter(e=>e.isActive)},error:r=>console.error("Error loading portfolios:",r)})}onPortfolioChange(){this.selectedSubPortfolioId=0,this.subPortfolios=[],this.selectedPortfolioId>0&&this.portfolioService.getSubPortfoliosByPortfolio(this.selectedPortfolioId).subscribe({next:r=>{this.subPortfolios=r.filter(e=>e.isActive)},error:r=>console.error("Error loading sub-portfolios:",r)})}loadCampaign(r){this.loading=!0,this.campaignService.getCampaignById(r).subscribe({next:e=>{this.campaign=e,e.tenantId&&e.portfolioId&&e.subPortfolioId?(this.selectedTenantId=e.tenantId,this.selectedPortfolioId=e.portfolioId,this.selectedSubPortfolioId=e.subPortfolioId,S({portfolios:this.portfolioService.getPortfoliosByTenant(e.tenantId),subPortfolios:this.portfolioService.getSubPortfoliosByPortfolio(e.portfolioId)}).subscribe({next:o=>{this.portfolios=o.portfolios.filter(b=>b.isActive),this.subPortfolios=o.subPortfolios.filter(b=>b.isActive),this.loading=!1},error:o=>{console.error("Error loading portfolios/subportfolios:",o),this.loading=!1}})):this.loading=!1},error:e=>{console.error("Error loading campaign:",e),this.error="Error al cargar la campa\xF1a",this.loading=!1}})}onSubmit(){if(!this.campaign.name){this.error="El nombre de la campa\xF1a es requerido";return}if(!this.selectedSubPortfolioId||this.selectedSubPortfolioId===0){this.error="Debe seleccionar una subcartera";return}this.campaign.tenantId=this.selectedTenantId,this.campaign.portfolioId=this.selectedPortfolioId,this.campaign.subPortfolioId=this.selectedSubPortfolioId,this.loading=!0,this.error=null,this.isEditMode&&this.campaignId?this.campaignService.updateCampaign(this.campaignId,this.campaign).subscribe({next:()=>{this.router.navigate(["/admin/campaigns"])},error:r=>{console.error("Error updating campaign:",r),this.error="Error al actualizar la campa\xF1a",this.loading=!1}}):this.campaignService.createCampaign(this.campaign).subscribe({next:()=>{this.router.navigate(["/admin/campaigns"])},error:r=>{console.error("Error creating campaign:",r),this.error="Error al crear la campa\xF1a",this.loading=!1}})}onCancel(){this.router.navigate(["/admin/campaigns"])}};c.\u0275fac=function(e){return new(e||c)(C(H),C(K),C(Q),C(T),C(V))},c.\u0275cmp=y({type:c,selectors:[["app-campaign-form"]],decls:12,vars:4,consts:[[1,"campaign-form-container"],[1,"form-header"],[1,"btn-back",3,"click"],["class","error-message",4,"ngIf"],["class","loading-state",4,"ngIf"],["class","form-content",4,"ngIf"],[1,"error-message"],[1,"loading-state"],[1,"spinner"],[1,"form-content"],[3,"ngSubmit"],[1,"form-section"],[1,"form-group"],["for","name"],["type","text","id","name","name","name","placeholder","Ej: Campa\xF1a Cobranza Enero 2025","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description","placeholder","Descripci\xF3n de la campa\xF1a...","rows","3",1,"form-textarea",3,"ngModelChange","ngModel"],[1,"form-row"],["for","tenant"],["id","tenant","name","tenant","required","",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["for","portfolio"],["id","portfolio","name","portfolio","required","",1,"form-select",3,"ngModelChange","ngModel","disabled"],["for","subportfolio"],["id","subportfolio","name","subportfolio","required","",1,"form-select",3,"ngModelChange","ngModel","disabled"],["for","dialMode"],["id","dialMode","name","dialMode",1,"form-select",3,"ngModelChange","ngModel"],["value","MANUAL"],["value","PROGRESSIVE"],["value","PREDICTIVE"],["for","maxAttempts"],["type","number","id","maxAttempts","name","maxAttempts","min","1","max","10",1,"form-input",3,"ngModelChange","ngModel"],["for","retryInterval"],["type","number","id","retryInterval","name","retryInterval","min","1",1,"form-input",3,"ngModelChange","ngModel"],["for","intensidad"],["type","number","id","intensidad","name","intensidad","min","1","max","100","placeholder","50",1,"form-input",3,"ngModelChange","ngModel"],["for","callerId"],["type","text","id","callerId","name","callerId","placeholder","N\xFAmero telef\xF3nico a mostrar",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-actions"],["type","button",1,"btn-cancel",3,"click"],["type","submit",1,"btn-submit",3,"disabled"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),a(3),i(),n(4,"button",2),h("click",function(){return o.onCancel()}),n(5,"span"),a(6,"\u2190"),i(),n(7,"span"),a(8,"Volver"),i()()(),x(9,Y,2,1,"div",3)(10,Z,4,1,"div",4)(11,ne,82,20,"div",5),i()),e&2&&(l(3),M(o.isEditMode?"\u270F\uFE0F Editar Campa\xF1a":"\u2795 Nueva Campa\xF1a"),l(6),m("ngIf",o.error),l(),m("ngIf",o.loading),l(),m("ngIf",!o.loading))},dependencies:[O,E,F,U,B,R,j,W,L,z,k,A,J,G,q,N,D],styles:[".campaign-form-container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto;padding:2rem;min-height:100vh}.form-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--text-primary, #1e293b);margin:0}.btn-back[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:#f1f5f9;border:1px solid #cbd5e1;border-radius:6px;cursor:pointer;font-size:.9rem;color:#475569;transition:all .2s}.btn-back[_ngcontent-%COMP%]:hover{background:#e2e8f0}.error-message[_ngcontent-%COMP%]{background:#fee2e2;border:1px solid #fca5a5;color:#991b1b;padding:1rem;border-radius:6px;margin-bottom:1.5rem}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.spinner[_ngcontent-%COMP%]{border:3px solid #f3f4f6;border-top:3px solid #3b82f6;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.form-content[_ngcontent-%COMP%]{background:var(--card-background, white);border-radius:8px;box-shadow:0 1px 3px #0000001a}.form-section[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--border-color, #e5e7eb)}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem;color:var(--text-primary, #1e293b);margin:0 0 1.5rem;font-weight:600}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;color:var(--text-secondary, #374151);margin-bottom:.5rem;font-size:.9rem}.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%], .form-textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid var(--input-border, #d1d5db);background:var(--input-background, white);color:var(--text-primary, #1e293b);border-radius:6px;font-size:.95rem;transition:border-color .2s}.form-input[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus, .form-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.form-input[_ngcontent-%COMP%]:disabled, .form-select[_ngcontent-%COMP%]:disabled{background:var(--input-disabled-bg, #f9fafb);color:var(--input-disabled-text, #9ca3af);cursor:not-allowed}.form-textarea[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.form-group[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;margin-top:.5rem;color:var(--text-muted, #6b7280);font-size:.85rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}@media (max-width: 768px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;padding:1.5rem;background:var(--card-footer-bg, #f9fafb);border-top:1px solid var(--border-color, #e5e7eb)}.btn-cancel[_ngcontent-%COMP%], .btn-submit[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border-radius:6px;font-weight:500;font-size:.95rem;cursor:pointer;transition:all .2s;border:none}.btn-cancel[_ngcontent-%COMP%]{background:#fff;color:#475569;border:1px solid #cbd5e1}.btn-cancel[_ngcontent-%COMP%]:hover{background:#f1f5f9}.btn-submit[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.btn-submit[_ngcontent-%COMP%]:hover{background:#2563eb}.btn-submit[_ngcontent-%COMP%]:disabled{background:#93c5fd;cursor:not-allowed}"]});let d=c;return d})();export{ge as CampaignFormComponent};
