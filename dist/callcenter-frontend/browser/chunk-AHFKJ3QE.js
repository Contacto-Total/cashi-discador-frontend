import{a as K}from"./chunk-YBTTFGZA.js";import{a as Q}from"./chunk-BY2DM2ZC.js";import{a as A,b as F,e as W,f as L,g as j,h as B,i as q,m as z,n as O,o as G,r as R,s as H,u as J}from"./chunk-TFAMJCIP.js";import{$a as D,Cb as T,Db as N,Eb as u,Fb as r,Gb as o,Hb as w,Ob as y,Qb as f,Sb as c,Va as l,_c as k,dc as M,ec as a,fc as g,gb as I,gc as S,hc as V,ja as p,jc as x,ka as m,kc as h,lc as _,ta as E,yb as b,zb as v}from"./chunk-UY3AUK24.js";var U=(s,d)=>d.id;function X(s,d){if(s&1&&(r(0,"option",11),a(1),o()),s&2){let i=d.$implicit;u("value",i.id),l(),V("",i.tenantName," (",i.tenantCode,")")}}function Y(s,d){if(s&1){let i=y();r(0,"tr",31)(1,"td",32)(2,"div",33)(3,"span",34),a(4),o()()(),r(5,"td",35)(6,"div",36),a(7),o()(),r(8,"td",35)(9,"div",37),a(10),o()(),r(11,"td",32)(12,"label",38)(13,"input",39),f("change",function(){let e=p(i).$implicit,n=c(2);return m(n.togglePortfolioStatus(e))}),o(),w(14,"div",40),o()(),r(15,"td",41)(16,"div",33)(17,"button",42),f("click",function(){let e=p(i).$implicit,n=c(2);return m(n.openEditDialog(e))}),o(),r(18,"button",43),f("click",function(){let e=p(i).$implicit,n=c(2);return m(n.deletePortfolio(e))}),o()()()()}if(s&2){let i=d.$implicit;l(4),g(i.portfolioCode),l(3),g(i.portfolioName),l(3),S(" ",i.description||"Sin descripci\xF3n"," "),l(3),u("checked",i.isActive),l(5),M(i.hasSubPortfolios?"text-gray-600 cursor-not-allowed":"text-red-400 hover:bg-red-900/30 cursor-pointer"),u("disabled",i.hasSubPortfolios)("title",i.hasSubPortfolios?"No se puede eliminar: tiene subcarteras asociadas":"Eliminar")}}function Z(s,d){s&1&&(r(0,"tr")(1,"td",44),a(2," No se encontraron carteras "),o()())}function $(s,d){if(s&1){let i=y();r(0,"div",13)(1,"div",14)(2,"div",2)(3,"div")(4,"p",15),a(5,"Total Carteras"),o(),r(6,"p",16),a(7),o()(),w(8,"div",17),o()(),r(9,"div",14)(10,"div",2)(11,"div")(12,"p",15),a(13,"Activas"),o(),r(14,"p",18),a(15),o()(),w(16,"div",19),o()(),r(17,"div",14)(18,"div",2)(19,"div")(20,"p",15),a(21,"Inactivas"),o(),r(22,"p",20),a(23),o()(),w(24,"div",21),o()()(),r(25,"div",1)(26,"div",8)(27,"div",22)(28,"input",23),_("ngModelChange",function(e){p(i);let n=c();return h(n.searchTerm,e)||(n.searchTerm=e),m(e)}),o()()()(),r(29,"div",24)(30,"div",25)(31,"div",26)(32,"table",27)(33,"thead",28)(34,"tr")(35,"th",29),a(36," C\xF3digo "),o(),r(37,"th",29),a(38," Nombre "),o(),r(39,"th",29),a(40," Descripci\xF3n "),o(),r(41,"th",29),a(42," Estado "),o(),r(43,"th",29),a(44," Acciones "),o()()(),r(45,"tbody",30),T(46,Y,19,8,"tr",31,U,!1,Z,3,0,"tr"),o()()()()()}if(s&2){let i=c();l(7),g(i.portfolios().length),l(8),g(i.getActivePortfolios()),l(8),g(i.getInactivePortfolios()),l(5),x("ngModel",i.searchTerm),l(18),N(i.filteredPortfolios())}}function ee(s,d){if(s&1&&(r(0,"p",51),a(1),o()),s&2){let i=c(2);l(),g(i.getCodeErrorMessage())}}function te(s,d){s&1&&(r(0,"p",52),a(1,"C\xF3digo \xFAnico de m\xE1ximo 3 caracteres"),o())}function ie(s,d){if(s&1&&(r(0,"p",51),a(1),o()),s&2){let i=c(2);l(),g(i.getNameErrorMessage())}}function oe(s,d){if(s&1){let i=y();r(0,"div",55)(1,"input",59),_("ngModelChange",function(e){p(i);let n=c(2);return h(n.formData.isActive,e)||(n.formData.isActive=e),m(e)}),o(),r(2,"label",60),a(3," Cartera activa "),o()()}if(s&2){let i=c(2);l(),x("ngModel",i.formData.isActive)}}function re(s,d){if(s&1){let i=y();r(0,"div",12)(1,"div",45)(2,"div",46)(3,"h2",47),a(4),o(),r(5,"button",48),f("click",function(){p(i);let e=c();return m(e.closeDialog())}),o()(),r(6,"form",49),f("ngSubmit",function(){p(i);let e=c();return m(e.savePortfolio())}),r(7,"div")(8,"label",9),a(9," C\xF3digo de Cartera * "),o(),r(10,"input",50),_("ngModelChange",function(e){p(i);let n=c();return h(n.formData.portfolioCode,e)||(n.formData.portfolioCode=e),m(e)}),o(),b(11,ee,2,1,"p",51)(12,te,2,0,"p",52),o(),r(13,"div")(14,"label",9),a(15," Nombre de Cartera * "),o(),r(16,"input",53),_("ngModelChange",function(e){p(i);let n=c();return h(n.formData.portfolioName,e)||(n.formData.portfolioName=e),m(e)}),o(),b(17,ie,2,1,"p",51),o(),r(18,"div")(19,"label",9),a(20," Descripci\xF3n "),o(),r(21,"textarea",54),_("ngModelChange",function(e){p(i);let n=c();return h(n.formData.description,e)||(n.formData.description=e),m(e)}),o()(),b(22,oe,4,1,"div",55),r(23,"div",56)(24,"button",57),f("click",function(){p(i);let e=c();return m(e.closeDialog())}),a(25," Cancelar "),o(),r(26,"button",58),a(27),o()()()()()}if(s&2){let i=c();l(4),S(" ",i.isEditMode?"Editar Cartera":"Nueva Cartera"," "),l(6),M(i.getCodeErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase"),x("ngModel",i.formData.portfolioCode),u("disabled",i.isEditMode),l(),v(i.getCodeErrorMessage()?11:12),l(5),M(i.getNameErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"),x("ngModel",i.formData.portfolioName),l(),v(i.getNameErrorMessage()?17:-1),l(4),x("ngModel",i.formData.description),l(),v(i.isEditMode?22:-1),l(4),u("disabled",i.isEditMode?!i.formData.portfolioName:!i.canSave()),l(),S(" ",i.isEditMode?"Actualizar":"Crear"," ")}}var fe=(()=>{let d=class d{constructor(t,e){this.portfolioService=t,this.typificationService=e,this.tenants=E([]),this.portfolios=E([]),this.filteredPortfolios=E([]),this.selectedTenantId=0,this.searchTerm="",this.showDialog=!1,this.isEditMode=!1,this.selectedPortfolio=null,this.formData={portfolioCode:"",portfolioName:"",description:"",isActive:!0},this.watchSearchTerm()}ngOnInit(){this.loadTenants()}loadTenants(){this.typificationService.getAllTenants().subscribe({next:t=>{this.tenants.set(t)},error:t=>{console.error("Error loading tenants:",t)}})}onTenantChange(){this.selectedTenantId>0?this.loadPortfolios():(this.portfolios.set([]),this.filteredPortfolios.set([]))}loadPortfolios(){this.portfolioService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:t=>{this.portfolios.set(t),this.filterPortfolios()},error:t=>{console.error("Error loading portfolios:",t)}})}watchSearchTerm(){setInterval(()=>{this.filterPortfolios()},300)}filterPortfolios(){let t=this.searchTerm.toLowerCase().trim();if(!t){this.filteredPortfolios.set(this.portfolios());return}let e=this.portfolios().filter(n=>n.portfolioCode.toLowerCase().includes(t)||n.portfolioName.toLowerCase().includes(t)||n.description&&n.description.toLowerCase().includes(t));this.filteredPortfolios.set(e)}getActivePortfolios(){return this.portfolios().filter(t=>t.isActive).length}getInactivePortfolios(){return this.portfolios().filter(t=>!t.isActive).length}openCreateDialog(){this.isEditMode=!1,this.selectedPortfolio=null,this.formData={portfolioCode:"",portfolioName:"",description:"",isActive:!0},this.showDialog=!0}openEditDialog(t){this.isEditMode=!0,this.selectedPortfolio=t,this.formData={portfolioCode:t.portfolioCode,portfolioName:t.portfolioName,description:t.description||"",isActive:t.isActive},this.showDialog=!0}closeDialog(){this.showDialog=!1,this.isEditMode=!1,this.selectedPortfolio=null}isCodeDuplicated(){return!this.formData.portfolioCode.trim()||this.isEditMode?!1:this.portfolios().filter(e=>e.tenantId===this.selectedTenantId).some(e=>e.portfolioCode.toLowerCase()===this.formData.portfolioCode.trim().toLowerCase())}isNameDuplicated(){if(!this.formData.portfolioName.trim())return!1;let t=this.portfolios().filter(e=>e.tenantId===this.selectedTenantId);return this.isEditMode&&this.selectedPortfolio?t.some(e=>e.id!==this.selectedPortfolio.id&&e.portfolioName.toLowerCase()===this.formData.portfolioName.trim().toLowerCase()):t.some(e=>e.portfolioName.toLowerCase()===this.formData.portfolioName.trim().toLowerCase())}getCodeErrorMessage(){return this.formData.portfolioCode.trim()&&this.isCodeDuplicated()?"Este c\xF3digo ya est\xE1 en uso en este proveedor":""}getNameErrorMessage(){return this.formData.portfolioName.trim()&&this.isNameDuplicated()?"Este nombre ya est\xE1 en uso en este proveedor":""}canSave(){return!(!this.formData.portfolioCode.trim()||!this.formData.portfolioName.trim()||this.isCodeDuplicated()||this.isNameDuplicated())}savePortfolio(){if(!(!this.canSave()&&!this.isEditMode))if(this.isEditMode&&this.selectedPortfolio){let t={portfolioName:this.formData.portfolioName,description:this.formData.description||void 0,isActive:this.formData.isActive};this.portfolioService.updatePortfolio(this.selectedPortfolio.id,t).subscribe({next:()=>{this.closeDialog(),this.loadPortfolios()},error:e=>{console.error("Error updating portfolio:",e),alert("Error al actualizar la cartera: "+(e.error?.message||e.message))}})}else{let t={tenantId:this.selectedTenantId,portfolioCode:this.formData.portfolioCode,portfolioName:this.formData.portfolioName,description:this.formData.description||void 0};this.portfolioService.createPortfolio(t).subscribe({next:()=>{this.closeDialog(),this.loadPortfolios()},error:e=>{console.error("Error creating portfolio:",e),alert("Error al crear la cartera: "+(e.error?.message||e.message))}})}}togglePortfolioStatus(t){let e=!t.isActive,n={portfolioName:t.portfolioName,description:t.description,isActive:e};this.portfolioService.updatePortfolio(t.id,n).subscribe({next:()=>{this.loadPortfolios()},error:C=>{console.error("Error toggling portfolio status:",C),alert("Error al cambiar el estado de la cartera: "+(C.error?.message||C.message))}})}deletePortfolio(t){if(t.hasSubPortfolios){alert("No se puede eliminar esta cartera porque tiene subcarteras asociadas.");return}confirm(`\xBFEst\xE1 seguro de que desea eliminar la cartera "${t.portfolioName}"? Esta acci\xF3n no se puede deshacer.`)&&this.portfolioService.deletePortfolio(t.id).subscribe({next:()=>{this.loadPortfolios(),alert("Cartera eliminada exitosamente")},error:e=>{console.error("Error deleting portfolio:",e),alert("Error al eliminar la cartera: "+(e.error?.message||e.message))}})}};d.\u0275fac=function(e){return new(e||d)(D(K),D(Q))},d.\u0275cmp=I({type:d,selectors:[["app-portfolio-maintenance"]],decls:25,vars:5,consts:[[1,"min-h-screen","bg-slate-950","p-6"],[1,"max-w-7xl","mx-auto","mb-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3","mb-2"],[1,"w-12","h-12","bg-gradient-to-br","from-purple-600","to-purple-700","rounded-xl","flex","items-center","justify-center","shadow-lg"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-gray-400"],[1,"flex","items-center","gap-2","px-5","py-2.5","bg-gradient-to-r","from-purple-600","to-purple-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","hover:scale-105","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","cursor-pointer",3,"click","disabled"],[1,"bg-slate-900","rounded-xl","p-4","shadow-sm","border","border-slate-800"],[1,"block","text-sm","font-semibold","text-gray-300","mb-2"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[3,"value"],[1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","p-4","z-50"],[1,"max-w-7xl","mx-auto","mb-6","grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"bg-slate-900","rounded-xl","p-5","shadow-sm","border","border-slate-800"],[1,"text-sm","text-gray-400","mb-1"],[1,"text-3xl","font-bold","text-white"],[1,"w-12","h-12","bg-purple-900/30","rounded-lg","flex","items-center","justify-center"],[1,"text-3xl","font-bold","text-green-400"],[1,"w-12","h-12","bg-green-900/30","rounded-lg","flex","items-center","justify-center"],[1,"text-3xl","font-bold","text-red-400"],[1,"w-12","h-12","bg-red-900/30","rounded-lg","flex","items-center","justify-center"],[1,"relative"],["type","text","placeholder","Buscar carteras por c\xF3digo, nombre o tipo...",1,"w-full","pl-12","pr-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],[1,"max-w-7xl","mx-auto"],[1,"bg-slate-900","rounded-xl","shadow-sm","border","border-slate-800","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-slate-800"],[1,"bg-slate-800"],[1,"px-6","py-4","text-left","text-xs","font-semibold","text-gray-300","uppercase","tracking-wider"],[1,"divide-y","divide-slate-800"],[1,"hover:bg-slate-800/50","transition-colors"],[1,"px-6","py-4","whitespace-nowrap"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-medium","text-white"],[1,"px-6","py-4"],[1,"text-sm","text-white","font-medium"],[1,"text-sm","text-gray-400","max-w-xs","truncate"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-slate-700","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-purple-800","rounded-full","peer","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-purple-600"],[1,"px-6","py-4","whitespace-nowrap","text-sm"],[1,"p-2","text-blue-400","hover:bg-blue-900/30","rounded-lg","transition-colors","cursor-pointer",3,"click"],[1,"p-2","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled","title"],["colspan","5",1,"px-6","py-8","text-center","text-gray-500"],[1,"bg-slate-900","rounded-xl","shadow-xl","max-w-md","w-full","border","border-slate-800"],[1,"flex","items-center","justify-between","p-6","border-b","border-slate-800"],[1,"text-xl","font-bold","text-white"],[1,"text-gray-400","hover:text-white","transition-colors",3,"click"],[1,"p-6","space-y-4",3,"ngSubmit"],["type","text","name","portfolioCode","required","","maxlength","3","placeholder","Ej: C01, ABC",3,"ngModelChange","ngModel","disabled"],[1,"text-xs","text-red-400","mt-1","font-semibold"],[1,"text-xs","text-gray-500","mt-1"],["type","text","name","portfolioName","required","","maxlength","255","placeholder","Ej: Cartera de Consumo",3,"ngModelChange","ngModel"],["name","description","rows","3","placeholder","Descripci\xF3n de la cartera...",1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-purple-500","resize-none",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-3"],[1,"flex","gap-3","pt-4"],["type","button",1,"flex-1","px-4","py-2.5","bg-slate-800","text-white","rounded-lg","font-semibold","hover:bg-slate-700","transition-colors",3,"click"],["type","submit",1,"flex-1","px-4","py-2.5","bg-gradient-to-r","from-purple-600","to-purple-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],["type","checkbox","name","isActive","id","isActive",1,"w-4","h-4","text-purple-600","bg-slate-800","border-slate-700","rounded","focus:ring-purple-500",3,"ngModelChange","ngModel"],["for","isActive",1,"text-sm","text-gray-300"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3),w(5,"div",4),r(6,"div")(7,"h1",5),a(8,"Gesti\xF3n de Carteras"),o(),r(9,"p",6),a(10,"Administra las carteras por proveedor"),o()()()(),r(11,"button",7),f("click",function(){return n.openCreateDialog()}),r(12,"span"),a(13,"Nueva Cartera"),o()()()(),r(14,"div",1)(15,"div",8)(16,"label",9),a(17," Seleccionar Proveedor "),o(),r(18,"select",10),_("ngModelChange",function(P){return h(n.selectedTenantId,P)||(n.selectedTenantId=P),P}),f("ngModelChange",function(){return n.onTenantChange()}),r(19,"option",11),a(20,"Seleccione un proveedor..."),o(),T(21,X,2,3,"option",11,U),o()()(),b(23,$,49,5),o(),b(24,re,28,14,"div",12)),e&2&&(l(11),u("disabled",n.selectedTenantId===0),l(7),x("ngModel",n.selectedTenantId),l(),u("value",0),l(2),N(n.tenants()),l(2),v(n.selectedTenantId>0?23:-1),l(),v(n.showDialog?24:-1))},dependencies:[k,J,q,O,G,F,A,z,W,L,R,H,B,j],encapsulation:2});let s=d;return s})();export{fe as PortfolioMaintenanceComponent};
