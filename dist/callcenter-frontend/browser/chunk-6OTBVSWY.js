import{A as se,B as ce,E as pe,b as K,c as Q,f as X,k as Z,m as ee,s as te,t as ie,u as ne,v as re,w as oe,x as ae,y as le,z as de}from"./chunk-YEUR475X.js";import{a as V}from"./chunk-DF6EJM3T.js";import{Fb as j,Gb as g,Gc as H,Hb as m,I as M,Ib as O,Ic as W,Kb as S,Lb as q,Lc as Y,Mb as y,Mc as P,Nb as s,Ob as d,Pb as A,Wb as C,Yb as $,_b as a,a as R,aa as v,bb as p,da as I,ha as U,kc as z,ld as J,mc as b,nc as L,oa as x,ob as B,oc as E,pa as f,r as D,rc as h,sc as w,tc as F,td as G,ya as T}from"./chunk-QOPKCBWK.js";var N=(r,l)=>l.id,_e=(r,l)=>l.value,ge=(r,l)=>l.value||l;function me(r,l){r&1&&(s(0,"span",6),b(1,"*"),d())}function xe(r,l){if(r&1&&(s(0,"p",7),b(1),d()),r&2){let e=a().$implicit;p(),L(e.helpText)}}function fe(r,l){if(r&1){let e=C();s(0,"input",20),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a(2);h("ngModel",t.fieldData()[e.id]),y("placeholder",e.placeholder||"")("required",e.required??!1)("minlength",e.minLength??null)("maxlength",e.maxLength??null)}}function ye(r,l){if(r&1){let e=C();s(0,"input",21),$("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return f(o.updateFieldValue(n.id,i))}),d()}if(r&2){let e=a().$implicit,t=a(2);y("ngModel",t.fieldData()[e.id])("placeholder",e.placeholder||"")("required",e.required??!1)("min",e.min??null)("max",e.max??null)}}function Ce(r,l){if(r&1){let e=C();s(0,"div",10)(1,"span",22),b(2,"S/"),d(),s(3,"input",23),$("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return f(o.updateFieldValue(n.id,i))}),d()()}if(r&2){let e=a().$implicit,t=a(2);p(3),y("ngModel",t.fieldData()[e.id])("placeholder",e.placeholder||"0.00")("required",e.required??!1)("min",e.min||0)}}function be(r,l){if(r&1){let e=C();s(0,"input",24),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a(2);h("ngModel",t.fieldData()[e.id]),y("required",e.required??!1)}}function he(r,l){if(r&1){let e=C();s(0,"input",25),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a(2);h("ngModel",t.fieldData()[e.id]),y("required",e.required??!1)}}function we(r,l){if(r&1&&(s(0,"option",28),b(1),d()),r&2){let e=l.$implicit;y("value",e.value),p(),L(e.label)}}function Fe(r,l){if(r&1){let e=C();s(0,"select",26),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),s(1,"option",27),b(2,"-- Seleccionar --"),d(),S(3,we,2,2,"option",28,_e),d()}if(r&2){let e=a().$implicit,t=a(2);h("ngModel",t.fieldData()[e.id]),y("required",e.required??!1),p(3),q(e.options)}}function ke(r,l){if(r&1){let e=C();s(0,"textarea",29),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a(2);h("ngModel",t.fieldData()[e.id]),y("placeholder",e.placeholder||"")("required",e.required??!1)("minlength",e.minLength??null)("maxlength",e.maxLength??null)}}function De(r,l){if(r&1){let e=C();s(0,"div",15)(1,"input",30),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),d(),s(2,"span",31),b(3),d()()}if(r&2){let e=a().$implicit,t=a(2);p(),h("ngModel",t.fieldData()[e.id]),y("required",e.required??!1),p(2),L(e.placeholder||"Marcar si aplica")}}function Me(r,l){if(r&1){let e=C();s(0,"div",10)(1,"span",22),b(2,"\u{1F4F1}"),d(),s(3,"input",32),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),d()()}if(r&2){let e=a().$implicit,t=a(2);p(3),h("ngModel",t.fieldData()[e.id]),y("placeholder",e.placeholder||"999 999 999")("required",e.required??!1)}}function Te(r,l){if(r&1){let e=C();s(0,"input",33),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a(2);h("ngModel",t.fieldData()[e.id]),y("required",e.required??!1)}}function Ve(r,l){if(r&1){let e=C();s(0,"input",34),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a(2);h("ngModel",t.fieldData()[e.id]),y("placeholder",e.placeholder||"ejemplo@correo.com")("required",e.required??!1)}}function Re(r,l){if(r&1){let e=C();s(0,"input",35),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a(2);return w(o.fieldData()[n.id],i)||(o.fieldData()[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a(2);h("ngModel",t.fieldData()[e.id]),y("placeholder",e.placeholder||"https://ejemplo.com")("required",e.required??!1)}}function Se(r,l){r&1&&(s(0,"span",44),b(1,"*"),d())}function qe(r,l){if(r&1&&(s(0,"th",39),b(1),g(2,Se,2,0,"span",44),d()),r&2){let e=l.$implicit;p(),E(" ",e.label," "),p(),m(e.required?2:-1)}}function ve(r,l){r&1&&A(0,"th",40)}function $e(r,l){if(r&1&&(s(0,"div",47),b(1),d()),r&2){let e=a(2).$index;p(),E(" ",e+1," ")}}function Ee(r,l){if(r&1){let e=C();s(0,"input",54),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a().$implicit;return w(o[n.id],i)||(o[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a().$implicit;h("ngModel",t[e.id]),y("required",e.required??!1)}}function We(r,l){if(r&1){let e=C();s(0,"input",55),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a().$implicit;return w(o[n.id],i)||(o[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a().$implicit;h("ngModel",t[e.id]),y("required",e.required??!1)}}function Le(r,l){if(r&1){let e=C();s(0,"div",10)(1,"span",56),b(2,"S/"),d(),s(3,"input",57),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a().$implicit;return w(o[n.id],i)||(o[n.id]=i),f(i)}),d()()}if(r&2){let e=a().$implicit,t=a().$implicit;p(3),h("ngModel",t[e.id]),y("required",e.required??!1)}}function Pe(r,l){if(r&1){let e=C();s(0,"input",58),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a().$implicit;return w(o[n.id],i)||(o[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a().$implicit,i=a(4);h("ngModel",t[e.id]),y("required",e.required??!1)("min",i.getMinDate(e))("max",i.getMaxDate(e))}}function Ae(r,l){if(r&1){let e=C();s(0,"input",59),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a().$implicit;return w(o[n.id],i)||(o[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a().$implicit;h("ngModel",t[e.id]),y("required",e.required??!1)}}function Ne(r,l){if(r&1){let e=C();s(0,"input",60),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a().$implicit;return w(o[n.id],i)||(o[n.id]=i),f(i)}),d()}if(r&2){let e=a().$implicit,t=a().$implicit;h("ngModel",t[e.id]),y("required",e.required??!1)}}function Ie(r,l){if(r&1&&(s(0,"option",28),b(1),d()),r&2){let e=l.$implicit;y("value",e.value||e),p(),E(" ",e.label||e," ")}}function Ue(r,l){if(r&1){let e=C();s(0,"select",61),F("ngModelChange",function(i){x(e);let n=a().$implicit,o=a().$implicit;return w(o[n.id],i)||(o[n.id]=i),f(i)}),s(1,"option",27),b(2,"Seleccionar..."),d(),S(3,Ie,2,2,"option",28,ge),d()}if(r&2){let e=a().$implicit,t=a().$implicit;h("ngModel",t[e.id]),y("required",e.required??!1),p(3),q(e.options)}}function Be(r,l){if(r&1&&(s(0,"td",45),g(1,$e,2,1,"div",47)(2,Ee,1,2,"input",48)(3,We,1,2,"input",49)(4,Le,4,2,"div",10)(5,Pe,1,4,"input",50)(6,Ae,1,2,"input",51)(7,Ne,1,2,"input",52)(8,Ue,5,2,"select",53),d()),r&2){let e=l.$implicit;p(),m(e.type==="auto-number"?1:e.type==="text"?2:e.type==="number"?3:e.type==="currency"?4:e.type==="date"?5:e.type==="time"?6:e.type==="phone"?7:e.type==="select"?8:-1)}}function je(r,l){if(r&1){let e=C();s(0,"td",46)(1,"button",62),$("click",function(){x(e);let i=a().$index,n=a(2).$implicit,o=a(2);return f(o.removeTableRow(n.id,i))}),d()()}}function Oe(r,l){if(r&1&&(s(0,"tr",42),S(1,Be,9,1,"td",45,N),g(3,je,2,0,"td",46),d()),r&2){let e=a(2).$implicit;p(),q(e.columns),p(2),m(e.allowDeleteRow?3:-1)}}function ze(r,l){if(r&1&&(s(0,"tr")(1,"td",63)(2,"div",64),A(3,"div",65),s(4,"p",66),b(5,"No hay registros en la tabla"),d(),s(6,"p",67),b(7,'Haz clic en "Agregar Fila" para comenzar'),d()()()()),r&2){let e=a(2).$implicit;p(),j("colspan",e.columns.length+(e.allowDeleteRow?1:0))}}function He(r,l){if(r&1){let e=C();s(0,"div",43)(1,"button",68),$("click",function(){x(e);let i=a(2).$implicit,n=a(2);return f(n.addTableRow(i.id,i.columns||[]))}),b(2," Agregar Fila "),d()()}}function Ye(r,l){if(r&1&&(s(0,"div",19)(1,"div",36)(2,"table",37)(3,"thead")(4,"tr",38),S(5,qe,3,2,"th",39,N),g(7,ve,1,0,"th",40),d()(),s(8,"tbody",41),S(9,Oe,4,1,"tr",42,O),g(11,ze,8,1,"tr"),d()()(),g(12,He,3,0,"div",43),d()),r&2){let e=a().$implicit,t=a(2);p(5),q(e.columns),p(2),m(e.allowDeleteRow?7:-1),p(2),q(t.getTableRows(e.id)),p(2),m(t.getTableRows(e.id).length===0?11:-1),p(),m(e.allowAddRow&&(!e.maxRows||t.getTableRows(e.id).length<e.maxRows)?12:-1)}}function Je(r,l){if(r&1&&(s(0,"div")(1,"label",5),b(2),g(3,me,2,0,"span",6),d(),g(4,xe,2,1,"p",7),g(5,fe,1,5,"input",8),g(6,ye,1,5,"input",9),g(7,Ce,4,4,"div",10),g(8,be,1,2,"input",11),g(9,he,1,2,"input",12),g(10,Fe,5,2,"select",13),g(11,ke,1,5,"textarea",14),g(12,De,4,3,"div",15),g(13,Me,4,3,"div",10),g(14,Te,1,2,"input",16),g(15,Ve,1,3,"input",17),g(16,Re,1,3,"input",18),g(17,Ye,13,3,"div",19),d()),r&2){let e=l.$implicit;z("md:col-span-2",e.type==="table"||e.type==="textarea"),p(2),E(" ",e.label," "),p(),m(e.required?3:-1),p(),m(e.helpText?4:-1),p(),m(e.type==="text"?5:-1),p(),m(e.type==="number"?6:-1),p(),m(e.type==="currency"?7:-1),p(),m(e.type==="date"?8:-1),p(),m(e.type==="datetime"?9:-1),p(),m(e.type==="select"?10:-1),p(),m(e.type==="textarea"?11:-1),p(),m(e.type==="checkbox"?12:-1),p(),m(e.type==="phone"?13:-1),p(),m(e.type==="time"?14:-1),p(),m(e.type==="email"?15:-1),p(),m(e.type==="url"?16:-1),p(),m(e.type==="table"?17:-1)}}function Ge(r,l){if(r&1&&(s(0,"div",0)(1,"div",1)(2,"h3",2),b(3,"Campos Adicionales"),d()(),s(4,"div",3),S(5,Je,18,18,"div",4,N),d()()),r&2){let e=a();p(5),q(e.schema().fields)}}var tt=(()=>{let l=class l{constructor(){this.schema=P(null),this.externalUpdates=P({}),this.selectedClassification=P(null),this.fieldData=T({}),this.dataChange=Y(),W(()=>{let t=this.schema();if(t&&t.fields){let i={};t.fields.forEach(n=>{if(n.type==="table"){let o=n.minRows||0;i[n.id]=Array.from({length:o},()=>this.createEmptyTableRow(n.columns||[]))}else n.type==="checkbox"?i[n.id]=!1:i[n.id]=""}),this.fieldData.set(i)}}),W(()=>{let t=this.externalUpdates();if(t&&Object.keys(t).length>0){console.log("[DynamicField] Received external updates:",t);let i=H(()=>R({},this.fieldData())),n=!1;Object.keys(t).forEach(o=>{t[o]!==void 0&&t[o]!==null&&i[o]!==t[o]&&(i[o]=t[o],n=!0)}),n?(console.log("[DynamicField] Applying updates to fieldData"),this.fieldData.set(i)):console.log("[DynamicField] No changes detected, skipping update")}}),W(()=>{let t=this.fieldData(),i=this.schema();if(!i?.fields)return;i.fields.filter(o=>o.type==="table"&&o.linkedToField).forEach(o=>{let u=o.linkedToField,_=t[u];if(console.log(`\u{1F517} Sincronizaci\xF3n n\xFAmero\u2192tabla: "${u}"=${_} \u2192 tabla="${o.id}"`),_&&typeof _=="number"&&_>0){let c=this.getTableRows(o.id),k=Math.floor(_);console.log(`   Filas actuales: ${c.length}, Filas objetivo: ${k}`),c.length!==k&&(console.log(`   \u2705 Ajustando tabla de ${c.length} a ${k} filas`),this.adjustTableRows(o.id,k,o.columns||[]))}})}),W(()=>{this.dataChange.emit(this.fieldData())})}updateFieldValue(t,i){let n=R({},this.fieldData());typeof i=="string"&&i!==""&&!isNaN(Number(i))?n[t]=Number(i):n[t]=i,this.fieldData.set(n),this.checkLinkedTables(t,n)}checkLinkedTables(t,i){let n=this.schema();if(!n?.fields)return;n.fields.filter(u=>u.type==="table"&&u.linkedToField===t).forEach(u=>{let _=i[t];if(_&&typeof _=="number"&&_>0){let c=this.getTableRows(u.id),k=Math.floor(_);c.length!==k&&this.adjustTableRows(u.id,k,u.columns||[])}})}getTableRows(t){let i=this.fieldData()[t];return Array.isArray(i)?i:[]}addTableRow(t,i){let n=R({},this.fieldData());Array.isArray(n[t])||(n[t]=[]);let o=this.createEmptyTableRow(i);n[t].push(o);let u=n[t].length;console.log(`\u2795 Tabla\u2192N\xFAmero: Agregada fila, total=${u}`),this.fieldData.set(n),this.updateLinkedFieldFromTable(t,u)}removeTableRow(t,i){let n=R({},this.fieldData());if(Array.isArray(n[t])){let o=n[t].length,u=this.selectedClassification();if(u?.codigo==="PF"){if(o<=2){alert("Los Pagos Fraccionados requieren m\xEDnimo 2 cuotas. No se puede eliminar m\xE1s filas.");return}}else if(u?.codigo==="CF"&&o<=1){alert("Los Convenios requieren m\xEDnimo 1 cuota. No se puede eliminar esta fila.");return}n[t].splice(i,1);let _=n[t].length;console.log(`\u2796 Tabla\u2192N\xFAmero: Eliminada fila, total=${_}`),this.fieldData.set(n),this.updateLinkedFieldFromTable(t,_)}}updateLinkedFieldFromTable(t,i){let n=this.schema();if(console.log(`\u{1F50D} updateLinkedFieldFromTable: tableFieldId="${t}", rowCount=${i}`),!n?.fields){console.log("   \u274C No hay schema o fields");return}let o=n.fields.find(k=>k.id===t);if(console.log("   Campo tabla encontrado:",o),!o||o.type!=="table"){console.log("   \u274C Campo no encontrado o no es tabla");return}let u=o.linkedToField;if(console.log(`   linkedToField="${u}"`),!u){console.log("   \u274C No hay linkedToField definido");return}let _=R({},this.fieldData()),c=_[u];console.log(`   Valor actual del campo vinculado: ${c}`),c!==i?(_[u]=i,this.fieldData.set(_),console.log(`   \u2705 Campo "${u}" actualizado: ${c} \u2192 ${i}`)):console.log(`   \u26A0\uFE0F El valor ya es ${i}, no se actualiza`)}adjustTableRows(t,i,n){let o=R({},this.fieldData());Array.isArray(o[t])||(o[t]=[]);let u=o[t],_=u.length;if(i>_)for(let c=_;c<i;c++)u.push(this.createEmptyTableRow(n));else i<_&&u.splice(i);this.fieldData.set(o)}getTodayDate(){let t=new Date,i=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${i}-${n}-${o}`}getEndOfMonthDate(){let t=new Date,i=t.getFullYear(),n=t.getMonth(),o=new Date(i,n+1,0).getDate(),u=String(n+1).padStart(2,"0"),_=String(o).padStart(2,"0");return`${i}-${u}-${_}`}getMinDate(t){let i=t.minDate;return i==="today"?this.getTodayDate():i}getMaxDate(t){return this.selectedClassification()?.codigo==="PF"?this.getEndOfMonthDate():t.maxDate}createEmptyTableRow(t){let i={};return t.forEach(n=>{n.type==="auto-number"?i[n.id]=null:n.type==="number"||n.type==="currency"?i[n.id]=n.defaultValue||0:(n.type,i[n.id]=n.defaultValue||"")}),i}getData(){return this.fieldData()}setData(t){this.fieldData.set(t)}};l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=B({type:l,selectors:[["app-dynamic-field-renderer"]],inputs:{schema:[1,"schema"],externalUpdates:[1,"externalUpdates"],selectedClassification:[1,"selectedClassification"]},outputs:{dataChange:"dataChange"},decls:1,vars:1,consts:[[1,"bg-purple-50","dark:bg-purple-950/20","border","border-purple-200","dark:border-purple-900/50","rounded-lg","shadow-md","p-3"],[1,"flex","items-center","gap-2","text-purple-800","dark:text-purple-200","mb-3","pb-2","border-b","border-purple-200","dark:border-purple-800"],[1,"font-bold","text-xs","uppercase","tracking-wide"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[3,"md:col-span-2"],[1,"text-[11px]","font-bold","text-gray-800","dark:text-gray-100","mb-1","flex","items-center","gap-1"],[1,"text-red-500","text-xs"],[1,"text-[9px]","text-gray-500","dark:text-gray-400","mb-1","italic"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","min","max"],[1,"relative"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],[1,"flex","items-center","gap-2"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],[1,"rounded-lg","border","border-purple-200","dark:border-purple-800/50","overflow-hidden","shadow-sm"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min","max"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-gray-500","dark:text-gray-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["value",""],[3,"value"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","checkbox",1,"w-4","h-4","text-purple-600","bg-gray-100","dark:bg-gray-700","border-gray-300","dark:border-gray-600","rounded","focus:ring-purple-500","cursor-pointer",3,"ngModelChange","ngModel","required"],[1,"text-xs","text-gray-700","dark:text-gray-300"],["type","tel","pattern","[0-9]{9}","maxlength","9",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],[1,"overflow-x-auto"],[1,"w-full","border-collapse"],[1,"bg-gradient-to-r","from-purple-50","to-purple-100","dark:from-purple-950/50","dark:to-purple-900/30"],[1,"px-3","py-2","text-left","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700"],[1,"px-3","py-2","text-center","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700","w-16"],[1,"bg-white","dark:bg-slate-800"],[1,"border-b","border-purple-100","dark:border-purple-900/30","hover:bg-purple-50/50","dark:hover:bg-purple-950/20","transition-colors"],[1,"border-t","border-purple-300","dark:border-purple-700","p-2","from-purple-100/70","to-white","dark:from-purple-950/40","dark:to-purple-800/60"],[1,"text-red-500","ml-0.5"],[1,"px-3","py-2"],[1,"px-3","py-2","text-center"],[1,"flex","items-center","justify-center","w-7","h-7","rounded-full","bg-purple-100","dark:bg-purple-900/30","text-[11px]","font-bold","text-purple-700","dark:text-purple-300"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-purple-600","dark:text-purple-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-6","pr-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","button","title","Eliminar fila",1,"inline-flex","items-center","justify-center","w-7","h-7","rounded-full","hover:bg-red-50","dark:hover:bg-red-900/20","text-red-500","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","transition-colors",3,"click"],[1,"px-4","py-12","text-center"],[1,"flex","flex-col","items-center","gap-2"],[1,"w-12","h-12","rounded-full","bg-purple-100","dark:bg-purple-900/30","flex","items-center","justify-center"],[1,"text-[11px]","text-gray-500","dark:text-gray-400","font-medium"],[1,"text-[10px]","text-gray-400","dark:text-gray-500"],["type","button",1,"w-full","py-1.5","px-3","border","border-dashed","border-purple-400","dark:border-purple-600","rounded-lg","text-purple-900/50","dark:text-purple-300","hover:bg-purple-100","dark:hover:bg-purple-900/50","hover:border-purple-600","dark:hover:border-purple-400","transition-all","flex","items-center","justify-center","gap-2","text-[11px]","font-semibold",3,"click"]],template:function(i,n){i&1&&g(0,Ge,7,0,"div",0),i&2&&m(n.schema()&&n.schema().fields&&n.schema().fields.length>0?0:-1)},dependencies:[J,pe,ie,ne,Q,ee,K,te,X,ae,de,se,ce,le,oe,re,Z],styles:["[_nghost-%COMP%]{display:contents}"]});let r=l;return r})();var st=(()=>{let l=class l{constructor(t){this.http=t,this.baseUrl=`${V.tipificacionUrl}/system-config`,this.classificationsUrl=`${V.tipificacionUrl}/typifications`,this.contactClassifications=T([]),this.managementClassifications=T([]),this.campaigns=T([]),this.tenantClassifications=T([]),this.isLoading=T(!1),this.isLoaded=T(!1)}setTenantAndPortfolio(t,i,n){this.tenantClassifications.set([]),this.contactClassifications.set([]),this.managementClassifications.set([]),this.currentTenantId=t,this.currentPortfolioId=i,this.currentSubPortfolioId=n,this.loadTenantClassifications(),this.loadTypificationsFromCatalog()}loadAllData(){this.isLoading.set(!0),Promise.all([this.loadTenantClassifications(),this.loadTypificationsFromCatalog()]).finally(()=>{this.isLoading.set(!1),this.isLoaded.set(!0)})}loadTypificationsFromCatalog(){return new Promise(t=>{if(!this.currentTenantId){console.warn("[V2] No se puede cargar tipificaciones sin tenant configurado"),t();return}let i=this.currentSubPortfolioId||0,n=this.currentPortfolioId||0,o=`${V.gatewayUrl}/v2/typifications/config/effective/tenant/${this.currentTenantId}/portfolio/${n}/subportfolio/${i}`;console.log("[V2] Cargando tipificaciones efectivas desde:",o),this.http.get(o).pipe(v(u=>{console.log("[V2] Tipificaciones efectivas cargadas:",u);let _=u.map(c=>({id:c.id,codigo:c.codigo,label:c.nombre,requiresPayment:!1,requiresSchedule:!1,requiresFollowUp:!1,parentId:c.parentTypificationId,hierarchyLevel:c.nivelJerarquia,suggestsFullAmount:c.suggestsFullAmount??null,allowsInstallmentSelection:c.allowsInstallmentSelection??null,requiresManualAmount:c.requiresManualAmount??null}));this.managementClassifications.set(_),console.log("[V2] Nivel 1:",_.filter(c=>c.hierarchyLevel===1).map(c=>`${c.codigo} (${c.label})`)),console.log("[V2] Nivel 2:",_.filter(c=>c.hierarchyLevel===2).map(c=>`${c.codigo} -> parent:${c.parentId}`)),console.log("[V2] Nivel 3:",_.filter(c=>c.hierarchyLevel===3).map(c=>`${c.codigo} -> parent:${c.parentId}`)),console.log("[V2] Nivel 4:",_.filter(c=>c.hierarchyLevel===4).map(c=>`${c.codigo} -> parent:${c.parentId}`))}),M(u=>(console.error("[V2] Error cargando tipificaciones efectivas:",u),this.managementClassifications.set([]),D([])))).subscribe(()=>t())})}loadTenantClassifications(){return new Promise(t=>{if(!this.currentTenantId){t();return}console.log("[TEMPORAL] loadTenantClassifications - endpoint /tenants/.../typifications no existe");let i=[];this.tenantClassifications.set(i),this.contactClassifications.set([]),this.managementClassifications.set([]),t()})}loadContactClassifications(){return new Promise(t=>{this.http.get(`${this.baseUrl}/contact-typifications`).pipe(v(i=>{this.contactClassifications.set(i)}),M(i=>(console.error("Error cargando tipificaciones de contacto:",i),D([])))).subscribe(()=>t())})}loadManagementClassifications(){return new Promise(t=>{this.http.get(`${this.baseUrl}/management-typifications`).pipe(v(i=>{this.managementClassifications.set(i)}),M(i=>(console.error("Error cargando tipificaciones de gesti\xF3n:",i),D([])))).subscribe(()=>t())})}loadActiveCampaigns(){return new Promise(t=>{this.http.get(`${this.baseUrl}/campaigns/active`).pipe(v(i=>{this.campaigns.set(i)}),M(i=>(console.error("Error cargando campa\xF1as:",i),D([])))).subscribe(()=>t())})}refresh(){this.loadAllData()}getContactClassificationsForUI(){return this.contactClassifications().map(t=>({id:t.codigo,codigo:t.codigo,label:t.label,isSuccessful:t.isSuccessful}))}getManagementClassificationsForUI(){return this.managementClassifications().map(t=>({id:String(t.id),codigo:t.codigo,label:t.label,requiere_pago:t.requiresPayment,requiere_cronograma:t.requiresSchedule,requiere_seguimiento:t.requiresFollowUp,parentId:t.parentId,hierarchyLevel:t.hierarchyLevel,suggestsFullAmount:t.suggestsFullAmount,allowsInstallmentSelection:t.allowsInstallmentSelection,requiresManualAmount:t.requiresManualAmount}))}getActiveCampaign(){let t=this.campaigns();return t.length>0?{id:t[0].campaignId,nombre:t[0].nombre,tipo:t[0].campaignType}:null}getClassificationFields(t){if(!this.currentTenantId)throw new Error("No hay tenant configurado");let i=`${V.gatewayUrl}/v2/typifications/config/tenant/${this.currentTenantId}/typifications/${t}/fields`;return this.currentPortfolioId&&(i+=`?portfolioId=${this.currentPortfolioId}`),console.log("[V2] Cargando campos din\xE1micos desde:",i),this.http.get(i).pipe(v(n=>{console.log("[V2] Campos din\xE1micos cargados:",n)}),M(n=>(console.error("[V2] Error cargando campos din\xE1micos:",n),D({typificationId:t,isLeaf:!1,fields:[]}))))}getAllFieldTypes(){let t=`${V.tipificacionUrl}/field-types`;return this.http.get(t).pipe(M(i=>(console.error("Error cargando tipos de campo:",i),D([]))))}getFieldTypesForMainFields(){let t=`${V.tipificacionUrl}/field-types/main-fields`;return this.http.get(t).pipe(M(i=>(console.error("Error cargando tipos para campos principales:",i),D([]))))}getFieldTypesForTableColumns(){let t=`${V.tipificacionUrl}/field-types/table-columns`;return this.http.get(t).pipe(M(i=>(console.error("Error cargando tipos para columnas de tabla:",i),D([]))))}};l.\u0275fac=function(i){return new(i||l)(U(G))},l.\u0275prov=I({token:l,factory:l.\u0275fac,providedIn:"root"});let r=l;return r})();export{tt as a,st as b};
