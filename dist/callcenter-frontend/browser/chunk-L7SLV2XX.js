import{E as W,c as U,f as L,k as O}from"./chunk-VB7IBPYH.js";import{pc as j,qc as H}from"./chunk-Y57AC67X.js";import{a as B}from"./chunk-YQKVMPSG.js";import{a as N,b as w,c as A}from"./chunk-VXC2434B.js";import{Eb as _,Fb as v,Ib as k,Jb as S,Kb as x,Lb as n,Mb as t,Nb as u,Ub as C,Wb as h,Yb as s,_ as E,ab as o,ba as P,fa as M,ga as R,kc as a,lc as b,ma as p,mc as f,na as m,nb as T,nc as D,nd as $,pc as V,qc as I,rc as F,wa as g}from"./chunk-R6PGQ7OV.js";var G=(()=>{let l=class l{constructor(e){this.http=e,this.baseUrl=`${B.gatewayUrl}/excepciones`,this.excepciones=g([]),this.totalExcepciones=g(0),this.cargando=g(!1)}getHeaders(){let e=localStorage.getItem("callcenter_token");return new N({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}getExcepcionesPendientes(e=0,c=20,d){this.cargando.set(!0);let y=new w().set("page",e.toString()).set("size",c.toString());return d&&(y=y.set("idTenant",d.toString())),this.http.get(`${this.baseUrl}/pendientes`,{headers:this.getHeaders(),params:y}).pipe(E(z=>{this.excepciones.set(z.content),this.totalExcepciones.set(z.totalElements),this.cargando.set(!1)}))}countExcepcionesPendientes(e){let c=new w;return e&&(c=c.set("idTenant",e.toString())),this.http.get(`${this.baseUrl}/pendientes/count`,{headers:this.getHeaders(),params:c})}getExcepcion(e){return this.http.get(`${this.baseUrl}/${e}`,{headers:this.getHeaders()})}aprobarExcepcion(e,c){return this.http.post(`${this.baseUrl}/${e}/aprobar`,{comentarios:c},{headers:this.getHeaders()}).pipe(E(()=>{this.excepciones.update(d=>d.filter(y=>y.id!==e)),this.totalExcepciones.update(d=>d-1)}))}rechazarExcepcion(e,c){return this.http.post(`${this.baseUrl}/${e}/rechazar`,{motivo:c},{headers:this.getHeaders()}).pipe(E(()=>{this.excepciones.update(d=>d.filter(y=>y.id!==e)),this.totalExcepciones.update(d=>d-1)}))}};l.\u0275fac=function(c){return new(c||l)(M(A))},l.\u0275prov=P({token:l,factory:l.\u0275fac,providedIn:"root"});let r=l;return r})();var J=(r,l)=>l.id,K=(r,l)=>l.numeroCuota;function Q(r,l){r&1&&(n(0,"div",12),u(1,"lucide-angular",16),n(2,"span",17),a(3,"Cargando excepciones..."),t()()),r&2&&(o(),x("size",40))}function X(r,l){r&1&&(n(0,"div",13),u(1,"lucide-angular",18),n(2,"h3",19),a(3,"No hay excepciones pendientes"),t(),n(4,"p",20),a(5,"Todas las excepciones han sido procesadas"),t()()),r&2&&(o(),x("size",64))}function Y(r,l){if(r&1&&(n(0,"div",33),a(1),t()),r&2){let i=s().$implicit,e=s(2);o(),f(" Base: ",e.formatCurrency(i.montoBase)," ")}}function Z(r,l){r&1&&(n(0,"div",34),a(1," Monto libre "),t())}function ee(r,l){if(r&1){let i=C();n(0,"tr",27)(1,"td",29)(2,"div",30),a(3),t(),n(4,"div",10),a(5),t()(),n(6,"td",31),a(7),t(),n(8,"td",29)(9,"div",32),a(10),t(),_(11,Y,2,1,"div",33)(12,Z,2,0,"div",34),t(),n(13,"td",31),a(14),t(),n(15,"td",31),a(16),t(),n(17,"td",29)(18,"div",35),a(19),t(),n(20,"div",33),a(21),t()(),n(22,"td",29)(23,"div",36)(24,"button",37),h("click",function(){let c=p(i).$implicit,d=s(2);return m(d.verDetalle(c))}),u(25,"lucide-angular",38),t(),n(26,"button",39),h("click",function(){let c=p(i).$implicit,d=s(2);return m(d.aprobar(c))}),u(27,"lucide-angular",40),t(),n(28,"button",41),h("click",function(){let c=p(i).$implicit,d=s(2);return m(d.rechazar(c))}),u(29,"lucide-angular",42),t()()()()}if(r&2){let i=l.$implicit,e=s(2);o(3),b(i.nombreCliente),o(2),b(i.documentoCliente),o(2),f(" ",i.nombreAgente," "),o(3),f(" ",e.formatCurrency(i.montoPromesa)," "),o(),v(i.montoBase?11:12),o(3),f(" ",i.totalCuotas," cuota(s) "),o(2),f(" ",e.formatDate(i.fechaGestion)," "),o(3),b(i.nombreCartera),o(2),b(i.nombreSubcartera),o(4),x("size",18),o(),x("disabled",e.procesando()),o(),x("size",18),o(),x("disabled",e.procesando()),o(),x("size",18)}}function te(r,l){if(r&1){let i=C();n(0,"div",28)(1,"div",10),a(2),t(),n(3,"div",43)(4,"button",44),h("click",function(){p(i);let c=s(2);return m(c.previousPage())}),a(5," Anterior "),t(),n(6,"button",44),h("click",function(){p(i);let c=s(2);return m(c.nextPage())}),a(7," Siguiente "),t()()()}if(r&2){let i=s(2);o(2),D(" P\xE1gina ",i.currentPage()+1," de ",i.totalPages()," "),o(2),x("disabled",i.currentPage()===0),o(2),x("disabled",i.currentPage()>=i.totalPages()-1)}}function ie(r,l){if(r&1&&(n(0,"div",14)(1,"div",21)(2,"table",22)(3,"thead",23)(4,"tr")(5,"th",24),a(6,"Cliente"),t(),n(7,"th",24),a(8,"Agente"),t(),n(9,"th",24),a(10,"Monto"),t(),n(11,"th",24),a(12,"Cuotas"),t(),n(13,"th",24),a(14,"Fecha"),t(),n(15,"th",24),a(16,"Cartera"),t(),n(17,"th",25),a(18,"Acciones"),t()()(),n(19,"tbody",26),k(20,ee,30,14,"tr",27,J),t()()(),_(22,te,8,4,"div",28),t()),r&2){let i=s();o(20),S(i.excepcionesService.excepciones()),o(2),v(i.totalPages()>1?22:-1)}}function ne(r,l){if(r&1&&(n(0,"p",57),a(1),t()),r&2){let i=s(3);o(),f(" ",i.formatCurrency(i.excepcionSeleccionada().montoBase)," ")}}function ae(r,l){r&1&&(n(0,"p",58),a(1,"Monto libre (sin base)"),t())}function re(r,l){if(r&1&&(n(0,"tr")(1,"td",68),a(2),t(),n(3,"td",69),a(4),t(),n(5,"td",68),a(6),t()()),r&2){let i=l.$implicit,e=s(4);o(2),b(i.numeroCuota),o(2),b(e.formatCurrency(i.monto)),o(2),b(e.formatDate(i.fechaPago))}}function oe(r,l){if(r&1&&(n(0,"div")(1,"label",62),a(2,"Cronograma de Cuotas"),t(),n(3,"div",63)(4,"table",64)(5,"thead",65)(6,"tr")(7,"th",66),a(8,"#"),t(),n(9,"th",66),a(10,"Monto"),t(),n(11,"th",66),a(12,"Fecha"),t()()(),n(13,"tbody",67),k(14,re,7,3,"tr",null,K),t()()()()),r&2){let i=s(3);o(14),S(i.excepcionSeleccionada().cuotas)}}function ce(r,l){if(r&1&&(n(0,"div")(1,"label",51),a(2,"Observaciones"),t(),n(3,"p",70),a(4),t()()),r&2){let i=s(3);o(4),f(" ",i.excepcionSeleccionada().observaciones," ")}}function le(r,l){if(r&1){let i=C();n(0,"div",49)(1,"div",50)(2,"div")(3,"label",51),a(4,"Cliente"),t(),n(5,"p",52),a(6),t(),n(7,"p",10),a(8),t()(),n(9,"div")(10,"label",51),a(11,"Agente"),t(),n(12,"p",53),a(13),t()()(),n(14,"div",54)(15,"div",50)(16,"div")(17,"label",55),a(18,"Monto Solicitado"),t(),n(19,"p",56),a(20),t()(),n(21,"div")(22,"label",51),a(23,"Monto Base"),t(),_(24,ne,2,1,"p",57)(25,ae,2,0,"p",58),t()()(),_(26,oe,16,0,"div"),_(27,ce,5,1,"div"),n(28,"div",59)(29,"button",60),h("click",function(){p(i);let c=s(2);return m(c.aprobar(c.excepcionSeleccionada()))}),u(30,"lucide-angular",40),a(31," Aprobar Excepci\xF3n "),t(),n(32,"button",61),h("click",function(){p(i);let c=s(2);return m(c.rechazar(c.excepcionSeleccionada()))}),u(33,"lucide-angular",42),a(34," Rechazar Excepci\xF3n "),t()()()}if(r&2){let i=s(2);o(6),b(i.excepcionSeleccionada().nombreCliente),o(2),b(i.excepcionSeleccionada().documentoCliente),o(5),b(i.excepcionSeleccionada().nombreAgente),o(7),f(" ",i.formatCurrency(i.excepcionSeleccionada().montoPromesa)," "),o(4),v(i.excepcionSeleccionada().montoBase?24:25),o(2),v(i.excepcionSeleccionada().cuotas&&i.excepcionSeleccionada().cuotas.length>0?26:-1),o(),v(i.excepcionSeleccionada().observaciones?27:-1),o(2),x("disabled",i.procesando()),o(),x("size",18),o(2),x("disabled",i.procesando()),o(),x("size",18)}}function de(r,l){if(r&1){let i=C();n(0,"div",15)(1,"div",45)(2,"div",46)(3,"h2",47),a(4,"Detalle de Excepci\xF3n"),t(),n(5,"button",48),h("click",function(){p(i);let c=s();return m(c.cerrarDetalle())}),u(6,"lucide-angular",42),t()(),_(7,le,35,11,"div",49),t()()}if(r&2){let i=s();o(6),x("size",24),o(),v(i.excepcionSeleccionada()?7:-1)}}function se(r,l){if(r&1){let i=C();n(0,"div",15)(1,"div",71)(2,"div",72)(3,"h2",73),u(4,"lucide-angular",74),a(5," Rechazar Excepci\xF3n "),t()(),n(6,"div",75)(7,"label",76),a(8," Motivo del rechazo (obligatorio) "),t(),n(9,"textarea",77),F("ngModelChange",function(c){p(i);let d=s();return I(d.motivoRechazo,c)||(d.motivoRechazo=c),m(c)}),t()(),n(10,"div",78)(11,"button",79),h("click",function(){p(i);let c=s();return m(c.cancelarRechazo())}),a(12," Cancelar "),t(),n(13,"button",80),h("click",function(){p(i);let c=s();return m(c.confirmarRechazo())}),a(14," Confirmar Rechazo "),t()()()()}if(r&2){let i=s();o(4),x("size",24),o(5),V("ngModel",i.motivoRechazo),o(4),x("disabled",!i.motivoRechazo.trim()||i.procesando())}}var we=(()=>{let l=class l{constructor(){this.excepcionesService=R(G),this.currentPage=g(0),this.totalPages=g(0),this.pageSize=20,this.showDetalleModal=g(!1),this.showRechazoModal=g(!1),this.excepcionSeleccionada=g(null),this.excepcionParaRechazar=g(null),this.motivoRechazo="",this.procesando=g(!1)}ngOnInit(){this.cargarExcepciones()}cargarExcepciones(){this.excepcionesService.getExcepcionesPendientes(this.currentPage(),this.pageSize).subscribe({next:e=>{this.totalPages.set(e.totalPages)},error:e=>{console.error("Error cargando excepciones:",e),alert("Error al cargar las excepciones pendientes")}})}verDetalle(e){this.excepcionSeleccionada.set(e),this.showDetalleModal.set(!0)}cerrarDetalle(){this.showDetalleModal.set(!1),this.excepcionSeleccionada.set(null)}aprobar(e){confirm(`\xBFEst\xE1 seguro de APROBAR esta excepci\xF3n?

Cliente: ${e.nombreCliente}
Monto: ${this.formatCurrency(e.montoPromesa)}`)&&(this.procesando.set(!0),this.excepcionesService.aprobarExcepcion(e.id).subscribe({next:()=>{alert("Excepci\xF3n aprobada exitosamente"),this.cerrarDetalle(),this.procesando.set(!1)},error:c=>{console.error("Error aprobando:",c),alert("Error al aprobar la excepci\xF3n"),this.procesando.set(!1)}}))}rechazar(e){this.excepcionParaRechazar.set(e),this.motivoRechazo="",this.showRechazoModal.set(!0)}cancelarRechazo(){this.showRechazoModal.set(!1),this.excepcionParaRechazar.set(null),this.motivoRechazo=""}confirmarRechazo(){let e=this.excepcionParaRechazar();!e||!this.motivoRechazo.trim()||(this.procesando.set(!0),this.excepcionesService.rechazarExcepcion(e.id,this.motivoRechazo.trim()).subscribe({next:()=>{alert("Excepci\xF3n rechazada exitosamente"),this.showRechazoModal.set(!1),this.cerrarDetalle(),this.excepcionParaRechazar.set(null),this.motivoRechazo="",this.procesando.set(!1)},error:c=>{console.error("Error rechazando:",c),alert("Error al rechazar la excepci\xF3n"),this.procesando.set(!1)}}))}previousPage(){this.currentPage()>0&&(this.currentPage.update(e=>e-1),this.cargarExcepciones())}nextPage(){this.currentPage()<this.totalPages()-1&&(this.currentPage.update(e=>e+1),this.cargarExcepciones())}formatCurrency(e){return e==null?"-":new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(e)}formatDate(e){return e?new Date(e).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}};l.\u0275fac=function(c){return new(c||l)},l.\u0275cmp=T({type:l,selectors:[["app-excepciones"]],decls:22,vars:6,consts:[[1,"min-h-screen","bg-gray-100","dark:bg-gray-900","p-6"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white","flex","items-center","gap-3"],["name","alert-triangle",1,"text-amber-500",3,"size"],[1,"text-gray-600","dark:text-gray-400","mt-1"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6"],[1,"bg-white","dark:bg-gray-800","rounded-xl","p-4","shadow-sm","border","border-gray-200","dark:border-gray-700"],[1,"flex","items-center","gap-3"],[1,"p-3","bg-amber-100","dark:bg-amber-900/30","rounded-lg"],["name","clock",1,"text-amber-600","dark:text-amber-400",3,"size"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-white","dark:bg-gray-800","rounded-xl","p-12","text-center","shadow-sm","border","border-gray-200","dark:border-gray-700"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-200","dark:border-gray-700","overflow-hidden"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50","p-4"],["name","loader",1,"animate-spin","text-blue-600",3,"size"],[1,"ml-3","text-gray-600","dark:text-gray-400"],["name","check-circle",1,"mx-auto","text-green-500","mb-4",3,"size"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white","mb-2"],[1,"text-gray-500","dark:text-gray-400"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-gray-50","dark:bg-gray-700"],[1,"px-4","py-3","text-left","text-xs","font-semibold","text-gray-600","dark:text-gray-300","uppercase"],[1,"px-4","py-3","text-center","text-xs","font-semibold","text-gray-600","dark:text-gray-300","uppercase"],[1,"divide-y","divide-gray-200","dark:divide-gray-700"],[1,"hover:bg-gray-50","dark:hover:bg-gray-700/50","transition-colors"],[1,"px-4","py-3","border-t","border-gray-200","dark:border-gray-700","flex","items-center","justify-between"],[1,"px-4","py-3"],[1,"font-medium","text-gray-900","dark:text-white"],[1,"px-4","py-3","text-sm","text-gray-700","dark:text-gray-300"],[1,"font-bold","text-lg","text-amber-600","dark:text-amber-400"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-xs","text-purple-600","dark:text-purple-400","font-medium"],[1,"text-sm","text-gray-700","dark:text-gray-300"],[1,"flex","items-center","justify-center","gap-2"],["title","Ver detalle",1,"p-2","text-blue-600","hover:bg-blue-100","dark:hover:bg-blue-900/30","rounded-lg","transition-colors",3,"click"],["name","eye",3,"size"],["title","Aprobar",1,"p-2","text-green-600","hover:bg-green-100","dark:hover:bg-green-900/30","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled"],["name","check",3,"size"],["title","Rechazar",1,"p-2","text-red-600","hover:bg-red-100","dark:hover:bg-red-900/30","rounded-lg","transition-colors","disabled:opacity-50",3,"click","disabled"],["name","x",3,"size"],[1,"flex","gap-2"],[1,"px-3","py-1","border","border-gray-300","dark:border-gray-600","rounded-lg","text-sm","disabled:opacity-50","hover:bg-gray-100","dark:hover:bg-gray-700",3,"click","disabled"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-xl","max-w-2xl","w-full","max-h-[90vh]","overflow-y-auto"],[1,"p-6","border-b","border-gray-200","dark:border-gray-700","flex","items-center","justify-between"],[1,"text-xl","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-500","hover:text-gray-700","dark:hover:text-gray-300",3,"click"],[1,"p-6","space-y-4"],[1,"grid","grid-cols-2","gap-4"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase"],[1,"text-gray-900","dark:text-white","font-medium"],[1,"text-gray-900","dark:text-white"],[1,"bg-amber-50","dark:bg-amber-900/20","rounded-lg","p-4"],[1,"text-xs","font-semibold","text-amber-700","dark:text-amber-400","uppercase"],[1,"text-2xl","font-bold","text-amber-600","dark:text-amber-400"],[1,"text-xl","text-gray-700","dark:text-gray-300"],[1,"text-purple-600","dark:text-purple-400","font-medium"],[1,"flex","gap-3","pt-4","border-t","border-gray-200","dark:border-gray-700"],[1,"flex-1","bg-green-600","hover:bg-green-700","text-white","py-2.5","px-4","rounded-lg","font-medium","flex","items-center","justify-center","gap-2","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","bg-red-600","hover:bg-red-700","text-white","py-2.5","px-4","rounded-lg","font-medium","flex","items-center","justify-center","gap-2","disabled:opacity-50",3,"click","disabled"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase","mb-2","block"],[1,"bg-gray-50","dark:bg-gray-700","rounded-lg","overflow-hidden"],[1,"w-full","text-sm"],[1,"bg-gray-100","dark:bg-gray-600"],[1,"px-3","py-2","text-left"],[1,"divide-y","divide-gray-200","dark:divide-gray-600"],[1,"px-3","py-2"],[1,"px-3","py-2","font-medium"],[1,"text-gray-700","dark:text-gray-300","bg-gray-50","dark:bg-gray-700","rounded-lg","p-3","mt-1"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-xl","max-w-md","w-full"],[1,"p-6","border-b","border-gray-200","dark:border-gray-700"],[1,"text-xl","font-bold","text-gray-900","dark:text-white","flex","items-center","gap-2"],["name","x-circle",1,"text-red-500",3,"size"],[1,"p-6"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2"],["rows","4","placeholder","Ingrese el motivo del rechazo...",1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","focus:ring-2","focus:ring-red-500",3,"ngModelChange","ngModel"],[1,"p-6","border-t","border-gray-200","dark:border-gray-700","flex","gap-3"],[1,"flex-1","border","border-gray-300","dark:border-gray-600","text-gray-700","dark:text-gray-300","py-2","px-4","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-700",3,"click"],[1,"flex-1","bg-red-600","hover:bg-red-700","text-white","py-2","px-4","rounded-lg","font-medium","disabled:opacity-50",3,"click","disabled"]],template:function(c,d){c&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),u(3,"lucide-angular",3),a(4," Excepciones Pendientes "),t(),n(5,"p",4),a(6," Promesas con montos personalizados pendientes de aprobaci\xF3n "),t()(),n(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),u(11,"lucide-angular",9),t(),n(12,"div")(13,"p",10),a(14,"Pendientes"),t(),n(15,"p",11),a(16),t()()()()(),_(17,Q,4,1,"div",12)(18,X,6,1,"div",13)(19,ie,23,1,"div",14),_(20,de,8,2,"div",15),_(21,se,15,3,"div",15),t()),c&2&&(o(3),x("size",28),o(8),x("size",24),o(5),b(d.excepcionesService.totalExcepciones()),o(),v(d.excepcionesService.cargando()?17:d.excepcionesService.excepciones().length===0?18:19),o(3),v(d.showDetalleModal()?20:-1),o(),v(d.showRechazoModal()?21:-1))},dependencies:[$,W,U,L,O,H,j],encapsulation:2});let r=l;return r})();export{we as ExcepcionesComponent};
