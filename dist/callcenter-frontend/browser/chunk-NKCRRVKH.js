import{A as ve,B as Se,E as pe,b as ke,c as ne,f as ie,k as oe,m as re,s as ae,t as le,u as de,v as se,w as ce,x as Me,y as De,z as Fe}from"./chunk-E2JO3TS2.js";import{hc as ye,ic as we}from"./chunk-55452F6D.js";import{a as v}from"./chunk-YQKVMPSG.js";import{b as P,c as te}from"./chunk-72Z2NTOL.js";import{Db as fe,Eb as x,Ec as be,Fb as C,Fc as j,Gb as he,Gc as J,H as N,Hb as xe,Ib as V,Jb as E,Jc as me,Kb as h,Kc as Y,Lb as s,Mb as d,Nb as $,Ub as b,Wb as F,Yb as a,_ as H,a as B,ab as c,ba as K,fa as Q,ic as Ce,jc as U,kc as f,lc as R,ld as ee,ma as g,mc as O,na as _,nb as X,nc as Z,pc as k,qc as M,r as q,rc as D,vb as ue,wa as w}from"./chunk-BDAG5FYU.js";var Te=(o,l)=>l.field,Ve=(o,l)=>l.numeroCuota;function Ee(o,l){if(o&1&&(s(0,"span",13),f(1),d()),o&2){let n=a().$implicit;U(n.restriccionFecha==="DENTRO_MES"?"bg-amber-100 dark:bg-amber-900/50 text-amber-700 dark:text-amber-300":"bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300"),c(),O(" ",n.restriccionFecha==="DENTRO_MES"?"Este mes":"Pr\xF3x. mes+"," ")}}function Pe(o,l){if(o&1){let n=b();s(0,"button",9),F("click",function(){let t=g(n).$implicit,i=a();return _(i.selectAmount(t.value,t.field,t.restriccionFecha,t.generaCartaAcuerdo))}),s(1,"span",10),f(2),d(),s(3,"span",11),f(4),d(),x(5,Ee,2,3,"span",12),d()}if(o&2){let n=l.$implicit,e=a();U("flex flex-col items-center p-3 border-2 rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md "+(e.selectedField()===n.field&&!e.isCustomAmount()?"border-blue-500 bg-blue-500 dark:bg-blue-600 text-white shadow-lg shadow-blue-500/30":"border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:border-blue-400 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-slate-600")),c(2),R(n.label),c(2),R(e.formatCurrency(n.value)),c(),C(n.restriccionFecha&&n.restriccionFecha!=="SIN_RESTRICCION"?5:-1)}}function Re(o,l){if(o&1){let n=b();s(0,"input",17),D("ngModelChange",function(t){g(n);let i=a(2);return M(i.customAmountValue,t)||(i.customAmountValue=t),_(t)}),F("ngModelChange",function(t){g(n);let i=a(2);return _(i.onCustomAmountChange(t))})("click",function(t){return g(n),_(t.stopPropagation())}),d()}if(o&2){let n=a(2);k("ngModel",n.customAmountValue)}}function Ie(o,l){o&1&&$(0,"lucide-angular",16),o&2&&h("size",16)}function qe(o,l){if(o&1){let n=b();s(0,"button",9),F("click",function(){g(n);let t=a();return _(t.enableCustomAmount())}),s(1,"span",14),f(2,"Otro monto"),d(),x(3,Re,1,1,"input",15)(4,Ie,1,1,"lucide-angular",16),d()}if(o&2){let n=a();U("flex flex-col items-center p-3 border-2 rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md "+(n.isCustomAmount()?"col-span-2 border-purple-500 bg-purple-500 dark:bg-purple-600 text-white shadow-lg shadow-purple-500/30":"border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:border-purple-400 dark:hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-slate-600")),c(3),C(n.isCustomAmount()?3:4)}}function Ne(o,l){if(o&1&&(s(0,"option",22),f(1),d()),o&2){let n=l.$implicit,e=a(2);h("value",n.field),c(),Z("",n.label," (",e.formatCurrency(n.value),")")}}function Ue(o,l){if(o&1){let n=b();s(0,"div",25),F("click",function(){g(n);let t=a(3);return _(t.showPercentageEditor.set(!1))}),d(),s(1,"div",26)(2,"div",27),$(3,"div",28),s(4,"div",23)(5,"label",29),f(6,"Ajuste %"),d(),s(7,"div",30)(8,"button",31),F("click",function(){g(n);let t=a(3);return _(t.setDiscountMode(!0))}),$(9,"lucide-angular",32),d(),s(10,"input",33),F("ngModelChange",function(t){g(n);let i=a(3);return _(i.onPercentageChange(t))})("click",function(t){return g(n),_(t.stopPropagation())}),d(),s(11,"button",31),F("click",function(){g(n);let t=a(3);return _(t.setDiscountMode(!1))}),$(12,"lucide-angular",34),d()(),s(13,"p",35),f(14),d()()()()}if(o&2){let n=a(3);c(8),U(n.isDiscountMode()?"bg-red-500 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-500 hover:bg-red-100 dark:hover:bg-red-900/30"),c(),h("size",14),c(),h("ngModel",n.editablePercentage()),c(),U(n.isDiscountMode()?"bg-slate-100 dark:bg-slate-700 text-slate-500 hover:bg-green-100 dark:hover:bg-green-900/30":"bg-green-500 text-white"),c(),h("size",14),c(2),O(" Base: ",n.formatCurrency(n.montoBase()||0)," ")}}function Oe(o,l){if(o&1){let n=b();s(0,"div",23)(1,"button",24),F("click",function(t){g(n);let i=a(2);return _(i.togglePercentageEditor(t))}),f(2),d(),x(3,Ue,15,8),d()}if(o&2){let n=a(2);c(),U(n.getDiscountInfo().isDiscount?"bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800/50":"bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-800/50"),c(),Z(" ",n.getDiscountInfo().isDiscount?"-":"+","",n.getDiscountInfo().percentage,"% "),c(),C(n.showPercentageEditor()?3:-1)}}function We(o,l){if(o&1){let n=b();s(0,"div",7),$(1,"lucide-angular",18),s(2,"span",19),f(3,"Campo base:"),d(),s(4,"select",20),F("ngModelChange",function(t){g(n);let i=a();return _(i.onBaseFieldChange(t))}),s(5,"option",21),f(6,"Ninguno (monto libre)"),d(),V(7,Ne,2,3,"option",22,Te),d(),x(9,Oe,4,5,"div",23),d()}if(o&2){let n=a();c(),h("size",16),c(3),h("ngModel",n.selectedBaseField()),c(3),E(n.regularAmountOptions()),c(2),C(n.selectedBaseField()?9:-1)}}function Be(o,l){if(o&1){let n=b();s(0,"button",9),F("click",function(){let t=g(n).$implicit,i=a(2);return _(i.setInstallments(t))}),f(1),d()}if(o&2){let n=l.$implicit,e=a(2);U("px-4 py-2 border-2 rounded-lg cursor-pointer transition-all duration-200 text-sm font-medium hover:shadow-md "+(e.numberOfInstallments()===n?"border-emerald-500 bg-emerald-500 dark:bg-emerald-600 text-white shadow-lg shadow-emerald-500/30":"border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:border-emerald-400 dark:hover:border-emerald-500 hover:bg-emerald-50 dark:hover:bg-slate-600")),c(),Z(" ",n," ",n===1?"cuota":"cuotas"," ")}}function Le(o,l){if(o&1&&(s(0,"div",1)(1,"label",2)(2,"div",36),$(3,"lucide-angular",37),d(),f(4," N\xFAmero de Cuotas "),d(),s(5,"div",38),V(6,Be,2,4,"button",6,xe),d()()),o&2){let n=a();c(3),h("size",14),c(3),E(n.installmentOptions)}}function ze(o,l){if(o&1&&(s(0,"div",50),$(1,"lucide-angular",51),s(2,"span"),f(3),d()()),o&2){let n=a(2);U(n.selectedRestriccion()==="DENTRO_MES"?"bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300 border border-amber-200 dark:border-amber-800":"bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 border border-purple-200 dark:border-purple-800"),c(),h("size",14),c(2),R(n.dateRestrictionInfo().message)}}function je(o,l){if(o&1){let n=b();s(0,"div",43)(1,"div",52),$(2,"lucide-angular",53),f(3),d(),s(4,"div",46)(5,"label",54),f(6,"Monto:"),d(),s(7,"input",55),D("ngModelChange",function(t){let i=g(n).$implicit;return M(i.monto,t)||(i.monto=t),_(t)}),F("ngModelChange",function(){let t=g(n).$implicit,i=a(2);return _(i.onInstallmentAmountChange(t.numeroCuota))}),d()(),s(8,"div",46)(9,"label",54),f(10,"Fecha:"),d(),s(11,"input",56),D("ngModelChange",function(t){let i=g(n).$implicit;return M(i.fechaPago,t)||(i.fechaPago=t),_(t)}),F("ngModelChange",function(){g(n);let t=a(2);return _(t.onInstallmentChange())}),d()()()}if(o&2){let n=l.$implicit,e=a(2);c(2),h("size",14),c(),O(" Cuota ",n.numeroCuota," "),c(4),k("ngModel",n.monto),h("min",1),c(4),k("ngModel",n.fechaPago),h("min",e.dateRestrictionInfo().minDate)("max",e.dateRestrictionInfo().maxDate)}}function Ye(o,l){if(o&1&&(s(0,"div",49)(1,"span"),f(2,"Monto por cuota:"),d(),s(3,"span",57),f(4),d()()),o&2){let n=a(2);c(4),R(n.formatCurrency(n.amountPerInstallment()))}}function Ge(o,l){if(o&1&&(s(0,"div",8)(1,"label",2)(2,"div",39),$(3,"lucide-angular",40),d(),f(4," Detalle del Cronograma "),d(),x(5,ze,4,4,"div",41),s(6,"div",42),V(7,je,12,7,"div",43,Ve),d(),s(9,"div",44)(10,"div",45)(11,"span",46),$(12,"lucide-angular",47),f(13," Monto Total: "),d(),s(14,"span",48),f(15),d()(),x(16,Ye,5,1,"div",49),d()()),o&2){let n=a();c(3),h("size",14),c(2),C(n.dateRestrictionInfo().message?5:-1),c(2),E(n.installments()),c(5),h("size",16),c(3),R(n.formatCurrency(n.totalAmount())),c(),C(n.numberOfInstallments()>1?16:-1)}}var $e=(()=>{let l=class l{constructor(){this.availableAmounts=Y([]),this.maxInstallments=6,this.scheduleChange=new ue,this.customAmountSelected=new ue,this.selectedAmount=w(0),this.selectedField=w(void 0),this.selectedRestriccion=w("SIN_RESTRICCION"),this.selectedGeneraCartaAcuerdo=w(!1),this.numberOfInstallments=w(1),this.installments=w([]),this.customAmountValue=0,this._isCustomAmount=w(!1),this.montoBase=w(void 0),this.selectedBaseField=w(""),this.showPercentageEditor=w(!1),this.editablePercentage=w(0),this.isDiscountMode=w(!0),this.amountOptions=j(()=>this.availableAmounts()),this.dateRestrictionInfo=j(()=>{let e=this.selectedRestriccion(),t=new Date,i=t.getMonth(),r=t.getFullYear(),p=new Date(r,i+1,0),m=new Date(r,i+1,1),u=y=>{let W=y.getFullYear(),L=String(y.getMonth()+1).padStart(2,"0"),I=String(y.getDate()).padStart(2,"0");return`${W}-${L}-${I}`};switch(e){case"DENTRO_MES":return{minDate:u(t),maxDate:u(p),message:`Solo fechas dentro del mes actual (hasta ${p.toLocaleDateString("es-PE")})`};case"FUERA_MES":return{minDate:u(m),maxDate:void 0,message:`Solo fechas a partir del ${m.toLocaleDateString("es-PE")}`};default:return{minDate:u(t),maxDate:void 0,message:void 0}}}),this.regularAmountOptions=j(()=>this.availableAmounts().filter(e=>e.field!=="personalizado")),this.hasCustomOption=j(()=>this.availableAmounts().some(e=>e.field==="personalizado")),this.totalAmount=j(()=>this.installments().reduce((e,t)=>e+(t.monto||0),0)),this.amountPerInstallment=j(()=>{let e=this.numberOfInstallments(),t=this.selectedAmount();return e>0?t/e:0}),this.installmentOptions=[],this.minDate="",this.MIN_CUOTA_AMOUNT=1}ngOnInit(){this.installmentOptions=Array.from({length:this.maxInstallments},(t,i)=>i+1);let e=new Date;this.minDate=this.formatDateToYYYYMMDD(e)}isCustomAmount(){return this._isCustomAmount()}selectAmount(e,t,i,r){this._isCustomAmount.set(!1),this.selectedAmount.set(e),this.selectedField.set(t),this.selectedRestriccion.set(i||"SIN_RESTRICCION"),this.selectedGeneraCartaAcuerdo.set(r||!1),this.montoBase.set(e),this.generateInstallments(),this.customAmountSelected.emit(!1)}getRestriccionForField(e){return this.availableAmounts().find(i=>i.field===e)?.restriccionFecha||"SIN_RESTRICCION"}enableCustomAmount(){this._isCustomAmount.set(!0),this.selectedField.set(void 0),this.montoBase.set(void 0),this.selectedBaseField.set(""),this.customAmountSelected.emit(!0),this.customAmountValue>0&&(this.selectedAmount.set(this.customAmountValue),this.generateInstallments())}onCustomAmountChange(e){if(this.customAmountValue=e,this.selectedAmount.set(e),this.selectedBaseField()){let t=this.availableAmounts().find(i=>i.field===this.selectedBaseField());t&&(this.montoBase.set(t.value),this.selectedField.set(t.field))}this.generateInstallments()}onBaseFieldChange(e){if(this.selectedBaseField.set(e),e){let t=this.availableAmounts().find(i=>i.field===e);t&&(this.montoBase.set(t.value),this.selectedField.set(t.field))}else this.montoBase.set(void 0),this.selectedField.set(void 0);this.emitChange()}getDiscountInfo(){let e=this.montoBase(),t=this.customAmountValue;if(!e||!t||e===t)return{hasDiscount:!1,isDiscount:!1,percentage:0};let i=e-t,r=Math.abs(Math.round(i/e*100));return{hasDiscount:!0,isDiscount:i>0,percentage:r}}togglePercentageEditor(e){e.stopPropagation();let t=!this.showPercentageEditor();if(this.showPercentageEditor.set(t),t){let i=this.getDiscountInfo();this.editablePercentage.set(i.percentage),this.isDiscountMode.set(i.isDiscount)}}setDiscountMode(e){this.isDiscountMode.set(e),this.applyPercentageToAmount(this.editablePercentage())}onPercentageChange(e){this.editablePercentage.set(e),this.applyPercentageToAmount(e)}applyPercentageToAmount(e){let t=this.montoBase();if(!t)return;let i;this.isDiscountMode()?i=t*(1-e/100):i=t*(1+e/100),this.customAmountValue=Math.round(i*100)/100,this.selectedAmount.set(this.customAmountValue),this.generateInstallments()}setInstallments(e){this.numberOfInstallments.set(e),this.generateInstallments()}generateInstallments(){let e=this.selectedAmount(),t=this.numberOfInstallments();if(e<=0||t<=0){this.installments.set([]),this.emitChange();return}let i=Math.floor(e/t*100)/100,r=Math.round((e-i*t)*100)/100,p=[],m=this.selectedRestriccion(),u,y=new Date,W=y.getMonth(),L=y.getFullYear();m==="FUERA_MES"?u=new Date(L,W+1,1):(u=new Date(y),u.setDate(u.getDate()+1));let I=m==="DENTRO_MES"?new Date(L,W+1,0):null;for(let A=0;A<t;A++){let S;if(m==="DENTRO_MES"&&I){let z=Math.max(1,I.getDate()-u.getDate()),G=Math.floor(z/t);S=new Date(u),S.setDate(u.getDate()+G*A),S>I&&(S=new Date(I))}else m==="FUERA_MES"?(S=new Date(u),S.setDate(S.getDate()+30*A)):(S=new Date(y),S.setDate(S.getDate()+30*(A+1)));let T=A===t-1?i+r:i;p.push({numeroCuota:A+1,monto:T,fechaPago:this.formatDateToYYYYMMDD(S)})}this.installments.set(p),this.emitChange()}onInstallmentChange(){this.emitChange()}onInstallmentAmountChange(e){let t=this.installments(),i=this.selectedAmount(),r=t.length,p=e-1,m=t[p];m.monto<this.MIN_CUOTA_AMOUNT&&(m.monto=this.MIN_CUOTA_AMOUNT);let u=0;for(let T=0;T<p;T++)u+=t[T].monto||0;let W=(r-e)*this.MIN_CUOTA_AMOUNT,L=i-u-W;if(m.monto>L&&(m.monto=Math.max(this.MIN_CUOTA_AMOUNT,Math.floor(L*100)/100)),e>=r){this.installments.set([...t]),this.emitChange();return}let I=0;for(let T=0;T<e;T++)I+=t[T].monto||0;let A=i-I,S=r-e;if(A<S*this.MIN_CUOTA_AMOUNT){let T=Math.floor(A/S*100)/100;for(let z=e;z<r;z++)t[z].monto=Math.max(this.MIN_CUOTA_AMOUNT,T)}else{let T=Math.floor(A/S*100)/100,z=Math.round((A-T*S)*100)/100;for(let G=e;G<r;G++)t[G].monto=G===r-1?T+z:T}this.installments.set([...t]),this.emitChange()}emitChange(){let e=this.installments();if(e.length===0){this.scheduleChange.emit(null);return}let t={montoTotal:this.selectedAmount(),numeroCuotas:this.numberOfInstallments(),cuotas:e,campoMontoOrigen:this.selectedField(),montoBase:this.montoBase(),generaCartaAcuerdo:this.selectedGeneraCartaAcuerdo()};this.scheduleChange.emit(t)}formatCurrency(e){return new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(e)}formatDateToYYYYMMDD(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=X({type:l,selectors:[["app-payment-schedule"]],inputs:{availableAmounts:[1,"availableAmounts"],maxInstallments:"maxInstallments"},outputs:{scheduleChange:"scheduleChange",customAmountSelected:"customAmountSelected"},decls:13,vars:5,consts:[[1,"payment-schedule-container","bg-slate-100","dark:bg-slate-800/50","border","border-slate-200","dark:border-slate-700","rounded-xl","p-4","transition-colors","duration-300"],[1,"field-group","mb-5"],[1,"flex","items-center","gap-2","font-semibold","text-slate-700","dark:text-slate-200","text-sm","mb-3","transition-colors","duration-300"],[1,"w-6","h-6","bg-emerald-100","dark:bg-emerald-900/50","rounded-lg","flex","items-center","justify-center","transition-colors","duration-300"],["name","wallet",1,"text-emerald-600","dark:text-emerald-400",3,"size"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-4","xl:grid-cols-6","gap-2"],["type","button",3,"class"],[1,"mt-3","flex","items-center","gap-3","p-3","bg-purple-50","dark:bg-purple-900/20","rounded-lg","border","border-purple-200","dark:border-purple-800"],[1,"field-group"],["type","button",3,"click"],[1,"text-[10px]","opacity-70","leading-tight","text-center"],[1,"text-sm","font-bold","mt-1"],[1,"text-[8px]","mt-1","px-1.5","py-0.5","rounded-full",3,"class"],[1,"text-[8px]","mt-1","px-1.5","py-0.5","rounded-full"],[1,"text-[10px]","opacity-70"],["type","number","placeholder","0.00","min","0","step","0.01",1,"w-full","mt-1","px-3","py-1.5","border","border-white/30","rounded","text-center","text-base","font-bold","bg-white/90","dark:bg-slate-800","text-slate-800","dark:text-white","min-w-[120px]",3,"ngModel"],["name","edit-3",1,"mt-1",3,"size"],["type","number","placeholder","0.00","min","0","step","0.01",1,"w-full","mt-1","px-3","py-1.5","border","border-white/30","rounded","text-center","text-base","font-bold","bg-white/90","dark:bg-slate-800","text-slate-800","dark:text-white","min-w-[120px]",3,"ngModelChange","click","ngModel"],["name","link",1,"text-purple-500","flex-shrink-0",3,"size"],[1,"text-xs","text-purple-700","dark:text-purple-300"],[1,"flex-1","px-2","py-1.5","text-sm","border","border-purple-300","dark:border-purple-600","rounded-lg","bg-white","dark:bg-slate-700","text-slate-700","dark:text-slate-200","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"relative"],["type","button",1,"text-xs","font-medium","px-2.5","py-1","rounded-full","cursor-pointer","transition-all","duration-200","hover:scale-105","hover:shadow-md",3,"click"],[1,"fixed","inset-0","z-40",3,"click"],[1,"absolute","right-0","top-full","mt-2","z-50","animate-in","fade-in","slide-in-from-top-2","duration-200"],[1,"bg-white","dark:bg-slate-800","rounded-xl","shadow-xl","border","border-slate-200","dark:border-slate-600","p-3","min-w-[180px]"],[1,"absolute","-top-2","right-4","w-4","h-4","bg-white","dark:bg-slate-800","border-l","border-t","border-slate-200","dark:border-slate-600","transform","rotate-45"],[1,"text-[10px]","text-slate-500","dark:text-slate-400","uppercase","tracking-wide","font-medium"],[1,"flex","items-center","gap-2","mt-1.5"],["type","button",1,"w-7","h-7","rounded-lg","flex","items-center","justify-center","transition-colors",3,"click"],["name","minus",3,"size"],["type","number","min","0","max","100","step","1",1,"flex-1","w-16","px-2","py-1.5","text-center","text-sm","font-bold","border","border-slate-200","dark:border-slate-600","rounded-lg","bg-slate-50","dark:bg-slate-700","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"ngModelChange","click","ngModel"],["name","plus",3,"size"],[1,"text-[10px]","text-slate-400","dark:text-slate-500","mt-2","text-center"],[1,"w-6","h-6","bg-blue-100","dark:bg-blue-900/50","rounded-lg","flex","items-center","justify-center","transition-colors","duration-300"],["name","calendar-days",1,"text-blue-600","dark:text-blue-400",3,"size"],[1,"flex","flex-wrap","gap-2"],[1,"w-6","h-6","bg-amber-100","dark:bg-amber-900/50","rounded-lg","flex","items-center","justify-center","transition-colors","duration-300"],["name","list-ordered",1,"text-amber-600","dark:text-amber-400",3,"size"],[1,"mb-3","px-3","py-2","rounded-lg","text-xs","flex","items-center","gap-2",3,"class"],[1,"bg-white","dark:bg-slate-700/50","rounded-xl","border","border-slate-200","dark:border-slate-600","overflow-hidden","transition-colors","duration-300"],[1,"grid","grid-cols-1","sm:grid-cols-[100px_1fr_1fr]","gap-3","p-3","border-b","border-slate-100","dark:border-slate-600","last:border-b-0","items-center","transition-colors","duration-300"],[1,"mt-4","p-4","bg-emerald-50","dark:bg-emerald-900/30","rounded-xl","border","border-emerald-200","dark:border-emerald-800","transition-colors","duration-300"],[1,"flex","justify-between","items-center","text-sm","text-emerald-700","dark:text-emerald-300"],[1,"flex","items-center","gap-2"],["name","calculator",3,"size"],[1,"text-lg","font-bold"],[1,"flex","justify-between","items-center","text-sm","text-emerald-600","dark:text-emerald-400","mt-2","pt-2","border-t","border-emerald-200","dark:border-emerald-700"],[1,"mb-3","px-3","py-2","rounded-lg","text-xs","flex","items-center","gap-2"],["name","info",3,"size"],[1,"font-bold","text-blue-600","dark:text-blue-400","text-sm","flex","items-center","gap-2"],["name","hash",3,"size"],[1,"text-xs","text-slate-500","dark:text-slate-400","min-w-[50px]"],["type","number","step","0.01",1,"flex-1","px-3","py-2","border","border-slate-200","dark:border-slate-500","rounded-lg","text-sm","bg-slate-50","dark:bg-slate-600","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","duration-200",3,"ngModelChange","ngModel","min"],["type","date",1,"flex-1","px-3","py-2","border","border-slate-200","dark:border-slate-500","rounded-lg","text-sm","bg-slate-50","dark:bg-slate-600","text-slate-800","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","duration-200",3,"ngModelChange","ngModel","min","max"],[1,"font-semibold"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1)(2,"label",2)(3,"div",3),$(4,"lucide-angular",4),d(),f(5," Seleccionar Monto "),d(),s(6,"div",5),V(7,Pe,6,5,"button",6,Te),x(9,qe,5,3,"button",6),d(),x(10,We,10,3,"div",7),d(),x(11,Le,8,1,"div",1),x(12,Ge,17,5,"div",8),d()),t&2&&(c(4),h("size",14),c(3),E(i.regularAmountOptions()),c(2),C(i.hasCustomOption()?9:-1),c(),C(i.isCustomAmount()?10:-1),c(),C(i.selectedAmount()>0?11:-1),c(),C(i.installments().length>0?12:-1))},dependencies:[ee,pe,le,de,ne,re,ae,ie,ce,se,oe,we,ye],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out forwards}input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{filter:invert(0)}html.dark[_nghost-%COMP%]   input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator, html.dark   [_nghost-%COMP%]   input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{filter:invert(1)}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{opacity:1}"]});let o=l;return o})();var _e=(o,l)=>l.id,He=(o,l)=>l.value,Je=(o,l)=>l.value||l;function Ke(o,l){o&1&&(s(0,"span",6),f(1,"*"),d())}function Qe(o,l){if(o&1&&(s(0,"p",7),f(1),d()),o&2){let n=a().$implicit;c(),R(n.helpText)}}function Xe(o,l){if(o&1){let n=b();s(0,"input",21),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);k("ngModel",e.fieldData()[n.id]),h("placeholder",n.placeholder||"")("required",n.required??!1)("minlength",n.minLength??null)("maxlength",n.maxLength??null)}}function Ze(o,l){if(o&1){let n=b();s(0,"input",22),F("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return _(r.updateFieldValue(i.id,t))}),d()}if(o&2){let n=a().$implicit,e=a(2);h("ngModel",e.fieldData()[n.id])("placeholder",n.placeholder||"")("required",n.required??!1)("min",n.min??null)("max",n.max??null)}}function et(o,l){if(o&1){let n=b();s(0,"div",10)(1,"span",23),f(2,"S/"),d(),s(3,"input",24),F("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return _(r.updateFieldValue(i.id,t))}),d()()}if(o&2){let n=a().$implicit,e=a(2);c(3),h("ngModel",e.fieldData()[n.id])("placeholder",n.placeholder||"0.00")("required",n.required??!1)("min",n.min||0)}}function tt(o,l){if(o&1){let n=b();s(0,"input",25),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);k("ngModel",e.fieldData()[n.id]),h("required",n.required??!1)}}function nt(o,l){if(o&1){let n=b();s(0,"input",26),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);k("ngModel",e.fieldData()[n.id]),h("required",n.required??!1)}}function it(o,l){if(o&1&&(s(0,"option",29),f(1),d()),o&2){let n=l.$implicit;h("value",n.value),c(),R(n.label)}}function ot(o,l){if(o&1){let n=b();s(0,"select",27),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),s(1,"option",28),f(2,"-- Seleccionar --"),d(),V(3,it,2,2,"option",29,He),d()}if(o&2){let n=a().$implicit,e=a(2);k("ngModel",e.fieldData()[n.id]),h("required",n.required??!1),c(3),E(n.options)}}function rt(o,l){if(o&1){let n=b();s(0,"textarea",30),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);k("ngModel",e.fieldData()[n.id]),h("placeholder",n.placeholder||"")("required",n.required??!1)("minlength",n.minLength??null)("maxlength",n.maxLength??null)}}function at(o,l){if(o&1){let n=b();s(0,"div",15)(1,"input",31),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),d(),s(2,"span",32),f(3),d()()}if(o&2){let n=a().$implicit,e=a(2);c(),k("ngModel",e.fieldData()[n.id]),h("required",n.required??!1),c(2),R(n.placeholder||"Marcar si aplica")}}function lt(o,l){if(o&1){let n=b();s(0,"div",10)(1,"span",23),f(2,"\u{1F4F1}"),d(),s(3,"input",33),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),d()()}if(o&2){let n=a().$implicit,e=a(2);c(3),k("ngModel",e.fieldData()[n.id]),h("placeholder",n.placeholder||"999 999 999")("required",n.required??!1)}}function dt(o,l){if(o&1){let n=b();s(0,"input",34),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);k("ngModel",e.fieldData()[n.id]),h("required",n.required??!1)}}function st(o,l){if(o&1){let n=b();s(0,"input",35),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);k("ngModel",e.fieldData()[n.id]),h("placeholder",n.placeholder||"ejemplo@correo.com")("required",n.required??!1)}}function ct(o,l){if(o&1){let n=b();s(0,"input",36),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a(2);return M(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);k("ngModel",e.fieldData()[n.id]),h("placeholder",n.placeholder||"https://ejemplo.com")("required",n.required??!1)}}function pt(o,l){if(o&1){let n=b();s(0,"app-payment-schedule",37),F("scheduleChange",function(t){g(n);let i=a().$implicit,r=a(2);return _(r.onPaymentScheduleChange(i.id,t))})("customAmountSelected",function(t){g(n);let i=a(3);return _(i.onCustomAmountSelected(t))}),d()}if(o&2){let n=a().$implicit,e=a(2);h("availableAmounts",e.getPaymentAmountOptions(n))("maxInstallments",6)}}function ut(o,l){o&1&&(s(0,"span",46),f(1,"*"),d())}function mt(o,l){if(o&1&&(s(0,"th",41),f(1),x(2,ut,2,0,"span",46),d()),o&2){let n=l.$implicit;c(),O(" ",n.label," "),c(),C(n.required?2:-1)}}function gt(o,l){o&1&&$(0,"th",42)}function _t(o,l){if(o&1&&(s(0,"div",49),f(1),d()),o&2){let n=a(2).$index;c(),O(" ",n+1," ")}}function ft(o,l){if(o&1){let n=b();s(0,"input",56),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;k("ngModel",e[n.id]),h("required",n.required??!1)}}function ht(o,l){if(o&1){let n=b();s(0,"input",57),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;k("ngModel",e[n.id]),h("required",n.required??!1)}}function xt(o,l){if(o&1){let n=b();s(0,"div",10)(1,"span",58),f(2,"S/"),d(),s(3,"input",59),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),_(t)}),d()()}if(o&2){let n=a().$implicit,e=a().$implicit;c(3),k("ngModel",e[n.id]),h("required",n.required??!1)}}function Ct(o,l){if(o&1){let n=b();s(0,"input",60),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit,t=a(4);k("ngModel",e[n.id]),h("required",n.required??!1)("min",t.getMinDate(n))("max",t.getMaxDate(n))}}function bt(o,l){if(o&1){let n=b();s(0,"input",61),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;k("ngModel",e[n.id]),h("required",n.required??!1)}}function yt(o,l){if(o&1){let n=b();s(0,"input",62),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),_(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;k("ngModel",e[n.id]),h("required",n.required??!1)}}function wt(o,l){if(o&1&&(s(0,"option",29),f(1),d()),o&2){let n=l.$implicit;h("value",n.value||n),c(),O(" ",n.label||n," ")}}function kt(o,l){if(o&1){let n=b();s(0,"select",63),D("ngModelChange",function(t){g(n);let i=a().$implicit,r=a().$implicit;return M(r[i.id],t)||(r[i.id]=t),_(t)}),s(1,"option",28),f(2,"Seleccionar..."),d(),V(3,wt,2,2,"option",29,Je),d()}if(o&2){let n=a().$implicit,e=a().$implicit;k("ngModel",e[n.id]),h("required",n.required??!1),c(3),E(n.options)}}function Mt(o,l){if(o&1&&(s(0,"td",47),x(1,_t,2,1,"div",49)(2,ft,1,2,"input",50)(3,ht,1,2,"input",51)(4,xt,4,2,"div",10)(5,Ct,1,4,"input",52)(6,bt,1,2,"input",53)(7,yt,1,2,"input",54)(8,kt,5,2,"select",55),d()),o&2){let n=l.$implicit;c(),C(n.type==="auto-number"?1:n.type==="text"?2:n.type==="number"?3:n.type==="currency"?4:n.type==="date"?5:n.type==="time"?6:n.type==="phone"?7:n.type==="select"?8:-1)}}function Dt(o,l){if(o&1){let n=b();s(0,"td",48)(1,"button",64),F("click",function(){g(n);let t=a().$index,i=a(2).$implicit,r=a(2);return _(r.removeTableRow(i.id,t))}),d()()}}function Ft(o,l){if(o&1&&(s(0,"tr",44),V(1,Mt,9,1,"td",47,_e),x(3,Dt,2,0,"td",48),d()),o&2){let n=a(2).$implicit;c(),E(n.columns),c(2),C(n.allowDeleteRow?3:-1)}}function vt(o,l){if(o&1&&(s(0,"tr")(1,"td",65)(2,"div",66),$(3,"div",67),s(4,"p",68),f(5,"No hay registros en la tabla"),d(),s(6,"p",69),f(7,'Haz clic en "Agregar Fila" para comenzar'),d()()()()),o&2){let n=a(2).$implicit;c(),fe("colspan",n.columns.length+(n.allowDeleteRow?1:0))}}function St(o,l){if(o&1){let n=b();s(0,"div",45)(1,"button",70),F("click",function(){g(n);let t=a(2).$implicit,i=a(2);return _(i.addTableRow(t.id,t.columns||[]))}),f(2," Agregar Fila "),d()()}}function Tt(o,l){if(o&1&&(s(0,"div",20)(1,"div",38)(2,"table",39)(3,"thead")(4,"tr",40),V(5,mt,3,2,"th",41,_e),x(7,gt,1,0,"th",42),d()(),s(8,"tbody",43),V(9,Ft,4,1,"tr",44,he),x(11,vt,8,1,"tr"),d()()(),x(12,St,3,0,"div",45),d()),o&2){let n=a().$implicit,e=a(2);c(5),E(n.columns),c(2),C(n.allowDeleteRow?7:-1),c(2),E(e.getTableRows(n.id)),c(2),C(e.getTableRows(n.id).length===0?11:-1),c(),C(n.allowAddRow&&(!n.maxRows||e.getTableRows(n.id).length<n.maxRows)?12:-1)}}function $t(o,l){if(o&1&&(s(0,"div")(1,"label",5),f(2),x(3,Ke,2,0,"span",6),d(),x(4,Qe,2,1,"p",7),x(5,Xe,1,5,"input",8),x(6,Ze,1,5,"input",9),x(7,et,4,4,"div",10),x(8,tt,1,2,"input",11),x(9,nt,1,2,"input",12),x(10,ot,5,2,"select",13),x(11,rt,1,5,"textarea",14),x(12,at,4,3,"div",15),x(13,lt,4,3,"div",10),x(14,dt,1,2,"input",16),x(15,st,1,3,"input",17),x(16,ct,1,3,"input",18),x(17,pt,1,2,"app-payment-schedule",19),x(18,Tt,13,3,"div",20),d()),o&2){let n=l.$implicit;Ce("md:col-span-2",n.type==="table"||n.type==="textarea"||n.type==="payment_schedule"),c(2),O(" ",n.label," "),c(),C(n.required?3:-1),c(),C(n.helpText?4:-1),c(),C(n.type==="text"?5:-1),c(),C(n.type==="number"?6:-1),c(),C(n.type==="currency"?7:-1),c(),C(n.type==="date"?8:-1),c(),C(n.type==="datetime"?9:-1),c(),C(n.type==="select"?10:-1),c(),C(n.type==="textarea"?11:-1),c(),C(n.type==="checkbox"?12:-1),c(),C(n.type==="phone"?13:-1),c(),C(n.type==="time"?14:-1),c(),C(n.type==="email"?15:-1),c(),C(n.type==="url"?16:-1),c(),C(n.type==="payment_schedule"?17:-1),c(),C(n.type==="table"?18:-1)}}function At(o,l){if(o&1&&(s(0,"div",0)(1,"div",1)(2,"h3",2),f(3,"Campos Adicionales"),d()(),s(4,"div",3),V(5,$t,19,19,"div",4,_e),d()()),o&2){let n=a();c(5),E(n.schema().fields)}}var Gt=(()=>{let l=class l{constructor(){this.schema=Y(null),this.externalUpdates=Y({}),this.selectedClassification=Y(null),this.customerAmounts=Y([]),this.fieldData=w({}),this.dataChange=me(),this.customAmountDetected=me(),J(()=>{let e=this.schema();if(e&&e.fields){console.log("[DynamicFieldRenderer] Schema received with fields:",e.fields.map(i=>({id:i.id,type:i.type,label:i.label})));let t={};e.fields.forEach(i=>{if(console.log(`[DynamicFieldRenderer] Processing field: ${i.id}, type: ${i.type}`),i.type==="table"){let r=i.minRows||0;t[i.id]=Array.from({length:r},()=>this.createEmptyTableRow(i.columns||[]))}else i.type==="checkbox"?t[i.id]=!1:i.type==="payment_schedule"?t[i.id]=null:t[i.id]=""}),this.fieldData.set(t)}}),J(()=>{let e=this.externalUpdates();if(e&&Object.keys(e).length>0){console.log("[DynamicField] Received external updates:",e);let t=be(()=>B({},this.fieldData())),i=!1;Object.keys(e).forEach(r=>{e[r]!==void 0&&e[r]!==null&&t[r]!==e[r]&&(t[r]=e[r],i=!0)}),i?(console.log("[DynamicField] Applying updates to fieldData"),this.fieldData.set(t)):console.log("[DynamicField] No changes detected, skipping update")}}),J(()=>{let e=this.fieldData(),t=this.schema();if(!t?.fields)return;t.fields.filter(r=>r.type==="table"&&r.linkedToField).forEach(r=>{let p=r.linkedToField,m=e[p];if(console.log(`\u{1F517} Sincronizaci\xF3n n\xFAmero\u2192tabla: "${p}"=${m} \u2192 tabla="${r.id}"`),m&&typeof m=="number"&&m>0){let u=this.getTableRows(r.id),y=Math.floor(m);console.log(`   Filas actuales: ${u.length}, Filas objetivo: ${y}`),u.length!==y&&(console.log(`   \u2705 Ajustando tabla de ${u.length} a ${y} filas`),this.adjustTableRows(r.id,y,r.columns||[]))}})}),J(()=>{this.dataChange.emit(this.fieldData())})}updateFieldValue(e,t){let i=B({},this.fieldData());typeof t=="string"&&t!==""&&!isNaN(Number(t))?i[e]=Number(t):i[e]=t,this.fieldData.set(i),this.checkLinkedTables(e,i)}checkLinkedTables(e,t){let i=this.schema();if(!i?.fields)return;i.fields.filter(p=>p.type==="table"&&p.linkedToField===e).forEach(p=>{let m=t[e];if(m&&typeof m=="number"&&m>0){let u=this.getTableRows(p.id),y=Math.floor(m);u.length!==y&&this.adjustTableRows(p.id,y,p.columns||[])}})}getTableRows(e){let t=this.fieldData()[e];return Array.isArray(t)?t:[]}addTableRow(e,t){let i=B({},this.fieldData());Array.isArray(i[e])||(i[e]=[]);let r=this.createEmptyTableRow(t);i[e].push(r);let p=i[e].length;console.log(`\u2795 Tabla\u2192N\xFAmero: Agregada fila, total=${p}`),this.fieldData.set(i),this.updateLinkedFieldFromTable(e,p)}removeTableRow(e,t){let i=B({},this.fieldData());if(Array.isArray(i[e])){let r=i[e].length,p=this.selectedClassification();if(p?.codigo==="PF"){if(r<=2){alert("Los Pagos Fraccionados requieren m\xEDnimo 2 cuotas. No se puede eliminar m\xE1s filas.");return}}else if(p?.codigo==="CF"&&r<=1){alert("Los Convenios requieren m\xEDnimo 1 cuota. No se puede eliminar esta fila.");return}i[e].splice(t,1);let m=i[e].length;console.log(`\u2796 Tabla\u2192N\xFAmero: Eliminada fila, total=${m}`),this.fieldData.set(i),this.updateLinkedFieldFromTable(e,m)}}updateLinkedFieldFromTable(e,t){let i=this.schema();if(console.log(`\u{1F50D} updateLinkedFieldFromTable: tableFieldId="${e}", rowCount=${t}`),!i?.fields){console.log("   \u274C No hay schema o fields");return}let r=i.fields.find(y=>y.id===e);if(console.log("   Campo tabla encontrado:",r),!r||r.type!=="table"){console.log("   \u274C Campo no encontrado o no es tabla");return}let p=r.linkedToField;if(console.log(`   linkedToField="${p}"`),!p){console.log("   \u274C No hay linkedToField definido");return}let m=B({},this.fieldData()),u=m[p];console.log(`   Valor actual del campo vinculado: ${u}`),u!==t?(m[p]=t,this.fieldData.set(m),console.log(`   \u2705 Campo "${p}" actualizado: ${u} \u2192 ${t}`)):console.log(`   \u26A0\uFE0F El valor ya es ${t}, no se actualiza`)}adjustTableRows(e,t,i){let r=B({},this.fieldData());Array.isArray(r[e])||(r[e]=[]);let p=r[e],m=p.length;if(t>m)for(let u=m;u<t;u++)p.push(this.createEmptyTableRow(i));else t<m&&p.splice(t);this.fieldData.set(r)}getTodayDate(){let e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`}getEndOfMonthDate(){let e=new Date,t=e.getFullYear(),i=e.getMonth(),r=new Date(t,i+1,0).getDate(),p=String(i+1).padStart(2,"0"),m=String(r).padStart(2,"0");return`${t}-${p}-${m}`}getMinDate(e){let t=e.minDate;return t==="today"?this.getTodayDate():t}getMaxDate(e){return this.selectedClassification()?.codigo==="PF"?this.getEndOfMonthDate():e.maxDate}createEmptyTableRow(e){let t={};return e.forEach(i=>{i.type==="auto-number"?t[i.id]=null:i.type==="number"||i.type==="currency"?t[i.id]=i.defaultValue||0:(i.type,t[i.id]=i.defaultValue||"")}),t}getData(){return this.fieldData()}setData(e){this.fieldData.set(e)}getPaymentAmountOptions(e){let t=this.customerAmounts();return t&&t.length>0?(console.log("[DynamicFieldRenderer] Using customer amounts:",t),t):e.options&&e.options.length>0?e.options.map(i=>({label:i.label||String(i.value),value:typeof i.value=="number"?i.value:parseFloat(String(i.value))||0,field:i.field})):(console.log("[DynamicFieldRenderer] No customer amounts, using defaults"),[{label:"Sin datos de deuda",value:0,field:"default"}])}onPaymentScheduleChange(e,t){let i=B({},this.fieldData());i[e]=t,this.fieldData.set(i),console.log("[DynamicField] Payment schedule changed:",e,t)}onCustomAmountSelected(e){console.log("[DynamicField] Custom amount selected:",e),this.customAmountDetected.emit(e)}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=X({type:l,selectors:[["app-dynamic-field-renderer"]],inputs:{schema:[1,"schema"],externalUpdates:[1,"externalUpdates"],selectedClassification:[1,"selectedClassification"],customerAmounts:[1,"customerAmounts"]},outputs:{dataChange:"dataChange",customAmountDetected:"customAmountDetected"},decls:1,vars:1,consts:[[1,"bg-purple-50","dark:bg-purple-950/20","border","border-purple-200","dark:border-purple-900/50","rounded-lg","shadow-md","p-3"],[1,"flex","items-center","gap-2","text-purple-800","dark:text-purple-200","mb-3","pb-2","border-b","border-purple-200","dark:border-purple-800"],[1,"font-bold","text-xs","uppercase","tracking-wide"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[3,"md:col-span-2"],[1,"text-[11px]","font-bold","text-gray-800","dark:text-gray-100","mb-1","flex","items-center","gap-1"],[1,"text-red-500","text-xs"],[1,"text-[9px]","text-gray-500","dark:text-gray-400","mb-1","italic"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","min","max"],[1,"relative"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],[1,"flex","items-center","gap-2"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],[3,"availableAmounts","maxInstallments"],[1,"rounded-lg","border","border-purple-200","dark:border-purple-800/50","overflow-hidden","shadow-sm"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min","max"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-gray-500","dark:text-gray-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["value",""],[3,"value"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","checkbox",1,"w-4","h-4","text-purple-600","bg-gray-100","dark:bg-gray-700","border-gray-300","dark:border-gray-600","rounded","focus:ring-purple-500","cursor-pointer",3,"ngModelChange","ngModel","required"],[1,"text-xs","text-gray-700","dark:text-gray-300"],["type","tel","pattern","[0-9]{9}","maxlength","9",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],[3,"scheduleChange","customAmountSelected","availableAmounts","maxInstallments"],[1,"overflow-x-auto"],[1,"w-full","border-collapse"],[1,"bg-gradient-to-r","from-purple-50","to-purple-100","dark:from-purple-950/50","dark:to-purple-900/30"],[1,"px-3","py-2","text-left","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700"],[1,"px-3","py-2","text-center","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700","w-16"],[1,"bg-white","dark:bg-slate-800"],[1,"border-b","border-purple-100","dark:border-purple-900/30","hover:bg-purple-50/50","dark:hover:bg-purple-950/20","transition-colors"],[1,"border-t","border-purple-300","dark:border-purple-700","p-2","from-purple-100/70","to-white","dark:from-purple-950/40","dark:to-purple-800/60"],[1,"text-red-500","ml-0.5"],[1,"px-3","py-2"],[1,"px-3","py-2","text-center"],[1,"flex","items-center","justify-center","w-7","h-7","rounded-full","bg-purple-100","dark:bg-purple-900/30","text-[11px]","font-bold","text-purple-700","dark:text-purple-300"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-purple-600","dark:text-purple-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-6","pr-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","button","title","Eliminar fila",1,"inline-flex","items-center","justify-center","w-7","h-7","rounded-full","hover:bg-red-50","dark:hover:bg-red-900/20","text-red-500","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","transition-colors",3,"click"],[1,"px-4","py-12","text-center"],[1,"flex","flex-col","items-center","gap-2"],[1,"w-12","h-12","rounded-full","bg-purple-100","dark:bg-purple-900/30","flex","items-center","justify-center"],[1,"text-[11px]","text-gray-500","dark:text-gray-400","font-medium"],[1,"text-[10px]","text-gray-400","dark:text-gray-500"],["type","button",1,"w-full","py-1.5","px-3","border","border-dashed","border-purple-400","dark:border-purple-600","rounded-lg","text-purple-900/50","dark:text-purple-300","hover:bg-purple-100","dark:hover:bg-purple-900/50","hover:border-purple-600","dark:hover:border-purple-400","transition-all","flex","items-center","justify-center","gap-2","text-[11px]","font-semibold",3,"click"]],template:function(t,i){t&1&&x(0,At,7,0,"div",0),t&2&&C(i.schema()&&i.schema().fields&&i.schema().fields.length>0?0:-1)},dependencies:[ee,pe,le,de,ne,re,ke,ae,ie,Me,Fe,ve,Se,De,ce,se,oe,$e],styles:["[_nghost-%COMP%]{display:contents}"]});let o=l;return o})();var en=(()=>{let l=class l{constructor(e){this.http=e,this.baseUrl=`${v.tipificacionUrl}/system-config`,this.classificationsUrl=`${v.tipificacionUrl}/typifications`,this.contactClassifications=w([]),this.managementClassifications=w([]),this.campaigns=w([]),this.tenantClassifications=w([]),this.isLoading=w(!1),this.isLoaded=w(!1)}setTenantAndPortfolio(e,t,i){this.tenantClassifications.set([]),this.contactClassifications.set([]),this.managementClassifications.set([]),this.currentTenantId=e,this.currentPortfolioId=t,this.currentSubPortfolioId=i,this.loadTenantClassifications(),this.loadTypificationsFromCatalog()}loadAllData(){this.isLoading.set(!0),Promise.all([this.loadTenantClassifications(),this.loadTypificationsFromCatalog()]).finally(()=>{this.isLoading.set(!1),this.isLoaded.set(!0)})}loadTypificationsFromCatalog(){return new Promise(e=>{if(!this.currentTenantId){console.warn("[V2] No se puede cargar tipificaciones sin tenant configurado"),e();return}let t=this.currentSubPortfolioId||0,i=this.currentPortfolioId||0,r=`${v.gatewayUrl}/v2/typifications/config/effective/tenant/${this.currentTenantId}/portfolio/${i}/subportfolio/${t}`;console.log("[V2] Cargando tipificaciones efectivas desde:",r),this.http.get(r).pipe(H(p=>{console.log("[V2] Tipificaciones efectivas cargadas:",p);let m=p.map(u=>({id:u.id,codigo:u.codigo,label:u.nombre,requiresPayment:!1,requiresSchedule:!1,requiresFollowUp:!1,parentId:u.parentTypificationId,hierarchyLevel:u.nivelJerarquia,suggestsFullAmount:u.suggestsFullAmount??null,allowsInstallmentSelection:u.allowsInstallmentSelection??null,requiresManualAmount:u.requiresManualAmount??null}));this.managementClassifications.set(m),console.log("[V2] Nivel 1:",m.filter(u=>u.hierarchyLevel===1).map(u=>`${u.codigo} (${u.label})`)),console.log("[V2] Nivel 2:",m.filter(u=>u.hierarchyLevel===2).map(u=>`${u.codigo} -> parent:${u.parentId}`)),console.log("[V2] Nivel 3:",m.filter(u=>u.hierarchyLevel===3).map(u=>`${u.codigo} -> parent:${u.parentId}`)),console.log("[V2] Nivel 4:",m.filter(u=>u.hierarchyLevel===4).map(u=>`${u.codigo} -> parent:${u.parentId}`))}),N(p=>(console.error("[V2] Error cargando tipificaciones efectivas:",p),this.managementClassifications.set([]),q([])))).subscribe(()=>e())})}loadTenantClassifications(){return new Promise(e=>{if(!this.currentTenantId){e();return}console.log("[TEMPORAL] loadTenantClassifications - endpoint /tenants/.../typifications no existe");let t=[];this.tenantClassifications.set(t),this.contactClassifications.set([]),this.managementClassifications.set([]),e()})}loadContactClassifications(){return new Promise(e=>{this.http.get(`${this.baseUrl}/contact-typifications`).pipe(H(t=>{this.contactClassifications.set(t)}),N(t=>(console.error("Error cargando tipificaciones de contacto:",t),q([])))).subscribe(()=>e())})}loadManagementClassifications(){return new Promise(e=>{this.http.get(`${this.baseUrl}/management-typifications`).pipe(H(t=>{this.managementClassifications.set(t)}),N(t=>(console.error("Error cargando tipificaciones de gesti\xF3n:",t),q([])))).subscribe(()=>e())})}loadActiveCampaigns(){return new Promise(e=>{this.http.get(`${this.baseUrl}/campaigns/active`).pipe(H(t=>{this.campaigns.set(t)}),N(t=>(console.error("Error cargando campa\xF1as:",t),q([])))).subscribe(()=>e())})}refresh(){this.loadAllData()}getContactClassificationsForUI(){return this.contactClassifications().map(e=>({id:e.codigo,codigo:e.codigo,label:e.label,isSuccessful:e.isSuccessful}))}getManagementClassificationsForUI(){return this.managementClassifications().map(e=>({id:String(e.id),codigo:e.codigo,label:e.label,requiere_pago:e.requiresPayment,requiere_cronograma:e.requiresSchedule,requiere_seguimiento:e.requiresFollowUp,parentId:e.parentId,hierarchyLevel:e.hierarchyLevel,suggestsFullAmount:e.suggestsFullAmount,allowsInstallmentSelection:e.allowsInstallmentSelection,requiresManualAmount:e.requiresManualAmount}))}getActiveCampaign(){let e=this.campaigns();return e.length>0?{id:e[0].campaignId,nombre:e[0].nombre,tipo:e[0].campaignType}:null}getClassificationFields(e){if(!this.currentTenantId)throw new Error("No hay tenant configurado");let t=`${v.gatewayUrl}/v2/typifications/config/tenant/${this.currentTenantId}/typifications/${e}/fields`;return this.currentPortfolioId&&(t+=`?portfolioId=${this.currentPortfolioId}`),console.log("[V2] Cargando campos din\xE1micos desde:",t),this.http.get(t).pipe(H(i=>{console.log("[V2] Campos din\xE1micos cargados:",i)}),N(i=>(console.error("[V2] Error cargando campos din\xE1micos:",i),q({typificationId:e,isLeaf:!1,fields:[]}))))}getAllFieldTypes(){let e=`${v.tipificacionUrl}/field-types`;return this.http.get(e).pipe(N(t=>(console.error("Error cargando tipos de campo:",t),q([]))))}getFieldTypesForMainFields(){let e=`${v.tipificacionUrl}/field-types/main-fields`;return this.http.get(e).pipe(N(t=>(console.error("Error cargando tipos para campos principales:",t),q([]))))}getFieldTypesForTableColumns(){let e=`${v.tipificacionUrl}/field-types/table-columns`;return this.http.get(e).pipe(N(t=>(console.error("Error cargando tipos para columnas de tabla:",t),q([]))))}};l.\u0275fac=function(t){return new(t||l)(Q(te))},l.\u0275prov=K({token:l,factory:l.\u0275fac,providedIn:"root"});let o=l;return o})();var rn=(()=>{let l=class l{constructor(e){this.http=e,this.catalogUrl=`${v.gatewayUrl}/v2/typifications/catalog`,this.configUrl=`${v.gatewayUrl}/v2/typifications/config`}getAllClassifications(){return this.http.get(`${this.catalogUrl}`)}getActiveClassifications(){return this.http.get(`${this.catalogUrl}/active`)}getTypificationsByType(e){return this.http.get(`${this.catalogUrl}/type/${e}`)}getTypificationsByLevel(e){return this.http.get(`${this.catalogUrl}/level/${e}`)}getTypificationsByParent(e){return this.http.get(`${this.catalogUrl}/${e}/children`)}getClassificationById(e){return this.http.get(`${this.catalogUrl}/${e}`)}getRootTypifications(){return this.http.get(`${this.catalogUrl}/roots`)}createTypification(e){return this.http.post(`${this.catalogUrl}`,e)}updateTypification(e,t){return this.http.put(`${this.catalogUrl}/${e}`,t)}deleteTypification(e){return this.http.delete(`${this.catalogUrl}/${e}`)}activateTypification(e){return this.http.put(`${this.catalogUrl}/${e}/activate`,{})}deactivateTypification(e){return this.http.put(`${this.catalogUrl}/${e}/deactivate`,{})}getTenantClassifications(e,t,i){let r=new P;return i&&(r=r.set("includeDisabled","true")),t?this.http.get(`${this.configUrl}/tenant/${e}/portfolio/${t}`,{params:r}):this.http.get(`${this.configUrl}/tenant/${e}`,{params:r})}getTenantClassificationsByType(e,t,i){let r=new P;return i&&(r=r.set("portfolioId",i.toString())),this.http.get(`${this.configUrl}/tenant/${e}/type/${t}`,{params:r})}getEffectiveTypifications(e,t,i){return this.http.get(`${this.configUrl}/effective/tenant/${e}/portfolio/${t}/subportfolio/${i}`)}updateTenantTypificationConfig(e,t){return this.http.put(`${this.configUrl}/${e}`,t)}enableClassification(e,t,i,r,p){let m=new P().set("userId",p?.toString()||"1");return r&&i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/subportfolio/${r}/typification/${t}/enable`,{},{params:m}):i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/typification/${t}/enable`,{},{params:m}):this.http.post(`${this.configUrl}/tenant/${e}/typification/${t}/enable`,{},{params:m})}disableClassification(e,t,i,r,p){let m=new P().set("userId",p?.toString()||"1");return r&&i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/subportfolio/${r}/typification/${t}/disable`,{},{params:m}):i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/typification/${t}/disable`,{},{params:m}):this.http.post(`${this.configUrl}/tenant/${e}/typification/${t}/disable`,{},{params:m})}getAllTenants(){return this.http.get(`${v.webServiceUrl}/v1/system-config/tenants`)}getPortfoliosByTenant(e){return this.http.get(`${v.webServiceUrl}/v1/system-config/tenants/${e}/portfolios`)}getSubPortfoliosByPortfolio(e){return this.http.get(`${this.configUrl}/portfolios/${e}/subportfolios`)}getAdditionalFields(e){return this.http.get(`${this.catalogUrl}/${e}/additional-fields`)}saveAdditionalFields(e,t){return this.http.put(`${this.catalogUrl}/${e}/additional-fields`,t)}getTypificationFieldsWithValues(e,t,i,r){let p=new P;return i&&(p=p.set("portfolioId",i.toString())),r&&(p=p.set("clientId",r.toString())),this.http.get(`${this.configUrl}/tenant/${e}/typifications/${t}/fields`,{params:p})}getDynamicTableColumns(e,t,i){let r=new P().set("tenantId",e.toString()).set("portfolioId",t.toString()).set("subPortfolioId",i.toString());return this.http.get(`${this.configUrl}/dynamic-table-columns`,{params:r})}generarOpcionesCampo(e,t,i,r){let p=new P().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",r.toString());return this.http.get(`${this.catalogUrl}/campo/${e}/opciones/generar`,{params:p})}inicializarOpcionesCampo(e,t,i,r){let p=new P().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",r.toString());return this.http.post(`${this.catalogUrl}/campo/${e}/opciones/inicializar`,{},{params:p})}getOpcionesCampo(e){return this.http.get(`${this.catalogUrl}/campo/${e}/opciones`)}getOpcionesHabilitadas(e){return this.http.get(`${this.catalogUrl}/campo/${e}/opciones/habilitadas`)}configurarOpciones(e){return this.http.put(`${this.catalogUrl}/campo/opciones/configurar`,e)}getOpcionesConValores(e,t,i,r,p){let m=new P().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",r.toString()).set("clientId",p.toString());return this.http.get(`${this.catalogUrl}/campo/${e}/opciones/valores`,{params:m})}createPaymentSchedule(e){return this.http.post(`${v.gatewayUrl}/v2/management-records/payment-schedule`,e)}getPaymentSchedulesByClient(e){return this.http.get(`${v.gatewayUrl}/v2/management-records/payment-schedule/client/${e}`)}getPaymentScheduleByGroup(e){return this.http.get(`${v.gatewayUrl}/v2/management-records/payment-schedule/group/${e}`)}updatePaymentStatus(e,t,i,r){let p=new P().set("estadoPago",t);return i!==void 0&&(p=p.set("montoPagadoReal",i.toString())),r&&(p=p.set("fechaPagoReal",r)),this.http.put(`${v.gatewayUrl}/v2/management-records/${e}/payment-status`,{},{params:p})}buildClassificationTree(e){let t=new Map,i=[];e.forEach(p=>{t.set(p.id,{typification:p,children:[],level:p.nivelJerarquia})}),e.forEach(p=>{let m=t.get(p.id),u=p.tipificacionPadre?.id;if(u){let y=t.get(u);y&&y.children.push(m)}else i.push(m)});let r=p=>{p.children.length>0&&(p.children.sort((m,u)=>{let y=m.typification.ordenVisualizacion||0,W=u.typification.ordenVisualizacion||0;return y-W}),p.children.forEach(m=>r(m)))};return i.forEach(p=>r(p)),i}};l.\u0275fac=function(t){return new(t||l)(Q(te))},l.\u0275prov=K({token:l,factory:l.\u0275fac,providedIn:"root"});let o=l;return o})();export{Gt as a,en as b,rn as c};
