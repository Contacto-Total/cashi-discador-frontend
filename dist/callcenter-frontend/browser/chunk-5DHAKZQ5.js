import{a as pt}from"./chunk-VANAMEII.js";import{a as F}from"./chunk-F4ESQKJH.js";import{a as ct}from"./chunk-ODDF3T3N.js";import{b as at}from"./chunk-JMTLUOEW.js";import"./chunk-DAJRNOBM.js";import"./chunk-SVPL2WML.js";import"./chunk-C4CJRQQ2.js";import{b as lt}from"./chunk-IKU2GB7L.js";import{b as st}from"./chunk-JV7LYIYN.js";import"./chunk-5E4NLGLG.js";import{e as Z}from"./chunk-IGD5VCKG.js";import{a as ee}from"./chunk-PUQ5RSXD.js";import{C as w}from"./chunk-JRQDYGIX.js";import"./chunk-3HY3XBSW.js";import{a as ot}from"./chunk-KNHDRGXI.js";import"./chunk-T2ZQ5EGI.js";import"./chunk-NTU7HPDP.js";import"./chunk-7GV7UZOL.js";import{Xb as Y,Yb as X}from"./chunk-BJ2AUU2F.js";import{a as it}from"./chunk-YQKVMPSG.js";import{Ac as Ze,Lb as C,Mb as g,Nb as S,Ob as k,Vb as L,Xb as M,Zb as b,ab as h,bc as We,ca as K,cc as Je,d as Pt,dc as Ke,dd as we,e as J,ed as et,f as Be,g as R,ga as He,gb as O,ha as $e,jc as Qe,jd as tt,lc as T,mc as D,md as q,na as _,nb as Q,nc as qe,oa as P,sb as N,td as nt,ud as rt,vb as E,vc as Ye,zc as Xe}from"./chunk-SN4XSKG7.js";var ze=Pt((Qt,Ue)=>{"use strict";var d={};d.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)};d.localCName=d.generateIdentifier();d.splitLines=function(e){return e.trim().split(`
`).map(n=>n.trim())};d.splitSections=function(e){return e.split(`
m=`).map((i,t)=>(t>0?"m="+i:i).trim()+`\r
`)};d.getDescription=function(e){let n=d.splitSections(e);return n&&n[0]};d.getMediaSections=function(e){let n=d.splitSections(e);return n.shift(),n};d.matchPrefix=function(e,n){return d.splitLines(e).filter(i=>i.indexOf(n)===0)};d.parseCandidate=function(e){let n;e.indexOf("a=candidate:")===0?n=e.substring(12).split(" "):n=e.substring(10).split(" ");let i={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let t=8;t<n.length;t+=2)switch(n[t]){case"raddr":i.relatedAddress=n[t+1];break;case"rport":i.relatedPort=parseInt(n[t+1],10);break;case"tcptype":i.tcpType=n[t+1];break;case"ufrag":i.ufrag=n[t+1],i.usernameFragment=n[t+1];break;default:i[n[t]]===void 0&&(i[n[t]]=n[t+1]);break}return i};d.writeCandidate=function(e){let n=[];n.push(e.foundation);let i=e.component;i==="rtp"?n.push(1):i==="rtcp"?n.push(2):n.push(i),n.push(e.protocol.toUpperCase()),n.push(e.priority),n.push(e.address||e.ip),n.push(e.port);let t=e.type;return n.push("typ"),n.push(t),t!=="host"&&e.relatedAddress&&e.relatedPort&&(n.push("raddr"),n.push(e.relatedAddress),n.push("rport"),n.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(n.push("ufrag"),n.push(e.usernameFragment||e.ufrag)),"candidate:"+n.join(" ")};d.parseIceOptions=function(e){return e.substring(14).split(" ")};d.parseRtpMap=function(e){let n=e.substring(9).split(" "),i={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),i.name=n[0],i.clockRate=parseInt(n[1],10),i.channels=n.length===3?parseInt(n[2],10):1,i.numChannels=i.channels,i};d.writeRtpMap=function(e){let n=e.payloadType;e.preferredPayloadType!==void 0&&(n=e.preferredPayloadType);let i=e.channels||e.numChannels||1;return"a=rtpmap:"+n+" "+e.name+"/"+e.clockRate+(i!==1?"/"+i:"")+`\r
`};d.parseExtmap=function(e){let n=e.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}};d.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+`\r
`};d.parseFmtp=function(e){let n={},i,t=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<t.length;r++)i=t[r].trim().split("="),n[i[0].trim()]=i[1];return n};d.writeFmtp=function(e){let n="",i=e.payloadType;if(e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let t=[];Object.keys(e.parameters).forEach(r=>{e.parameters[r]!==void 0?t.push(r+"="+e.parameters[r]):t.push(r)}),n+="a=fmtp:"+i+" "+t.join(";")+`\r
`}return n};d.parseRtcpFb=function(e){let n=e.substring(e.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}};d.writeRtcpFb=function(e){let n="",i=e.payloadType;return e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(t=>{n+="a=rtcp-fb:"+i+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+`\r
`}),n};d.parseSsrcMedia=function(e){let n=e.indexOf(" "),i={ssrc:parseInt(e.substring(7,n),10)},t=e.indexOf(":",n);return t>-1?(i.attribute=e.substring(n+1,t),i.value=e.substring(t+1)):i.attribute=e.substring(n+1),i};d.parseSsrcGroup=function(e){let n=e.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(i=>parseInt(i,10))}};d.getMid=function(e){let n=d.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)};d.parseFingerprint=function(e){let n=e.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}};d.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:d.matchPrefix(e+n,"a=fingerprint:").map(d.parseFingerprint)}};d.writeDtlsParameters=function(e,n){let i="a=setup:"+n+`\r
`;return e.fingerprints.forEach(t=>{i+="a=fingerprint:"+t.algorithm+" "+t.value+`\r
`}),i};d.parseCryptoLine=function(e){let n=e.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}};d.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?d.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`};d.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;let n=e.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}};d.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")};d.getCryptoParameters=function(e,n){return d.matchPrefix(e+n,"a=crypto:").map(d.parseCryptoLine)};d.getIceParameters=function(e,n){let i=d.matchPrefix(e+n,"a=ice-ufrag:")[0],t=d.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&t?{usernameFragment:i.substring(12),password:t.substring(10)}:null};d.writeIceParameters=function(e){let n="a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`;return e.iceLite&&(n+=`a=ice-lite\r
`),n};d.parseRtpParameters=function(e){let n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},t=d.splitLines(e)[0].split(" ");n.profile=t[2];for(let o=3;o<t.length;o++){let a=t[o],s=d.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){let l=d.parseRtpMap(s),c=d.matchPrefix(e,"a=fmtp:"+a+" ");switch(l.parameters=c.length?d.parseFmtp(c[0]):{},l.rtcpFeedback=d.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(d.parseRtcpFb),n.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(l.name.toUpperCase());break;default:break}}}d.matchPrefix(e,"a=extmap:").forEach(o=>{n.headerExtensions.push(d.parseExtmap(o))});let r=d.matchPrefix(e,"a=rtcp-fb:* ").map(d.parseRtcpFb);return n.codecs.forEach(o=>{r.forEach(a=>{o.rtcpFeedback.find(l=>l.type===a.type&&l.parameter===a.parameter)||o.rtcpFeedback.push(a)})}),n};d.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(r=>r.preferredPayloadType!==void 0?r.preferredPayloadType:r.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(r=>{i+=d.writeRtpMap(r),i+=d.writeFmtp(r),i+=d.writeRtcpFb(r)});let t=0;return n.codecs.forEach(r=>{r.maxptime>t&&(t=r.maxptime)}),t>0&&(i+="a=maxptime:"+t+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(r=>{i+=d.writeExtmap(r)}),i};d.parseRtpEncodingParameters=function(e){let n=[],i=d.parseRtpParameters(e),t=i.fecMechanisms.indexOf("RED")!==-1,r=i.fecMechanisms.indexOf("ULPFEC")!==-1,o=d.matchPrefix(e,"a=ssrc:").map(p=>d.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),a=o.length>0&&o[0].ssrc,s,l=d.matchPrefix(e,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(m=>parseInt(m,10)));l.length>0&&l[0].length>1&&l[0][0]===a&&(s=l[0][1]),i.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let u={ssrc:a,codecPayloadType:parseInt(p.parameters.apt,10)};a&&s&&(u.rtx={ssrc:s}),n.push(u),t&&(u=JSON.parse(JSON.stringify(u)),u.fec={ssrc:a,mechanism:r?"red+ulpfec":"red"},n.push(u))}}),n.length===0&&a&&n.push({ssrc:a});let c=d.matchPrefix(e,"b=");return c.length&&(c[0].indexOf("b=TIAS:")===0?c=parseInt(c[0].substring(7),10):c[0].indexOf("b=AS:")===0?c=parseInt(c[0].substring(5),10)*1e3*.95-2e3*8:c=void 0,n.forEach(p=>{p.maxBitrate=c})),n};d.parseRtcpParameters=function(e){let n={},i=d.matchPrefix(e,"a=ssrc:").map(o=>d.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);let t=d.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=t.length>0,n.compound=t.length===0;let r=d.matchPrefix(e,"a=rtcp-mux");return n.mux=r.length>0,n};d.writeRtcpParameters=function(e){let n="";return e.reducedSize&&(n+=`a=rtcp-rsize\r
`),e.mux&&(n+=`a=rtcp-mux\r
`),e.ssrc!==void 0&&e.cname&&(n+="a=ssrc:"+e.ssrc+" cname:"+e.cname+`\r
`),n};d.parseMsid=function(e){let n,i=d.matchPrefix(e,"a=msid:");if(i.length===1)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};let t=d.matchPrefix(e,"a=ssrc:").map(r=>d.parseSsrcMedia(r)).filter(r=>r.attribute==="msid");if(t.length>0)return n=t[0].value.split(" "),{stream:n[0],track:n[1]}};d.parseSctpDescription=function(e){let n=d.parseMLine(e),i=d.matchPrefix(e,"a=max-message-size:"),t;i.length>0&&(t=parseInt(i[0].substring(19),10)),isNaN(t)&&(t=65536);let r=d.matchPrefix(e,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substring(12),10),protocol:n.fmt,maxMessageSize:t};let o=d.matchPrefix(e,"a=sctpmap:");if(o.length>0){let a=o[0].substring(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}};d.writeSctpDescription=function(e,n){let i=[];return e.protocol!=="DTLS/SCTP"?i=["m="+e.kind+" 9 "+e.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:i=["m="+e.kind+" 9 "+e.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&i.push("a=max-message-size:"+n.maxMessageSize+`\r
`),i.join("")};d.generateSessionId=function(){return Math.random().toString().substr(2,22)};d.writeSessionBoilerplate=function(e,n,i){let t,r=n!==void 0?n:2;return e?t=e:t=d.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+t+" "+r+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`};d.getDirection=function(e,n){let i=d.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2);default:}return n?d.getDirection(n):"sendrecv"};d.getKind=function(e){return d.splitLines(e)[0].split(" ")[0].substring(2)};d.isRejected=function(e){return e.split(" ",2)[1]==="0"};d.parseMLine=function(e){let i=d.splitLines(e)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}};d.parseOLine=function(e){let i=d.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}};d.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;let n=d.splitLines(e);for(let i=0;i<n.length;i++)if(n[i].length<2||n[i].charAt(1)!=="=")return!1;return!0};typeof Ue=="object"&&(Ue.exports=d)});var ut=!0,mt=!0;function j(e,n,i){let t=e.match(n);return t&&t.length>=i&&parseFloat(t[i],10)}function I(e,n,i){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.addEventListener;t.addEventListener=function(a,s){if(a!==n)return r.apply(this,arguments);let l=c=>{let p=i(c);p&&(s.handleEvent?s.handleEvent(p):s(p))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(s,l),r.apply(this,[a,l])};let o=t.removeEventListener;t.removeEventListener=function(a,s){if(a!==n||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);if(!this._eventMap[n].has(s))return o.apply(this,arguments);let l=this._eventMap[n].get(s);return this._eventMap[n].delete(s),this._eventMap[n].size===0&&delete this._eventMap[n],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,l])},Object.defineProperty(t,"on"+n,{get(){return this["_on"+n]},set(a){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),a&&this.addEventListener(n,this["_on"+n]=a)},enumerable:!0,configurable:!0})}function ft(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(ut=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ht(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(mt=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function te(){if(typeof window=="object"){if(ut)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function G(e,n){mt&&console.warn(e+" is deprecated, please use "+n+" instead.")}function gt(e){let n={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return n.browser="Not a browser.",n;let{navigator:i}=e;if(i.userAgentData&&i.userAgentData.brands){let t=i.userAgentData.brands.find(r=>r.brand==="Chromium");if(t)return{browser:"chrome",version:parseInt(t.version,10)}}if(i.mozGetUserMedia)n.browser="firefox",n.version=parseInt(j(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)n.browser="chrome",n.version=parseInt(j(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(e.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))n.browser="safari",n.version=parseInt(j(i.userAgent,/AppleWebKit\/(\d+)\./,1)),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,n._safariVersion=j(i.userAgent,/Version\/(\d+(\.?\d+))/,1);else return n.browser="Not a supported browser.",n;return n}function dt(e){return Object.prototype.toString.call(e)==="[object Object]"}function me(e){return dt(e)?Object.keys(e).reduce(function(n,i){let t=dt(e[i]),r=t?me(e[i]):e[i],o=t&&!Object.keys(r).length;return r===void 0||o?n:Object.assign(n,{[i]:r})},{}):e}function ue(e,n,i){!n||i.has(n.id)||(i.set(n.id,n),Object.keys(n).forEach(t=>{t.endsWith("Id")?ue(e,e.get(n[t]),i):t.endsWith("Ids")&&n[t].forEach(r=>{ue(e,e.get(r),i)})}))}function fe(e,n,i){let t=i?"outbound-rtp":"inbound-rtp",r=new Map;if(n===null)return r;let o=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===n.id&&o.push(a)}),o.forEach(a=>{e.forEach(s=>{s.type===t&&s.trackId===a.id&&ue(e,s,r)})}),r}var ie={};J(ie,{fixNegotiationNeeded:()=>xe,shimAddTrackRemoveTrack:()=>ye,shimAddTrackRemoveTrackWithNative:()=>St,shimGetSendersWithDtmf:()=>Ce,shimGetUserMedia:()=>ne,shimMediaStream:()=>he,shimOnTrack:()=>ge,shimPeerConnection:()=>re,shimSenderReceiverGetStats:()=>Se});var Ct=te;function ne(e,n){let i=e&&e.navigator;if(!i.mediaDevices)return;let t=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;let l={};return Object.keys(s).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;let p=typeof s[c]=="object"?s[c]:{ideal:s[c]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);let u=function(m,y){return m?m+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(p.ideal!==void 0){l.optional=l.optional||[];let m={};typeof p.ideal=="number"?(m[u("min",c)]=p.ideal,l.optional.push(m),m={},m[u("max",c)]=p.ideal,l.optional.push(m)):(m[u("",c)]=p.ideal,l.optional.push(m))}p.exact!==void 0&&typeof p.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[u("",c)]=p.exact):["min","max"].forEach(m=>{p[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[u(m,c)]=p[m])})}),s.advanced&&(l.optional=(l.optional||[]).concat(s.advanced)),l},r=function(s,l){if(n.version>=61)return l(s);if(s=JSON.parse(JSON.stringify(s)),s&&typeof s.audio=="object"){let c=function(p,u,m){u in p&&!(m in p)&&(p[m]=p[u],delete p[u])};s=JSON.parse(JSON.stringify(s)),c(s.audio,"autoGainControl","googAutoGainControl"),c(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=t(s.audio)}if(s&&typeof s.video=="object"){let c=s.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});let p=n.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete s.video.facingMode;let u;if(c.exact==="environment"||c.ideal==="environment"?u=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(u=["front"]),u)return i.mediaDevices.enumerateDevices().then(m=>{m=m.filter(x=>x.kind==="videoinput");let y=m.find(x=>u.some(v=>x.label.toLowerCase().includes(v)));return!y&&m.length&&u.includes("back")&&(y=m[m.length-1]),y&&(s.video.deviceId=c.exact?{exact:y.deviceId}:{ideal:y.deviceId}),s.video=t(s.video),Ct("chrome: "+JSON.stringify(s)),l(s)})}s.video=t(s.video)}return Ct("chrome: "+JSON.stringify(s)),l(s)},o=function(s){return n.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(s,l,c){r(s,p=>{i.webkitGetUserMedia(p,l,u=>{c&&c(o(u))})})};if(i.getUserMedia=a.bind(i),i.mediaDevices.getUserMedia){let s=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(l){return r(l,c=>s(c).then(p=>{if(c.audio&&!p.getAudioTracks().length||c.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(o(p))))}}}function he(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function ge(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",r=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(s=>s.track&&s.track.id===r.track.id):o={track:r.track};let a=new Event("track");a.track=r.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[t.stream],this.dispatchEvent(a)}),t.stream.getTracks().forEach(r=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(s=>s.track&&s.track.id===r.id):o={track:r};let a=new Event("track");a.track=r,a.receiver=o,a.transceiver={receiver:o},a.streams=[t.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else I(e,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function Ce(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let n=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,l){let c=r.apply(this,arguments);return c||(c=n(this,s),this._senders.push(c)),c};let o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){o.apply(this,arguments);let l=this._senders.indexOf(s);l!==-1&&this._senders.splice(l,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(n(this,a))})};let t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(a=>{let s=this._senders.find(l=>l.track===a);s&&this._senders.splice(this._senders.indexOf(s),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let n=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let t=n.apply(this,[]);return t.forEach(r=>r._pc=this),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Se(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){let o=i.apply(this,[]);return o.forEach(a=>a._pc=this),o});let t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){let o=t.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){let o=this;return this._pc.getStats().then(a=>fe(a,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=i.apply(this,[]);return r.forEach(o=>o._pc=this),r}),I(e,"track",t=>(t.receiver._pc=t.srcElement,t)),e.RTCRtpReceiver.prototype.getStats=function(){let r=this;return this._pc.getStats().then(o=>fe(o,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;let n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let t=arguments[0],r,o,a;return this.getSenders().forEach(s=>{s.track===t&&(r?a=!0:r=s)}),this.getReceivers().forEach(s=>(s.track===t&&(o?a=!0:o=s),s.track===t)),a||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function St(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,s){if(!s)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let l=n.apply(this,arguments);return this._shimmedLocalStreams[s.id]?this._shimmedLocalStreams[s.id].indexOf(l)===-1&&this._shimmedLocalStreams[s.id].push(l):this._shimmedLocalStreams[s.id]=[s,l],l};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(u=>u.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});let s=this.getSenders();i.apply(this,arguments);let l=this.getSenders().filter(c=>s.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};let t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],t.apply(this,arguments)};let r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(s=>{let l=this._shimmedLocalStreams[s].indexOf(a);l!==-1&&this._shimmedLocalStreams[s].splice(l,1),this._shimmedLocalStreams[s].length===1&&delete this._shimmedLocalStreams[s]}),r.apply(this,arguments)}}function ye(e,n){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return St(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let p=i.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(u=>this._reverseStreams[u.id])};let t=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(u=>{if(this.getSenders().find(y=>y.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){let u=new e.MediaStream(p.getTracks());this._streams[p.id]=u,this._reverseStreams[u.id]=p,p=u}t.apply(this,[p])};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},e.RTCPeerConnection.prototype.addTrack=function(p,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(v=>v===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let x=this._streams[u.id];if(x)x.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let v=new e.MediaStream([p]);this._streams[u.id]=v,this._reverseStreams[v.id]=u,this.addStream(v)}return this.getSenders().find(v=>v.track===p)};function o(c,p){let u=p.sdp;return Object.keys(c._reverseStreams||[]).forEach(m=>{let y=c._reverseStreams[m],x=c._streams[y.id];u=u.replace(new RegExp(x.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:u})}function a(c,p){let u=p.sdp;return Object.keys(c._reverseStreams||[]).forEach(m=>{let y=c._reverseStreams[m],x=c._streams[y.id];u=u.replace(new RegExp(y.id,"g"),x.id)}),new RTCSessionDescription({type:p.type,sdp:u})}["createOffer","createAnswer"].forEach(function(c){let p=e.RTCPeerConnection.prototype[c],u={[c](){let m=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[x=>{let v=o(this,x);m[0].apply(null,[v])},x=>{m[1]&&m[1].apply(null,x)},arguments[2]]):p.apply(this,arguments).then(x=>o(this,x))}};e.RTCPeerConnection.prototype[c]=u[c]});let s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?s.apply(this,arguments):(arguments[0]=a(this,arguments[0]),s.apply(this,arguments))};let l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let c=l.get.apply(this);return c.type===""?c:o(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let m;Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(v=>p.track===v)&&(m=this._streams[y])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function re(e,n){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let t=e.RTCPeerConnection.prototype[i],r={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=r[i]})}function xe(e,n){I(e,"negotiationneeded",i=>{let t=i.target;if(!((n.version<72||t.getConfiguration&&t.getConfiguration().sdpSemantics==="plan-b")&&t.signalingState!=="stable"))return i})}var ae={};J(ae,{shimAddTransceiver:()=>ke,shimCreateAnswer:()=>Me,shimCreateOffer:()=>Ee,shimGetDisplayMedia:()=>yt,shimGetParameters:()=>Re,shimGetUserMedia:()=>oe,shimOnTrack:()=>be,shimPeerConnection:()=>se,shimRTCDataChannel:()=>Pe,shimReceiverGetStats:()=>Te,shimRemoveStream:()=>_e,shimSenderGetStats:()=>ve});function oe(e,n){let i=e&&e.navigator,t=e&&e.MediaStreamTrack;if(i.getUserMedia=function(r,o,a){G("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(r).then(o,a)},!(n.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let r=function(a,s,l){s in a&&!(l in a)&&(a[l]=a[s],delete a[s])},o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},t&&t.prototype.getSettings){let a=t.prototype.getSettings;t.prototype.getSettings=function(){let s=a.apply(this,arguments);return r(s,"mozAutoGainControl","autoGainControl"),r(s,"mozNoiseSuppression","noiseSuppression"),s}}if(t&&t.prototype.applyConstraints){let a=t.prototype.applyConstraints;t.prototype.applyConstraints=function(s){return this.kind==="audio"&&typeof s=="object"&&(s=JSON.parse(JSON.stringify(s)),r(s,"autoGainControl","mozAutoGainControl"),r(s,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[s])}}}}function yt(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(t){if(!(t&&t.video)){let r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return t.video===!0?t.video={mediaSource:n}:t.video.mediaSource=n,e.navigator.mediaDevices.getUserMedia(t)})}function be(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function se(e,n){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let o=e.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=a[r]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[o,a,s]=arguments;return t.apply(this,[o||null]).then(l=>{if(n.version<53&&!a)try{l.forEach(c=>{c.type=i[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((p,u)=>{l.set(u,Object.assign({},p,{type:i[p.type]||p.type}))})}return l}).then(a,s)}}function ve(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){let r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Te(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){let t=n.apply(this,[]);return t.forEach(r=>r._pc=this),t}),I(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function _e(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(i){G("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&i.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Pe(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ke(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let n=e.RTCPeerConnection.prototype.addTransceiver;n&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;t===void 0&&(t=[]),t=[...t];let r=t.length>0;r&&t.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let o=n.apply(this,arguments);if(r){let{sender:a}=o,s=a.getParameters();(!("encodings"in s)||s.encodings.length===1&&Object.keys(s.encodings[0]).length===0)&&(s.encodings=t,a.sendEncodings=t,this.setParametersPromises.push(a.setParameters(s).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function Re(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;let n=e.RTCRtpSender.prototype.getParameters;n&&(e.RTCRtpSender.prototype.getParameters=function(){let t=n.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function Ee(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function Me(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var ce={};J(ce,{shimAudioContext:()=>Ge,shimCallbacksAPI:()=>De,shimConstraints:()=>xt,shimCreateOfferLegacy:()=>je,shimGetUserMedia:()=>Ne,shimLocalStreamsAPI:()=>Ie,shimRTCIceServerUrls:()=>Le,shimRemoteStreamsAPI:()=>Oe,shimTrackEventTransceiver:()=>Ae});function Ie(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(r=>n.call(this,r,t)),t.getVideoTracks().forEach(r=>n.call(this,r,t))},e.RTCPeerConnection.prototype.addTrack=function(t,...r){return r&&r.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),n.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(i);if(t===-1)return;this._localStreams.splice(t,1);let r=i.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function Oe(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=t=>{t.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);let o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(o)>=0)return;t._remoteStreams.push(o);let a=new Event("addstream");a.stream=o,t.dispatchEvent(a)})}),n.apply(t,arguments)}}}function De(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let n=e.RTCPeerConnection.prototype,i=n.createOffer,t=n.createAnswer,r=n.setLocalDescription,o=n.setRemoteDescription,a=n.addIceCandidate;n.createOffer=function(c,p){let u=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[u]);return p?(m.then(c,p),Promise.resolve()):m},n.createAnswer=function(c,p){let u=arguments.length>=2?arguments[2]:arguments[0],m=t.apply(this,[u]);return p?(m.then(c,p),Promise.resolve()):m};let s=function(l,c,p){let u=r.apply(this,[l]);return p?(u.then(c,p),Promise.resolve()):u};n.setLocalDescription=s,s=function(l,c,p){let u=o.apply(this,[l]);return p?(u.then(c,p),Promise.resolve()):u},n.setRemoteDescription=s,s=function(l,c,p){let u=a.apply(this,[l]);return p?(u.then(c,p),Promise.resolve()):u},n.addIceCandidate=s}function Ne(e){let n=e&&e.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){let i=n.mediaDevices,t=i.getUserMedia.bind(i);n.mediaDevices.getUserMedia=r=>t(xt(r))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=(function(t,r,o){n.mediaDevices.getUserMedia(t).then(r,o)}).bind(n))}function xt(e){return e&&e.video!==void 0?Object.assign({},e,{video:me(e.video)}):e}function Le(e){if(!e.RTCPeerConnection)return;let n=e.RTCPeerConnection;e.RTCPeerConnection=function(t,r){if(t&&t.iceServers){let o=[];for(let a=0;a<t.iceServers.length;a++){let s=t.iceServers[a];s.urls===void 0&&s.url?(G("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,o.push(s)):o.push(t.iceServers[a])}t.iceServers=o}return new n(t,r)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return n.generateCertificate}})}function Ae(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function je(e){let n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(t){if(t){typeof t.offerToReceiveAudio<"u"&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);let r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");t.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):t.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof t.offerToReceiveVideo<"u"&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);let o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");t.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):t.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function Ge(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Fe={};J(Fe,{removeExtmapAllowMixed:()=>de,shimAddIceCandidateNullOrEmpty:()=>$,shimConnectionState:()=>le,shimMaxMessageSize:()=>B,shimParameterlessSetLocalDescription:()=>W,shimRTCIceCandidate:()=>V,shimRTCIceCandidateRelayProtocol:()=>pe,shimSendThrowTypeError:()=>H});var U=Be(ze());function V(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let n=e.RTCIceCandidate;e.RTCIceCandidate=function(t){if(typeof t=="object"&&t.candidate&&t.candidate.indexOf("a=")===0&&(t=JSON.parse(JSON.stringify(t)),t.candidate=t.candidate.substring(2)),t.candidate&&t.candidate.length){let r=new n(t),o=U.default.parseCandidate(t.candidate);for(let a in o)a in r||Object.defineProperty(r,a,{value:o[a]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new n(t)},e.RTCIceCandidate.prototype=n.prototype,I(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function pe(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||I(e,"icecandidate",n=>{if(n.candidate){let i=U.default.parseCandidate(n.candidate.candidate);i.type==="relay"&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return n})}function B(e,n){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});let i=function(s){if(!s||!s.sdp)return!1;let l=U.default.splitSections(s.sdp);return l.shift(),l.some(c=>{let p=U.default.parseMLine(c);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},t=function(s){let l=s.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;let c=parseInt(l[1],10);return c!==c?-1:c},r=function(s){let l=65536;return n.browser==="firefox"&&(n.version<57?s===-1?l=16384:l=2147483637:n.version<60?l=n.version===57?65535:65536:l=2147483637),l},o=function(s,l){let c=65536;n.browser==="firefox"&&n.version===57&&(c=65535);let p=U.default.matchPrefix(s.sdp,"a=max-message-size:");return p.length>0?c=parseInt(p[0].substring(19),10):n.browser==="firefox"&&l!==-1&&(c=2147483637),c},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&n.version>=76){let{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){let l=t(arguments[0]),c=r(l),p=o(arguments[0],l),u;c===0&&p===0?u=Number.POSITIVE_INFINITY:c===0||p===0?u=Math.max(c,p):u=Math.min(c,p);let m={};Object.defineProperty(m,"maxMessageSize",{get(){return u}}),this._sctp=m}return a.apply(this,arguments)}}function H(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function n(t,r){let o=t.send;t.send=function(){let s=arguments[0],l=s.length||s.size||s.byteLength;if(t.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(t,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let r=i.apply(this,arguments);return n(r,this),r},I(e,"datachannel",t=>(n(t.channel,t.target),t))}function le(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{let t=n[i];n[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{let o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;let a=new Event("connectionstatechange",r);o.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})}function de(e,n){if(!e.RTCPeerConnection||n.browser==="chrome"&&n.version>=71||n.browser==="safari"&&n._safariVersion>=13.1)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let o=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return i.apply(this,arguments)}}function $(e,n){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let i=e.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(n.browser==="chrome"&&n.version<78||n.browser==="firefox"&&n.version<68||n.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function W(e,n){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let i=e.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return i.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?i.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>i.apply(this,[a]))})}var kt=Be(ze());function bt({window:e}={},n={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let i=te,t=gt(e),r={browserDetails:t,commonShim:Fe,extractVersion:j,disableLog:ft,disableWarnings:ht,sdp:kt};switch(t.browser){case"chrome":if(!ie||!re||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),r;if(t.version===null)return i("Chrome shim can not determine version, not shimming."),r;i("adapter.js shimming chrome."),r.browserShim=ie,$(e,t),W(e,t),ne(e,t),he(e,t),re(e,t),ge(e,t),ye(e,t),Ce(e,t),Se(e,t),xe(e,t),V(e,t),pe(e,t),le(e,t),B(e,t),H(e,t),de(e,t);break;case"firefox":if(!ae||!se||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),r;i("adapter.js shimming firefox."),r.browserShim=ae,$(e,t),W(e,t),oe(e,t),se(e,t),be(e,t),_e(e,t),ve(e,t),Te(e,t),Pe(e,t),ke(e,t),Re(e,t),Ee(e,t),Me(e,t),V(e,t),le(e,t),B(e,t),H(e,t);break;case"safari":if(!ce||!n.shimSafari)return i("Safari shim is not included in this adapter release."),r;i("adapter.js shimming safari."),r.browserShim=ce,$(e,t),W(e,t),Le(e,t),je(e,t),De(e,t),Ie(e,t),Oe(e,t),Ae(e,t),Ne(e,t),Ge(e,t),V(e,t),pe(e,t),B(e,t),H(e,t),de(e,t);break;default:i("Unsupported browser!");break}return r}var Xt=bt({window:typeof window>"u"?void 0:window});var f=(function(e){return e.IDLE="IDLE",e.CONNECTING="CONNECTING",e.RINGING="RINGING",e.ACTIVE="ACTIVE",e.HELD="HELD",e.ENDED="ENDED",e})(f||{}),vt=(()=>{let n=class n{constructor(){this.websocketService=$e(ee),this.peerConnection=null,this.localStream=null,this.remoteStream=null,this.currentCallState=f.IDLE,this.isMuted=!1,this.pendingOffer=null,this.remoteUserId=null,this.targetPhoneNumber=null,this.onRemoteStream=new E,this.onCallStatus=new E,this.onError=new E,this.iceServers={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"},{urls:"turn:a.relay.metered.ca:80",username:"e46b526d9452c5e61c66ce86",credential:"BGkz0EQbfYvXvZGu"},{urls:"turn:a.relay.metered.ca:443",username:"e46b526d9452c5e61c66ce86",credential:"BGkz0EQbfYvXvZGu"},{urls:"turn:a.relay.metered.ca:443?transport=tcp",username:"e46b526d9452c5e61c66ce86",credential:"BGkz0EQbfYvXvZGu"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}}initialize(){return R(this,null,function*(){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("WebRTC is not supported in this browser or context. Try using HTTPS or a modern browser.");this.localStream=yield navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1}),console.log("Microphone access granted")}catch(t){console.error("Error accessing microphone:",t);let r=t.message||"Could not access microphone. Please grant permission.";throw this.onError.emit(r),t}})}makeCall(t){return R(this,null,function*(){this.localStream||(yield this.initialize()),this.targetPhoneNumber=t,this.currentCallState=f.CONNECTING,this.onCallStatus.emit(this.currentCallState);try{this.peerConnection=new RTCPeerConnection(this.iceServers),console.log("Adding local tracks to peer connection"),this.localStream?.getTracks().forEach(o=>{console.log("Adding track:",o.kind,"enabled:",o.enabled),this.peerConnection?.addTrack(o,this.localStream)}),this.peerConnection.ontrack=o=>{console.log("Received remote track:",o.track.kind),console.log("Track enabled:",o.track.enabled),console.log("Track readyState:",o.track.readyState),o.streams&&o.streams[0]?(this.remoteStream=o.streams[0],console.log("Remote stream tracks:",this.remoteStream.getTracks().map(a=>a.kind)),this.onRemoteStream.emit(this.remoteStream)):console.warn("No streams in track event")},this.peerConnection.onicecandidate=o=>{o.candidate?(console.log("\u{1F9CA} ICE Candidate:",{type:o.candidate.type,protocol:o.candidate.protocol,address:o.candidate.address,port:o.candidate.port,relatedAddress:o.candidate.relatedAddress}),this.sendSignalingMessage({type:"ice-candidate",candidate:o.candidate,to:t})):console.log("\u2705 All ICE candidates have been sent")},this.peerConnection.oniceconnectionstatechange=()=>{console.log("\u{1F50C} ICE connection state:",this.peerConnection?.iceConnectionState),this.peerConnection?.iceConnectionState==="failed"&&(console.error("\u274C ICE connection failed - restarting ICE"),this.peerConnection?.restartIce()),this.peerConnection?.iceConnectionState==="connected"&&console.log("\u2705 ICE connected successfully!")},this.peerConnection.onicegatheringstatechange=()=>{console.log("ICE gathering state:",this.peerConnection?.iceGatheringState)},this.peerConnection.onconnectionstatechange=()=>{switch(console.log("Connection state:",this.peerConnection?.connectionState),this.peerConnection?.connectionState){case"connected":this.currentCallState=f.ACTIVE,this.onCallStatus.emit(this.currentCallState);break;case"disconnected":case"failed":case"closed":this.currentCallState=f.ENDED,this.onCallStatus.emit(this.currentCallState);break}};let r=yield this.peerConnection.createOffer();yield this.peerConnection.setLocalDescription(r),this.sendSignalingMessage({type:"offer",sdp:r,to:t}),this.currentCallState=f.RINGING,this.onCallStatus.emit(this.currentCallState)}catch(r){throw console.error("Error making call:",r),this.onError.emit("Failed to establish call"),this.hangupCall(),r}})}sendSignalingMessage(t){console.log("Sending signaling message:",t.type,"to:",t.to),this.websocketService.send("/app/webrtc.signal",t)}handleIncomingOffer(t){console.log("Storing incoming offer from:",t.from),this.pendingOffer=t,this.remoteUserId=t.fromUsername||t.from,console.log("Set remoteUserId to:",this.remoteUserId),this.currentCallState=f.RINGING,this.onCallStatus.emit(this.currentCallState)}answerCall(){return R(this,null,function*(){if(!this.pendingOffer){console.error("No pending offer to answer");return}this.localStream||(yield this.initialize()),console.log("Answering call..."),this.currentCallState=f.CONNECTING,this.onCallStatus.emit(this.currentCallState);try{this.peerConnection=new RTCPeerConnection(this.iceServers),console.log("Adding local tracks to peer connection"),this.localStream?.getTracks().forEach(r=>{console.log("Adding track:",r.kind,"enabled:",r.enabled),this.peerConnection?.addTrack(r,this.localStream)}),this.peerConnection.ontrack=r=>{console.log("Received remote track:",r.track.kind),console.log("Track enabled:",r.track.enabled),console.log("Track readyState:",r.track.readyState),r.streams&&r.streams[0]?(this.remoteStream=r.streams[0],console.log("Remote stream tracks:",this.remoteStream.getTracks().map(o=>o.kind)),this.onRemoteStream.emit(this.remoteStream)):console.warn("No streams in track event")},this.peerConnection.onicecandidate=r=>{r.candidate?(console.log("Sending ICE candidate:",r.candidate.type),this.sendSignalingMessage({type:"ice-candidate",candidate:r.candidate,to:this.remoteUserId})):console.log("All ICE candidates have been sent")},this.peerConnection.oniceconnectionstatechange=()=>{console.log("\u{1F50C} ICE connection state:",this.peerConnection?.iceConnectionState),this.peerConnection?.iceConnectionState==="failed"&&(console.error("\u274C ICE connection failed - restarting ICE"),this.peerConnection?.restartIce()),this.peerConnection?.iceConnectionState==="connected"&&console.log("\u2705 ICE connected successfully!")},this.peerConnection.onicegatheringstatechange=()=>{console.log("ICE gathering state:",this.peerConnection?.iceGatheringState)},this.peerConnection.onconnectionstatechange=()=>{switch(console.log("Connection state:",this.peerConnection?.connectionState),this.peerConnection?.connectionState){case"connected":this.currentCallState=f.ACTIVE,this.onCallStatus.emit(this.currentCallState);break;case"disconnected":case"failed":case"closed":this.currentCallState=f.ENDED,this.onCallStatus.emit(this.currentCallState);break}},yield this.peerConnection.setRemoteDescription(new RTCSessionDescription(this.pendingOffer.sdp));let t=yield this.peerConnection.createAnswer();yield this.peerConnection.setLocalDescription(t),this.sendSignalingMessage({type:"answer",sdp:t,to:this.remoteUserId}),this.pendingOffer=null,this.currentCallState=f.ACTIVE,this.onCallStatus.emit(this.currentCallState)}catch(t){throw console.error("Error answering call:",t),this.onError.emit("Failed to answer call"),this.hangupCall(),t}})}handleAnswer(t){return R(this,null,function*(){console.log("Received answer"),this.peerConnection&&t.sdp&&(yield this.peerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)),this.currentCallState=f.ACTIVE,this.onCallStatus.emit(this.currentCallState))})}handleIceCandidate(t){return R(this,null,function*(){if(console.log("Received ICE candidate"),this.peerConnection&&t.candidate)try{yield this.peerConnection.addIceCandidate(new RTCIceCandidate(t.candidate))}catch(r){console.error("Error adding ICE candidate:",r)}})}hangupCall(){console.log("Hanging up call"),this.remoteUserId?this.sendSignalingMessage({type:"hangup",to:this.remoteUserId}):this.targetPhoneNumber&&this.sendSignalingMessage({type:"hangup",to:this.targetPhoneNumber}),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.remoteStream&&(this.remoteStream.getTracks().forEach(t=>t.stop()),this.remoteStream=null),this.currentCallState=f.ENDED,this.onCallStatus.emit(this.currentCallState),this.remoteUserId=null,this.targetPhoneNumber=null,this.pendingOffer=null,setTimeout(()=>{this.currentCallState=f.IDLE,this.onCallStatus.emit(this.currentCallState)},1e3)}muteAudio(){this.localStream&&(this.localStream.getAudioTracks().forEach(t=>{t.enabled=!1}),this.isMuted=!0)}unmuteAudio(){this.localStream&&(this.localStream.getAudioTracks().forEach(t=>{t.enabled=!0}),this.isMuted=!1)}toggleMute(){return this.isMuted?this.unmuteAudio():this.muteAudio(),this.isMuted}isMicMuted(){return this.isMuted}getCallState(){return this.currentCallState}cleanup(){this.hangupCall(),this.localStream&&(this.localStream.getTracks().forEach(t=>t.stop()),this.localStream=null)}};n.\u0275fac=function(r){return new(r||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var z=(function(e){return e.CALL_INITIATED="CALL_INITIATED",e.CALL_RINGING="CALL_RINGING",e.CALL_ANSWERED="CALL_ANSWERED",e.CALL_CONNECTED="CALL_CONNECTED",e.CALL_ENDED="CALL_ENDED",e.NEW_CONTACT_ASSIGNED="NEW_CONTACT_ASSIGNED",e})(z||{});var It=()=>["1","2","3","4","5","6","7","8","9","*","0","#"];function Ot(e,n){if(e&1&&(g(0,"div",14)(1,"span",15),T(2),S(),g(3,"span",16),T(4,"|"),S()()),e&2){let i=b();h(2),D(i.dialedNumber)}}function Dt(e,n){e&1&&(g(0,"div",17),T(1," Marque un n\xFAmero "),S())}function Nt(e,n){if(e&1&&(g(0,"div",18)(1,"div",19),T(2),S()()),e&2){let i=b();h(2),D(i.phoneNumber)}}function Lt(e,n){if(e&1&&(g(0,"div",20),T(1),S()),e&2){let i=b();h(),qe(" ",i.formatDuration(i.duration)," ")}}function At(e,n){if(e&1){let i=L();g(0,"button",27),M("click",function(){_(i);let r=b(2);return P(r.onHangup())}),k(1,"lucide-angular",28),S()}if(e&2){let i=b(2);C("disabled",!i.canHangup),h(),C("size",16)}}function jt(e,n){if(e&1){let i=L();g(0,"div",21),N(1,At,2,2,"button",22),g(2,"button",23),M("click",function(){_(i);let r=b();return P(r.onMute())}),k(3,"lucide-angular",24),S(),g(4,"button",25),M("click",function(){_(i);let r=b();return P(r.onHold())}),k(5,"lucide-angular",26),S()()}if(e&2){let i=b();h(),C("ngIf",i.canHangup),h(),Qe("retro-btn-yellow",i.isMuted)("retro-btn-blue",!i.isMuted),C("disabled",!i.isActive()),h(),C("name",i.isMuted?"mic-off":"mic")("size",16),h(),C("disabled",!i.isActive()),h(),C("size",16)}}function Gt(e,n){if(e&1&&(g(0,"span",32),T(1),S()),e&2){let i=b().$implicit,t=b();h(),D(t.getLetters(i))}}function Ut(e,n){if(e&1){let i=L();g(0,"button",29),M("click",function(){let r=_(i).$implicit,o=b();return P(o.onDTMF(r))}),g(1,"span",30),T(2),S(),N(3,Gt,2,1,"span",31),S()}if(e&2){let i=n.$implicit,t=b();h(2),D(i),h(),C("ngIf",t.getLetters(i))}}function zt(e,n){if(e&1){let i=L();g(0,"div",33)(1,"button",34),M("click",function(){_(i);let r=b();return P(r.onBackspace())}),k(2,"lucide-angular",35),g(3,"span",36),T(4,"Borrar"),S()(),g(5,"button",37),M("click",function(){_(i);let r=b();return P(r.onCall())}),k(6,"lucide-angular",38),g(7,"span",39),T(8,"Llamar"),S()(),g(9,"button",34),M("click",function(){_(i);let r=b();return P(r.onClear())}),k(10,"lucide-angular",40),g(11,"span",36),T(12,"Limpiar"),S()()()}if(e&2){let i=b();h(),C("disabled",!i.dialedNumber),h(),C("size",18),h(3),C("disabled",!i.dialedNumber),h(),C("size",20),h(3),C("disabled",!i.dialedNumber),h(),C("size",18)}}var Tt=(()=>{let n=class n{constructor(){this.callState=f.IDLE,this.duration=0,this.isMuted=!1,this.phoneNumber="",this.canHangup=!1,this.hangupClicked=new E,this.muteClicked=new E,this.holdClicked=new E,this.dtmfClicked=new E,this.callClicked=new E,this.CallState=f,this.dialedNumber=""}getStatusText(){switch(this.callState){case f.IDLE:return"Ready to call";case f.CONNECTING:return"Connecting...";case f.RINGING:return"Ringing...";case f.ACTIVE:return"In call";case f.HELD:return"On hold";case f.ENDED:return"Call ended";default:return"Unknown"}}getStatusColor(){switch(this.callState){case f.IDLE:return"#999";case f.CONNECTING:return"#ff9800";case f.RINGING:return"#2196f3";case f.ACTIVE:return"#4caf50";case f.HELD:return"#ff9800";case f.ENDED:return"#f44336";default:return"#999"}}formatDuration(t){let r=Math.floor(t/60),o=t%60;return`${r.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}onHangup(){this.hangupClicked.emit()}onMute(){this.muteClicked.emit()}onHold(){this.holdClicked.emit()}onDTMF(t){this.callState===f.IDLE?this.dialedNumber+=t:this.dtmfClicked.emit(t)}onCall(){this.dialedNumber.trim()&&this.callClicked.emit(this.dialedNumber)}onBackspace(){this.dialedNumber.length>0&&(this.dialedNumber=this.dialedNumber.slice(0,-1))}onClear(){this.dialedNumber=""}isActive(){return this.callState===f.ACTIVE||this.callState===f.HELD}getLetters(t){return{2:"ABC",3:"DEF",4:"GHI",5:"JKL",6:"MNO",7:"PQRS",8:"TUV",9:"WXYZ"}[t]||""}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=Q({type:n,selectors:[["app-softphone"]],inputs:{callState:"callState",duration:"duration",isMuted:"isMuted",phoneNumber:"phoneNumber",canHangup:"canHangup"},outputs:{hangupClicked:"hangupClicked",muteClicked:"muteClicked",holdClicked:"holdClicked",dtmfClicked:"dtmfClicked",callClicked:"callClicked"},decls:15,vars:11,consts:[[1,"phone-body"],[1,"phone-screen"],[1,"screen-content"],[1,"flex","items-center","justify-center","gap-1","mb-2"],[1,"text-green-600","animate-pulse",3,"name","size"],[1,"screen-status"],["class","screen-number",4,"ngIf"],["class","screen-placeholder",4,"ngIf"],["class","screen-call-info",4,"ngIf"],["class","screen-duration",4,"ngIf"],["class","control-row",4,"ngIf"],[1,"keypad-container"],["class","retro-key",3,"click",4,"ngFor","ngForOf"],["class","action-buttons",4,"ngIf"],[1,"screen-number"],[1,"number-display"],[1,"cursor-blink"],[1,"screen-placeholder"],[1,"screen-call-info"],[1,"screen-number-small"],[1,"screen-duration"],[1,"control-row"],["class","retro-btn retro-btn-red",3,"disabled","click",4,"ngIf"],[1,"retro-btn",3,"click","disabled"],[1,"text-white",3,"name","size"],[1,"retro-btn","retro-btn-gray",3,"click","disabled"],["name","pause",1,"text-white",3,"size"],[1,"retro-btn","retro-btn-red",3,"click","disabled"],["name","phone-off",1,"text-white",3,"size"],[1,"retro-key",3,"click"],[1,"key-digit"],["class","key-letters",4,"ngIf"],[1,"key-letters"],[1,"action-buttons"],[1,"action-btn","action-btn-secondary",3,"click","disabled"],["name","delete-back",3,"size"],[1,"action-label"],[1,"action-btn","action-btn-call",3,"click","disabled"],["name","phone",1,"text-white",3,"size"],[1,"action-label-white"],["name","x-circle",3,"size"]],template:function(r,o){r&1&&(g(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),k(4,"lucide-angular",4),g(5,"span",5),T(6),S()(),N(7,Ot,5,1,"div",6)(8,Dt,2,0,"div",7)(9,Nt,3,1,"div",8)(10,Lt,2,1,"div",9),S()(),N(11,jt,6,10,"div",10),g(12,"div",11),N(13,Ut,4,2,"button",12),S(),N(14,zt,13,6,"div",13),S()),r&2&&(h(4),C("name",o.callState===o.CallState.ACTIVE?"phone-call":"phone")("size",14),h(2),D(o.getStatusText()),h(),C("ngIf",o.callState===o.CallState.IDLE&&o.dialedNumber),h(),C("ngIf",o.callState===o.CallState.IDLE&&!o.dialedNumber),h(),C("ngIf",o.phoneNumber&&o.callState!==o.CallState.IDLE),h(),C("ngIf",o.isActive()),h(),C("ngIf",o.isActive()),h(2),C("ngForOf",Ye(10,It)),h(),C("ngIf",o.callState===o.CallState.IDLE))},dependencies:[q,we,et,Z,w,X,Y,at],styles:['.phone-body[_ngcontent-%COMP%]{background:linear-gradient(145deg,#e6e9f0,#eef1f5);border-radius:24px;padding:20px;box-shadow:12px 12px 24px #aeaec066,-12px -12px 24px #fffc,inset 2px 2px 4px #ffffff80;max-width:320px;margin:0 auto;border:2px solid rgba(255,255,255,.8)}.dark[_nghost-%COMP%]   .phone-body[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .phone-body[_ngcontent-%COMP%]{background:linear-gradient(145deg,#1e293b,#0f172a);box-shadow:12px 12px 24px #00000080,-12px -12px 24px #3341554d,inset 2px 2px 4px #33415580;border-color:#33415580}.phone-screen[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9ca885,#b4c29d);border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:inset 4px 4px 8px #00000040,inset -2px -2px 6px #fff6;border:2px solid rgba(0,0,0,.15);min-height:80px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}.phone-screen[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 1px,rgba(0,0,0,.03) 1px,rgba(0,0,0,.03) 2px),repeating-linear-gradient(90deg,transparent,transparent 1px,rgba(0,0,0,.03) 1px,rgba(0,0,0,.03) 2px);pointer-events:none}.dark[_nghost-%COMP%]   .phone-screen[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .phone-screen[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2a4a3a,#3a5a4a);box-shadow:inset 4px 4px 8px #00000080,inset -2px -2px 6px #5a786433;border-color:#0006}.screen-content[_ngcontent-%COMP%]{text-align:center;width:100%;min-height:60px;display:flex;flex-direction:column;justify-content:center}.screen-status[_ngcontent-%COMP%]{font-size:9px;font-weight:700;color:#1f3d2c;text-transform:uppercase;letter-spacing:1px;font-family:Courier New,Consolas,monospace;text-shadow:0 0 2px rgba(31,61,44,.5),1px 1px 0 rgba(255,255,255,.2)}.dark[_nghost-%COMP%]   .screen-status[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .screen-status[_ngcontent-%COMP%]{color:#5fd385;text-shadow:0 0 3px rgba(95,211,133,.6),0 0 6px rgba(95,211,133,.3)}.screen-number[_ngcontent-%COMP%]{font-size:26px;font-weight:900;color:#0d1f17;font-family:Courier New,Consolas,Lucida Console,monospace;letter-spacing:3px;display:flex;align-items:center;justify-content:center;gap:2px;text-shadow:0 0 3px rgba(13,31,23,.4),1px 1px 0 rgba(255,255,255,.15);-webkit-font-smoothing:none;-moz-osx-font-smoothing:grayscale}.dark[_nghost-%COMP%]   .screen-number[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .screen-number[_ngcontent-%COMP%]{color:#6ee89a;text-shadow:0 0 4px rgba(110,232,154,.8),0 0 8px rgba(110,232,154,.4),0 0 12px rgba(110,232,154,.2)}.number-display[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translate(-5px)}to{opacity:1;transform:translate(0)}}.cursor-blink[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_blink .8s step-start infinite;font-weight:900;color:#0d1f17}.dark[_nghost-%COMP%]   .cursor-blink[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .cursor-blink[_ngcontent-%COMP%]{color:#6ee89a;text-shadow:0 0 4px rgba(110,232,154,.8),0 0 8px rgba(110,232,154,.4)}@keyframes _ngcontent-%COMP%_blink{50%{opacity:0}}.screen-placeholder[_ngcontent-%COMP%]{font-size:10px;color:#4a6b52;font-style:normal;font-family:Courier New,monospace;text-shadow:1px 1px 0 rgba(255,255,255,.15);opacity:.6}.dark[_nghost-%COMP%]   .screen-placeholder[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .screen-placeholder[_ngcontent-%COMP%]{color:#3d7a52;text-shadow:0 0 2px rgba(61,122,82,.5);opacity:.8}.screen-call-info[_ngcontent-%COMP%]{margin-top:4px}.screen-number-small[_ngcontent-%COMP%]{font-size:18px;font-weight:800;color:#0d1f17;font-family:Courier New,Consolas,monospace;letter-spacing:2px;text-shadow:0 0 2px rgba(13,31,23,.4),1px 1px 0 rgba(255,255,255,.1);-webkit-font-smoothing:none}.dark[_nghost-%COMP%]   .screen-number-small[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .screen-number-small[_ngcontent-%COMP%]{color:#6ee89a;text-shadow:0 0 4px rgba(110,232,154,.7),0 0 8px rgba(110,232,154,.3)}.screen-duration[_ngcontent-%COMP%]{font-size:22px;font-weight:900;color:#0a3a1f;font-family:Courier New,Consolas,monospace;letter-spacing:2px;margin-top:4px;animation:_ngcontent-%COMP%_fadeIn .5s ease-in;text-shadow:0 0 3px rgba(10,58,31,.5),1px 1px 0 rgba(255,255,255,.15);-webkit-font-smoothing:none}.dark[_nghost-%COMP%]   .screen-duration[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .screen-duration[_ngcontent-%COMP%]{color:#5fd385;text-shadow:0 0 5px rgba(95,211,133,.9),0 0 10px rgba(95,211,133,.5),0 0 15px rgba(95,211,133,.3)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.control-row[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-bottom:16px}.retro-btn[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .1s ease;box-shadow:4px 4px 8px #0003,-2px -2px 6px #ffffffb3,inset 1px 1px 2px #ffffff80}.retro-btn[_ngcontent-%COMP%]:active:not(:disabled){box-shadow:inset 3px 3px 6px #0003,inset -1px -1px 3px #ffffff4d;transform:scale(.95)}.retro-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;box-shadow:2px 2px 4px #0000001a,-1px -1px 3px #ffffff80}.retro-btn-red[_ngcontent-%COMP%]{background:linear-gradient(145deg,#f87171,#dc2626)}.retro-btn-blue[_ngcontent-%COMP%]{background:linear-gradient(145deg,#60a5fa,#2563eb)}.retro-btn-yellow[_ngcontent-%COMP%]{background:linear-gradient(145deg,#fbbf24,#f59e0b)}.retro-btn-gray[_ngcontent-%COMP%]{background:linear-gradient(145deg,#9ca3af,#6b7280)}.keypad-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:12px;background:linear-gradient(145deg,#dce4ed,#f0f4f8);border-radius:16px;box-shadow:inset 3px 3px 6px #0000001a,inset -2px -2px 4px #fffc}.dark[_nghost-%COMP%]   .keypad-container[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .keypad-container[_ngcontent-%COMP%]{background:linear-gradient(145deg,#0f172a,#1e293b);box-shadow:inset 3px 3px 6px #00000080,inset -2px -2px 4px #3341554d}.retro-key[_ngcontent-%COMP%]{height:52px;background:linear-gradient(145deg,#f8fafc,#e2e8f0);border:none;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .1s ease;box-shadow:5px 5px 10px #94a3b866,-3px -3px 8px #ffffffe6,inset 1px 1px 2px #ffffffb3;position:relative;overflow:hidden}.dark[_nghost-%COMP%]   .retro-key[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .retro-key[_ngcontent-%COMP%]{background:linear-gradient(145deg,#334155,#475569);box-shadow:5px 5px 10px #0006,-3px -3px 8px #4755694d,inset 1px 1px 2px #64748b80}.retro-key[_ngcontent-%COMP%]:hover{background:linear-gradient(145deg,#e0e7ff,#c7d2fe);box-shadow:5px 5px 12px #94a3b880,-3px -3px 10px #fff,inset 1px 1px 3px #fffc}.dark[_nghost-%COMP%]   .retro-key[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .retro-key[_ngcontent-%COMP%]:hover{background:linear-gradient(145deg,#475569,#64748b);box-shadow:5px 5px 12px #00000080,-3px -3px 10px #64748b66,inset 1px 1px 3px #94a3b84d}.retro-key[_ngcontent-%COMP%]:active{box-shadow:inset 4px 4px 8px #00000026,inset -2px -2px 6px #ffffff80;transform:scale(.96)}.dark[_nghost-%COMP%]   .retro-key[_ngcontent-%COMP%]:active, .dark   [_nghost-%COMP%]   .retro-key[_ngcontent-%COMP%]:active{box-shadow:inset 4px 4px 8px #00000080,inset -2px -2px 6px #64748b4d}.key-digit[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#1e293b;text-shadow:1px 1px 2px rgba(255,255,255,.8);line-height:1}.dark[_nghost-%COMP%]   .key-digit[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .key-digit[_ngcontent-%COMP%]{color:#f1f5f9;text-shadow:1px 1px 2px rgba(0,0,0,.5)}.key-letters[_ngcontent-%COMP%]{font-size:8px;font-weight:600;color:#64748b;text-transform:uppercase;margin-top:2px;letter-spacing:.5px}.dark[_nghost-%COMP%]   .key-letters[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .key-letters[_ngcontent-%COMP%]{color:#94a3b8}.action-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1.5fr 1fr;gap:8px;margin-top:12px;padding:0 12px}.action-btn[_ngcontent-%COMP%]{height:48px;border:none;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;cursor:pointer;transition:all .1s ease;box-shadow:4px 4px 8px #00000026,-2px -2px 6px #ffffffb3,inset 1px 1px 2px #ffffff4d}.action-btn[_ngcontent-%COMP%]:active:not(:disabled){box-shadow:inset 3px 3px 6px #0003,inset -1px -1px 3px #ffffff4d;transform:scale(.96)}.action-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed;box-shadow:2px 2px 4px #0000001a,-1px -1px 3px #ffffff80}.action-btn-secondary[_ngcontent-%COMP%]{background:linear-gradient(145deg,#e2e8f0,#cbd5e1)}.dark[_nghost-%COMP%]   .action-btn-secondary[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .action-btn-secondary[_ngcontent-%COMP%]{background:linear-gradient(145deg,#475569,#334155)}.action-btn-call[_ngcontent-%COMP%]{background:linear-gradient(145deg,#22c55e,#16a34a)}.dark[_nghost-%COMP%]   .action-btn-call[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .action-btn-call[_ngcontent-%COMP%]{background:linear-gradient(145deg,#22c55e,#15803d)}.action-btn-call[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(145deg,#16a34a,#15803d);box-shadow:4px 4px 10px #22c55e4d,-2px -2px 8px #fffc,inset 1px 1px 2px #fff6}.action-label[_ngcontent-%COMP%]{font-size:9px;font-weight:600;color:#475569;text-transform:uppercase;letter-spacing:.3px}.dark[_nghost-%COMP%]   .action-label[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .action-label[_ngcontent-%COMP%]{color:#cbd5e1}.action-label-white[_ngcontent-%COMP%]{font-size:10px;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:.5px;text-shadow:0 1px 2px rgba(0,0,0,.2)}@media (max-width: 768px){.phone-body[_ngcontent-%COMP%]{max-width:100%;padding:16px}.retro-key[_ngcontent-%COMP%]{height:48px}.key-digit[_ngcontent-%COMP%]{font-size:18px}.action-btn[_ngcontent-%COMP%]{height:44px}}']});let e=n;return e})();var _t=(()=>{let n=class n{constructor(t){this.http=t,this.apiUrl=`${it.apiUrl}/calls`}makeCall(t){return this.http.post(`${this.apiUrl}/make`,t)}hangupCall(t){return this.http.post(`${this.apiUrl}/${t}/hangup`,{})}completeCall(t,r){return this.http.post(`${this.apiUrl}/${t}/complete`,r)}transferCall(t,r){return this.http.post(`${this.apiUrl}/${t}/transfer`,{destination:r})}getCallById(t){return this.http.get(`${this.apiUrl}/${t}`)}getCallHistory(t){let r=new nt;return t&&(t.agentId&&(r=r.set("agentId",t.agentId.toString())),t.campaignId&&(r=r.set("campaignId",t.campaignId.toString())),t.startDate&&(r=r.set("startDate",t.startDate.toISOString())),t.endDate&&(r=r.set("endDate",t.endDate.toISOString())),t.status&&(r=r.set("status",t.status)),t.page&&(r=r.set("page",t.page.toString())),t.size&&(r=r.set("size",t.size.toString()))),this.http.get(`${this.apiUrl}/history`,{params:r})}getAgentCurrentCall(t){return this.http.get(`${this.apiUrl}/agent/${t}/current`)}};n.\u0275fac=function(r){return new(r||n)(He(rt))},n.\u0275prov=K({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var Vt=["audioElement"],Ln=(()=>{let n=class n{constructor(t,r,o,a,s,l,c){this.authService=t,this.callService=r,this.contactService=o,this.websocketService=a,this.webrtcService=s,this.agentService=l,this.sipService=c,this.currentContact=null,this.currentCall=null,this.agentStatus=F.DISPONIBLE,this.campaignId=null,this.callState=f.IDLE,this.callDuration=0,this.callTimer=null,this.loading=!1,this.showNotesForm=!1,this.subscriptions=[],this.agentId=0}ngOnInit(){this.authService.currentUser$.subscribe(t=>{t&&(this.agentId=t.id,console.log("Agent ID loaded:",this.agentId))}),this.initializeDialer(),this.subscribeToWebSocket(),this.subscribeToWebRTC()}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.stopCallTimer(),this.webrtcService.cleanup()}initializeDialer(){return R(this,null,function*(){try{yield this.webrtcService.initialize(),console.log("WebRTC initialized successfully")}catch(t){console.error("Failed to initialize WebRTC:",t)}})}subscribeToWebSocket(){let t=this.websocketService.subscribe("/user/queue/calls").subscribe({next:r=>{this.handleCallEvent(r)},error:r=>{console.error("WebSocket error:",r)}});this.subscriptions.push(t)}subscribeToWebRTC(){this.webrtcService.onCallStatus.subscribe(t=>{this.callState=t,console.log("Call state changed:",t)}),this.webrtcService.onRemoteStream.subscribe(t=>{this.audioElement&&this.audioElement.nativeElement&&(this.audioElement.nativeElement.srcObject=t,this.audioElement.nativeElement.play())}),this.webrtcService.onError.subscribe(t=>{console.error("WebRTC error:",t),alert(t)})}handleCallEvent(t){switch(console.log("Received call event:",t),t.type){case z.CALL_RINGING:this.callState=f.RINGING;break;case z.CALL_CONNECTED:this.callState=f.ACTIVE,this.startCallTimer();break;case z.CALL_ENDED:this.onCallEnded();break;case z.NEW_CONTACT_ASSIGNED:t.data&&t.data.contact&&(this.currentContact=t.data.contact);break}}loadNextContact(){if(!this.campaignId){console.log("No campaign selected");return}this.loading=!0,this.contactService.getNextContact(this.campaignId,this.agentId).subscribe({next:t=>{this.currentContact=t,this.loading=!1},error:t=>{console.error("Error loading next contact:",t),this.loading=!1}})}makeCall(){return R(this,null,function*(){if(!this.currentContact){alert("No contact available");return}this.loading=!0;let t={agentId:this.agentId,phoneNumber:this.currentContact.phoneNumber,contactId:this.currentContact.id,campaignId:this.campaignId||void 0};try{this.callService.makeCall(t).subscribe({next:r=>{this.currentCall=r,this.callState=f.CONNECTING,this.webrtcService.makeCall(this.currentContact.phoneNumber).then(()=>{console.log("WebRTC call initiated"),this.loading=!1}).catch(o=>{console.error("WebRTC call failed:",o),this.loading=!1})},error:r=>{console.error("Error making call:",r),alert("Failed to make call: "+(r.error?.message||"Unknown error")),this.loading=!1}})}catch(r){console.error("Error in makeCall:",r),this.loading=!1}})}makeCallWithNumber(t){return R(this,null,function*(){this.loading=!0,this.sipService.setCurrentOutgoingNumber(t);let r={agentId:this.agentId,phoneNumber:t,contactId:void 0,campaignId:this.campaignId||void 0};try{this.callService.makeCall(r).subscribe({next:o=>{this.currentCall=o,this.callState=f.CONNECTING,this.currentContact={id:0,phoneNumber:t,firstName:"",lastName:"",campaignId:0,status:"PENDING"},this.webrtcService.makeCall(t).then(()=>{console.log("WebRTC call initiated"),this.loading=!1}).catch(a=>{console.error("WebRTC call failed:",a),this.loading=!1})},error:o=>{console.error("Error making call:",o),alert("Failed to make call: "+(o.error?.message||"Unknown error")),this.loading=!1}})}catch(o){console.error("Error in makeCall:",o),this.loading=!1}})}hangupCall(){this.currentCall&&(this.webrtcService.hangupCall(),this.callService.hangupCall(this.currentCall.callId).subscribe({next:()=>{console.log("Call hung up successfully")},error:t=>{console.error("Error hanging up call:",t)}}),this.stopCallTimer())}onCallEnded(){this.callState=f.ENDED,this.stopCallTimer(),this.showNotesForm=!0}onNotesComplete(){this.showNotesForm=!1,this.currentCall=null,this.currentContact=null,this.callDuration=0,this.callState=f.IDLE,this.loadNextContact()}skipContact(){confirm("Are you sure you want to skip this contact?")&&this.loadNextContact()}startCallTimer(){this.callDuration=0,this.callTimer=setInterval(()=>{this.callDuration++},1e3)}stopCallTimer(){this.callTimer&&(clearInterval(this.callTimer),this.callTimer=null)}formatTimer(t){let r=Math.floor(t/3600),o=Math.floor(t%3600/60),a=t%60;return`${r.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}getAgentStatusLabel(){return this.agentStatus}getAgentStatusColor(){switch(this.agentStatus){case F.DISPONIBLE:return"#4caf50";case F.EN_LLAMADA:return"#f44336";case F.REFRIGERIO:return"#ff9800";default:return"#999"}}toggleMute(){let t=this.webrtcService.toggleMute();console.log("Mute toggled:",t)}isMuted(){return this.webrtcService.isMicMuted()}canMakeCall(){return this.callState===f.IDLE&&this.currentContact!==null&&!this.loading}isInCall(){return this.callState===f.ACTIVE||this.callState===f.CONNECTING||this.callState===f.RINGING}};n.\u0275fac=function(r){return new(r||n)(O(ot),O(_t),O(ct),O(ee),O(vt),O(pt),O(lt))},n.\u0275cmp=Q({type:n,selectors:[["app-dialer-main"]],viewQuery:function(r,o){if(r&1&&We(Vt,5),r&2){let a;Je(a=Ke())&&(o.audioElement=a.first)}},decls:15,vars:9,consts:[["audioElement",""],[1,"h-[100dvh]","bg-gradient-to-br","from-slate-50","via-blue-50","to-slate-100","dark:from-slate-950","dark:via-gray-950","dark:to-black","flex","flex-col","overflow-hidden","transition-colors","duration-300"],[1,"flex","items-center","gap-2","p-4"],[1,"w-8","h-8","bg-gradient-to-br","from-blue-600","to-blue-700","rounded-lg","flex","items-center","justify-center"],["name","phone",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-gray-900","dark:text-white"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"flex-1","flex","items-center","justify-center","p-4"],[1,"w-full","max-w-md"],[3,"muteClicked","callClicked","callState","duration","isMuted","phoneNumber","canHangup"],["autoplay",""]],template:function(r,o){if(r&1){let a=L();g(0,"div",1)(1,"div",2)(2,"div",3),k(3,"lucide-angular",4),S(),g(4,"div")(5,"h1",5),T(6,"Marcaci\xF3n Manual"),S(),g(7,"p",6),T(8),Xe(9,"async"),S()()(),g(10,"div",7)(11,"div",8)(12,"app-softphone",9),M("muteClicked",function(){return _(a),P(o.toggleMute())})("callClicked",function(l){return _(a),P(o.makeCallWithNumber(l))}),S()()(),k(13,"audio",10,0),S()}if(r&2){let a;h(3),C("size",16),h(5),D(((a=Ze(9,7,o.authService.currentUser$))==null?null:a.firstName)||"Agente"),h(4),C("callState",o.callState)("duration",o.callDuration)("isMuted",o.isMuted())("phoneNumber",(o.currentContact==null?null:o.currentContact.phoneNumber)||"")("canHangup",!1)}},dependencies:[q,Z,w,X,Y,st,Tt,tt],styles:["audio[_ngcontent-%COMP%]{position:absolute;opacity:0;pointer-events:none}"]});let e=n;return e})();export{Ln as DialerMainComponent};
