import{a as R,b as F,g as Z}from"./chunk-PKFBRZD7.js";import{a as q}from"./chunk-LA57DBYT.js";import"./chunk-RIMEIBS7.js";import"./chunk-VUSOBWTB.js";import{a as L}from"./chunk-KAKL3FYD.js";import"./chunk-IW4UZOVV.js";import"./chunk-UXRZVQCL.js";import{E as W}from"./chunk-E2JO3TS2.js";import{pc as A,qc as H}from"./chunk-3IYT5ASU.js";import"./chunk-YQKVMPSG.js";import"./chunk-72Z2NTOL.js";import{Eb as _,Fb as x,Ib as P,Jb as E,Kb as m,Lb as a,Mb as l,Nb as u,Nc as j,Ub as v,Wb as b,Yb as d,a as T,ab as r,b as z,gb as S,ic as V,jc as k,kc as c,lc as I,ld as $,ma as h,mc as w,na as C,nb as O,wa as f,wb as N}from"./chunk-BDAG5FYU.js";var G=(i,s)=>s.idRol,D=(i,s)=>s.codigo;function B(i,s){i&1&&(a(0,"div",10),u(1,"lucide-angular",13),a(2,"span",14),c(3,"Cargando roles..."),l()()),i&2&&(r(),m("size",16))}function J(i,s){if(i&1){let n=v();a(0,"button",17),b("click",function(){let t=h(n).$implicit,o=d(2);return C(o.selectRole(t.nombreRol))}),c(1),l()}if(i&2){let n=s.$implicit,e=d(2);k(e.selectedRole()===n.nombreRol?"bg-indigo-600 text-white":"bg-slate-800 text-gray-300 hover:bg-slate-700"),r(),w(" ",n.descripcion||n.nombreRol," ")}}function K(i,s){i&1&&(a(0,"span",16),c(1,"No hay roles disponibles"),l())}function U(i,s){if(i&1&&(P(0,J,2,3,"button",15,G),_(2,K,2,0,"span",16)),i&2){let n=d();E(n.roles()),r(2),x(n.roles().length===0?2:-1)}}function X(i,s){i&1&&(a(0,"div",11),u(1,"lucide-angular",18),l()),i&2&&(r(),m("size",32))}function Y(i,s){i&1&&u(0,"lucide-angular",36),i&2&&m("size",12)}function ee(i,s){i&1&&(a(0,"span",38),c(1,"dropdown"),l())}function te(i,s){if(i&1){let n=v();a(0,"button",45),b("click",function(){h(n);let t=d().$implicit,o=d(2);return C(o.openParentModal(t))}),u(1,"lucide-angular",46),l()}i&2&&(r(),m("size",14))}function ie(i,s){if(i&1){let n=v();a(0,"button",47),b("click",function(){h(n);let t=d().$implicit,o=d(2);return C(o.removeParent(t))}),u(1,"lucide-angular",48),l()}i&2&&(r(),m("size",14))}function ne(i,s){if(i&1){let n=v();a(0,"div",34)(1,"div",35),_(2,Y,1,1,"lucide-angular",36),u(3,"lucide-angular",37),a(4,"span",14),c(5),l(),_(6,ee,2,0,"span",38),a(7,"span",39),c(8),l()(),a(9,"div",40),_(10,te,2,1,"button",41),_(11,ie,2,1,"button",42),a(12,"button",43),b("click",function(){let t=h(n).$implicit,o=d(2);return C(o.moveToHidden(t))}),u(13,"lucide-angular",44),l()()()}if(i&2){let n=s.$implicit,e=d(2);V("ml-6",e.isChild(n)),r(2),x(e.isChild(n)?2:-1),r(),k(e.isChild(n)?"text-indigo-300":"text-indigo-400"),m("name",n.icono)("size",16),r(),k(e.isChild(n)?"text-gray-200":"text-white font-medium"),r(),I(n.etiqueta),r(),x(n.tipo==="DROPDOWN"?6:-1),r(2),w("#",n.orden),r(2),x(n.tipo!=="DROPDOWN"?10:-1),r(),x(e.isChild(n)?11:-1),r(2),m("size",14)}}function oe(i,s){i&1&&(a(0,"div",27),u(1,"lucide-angular",44),a(2,"p",49),c(3,"No hay elementos visibles"),l()()),i&2&&(r(),m("size",32))}function re(i,s){i&1&&u(0,"lucide-angular",51),i&2&&m("size",12)}function ae(i,s){i&1&&(a(0,"span",54),c(1,"dropdown"),l())}function le(i,s){if(i&1){let n=v();a(0,"button",45),b("click",function(){h(n);let t=d().$implicit,o=d(2);return C(o.openParentModal(t))}),u(1,"lucide-angular",46),l()}i&2&&(r(),m("size",14))}function se(i,s){if(i&1){let n=v();a(0,"button",47),b("click",function(){h(n);let t=d().$implicit,o=d(2);return C(o.removeParent(t))}),u(1,"lucide-angular",48),l()}i&2&&(r(),m("size",14))}function de(i,s){if(i&1){let n=v();a(0,"div",50)(1,"div",35),_(2,re,1,1,"lucide-angular",51),u(3,"lucide-angular",52),a(4,"span",53),c(5),l(),_(6,ae,2,0,"span",54),a(7,"span",55),c(8),l()(),a(9,"div",40),_(10,le,2,1,"button",41),_(11,se,2,1,"button",42),a(12,"button",56),b("click",function(){let t=h(n).$implicit,o=d(2);return C(o.moveToVisible(t))}),u(13,"lucide-angular",57),l()()()}if(i&2){let n=s.$implicit,e=d(2);V("ml-6",e.isChild(n)),r(2),x(e.isChild(n)?2:-1),r(),m("name",n.icono)("size",16),r(2),I(n.etiqueta),r(),x(n.tipo==="DROPDOWN"?6:-1),r(2),w("#",n.orden),r(2),x(n.tipo!=="DROPDOWN"?10:-1),r(),x(e.isChild(n)?11:-1),r(2),m("size",14)}}function ce(i,s){i&1&&(a(0,"div",27),u(1,"lucide-angular",58),a(2,"p",49),c(3,"Todos los elementos son visibles"),l()()),i&2&&(r(),m("size",32))}function me(i,s){i&1&&u(0,"lucide-angular",13),i&2&&m("size",16)}function ue(i,s){i&1&&u(0,"lucide-angular",33),i&2&&m("size",16)}function pe(i,s){if(i&1){let n=v();a(0,"div",19)(1,"div",20)(2,"div",21),u(3,"lucide-angular",22),a(4,"h2",23),c(5,"Elementos Visibles"),l(),a(6,"span",24),c(7),l()(),a(8,"div",25),P(9,ne,14,15,"div",26,D),_(11,oe,4,1,"div",27),l()(),a(12,"div",20)(13,"div",21),u(14,"lucide-angular",28),a(15,"h2",23),c(16,"Elementos Ocultos"),l(),a(17,"span",24),c(18),l()(),a(19,"div",25),P(20,de,14,11,"div",29,D),_(22,ce,4,1,"div",27),l()()(),a(23,"div",30)(24,"button",31),b("click",function(){h(n);let t=d();return C(t.cancel())}),c(25," Cancelar "),l(),a(26,"button",32),b("click",function(){h(n);let t=d();return C(t.save())}),_(27,me,1,1,"lucide-angular",13)(28,ue,1,1,"lucide-angular",33),c(29," Guardar Cambios "),l()()}if(i&2){let n=d();r(3),m("size",18),r(4),w("(",n.visibleItems().length,")"),r(2),E(n.visibleFlat()),r(2),x(n.visibleItems().length===0?11:-1),r(3),m("size",18),r(4),w("(",n.hiddenItems().length,")"),r(2),E(n.hiddenFlat()),r(2),x(n.hiddenItems().length===0?22:-1),r(2),m("disabled",!n.hasChanges()),r(2),m("disabled",!n.hasChanges()||n.saving()),r(),x(n.saving()?27:28)}}function ge(i,s){if(i&1&&(a(0,"div",67)(1,"span",24),c(2,"Padre actual:"),l(),a(3,"span",71),c(4),l()()),i&2){let n=d(),e=d(2);r(4),I(e.getParentLabel(n.codigoPadre))}}function _e(i,s){i&1&&u(0,"lucide-angular",76),i&2&&m("size",14)}function xe(i,s){if(i&1){let n=v();a(0,"button",73),b("click",function(){h(n);let t=d().$implicit,o=d(3);return C(o.assignParent(t.codigo))}),u(1,"lucide-angular",74),a(2,"span",75),c(3),l(),_(4,_e,1,1,"lucide-angular",76),l()}if(i&2){let n=d().$implicit,e=d();k(e.codigoPadre===n.codigo?"border-indigo-500 bg-indigo-500/10":"border-slate-700"),r(),m("name",n.icono)("size",16),r(2),I(n.etiqueta),r(),x(e.codigoPadre===n.codigo?4:-1)}}function he(i,s){if(i&1&&_(0,xe,5,6,"button",72),i&2){let n=s.$implicit,e=d();x(n.codigo!==e.codigo?0:-1)}}function Ce(i,s){if(i&1){let n=v();a(0,"p",65),c(1," Selecciona el dropdown padre para: "),a(2,"span",66),c(3),l()(),_(4,ge,5,1,"div",67),a(5,"div",68)(6,"button",69),b("click",function(){h(n);let t=d(2);return C(t.assignParent(null))}),u(7,"lucide-angular",70),a(8,"span",53),c(9,"Sin padre (elemento raiz)"),l()(),P(10,he,1,1,null,null,D),l()}if(i&2){let n=s,e=d(2);r(3),I(n.etiqueta),r(),x(n.codigoPadre?4:-1),r(3),m("size",16),r(3),E(e.availableParents())}}function fe(i,s){if(i&1){let n=v();a(0,"div",59),b("click",function(){h(n);let t=d();return C(t.closeParentModal())}),a(1,"div",60),b("click",function(t){return h(n),C(t.stopPropagation())}),a(2,"div",61)(3,"h3",62),c(4,"Asignar Padre"),l(),a(5,"button",63),b("click",function(){h(n);let t=d();return C(t.closeParentModal())}),u(6,"lucide-angular",64),l()(),_(7,Ce,12,3),l()()}if(i&2){let n,e=d();r(6),m("size",20),r(),x((n=e.itemToAssignParent())?7:-1,n)}}var Te=(()=>{let s=class s{constructor(e,t,o,p){this.menuService=e,this.authService=t,this.cdr=o,this.ngZone=p,this.roles=f([]),this.loadingRoles=f(!1),this.selectedRole=f(""),this.allItems=f([]),this.visibleItems=f([]),this.hiddenItems=f([]),this.showParentModal=f(!1),this.itemToAssignParent=f(null),this.loading=f(!1),this.saving=f(!1),this.hasChanges=f(!1),this.visibleFlat=f([]),this.hiddenFlat=f([]),this.availableParents=f([])}ngOnInit(){this.loadRoles()}loadRoles(){this.loadingRoles.set(!0),this.authService.getRoles().subscribe({next:e=>{let t=e.filter(o=>o.activo);this.roles.set(t),this.loadingRoles.set(!1),t.length>0&&(this.selectedRole.set(t[0].nombreRol),this.loadRoleConfig(t[0].nombreRol))},error:e=>{console.error("Error loading roles:",e),this.loadingRoles.set(!1),alert("Error al cargar los roles")}})}getRoleLabel(e){return this.roles().find(o=>o.nombreRol===e)?.descripcion||e}selectRole(e){this.hasChanges()&&!confirm("Hay cambios sin guardar. \xBFDesea continuar?")||(this.selectedRole.set(e),this.loadRoleConfig(e))}loadRoleConfig(e){this.loading.set(!0),this.menuService.getMenuConfigForRole(e).subscribe({next:t=>{let o=[],p=[],g=[];t.forEach(y=>{let M=z(T({},y),{visible:y.visible??!1});o.push(M),y.visible?p.push(M):g.push(M)}),this.allItems.set(o),this.visibleItems.set(p),this.hiddenItems.set(g),this.ngZone.run(()=>{this.availableParents.set(o.filter(y=>y.tipo==="DROPDOWN")),this.recalculateHierarchies(),this.hasChanges.set(!1),this.loading.set(!1)})},error:t=>{console.error("Error loading menu config:",t),this.loading.set(!1),alert("Error al cargar la configuracion del menu")}})}recalculateHierarchies(){this.visibleFlat.set(this.buildFlatList(this.visibleItems())),this.hiddenFlat.set(this.buildFlatList(this.hiddenItems()))}buildFlatList(e){let t=[],o=new Map;e.forEach(g=>{g.codigoPadre&&(o.has(g.codigoPadre)||o.set(g.codigoPadre,[]),o.get(g.codigoPadre).push(g))});let p=e.filter(g=>!g.codigoPadre);return p.sort((g,y)=>g.orden-y.orden),p.forEach(g=>{t.push(g);let y=o.get(g.codigo)||[];y.sort((M,Q)=>M.orden-Q.orden),y.forEach(M=>t.push(M))}),t}isChild(e){return!!e.codigoPadre}dropVisible(e){if(e.previousContainer===e.container){let t=[...this.visibleItems()];R(t,e.previousIndex,e.currentIndex),this.visibleItems.set(t)}else{let t=[...this.hiddenItems()],o=[...this.visibleItems()];F(t,o,e.previousIndex,e.currentIndex),this.hiddenItems.set(t),this.visibleItems.set(o)}this.updateOrders(),this.recalculateHierarchies(),this.hasChanges.set(!0)}dropHidden(e){if(e.previousContainer===e.container){let t=[...this.hiddenItems()];R(t,e.previousIndex,e.currentIndex),this.hiddenItems.set(t)}else{let t=[...this.visibleItems()],o=[...this.hiddenItems()];F(t,o,e.previousIndex,e.currentIndex),this.visibleItems.set(t),this.hiddenItems.set(o)}this.updateOrders(),this.recalculateHierarchies(),this.hasChanges.set(!0)}moveToVisible(e){let t=[...this.hiddenItems()],o=[...this.visibleItems()],p=t.findIndex(g=>g.codigo===e.codigo);p>-1&&(t.splice(p,1),e.visible=!0,o.push(e)),this.hiddenItems.set(t),this.visibleItems.set(o),this.updateOrders(),this.recalculateHierarchies(),this.hasChanges.set(!0)}moveToHidden(e){let t=[...this.hiddenItems()],o=[...this.visibleItems()],p=o.findIndex(g=>g.codigo===e.codigo);p>-1&&(o.splice(p,1),e.visible=!1,t.push(e)),this.visibleItems.set(o),this.hiddenItems.set(t),this.updateOrders(),this.recalculateHierarchies(),this.hasChanges.set(!0)}updateOrders(){let e=this.visibleItems(),t=this.hiddenItems();e.forEach((o,p)=>{o.orden=p+1,o.visible=!0}),t.forEach((o,p)=>{o.orden=p+1,o.visible=!1})}save(){this.saving.set(!0);let e=[...this.visibleItems(),...this.hiddenItems()],t={rol:this.selectedRole(),permissions:e.map(o=>({menuCodigo:o.codigo,visible:o.visible,orden:o.orden}))};this.menuService.updateMenuConfig(t).subscribe({next:()=>{this.saving.set(!1),this.hasChanges.set(!1),alert("Configuracion guardada correctamente")},error:o=>{console.error("Error saving config:",o),this.saving.set(!1),alert("Error al guardar la configuracion")}})}cancel(){this.hasChanges()&&confirm("\xBFDescartar los cambios?")&&this.loadRoleConfig(this.selectedRole())}getItemTypeLabel(e){return e==="DROPDOWN"?"(dropdown)":""}openParentModal(e){this.itemToAssignParent.set(e),this.showParentModal.set(!0)}closeParentModal(){this.showParentModal.set(!1),this.itemToAssignParent.set(null)}assignParent(e){let t=this.itemToAssignParent();t&&this.menuService.updateMenuItemParent(t.codigo,e).subscribe({next:()=>{let o=p=>p.map(g=>g.codigo===t.codigo?z(T({},g),{codigoPadre:e}):g);t.visible?this.visibleItems.set(o(this.visibleItems())):this.hiddenItems.set(o(this.hiddenItems())),this.allItems.set(o(this.allItems())),this.recalculateHierarchies(),this.closeParentModal()},error:o=>{console.error("Error updating parent:",o),alert("Error al actualizar el padre")}})}removeParent(e){this.menuService.updateMenuItemParent(e.codigo,null).subscribe({next:()=>{let t=o=>o.map(p=>p.codigo===e.codigo?z(T({},p),{codigoPadre:null}):p);e.visible?this.visibleItems.set(t(this.visibleItems())):this.hiddenItems.set(t(this.hiddenItems())),this.allItems.set(t(this.allItems())),this.recalculateHierarchies()},error:t=>{console.error("Error removing parent:",t),alert("Error al quitar el padre")}})}getParentLabel(e){if(!e)return"";let t=this.allItems().find(o=>o.codigo===e);return t?t.etiqueta:e}};s.\u0275fac=function(t){return new(t||s)(S(q),S(L),S(j),S(N))},s.\u0275cmp=O({type:s,selectors:[["app-menu-configuration"]],decls:18,vars:4,consts:[[1,"h-[calc(100dvh-56px)]","bg-slate-950","overflow-hidden","flex","flex-col"],[1,"flex-1","overflow-y-auto"],[1,"p-4","max-w-[1400px]","mx-auto"],[1,"mb-4"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-gradient-to-br","from-indigo-600","to-indigo-700","rounded-lg","flex","items-center","justify-center"],["name","menu",1,"text-white",3,"size"],[1,"text-xl","font-bold","text-white"],[1,"text-sm","text-gray-400"],[1,"flex","gap-2","mb-4"],[1,"flex","items-center","gap-2","text-gray-400"],[1,"flex","items-center","justify-center","py-12"],[1,"fixed","inset-0","bg-black/60","flex","items-center","justify-center","z-50"],["name","loader-2",1,"animate-spin",3,"size"],[1,"text-sm"],[1,"px-4","py-2","rounded-lg","text-sm","font-semibold","transition-colors",3,"class"],[1,"text-gray-500","text-sm"],[1,"px-4","py-2","rounded-lg","text-sm","font-semibold","transition-colors",3,"click"],["name","loader-2",1,"text-indigo-400","animate-spin",3,"size"],[1,"grid","grid-cols-2","gap-4"],[1,"bg-slate-900","rounded-lg","border","border-slate-800","p-4"],[1,"flex","items-center","gap-2","mb-3"],["name","eye",1,"text-green-400",3,"size"],[1,"text-sm","font-bold","text-white"],[1,"text-xs","text-gray-400"],[1,"min-h-[400px]","p-2","bg-slate-800/50","rounded-lg","border-2","border-dashed","border-slate-700"],[1,"flex","items-center","justify-between","p-2","mb-1","bg-slate-800","rounded","border","border-slate-700","hover:border-indigo-500/50","group",3,"ml-6"],[1,"flex","flex-col","items-center","justify-center","py-8","text-gray-500"],["name","eye-off",1,"text-red-400",3,"size"],[1,"flex","items-center","justify-between","p-2","mb-1","bg-slate-800","rounded","border","border-slate-700","hover:border-indigo-500/50","group","opacity-60","hover:opacity-100",3,"ml-6"],[1,"mt-4","flex","justify-end","gap-2"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","text-sm","font-semibold","transition-colors",3,"click","disabled"],[1,"px-4","py-2","bg-indigo-600","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","text-sm","font-semibold","transition-colors","flex","items-center","gap-2",3,"click","disabled"],["name","save",3,"size"],[1,"flex","items-center","justify-between","p-2","mb-1","bg-slate-800","rounded","border","border-slate-700","hover:border-indigo-500/50","group"],[1,"flex","items-center","gap-2"],["name","corner-down-right",1,"text-gray-500",3,"size"],[3,"name","size"],[1,"text-xs","bg-indigo-500/20","text-indigo-300","px-1.5","py-0.5","rounded"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","gap-1"],["title","Asignar padre",1,"p-1","text-gray-400","hover:text-indigo-400"],["title","Quitar padre",1,"p-1","text-gray-400","hover:text-yellow-400"],["title","Ocultar",1,"p-1","text-gray-400","hover:text-red-400",3,"click"],["name","eye-off",3,"size"],["title","Asignar padre",1,"p-1","text-gray-400","hover:text-indigo-400",3,"click"],["name","folder-tree",3,"size"],["title","Quitar padre",1,"p-1","text-gray-400","hover:text-yellow-400",3,"click"],["name","unlink",3,"size"],[1,"text-sm","mt-2"],[1,"flex","items-center","justify-between","p-2","mb-1","bg-slate-800","rounded","border","border-slate-700","hover:border-indigo-500/50","group","opacity-60","hover:opacity-100"],["name","corner-down-right",1,"text-gray-600",3,"size"],[1,"text-gray-400",3,"name","size"],[1,"text-sm","text-gray-300"],[1,"text-xs","bg-gray-500/20","text-gray-400","px-1.5","py-0.5","rounded"],[1,"text-xs","text-gray-600"],["title","Mostrar",1,"p-1","text-gray-400","hover:text-green-400",3,"click"],["name","eye",3,"size"],["name","check-circle",3,"size"],[1,"fixed","inset-0","bg-black/60","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-slate-900","rounded-lg","border","border-slate-700","p-4","w-96","max-w-[90vw]",3,"click"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-bold","text-white"],[1,"text-gray-400","hover:text-white",3,"click"],["name","x",3,"size"],[1,"text-sm","text-gray-400","mb-4"],[1,"text-white","font-medium"],[1,"mb-3","p-2","bg-slate-800","rounded","border","border-slate-700"],[1,"space-y-2","max-h-60","overflow-y-auto"],[1,"w-full","flex","items-center","gap-2","p-2","bg-slate-800","hover:bg-slate-700","rounded","border","border-slate-700","text-left","transition-colors",3,"click"],["name","minus-circle",1,"text-gray-400",3,"size"],[1,"text-sm","text-indigo-400","ml-2"],[1,"w-full","flex","items-center","gap-2","p-2","bg-slate-800","hover:bg-slate-700","rounded","border","text-left","transition-colors",3,"class"],[1,"w-full","flex","items-center","gap-2","p-2","bg-slate-800","hover:bg-slate-700","rounded","border","text-left","transition-colors",3,"click"],[1,"text-indigo-400",3,"name","size"],[1,"text-sm","text-white"],["name","check",1,"text-indigo-400","ml-auto",3,"size"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),u(6,"lucide-angular",6),l(),a(7,"div")(8,"h1",7),c(9,"Configuracion de Menu"),l(),a(10,"p",8),c(11,"Configura la visibilidad del menu por rol"),l()()()(),a(12,"div",9),_(13,B,4,1,"div",10)(14,U,3,1),l(),_(15,X,2,1,"div",11)(16,pe,30,9),l()()(),_(17,fe,8,2,"div",12)),t&2&&(r(6),m("size",20),r(7),x(o.loadingRoles()?13:14),r(2),x(o.loading()?15:16),r(2),x(o.showParentModal()?17:-1))},dependencies:[$,W,H,A,Z],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;background:#1e293b;border:1px solid #6366f1}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.3}.cdk-drag-animating[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-receiving[_ngcontent-%COMP%]{border-color:#6366f1!important;background:#6366f11a!important}"]});let i=s;return i})();export{Te as MenuConfigurationComponent};
