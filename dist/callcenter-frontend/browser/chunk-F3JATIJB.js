import{a as Q,b as X,c as Y,d as ee,e as te,f as ie,g as ne,h as ae,i as re,j as oe,k as le,l as de,m as se}from"./chunk-SJGC7I2I.js";import{a as J}from"./chunk-ZL45YB4K.js";import{Zb as Z,_b as q}from"./chunk-NUMEWRMA.js";import{a as G}from"./chunk-YQKVMPSG.js";import{Ac as f,Bc as A,E as j,Fb as v,Gb as C,Gc as D,Jb as R,Kb as L,Lb as u,Mb as e,Nb as t,Ob as l,Z as V,Zb as h,ab as n,ca as F,ga as N,gb as I,kc as T,lc as a,ld as W,mc as g,md as H,nb as $,nc as E,oc as K,ud as U,xa as z,zc as b}from"./chunk-SN4XSKG7.js";var me=(()=>{let o=class o{constructor(i){this.http=i,this.baseUrl=`${G.gatewayUrl}/dashboard/payments`}getDashboard(){return console.log("[DASHBOARD] Obteniendo m\xE9tricas de pagos..."),this.http.get(this.baseUrl)}};o.\u0275fac=function(p){return new(p||o)(N(U))},o.\u0275prov=F({token:o,factory:o.\u0275fac,providedIn:"root"});let r=o;return r})();var ue=(r,o)=>o.agenteId;function ge(r,o){r&1&&(e(0,"div",6),l(1,"div",8),t())}function be(r,o){if(r&1&&(e(0,"div",7),a(1),t()),r&2){let c=h();n(),E(" ",c.error()," ")}}function xe(r,o){if(r&1&&l(0,"canvas",41),r&2){let c=h(2);u("type","doughnut")("data",c.conciliacionChartData)("options",c.doughnutChartOptions())}}function he(r,o){if(r&1&&l(0,"canvas",41),r&2){let c=h(2);u("type","doughnut")("data",c.promesasChartData)("options",c.doughnutChartOptions())}}function fe(r,o){if(r&1&&l(0,"canvas",41),r&2){let c=h(2);u("type","line")("data",c.tendenciaChartData)("options",c.lineChartOptions())}}function ve(r,o){if(r&1&&(e(0,"div",54)(1,"div",57),a(2),t(),e(3,"div",58)(4,"p",59),a(5),t(),e(6,"p",60),a(7),b(8,"number"),t()(),e(9,"div",61)(10,"p",62),a(11),t(),e(12,"p",60),a(13),t()()()),r&2){let c=o.$implicit,i=o.$index,p=h(2);n(),T(i===0?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400":i===1?"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300":i===2?"bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400"),n(),E(" ",i+1," "),n(3),g(c.nombreAgente),n(2),K(" ",c.promesasRegistradas," promesas \xB7 ",A(8,8,c.tasaCumplimiento,"1.0-0"),"% cumplimiento "),n(4),g(p.formatCurrency(c.montoTotal)),n(2),E("",c.cantidadPagos," pagos")}}function Ce(r,o){r&1&&(e(0,"div",55),l(1,"lucide-angular",63),e(2,"p"),a(3,"No hay datos de agentes"),t()()),r&2&&(n(),u("size",32))}function ye(r,o){if(r&1&&l(0,"canvas",41),r&2){let c=h(2);u("type","bar")("data",c.bancosChartData)("options",c.barChartOptions())}}function ke(r,o){if(r&1&&(e(0,"div",9)(1,"div",10)(2,"div",11)(3,"div")(4,"p",12),a(5,"Pagos Banco"),t(),e(6,"p",13),a(7),b(8,"number"),t(),e(9,"p",14),a(10),t()(),e(11,"div",15),l(12,"lucide-angular",16),t()()(),e(13,"div",10)(14,"div",11)(15,"div")(16,"p",12),a(17,"Conciliados"),t(),e(18,"p",17),a(19),b(20,"number"),t(),e(21,"p",18),a(22),t()(),e(23,"div",19),l(24,"lucide-angular",20),t()()(),e(25,"div",10)(26,"div",11)(27,"div")(28,"p",12),a(29,"Pagos Voluntarios"),t(),e(30,"p",21),a(31),b(32,"number"),t(),e(33,"p",22),a(34),t()(),e(35,"div",23),l(36,"lucide-angular",24),t()()(),e(37,"div",10)(38,"div",11)(39,"div")(40,"p",12),a(41,"Sin Verificar"),t(),e(42,"p",25),a(43),b(44,"number"),t(),e(45,"p",26),a(46),t()(),e(47,"div",27),l(48,"lucide-angular",28),t()()()(),e(49,"div",9)(50,"div",10)(51,"div",11)(52,"div")(53,"p",12),a(54,"Total Promesas"),t(),e(55,"p",13),a(56),b(57,"number"),t(),e(58,"p",29),a(59),t()(),e(60,"div",30),l(61,"lucide-angular",31),t()()(),e(62,"div",10)(63,"div",11)(64,"div")(65,"p",12),a(66,"Cumplidas"),t(),e(67,"p",17),a(68),b(69,"number"),t()(),e(70,"div",19),l(71,"lucide-angular",32),t()()(),e(72,"div",10)(73,"div",11)(74,"div")(75,"p",12),a(76,"Vencidas"),t(),e(77,"p",25),a(78),b(79,"number"),t()(),e(80,"div",27),l(81,"lucide-angular",33),t()()(),e(82,"div",10)(83,"div",11)(84,"div")(85,"p",12),a(86,"Tasa Cumplimiento"),t(),e(87,"p",34),a(88),b(89,"number"),t()(),e(90,"div",35),l(91,"lucide-angular",36),t()()()(),e(92,"div",37)(93,"div",10)(94,"h3",38),l(95,"lucide-angular",39),a(96," Estado de Conciliaci\xF3n "),t(),e(97,"div",40),v(98,xe,1,3,"canvas",41),t(),e(99,"div",42)(100,"div",43),l(101,"div",44),e(102,"span",45),a(103,"Conciliados"),t()(),e(104,"div",43),l(105,"div",46),e(106,"span",45),a(107,"Voluntarios"),t()(),e(108,"div",43),l(109,"div",47),e(110,"span",45),a(111,"Sin Verificar"),t()()()(),e(112,"div",10)(113,"h3",38),l(114,"lucide-angular",48),a(115," Estado de Promesas "),t(),e(116,"div",40),v(117,he,1,3,"canvas",41),t(),e(118,"div",42)(119,"div",43),l(120,"div",44),e(121,"span",45),a(122,"Cumplidas"),t()(),e(123,"div",43),l(124,"div",49),e(125,"span",45),a(126,"Pendientes"),t()(),e(127,"div",43),l(128,"div",47),e(129,"span",45),a(130,"Vencidas"),t()()()()(),e(131,"div",37)(132,"div",10)(133,"h3",38),l(134,"lucide-angular",50),a(135," Tendencia de Pagos (\xDAltimos 30 d\xEDas) "),t(),e(136,"div",51),v(137,fe,1,3,"canvas",41),t()(),e(138,"div",10)(139,"h3",38),l(140,"lucide-angular",52),a(141," Top Agentes por Monto "),t(),e(142,"div",53),R(143,ve,14,11,"div",54,ue,!1,Ce,4,1,"div",55),t()()(),e(146,"div",10)(147,"h3",38),l(148,"lucide-angular",56),a(149," Distribuci\xF3n por Banco "),t(),e(150,"div",51),v(151,ye,1,3,"canvas",41),t()()),r&2){let c,i,p,m,d,y,k,x,S,_,B,w,P,M,O,s=h();n(7),g(f(8,33,(c=s.dashboard())==null?null:c.totalPagosBanco)),n(3),g(s.formatCurrency((i=s.dashboard())==null?null:i.montoTotalBanco)),n(2),u("size",24),n(7),g(f(20,35,(p=s.dashboard())==null?null:p.pagosConciliados)),n(3),g(s.formatCurrency((m=s.dashboard())==null?null:m.montoConciliado)),n(2),u("size",24),n(7),g(f(32,37,(d=s.dashboard())==null?null:d.pagosPorFuera)),n(3),g(s.formatCurrency((y=s.dashboard())==null?null:y.montoPorFuera)),n(2),u("size",24),n(7),g(f(44,39,(k=s.dashboard())==null?null:k.pagosNoVerificados)),n(3),g(s.formatCurrency((x=s.dashboard())==null?null:x.montoNoVerificado)),n(2),u("size",24),n(8),g(f(57,41,(S=s.dashboard())==null?null:S.totalPromesas)),n(3),g(s.formatCurrency((_=s.dashboard())==null?null:_.montoPrometido)),n(2),u("size",24),n(7),g(f(69,43,(B=s.dashboard())==null?null:B.promesasCumplidas)),n(3),u("size",24),n(7),g(f(79,45,(w=s.dashboard())==null?null:w.promesasVencidas)),n(3),u("size",24),n(6),T(s.getTasaClass(((P=s.dashboard())==null?null:P.tasaCumplimiento)||0)),n(),E(" ",A(89,47,(M=s.dashboard())==null?null:M.tasaCumplimiento,"1.1-1"),"% "),n(3),u("size",24),n(4),u("size",20),n(3),C(s.chartKey()?98:-1),n(16),u("size",20),n(3),C(s.chartKey()?117:-1),n(17),u("size",20),n(3),C(s.chartKey()?137:-1),n(3),u("size",20),n(3),L((O=s.dashboard())==null?null:O.topAgentes),n(5),u("size",20),n(3),C(s.chartKey()?151:-1)}}ee.register(X,te,Q,ae,Y,ie,ne,le,de,oe,re);var je=(()=>{let o=class o{constructor(i,p){this.dashboardService=i,this.themeService=p,this.dashboard=z(null),this.loading=z(!0),this.error=z(null),this.chartKey=D(()=>this.themeService.isDarkMode()?"dark":"light"),this.doughnutChartOptions=D(()=>{let m=this.themeService.isDarkMode(),d=m?"#e2e8f0":"#1f2937";return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:m?"#1e293b":"#ffffff",titleColor:d,bodyColor:d,borderColor:m?"#334155":"#d1d5db",borderWidth:1,callbacks:{label:x=>{let S=x.parsed||0,_=x.dataset.data.reduce((w,P)=>w+P,0),B=_>0?(S/_*100).toFixed(1):"0";return`${x.label}: ${S} (${B}%)`}}}}}}),this.lineChartOptions=D(()=>{let m=this.themeService.isDarkMode(),d=m?"#e2e8f0":"#1f2937";return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{color:d}},tooltip:{backgroundColor:m?"#1e293b":"#ffffff",titleColor:d,bodyColor:d,borderColor:m?"#334155":"#d1d5db",borderWidth:1}},scales:{y:{beginAtZero:!0,grid:{color:m?"rgba(148, 163, 184, 0.2)":"rgba(107, 114, 128, 0.3)"},ticks:{color:d}},x:{grid:{display:!1},ticks:{color:d}}}}}),this.barChartOptions=D(()=>{let m=this.themeService.isDarkMode(),d=m?"#e2e8f0":"#1f2937";return{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1},tooltip:{backgroundColor:m?"#1e293b":"#ffffff",titleColor:d,bodyColor:d,borderColor:m?"#334155":"#d1d5db",borderWidth:1}},scales:{x:{beginAtZero:!0,grid:{color:m?"rgba(148, 163, 184, 0.2)":"rgba(107, 114, 128, 0.3)"},ticks:{color:d}},y:{grid:{display:!1},ticks:{color:d}}}}}),this.conciliacionChartData={labels:[],datasets:[]},this.promesasChartData={labels:[],datasets:[]},this.tendenciaChartData={labels:[],datasets:[]},this.bancosChartData={labels:[],datasets:[]}}ngOnInit(){this.loadDashboard(),this.startPolling()}ngOnDestroy(){this.pollingSubscription?.unsubscribe()}loadDashboard(){this.loading.set(!0),this.error.set(null),this.dashboardService.getDashboard().subscribe({next:i=>{this.dashboard.set(i),this.updateCharts(i),this.loading.set(!1)},error:i=>{console.error("[DASHBOARD] Error cargando dashboard:",i),this.error.set("Error al cargar el dashboard. Intente nuevamente."),this.loading.set(!1)}})}startPolling(){this.pollingSubscription=j(6e4).pipe(V(()=>this.dashboardService.getDashboard())).subscribe({next:i=>{this.dashboard.set(i),this.updateCharts(i)},error:i=>console.error("[DASHBOARD] Error en polling:",i)})}updateCharts(i){this.conciliacionChartData={labels:["Conciliados","Voluntarios","Sin Verificar"],datasets:[{data:[i.pagosConciliados,i.pagosPorFuera,i.pagosNoVerificados],backgroundColor:["#22c55e","#f59e0b","#ef4444"],borderWidth:0}]},this.promesasChartData={labels:["Cumplidas","Pendientes","Vencidas"],datasets:[{data:[i.promesasCumplidas,i.promesasPendientes,i.promesasVencidas],backgroundColor:["#22c55e","#3b82f6","#ef4444"],borderWidth:0}]};let p=[...i.tendenciaDiaria||[]].reverse().slice(-15);this.tendenciaChartData={labels:p.map(d=>this.formatDate(d.fecha)),datasets:[{label:"Banco",data:p.map(d=>d.cantidadBanco),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.4},{label:"Agente",data:p.map(d=>d.cantidadAgente),borderColor:"#22c55e",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0,tension:.4}]};let m=i.distribucionBancos||[];this.bancosChartData={labels:m.map(d=>d.banco||"OTRO"),datasets:[{data:m.map(d=>d.monto),backgroundColor:["#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef"],borderWidth:0}]}}formatCurrency(i){return i==null?"S/ 0.00":"S/ "+i.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})}formatDate(i){if(!i)return"";let p=i.split(/[\/\-]/);return p.length>=2?`${p[0]}/${p[1]}`:i}getTasaClass(i){return i>=70?"text-green-600 dark:text-green-400":i>=40?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}};o.\u0275fac=function(p){return new(p||o)(I(me),I(J))},o.\u0275cmp=$({type:o,selectors:[["app-payments-dashboard"]],decls:11,vars:2,consts:[[1,"min-h-screen","bg-gray-50","dark:bg-slate-900","p-6"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white","flex","items-center","gap-3"],[1,"w-10","h-10","bg-gradient-to-br","from-blue-500","to-indigo-600","rounded-xl","flex","items-center","justify-center"],["name","bar-chart-3",1,"text-white",3,"size"],[1,"text-gray-500","dark:text-gray-400","mt-1"],[1,"flex","items-center","justify-center","h-64"],[1,"bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-800","rounded-lg","p-4","text-red-700","dark:text-red-300"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-500"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4","mb-6"],[1,"bg-white","dark:bg-slate-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-slate-700","p-5"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white"],[1,"text-sm","text-blue-600","dark:text-blue-400","font-medium"],[1,"w-12","h-12","bg-blue-100","dark:bg-blue-900/30","rounded-full","flex","items-center","justify-center"],["name","building-2",1,"text-blue-600","dark:text-blue-400",3,"size"],[1,"text-2xl","font-bold","text-green-600","dark:text-green-400"],[1,"text-sm","text-green-600","dark:text-green-400","font-medium"],[1,"w-12","h-12","bg-green-100","dark:bg-green-900/30","rounded-full","flex","items-center","justify-center"],["name","check-circle",1,"text-green-600","dark:text-green-400",3,"size"],[1,"text-2xl","font-bold","text-amber-600","dark:text-amber-400"],[1,"text-sm","text-amber-600","dark:text-amber-400","font-medium"],[1,"w-12","h-12","bg-amber-100","dark:bg-amber-900/30","rounded-full","flex","items-center","justify-center"],["name","user-check",1,"text-amber-600","dark:text-amber-400",3,"size"],[1,"text-2xl","font-bold","text-red-600","dark:text-red-400"],[1,"text-sm","text-red-600","dark:text-red-400","font-medium"],[1,"w-12","h-12","bg-red-100","dark:bg-red-900/30","rounded-full","flex","items-center","justify-center"],["name","alert-triangle",1,"text-red-600","dark:text-red-400",3,"size"],[1,"text-sm","text-indigo-600","dark:text-indigo-400","font-medium"],[1,"w-12","h-12","bg-indigo-100","dark:bg-indigo-900/30","rounded-full","flex","items-center","justify-center"],["name","handshake",1,"text-indigo-600","dark:text-indigo-400",3,"size"],["name","badge-check",1,"text-green-600","dark:text-green-400",3,"size"],["name","clock",1,"text-red-600","dark:text-red-400",3,"size"],[1,"text-2xl","font-bold"],[1,"w-12","h-12","bg-purple-100","dark:bg-purple-900/30","rounded-full","flex","items-center","justify-center"],["name","trending-up",1,"text-purple-600","dark:text-purple-400",3,"size"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-6"],[1,"text-lg","font-semibold","text-gray-800","dark:text-white","mb-4","flex","items-center","gap-2"],["name","pie-chart",1,"text-blue-500",3,"size"],[1,"h-64","flex","items-center","justify-center"],["baseChart","",3,"type","data","options"],[1,"mt-4","flex","flex-wrap","justify-center","gap-4"],[1,"flex","items-center","gap-2"],[1,"w-3","h-3","rounded-full","bg-green-500"],[1,"text-sm","text-gray-600","dark:text-gray-400"],[1,"w-3","h-3","rounded-full","bg-amber-500"],[1,"w-3","h-3","rounded-full","bg-red-500"],["name","target",1,"text-indigo-500",3,"size"],[1,"w-3","h-3","rounded-full","bg-blue-500"],["name","trending-up",1,"text-green-500",3,"size"],[1,"h-64"],["name","trophy",1,"text-yellow-500",3,"size"],[1,"space-y-3","max-h-72","overflow-y-auto"],[1,"flex","items-center","gap-3","p-3","rounded-lg","bg-gray-50","dark:bg-slate-700/50"],[1,"text-center","py-8","text-gray-500","dark:text-gray-400"],["name","landmark",1,"text-blue-500",3,"size"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","text-sm","font-bold"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-gray-800","dark:text-white","truncate"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-right"],[1,"text-sm","font-bold","text-green-600","dark:text-green-400"],["name","users",1,"mx-auto","mb-2","opacity-50",3,"size"]],template:function(p,m){p&1&&(e(0,"div",0)(1,"div",1)(2,"h1",2)(3,"div",3),l(4,"lucide-angular",4),t(),a(5," Dashboard de Pagos y Conciliaci\xF3n "),t(),e(6,"p",5),a(7,"M\xE9tricas consolidadas de pagos bancarios, agentes y promesas"),t()(),v(8,ge,2,0,"div",6)(9,be,2,1,"div",7)(10,ke,152,50),t()),p&2&&(n(4),u("size",24),n(4),C(m.loading()?8:m.error()?9:10))},dependencies:[H,q,Z,se,W],styles:["[_nghost-%COMP%]{display:block}"]});let r=o;return r})();export{je as PaymentsDashboardComponent};
