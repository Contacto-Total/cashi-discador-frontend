import{A as he,B as xe,E as Q,b as se,c as H,f as J,k as Y,m as G,s as ce,t as pe,u as ue,v as me,w as K,x as ge,y as _e,z as fe}from"./chunk-YEUR475X.js";import{a as D}from"./chunk-YQKVMPSG.js";import{Fb as oe,Gb as h,Gc as de,Hb as x,Hc as U,I as P,Ib as re,Ic as W,Jb as ae,Kb as v,Lb as $,Lc as te,Mb as y,Mc as q,Nb as c,Ob as d,Pb as ee,Wb as C,Yb as S,_b as a,a as E,aa as O,bb as p,da as N,ha as L,kc as I,ld as z,mc as g,nc as A,oa as _,ob as B,oc as R,pa as f,pc as le,r as V,rc as b,sc as w,sd as T,tc as F,td as j,wb as Z,ya as k}from"./chunk-QOPKCBWK.js";var be=(o,l)=>l.field,we=(o,l)=>l.numeroCuota;function Fe(o,l){if(o&1){let n=C();c(0,"button",7),S("click",function(){let t=_(n).$implicit,i=a();return f(i.selectAmount(t.value,t.field))}),c(1,"span",8),g(2),d(),c(3,"span",9),g(4),d()()}if(o&2){let n=l.$implicit,e=a();I("selected",e.selectedField()===n.field&&!e.isCustomAmount()),p(2),A(n.label),p(2),A(e.formatCurrency(n.value))}}function Me(o,l){if(o&1){let n=C();c(0,"input",12),F("ngModelChange",function(t){_(n);let i=a(2);return w(i.customAmountValue,t)||(i.customAmountValue=t),f(t)}),S("ngModelChange",function(t){_(n);let i=a(2);return f(i.onCustomAmountChange(t))})("click",function(t){return _(n),f(t.stopPropagation())}),d()}if(o&2){let n=a(2);b("ngModel",n.customAmountValue)}}function De(o,l){if(o&1){let n=C();c(0,"button",10),S("click",function(){_(n);let t=a();return f(t.enableCustomAmount())}),c(1,"span",8),g(2,"Otro monto"),d(),h(3,Me,1,1,"input",11),d()}if(o&2){let n=a();I("selected",n.isCustomAmount()),p(3),x(n.isCustomAmount()?3:-1)}}function ke(o,l){if(o&1){let n=C();c(0,"button",15),S("click",function(){let t=_(n).$implicit,i=a(2);return f(i.setInstallments(t))}),g(1),d()}if(o&2){let n=l.$implicit,e=a(2);I("selected",e.numberOfInstallments()===n),p(),le(" ",n," ",n===1?"cuota":"cuotas"," ")}}function Se(o,l){if(o&1&&(c(0,"div",1)(1,"label",2)(2,"span",3),g(3,"\u{1F4C5}"),d(),g(4," N\xFAmero de Cuotas "),d(),c(5,"div",13),v(6,ke,2,4,"button",14,ae),d()()),o&2){let n=a();p(6),$(n.installmentOptions)}}function ve(o,l){if(o&1){let n=C();c(0,"div",17)(1,"div",21),g(2),d(),c(3,"div",22)(4,"label"),g(5,"Monto:"),d(),c(6,"input",23),F("ngModelChange",function(t){let i=_(n).$implicit;return w(i.monto,t)||(i.monto=t),f(t)}),S("ngModelChange",function(){_(n);let t=a(2);return f(t.onInstallmentChange())}),d()(),c(7,"div",24)(8,"label"),g(9,"Fecha:"),d(),c(10,"input",25),F("ngModelChange",function(t){let i=_(n).$implicit;return w(i.fechaPago,t)||(i.fechaPago=t),f(t)}),S("ngModelChange",function(){_(n);let t=a(2);return f(t.onInstallmentChange())}),d()()()}if(o&2){let n=l.$implicit,e=a(2);p(2),R(" Cuota ",n.numeroCuota," "),p(4),b("ngModel",n.monto),p(4),b("ngModel",n.fechaPago),y("min",e.minDate)}}function $e(o,l){if(o&1&&(c(0,"div",19)(1,"span"),g(2,"Monto por cuota:"),d(),c(3,"span"),g(4),d()()),o&2){let n=a(2);p(4),A(n.formatCurrency(n.amountPerInstallment()))}}function Te(o,l){if(o&1&&(c(0,"div",1)(1,"label",2)(2,"span",3),g(3,"\u{1F4CB}"),d(),g(4," Detalle del Cronograma "),d(),c(5,"div",16),v(6,ve,11,4,"div",17,we),d(),c(8,"div",18)(9,"div",19)(10,"span"),g(11,"Monto Total:"),d(),c(12,"span",20),g(13),d()(),h(14,$e,5,1,"div",19),d()()),o&2){let n=a();p(6),$(n.installments()),p(7),A(n.formatCurrency(n.totalAmount())),p(),x(n.numberOfInstallments()>1?14:-1)}}var Ce=(()=>{let l=class l{constructor(){this.availableAmounts=q([]),this.maxInstallments=6,this.scheduleChange=new Z,this.customAmountSelected=new Z,this.selectedAmount=k(0),this.selectedField=k(void 0),this.numberOfInstallments=k(1),this.installments=k([]),this.customAmountValue=0,this._isCustomAmount=k(!1),this.amountOptions=U(()=>this.availableAmounts()),this.regularAmountOptions=U(()=>this.availableAmounts().filter(e=>e.field!=="personalizado")),this.hasCustomOption=U(()=>this.availableAmounts().some(e=>e.field==="personalizado")),this.totalAmount=U(()=>this.installments().reduce((e,t)=>e+(t.monto||0),0)),this.amountPerInstallment=U(()=>{let e=this.numberOfInstallments(),t=this.selectedAmount();return e>0?t/e:0}),this.installmentOptions=[],this.minDate=""}ngOnInit(){this.installmentOptions=Array.from({length:this.maxInstallments},(t,i)=>i+1);let e=new Date;this.minDate=e.toISOString().split("T")[0]}isCustomAmount(){return this._isCustomAmount()}selectAmount(e,t){this._isCustomAmount.set(!1),this.selectedAmount.set(e),this.selectedField.set(t),this.generateInstallments(),this.customAmountSelected.emit(!1)}enableCustomAmount(){this._isCustomAmount.set(!0),this.selectedField.set(void 0),this.customAmountSelected.emit(!0),this.customAmountValue>0&&(this.selectedAmount.set(this.customAmountValue),this.generateInstallments())}onCustomAmountChange(e){this.customAmountValue=e,this.selectedAmount.set(e),this.generateInstallments()}setInstallments(e){this.numberOfInstallments.set(e),this.generateInstallments()}generateInstallments(){let e=this.selectedAmount(),t=this.numberOfInstallments();if(e<=0||t<=0){this.installments.set([]),this.emitChange();return}let i=Math.floor(e/t*100)/100,r=Math.round((e-i*t)*100)/100,s=[],m=new Date;for(let u=0;u<t;u++){let M=new Date(m);M.setDate(M.getDate()+30*(u+1));let X=u===t-1?i+r:i;s.push({numeroCuota:u+1,monto:X,fechaPago:M.toISOString().split("T")[0]})}this.installments.set(s),this.emitChange()}onInstallmentChange(){this.emitChange()}emitChange(){let e=this.installments();if(e.length===0){this.scheduleChange.emit(null);return}let t={montoTotal:this.selectedAmount(),numeroCuotas:this.numberOfInstallments(),cuotas:e,campoMontoOrigen:this.selectedField()};this.scheduleChange.emit(t)}formatCurrency(e){return new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(e)}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=B({type:l,selectors:[["app-payment-schedule"]],inputs:{availableAmounts:[1,"availableAmounts"],maxInstallments:"maxInstallments"},outputs:{scheduleChange:"scheduleChange",customAmountSelected:"customAmountSelected"},decls:12,vars:3,consts:[[1,"payment-schedule-container"],[1,"field-group"],[1,"field-label"],[1,"label-icon"],[1,"amount-chips"],["type","button",1,"amount-chip",3,"selected"],["type","button",1,"amount-chip","custom",3,"selected"],["type","button",1,"amount-chip",3,"click"],[1,"chip-label"],[1,"chip-value"],["type","button",1,"amount-chip","custom",3,"click"],["type","number","placeholder","0.00","min","0","step","0.01",1,"custom-input",3,"ngModel"],["type","number","placeholder","0.00","min","0","step","0.01",1,"custom-input",3,"ngModelChange","click","ngModel"],[1,"installments-selector"],["type","button",1,"installment-btn",3,"selected"],["type","button",1,"installment-btn",3,"click"],[1,"installments-detail"],[1,"installment-row"],[1,"schedule-summary"],[1,"summary-row"],[1,"total-amount"],[1,"installment-number"],[1,"installment-amount"],["type","number","min","0","step","0.01",1,"amount-input",3,"ngModelChange","ngModel"],[1,"installment-date"],["type","date",1,"date-input",3,"ngModelChange","ngModel","min"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"div",1)(2,"label",2)(3,"span",3),g(4,"\u{1F4B0}"),d(),g(5," Seleccionar Monto "),d(),c(6,"div",4),v(7,Fe,5,4,"button",5,be),h(9,De,4,3,"button",6),d()(),h(10,Se,8,0,"div",1),h(11,Te,15,2,"div",1),d()),t&2&&(p(7),$(i.regularAmountOptions()),p(2),x(i.hasCustomOption()?9:-1),p(),x(i.selectedAmount()>0?10:-1),p(),x(i.installments().length>0?11:-1))},dependencies:[z,Q,H,G,J,K,Y],styles:[".payment-schedule-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;padding:1rem;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}.field-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.field-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;color:#334155;font-size:.875rem}.label-icon[_ngcontent-%COMP%]{font-size:1rem}.amount-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.amount-chip[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:.75rem 1rem;border:2px solid #e2e8f0;border-radius:8px;background:#fff;cursor:pointer;transition:all .2s;min-width:120px}.amount-chip[_ngcontent-%COMP%]:hover{border-color:#3b82f6;background:#eff6ff}.amount-chip.selected[_ngcontent-%COMP%]{border-color:#3b82f6;background:#3b82f6;color:#fff}.amount-chip.custom[_ngcontent-%COMP%]{min-width:140px}.chip-label[_ngcontent-%COMP%]{font-size:.75rem;opacity:.8}.chip-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:600}.custom-input[_ngcontent-%COMP%]{width:100%;padding:.25rem;border:1px solid white;border-radius:4px;text-align:center;font-size:.875rem;margin-top:.25rem;background:#ffffffe6;color:#1e293b}.installments-selector[_ngcontent-%COMP%]{display:flex;gap:.5rem}.installment-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:2px solid #e2e8f0;border-radius:8px;background:#fff;cursor:pointer;transition:all .2s;font-size:.875rem}.installment-btn[_ngcontent-%COMP%]:hover{border-color:#10b981;background:#ecfdf5}.installment-btn.selected[_ngcontent-%COMP%]{border-color:#10b981;background:#10b981;color:#fff}.installments-detail[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;background:#fff;padding:1rem;border-radius:8px;border:1px solid #e2e8f0}.installment-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:80px 1fr 1fr;gap:1rem;align-items:center;padding:.5rem;border-bottom:1px solid #f1f5f9}.installment-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.installment-number[_ngcontent-%COMP%]{font-weight:600;color:#3b82f6;font-size:.875rem}.installment-amount[_ngcontent-%COMP%], .installment-date[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.installment-amount[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .installment-date[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b;min-width:45px}.amount-input[_ngcontent-%COMP%], .date-input[_ngcontent-%COMP%]{flex:1;padding:.5rem;border:1px solid #e2e8f0;border-radius:6px;font-size:.875rem}.amount-input[_ngcontent-%COMP%]:focus, .date-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.schedule-summary[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background:#f0fdf4;border-radius:8px;border:1px solid #bbf7d0}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:.875rem;color:#166534}.total-amount[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:700}@media (max-width: 640px){.installment-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:.5rem}.amount-chips[_ngcontent-%COMP%]{flex-direction:column}.amount-chip[_ngcontent-%COMP%]{width:100%}}"]});let o=l;return o})();var ie=(o,l)=>l.id,Ve=(o,l)=>l.value,Pe=(o,l)=>l.value||l;function Ae(o,l){o&1&&(c(0,"span",6),g(1,"*"),d())}function Ee(o,l){if(o&1&&(c(0,"p",7),g(1),d()),o&2){let n=a().$implicit;p(),A(n.helpText)}}function Re(o,l){if(o&1){let n=C();c(0,"input",21),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);b("ngModel",e.fieldData()[n.id]),y("placeholder",n.placeholder||"")("required",n.required??!1)("minlength",n.minLength??null)("maxlength",n.maxLength??null)}}function qe(o,l){if(o&1){let n=C();c(0,"input",22),S("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return f(r.updateFieldValue(i.id,t))}),d()}if(o&2){let n=a().$implicit,e=a(2);y("ngModel",e.fieldData()[n.id])("placeholder",n.placeholder||"")("required",n.required??!1)("min",n.min??null)("max",n.max??null)}}function Oe(o,l){if(o&1){let n=C();c(0,"div",10)(1,"span",23),g(2,"S/"),d(),c(3,"input",24),S("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return f(r.updateFieldValue(i.id,t))}),d()()}if(o&2){let n=a().$implicit,e=a(2);p(3),y("ngModel",e.fieldData()[n.id])("placeholder",n.placeholder||"0.00")("required",n.required??!1)("min",n.min||0)}}function Ie(o,l){if(o&1){let n=C();c(0,"input",25),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);b("ngModel",e.fieldData()[n.id]),y("required",n.required??!1)}}function Ue(o,l){if(o&1){let n=C();c(0,"input",26),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);b("ngModel",e.fieldData()[n.id]),y("required",n.required??!1)}}function We(o,l){if(o&1&&(c(0,"option",29),g(1),d()),o&2){let n=l.$implicit;y("value",n.value),p(),A(n.label)}}function Ne(o,l){if(o&1){let n=C();c(0,"select",27),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),c(1,"option",28),g(2,"-- Seleccionar --"),d(),v(3,We,2,2,"option",29,Ve),d()}if(o&2){let n=a().$implicit,e=a(2);b("ngModel",e.fieldData()[n.id]),y("required",n.required??!1),p(3),$(n.options)}}function Le(o,l){if(o&1){let n=C();c(0,"textarea",30),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);b("ngModel",e.fieldData()[n.id]),y("placeholder",n.placeholder||"")("required",n.required??!1)("minlength",n.minLength??null)("maxlength",n.maxLength??null)}}function Be(o,l){if(o&1){let n=C();c(0,"div",15)(1,"input",31),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d(),c(2,"span",32),g(3),d()()}if(o&2){let n=a().$implicit,e=a(2);p(),b("ngModel",e.fieldData()[n.id]),y("required",n.required??!1),p(2),A(n.placeholder||"Marcar si aplica")}}function ze(o,l){if(o&1){let n=C();c(0,"div",10)(1,"span",23),g(2,"\u{1F4F1}"),d(),c(3,"input",33),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()()}if(o&2){let n=a().$implicit,e=a(2);p(3),b("ngModel",e.fieldData()[n.id]),y("placeholder",n.placeholder||"999 999 999")("required",n.required??!1)}}function je(o,l){if(o&1){let n=C();c(0,"input",34),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);b("ngModel",e.fieldData()[n.id]),y("required",n.required??!1)}}function He(o,l){if(o&1){let n=C();c(0,"input",35),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);b("ngModel",e.fieldData()[n.id]),y("placeholder",n.placeholder||"ejemplo@correo.com")("required",n.required??!1)}}function Je(o,l){if(o&1){let n=C();c(0,"input",36),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a(2);return w(r.fieldData()[i.id],t)||(r.fieldData()[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a(2);b("ngModel",e.fieldData()[n.id]),y("placeholder",n.placeholder||"https://ejemplo.com")("required",n.required??!1)}}function Ye(o,l){if(o&1){let n=C();c(0,"app-payment-schedule",37),S("scheduleChange",function(t){_(n);let i=a().$implicit,r=a(2);return f(r.onPaymentScheduleChange(i.id,t))})("customAmountSelected",function(t){_(n);let i=a(3);return f(i.onCustomAmountSelected(t))}),d()}if(o&2){let n=a().$implicit,e=a(2);y("availableAmounts",e.getPaymentAmountOptions(n))("maxInstallments",6)}}function Ge(o,l){o&1&&(c(0,"span",46),g(1,"*"),d())}function Ke(o,l){if(o&1&&(c(0,"th",41),g(1),h(2,Ge,2,0,"span",46),d()),o&2){let n=l.$implicit;p(),R(" ",n.label," "),p(),x(n.required?2:-1)}}function Qe(o,l){o&1&&ee(0,"th",42)}function Xe(o,l){if(o&1&&(c(0,"div",49),g(1),d()),o&2){let n=a(2).$index;p(),R(" ",n+1," ")}}function Ze(o,l){if(o&1){let n=C();c(0,"input",56),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return w(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;b("ngModel",e[n.id]),y("required",n.required??!1)}}function et(o,l){if(o&1){let n=C();c(0,"input",57),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return w(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;b("ngModel",e[n.id]),y("required",n.required??!1)}}function tt(o,l){if(o&1){let n=C();c(0,"div",10)(1,"span",58),g(2,"S/"),d(),c(3,"input",59),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return w(r[i.id],t)||(r[i.id]=t),f(t)}),d()()}if(o&2){let n=a().$implicit,e=a().$implicit;p(3),b("ngModel",e[n.id]),y("required",n.required??!1)}}function nt(o,l){if(o&1){let n=C();c(0,"input",60),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return w(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit,t=a(4);b("ngModel",e[n.id]),y("required",n.required??!1)("min",t.getMinDate(n))("max",t.getMaxDate(n))}}function it(o,l){if(o&1){let n=C();c(0,"input",61),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return w(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;b("ngModel",e[n.id]),y("required",n.required??!1)}}function ot(o,l){if(o&1){let n=C();c(0,"input",62),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return w(r[i.id],t)||(r[i.id]=t),f(t)}),d()}if(o&2){let n=a().$implicit,e=a().$implicit;b("ngModel",e[n.id]),y("required",n.required??!1)}}function rt(o,l){if(o&1&&(c(0,"option",29),g(1),d()),o&2){let n=l.$implicit;y("value",n.value||n),p(),R(" ",n.label||n," ")}}function at(o,l){if(o&1){let n=C();c(0,"select",63),F("ngModelChange",function(t){_(n);let i=a().$implicit,r=a().$implicit;return w(r[i.id],t)||(r[i.id]=t),f(t)}),c(1,"option",28),g(2,"Seleccionar..."),d(),v(3,rt,2,2,"option",29,Pe),d()}if(o&2){let n=a().$implicit,e=a().$implicit;b("ngModel",e[n.id]),y("required",n.required??!1),p(3),$(n.options)}}function lt(o,l){if(o&1&&(c(0,"td",47),h(1,Xe,2,1,"div",49)(2,Ze,1,2,"input",50)(3,et,1,2,"input",51)(4,tt,4,2,"div",10)(5,nt,1,4,"input",52)(6,it,1,2,"input",53)(7,ot,1,2,"input",54)(8,at,5,2,"select",55),d()),o&2){let n=l.$implicit;p(),x(n.type==="auto-number"?1:n.type==="text"?2:n.type==="number"?3:n.type==="currency"?4:n.type==="date"?5:n.type==="time"?6:n.type==="phone"?7:n.type==="select"?8:-1)}}function dt(o,l){if(o&1){let n=C();c(0,"td",48)(1,"button",64),S("click",function(){_(n);let t=a().$index,i=a(2).$implicit,r=a(2);return f(r.removeTableRow(i.id,t))}),d()()}}function st(o,l){if(o&1&&(c(0,"tr",44),v(1,lt,9,1,"td",47,ie),h(3,dt,2,0,"td",48),d()),o&2){let n=a(2).$implicit;p(),$(n.columns),p(2),x(n.allowDeleteRow?3:-1)}}function ct(o,l){if(o&1&&(c(0,"tr")(1,"td",65)(2,"div",66),ee(3,"div",67),c(4,"p",68),g(5,"No hay registros en la tabla"),d(),c(6,"p",69),g(7,'Haz clic en "Agregar Fila" para comenzar'),d()()()()),o&2){let n=a(2).$implicit;p(),oe("colspan",n.columns.length+(n.allowDeleteRow?1:0))}}function pt(o,l){if(o&1){let n=C();c(0,"div",45)(1,"button",70),S("click",function(){_(n);let t=a(2).$implicit,i=a(2);return f(i.addTableRow(t.id,t.columns||[]))}),g(2," Agregar Fila "),d()()}}function ut(o,l){if(o&1&&(c(0,"div",20)(1,"div",38)(2,"table",39)(3,"thead")(4,"tr",40),v(5,Ke,3,2,"th",41,ie),h(7,Qe,1,0,"th",42),d()(),c(8,"tbody",43),v(9,st,4,1,"tr",44,re),h(11,ct,8,1,"tr"),d()()(),h(12,pt,3,0,"div",45),d()),o&2){let n=a().$implicit,e=a(2);p(5),$(n.columns),p(2),x(n.allowDeleteRow?7:-1),p(2),$(e.getTableRows(n.id)),p(2),x(e.getTableRows(n.id).length===0?11:-1),p(),x(n.allowAddRow&&(!n.maxRows||e.getTableRows(n.id).length<n.maxRows)?12:-1)}}function mt(o,l){if(o&1&&(c(0,"div")(1,"label",5),g(2),h(3,Ae,2,0,"span",6),d(),h(4,Ee,2,1,"p",7),h(5,Re,1,5,"input",8),h(6,qe,1,5,"input",9),h(7,Oe,4,4,"div",10),h(8,Ie,1,2,"input",11),h(9,Ue,1,2,"input",12),h(10,Ne,5,2,"select",13),h(11,Le,1,5,"textarea",14),h(12,Be,4,3,"div",15),h(13,ze,4,3,"div",10),h(14,je,1,2,"input",16),h(15,He,1,3,"input",17),h(16,Je,1,3,"input",18),h(17,Ye,1,2,"app-payment-schedule",19),h(18,ut,13,3,"div",20),d()),o&2){let n=l.$implicit;I("md:col-span-2",n.type==="table"||n.type==="textarea"||n.type==="payment_schedule"),p(2),R(" ",n.label," "),p(),x(n.required?3:-1),p(),x(n.helpText?4:-1),p(),x(n.type==="text"?5:-1),p(),x(n.type==="number"?6:-1),p(),x(n.type==="currency"?7:-1),p(),x(n.type==="date"?8:-1),p(),x(n.type==="datetime"?9:-1),p(),x(n.type==="select"?10:-1),p(),x(n.type==="textarea"?11:-1),p(),x(n.type==="checkbox"?12:-1),p(),x(n.type==="phone"?13:-1),p(),x(n.type==="time"?14:-1),p(),x(n.type==="email"?15:-1),p(),x(n.type==="url"?16:-1),p(),x(n.type==="payment_schedule"?17:-1),p(),x(n.type==="table"?18:-1)}}function gt(o,l){if(o&1&&(c(0,"div",0)(1,"div",1)(2,"h3",2),g(3,"Campos Adicionales"),d()(),c(4,"div",3),v(5,mt,19,19,"div",4,ie),d()()),o&2){let n=a();p(5),$(n.schema().fields)}}var vt=(()=>{let l=class l{constructor(){this.schema=q(null),this.externalUpdates=q({}),this.selectedClassification=q(null),this.customerAmounts=q([]),this.fieldData=k({}),this.dataChange=te(),this.customAmountDetected=te(),W(()=>{let e=this.schema();if(e&&e.fields){console.log("[DynamicFieldRenderer] Schema received with fields:",e.fields.map(i=>({id:i.id,type:i.type,label:i.label})));let t={};e.fields.forEach(i=>{if(console.log(`[DynamicFieldRenderer] Processing field: ${i.id}, type: ${i.type}`),i.type==="table"){let r=i.minRows||0;t[i.id]=Array.from({length:r},()=>this.createEmptyTableRow(i.columns||[]))}else i.type==="checkbox"?t[i.id]=!1:i.type==="payment_schedule"?t[i.id]=null:t[i.id]=""}),this.fieldData.set(t)}}),W(()=>{let e=this.externalUpdates();if(e&&Object.keys(e).length>0){console.log("[DynamicField] Received external updates:",e);let t=de(()=>E({},this.fieldData())),i=!1;Object.keys(e).forEach(r=>{e[r]!==void 0&&e[r]!==null&&t[r]!==e[r]&&(t[r]=e[r],i=!0)}),i?(console.log("[DynamicField] Applying updates to fieldData"),this.fieldData.set(t)):console.log("[DynamicField] No changes detected, skipping update")}}),W(()=>{let e=this.fieldData(),t=this.schema();if(!t?.fields)return;t.fields.filter(r=>r.type==="table"&&r.linkedToField).forEach(r=>{let s=r.linkedToField,m=e[s];if(console.log(`\u{1F517} Sincronizaci\xF3n n\xFAmero\u2192tabla: "${s}"=${m} \u2192 tabla="${r.id}"`),m&&typeof m=="number"&&m>0){let u=this.getTableRows(r.id),M=Math.floor(m);console.log(`   Filas actuales: ${u.length}, Filas objetivo: ${M}`),u.length!==M&&(console.log(`   \u2705 Ajustando tabla de ${u.length} a ${M} filas`),this.adjustTableRows(r.id,M,r.columns||[]))}})}),W(()=>{this.dataChange.emit(this.fieldData())})}updateFieldValue(e,t){let i=E({},this.fieldData());typeof t=="string"&&t!==""&&!isNaN(Number(t))?i[e]=Number(t):i[e]=t,this.fieldData.set(i),this.checkLinkedTables(e,i)}checkLinkedTables(e,t){let i=this.schema();if(!i?.fields)return;i.fields.filter(s=>s.type==="table"&&s.linkedToField===e).forEach(s=>{let m=t[e];if(m&&typeof m=="number"&&m>0){let u=this.getTableRows(s.id),M=Math.floor(m);u.length!==M&&this.adjustTableRows(s.id,M,s.columns||[])}})}getTableRows(e){let t=this.fieldData()[e];return Array.isArray(t)?t:[]}addTableRow(e,t){let i=E({},this.fieldData());Array.isArray(i[e])||(i[e]=[]);let r=this.createEmptyTableRow(t);i[e].push(r);let s=i[e].length;console.log(`\u2795 Tabla\u2192N\xFAmero: Agregada fila, total=${s}`),this.fieldData.set(i),this.updateLinkedFieldFromTable(e,s)}removeTableRow(e,t){let i=E({},this.fieldData());if(Array.isArray(i[e])){let r=i[e].length,s=this.selectedClassification();if(s?.codigo==="PF"){if(r<=2){alert("Los Pagos Fraccionados requieren m\xEDnimo 2 cuotas. No se puede eliminar m\xE1s filas.");return}}else if(s?.codigo==="CF"&&r<=1){alert("Los Convenios requieren m\xEDnimo 1 cuota. No se puede eliminar esta fila.");return}i[e].splice(t,1);let m=i[e].length;console.log(`\u2796 Tabla\u2192N\xFAmero: Eliminada fila, total=${m}`),this.fieldData.set(i),this.updateLinkedFieldFromTable(e,m)}}updateLinkedFieldFromTable(e,t){let i=this.schema();if(console.log(`\u{1F50D} updateLinkedFieldFromTable: tableFieldId="${e}", rowCount=${t}`),!i?.fields){console.log("   \u274C No hay schema o fields");return}let r=i.fields.find(M=>M.id===e);if(console.log("   Campo tabla encontrado:",r),!r||r.type!=="table"){console.log("   \u274C Campo no encontrado o no es tabla");return}let s=r.linkedToField;if(console.log(`   linkedToField="${s}"`),!s){console.log("   \u274C No hay linkedToField definido");return}let m=E({},this.fieldData()),u=m[s];console.log(`   Valor actual del campo vinculado: ${u}`),u!==t?(m[s]=t,this.fieldData.set(m),console.log(`   \u2705 Campo "${s}" actualizado: ${u} \u2192 ${t}`)):console.log(`   \u26A0\uFE0F El valor ya es ${t}, no se actualiza`)}adjustTableRows(e,t,i){let r=E({},this.fieldData());Array.isArray(r[e])||(r[e]=[]);let s=r[e],m=s.length;if(t>m)for(let u=m;u<t;u++)s.push(this.createEmptyTableRow(i));else t<m&&s.splice(t);this.fieldData.set(r)}getTodayDate(){let e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`}getEndOfMonthDate(){let e=new Date,t=e.getFullYear(),i=e.getMonth(),r=new Date(t,i+1,0).getDate(),s=String(i+1).padStart(2,"0"),m=String(r).padStart(2,"0");return`${t}-${s}-${m}`}getMinDate(e){let t=e.minDate;return t==="today"?this.getTodayDate():t}getMaxDate(e){return this.selectedClassification()?.codigo==="PF"?this.getEndOfMonthDate():e.maxDate}createEmptyTableRow(e){let t={};return e.forEach(i=>{i.type==="auto-number"?t[i.id]=null:i.type==="number"||i.type==="currency"?t[i.id]=i.defaultValue||0:(i.type,t[i.id]=i.defaultValue||"")}),t}getData(){return this.fieldData()}setData(e){this.fieldData.set(e)}getPaymentAmountOptions(e){let t=this.customerAmounts();return t&&t.length>0?(console.log("[DynamicFieldRenderer] Using customer amounts:",t),t):e.options&&e.options.length>0?e.options.map(i=>({label:i.label||String(i.value),value:typeof i.value=="number"?i.value:parseFloat(String(i.value))||0,field:i.field})):(console.log("[DynamicFieldRenderer] No customer amounts, using defaults"),[{label:"Sin datos de deuda",value:0,field:"default"}])}onPaymentScheduleChange(e,t){let i=E({},this.fieldData());i[e]=t,this.fieldData.set(i),console.log("[DynamicField] Payment schedule changed:",e,t)}onCustomAmountSelected(e){console.log("[DynamicField] Custom amount selected:",e),this.customAmountDetected.emit(e)}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=B({type:l,selectors:[["app-dynamic-field-renderer"]],inputs:{schema:[1,"schema"],externalUpdates:[1,"externalUpdates"],selectedClassification:[1,"selectedClassification"],customerAmounts:[1,"customerAmounts"]},outputs:{dataChange:"dataChange",customAmountDetected:"customAmountDetected"},decls:1,vars:1,consts:[[1,"bg-purple-50","dark:bg-purple-950/20","border","border-purple-200","dark:border-purple-900/50","rounded-lg","shadow-md","p-3"],[1,"flex","items-center","gap-2","text-purple-800","dark:text-purple-200","mb-3","pb-2","border-b","border-purple-200","dark:border-purple-800"],[1,"font-bold","text-xs","uppercase","tracking-wide"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[3,"md:col-span-2"],[1,"text-[11px]","font-bold","text-gray-800","dark:text-gray-100","mb-1","flex","items-center","gap-1"],[1,"text-red-500","text-xs"],[1,"text-[9px]","text-gray-500","dark:text-gray-400","mb-1","italic"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","min","max"],[1,"relative"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required","minlength","maxlength"],[1,"flex","items-center","gap-2"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModel","placeholder","required"],[3,"availableAmounts","maxInstallments"],[1,"rounded-lg","border","border-purple-200","dark:border-purple-800/50","overflow-hidden","shadow-sm"],["type","text",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","number",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min","max"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-gray-500","dark:text-gray-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","min"],["type","date",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","datetime-local",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["value",""],[3,"value"],["rows","2",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","resize-none","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required","minlength","maxlength"],["type","checkbox",1,"w-4","h-4","text-purple-600","bg-gray-100","dark:bg-gray-700","border-gray-300","dark:border-gray-600","rounded","focus:ring-purple-500","cursor-pointer",3,"ngModelChange","ngModel","required"],[1,"text-xs","text-gray-700","dark:text-gray-300"],["type","tel","pattern","[0-9]{9}","maxlength","9",1,"w-full","pl-7","pr-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","time",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","email",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],["type","url",1,"w-full","px-2","py-1.5","text-xs","border","border-gray-300","dark:border-gray-600","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-800","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","placeholder","required"],[3,"scheduleChange","customAmountSelected","availableAmounts","maxInstallments"],[1,"overflow-x-auto"],[1,"w-full","border-collapse"],[1,"bg-gradient-to-r","from-purple-50","to-purple-100","dark:from-purple-950/50","dark:to-purple-900/30"],[1,"px-3","py-2","text-left","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700"],[1,"px-3","py-2","text-center","text-[10px]","font-bold","text-purple-900","dark:text-purple-200","uppercase","tracking-wide","border-b-2","border-purple-300","dark:border-purple-700","w-16"],[1,"bg-white","dark:bg-slate-800"],[1,"border-b","border-purple-100","dark:border-purple-900/30","hover:bg-purple-50/50","dark:hover:bg-purple-950/20","transition-colors"],[1,"border-t","border-purple-300","dark:border-purple-700","p-2","from-purple-100/70","to-white","dark:from-purple-950/40","dark:to-purple-800/60"],[1,"text-red-500","ml-0.5"],[1,"px-3","py-2"],[1,"px-3","py-2","text-center"],[1,"flex","items-center","justify-center","w-7","h-7","rounded-full","bg-purple-100","dark:bg-purple-900/30","text-[11px]","font-bold","text-purple-700","dark:text-purple-300"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModel","required"],["type","text",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","number",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","text-[10px]","text-purple-600","dark:text-purple-400","font-semibold"],["type","number","step","0.01",1,"w-full","pl-6","pr-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","date",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required","min","max"],["type","time",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","tel","pattern","[0-9]{9}","maxlength","9","placeholder","999999999",1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],[1,"w-full","px-2","py-1","text-[11px]","border","border-purple-200","dark:border-purple-800","rounded","focus:ring-1","focus:ring-purple-500","focus:border-purple-500","bg-white","dark:bg-slate-900","text-gray-900","dark:text-gray-100",3,"ngModelChange","ngModel","required"],["type","button","title","Eliminar fila",1,"inline-flex","items-center","justify-center","w-7","h-7","rounded-full","hover:bg-red-50","dark:hover:bg-red-900/20","text-red-500","hover:text-red-700","dark:text-red-400","dark:hover:text-red-300","transition-colors",3,"click"],[1,"px-4","py-12","text-center"],[1,"flex","flex-col","items-center","gap-2"],[1,"w-12","h-12","rounded-full","bg-purple-100","dark:bg-purple-900/30","flex","items-center","justify-center"],[1,"text-[11px]","text-gray-500","dark:text-gray-400","font-medium"],[1,"text-[10px]","text-gray-400","dark:text-gray-500"],["type","button",1,"w-full","py-1.5","px-3","border","border-dashed","border-purple-400","dark:border-purple-600","rounded-lg","text-purple-900/50","dark:text-purple-300","hover:bg-purple-100","dark:hover:bg-purple-900/50","hover:border-purple-600","dark:hover:border-purple-400","transition-all","flex","items-center","justify-center","gap-2","text-[11px]","font-semibold",3,"click"]],template:function(t,i){t&1&&h(0,gt,7,0,"div",0),t&2&&x(i.schema()&&i.schema().fields&&i.schema().fields.length>0?0:-1)},dependencies:[z,Q,pe,ue,H,G,se,ce,J,ge,fe,he,xe,_e,K,me,Y,Ce],styles:["[_nghost-%COMP%]{display:contents}"]});let o=l;return o})();var Rt=(()=>{let l=class l{constructor(e){this.http=e,this.baseUrl=`${D.tipificacionUrl}/system-config`,this.classificationsUrl=`${D.tipificacionUrl}/typifications`,this.contactClassifications=k([]),this.managementClassifications=k([]),this.campaigns=k([]),this.tenantClassifications=k([]),this.isLoading=k(!1),this.isLoaded=k(!1)}setTenantAndPortfolio(e,t,i){this.tenantClassifications.set([]),this.contactClassifications.set([]),this.managementClassifications.set([]),this.currentTenantId=e,this.currentPortfolioId=t,this.currentSubPortfolioId=i,this.loadTenantClassifications(),this.loadTypificationsFromCatalog()}loadAllData(){this.isLoading.set(!0),Promise.all([this.loadTenantClassifications(),this.loadTypificationsFromCatalog()]).finally(()=>{this.isLoading.set(!1),this.isLoaded.set(!0)})}loadTypificationsFromCatalog(){return new Promise(e=>{if(!this.currentTenantId){console.warn("[V2] No se puede cargar tipificaciones sin tenant configurado"),e();return}let t=this.currentSubPortfolioId||0,i=this.currentPortfolioId||0,r=`${D.gatewayUrl}/v2/typifications/config/effective/tenant/${this.currentTenantId}/portfolio/${i}/subportfolio/${t}`;console.log("[V2] Cargando tipificaciones efectivas desde:",r),this.http.get(r).pipe(O(s=>{console.log("[V2] Tipificaciones efectivas cargadas:",s);let m=s.map(u=>({id:u.id,codigo:u.codigo,label:u.nombre,requiresPayment:!1,requiresSchedule:!1,requiresFollowUp:!1,parentId:u.parentTypificationId,hierarchyLevel:u.nivelJerarquia,suggestsFullAmount:u.suggestsFullAmount??null,allowsInstallmentSelection:u.allowsInstallmentSelection??null,requiresManualAmount:u.requiresManualAmount??null}));this.managementClassifications.set(m),console.log("[V2] Nivel 1:",m.filter(u=>u.hierarchyLevel===1).map(u=>`${u.codigo} (${u.label})`)),console.log("[V2] Nivel 2:",m.filter(u=>u.hierarchyLevel===2).map(u=>`${u.codigo} -> parent:${u.parentId}`)),console.log("[V2] Nivel 3:",m.filter(u=>u.hierarchyLevel===3).map(u=>`${u.codigo} -> parent:${u.parentId}`)),console.log("[V2] Nivel 4:",m.filter(u=>u.hierarchyLevel===4).map(u=>`${u.codigo} -> parent:${u.parentId}`))}),P(s=>(console.error("[V2] Error cargando tipificaciones efectivas:",s),this.managementClassifications.set([]),V([])))).subscribe(()=>e())})}loadTenantClassifications(){return new Promise(e=>{if(!this.currentTenantId){e();return}console.log("[TEMPORAL] loadTenantClassifications - endpoint /tenants/.../typifications no existe");let t=[];this.tenantClassifications.set(t),this.contactClassifications.set([]),this.managementClassifications.set([]),e()})}loadContactClassifications(){return new Promise(e=>{this.http.get(`${this.baseUrl}/contact-typifications`).pipe(O(t=>{this.contactClassifications.set(t)}),P(t=>(console.error("Error cargando tipificaciones de contacto:",t),V([])))).subscribe(()=>e())})}loadManagementClassifications(){return new Promise(e=>{this.http.get(`${this.baseUrl}/management-typifications`).pipe(O(t=>{this.managementClassifications.set(t)}),P(t=>(console.error("Error cargando tipificaciones de gesti\xF3n:",t),V([])))).subscribe(()=>e())})}loadActiveCampaigns(){return new Promise(e=>{this.http.get(`${this.baseUrl}/campaigns/active`).pipe(O(t=>{this.campaigns.set(t)}),P(t=>(console.error("Error cargando campa\xF1as:",t),V([])))).subscribe(()=>e())})}refresh(){this.loadAllData()}getContactClassificationsForUI(){return this.contactClassifications().map(e=>({id:e.codigo,codigo:e.codigo,label:e.label,isSuccessful:e.isSuccessful}))}getManagementClassificationsForUI(){return this.managementClassifications().map(e=>({id:String(e.id),codigo:e.codigo,label:e.label,requiere_pago:e.requiresPayment,requiere_cronograma:e.requiresSchedule,requiere_seguimiento:e.requiresFollowUp,parentId:e.parentId,hierarchyLevel:e.hierarchyLevel,suggestsFullAmount:e.suggestsFullAmount,allowsInstallmentSelection:e.allowsInstallmentSelection,requiresManualAmount:e.requiresManualAmount}))}getActiveCampaign(){let e=this.campaigns();return e.length>0?{id:e[0].campaignId,nombre:e[0].nombre,tipo:e[0].campaignType}:null}getClassificationFields(e){if(!this.currentTenantId)throw new Error("No hay tenant configurado");let t=`${D.gatewayUrl}/v2/typifications/config/tenant/${this.currentTenantId}/typifications/${e}/fields`;return this.currentPortfolioId&&(t+=`?portfolioId=${this.currentPortfolioId}`),console.log("[V2] Cargando campos din\xE1micos desde:",t),this.http.get(t).pipe(O(i=>{console.log("[V2] Campos din\xE1micos cargados:",i)}),P(i=>(console.error("[V2] Error cargando campos din\xE1micos:",i),V({typificationId:e,isLeaf:!1,fields:[]}))))}getAllFieldTypes(){let e=`${D.tipificacionUrl}/field-types`;return this.http.get(e).pipe(P(t=>(console.error("Error cargando tipos de campo:",t),V([]))))}getFieldTypesForMainFields(){let e=`${D.tipificacionUrl}/field-types/main-fields`;return this.http.get(e).pipe(P(t=>(console.error("Error cargando tipos para campos principales:",t),V([]))))}getFieldTypesForTableColumns(){let e=`${D.tipificacionUrl}/field-types/table-columns`;return this.http.get(e).pipe(P(t=>(console.error("Error cargando tipos para columnas de tabla:",t),V([]))))}};l.\u0275fac=function(t){return new(t||l)(L(j))},l.\u0275prov=N({token:l,factory:l.\u0275fac,providedIn:"root"});let o=l;return o})();var Ut=(()=>{let l=class l{constructor(e){this.http=e,this.catalogUrl=`${D.gatewayUrl}/v2/typifications/catalog`,this.configUrl=`${D.gatewayUrl}/v2/typifications/config`}getAllClassifications(){return this.http.get(`${this.catalogUrl}`)}getActiveClassifications(){return this.http.get(`${this.catalogUrl}/active`)}getTypificationsByType(e){return this.http.get(`${this.catalogUrl}/type/${e}`)}getTypificationsByLevel(e){return this.http.get(`${this.catalogUrl}/level/${e}`)}getTypificationsByParent(e){return this.http.get(`${this.catalogUrl}/${e}/children`)}getClassificationById(e){return this.http.get(`${this.catalogUrl}/${e}`)}getRootTypifications(){return this.http.get(`${this.catalogUrl}/roots`)}createTypification(e){return this.http.post(`${this.catalogUrl}`,e)}updateTypification(e,t){return this.http.put(`${this.catalogUrl}/${e}`,t)}deleteTypification(e){return this.http.delete(`${this.catalogUrl}/${e}`)}activateTypification(e){return this.http.put(`${this.catalogUrl}/${e}/activate`,{})}deactivateTypification(e){return this.http.put(`${this.catalogUrl}/${e}/deactivate`,{})}getTenantClassifications(e,t,i){let r=new T;return i&&(r=r.set("includeDisabled","true")),t?this.http.get(`${this.configUrl}/tenant/${e}/portfolio/${t}`,{params:r}):this.http.get(`${this.configUrl}/tenant/${e}`,{params:r})}getTenantClassificationsByType(e,t,i){let r=new T;return i&&(r=r.set("portfolioId",i.toString())),this.http.get(`${this.configUrl}/tenant/${e}/type/${t}`,{params:r})}getEffectiveTypifications(e,t,i){return this.http.get(`${this.configUrl}/effective/tenant/${e}/portfolio/${t}/subportfolio/${i}`)}updateTenantTypificationConfig(e,t){return this.http.put(`${this.configUrl}/${e}`,t)}enableClassification(e,t,i,r,s){let m=new T().set("userId",s?.toString()||"1");return r&&i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/subportfolio/${r}/typification/${t}/enable`,{},{params:m}):i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/typification/${t}/enable`,{},{params:m}):this.http.post(`${this.configUrl}/tenant/${e}/typification/${t}/enable`,{},{params:m})}disableClassification(e,t,i,r,s){let m=new T().set("userId",s?.toString()||"1");return r&&i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/subportfolio/${r}/typification/${t}/disable`,{},{params:m}):i?this.http.post(`${this.configUrl}/tenant/${e}/portfolio/${i}/typification/${t}/disable`,{},{params:m}):this.http.post(`${this.configUrl}/tenant/${e}/typification/${t}/disable`,{},{params:m})}getAllTenants(){return this.http.get(`${D.webServiceUrl}/v1/system-config/tenants`)}getPortfoliosByTenant(e){return this.http.get(`${D.webServiceUrl}/v1/system-config/tenants/${e}/portfolios`)}getSubPortfoliosByPortfolio(e){return this.http.get(`${this.configUrl}/portfolios/${e}/subportfolios`)}getAdditionalFields(e){return this.http.get(`${this.catalogUrl}/${e}/additional-fields`)}saveAdditionalFields(e,t){return this.http.put(`${this.catalogUrl}/${e}/additional-fields`,t)}getTypificationFieldsWithValues(e,t,i,r){let s=new T;return i&&(s=s.set("portfolioId",i.toString())),r&&(s=s.set("clientId",r.toString())),this.http.get(`${this.configUrl}/tenant/${e}/typifications/${t}/fields`,{params:s})}getDynamicTableColumns(e,t,i){let r=new T().set("tenantId",e.toString()).set("portfolioId",t.toString()).set("subPortfolioId",i.toString());return this.http.get(`${this.configUrl}/dynamic-table-columns`,{params:r})}generarOpcionesCampo(e,t,i,r){let s=new T().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",r.toString());return this.http.get(`${this.catalogUrl}/campo/${e}/opciones/generar`,{params:s})}inicializarOpcionesCampo(e,t,i,r){let s=new T().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",r.toString());return this.http.post(`${this.catalogUrl}/campo/${e}/opciones/inicializar`,{},{params:s})}getOpcionesCampo(e){return this.http.get(`${this.catalogUrl}/campo/${e}/opciones`)}getOpcionesHabilitadas(e){return this.http.get(`${this.catalogUrl}/campo/${e}/opciones/habilitadas`)}configurarOpciones(e){return this.http.put(`${this.catalogUrl}/campo/opciones/configurar`,e)}getOpcionesConValores(e,t,i,r,s){let m=new T().set("tenantId",t.toString()).set("portfolioId",i.toString()).set("subPortfolioId",r.toString()).set("clientId",s.toString());return this.http.get(`${this.catalogUrl}/campo/${e}/opciones/valores`,{params:m})}createPaymentSchedule(e){return this.http.post(`${D.gatewayUrl}/v2/management-records/payment-schedule`,e)}getPaymentSchedulesByClient(e){return this.http.get(`${D.gatewayUrl}/v2/management-records/payment-schedule/client/${e}`)}getPaymentScheduleByGroup(e){return this.http.get(`${D.gatewayUrl}/v2/management-records/payment-schedule/group/${e}`)}updatePaymentStatus(e,t,i,r){let s=new T().set("estadoPago",t);return i!==void 0&&(s=s.set("montoPagadoReal",i.toString())),r&&(s=s.set("fechaPagoReal",r)),this.http.put(`${D.gatewayUrl}/v2/management-records/${e}/payment-status`,{},{params:s})}buildClassificationTree(e){let t=new Map,i=[];e.forEach(s=>{t.set(s.id,{typification:s,children:[],level:s.nivelJerarquia})}),e.forEach(s=>{let m=t.get(s.id),u=s.tipificacionPadre?.id;if(u){let M=t.get(u);M&&M.children.push(m)}else i.push(m)});let r=s=>{s.children.length>0&&(s.children.sort((m,u)=>{let M=m.typification.ordenVisualizacion||0,X=u.typification.ordenVisualizacion||0;return M-X}),s.children.forEach(m=>r(m)))};return i.forEach(s=>r(s)),i}};l.\u0275fac=function(t){return new(t||l)(L(j))},l.\u0275prov=N({token:l,factory:l.\u0275fac,providedIn:"root"});let o=l;return o})();export{vt as a,Rt as b,Ut as c};
