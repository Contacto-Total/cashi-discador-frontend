{
  "version": 3,
  "sources": ["src/app/core/services/campaign-admin.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { environment } from '../../../environments/environment';\n\nexport interface Campaign {\n  id?: number;\n  name: string;\n  description?: string;\n  status: 'DRAFT' | 'ACTIVE' | 'PAUSED' | 'COMPLETED';\n  dialMode: 'MANUAL' | 'PROGRESSIVE' | 'PREDICTIVE';\n  startDate?: string;\n  endDate?: string;\n  maxAttempts?: number;\n  retryInterval?: number;\n  callerId?: string;\n  aggressiveness?: number;\n  intensidad?: number; // 1-100, default 50\n  estaDiscando?: boolean; // Control de discado automático\n  createdAt?: string;\n  updatedAt?: string;\n\n  // Relaciones con Tenant/Portfolio/SubPortfolio\n  tenantId?: number;\n  portfolioId?: number;\n  subPortfolioId?: number;\n\n  // Estadísticas (solo para lectura)\n  totalContacts?: number;\n  pendingContacts?: number;\n  contactedContacts?: number;\n  totalCalls?: number;\n  answeredCalls?: number;\n  contactRate?: number;\n}\n\nexport interface ImportStats {\n  totalClientes: number;\n  fuenteDatos: string;\n  inquilino?: number;\n  cartera?: number;\n  subcartera?: number;\n}\n\nexport interface CampaignStatistics {\n  idCampana: number;\n  nombre: string;\n  descripcion?: string;\n  estadoActual: string;\n  fechaInicio?: string;\n  fechaFinal?: string;\n  totalRegistros: number;\n  faltaReintentar: number;\n  reintentosCompletados: number;\n  faltaLlamar: number;\n  totalLlamadas: number;\n  llamadasExitosas: number;\n  llamadasNoContestadas: number;\n  llamadasFallidas: number;\n  llamadasAbandonadas: number;\n  duracionPromedioLlamada: string;\n  duracionMaximaLlamada: string;\n  duracionPromedioSegundos: number;\n  duracionMaximaSegundos: number;\n  modoDiscado: string;\n  intentosMaximos: number;\n  intervaloReintento: number;\n  llamadasContestadas: number;\n  llamadasCortas: number;\n  llamadasBuzonVoz: number;\n  llamadasPausadas: number;\n}\n\nexport interface CampaignCall {\n  idLlamada: number;\n  fecha: string;\n  telefono: string;\n  dato: string;\n  estado: string;\n  causa?: string;\n  duracion: string;\n  duracionSegundos: number;\n  intentos: number;\n  agenteNombre?: string;\n  agenteExtension?: string;\n  uuidLlamada: string;\n  idContacto: number;\n  estadoContacto: string;\n}\n\nexport interface CampaignCallsResponse {\n  content: CampaignCall[];\n  totalElements: number;\n  totalPages: number;\n  currentPage: number;\n  pageSize: number;\n}\n\nexport interface FilterableField {\n  id: number;\n  fieldCode: string;\n  fieldName: string;\n  dataType: string;\n  format?: string;\n}\n\nexport interface CampaignFilterRange {\n  id?: number;\n  campaignId?: number;\n  fieldDefinitionId: number;\n  fieldCode: string;\n  fieldName: string;\n  minValue?: number;\n  maxValue?: number;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CampaignAdminService {\n  private apiUrl = `${environment.gatewayUrl}/campaigns`;\n\n  constructor(private http: HttpClient) {}\n\n  private getHeaders(): HttpHeaders {\n    const token = localStorage.getItem('token');\n    return new HttpHeaders({\n      'Content-Type': 'application/json',\n      'Authorization': token ? `Bearer ${token}` : ''\n    });\n  }\n\n  /**\n   * Obtiene todas las campañas\n   */\n  getAllCampaigns(): Observable<Campaign[]> {\n    return this.http.get<Campaign[]>(`${this.apiUrl}/list`, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Obtiene una campaña por ID con estadísticas\n   */\n  getCampaignById(id: number): Observable<Campaign> {\n    return this.http.get<Campaign>(`${this.apiUrl}/${id}`, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Crea una nueva campaña\n   */\n  createCampaign(campaign: Campaign): Observable<any> {\n    return this.http.post(this.apiUrl, campaign, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Actualiza una campaña\n   */\n  updateCampaign(id: number, campaign: Campaign): Observable<any> {\n    return this.http.put(`${this.apiUrl}/${id}`, campaign, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Elimina una campaña\n   */\n  deleteCampaign(id: number): Observable<any> {\n    return this.http.delete(`${this.apiUrl}/${id}`, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Activa una campaña (inicia discado automático)\n   */\n  activarCampaign(id: number): Observable<any> {\n    return this.http.post(`${this.apiUrl}/${id}/start`, {}, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Pausa una campaña\n   */\n  pausarCampaign(id: number): Observable<any> {\n    return this.http.post(`${this.apiUrl}/${id}/pause`, {}, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Detiene una campaña completamente\n   */\n  detenerCampaign(id: number): Observable<any> {\n    return this.http.post(`${this.apiUrl}/${id}/detener`, {}, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Inicia el discado automático para una campaña específica\n   */\n  startDialing(id: number): Observable<Campaign> {\n    return this.http.post<Campaign>(`${this.apiUrl}/${id}/start-dialing`, {}, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Detiene el discado automático para una campaña específica\n   */\n  stopDialing(id: number): Observable<Campaign> {\n    return this.http.post<Campaign>(`${this.apiUrl}/${id}/stop-dialing`, {}, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Importa contactos desde cashi_db.clientes (ya no usa límite)\n   */\n  importarContactos(id: number): Observable<any> {\n    return this.http.post(`${this.apiUrl}/${id}/importar-contactos`, {}, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Obtiene estadísticas de importación disponibles para una campaña\n   */\n  getImportStats(id: number): Observable<ImportStats> {\n    return this.http.get<ImportStats>(`${this.apiUrl}/${id}/import-stats`, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Helper para obtener el color según el estado\n   */\n  getStatusColor(status: string): string {\n    const colors: Record<string, string> = {\n      'DRAFT': '#6B7280',\n      'ACTIVE': '#10B981',\n      'PAUSED': '#F59E0B',\n      'COMPLETED': '#3B82F6'\n    };\n    return colors[status] || '#6B7280';\n  }\n\n  /**\n   * Helper para obtener el texto del estado\n   */\n  getStatusText(status: string): string {\n    const texts: Record<string, string> = {\n      'DRAFT': 'Borrador',\n      'ACTIVE': 'Activa',\n      'PAUSED': 'Pausada',\n      'COMPLETED': 'Completada'\n    };\n    return texts[status] || status;\n  }\n\n  /**\n   * Obtiene estadísticas detalladas de una campaña\n   */\n  getCampaignStatistics(id: number): Observable<CampaignStatistics> {\n    return this.http.get<CampaignStatistics>(`${environment.gatewayUrl}/admin/campaigns/${id}/statistics`, { headers: this.getHeaders() });\n  }\n\n  /**\n   * Obtiene el historial de llamadas de una campaña con paginación y búsqueda\n   */\n  getCampaignCalls(id: number, page: number = 0, size: number = 10, search?: string): Observable<CampaignCallsResponse> {\n    let url = `${environment.gatewayUrl}/admin/campaigns/${id}/calls?page=${page}&size=${size}`;\n    if (search) {\n      url += `&search=${encodeURIComponent(search)}`;\n    }\n    return this.http.get<CampaignCallsResponse>(url, { headers: this.getHeaders() });\n  }\n\n  // ========================================\n  // FILTROS DE CAMPAÑA\n  // ========================================\n\n  /**\n   * Obtiene los campos numéricos disponibles para filtrar según la subcartera\n   */\n  getFilterableFieldsBySubcartera(subcarteraId: number): Observable<FilterableField[]> {\n    return this.http.get<FilterableField[]>(\n      `${this.apiUrl}/filterable-fields/by-subcartera/${subcarteraId}`,\n      { headers: this.getHeaders() }\n    );\n  }\n\n  /**\n   * Obtiene los campos numéricos disponibles para filtrar según la campaña\n   */\n  getFilterableFields(campaignId: number): Observable<FilterableField[]> {\n    return this.http.get<FilterableField[]>(\n      `${this.apiUrl}/${campaignId}/filterable-fields`,\n      { headers: this.getHeaders() }\n    );\n  }\n\n  /**\n   * Obtiene los filtros actuales de una campaña\n   */\n  getCampaignFilters(campaignId: number): Observable<CampaignFilterRange[]> {\n    return this.http.get<CampaignFilterRange[]>(\n      `${this.apiUrl}/${campaignId}/filters`,\n      { headers: this.getHeaders() }\n    );\n  }\n\n  /**\n   * Guarda filtros para una campaña (reemplaza los existentes)\n   */\n  saveCampaignFilters(campaignId: number, filters: CampaignFilterRange[]): Observable<CampaignFilterRange[]> {\n    return this.http.post<CampaignFilterRange[]>(\n      `${this.apiUrl}/${campaignId}/filters`,\n      filters,\n      { headers: this.getHeaders() }\n    );\n  }\n\n  /**\n   * Elimina todos los filtros de una campaña\n   */\n  deleteAllFilters(campaignId: number): Observable<any> {\n    return this.http.delete(`${this.apiUrl}/${campaignId}/filters`, { headers: this.getHeaders() });\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
