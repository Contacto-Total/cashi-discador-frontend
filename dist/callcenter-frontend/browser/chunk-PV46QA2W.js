import{a as h}from"./chunk-YQKVMPSG.js";import{E as o,X as n,Y as u,_ as i,ba as c,fa as l,n as r,td as p}from"./chunk-FWGUXTKY.js";var A=(()=>{let a=class a{constructor(t){this.http=t,this.apiUrl=`${h.gatewayUrl}/agent-status`,this.currentStatusSubject=new r(null),this.currentStatus$=this.currentStatusSubject.asObservable()}getAgentStatus(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(i(e=>{let m={idUsuario:e.idUsuario,estadoActual:e.estadoActual,estadoAnterior:e.estadoAnterior,timestampCambio:e.timestampCambio,tiempoEnEstadoMinutos:e.tiempoEnEstadoMinutos,notas:e.notas,sessionId:e.sessionId,segundosEnEstado:e.segundosEnEstado,colorIndicador:e.colorIndicador,porcentajeTiempo:e.porcentajeTiempo,excedeTiempoMaximo:e.excedeTiempoMaximo,tiempoMaximoSegundos:e.tiempoMaximoSegundos};this.currentStatusSubject.next(m)}))}changeStatus(t,e){return this.http.post(`${this.apiUrl}/${t}/cambiar-estado`,e).pipe(i(()=>{this.getAgentStatus(t).subscribe()}))}enterManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/entrar`,{}).pipe(i(()=>{this.getAgentStatus(t).subscribe()}))}exitManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/salir`,{}).pipe(i(()=>{this.getAgentStatus(t).subscribe()}))}getAvailableStates(){return this.http.get(`${this.apiUrl}/estados-disponibles`)}isAvailableForCalls(t){return this.http.get(`${this.apiUrl}/${t}/disponible-para-llamadas`)}startStatusPolling(t){return o(1e4).pipe(n(0),u(()=>this.getAgentStatus(t)))}clearCurrentStatus(){this.currentStatusSubject.next(null)}disconnectAgent(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(i(()=>{console.log(`[AgentStatusService] Agente ${t} marcado como desconectado`),this.currentStatusSubject.next(null)}))}getCurrentStatus(){return this.currentStatusSubject.value}};a.\u0275fac=function(e){return new(e||a)(l(p))},a.\u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();export{A as a};
