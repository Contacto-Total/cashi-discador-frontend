import{a as G}from"./chunk-YBTTFGZA.js";import{a as H}from"./chunk-BY2DM2ZC.js";import{b as W,e as L,h as A,m as j,n as B,o as q,s as O,u as z}from"./chunk-TFAMJCIP.js";import{$a as T,Cb as y,Db as E,Eb as m,Fb as o,Gb as t,Hb as g,Ob as M,Qb as p,Sb as c,Va as s,_c as V,dc as N,ec as a,fc as b,gb as F,gc as k,hc as D,ja as u,jc as C,ka as f,kc as S,lc as P,ta as x,yb as h,zb as _}from"./chunk-UY3AUK24.js";var I=(l,d)=>d.id;function J(l,d){if(l&1&&(o(0,"option",12),a(1),t()),l&2){let e=d.$implicit;m("value",e.id),s(),D("",e.tenantName," (",e.tenantCode,")")}}function K(l,d){if(l&1&&(o(0,"option",12),a(1),t()),l&2){let e=d.$implicit;m("value",e.id),s(),D("",e.portfolioName," (",e.portfolioCode,")")}}function Q(l,d){l&1&&(o(0,"div",29),g(1,"div",31),o(2,"p",32),a(3,"Cargando subcarteras..."),t()())}function R(l,d){l&1&&a(0," Intenta con otro t\xE9rmino de b\xFAsqueda ")}function U(l,d){l&1&&a(0," Comienza creando tu primera subcartera ")}function X(l,d){if(l&1&&(o(0,"div",29),g(1,"div",33),o(2,"p",34),a(3,"No se encontraron subcarteras"),t(),o(4,"p",35),h(5,R,1,0)(6,U,1,0),t()()),l&2){let e=c(2);s(5),_(e.searchTerm?5:6)}}function Y(l,d){if(l&1){let e=M();o(0,"tr",40)(1,"td",41)(2,"span",42),a(3),t()(),o(4,"td",41)(5,"span",43),a(6),t()(),o(7,"td",41)(8,"span",6),a(9),t()(),o(10,"td",41)(11,"span",6),a(12),t()(),o(13,"td",41)(14,"label",44)(15,"input",45),p("change",function(){let n=u(e).$implicit,r=c(3);return f(r.toggleSubPortfolioStatus(n))}),t(),g(16,"div",46),t()(),o(17,"td",41)(18,"div",47)(19,"button",48),p("click",function(){let n=u(e).$implicit,r=c(3);return f(r.editSubPortfolio(n))}),t(),o(20,"button",49),p("click",function(){let n=u(e).$implicit,r=c(3);return f(r.deleteSubPortfolio(n))}),t()()()()}if(l&2){let e=d.$implicit;s(3),b(e.subPortfolioCode),s(3),b(e.subPortfolioName),s(3),b(e.description||"-"),s(3),b(e.portfolioName),s(3),m("checked",e.isActive)}}function Z(l,d){if(l&1&&(o(0,"div",30)(1,"table",36)(2,"thead",37)(3,"tr")(4,"th",38),a(5,"C\xF3digo"),t(),o(6,"th",38),a(7,"Nombre"),t(),o(8,"th",38),a(9,"Descripci\xF3n"),t(),o(10,"th",38),a(11,"Cartera"),t(),o(12,"th",38),a(13,"Estado"),t(),o(14,"th",38),a(15,"Acciones"),t()()(),o(16,"tbody",39),y(17,Y,21,5,"tr",40,I),t()()()),l&2){let e=c(2);s(17),E(e.filteredSubPortfolios())}}function $(l,d){if(l&1){let e=M();o(0,"div",15)(1,"div",16)(2,"div",2)(3,"div")(4,"p",17),a(5,"Total Subcarteras"),t(),o(6,"p",18),a(7),t()(),g(8,"div",19),t()(),o(9,"div",16)(10,"div",2)(11,"div")(12,"p",17),a(13,"Activas"),t(),o(14,"p",20),a(15),t()(),g(16,"div",21),t()(),o(17,"div",16)(18,"div",2)(19,"div")(20,"p",17),a(21,"Inactivas"),t(),o(22,"p",22),a(23),t()(),g(24,"div",23),t()()(),o(25,"div",1)(26,"div",8)(27,"div",24)(28,"div",25)(29,"input",26),P("ngModelChange",function(n){u(e);let r=c();return S(r.searchTerm,n)||(r.searchTerm=n),f(n)}),p("ngModelChange",function(){u(e);let n=c();return f(n.filterSubPortfolios())}),t()()()()(),o(30,"div",27)(31,"div",28),h(32,Q,4,0,"div",29)(33,X,7,1,"div",29)(34,Z,19,0,"div",30),t()()}if(l&2){let e=c();s(7),b(e.subPortfolios().length),s(8),b(e.getActiveSubPortfolios()),s(8),b(e.getInactiveSubPortfolios()),s(6),C("ngModel",e.searchTerm),s(3),_(e.loading()?32:e.filteredSubPortfolios().length===0?33:34)}}function ee(l,d){if(l&1&&(o(0,"option",12),a(1),t()),l&2){let e=d.$implicit;m("value",e.id),s(),D("",e.portfolioName," (",e.portfolioCode,")")}}function te(l,d){if(l&1){let e=M();o(0,"div")(1,"label",10),a(2," Cartera "),t(),o(3,"select",67),P("ngModelChange",function(n){u(e);let r=c(2);return S(r.selectedPortfolioIdForForm,n)||(r.selectedPortfolioIdForForm=n),f(n)}),y(4,ee,2,3,"option",12,I),t(),o(6,"p",61),a(7,"La subcartera se crear\xE1 para la cartera seleccionada"),t()()}if(l&2){let e=c(2);s(3),C("ngModel",e.selectedPortfolioIdForForm),s(),E(e.portfolios())}}function oe(l,d){if(l&1&&(o(0,"p",60),a(1),t()),l&2){let e=c(2);s(),b(e.getCodeErrorMessage())}}function ie(l,d){l&1&&(o(0,"p",61),a(1,"C\xF3digo \xFAnico alfanum\xE9rico de m\xE1ximo 3 caracteres (no se puede cambiar despu\xE9s de crear)"),t())}function ne(l,d){if(l&1&&(o(0,"p",60),a(1),t()),l&2){let e=c(2);s(),b(e.getNameErrorMessage())}}function re(l,d){if(l&1){let e=M();o(0,"div",14)(1,"div",50)(2,"div",51)(3,"div",2)(4,"div",52),g(5,"div",53),o(6,"div")(7,"h2",54),a(8),t(),o(9,"p",55),a(10,"Complete la informaci\xF3n de la subcartera"),t()()(),o(11,"button",56),p("click",function(){u(e);let n=c();return f(n.closeDialog())}),t()()(),o(12,"div",57)(13,"div",58),h(14,te,8,1,"div"),o(15,"div")(16,"label",10),a(17," C\xF3digo de la Subcartera * "),t(),o(18,"input",59),P("ngModelChange",function(n){u(e);let r=c();return S(r.formData.subPortfolioCode,n)||(r.formData.subPortfolioCode=n),f(n)}),t(),h(19,oe,2,1,"p",60)(20,ie,2,0,"p",61),t(),o(21,"div")(22,"label",10),a(23," Nombre de la Subcartera * "),t(),o(24,"input",62),P("ngModelChange",function(n){u(e);let r=c();return S(r.formData.subPortfolioName,n)||(r.formData.subPortfolioName=n),f(n)}),t(),h(25,ne,2,1,"p",60),t(),o(26,"div")(27,"label",10),a(28," Descripci\xF3n "),t(),o(29,"textarea",63),P("ngModelChange",function(n){u(e);let r=c();return S(r.formData.description,n)||(r.formData.description=n),f(n)}),t(),o(30,"p",61),a(31,"Informaci\xF3n adicional sobre la subcartera (opcional)"),t()()()(),o(32,"div",64)(33,"button",65),p("click",function(){u(e);let n=c();return f(n.closeDialog())}),a(34," Cancelar "),t(),o(35,"button",66),p("click",function(){u(e);let n=c();return f(n.saveSubPortfolio())}),a(36),t()()()()}if(l&2){let e=c();s(8),b(e.editingSubPortfolio()?"Editar Subcartera":"Nueva Subcartera"),s(6),_(e.editingSubPortfolio()===null?14:-1),s(4),N(e.getCodeErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:bg-slate-950 disabled:text-gray-600 uppercase"),C("ngModel",e.formData.subPortfolioCode),m("disabled",e.editingSubPortfolio()!==null),s(),_(e.getCodeErrorMessage()?19:20),s(5),N(e.getNameErrorMessage()?"w-full px-4 py-2.5 bg-slate-800 border-2 border-red-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500":"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"),C("ngModel",e.formData.subPortfolioName),s(),_(e.getNameErrorMessage()?25:-1),s(4),C("ngModel",e.formData.description),s(6),m("disabled",!e.canSave()),s(),k(" ",e.editingSubPortfolio()?"Guardar Cambios":"Crear Subcartera"," ")}}var pe=(()=>{let d=class d{constructor(i,n){this.portfolioService=i,this.typificationService=n,this.tenants=x([]),this.portfolios=x([]),this.subPortfolios=x([]),this.filteredSubPortfolios=x([]),this.loading=x(!1),this.showDialog=x(!1),this.editingSubPortfolio=x(null),this.selectedTenantId=0,this.selectedPortfolioId=0,this.selectedPortfolioIdForForm=0,this.searchTerm="",this.formData={subPortfolioCode:"",subPortfolioName:"",description:""}}ngOnInit(){this.loadTenants()}loadTenants(){this.typificationService.getAllTenants().subscribe({next:i=>{this.tenants.set(i)},error:i=>{console.error("Error loading tenants:",i)}})}onTenantChange(){this.selectedPortfolioId=0,this.selectedPortfolioIdForForm=0,this.portfolios.set([]),this.subPortfolios.set([]),this.filteredSubPortfolios.set([]),this.selectedTenantId>0&&this.loadPortfolios()}onPortfolioChange(){this.subPortfolios.set([]),this.filteredSubPortfolios.set([]),this.selectedPortfolioId>0&&this.loadSubPortfolios()}loadPortfolios(){this.portfolioService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:i=>{this.portfolios.set(i)},error:i=>{console.error("Error loading portfolios:",i)}})}loadSubPortfolios(){this.loading.set(!0),this.portfolioService.getSubPortfoliosByPortfolio(this.selectedPortfolioId).subscribe({next:i=>{this.subPortfolios.set(i),this.filteredSubPortfolios.set(i),this.loading.set(!1)},error:i=>{console.error("Error loading subportfolios:",i),this.loading.set(!1)}})}filterSubPortfolios(){let i=this.searchTerm.toLowerCase();if(!i){this.filteredSubPortfolios.set(this.subPortfolios());return}let n=this.subPortfolios().filter(r=>r.subPortfolioCode.toLowerCase().includes(i)||r.subPortfolioName.toLowerCase().includes(i));this.filteredSubPortfolios.set(n)}getActiveSubPortfolios(){return this.subPortfolios().filter(i=>i.isActive).length}getInactiveSubPortfolios(){return this.subPortfolios().filter(i=>!i.isActive).length}openCreateDialog(){if(this.selectedPortfolioId===0){alert("Por favor seleccione una cartera primero");return}this.editingSubPortfolio.set(null),this.selectedPortfolioIdForForm=this.selectedPortfolioId,this.formData={subPortfolioCode:"",subPortfolioName:"",description:""},this.showDialog.set(!0)}editSubPortfolio(i){this.editingSubPortfolio.set(i),this.formData={subPortfolioCode:i.subPortfolioCode,subPortfolioName:i.subPortfolioName,description:i.description||""},this.showDialog.set(!0)}closeDialog(){this.showDialog.set(!1),this.editingSubPortfolio.set(null)}isCodeDuplicated(){let i=this.editingSubPortfolio();return!this.formData.subPortfolioCode.trim()||i?!1:this.subPortfolios().filter(r=>r.portfolioId===this.selectedPortfolioIdForForm).some(r=>r.subPortfolioCode.toLowerCase()===this.formData.subPortfolioCode.trim().toLowerCase())}getCodeErrorMessage(){return this.formData.subPortfolioCode.trim()&&this.isCodeDuplicated()?"Este c\xF3digo ya est\xE1 en uso en esta cartera":""}isNameDuplicated(){if(!this.formData.subPortfolioName.trim())return!1;let i=this.subPortfolios().filter(r=>r.portfolioId===this.selectedPortfolioIdForForm),n=this.editingSubPortfolio();return n?i.some(r=>r.id!==n.id&&r.subPortfolioName.toLowerCase()===this.formData.subPortfolioName.trim().toLowerCase()):i.some(r=>r.subPortfolioName.toLowerCase()===this.formData.subPortfolioName.trim().toLowerCase())}getNameErrorMessage(){return this.formData.subPortfolioName.trim()&&this.isNameDuplicated()?"Este nombre ya est\xE1 en uso en esta cartera":""}canSave(){let i=this.editingSubPortfolio();return!(!this.formData.subPortfolioCode.trim()||!this.formData.subPortfolioName.trim()||this.getCodeErrorMessage()||this.getNameErrorMessage()||!i&&this.selectedPortfolioIdForForm<=0)}saveSubPortfolio(){if(!this.canSave())return;let i=this.editingSubPortfolio();if(i){let n={subPortfolioName:this.formData.subPortfolioName,description:this.formData.description||void 0};this.portfolioService.updateSubPortfolio(i.id,n).subscribe({next:()=>{this.loadSubPortfolios(),this.closeDialog()},error:r=>{console.error("Error updating subportfolio:",r),alert("Error al actualizar la subcartera")}})}else{let n={portfolioId:this.selectedPortfolioIdForForm,subPortfolioCode:this.formData.subPortfolioCode,subPortfolioName:this.formData.subPortfolioName,description:this.formData.description||void 0};this.portfolioService.createSubPortfolio(n).subscribe({next:()=>{this.loadSubPortfolios(),this.closeDialog()},error:r=>{console.error("Error creating subportfolio:",r),alert("Error al crear la subcartera. Verifique que el c\xF3digo no est\xE9 duplicado.")}})}}toggleSubPortfolioStatus(i){let n=!i.isActive;confirm(`\xBFEst\xE1 seguro de ${n?"activar":"desactivar"} la subcartera "${i.subPortfolioName}"?`)&&this.portfolioService.toggleSubPortfolioStatus(i.id,n).subscribe({next:()=>{this.loadSubPortfolios()},error:w=>{console.error("Error updating subportfolio status:",w),alert("Error al cambiar el estado de la subcartera")}})}deleteSubPortfolio(i){confirm(`\xBFEst\xE1 seguro de eliminar la subcartera "${i.subPortfolioName}"? Esta acci\xF3n no se puede deshacer.`)&&this.portfolioService.deleteSubPortfolio(i.id).subscribe({next:()=>{this.loadSubPortfolios(),alert("Subcartera eliminada exitosamente")},error:n=>{console.error("Error deleting subportfolio:",n),alert("Error al eliminar la subcartera")}})}};d.\u0275fac=function(n){return new(n||d)(T(G),T(H))},d.\u0275cmp=F({type:d,selectors:[["app-subportfolio-maintenance"]],decls:35,vars:8,consts:[[1,"min-h-screen","bg-slate-950","p-6"],[1,"max-w-7xl","mx-auto","mb-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3","mb-2"],[1,"w-12","h-12","bg-gradient-to-br","from-emerald-600","to-emerald-700","rounded-xl","flex","items-center","justify-center","shadow-lg"],[1,"text-2xl","font-bold","text-white"],[1,"text-sm","text-gray-400"],[1,"flex","items-center","gap-2","px-5","py-2.5","bg-gradient-to-r","from-emerald-600","to-emerald-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","hover:scale-105","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","cursor-pointer",3,"click","disabled"],[1,"bg-slate-900","rounded-xl","p-4","shadow-sm","border","border-slate-800"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-semibold","text-gray-300","mb-2"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[3,"value"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-emerald-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],[1,"fixed","inset-0","bg-black/80","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"max-w-7xl","mx-auto","mb-6","grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"bg-slate-900","rounded-xl","p-5","shadow-sm","border","border-slate-800"],[1,"text-sm","text-gray-400","mb-1"],[1,"text-3xl","font-bold","text-white"],[1,"w-12","h-12","bg-emerald-900/30","rounded-lg","flex","items-center","justify-center"],[1,"text-3xl","font-bold","text-green-400"],[1,"w-12","h-12","bg-green-900/30","rounded-lg","flex","items-center","justify-center"],[1,"text-3xl","font-bold","text-gray-500"],[1,"w-12","h-12","bg-slate-800","rounded-lg","flex","items-center","justify-center"],[1,"flex","items-center","gap-4"],[1,"flex-1","relative"],["type","text","placeholder","Buscar por c\xF3digo o nombre...",1,"w-full","pl-12","pr-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"max-w-7xl","mx-auto"],[1,"bg-slate-900","rounded-xl","shadow-sm","border","border-slate-800","overflow-hidden"],[1,"p-12","text-center"],[1,"overflow-x-auto"],[1,"inline-block","w-8","h-8","border-4","border-emerald-500","border-t-transparent","rounded-full","animate-spin"],[1,"mt-4","text-gray-400"],[1,"w-16","h-16","bg-slate-800","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-gray-300","mb-2"],[1,"text-sm","text-gray-500"],[1,"w-full"],[1,"bg-slate-800","border-b","border-slate-700"],[1,"px-6","py-3","text-left","text-xs","font-semibold","text-gray-400","uppercase","tracking-wider"],[1,"divide-y","divide-slate-800"],[1,"hover:bg-slate-800","transition-colors"],[1,"px-6","py-3"],[1,"font-mono","text-sm","font-semibold","text-white"],[1,"font-medium","text-white"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-slate-700","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-emerald-800","rounded-full","peer","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-emerald-600"],[1,"flex","items-center","gap-2"],["title","Editar",1,"p-2","text-emerald-400","hover:bg-slate-800","rounded-lg","transition-colors","cursor-pointer",3,"click"],["title","Eliminar",1,"p-2","text-red-400","hover:bg-slate-800","rounded-lg","transition-colors","cursor-pointer",3,"click"],[1,"bg-slate-900","rounded-xl","shadow-2xl","max-w-2xl","w-full","max-h-[90vh]","overflow-hidden","border","border-slate-800"],[1,"bg-gradient-to-r","from-emerald-600","to-emerald-700","p-5","text-white"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-white/20","rounded-lg","flex","items-center","justify-center"],[1,"text-xl","font-bold"],[1,"text-emerald-100","text-sm"],[1,"text-white/80","hover:text-white",3,"click"],[1,"p-6","overflow-y-auto","max-h-[calc(90vh-200px)]"],[1,"space-y-4"],["type","text","maxlength","3","placeholder","Ej: S01, ABC",3,"ngModelChange","ngModel","disabled"],[1,"text-xs","text-red-400","mt-1","font-semibold"],[1,"text-xs","text-gray-500","mt-1"],["type","text","placeholder","Ej: TC Cl\xE1sica, Lima",3,"ngModelChange","ngModel"],["placeholder","Descripci\xF3n de la subcartera...","rows","3",1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-emerald-500",3,"ngModelChange","ngModel"],[1,"border-t","border-slate-800","p-4","flex","justify-end","gap-3","bg-slate-950"],[1,"px-5","py-2","text-gray-400","hover:bg-slate-800","hover:text-white","rounded-lg","font-medium","transition-colors",3,"click"],[1,"px-5","py-2","bg-gradient-to-r","from-emerald-600","to-emerald-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["disabled","",1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-emerald-500","opacity-70","cursor-not-allowed",3,"ngModelChange","ngModel"]],template:function(n,r){n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3),g(5,"div",4),o(6,"div")(7,"h1",5),a(8,"Gesti\xF3n de Subcarteras"),t(),o(9,"p",6),a(10,"Administra las subcarteras dentro de cada cartera"),t()()()(),o(11,"button",7),p("click",function(){return r.openCreateDialog()}),o(12,"span"),a(13,"Nueva Subcartera"),t()()()(),o(14,"div",1)(15,"div",8)(16,"div",9)(17,"div")(18,"label",10),a(19," Seleccionar Proveedor "),t(),o(20,"select",11),P("ngModelChange",function(v){return S(r.selectedTenantId,v)||(r.selectedTenantId=v),v}),p("ngModelChange",function(){return r.onTenantChange()}),o(21,"option",12),a(22,"Seleccione un proveedor..."),t(),y(23,J,2,3,"option",12,I),t()(),o(25,"div")(26,"label",10),a(27," Seleccionar Cartera "),t(),o(28,"select",13),P("ngModelChange",function(v){return S(r.selectedPortfolioId,v)||(r.selectedPortfolioId=v),v}),p("ngModelChange",function(){return r.onPortfolioChange()}),o(29,"option",12),a(30,"Seleccione una cartera..."),t(),y(31,K,2,3,"option",12,I),t()()()()(),h(33,$,35,5),t(),h(34,re,37,14,"div",14)),n&2&&(s(11),m("disabled",r.selectedPortfolioId===0),s(9),C("ngModel",r.selectedTenantId),s(),m("value",0),s(2),E(r.tenants()),s(5),C("ngModel",r.selectedPortfolioId),m("disabled",r.selectedTenantId===0),s(),m("value",0),s(2),E(r.portfolios()),s(2),_(r.selectedPortfolioId>0?33:-1),s(),_(r.showDialog()?34:-1))},dependencies:[V,z,B,q,W,j,L,O,A],styles:["[_nghost-%COMP%]{display:block}"]});let l=d;return l})();export{pe as SubPortfolioMaintenanceComponent};
