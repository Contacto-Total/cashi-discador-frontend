import{a as j}from"./chunk-A6Y7MA6W.js";import{Ca as x,K as I,L as N,N as g,Q as w,Qa as u,Ra as a,Sa as i,T,Ta as A,Tb as k,Ub as R,W as b,X as S,Xb as U,_a as C,ab as p,ac as F,cb as m,gc as $,k as P,lc as z,nb as M,oa as d,ob as L,qb as o,rb as f,sa as _,sb as y,x as h,xa as D}from"./chunk-G7UR4G7J.js";var s=(function(n){return n.DISPONIBLE="DISPONIBLE",n.EN_REUNION="EN_REUNION",n.REFRIGERIO="REFRIGERIO",n.SSHH="SSHH",n.EN_LLAMADA="EN_LLAMADA",n.TIPIFICANDO="TIPIFICANDO",n.EN_MANUAL="EN_MANUAL",n})(s||{}),H={[s.DISPONIBLE]:"Disponible",[s.EN_REUNION]:"En Reuni\xF3n",[s.REFRIGERIO]:"Refrigerio",[s.SSHH]:"Ba\xF1o",[s.EN_LLAMADA]:"En Llamada",[s.TIPIFICANDO]:"Tipificando",[s.EN_MANUAL]:"Modo Manual"},B=[s.DISPONIBLE,s.EN_REUNION,s.REFRIGERIO,s.SSHH];var V=(()=>{let l=class l{constructor(t){this.http=t,this.apiUrl=`${z.apiUrl}/api/agent-status`,this.currentStatusSubject=new P(null),this.currentStatus$=this.currentStatusSubject.asObservable()}getAgentStatus(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(g(e=>{let c={idUsuario:e.idUsuario,estadoActual:e.estadoActual,estadoAnterior:e.estadoAnterior,timestampCambio:e.timestampCambio,tiempoEnEstadoMinutos:e.tiempoEnEstadoMinutos,notas:e.notas,sessionId:e.sessionId};this.currentStatusSubject.next(c)}))}changeStatus(t,e){return this.http.post(`${this.apiUrl}/${t}/cambiar-estado`,e).pipe(g(()=>{this.getAgentStatus(t).subscribe()}))}enterManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/entrar`,{}).pipe(g(()=>{this.getAgentStatus(t).subscribe()}))}exitManualMode(t){return this.http.post(`${this.apiUrl}/${t}/modo-manual/salir`,{}).pipe(g(()=>{this.getAgentStatus(t).subscribe()}))}getAvailableStates(){return this.http.get(`${this.apiUrl}/estados-disponibles`)}isAvailableForCalls(t){return this.http.get(`${this.apiUrl}/${t}/disponible-para-llamadas`)}startStatusPolling(t){return h(3e4).pipe(I(0),N(()=>this.getAgentStatus(t)))}clearCurrentStatus(){this.currentStatusSubject.next(null)}getCurrentStatus(){return this.currentStatusSubject.value}};l.\u0275fac=function(e){return new(e||l)(T(F))},l.\u0275prov=w({token:l,factory:l.\u0275fac,providedIn:"root"});let n=l;return n})();function q(n,l){n&1&&(a(0,"div",10),A(1,"div",11),a(2,"p"),o(3,"Cargando estado..."),i()())}function W(n,l){if(n&1){let r=C();a(0,"div",12)(1,"p"),o(2),i(),a(3,"button",13),p("click",function(){b(r);let e=m();return S(e.loadAgentStatus((e.currentStatus==null?null:e.currentStatus.idUsuario)||0))}),o(4," Reintentar "),i()()}if(n&2){let r=m();d(2),f(r.error)}}function J(n,l){if(n&1){let r=C();a(0,"button",30),p("click",function(){let e=b(r).$implicit,c=m(2);return S(c.changeStatus(e))}),A(1,"div",31),a(2,"span"),o(3),i()()}if(n&2){let r=l.$implicit,t=m(2);M("border-color",t.getStateColor(r)),L("active",t.isCurrentState(r))("disabled",!t.canChangeToState(r)||t.loading),u("disabled",!t.canChangeToState(r)||t.loading),d(),M("background-color",t.getStateColor(r)),d(2),f(t.stateLabels[r])}}function K(n,l){n&1&&(a(0,"p",32),o(1," Est\xE1s en modo manual. Ve al softphone para hacer llamadas. "),i())}function Q(n,l){if(n&1){let r=C();a(0,"div",14)(1,"div",15)(2,"h2"),o(3,"Estado Actual"),i(),a(4,"div",16)(5,"div",17),o(6),i(),a(7,"div",18)(8,"span",19),o(9,"Tiempo en este estado:"),i(),a(10,"span",20),o(11),i()()()(),a(12,"div",21)(13,"h2"),o(14,"Cambiar Estado"),i(),a(15,"p",22),o(16,"Selecciona tu estado actual"),i(),a(17,"div",23),x(18,J,4,10,"button",24),i()(),a(19,"div",25)(20,"h2"),o(21,"Llamadas Manuales"),i(),a(22,"p",22),o(23,"Inicia el modo manual para realizar llamadas sin que te caigan autom\xE1ticas"),i(),a(24,"button",26),p("click",function(){b(r);let e=m();return S(e.enterManualMode())}),a(25,"span",27),o(26,"\u{1F4DE}"),i(),a(27,"span"),o(28,"LLAMAR MANUAL"),i()(),x(29,K,2,0,"p",28),i(),a(30,"div",29)(31,"h3"),o(32,"\u2139\uFE0F Informaci\xF3n"),i(),a(33,"ul")(34,"li")(35,"strong"),o(36,"Disponible:"),i(),o(37," Recibir\xE1s llamadas autom\xE1ticas"),i(),a(38,"li")(39,"strong"),o(40,"En Reuni\xF3n/Refrigerio/Ba\xF1o:"),i(),o(41," No recibir\xE1s llamadas"),i(),a(42,"li")(43,"strong"),o(44,"Modo Manual:"),i(),o(45," Puedes llamar, pero no recibes autom\xE1ticas"),i()()()()}if(n&2){let r=m();d(5),M("background-color",r.getStateColor(r.currentStatus.estadoActual)),d(),y(" ",r.stateLabels[r.currentStatus.estadoActual]," "),d(5),f(r.currentTimeInState),d(7),u("ngForOf",r.manualStates),d(6),u("disabled",r.loading||r.currentStatus.estadoActual===r.AgentState.EN_LLAMADA||r.currentStatus.estadoActual===r.AgentState.TIPIFICANDO),d(5),u("ngIf",r.currentStatus.estadoActual===r.AgentState.EN_MANUAL)}}var ct=(()=>{let l=class l{constructor(t,e,c){this.agentStatusService=t,this.authService=e,this.router=c,this.currentStatus=null,this.agentName="",this.loading=!1,this.error=null,this.currentTimeInState="00:00",this.AgentState=s,this.stateLabels=H,this.manualStates=B}ngOnInit(){let t=this.authService.getCurrentUser();if(!t){this.router.navigate(["/login"]);return}this.agentName=t.firstName+" "+t.lastName||t.username,this.loadAgentStatus(t.id),this.startTimer(),this.statusSubscription=this.agentStatusService.startStatusPolling(t.id).subscribe()}ngOnDestroy(){this.timerSubscription&&this.timerSubscription.unsubscribe(),this.statusSubscription&&this.statusSubscription.unsubscribe()}loadAgentStatus(t){this.loading=!0,this.error=null,this.agentStatusService.getAgentStatus(t).subscribe({next:e=>{this.currentStatus={idUsuario:e.idUsuario,estadoActual:e.estadoActual,estadoAnterior:e.estadoAnterior,timestampCambio:e.timestampCambio,tiempoEnEstadoMinutos:e.tiempoEnEstadoMinutos,notas:e.notas,sessionId:e.sessionId},this.loading=!1},error:e=>{console.error("Error loading agent status:",e),this.error="Error al cargar el estado del agente",this.loading=!1}}),this.agentStatusService.currentStatus$.subscribe(e=>{e&&(this.currentStatus=e)})}changeStatus(t){!this.currentStatus||this.loading||(this.loading=!0,this.error=null,this.agentStatusService.changeStatus(this.currentStatus.idUsuario,{estado:t,notas:`Cambio manual a ${this.stateLabels[t]}`}).subscribe({next:()=>{this.loading=!1},error:e=>{console.error("Error changing status:",e),this.error="Error al cambiar el estado",this.loading=!1}}))}enterManualMode(){!this.currentStatus||this.loading||(this.loading=!0,this.error=null,this.agentStatusService.enterManualMode(this.currentStatus.idUsuario).subscribe({next:()=>{this.loading=!1,this.router.navigate(["/dialer"])},error:t=>{console.error("Error entering manual mode:",t),this.error="Error al entrar en modo manual",this.loading=!1}}))}startTimer(){this.timerSubscription=h(1e3).subscribe(()=>{if(this.currentStatus){let t=new Date(this.currentStatus.timestampCambio),c=Math.floor((new Date().getTime()-t.getTime())/1e3),E=Math.floor(c/3600),O=Math.floor(c%3600/60),v=c%60;E>0?this.currentTimeInState=`${E.toString().padStart(2,"0")}:${O.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`:this.currentTimeInState=`${O.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`}})}getStateColor(t){return{[s.DISPONIBLE]:"#4caf50",[s.EN_REUNION]:"#ff9800",[s.REFRIGERIO]:"#2196f3",[s.SSHH]:"#9c27b0",[s.EN_LLAMADA]:"#f44336",[s.TIPIFICANDO]:"#ff5722",[s.EN_MANUAL]:"#607d8b"}[t]||"#757575"}isCurrentState(t){return this.currentStatus?.estadoActual===t}canChangeToState(t){return this.currentStatus?.estadoActual===s.EN_LLAMADA||this.currentStatus?.estadoActual===s.TIPIFICANDO?!1:this.manualStates.includes(t)}logout(){this.authService.logout(),this.router.navigate(["/login"])}};l.\u0275fac=function(e){return new(e||l)(_(V),_(j),_($))},l.\u0275cmp=D({type:l,selectors:[["app-agent-status-dashboard"]],decls:15,vars:4,consts:[[1,"dashboard-container"],[1,"dashboard-header"],[1,"header-content"],[1,"agent-info"],[1,"agent-name"],[1,"logout-btn",3,"click"],[1,"dashboard-main"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","status-dashboard",4,"ngIf"],[1,"loading-state"],[1,"spinner"],[1,"error-state"],[3,"click"],[1,"status-dashboard"],[1,"status-card"],[1,"current-status"],[1,"status-badge"],[1,"status-timer"],[1,"timer-label"],[1,"timer-value"],[1,"change-status-section"],[1,"section-subtitle"],[1,"status-buttons"],["class","status-btn",3,"active","disabled","border-color","click",4,"ngFor","ngForOf"],[1,"manual-calling-section"],[1,"manual-call-btn",3,"click","disabled"],[1,"btn-icon"],["class","manual-call-note",4,"ngIf"],[1,"info-card"],[1,"status-btn",3,"click","disabled"],[1,"status-btn-icon"],[1,"manual-call-note"]],template:function(e,c){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),o(4,"Panel de Agente"),i(),a(5,"div",3)(6,"span",4),o(7),i(),a(8,"button",5),p("click",function(){return c.logout()}),a(9,"span"),o(10,"Cerrar Sesi\xF3n"),i()()()()(),a(11,"div",6),x(12,q,4,0,"div",7)(13,W,5,1,"div",8)(14,Q,46,7,"div",9),i()()),e&2&&(d(7),f(c.agentName),d(5),u("ngIf",c.loading&&!c.currentStatus),d(),u("ngIf",c.error),d(),u("ngIf",c.currentStatus&&!c.loading))},dependencies:[U,k,R],styles:[".dashboard-container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;flex-direction:column}.dashboard-header[_ngcontent-%COMP%]{background:#fffffff2;box-shadow:0 2px 10px #0000001a;padding:1.5rem 2rem}.header-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.8rem;color:#333;font-weight:600}.agent-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.agent-name[_ngcontent-%COMP%]{font-size:1rem;color:#666;font-weight:500}.logout-btn[_ngcontent-%COMP%]{background:#f44336;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:6px;cursor:pointer;font-size:.9rem;font-weight:500;transition:background .3s}.logout-btn[_ngcontent-%COMP%]:hover{background:#d32f2f}.dashboard-main[_ngcontent-%COMP%]{flex:1;padding:2rem;max-width:1200px;width:100%;margin:0 auto}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;color:#fff}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-state[_ngcontent-%COMP%]{background:#f44336e6;color:#fff;padding:2rem;border-radius:8px;text-align:center}.error-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem;background:#fff;color:#f44336;border:none;padding:.6rem 1.5rem;border-radius:6px;cursor:pointer;font-weight:500}.status-dashboard[_ngcontent-%COMP%]{display:grid;gap:2rem}.status-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:2rem;box-shadow:0 4px 20px #0000001a}.status-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.3rem;color:#333}.current-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1.5rem}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:1rem 3rem;border-radius:50px;color:#fff;font-size:1.5rem;font-weight:600;text-transform:uppercase;letter-spacing:1px;box-shadow:0 4px 15px #0003}.status-timer[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.5rem}.timer-label[_ngcontent-%COMP%]{font-size:.9rem;color:#666}.timer-value[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#333;font-family:Courier New,monospace}.change-status-section[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:2rem;box-shadow:0 4px 20px #0000001a}.change-status-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.3rem;color:#333}.section-subtitle[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:#666;font-size:.95rem}.status-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.status-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;background:#fff;border:3px solid #ddd;padding:1rem 1.5rem;border-radius:10px;cursor:pointer;font-size:1rem;font-weight:500;color:#333;transition:all .3s}.status-btn[_ngcontent-%COMP%]:hover:not(.disabled){transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.status-btn.active[_ngcontent-%COMP%]{border-width:3px;box-shadow:0 4px 15px #0003}.status-btn.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.status-btn-icon[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%}.manual-calling-section[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:2rem;box-shadow:0 4px 20px #0000001a}.manual-calling-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.3rem;color:#333}.manual-call-btn[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;gap:1rem;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;padding:1.5rem 2rem;border-radius:10px;cursor:pointer;font-size:1.3rem;font-weight:600;margin-top:1.5rem;transition:all .3s}.manual-call-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px #0003}.manual-call-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-icon[_ngcontent-%COMP%]{font-size:1.8rem}.manual-call-note[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background:#e3f2fd;border-left:4px solid #2196f3;border-radius:4px;color:#1976d2;font-weight:500}.info-card[_ngcontent-%COMP%]{background:#fffffff2;border-radius:12px;padding:1.5rem;box-shadow:0 4px 20px #0000001a}.info-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.1rem;color:#333}.info-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.info-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.5rem 0;color:#555;font-size:.95rem}.info-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}@media (max-width: 768px){.dashboard-header[_ngcontent-%COMP%]{padding:1rem}.header-content[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;text-align:center}.dashboard-main[_ngcontent-%COMP%]{padding:1rem}.status-buttons[_ngcontent-%COMP%]{grid-template-columns:1fr}.timer-value[_ngcontent-%COMP%]{font-size:2rem}.status-badge[_ngcontent-%COMP%]{font-size:1.2rem;padding:.8rem 2rem}}"]});let n=l;return n})();export{ct as AgentStatusDashboardComponent};
