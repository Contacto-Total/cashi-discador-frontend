import{a as Ze}from"./chunk-MPYQV27Y.js";import{a as oe,b as He,c as qe,d as Xe,e as Qe,f as et,g as tt}from"./chunk-BC6CTONW.js";import"./chunk-H5XO3BH5.js";import"./chunk-DWBAJDF3.js";import{a as Ye,b as Je,c as We,d as Ge,e as I,i as Ke}from"./chunk-5OADF2WU.js";import{a as je,g as Ue}from"./chunk-3RTCAIOO.js";import{k as $e}from"./chunk-PHEXLXNE.js";import"./chunk-WMG735CR.js";import{f as ze}from"./chunk-FA6H6YFS.js";import"./chunk-GHZSHR7Q.js";import"./chunk-2KUQMYY5.js";import{B as ne,C as ie,e as Fe,l as Ve,o as de,q as N,s as me}from"./chunk-3LCGNP6X.js";import"./chunk-FI2LHONG.js";import{c as W}from"./chunk-FYMDUG3I.js";import"./chunk-3ZQDWBF5.js";import{D as ee,F as te,b as ke,c as G,e as K,f as q,g as Te,l as De,m as Le,n as Re,o as Ne,r as Ie,s as X,t as Z,u as Q,w as Be}from"./chunk-R365LOCT.js";import"./chunk-YQKVMPSG.js";import{$a as d,Bc as R,Db as V,F as be,Fc as $,G as F,Gc as Ee,K as xe,Kb as p,Lb as i,M as U,Mb as r,Nb as _,O as Ce,Rb as k,Sb as T,Ub as E,Wb as g,X as Me,Yb as u,a as j,b as _e,ba as ve,ca as ae,cd as H,dd as Y,ea as le,ed as ye,fb as se,fd as Ae,ga as C,gc as L,hc as we,ic as x,kc as l,lc as P,ld as J,m as he,ma as M,mb as D,mc as y,na as v,nb as ce,pb as Pe,qa as Oe,rb as b,ub as Se,wa as w}from"./chunk-FWGUXTKY.js";var nt=(()=>{class a{static \u0275fac=function(e){return new(e||a)};static \u0275mod=ce({type:a});static \u0275inj=ae({imports:[de,de]})}return a})();function ut(a,m){a&1&&(i(0,"div",53),l(1," El texto es obligatorio. "),r())}function ft(a,m){a&1&&(i(0,"div",54)(1,"label",55),l(2,"Sumar importe"),r(),_(3,"input",56),r())}function _t(a,m){if(a&1&&(i(0,"option",77),l(1),r()),a&2){let o=m.$implicit;p("value",o.key),d(),P(o.label)}}function ht(a,m){if(a&1){let o=E();i(0,"div",60)(1,"div",61)(2,"select",62),b(3,_t,2,2,"option",63),r(),i(4,"button",64),g("click",function(){M(o);let n=u().index,t=u();return v(t.removeRange(n))}),i(5,"span",65),l(6,"delete"),r()()(),i(7,"div",66),_(8,"input",67),i(9,"label",68),_(10,"input",69),i(11,"span",70),l(12),r()(),i(13,"div",71),l(14),r(),i(15,"label",68),_(16,"input",72),i(17,"span",70),l(18),r()(),_(19,"input",73),r(),i(20,"div",74)(21,"label",75)(22,"input",76),g("change",function(){let n;M(o);let t=u(),s=t.$implicit,c=t.index,f=u();return v(((n=s.get("mode"))==null?null:n.value)==="gt"?f.toggleUseMax(c,!1):f.toggleUseMin(c,!1))}),r(),i(23,"span"),l(24,"Desactivar intervalo"),r()()()()}if(a&2){let o,e,n,t=u().$implicit,s=u();d(3),p("ngForOf",s.rangeFields),d(9),P((o=t.get("inclusiveMin"))!=null&&o.value?"\u2264":"<"),d(2),y(" ",s.fieldLabel((e=t.get("field"))==null?null:e.value)||"Variable"," "),d(4),P((n=t.get("inclusiveMax"))!=null&&n.value?"\u2264":"<")}}function bt(a,m){if(a&1&&(i(0,"option",77),l(1),r()),a&2){let o=m.$implicit;p("value",o.key),d(),P(o.label)}}function xt(a,m){if(a&1&&(k(0),_(1,"input",89),i(2,"label",75),_(3,"input",69),i(4,"span"),l(5),r()(),T()),a&2){let o,e=u(2).$implicit;d(5),P((o=e.get("inclusiveMin"))!=null&&o.value?"\u2265":">")}}function Ct(a,m){if(a&1&&(k(0),_(1,"input",90),i(2,"label",75),_(3,"input",72),i(4,"span"),l(5),r()(),T()),a&2){let o,e=u(2).$implicit;d(5),P((o=e.get("inclusiveMax"))!=null&&o.value?"\u2264":"<")}}function Mt(a,m){if(a&1){let o=E();k(0),i(1,"input",91),g("change",function(n){M(o);let t=u(2).index,s=u();return v(s.toggleUseMax(t,n.target.checked))}),r(),i(2,"span"),l(3,"a\xF1adir l\xEDmite"),r(),T()}if(a&2){let o,e=u(2).$implicit;d(),p("checked",(o=e.get("useMax"))==null?null:o.value)}}function vt(a,m){if(a&1){let o=E();k(0),i(1,"input",91),g("change",function(n){M(o);let t=u(2).index,s=u();return v(s.toggleUseMin(t,n.target.checked))}),r(),i(2,"span"),l(3,"a\xF1adir l\xEDmite inferior"),r(),T()}if(a&2){let o,e=u(2).$implicit;d(),p("checked",(o=e.get("useMin"))==null?null:o.value)}}function Ot(a,m){if(a&1){let o=E();i(0,"div",78)(1,"select",79),b(2,bt,2,2,"option",63),r(),i(3,"select",80),g("change",function(n){M(o);let t=u().index,s=u();return v(s.changeOperator(t,n.target.value))}),i(4,"option",81),l(5,">"),r(),i(6,"option",82),l(7,"<"),r()(),i(8,"div",83),k(9,84),b(10,xt,6,1,"ng-container",85)(11,Ct,6,1,"ng-container",85),T(),r(),i(12,"button",86),g("click",function(){M(o);let n=u().index,t=u();return v(t.removeRange(n))}),i(13,"span",65),l(14,"delete"),r()()(),i(15,"div",87)(16,"label",75),b(17,Mt,4,1,"ng-container",88)(18,vt,4,1,"ng-container",88),r()()}if(a&2){let o,e,n,t,s=u().$implicit,c=u();d(2),p("ngForOf",c.rangeFields),d(),p("value",(o=s.get("mode"))==null?null:o.value),d(6),p("ngSwitch",(e=s.get("mode"))==null?null:e.value),d(),p("ngSwitchCase","gt"),d(),p("ngSwitchCase","lt"),d(6),p("ngIf",((n=s.get("mode"))==null?null:n.value)==="gt"),d(),p("ngIf",((t=s.get("mode"))==null?null:t.value)==="lt")}}function Pt(a,m){a&1&&(i(0,"div",92),l(1," \u26A0\uFE0F El m\xEDnimo no puede ser mayor que el m\xE1ximo. "),r())}function St(a,m){if(a&1&&(i(0,"div",57),b(1,ht,25,4,"div",58)(2,Ot,19,7,"ng-template",null,0,R)(4,Pt,2,0,"div",59),r()),a&2){let o,e=m.$implicit,n=L(3);p("formGroup",e),d(),p("ngIf",((o=e.get("useMin"))==null?null:o.value)&&((o=e.get("useMax"))==null?null:o.value))("ngIfElse",n),d(3),p("ngIf",e.errors==null?null:e.errors.rangeOrder)}}var wt=/\{([A-Z0-9_]+)\}/gi,it=(()=>{let m=class m{constructor(){this.dialog=C(I),this.router=C(W),this.dialogRef=C(We),this.data=C(Ge),this.fb=C(ee),this.api=C(oe),this.submitted=!1,this.saving=!1,this.chips=[{key:"NOMBRE",label:"Nombre",affectsSelects:!0},{key:"LTD",label:"LTD",affectsSelects:!0},{key:"LTDE",label:"LTDE",affectsSelects:!0},{key:"LTD_LTDE",label:"LTD + LTDE",affectsSelects:!0},{key:"BAJA30",label:"Baja 30",affectsSelects:!0},{key:"SALDO_MORA",label:"Mora",affectsSelects:!0},{key:"BAJA30_SALDOMORA",label:"Baja30 + Mora",affectsSelects:!0},{key:"CAPITAL",label:"Capital",affectsSelects:!0},{key:"DEUDA_TOTAL",label:"Deuda Total",affectsSelects:!0},{key:"PKM",label:"PKM",affectsSelects:!0},{key:"NOMBRECOMPLETO",label:"Nombre completo",affectsSelects:!0},{key:"EMAIL",label:"Correo",affectsSelects:!0},{key:"NUMCUENTAPMCP",label:"N\xB0 de Cuenta",affectsSelects:!0},{key:"DIASMORA",label:"D\xEDas mora",affectsSelects:!0},{key:"HOY",label:"Hoy",affectsSelects:!1},{key:"MANANA",label:"Ma\xF1ana",affectsSelects:!1}],this.rangeFields=[{key:"DEUDA_TOTAL",label:"Deuda total"},{key:"CAPITAL",label:"Capital"},{key:"SALDO_MORA",label:"Saldo mora"},{key:"BAJA30",label:"Baja 30"},{key:"LTD",label:"LTD"},{key:"LTDE",label:"LTDE"},{key:"PKM",label:"PKM"},{key:"DIASMORA",label:"D\xEDas mora"}],this.selected=new Set(this.data?.selects??[]),this.form=this.fb.nonNullable.group({nombre:this.data.name??"",plantillaTexto:["",[K.required,K.maxLength(612)]],descripcion:this.data.descripcion??"",tramo:this.data.tramo??"3",noContenido:this.data.restricciones?.noContenido??!0,excluirPromesasPeriodoActual:this.data.restricciones?.excluirPromesasPeriodoActual??!0,excluirCompromisos:this.data.restricciones?.excluirCompromisos??!0,excluirBlacklist:this.data.restricciones?.excluirBlacklist??!0,cond_PROMESAS_HOY:(this.data.condiciones??[]).includes("PROMESAS_HOY"),cond_PROMESAS_MANANA:(this.data.condiciones??[]).includes("PROMESAS_MANANA"),cond_PROMESAS_MANANA2:(this.data.condiciones??[]).includes("PROMESAS_MANANA2"),cond_PROMESAS_ROTAS:(this.data.condiciones??[]).includes("PROMESAS_ROTAS"),importeExtra:this.fb.nonNullable.control(this.data?.importeExtra??0),rangos:this.fb.array([])}),this.SMS_MAX=160,this.sampleRow=w(null),this.previewText=$(()=>this.renderTemplate(this.smsCtrl.value,this.sampleRow())),this.Math=Math}hasTopUpSelect(){return this.selected.has("LTD")||this.selected.has("LTDE")||this.selected.has("LTD_LTDE")}get rangosFA(){return this.form.get("rangos")}validateRange(){return e=>{let n=e,t=!!n.get("useMin")?.value,s=!!n.get("useMax")?.value,c=n.get("min")?.value,f=n.get("max")?.value;return!t&&!s?null:t&&(c==null||c==="")?{minRequired:!0}:s&&(f==null||f==="")?{maxRequired:!0}:t&&s&&Number(c)>Number(f)?{rangeOrder:!0}:null}}makeRange(){return this.fb.nonNullable.group({field:this.fb.nonNullable.control("DEUDA_TOTAL",{validators:[K.required]}),mode:this.fb.nonNullable.control("gt"),useMin:this.fb.nonNullable.control(!1),min:this.fb.control(null),inclusiveMin:this.fb.nonNullable.control(!1),useMax:this.fb.nonNullable.control(!1),max:this.fb.control(null),inclusiveMax:this.fb.nonNullable.control(!0)},{validators:[this.validateRange()]})}addRange(){this.rangosFA.push(this.makeRange())}removeRange(e){this.rangosFA.removeAt(e)}changeOperator(e,n){let t=this.rangosFA.at(e);t.get("mode")?.setValue(n),n==="gt"?(t.get("useMin")?.setValue(!0),t.get("useMax")?.setValue(!1),t.get("max")?.setValue(null)):(t.get("useMin")?.setValue(!1),t.get("useMax")?.setValue(!0),t.get("min")?.setValue(null))}toggleUseMin(e,n){let t=this.rangosFA.at(e);t.get("useMin")?.setValue(n),n||t.get("min")?.setValue(null)}toggleUseMax(e,n){let t=this.rangosFA.at(e);t.get("useMax")?.setValue(n),n||t.get("max")?.setValue(null)}fieldLabel(e){let n=String(e||"").toUpperCase();return this.rangeFields.find(s=>s.key===n)?.label??n}aliasKeys(e){let n=e.toUpperCase();switch(n){case"MORA":case"SALDO_MORA":return["SALDO_MORA","MORA","SALDO MORA"];case"BAJA30":return["BAJA30","BAJA_30","BAJA 30"];case"BAJA30_SALDOMORA":return["BAJA30_SALDOMORA","BAJA30_SALDO_MORA","BAJA 30 SALDO MORA"];case"DEUDA_TOTAL":return["DEUDA_TOTAL","DEUDA TOTAL"];case"LTD_LTDE":return["LTD_LTDE","LTD+LTDE","LTD LTDE"];default:return[n,n.replace(/\s+/g,"_")]}}getVal(e,n){let t=this.aliasKeys(n);for(let s of t)if(e.hasOwnProperty(s))return e[s]}get smsCtrl(){return this.form.controls.plantillaTexto}smsLength(){return(this.smsCtrl.value||"").length}smsSegundos(){let e=this.smsLength();return Math.max(1,Math.ceil(e/20))}ngOnInit(){let e=this.data?.plantillaTexto??"";e&&typeof e=="string"?(this.smsCtrl.setValue(e),this.smsCtrl.markAsPristine(),this.syncNombreChipWithText(),this.fetchSampleRow()):this.data.plantillaSmsId&&this.api.getPlantillaTexto(this.data.plantillaSmsId).subscribe({next:t=>{let s=typeof t=="string"?t:t?.template??"";this.smsCtrl.setValue(s||""),this.smsCtrl.markAsPristine(),this.syncNombreChipWithText(),this.fetchSampleRow()},error:t=>{this.smsCtrl.setValue(""),this.smsCtrl.markAsPristine(),this.syncNombreChipWithText(),this.fetchSampleRow()}}),this.fetchSampleRow(),this.smsCtrl.valueChanges.pipe(xe(200)).subscribe(()=>{this.syncNombreChipWithText(),this.fetchSampleRow()});let n=this.data?.rangos;Array.isArray(n)&&n.length?this.hydrateRanges(n):this.api.get(this.data.id).subscribe({next:t=>{let s=t?.rangos;Array.isArray(s)&&s.length&&(this.rangosFA.clear(),this.hydrateRanges(s))}})}hydrateRanges(e){for(let n of e){let t=this.makeRange();t.get("field")?.setValue(String(n.field||"DEUDA_TOTAL").toUpperCase()),t.get("inclusiveMin")?.setValue(n.inclusiveMin??n.inclusive_min??!1),t.get("inclusiveMax")?.setValue(n.inclusiveMax??n.inclusive_max??!0);let s=n.min!=null,c=n.max!=null;if(s&&c)t.get("mode")?.setValue("gt"),t.get("useMin")?.setValue(!0),t.get("useMax")?.setValue(!0);else if(s)t.get("mode")?.setValue("gt"),t.get("useMin")?.setValue(!0),t.get("useMax")?.setValue(!1);else if(c)t.get("mode")?.setValue("lt"),t.get("useMin")?.setValue(!1),t.get("useMax")?.setValue(!0);else continue;t.get("min")?.setValue(s?Number(n.min):null),t.get("max")?.setValue(c?Number(n.max):null),t.get("inclusiveMin")?.setValue(!!n.inclusiveMin),t.get("inclusiveMax")?.setValue(!!n.inclusiveMax),this.rangosFA.push(t)}}fetchSampleRow(){this.api.previewFromCombo(this.data.id,100).subscribe({next:e=>this.sampleRow.set(e?.[0]??null),error:()=>this.sampleRow.set(null)})}renderTemplate(e,n){if(!e)return"";if(!n)return e;let t=n,s=O=>String(O??"").split(/\s+/)[0]||"",c=O=>Number.isFinite(Number(O))?Math.trunc(Number(O)).toLocaleString("es-PE"):"",f=new Date,h=new Date(f.getTime()+864e5),S=O=>O.toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit"});return e.replace(wt,(O,B)=>{let A=String(B).toUpperCase();switch(A){case"NOMBRE":return s(this.getVal(t,"NOMBRE"));case"HOY":return S(f);case"MANANA":return S(h);case"DIASMORA":case"LTD":case"LTDE":case"LTD_LTDE":case"BAJA30":case"SALDO_MORA":case"BAJA30_SALDOMORA":case"CAPITAL":case"DEUDA_TOTAL":case"PKM":return c(this.getVal(t,A));default:let z=this.getVal(t,A);return z===void 0?"":String(z)}})}onChipClick(e,n){e.preventDefault(),e.stopPropagation(),this.toggleSelect(n)}placeholderFromKey(e){return e}hasSelect(e){if(e==="NOMBRE"){let n=this.form.controls.plantillaTexto.value||"";return/\{NOMBRE\}/i.test(n)}return this.selected.has(e)}toggleSelect(e){let n=this.selected.has(e),t=this.placeholderFromKey(e);n?(this.selected.delete(e),this.removePlaceholder(t)):((e==="BAJA30"||e==="SALDO_MORA")&&this.forceDeselect("BAJA30_SALDOMORA"),e==="BAJA30_SALDOMORA"&&(this.forceDeselect("BAJA30"),this.forceDeselect("SALDO_MORA")),(e==="LTD"||e==="LTDE")&&this.forceDeselect("LTD_LTDE"),e==="LTD_LTDE"&&(this.forceDeselect("LTD"),this.forceDeselect("LTDE")),this.selected.add(e),this.insertPlaceholderOnce(t)),this.hasTopUpSelect()||this.form.controls.importeExtra.setValue(0)}close(){this.dialogRef.close()}save(){if(this.submitted=!0,this.form.invalid){this.smsCtrl.markAsTouched();return}let e=this.form.getRawValue(),n=[];e.cond_PROMESAS_HOY&&n.push("PROMESAS_HOY"),e.cond_PROMESAS_MANANA&&n.push("PROMESAS_MANANA"),e.cond_PROMESAS_MANANA2&&n.push("PROMESAS_MANANA2"),e.cond_PROMESAS_ROTAS&&n.push("PROMESAS_ROTAS");let t=this.hasTopUpSelect()&&Number(e.importeExtra)>0?Math.trunc(Number(e.importeExtra)):null,s=new Set(this.selected);/\{NOMBRE\}/i.test(e.plantillaTexto||"")&&s.add("NOMBRE");let c=this.rangosFA.controls.map(h=>{let S=String(h.get("field")?.value||"").toUpperCase(),O=!!h.get("useMin")?.value,B=!!h.get("useMax")?.value,A=h.get("min")?.value,z=h.get("max")?.value,ue=Number(A),fe=Number(z);return{field:S,min:O&&Number.isFinite(ue)?ue:void 0,max:B&&Number.isFinite(fe)?fe:void 0,inclusiveMin:!!h.get("inclusiveMin")?.value,inclusiveMax:!!h.get("inclusiveMax")?.value}}).filter(h=>h.min!=null||h.max!=null),f={id:this.data.id,name:e.nombre,descripcion:e.descripcion,tramo:e.tramo,selects:Array.from(s),restricciones:{noContenido:!!e.noContenido,excluirPromesasPeriodoActual:!!e.excluirPromesasPeriodoActual,excluirCompromisos:!!e.excluirCompromisos,excluirBlacklist:!!e.excluirBlacklist},plantillaSmsId:this.data.plantillaSmsId??null,plantillaTexto:e.plantillaTexto,plantillaName:e.nombre,condiciones:n,importeExtra:t,rangos:c.length?c:[]};this.saving=!0,this.api.update(this.data.id,f).subscribe({next:()=>{this.saving=!1,this.showSuccess("Cambios guardados","Se actualizaron los datos del combo.").subscribe(()=>{this.dialogRef.close(!0),this.router.navigate(["/SMS"])})},error:()=>{this.saving=!1,this.dialogRef.close(!1)}})}insertPlaceholderOnce(e){let n=this.form.controls.plantillaTexto,t=n.value??"";if(new RegExp(`\\{${e}\\}(?!\\w)`,"i").test(t))return;let c=t&&!t.endsWith(" ")?" ":"";n.setValue(t+`${c}{${e}}`),n.markAsDirty()}removePlaceholder(e){let n=this.form.controls.plantillaTexto,t=n.value??"",s=new RegExp(`\\s*\\{${e}\\}`,"i"),c=t.replace(s,"");c!==t&&(n.setValue(c),n.markAsDirty())}showSuccess(e,n,t=1800){return this.dialog.open(Qe,{data:{title:e,message:n,autoCloseMs:t},panelClass:"dialog-success",disableClose:!0}).afterClosed()}syncNombreChipWithText(){/\{NOMBRE\}/i.test(this.smsCtrl.value||"")?this.selected.add("NOMBRE"):this.selected.delete("NOMBRE")}forceDeselect(e){this.selected.has(e)&&(this.selected.delete(e),this.removePlaceholder(this.placeholderFromKey(e)))}isChipDisabled(e){return this.selected.has(e)?!1:e==="BAJA30_SALDOMORA"?this.selected.has("BAJA30")||this.selected.has("SALDO_MORA"):e==="BAJA30"||e==="SALDO_MORA"?this.selected.has("BAJA30_SALDOMORA"):e==="LTD_LTDE"?this.selected.has("LTD")||this.selected.has("LTDE"):e==="LTD"||e==="LTDE"?this.selected.has("LTD_LTDE"):!1}};m.\u0275fac=function(n){return new(n||m)},m.\u0275cmp=D({type:m,selectors:[["app-edit-combo-dialog"]],decls:135,vars:52,consts:[["singleMode",""],["novalidate","",1,"dlg",2,"display","flex","flex-direction","column","width","640px","max-height","80vh",3,"ngSubmit","formGroup"],[1,"dlg__head",2,"flex","0 0 auto"],["type","button","aria-label","Cerrar",1,"icon-btn",3,"click"],[1,"dlg__body",2,"flex","1 1 auto","overflow","auto","padding-right","8px"],[1,"grid"],[1,"full"],["formControlName","nombre","type","text","placeholder","Nombre del combo"],[1,"row-between"],[1,"req"],["formControlName","plantillaTexto","rows","5","placeholder","Hola {NOMBRE}, \u2026"],["class","error",4,"ngIf"],[1,"preview-box"],[1,"character-meter"],[1,"character-bar"],[1,"character-count"],[1,"adv",2,"margin-top","16px"],[1,"adv__title",2,"font-weight","600","background","#f6f7f9","padding","12px 16px","border-radius","10px"],[1,"grid",2,"margin-top","12px"],[1,"group-card","group--tramo"],["formControlName","tramo"],["value","3"],["value","5"],["value","CONTACTO_TOTAL"],[1,"group-card","group--selects"],[1,"chip-groups"],[1,"chip-group","chip-group--cliente"],[1,"chip-group-title"],[1,"chip-container"],["type","button",1,"chip",3,"click"],[1,"chip-group","chip-group--financiero"],["type","button",1,"chip",3,"click","disabled"],[1,"chip-group","chip-group--fechas"],["class","form-field",4,"ngIf"],[1,"group-card","group--rangos"],[1,"group-title",2,"display","flex","align-items","center","justify-content","space-between","gap","8px"],["type","button",1,"btn","btn-secondary",3,"click"],["class","range-item",3,"formGroup",4,"ngFor","ngForOf"],[1,"group-card","group--cond"],[1,"group-title"],[1,"checks"],["type","checkbox","formControlName","cond_PROMESAS_HOY"],["type","checkbox","formControlName","cond_PROMESAS_MANANA"],["type","checkbox","formControlName","cond_PROMESAS_MANANA2"],["type","checkbox","formControlName","cond_PROMESAS_ROTAS"],[1,"group-card","group--restr"],["type","checkbox","formControlName","noContenido"],["type","checkbox","formControlName","excluirPromesasPeriodoActual"],["type","checkbox","formControlName","excluirCompromisos"],["type","checkbox","formControlName","excluirBlacklist"],[1,"dlg__foot",2,"flex","0 0 auto"],["type","button","mat-button","",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],[1,"error"],[1,"form-field"],[1,"form-label"],["type","number","min","0","step","1","formControlName","importeExtra","placeholder","0",1,"form-input"],[1,"range-item",3,"formGroup"],["class","interval-mode",4,"ngIf","ngIfElse"],["class","hint error-inline",4,"ngIf"],[1,"interval-mode"],[1,"interval-header"],["formControlName","field","title","Campo",1,"form-select","slim","interval-field"],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-danger","btn-small",3,"click"],[1,"material-icons"],[1,"interval-expression"],["type","number","formControlName","min","placeholder","m\xEDn",1,"form-input","slim","interval-input"],[1,"interval-check"],["type","checkbox","formControlName","inclusiveMin"],[1,"interval-symbol"],[1,"interval-variable"],["type","checkbox","formControlName","inclusiveMax"],["type","number","formControlName","max","placeholder","m\xE1x",1,"form-input","slim","interval-input"],[1,"interval-footer"],[1,"tiny-check"],["type","checkbox","checked","",3,"change"],[3,"value"],[1,"range-row"],["formControlName","field","title","Campo",1,"form-select","slim","col-field"],["title","Operador",1,"form-select","slim","col-op",3,"change","value"],["value","gt"],["value","lt"],[1,"value-box","col-value"],[3,"ngSwitch"],[4,"ngSwitchCase"],["type","button",1,"btn","btn-danger","btn-small","col-del",3,"click"],[1,"hint",2,"margin","8px 0 0 0"],[4,"ngIf"],["type","number","formControlName","min","placeholder","valor m\xEDnimo",1,"form-input","slim"],["type","number","formControlName","max","placeholder","valor m\xE1ximo",1,"form-input","slim"],["type","checkbox",3,"change","checked"],[1,"hint","error-inline"]],template:function(n,t){n&1&&(i(0,"form",1),g("ngSubmit",function(){return t.save()}),i(1,"header",2)(2,"h2"),l(3,"Editar"),r(),i(4,"button",3),g("click",function(){return t.close()}),l(5,"\u2715"),r()(),i(6,"section",4)(7,"div",5)(8,"div",6)(9,"label"),l(10,"Nombre"),r(),_(11,"input",7),r(),i(12,"div",6)(13,"div",8)(14,"label"),l(15,"Texto de SMS (Plantilla) "),i(16,"span",9),l(17,"*"),r()()(),_(18,"textarea",10),b(19,ut,2,0,"div",11),i(20,"label"),l(21,"Preview"),r(),i(22,"div",12),l(23),r(),i(24,"div",13),_(25,"div",14),r(),i(26,"div",15),l(27),r()()(),i(28,"section",16)(29,"div",17),l(30," Opciones avanzadas "),r(),i(31,"div",18)(32,"div",19)(33,"label"),l(34,"Tramo"),r(),i(35,"select",20)(36,"option",21),l(37,"Tramo 3"),r(),i(38,"option",22),l(39,"Tramo 5"),r(),i(40,"option",23),l(41,"Cartera Propia"),r()()(),i(42,"div",24)(43,"label"),l(44,"Selecci\xF3n"),r(),i(45,"div",25)(46,"div",26)(47,"h4",27),l(48,"Cliente"),r(),i(49,"div",28)(50,"button",29),g("click",function(c){return t.onChipClick(c,"NOMBRE")}),l(51,"Nombre"),r(),i(52,"button",29),g("click",function(c){return t.onChipClick(c,"NOMBRECOMPLETO")}),l(53,"Nombre completo"),r(),i(54,"button",29),g("click",function(c){return t.onChipClick(c,"EMAIL")}),l(55,"Correo"),r(),i(56,"button",29),g("click",function(c){return t.onChipClick(c,"NUMCUENTAPMCP")}),l(57,"N\xB0 de Cuenta"),r()()(),i(58,"div",30)(59,"h4",27),l(60,"Financiero"),r(),i(61,"div",28)(62,"button",31),g("click",function(c){return t.onChipClick(c,"LTD")}),l(63,"LTD"),r(),i(64,"button",31),g("click",function(c){return t.onChipClick(c,"LTDE")}),l(65,"LTDE"),r(),i(66,"button",31),g("click",function(c){return t.onChipClick(c,"LTD_LTDE")}),l(67,"LTD + LTDE"),r(),i(68,"button",31),g("click",function(c){return t.onChipClick(c,"BAJA30")}),l(69,"Baja 30"),r(),i(70,"button",31),g("click",function(c){return t.onChipClick(c,"SALDO_MORA")}),l(71,"Mora"),r(),i(72,"button",31),g("click",function(c){return t.onChipClick(c,"BAJA30_SALDOMORA")}),l(73,"Baja 30 y Saldo Mora"),r(),i(74,"button",29),g("click",function(c){return t.onChipClick(c,"PKM")}),l(75,"PKM"),r(),i(76,"button",29),g("click",function(c){return t.onChipClick(c,"CAPITAL")}),l(77,"Capital"),r(),i(78,"button",29),g("click",function(c){return t.onChipClick(c,"DEUDA_TOTAL")}),l(79,"Deuda Total"),r()()(),i(80,"div",32)(81,"h4",27),l(82,"Fechas"),r(),i(83,"div",28)(84,"button",29),g("click",function(c){return t.onChipClick(c,"DIASMORA")}),l(85,"D\xEDas mora"),r(),i(86,"button",29),g("click",function(c){return t.onChipClick(c,"HOY")}),l(87,"Hoy"),r(),i(88,"button",29),g("click",function(c){return t.onChipClick(c,"MANANA")}),l(89,"Ma\xF1ana"),r()()()(),b(90,ft,4,0,"div",33),r(),i(91,"div",34)(92,"div",35)(93,"span"),l(94,"Rangos"),r(),i(95,"button",36),g("click",function(){return t.addRange()}),l(96," + A\xF1adir rango "),r()(),b(97,St,5,4,"div",37),r(),i(98,"div",38)(99,"div",39),l(100,"Condiciones"),r(),i(101,"div",40)(102,"label"),_(103,"input",41),l(104," Promesas HOY"),r(),i(105,"label"),_(106,"input",42),l(107," Promesas MA\xD1ANA"),r(),i(108,"label"),_(109,"input",43),l(110," Promesas HOY y MA\xD1ANA"),r(),i(111,"label"),_(112,"input",44),l(113," Promesas ROTAS"),r()()(),i(114,"div",45)(115,"div",39),l(116,"Restricciones"),r(),i(117,"div",40)(118,"label"),_(119,"input",46),l(120," No Contenido"),r(),i(121,"label"),_(122,"input",47),l(123," Excluir promesas periodo"),r(),i(124,"label"),_(125,"input",48),l(126," Excluir compromisos"),r(),i(127,"label"),_(128,"input",49),l(129," Excluir blacklist"),r()()()()()(),i(130,"footer",50)(131,"button",51),g("click",function(){return t.close()}),l(132,"Cancelar"),r(),i(133,"button",52),l(134),r()()()),n&2&&(p("formGroup",t.form),d(19),p("ngIf",t.smsCtrl.invalid&&(t.smsCtrl.dirty||t.submitted)),d(4),y(" ",t.previewText()||"Tu SMS aparecer\xE1 aqu\xED\u2026"," "),d(2),we("width",t.Math.min(t.previewText().length/160*100,100),"%"),x("warning",t.previewText().length>120)("danger",t.previewText().length>160),d(2),y(" ",t.previewText().length," / 160 "),d(23),x("active",t.hasSelect("NOMBRE")),d(2),x("active",t.hasSelect("NOMBRECOMPLETO")),d(2),x("active",t.hasSelect("EMAIL")),d(2),x("active",t.hasSelect("NUMCUENTAPMCP")),d(6),x("active",t.hasSelect("LTD")),p("disabled",t.isChipDisabled("LTD")),d(2),x("active",t.hasSelect("LTDE")),p("disabled",t.isChipDisabled("LTDE")),d(2),x("active",t.hasSelect("LTD_LTDE")),p("disabled",t.isChipDisabled("LTD_LTDE")),d(2),x("active",t.hasSelect("BAJA30")),p("disabled",t.isChipDisabled("BAJA30")),d(2),x("active",t.hasSelect("SALDO_MORA")),p("disabled",t.isChipDisabled("SALDO_MORA")),d(2),x("active",t.hasSelect("BAJA30_SALDOMORA")),p("disabled",t.isChipDisabled("BAJA30_SALDOMORA")),d(2),x("active",t.hasSelect("PKM")),d(2),x("active",t.hasSelect("CAPITAL")),d(2),x("active",t.hasSelect("DEUDA_TOTAL")),d(6),x("active",t.hasSelect("DIASMORA")),d(2),x("active",t.hasSelect("HOY")),d(2),x("active",t.hasSelect("MANANA")),d(2),p("ngIf",t.hasTopUpSelect()),d(7),p("ngForOf",t.rangosFA.controls),d(36),p("disabled",t.form.invalid||t.saving),d(),y(" ",t.saving?"Guardando\u2026":"Guardar"," "))},dependencies:[J,H,Y,ye,Ae,te,De,Z,Q,G,Le,ke,X,q,Te,Be,Ne,Ie,ie,ne,qe,Xe,Ze],styles:["[_nghost-%COMP%]     .combo-dialog .mdc-dialog__surface{border-radius:16px!important;overflow:hidden}.dlg[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:80vh}.dlg__head[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid #e5e7eb}.dlg__head[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;font-weight:700}.icon-btn[_ngcontent-%COMP%]{border:none;background:transparent;font-size:18px;margin-left:auto;cursor:pointer}.dlg__body[_ngcontent-%COMP%]{padding:16px 18px 10px}.dlg__foot[_ngcontent-%COMP%]{padding:12px 18px;border-top:1px solid #e5e7eb;background:#fff;box-shadow:0 -6px 12px -10px #0000001f}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}.grid[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{grid-column:span 6}.grid[_ngcontent-%COMP%]   .full[_ngcontent-%COMP%]{grid-column:1/-1}label[_ngcontent-%COMP%]{margin-bottom:6px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;border:1.5px solid #d1d5db;border-radius:10px;padding:10px 12px;outline:none;background:#fff;color:#0f172a;transition:.15s border,.15s box-shadow}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{border-color:#6366f1;box-shadow:0 0 0 3px #6366f126}textarea[_ngcontent-%COMP%]{resize:vertical}.req[_ngcontent-%COMP%]{color:#ef4444;font-weight:700}.row-between[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.muted[_ngcontent-%COMP%]{color:#6b7280;font-size:.85rem}.hint[_ngcontent-%COMP%]{color:#64748b;font-size:.85rem;margin-top:6px}.error[_ngcontent-%COMP%]{color:#ef4444;margin-top:6px}.chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px 12px}.chip[_ngcontent-%COMP%]{appearance:none;border:1px solid #cfd8dc;background:#fff;color:#111827;border-radius:999px;padding:8px 14px;font-weight:600;line-height:1.1;cursor:pointer;transition:background .15s,border-color .15s,transform .04s;box-shadow:0 1px #00000005}.chip[_ngcontent-%COMP%]:hover{background:#f8fafc}.chip[_ngcontent-%COMP%]:active{transform:translateY(1px)}.chip[_ngcontent-%COMP%]:focus-visible{outline:2px solid #6366f1;outline-offset:2px}.adv[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]{cursor:pointer;padding:10px 14px;background:#f8fafc;font-weight:700}.adv[open][_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]{border-bottom:1px solid #e5e7eb}.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]{padding:14px 16px;gap:16px}@media (min-width: 980px){.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(1){grid-column:span 4}.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(2){grid-column:1 / -1}.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(3){grid-column:span 6}}@media (max-width: 980px){.grid[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{grid-column:1/-1}}.preview-box[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2c3e50,#34495e);color:#fff;padding:16px;border-radius:12px;min-height:100px;margin-bottom:16px;font-family:monospace;font-size:14px;line-height:1.5}.character-meter[_ngcontent-%COMP%]{background:#f3f4f6;height:8px;border-radius:4px;overflow:hidden;margin-bottom:8px}.character-bar[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#10b981,#059669);transition:all .3s ease;border-radius:4px}.character-bar.warning[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f59e0b,#d97706)}.character-bar.danger[_ngcontent-%COMP%]{background:linear-gradient(90deg,#ef4444,#dc2626)}.character-count[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;text-align:right}@media (max-width: 980px){.checks[_ngcontent-%COMP%]{grid-template-columns:1fr}}.checks[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:12px;width:100%}.checks[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;line-height:1.25;-webkit-user-select:none;user-select:none;cursor:pointer;transition:border-color .15s,box-shadow .15s,background .15s}.checks[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover{border-color:#cbd5e1;box-shadow:0 2px 10px -8px #00000040}.checks[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:has(input:checked){border-color:#4f46e5;background:#eef2ff;box-shadow:0 0 0 3px #4f46e51f inset}.checks[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{transform:scale(1.05);margin-top:1px;width:16px}.chip-groups[_ngcontent-%COMP%]{display:grid;gap:12px}.chip-group[_ngcontent-%COMP%]{border:1px solid #e9ecf3;background:#fff;border-radius:12px;padding:12px}.chip-group-title[_ngcontent-%COMP%]{margin:0 0 8px;font-size:14px;font-weight:600;color:#4b587c}.chip-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;align-items:center}.chip[_ngcontent-%COMP%]{padding:8px 14px;border-radius:999px;border:1px solid #dfe3ee;background:#f8f9fc;cursor:pointer;font-size:13px}.chip-group--cliente[_ngcontent-%COMP%], .chip-group--financiero[_ngcontent-%COMP%], .chip-group--fechas[_ngcontent-%COMP%]{--group-accent: #445ab8;--group-accent-2: #282e61}.chip.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--group-accent, #764ba2) 0%,var(--group-accent-2, #764ba2) 100%);border-color:var(--group-accent, #667eea);color:#fff;box-shadow:0 4px 12px #0003}.form-label[_ngcontent-%COMP%]{display:block;font-weight:500;color:#374151;margin-top:25px;margin-bottom:8px;font-size:14px}.chip[disabled][_ngcontent-%COMP%]{opacity:.45;cursor:not-allowed;pointer-events:none}.adv[_ngcontent-%COMP%]{margin-top:12px;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}.adv__title[_ngcontent-%COMP%]{font-weight:600;background:#f6f7f9;padding:12px 16px;border-bottom:1px solid #e5e7eb}.group-card[_ngcontent-%COMP%]{border:1px solid #e5e7eb;background:#fff;border-radius:12px;padding:12px}.group-title[_ngcontent-%COMP%]{margin:0 0 10px;font-size:14px;font-weight:600;color:#374151}@media (min-width: 980px){.group--tramo[_ngcontent-%COMP%]{grid-column:span 4}.group--selects[_ngcontent-%COMP%]{grid-column:1 / -1}.group--cond[_ngcontent-%COMP%], .group--restr[_ngcontent-%COMP%]{grid-column:span 6}}@media (max-width: 980px){.group--tramo[_ngcontent-%COMP%], .group--selects[_ngcontent-%COMP%], .group--cond[_ngcontent-%COMP%], .group--restr[_ngcontent-%COMP%]{grid-column:1 / -1}}.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]{padding:14px 16px;gap:16px;display:grid;grid-template-columns:repeat(12,1fr)}@media (min-width: 980px){.group--tramo[_ngcontent-%COMP%]{grid-column:span 4}.group--selects[_ngcontent-%COMP%], .group--rangos[_ngcontent-%COMP%]{grid-column:1 / -1}.group--cond[_ngcontent-%COMP%]{grid-column:1 / span 6}.group--restr[_ngcontent-%COMP%]{grid-column:7 / span 6}}@media (max-width: 980px){.group--tramo[_ngcontent-%COMP%], .group--selects[_ngcontent-%COMP%], .group--rangos[_ngcontent-%COMP%], .group--cond[_ngcontent-%COMP%], .group--restr[_ngcontent-%COMP%]{grid-column:1 / -1}}@media (min-width: 980px){.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]{display:grid!important;grid-template-columns:repeat(12,1fr)!important;gap:16px!important}.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%] > .group--rangos[_ngcontent-%COMP%]{grid-column:1 / -1!important}.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%] > .group--cond[_ngcontent-%COMP%]{grid-column:1 / span 6!important}.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%] > .group--restr[_ngcontent-%COMP%]{grid-column:7 / span 6!important}}@media (max-width: 980px){.adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%] > .group--rangos[_ngcontent-%COMP%], .adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%] > .group--cond[_ngcontent-%COMP%], .adv[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%] > .group--restr[_ngcontent-%COMP%]{grid-column:1 / -1!important}}.group--rangos[_ngcontent-%COMP%]   .range-item[_ngcontent-%COMP%]{display:block;width:100%;box-sizing:border-box;margin-bottom:12px}.group--rangos[_ngcontent-%COMP%]   .range-list[_ngcontent-%COMP%], .group--rangos[_ngcontent-%COMP%]   .range-container[_ngcontent-%COMP%]{display:block}.btn[_ngcontent-%COMP%]{padding:12px 24px;border:none;border-radius:12px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;display:inline-flex;align-items:center;justify-content:center;gap:8px}.btn-small[_ngcontent-%COMP%]{padding:8px 12px;font-size:12px;border-radius:10px;line-height:1}.btn-danger[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;box-shadow:0 4px 16px #ef44444d}.btn-danger[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 8px 24px #ef444466}.btn-secondary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;box-shadow:0 4px 16px #8b5cf64d}.btn-secondary[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 8px 24px #8b5cf666}.group--rangos[_ngcontent-%COMP%]{display:block}.group--rangos[_ngcontent-%COMP%]   .range-item[_ngcontent-%COMP%]{background:#fafafa;border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 1px #00000005 inset}.interval-mode[_ngcontent-%COMP%]{background:#f8fafc;border:2px solid #e2e8f0;border-radius:12px;padding:16px}.interval-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:12px}.interval-header[_ngcontent-%COMP%]   .interval-field[_ngcontent-%COMP%]{flex:1;max-width:300px}.interval-expression[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:16px;padding:20px 16px;background:#fff;border-radius:10px;border:2px solid #e2e8f0;flex-wrap:wrap}.form-select.slim[_ngcontent-%COMP%], .form-input.slim[_ngcontent-%COMP%]{height:36px;padding:6px 10px;border:2px solid #e5e7eb;border-radius:10px;background:#fff;font-size:14px;transition:all .2s ease}.interval-input[_ngcontent-%COMP%]{width:130px!important;height:42px!important;text-align:center;font-weight:600;font-size:16px;border:2px solid #cbd5e1!important}.interval-input[_ngcontent-%COMP%]:focus{border-color:#667eea!important}.interval-check[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer}.interval-check[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:16px;height:16px;cursor:pointer}.interval-symbol[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#475569;line-height:1;-webkit-user-select:none;user-select:none}.interval-variable[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:12px 24px;border-radius:24px;font-weight:700;font-size:16px;min-width:140px;text-align:center;box-shadow:0 4px 14px #667eea59;white-space:nowrap}.interval-footer[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px;border-top:1px solid #e2e8f0;text-align:center}.interval-footer[_ngcontent-%COMP%]   .tiny-check[_ngcontent-%COMP%]{font-size:13px;color:#64748b}.range-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:240px 80px 1fr max-content;gap:12px;align-items:center}.col-field[_ngcontent-%COMP%]{grid-column:1}.col-op[_ngcontent-%COMP%]{grid-column:2}.col-value[_ngcontent-%COMP%]{grid-column:3}.col-del[_ngcontent-%COMP%]{grid-column:4;justify-self:end}.range-row[_ngcontent-%COMP%]   .value-box[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:10px}.range-row[_ngcontent-%COMP%]   .form-input.slim[_ngcontent-%COMP%]{width:180px}.tiny-check[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:#6b7280;cursor:pointer}.tiny-check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{transform:translateY(1px)}.hint.error-inline[_ngcontent-%COMP%]{color:#ef4444;font-weight:500;margin-top:8px}@media (max-width: 900px){.interval-expression[_ngcontent-%COMP%]{gap:12px;padding:16px 12px}.interval-input[_ngcontent-%COMP%]{width:110px!important}.interval-variable[_ngcontent-%COMP%]{min-width:120px;font-size:15px;padding:10px 20px}.interval-symbol[_ngcontent-%COMP%]{font-size:24px}}@media (max-width: 700px){.interval-expression[_ngcontent-%COMP%]{flex-direction:column;gap:10px;padding:16px}.interval-input[_ngcontent-%COMP%]{width:100%!important;max-width:200px}.interval-variable[_ngcontent-%COMP%]{width:100%;max-width:200px}.range-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}.range-row[_ngcontent-%COMP%]   .btn-small[_ngcontent-%COMP%]{justify-self:stretch}}.group--rangos[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]{font-size:13px}.group--rangos[_ngcontent-%COMP%]   .range-item[_ngcontent-%COMP%]{padding:10px;border-radius:10px}.group--rangos[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:8px 14px;font-size:12px;border-radius:10px;gap:6px}.group--rangos[_ngcontent-%COMP%]   .btn-small[_ngcontent-%COMP%]{padding:6px 10px;font-size:11px;border-radius:8px;line-height:1}.group--rangos[_ngcontent-%COMP%]   .interval-mode[_ngcontent-%COMP%]{padding:12px;border-radius:10px;border-width:1.5px}.group--rangos[_ngcontent-%COMP%]   .interval-header[_ngcontent-%COMP%]{margin-bottom:10px;gap:8px}.group--rangos[_ngcontent-%COMP%]   .interval-header[_ngcontent-%COMP%]   .interval-field[_ngcontent-%COMP%]{max-width:100px}.group--rangos[_ngcontent-%COMP%]   .interval-expression[_ngcontent-%COMP%]{gap:12px;padding:12px;border-radius:8px;border-width:1.5px}.group--rangos[_ngcontent-%COMP%]   .form-select.slim[_ngcontent-%COMP%], .group--rangos[_ngcontent-%COMP%]   .form-input.slim[_ngcontent-%COMP%]{height:30px;padding:4px 8px;font-size:12px;border-radius:8px;border-width:1.5px}.group--rangos[_ngcontent-%COMP%]   .interval-input[_ngcontent-%COMP%]{width:100px!important;height:36px!important;font-size:14px;font-weight:600}.group--rangos[_ngcontent-%COMP%]   .interval-check[_ngcontent-%COMP%]{gap:4px}.group--rangos[_ngcontent-%COMP%]   .interval-check[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:14px;height:14px}.group--rangos[_ngcontent-%COMP%]   .interval-symbol[_ngcontent-%COMP%]{font-size:22px}.group--rangos[_ngcontent-%COMP%]   .interval-variable[_ngcontent-%COMP%]{padding:8px 16px;border-radius:18px;font-size:14px;min-width:110px;box-shadow:0 3px 10px #667eea47}.group--rangos[_ngcontent-%COMP%]   .interval-footer[_ngcontent-%COMP%]{margin-top:8px;padding-top:8px}.group--rangos[_ngcontent-%COMP%]   .interval-footer[_ngcontent-%COMP%]   .tiny-check[_ngcontent-%COMP%]{font-size:12px}.group--rangos[_ngcontent-%COMP%]   .range-row[_ngcontent-%COMP%]{grid-template-columns:200px 64px 1fr max-content;gap:8px}.group--rangos[_ngcontent-%COMP%]   .range-row[_ngcontent-%COMP%]   .form-input.slim[_ngcontent-%COMP%]{width:140px}.group--rangos[_ngcontent-%COMP%]   .tiny-check[_ngcontent-%COMP%]{font-size:11px;gap:4px}.group--rangos[_ngcontent-%COMP%]   .tiny-check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{transform:translateY(1px)}.group--rangos[_ngcontent-%COMP%]   .btn-danger.btn-small[_ngcontent-%COMP%]{padding:6px 10px;font-size:11px}@media (max-width: 700px){.group--rangos[_ngcontent-%COMP%]   .interval-input[_ngcontent-%COMP%]{width:92px!important}.group--rangos[_ngcontent-%COMP%]   .interval-variable[_ngcontent-%COMP%]{min-width:100px;font-size:13px;padding:7px 14px}.group--rangos[_ngcontent-%COMP%]   .interval-symbol[_ngcontent-%COMP%]{font-size:20px}}.group--rangos[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]   .tiny-check[_ngcontent-%COMP%], .group--rangos[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]   .tiny-check[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap}.group--rangos[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]   .tiny-check[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-size:12px;line-height:1.1}"]});let a=m;return a})();function ot(a=new Date){let m=String(a.getDate()).padStart(2,"0"),o=String(a.getMonth()+1).padStart(2,"0");return`${m}/${o}`}function rt(a){return a.trim().toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"")}function at(a,m){if(!a)return"";let o={HOY:ot(new Date),MANANA:ot(new Date(Date.now()+1440*60*1e3))};for(let[e,n]of Object.entries(m||{}))o[rt(e)]=String(n??"");return!o.MORA&&o.SALDO_MORA&&(o.MORA=o.SALDO_MORA),!o.BAJA30&&o.BAJA_30&&(o.BAJA30=o.BAJA_30),a.replace(/\{([^}]+)\}/g,(e,n)=>{let t=rt(n);return t in o?o[t]:`{${n}}`})}function lt(a){let m=(a||"").length;return m===0?{chars:0,segs:0}:m<=160?{chars:m,segs:1}:{chars:m,segs:Math.ceil(m/153)}}function yt(a,m){}var st="_mat-bottom-sheet-enter",ct="_mat-bottom-sheet-exit",At=(()=>{class a extends Ye{_breakpointSubscription;_animationsDisabled=me();_animationState="void";_animationStateChanged=new Se;_destroyed;constructor(){super();let o=C(Fe);this._breakpointSubscription=o.observe([N.Medium,N.Large,N.XLarge]).subscribe(()=>{let e=this._elementRef.nativeElement.classList;e.toggle("mat-bottom-sheet-container-medium",o.isMatched(N.Medium)),e.toggle("mat-bottom-sheet-container-large",o.isMatched(N.Large)),e.toggle("mat-bottom-sheet-container-xlarge",o.isMatched(N.XLarge))})}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._animationsDisabled&&this._simulateAnimation(st))}exit(){this._destroyed||(this._elementRef.nativeElement.setAttribute("mat-exit",""),this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._animationsDisabled&&this._simulateAnimation(ct))}ngOnDestroy(){super.ngOnDestroy(),this._breakpointSubscription.unsubscribe(),this._destroyed=!0}_simulateAnimation(o){this._ngZone.run(()=>{this._handleAnimationEvent(!0,o),setTimeout(()=>this._handleAnimationEvent(!1,o))})}_trapFocus(){super._trapFocus({preventScroll:!0})}_handleAnimationEvent(o,e){let n=e===st;(n||e===ct)&&this._animationStateChanged.emit({toState:n?"visible":"hidden",phase:o?"start":"done"})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=D({type:a,selectors:[["mat-bottom-sheet-container"]],hostAttrs:["tabindex","-1",1,"mat-bottom-sheet-container"],hostVars:9,hostBindings:function(e,n){e&1&&g("animationstart",function(s){return n._handleAnimationEvent(!0,s.animationName)})("animationend",function(s){return n._handleAnimationEvent(!1,s.animationName)})("animationcancel",function(s){return n._handleAnimationEvent(!1,s.animationName)}),e&2&&(V("role",n._config.role)("aria-modal",n._config.ariaModal)("aria-label",n._config.ariaLabel),x("mat-bottom-sheet-container-animations-enabled",!n._animationsDisabled)("mat-bottom-sheet-container-enter",n._animationState==="visible")("mat-bottom-sheet-container-exit",n._animationState==="hidden"))},features:[Pe],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,n){e&1&&b(0,yt,0,0,"ng-template",0)},dependencies:[ze],styles:[`@keyframes _mat-bottom-sheet-enter{from{transform:translateY(100%)}to{transform:none}}@keyframes _mat-bottom-sheet-exit{from{transform:none}to{transform:translateY(100%)}}.mat-bottom-sheet-container{box-shadow:0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12);padding:8px 16px;min-width:100vw;box-sizing:border-box;display:block;outline:0;max-height:80vh;overflow:auto;position:relative;background:var(--mat-bottom-sheet-container-background-color, var(--mat-sys-surface-container-low));color:var(--mat-bottom-sheet-container-text-color, var(--mat-sys-on-surface));font-family:var(--mat-bottom-sheet-container-text-font, var(--mat-sys-body-large-font));font-size:var(--mat-bottom-sheet-container-text-size, var(--mat-sys-body-large-size));line-height:var(--mat-bottom-sheet-container-text-line-height, var(--mat-sys-body-large-line-height));font-weight:var(--mat-bottom-sheet-container-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mat-bottom-sheet-container-text-tracking, var(--mat-sys-body-large-tracking))}@media(forced-colors: active){.mat-bottom-sheet-container{outline:1px solid}}.mat-bottom-sheet-container-animations-enabled{transform:translateY(100%)}.mat-bottom-sheet-container-animations-enabled.mat-bottom-sheet-container-enter{animation:_mat-bottom-sheet-enter 195ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-bottom-sheet-container-animations-enabled.mat-bottom-sheet-container-exit{animation:_mat-bottom-sheet-exit 375ms cubic-bezier(0.4, 0, 1, 1) backwards}.mat-bottom-sheet-container-xlarge,.mat-bottom-sheet-container-large,.mat-bottom-sheet-container-medium{border-top-left-radius:var(--mat-bottom-sheet-container-shape, 28px);border-top-right-radius:var(--mat-bottom-sheet-container-shape, 28px)}.mat-bottom-sheet-container-medium{min-width:384px;max-width:calc(100vw - 128px)}.mat-bottom-sheet-container-large{min-width:512px;max-width:calc(100vw - 256px)}.mat-bottom-sheet-container-xlarge{min-width:576px;max-width:calc(100vw - 384px)}
`],encapsulation:2})}return a})(),kt=new le("MatBottomSheetData"),ge=class{viewContainerRef;panelClass;direction;data=null;hasBackdrop=!0;backdropClass;disableClose=!1;ariaLabel=null;ariaModal=!1;closeOnNavigation=!0;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;height="";minHeight;maxHeight},re=class{_ref;get instance(){return this._ref.componentInstance}get componentRef(){return this._ref.componentRef}containerInstance;disableClose;_afterOpened=new he;_result;_closeFallbackTimeout;constructor(m,o,e){this._ref=m,this.containerInstance=e,this.disableClose=o.disableClose,e._animationStateChanged.pipe(F(n=>n.phase==="done"&&n.toState==="visible"),U(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),e._animationStateChanged.pipe(F(n=>n.phase==="done"&&n.toState==="hidden"),U(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._ref.close(this._result)}),m.overlayRef.detachments().subscribe(()=>{this._ref.close(this._result)}),be(this.backdropClick(),this.keydownEvents().pipe(F(n=>n.keyCode===27))).subscribe(n=>{!this.disableClose&&(n.type!=="keydown"||!Ve(n))&&(n.preventDefault(),this.dismiss())})}dismiss(m){this.containerInstance&&(this.containerInstance._animationStateChanged.pipe(F(o=>o.phase==="start"),U(1)).subscribe(()=>{this._closeFallbackTimeout=setTimeout(()=>this._ref.close(this._result),500),this._ref.overlayRef.detachBackdrop()}),this._result=m,this.containerInstance.exit(),this.containerInstance=null)}afterDismissed(){return this._ref.closed}afterOpened(){return this._afterOpened}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}},Tt=new le("mat-bottom-sheet-default-options"),dt=(()=>{class a{_injector=C(Oe);_parentBottomSheet=C(a,{optional:!0,skipSelf:!0});_animationsDisabled=me();_defaultOptions=C(Tt,{optional:!0});_bottomSheetRefAtThisLevel=null;_dialog=C(Je);get _openedBottomSheetRef(){let o=this._parentBottomSheet;return o?o._openedBottomSheetRef:this._bottomSheetRefAtThisLevel}set _openedBottomSheetRef(o){this._parentBottomSheet?this._parentBottomSheet._openedBottomSheetRef=o:this._bottomSheetRefAtThisLevel=o}constructor(){}open(o,e){let n=j(j({},this._defaultOptions||new ge),e),t;return this._dialog.open(o,_e(j({},n),{disableClose:!0,closeOnOverlayDetachments:!1,maxWidth:"100%",container:At,scrollStrategy:n.scrollStrategy||je(this._injector),positionStrategy:Ue(this._injector).centerHorizontally().bottom("0"),disableAnimations:this._animationsDisabled,templateContext:()=>({bottomSheetRef:t}),providers:(s,c,f)=>(t=new re(s,n,f),[{provide:re,useValue:t},{provide:kt,useValue:n.data}])})),t.afterDismissed().subscribe(()=>{this._openedBottomSheetRef===t&&(this._openedBottomSheetRef=null)}),this._openedBottomSheetRef?(this._openedBottomSheetRef.afterDismissed().subscribe(()=>t.containerInstance?.enter()),this._openedBottomSheetRef.dismiss()):t.containerInstance.enter(),this._openedBottomSheetRef=t,t}dismiss(o){this._openedBottomSheetRef&&this._openedBottomSheetRef.dismiss(o)}ngOnDestroy(){this._bottomSheetRefAtThisLevel&&this._bottomSheetRefAtThisLevel.dismiss()}static \u0275fac=function(e){return new(e||a)};static \u0275prov=ve({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();function Lt(a,m){if(a&1){let o=E();i(0,"button",23),g("click",function(){let n=M(o).$implicit,t=u();return v(t.toggleChip(n.key))}),l(1),r()}if(a&2){let o=m.$implicit,e=u();x("active",e.isSelected(o.key)),V("aria-pressed",e.isSelected(o.key)),d(),y(" ",o.label," ")}}function Rt(a,m){if(a&1&&(i(0,"p",38),l(1),r()),a&2){let o=m.ngIf;d(),y(" ",o," ")}}function Nt(a,m){a&1&&(i(0,"p",39),l(1,"(sin texto de SMS)"),r())}function It(a,m){if(a&1&&(i(0,"span",40),l(1),r()),a&2){let o=m.$implicit;d(),y(" ",o==="SALDO_MORA"?"MORA":o==="LTD_LTDE"?"LTD y LTDE":o," ")}}function Bt(a,m){if(a&1){let o=E();i(0,"div",27)(1,"div",28)(2,"span",29),l(3),r(),i(4,"div",30)(5,"button",31),g("click",function(){let n=M(o).$implicit,t=u(2);return v(t.preview(n))}),i(6,"span",16),l(7,"visibility"),r(),l(8," Preview "),r(),i(9,"button",32),g("click",function(){let n=M(o).$implicit,t=u(2);return v(t.openEdit(n))}),i(10,"span",16),l(11,"edit"),r(),l(12," Editar "),r()()(),i(13,"div",33)(14,"div",34),b(15,Rt,2,1,"p",35)(16,Nt,2,0,"ng-template",null,3,R),r(),i(18,"div",36),b(19,It,2,1,"span",37),r()()()}if(a&2){let o=m.$implicit,e=L(17),n=u(2);d(3),P(o.name||"(Sin nombre)"),d(12),p("ngIf",o.plantillaTexto)("ngIfElse",e),d(4),p("ngForOf",n.visibleTags(o))}}function Ft(a,m){if(a&1&&(i(0,"div",24)(1,"div",25),b(2,Bt,20,4,"div",26),r()()),a&2){let o=u();d(2),p("ngForOf",o.filtered())("ngForTrackBy",o.trackById)}}function Vt(a,m){a&1&&(i(0,"div",41)(1,"i",16),l(2,"inbox"),r(),i(3,"p"),l(4,"No hay tenores disponibles"),r(),i(5,"p",42),l(6,"Crea un nuevo tenor o ajusta los filtros"),r()())}function zt(a,m){if(a&1){let o=E();i(0,"div",43),g("click",function(){M(o);let n=u();return v(n.closePreview())}),r()}}function jt(a,m){if(a&1&&(i(0,"div",58)(1,"div",59),l(2),r(),i(3,"div",60),l(4),r()()),a&2){let o=m.$implicit;d(2),P(o[0]),d(2),P(o[1])}}function Ut(a,m){if(a&1&&(i(0,"small",65),l(1),r()),a&2){let o=m.ngIf,e=u(5);d(),y(" ",e.smsLen(o).chars,"/160 caracteres ")}}function $t(a,m){if(a&1&&(i(0,"section",61)(1,"label",62),l(2,"Previsualizaci\xF3n del SMS"),r(),i(3,"div",63),l(4),r(),b(5,Ut,2,1,"small",64),r()),a&2){let o=u(4);d(4),P(o.previewSms()),d(),p("ngIf",o.previewSms())}}function Ht(a,m){if(a&1&&(k(0),i(1,"div",55),b(2,jt,5,2,"div",56),r(),b(3,$t,6,2,"section",57),T()),a&2){let o=u(3);d(2),p("ngForOf",o.previewPairs()),d(),p("ngIf",o.previewSms()!==null)}}function Yt(a,m){if(a&1&&(i(0,"div",53),b(1,Ht,4,2,"ng-container",54),r()),a&2){let o=u(2),e=L(33);d(),p("ngIf",o.previewRow())("ngIfElse",e)}}function Jt(a,m){if(a&1){let o=E();i(0,"aside",44),g("click",function(n){return M(o),v(n.stopPropagation())}),i(1,"header",45)(2,"h3",46),l(3),r(),_(4,"div",47),i(5,"button",48),g("click",function(){M(o);let n=u();return v(n.closePreview())}),i(6,"span",16),l(7,"close"),r(),l(8," Cerrar "),r()(),b(9,Yt,2,2,"div",49),i(10,"footer",50),_(11,"div",47),i(12,"button",51),g("click",function(){M(o);let n=u();return v(n.exportSelected())}),i(13,"span",16),l(14,"download"),r(),l(15," Exportar "),r(),i(16,"button",52),g("click",function(){M(o);let n=u();return v(n.removeSelected())}),i(17,"span",16),l(18,"delete"),r(),l(19," Eliminar "),r()()()}if(a&2){let o=u(),e=L(31);d(3),P(o.previewTitle()),d(6),p("ngIf",!o.previewLoading())("ngIfElse",e)}}function Wt(a,m){a&1&&(i(0,"div",66),_(1,"div",67),i(2,"p"),l(3,"Cargando\u2026"),r()())}function Gt(a,m){a&1&&(i(0,"div",68)(1,"span",16),l(2,"info"),r(),i(3,"p"),l(4,"No se encontraron filas para este combo."),r()())}var Zn=(()=>{let m=class m{openEdit(e){this.dialog.open(it,{data:e,width:"650px",maxWidth:"92vw",autoFocus:!1,panelClass:"combo-dialog"}).afterClosed().subscribe(n=>n&&this.load())}labelOf(e){return e==="TELEFONOCELULAR"?"TEL\xC9FONO":e==="DEUDA_TOTAL"?"DEUDA TOTAL":e.replaceAll("_"," ").toUpperCase()}preview(e){this.lockBodyScroll(!0),this.previewOpen.set(!0),this.previewTitle.set(`${e.name}`),this.previewLoading.set(!0),this.previewRow.set(null),this.previewSms.set(null),this.selectedCombo.set(e),this.api.previewFromCombo(e.id,1e3).subscribe({next:n=>{let t=n?.[0]??{};this.previewRow.set(t);let s=c=>{let f=at(c||"",t);this.previewSms.set(f||"(sin texto)"),this.previewLoading.set(!1)};e.plantillaTexto?s(e.plantillaTexto):e.plantillaSmsId?this.api.getPlantillaTexto(e.plantillaSmsId).subscribe({next:c=>s(typeof c=="string"?c:c?.template??""),error:c=>{this.previewSms.set("(no se pudo cargar el texto)"),this.previewLoading.set(!1)}}):(this.previewSms.set("(sin texto de SMS)"),this.previewLoading.set(!1))},error:n=>{this.previewLoading.set(!1),this.previewSms.set("(error al obtener preview)")}})}constructor(e,n){this.bottomSheet=e,this.matDialog=n,this.api=C(oe),this.fb=C(ee),this.dialog=C(I),this.router=C(W),this.previewSms=w(null),this.smsLen=t=>lt(t),this.selectedCombo=w(null),this.previewOpen=w(!1),this.previewTitle=w(""),this.previewRow=w(null),this.previewLoading=w(!1),this.previewOrder=["DOCUMENTO","TELEFONOCELULAR","NOMBRE","BAJA30","DEUDA_TOTAL"],this.all=w([]),this.loading=w(!1),this.chips=[{key:"NOMBRE",label:"Nombre"},{key:"LTD",label:"LTD"},{key:"LTDE",label:"LTDE"},{key:"LTD_LTDE",label:"LTD + LTDE"},{key:"BAJA30",label:"Baja 30"},{key:"SALDO_MORA",label:"Mora"},{key:"BAJA30_SALDOMORA",label:"Baja30 + Mora"},{key:"PKM",label:"PKM"},{key:"CAPITAL",label:"Capital"},{key:"DEUDA_TOTAL",label:"Deuda Total"},{key:"MANANA",label:"Ma\xF1ana"},{key:"HOY",label:"Hoy"},{key:"NOMBRECOMPLETO",label:"Nombre Completo"},{key:"EMAIL",label:"Correo"},{key:"NUMCUENTAPMCP",label:"N\xFAmero de Cuenta"},{key:"DIASMORA",label:"D\xEDas Mora"}],this.selected=w(new Set),this.form=this.fb.nonNullable.group({q:"",tramo:"ALL",soloActivos:!0}),this.filtersSig=He(this.form.valueChanges.pipe(Me(this.form.getRawValue())),{initialValue:this.form.getRawValue()}),this.filtered=$(()=>{let{q:t,tramo:s,soloActivos:c}=this.filtersSig(),f=this.selected(),h=(t??"").trim().toLowerCase();return this.all().filter(S=>{if(c&&!S.isActive||s!=="ALL"&&S.tramo!==s)return!1;if(f.size){let O=new Set(S.selects??[]),B=O.has("NOMBRE")||/\{NOMBRE\}/i.test(S.plantillaTexto||"");for(let A of f){if(A==="NOMBRE"){if(!B)return!1;continue}if(!O.has(A))return!1}}return!(h&&!((S.name??"").toLowerCase().includes(h)||(S.plantillaTexto??"").toLowerCase().includes(h)))})}),this.displayedColumns=["name","selects","acciones"],this.savedScrollTop=0,this.load(),Ee(()=>this.filtered())}load(){this.loading.set(!0),this.api.list().subscribe({next:e=>{this.all.set(e??[]),this.loading.set(!1)},error:e=>{this.all.set([]),this.loading.set(!1)}})}trackById(e,n){return n.id}isSelected(e){return this.selected().has(e)}toggleChip(e){let n=new Set(this.selected());n.has(e)?n.delete(e):n.add(e),this.selected.set(n)}clearChips(){this.selected.set(new Set)}buildDownloadName(e){let n=new Date().toISOString().slice(0,10);return`${(e.name??`combo_${e.id}`).trim().replace(/[<>:"/\\|?*]+/g,"").replace(/\s+/g," ").slice(0,150)} - ${n}.xlsx`}alert(e,n="Aviso"){this.matDialog.open(et,{width:"420px",data:{title:n,message:e}})}export(e){let n=e.id,t=this.matDialog.open(tt,{disableClose:!0,data:{title:"Generando Excel\u2026",subtitle:"Preparando datos y creando archivo"},panelClass:"loading-dialog-panel",backdropClass:"blur-dialog-backdrop",width:"460px",height:"310px"});this.api.precheck(n).subscribe({next:s=>{if(!s.ok){t.close();let c=`${s.excedidos} ${s.excedidos===1?"fila":"filas"} superan los caracteres.`,f=(s.ejemplos??[]).map((h,S)=>`\u2022 ${h.len} caracteres \u2014 DNI: ${h.documento||"(sin DNI)"}`).join(`
`);this.alert(`${c}

Primeros ${Math.min((s.ejemplos??[]).length,3)} casos:
${f}$`,"Mensaje demasiado largo");return}this.api.exportFromCombo(n).pipe(Ce(()=>t.close())).subscribe({next:c=>{let f=URL.createObjectURL(c),h=document.createElement("a");h.href=f,h.download=this.buildDownloadName(e),document.body.appendChild(h),h.click(),h.remove(),URL.revokeObjectURL(f)},error:c=>{t.close();let f=c?.status===422?c?.error?.message||"No hay filas para exportar con los filtros seleccionados.":c?.error?.message||c?.message||"Ocurri\xF3 un error al exportar.";this.alert(f,c?.status===422?"Sin resultados":"Error")}})},error:s=>{let c=s?.error?.message||s?.message||"No se pudo validar el SMS del combo.";this.alert(c,"Error en precheck")}})}exportSelected(){let e=this.selectedCombo();e&&this.export(e)}removeSelected(){let e=this.selectedCombo();e&&confirm(`\xBFEliminar el combo "${e.name}"?`)&&this.api.delete(e.id).subscribe(()=>{this.closePreview(),this.load()})}closePreview(){this.previewOpen.set(!1),this.lockBodyScroll(!1),this.previewSms.set(""),this.previewSms.set(null),this.previewRow.set(null),this.selectedCombo.set(null)}previewPairs(){let e=this.previewRow();if(!e)return[];let n=new Set,t=[];for(let c of this.previewOrder)e[c]!==void 0&&(t.push([this.labelOf(String(c)),e[c]]),n.add(String(c)));let s=[];for(let[c,f]of Object.entries(e))n.has(c)||s.push([this.labelOf(c),f]);return[...t,...s]}New(){this.router.navigate(["/crear"])}remove(e){confirm(`\xBFEliminar el combo "${e.name}"?`)&&this.api.delete(e.id).subscribe(()=>this.load())}lockBodyScroll(e){let n=document.body;e?(this.savedScrollTop=window.scrollY||window.pageYOffset||0,n.style.top=`-${this.savedScrollTop}px`,n.classList.add("no-scroll")):(n.classList.remove("no-scroll"),n.style.top="",window.scrollTo(0,this.savedScrollTop||0))}visibleTags(e){let n=[...e.selects??[]];return/\{NOMBRE\}/i.test(e.plantillaTexto||"")&&!n.includes("NOMBRE")&&n.unshift("NOMBRE"),n}};m.\u0275fac=function(n){return new(n||m)(se(dt),se(I))},m.\u0275cmp=D({type:m,selectors:[["app-combo-list-page"]],decls:34,vars:7,consts:[["noData",""],["loadingTpl",""],["emptyTpl",""],["noSms",""],[1,"container"],[1,"header-section"],[1,"main-title"],[1,"filters-wrapper"],[1,"search-filters"],["type","text","placeholder","Buscar por nombre o tenor...",1,"search-input",3,"formControl"],[1,"tramo-select",3,"formControl"],["value","ALL"],["value","3"],["value","5"],[1,"action-buttons"],["mat-button","","type","button",1,"clear-filters-btn",3,"click"],[1,"material-icons"],["mat-button","","type","button",1,"create-tenor-btn",3,"click"],[1,"chips-wrapper"],["type","button","class","filter-chip",3,"active","click",4,"ngFor","ngForOf"],["class","tenors-wrapper",4,"ngIf","ngIfElse"],["class","sheet-backdrop",3,"click",4,"ngIf"],["class","preview-sheet",3,"click",4,"ngIf"],["type","button",1,"filter-chip",3,"click"],[1,"tenors-wrapper"],[1,"tenors-list"],["class","tenor-row",4,"ngFor","ngForOf","ngForTrackBy"],[1,"tenor-row"],[1,"tenor-header"],[1,"tenor-label"],[1,"tenor-actions"],["mat-button","",1,"preview-btn",3,"click"],["mat-button","",1,"edit-btn",3,"click"],[1,"tenor-content"],[1,"tenor-text"],["class","sms-text",4,"ngIf","ngIfElse"],[1,"tenor-tags"],["class","tag",4,"ngFor","ngForOf"],[1,"sms-text"],[1,"sms-text","no-text"],[1,"tag"],[1,"empty-state"],[1,"empty-subtitle"],[1,"sheet-backdrop",3,"click"],[1,"preview-sheet",3,"click"],[1,"sheet-header"],[1,"sheet-title"],[1,"sheet-spacer"],["mat-button","",1,"close-btn",3,"click"],["class","sheet-body",4,"ngIf","ngIfElse"],[1,"sheet-footer"],["mat-stroked-button","",1,"export-btn",3,"click"],["mat-button","","color","warn",1,"delete-btn",3,"click"],[1,"sheet-body"],[4,"ngIf","ngIfElse"],[1,"data-grid"],["class","data-row",4,"ngFor","ngForOf"],["class","sms-section",4,"ngIf"],[1,"data-row"],[1,"data-key"],[1,"data-value"],[1,"sms-section"],[1,"sms-label"],[1,"sms-bubble"],["class","sms-counter",4,"ngIf"],[1,"sms-counter"],[1,"sheet-loading"],[1,"loading-spinner"],[1,"sheet-empty"]],template:function(n,t){if(n&1){let s=E();i(0,"div",4)(1,"div",5)(2,"h2",6),l(3,"Gesti\xF3n de Tenores"),r(),i(4,"div",7)(5,"div",8),_(6,"input",9),i(7,"select",10)(8,"option",11),l(9,"Todos los tramos"),r(),i(10,"option",12),l(11,"Tramo 3"),r(),i(12,"option",13),l(13,"Tramo 5"),r()()(),i(14,"div",14)(15,"button",15),g("click",function(){return M(s),v(t.clearChips())}),i(16,"span",16),l(17,"clear_all"),r(),l(18," Limpiar "),r(),i(19,"button",17),g("click",function(){return M(s),v(t.New())}),i(20,"span",16),l(21,"add"),r(),l(22," Crear "),r()()()(),i(23,"div",18),b(24,Lt,2,4,"button",19),r(),b(25,Ft,3,2,"div",20)(26,Vt,7,0,"ng-template",null,0,R),r(),b(28,zt,1,0,"div",21)(29,Jt,20,3,"aside",22)(30,Wt,4,0,"ng-template",null,1,R)(32,Gt,5,0,"ng-template",null,2,R)}if(n&2){let s=L(27);d(6),p("formControl",t.form.controls.q),d(),p("formControl",t.form.controls.tramo),d(17),p("ngForOf",t.chips),d(),p("ngIf",t.filtered().length)("ngIfElse",s),d(3),p("ngIf",t.previewOpen()),d(),p("ngIf",t.previewOpen())}},dependencies:[J,H,Y,te,Z,Q,G,X,q,Re,$e,ie,ne,nt,Ke],styles:['.container[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8fafc,#f1f5f9);padding:1.4rem;border-radius:16px;box-shadow:0 4px 20px #00000014;width:100%;max-width:1400px;margin:110px auto 0;min-height:500px}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:1.2rem;border-bottom:2px solid #e2e8f0;flex-wrap:wrap;gap:1rem}.main-title[_ngcontent-%COMP%]{color:#1e293b;font-size:1.75rem;font-weight:600;margin:0;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.filters-wrapper[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}.search-filters[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.search-input[_ngcontent-%COMP%]{padding:.75rem 1rem;border:1px solid #d1d5db;border-radius:8px;font-size:.95rem;transition:all .2s ease;background:#fff;min-width:250px}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.tramo-select[_ngcontent-%COMP%]{padding:.75rem 1rem;border:1px solid #d1d5db;border-radius:8px;font-size:.95rem;transition:all .2s ease;background:#fff;min-width:150px;cursor:pointer}.tramo-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.clear-filters-btn[_ngcontent-%COMP%], .create-tenor-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;border-radius:8px;font-weight:500;transition:all .2s ease;border:none;cursor:pointer}.clear-filters-btn[_ngcontent-%COMP%]{background:transparent;color:#64748b;border:2px solid #e2e8f0}.clear-filters-btn[_ngcontent-%COMP%]:hover{background:#f8fafc;border-color:#cbd5e1}.create-tenor-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff!important}.create-tenor-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#fff!important}.create-tenor-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#2563eb,#7c3aed);transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}.chips-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem;margin-bottom:1.5rem;padding:1rem;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000000a}.filter-chip[_ngcontent-%COMP%]{padding:.5rem 1rem;border:2px solid #e2e8f0;border-radius:20px;background:#fff;color:#64748b;font-size:.9rem;font-weight:500;cursor:pointer;transition:all .2s ease}.filter-chip[_ngcontent-%COMP%]:hover{background:#f8fafc;border-color:#cbd5e1;transform:translateY(-1px)}.filter-chip.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff;border-color:transparent}.tenors-wrapper[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 12px #0000000d;overflow:hidden}.tenors-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:0}.tenor-row[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff,#f8fafc);border-bottom:1px solid #e2e8f0;padding:1.2rem 1.5rem;transition:all .3s ease;position:relative;overflow:hidden}.tenor-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.tenor-row[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;bottom:0;width:3px;background:linear-gradient(180deg,#3b82f6,#8b5cf6);transform:scaleY(0);transition:transform .3s ease;transform-origin:top}.tenor-row[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#f8fafc,#f1f5f9);padding-left:1.8rem}.tenor-row[_ngcontent-%COMP%]:hover:before{transform:scaleY(1)}.tenor-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;gap:1rem}.tenor-label[_ngcontent-%COMP%]{font-weight:600;color:#1e293b;font-size:1.1rem;padding:.4rem .8rem;background:linear-gradient(135deg,#f1f5f9,#e2e8f0);border-radius:8px;border:1px solid #cbd5e1}.tenor-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.preview-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;padding:.5rem 1rem;border-radius:6px;font-size:.9rem;font-weight:500;transition:all .2s ease;cursor:pointer;color:#293c4e;background:transparent;border:2px solid #e2e8f0}.edit-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;padding:.5rem 1rem;border-radius:6px;font-size:.9rem;font-weight:500;transition:all .2s ease;cursor:pointer;color:#255d80;background:transparent;border:2px solid #e2e8f0}.preview-btn[_ngcontent-%COMP%]:hover{background:#293c4e;color:#fff}.edit-btn[_ngcontent-%COMP%]:hover{background:#345187;color:#fff}.preview-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%], .edit-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:18px}.tenor-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem}.tenor-text[_ngcontent-%COMP%]{flex:1;padding-right:1rem}.sms-text[_ngcontent-%COMP%]{color:#475569;font-size:.95rem;line-height:1.6;margin:0;padding:.75rem;background:#f8fafc;border-radius:8px;border-left:3px solid #cbd5e1}.sms-text.no-text[_ngcontent-%COMP%]{color:#9ca3af;font-style:italic}.tenor-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;max-width:300px}.tag[_ngcontent-%COMP%]{padding:.35rem .75rem;background:linear-gradient(135deg,#e0e7ff,#c7d2fe);color:#4338ca;border-radius:6px;font-size:.85rem;font-weight:500;border:1px solid #a5b4fc}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem 2rem;color:#6b7280;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border:2px dashed #d1d5db;border-radius:12px;margin-top:2rem}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:3rem;color:#9ca3af;margin-bottom:1rem;display:block}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;font-size:1.1rem;font-weight:500}.empty-subtitle[_ngcontent-%COMP%]{color:#9ca3af!important;font-size:.9rem!important;font-weight:400!important}.sheet-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;z-index:999;animation:_ngcontent-%COMP%_fadeIn .2s ease}.preview-sheet[_ngcontent-%COMP%]{position:fixed;top:0;right:0;bottom:0;width:480px;background:#fff;box-shadow:-4px 0 24px #0000001a;z-index:1000;display:flex;flex-direction:column;animation:_ngcontent-%COMP%_slideIn .3s ease}.sheet-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #e2e8f0;display:flex;align-items:center;background:linear-gradient(135deg,#f8fafc,#f1f5f9)}.sheet-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#1e293b;margin:0}.sheet-spacer[_ngcontent-%COMP%]{flex:1}.close-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:6px;background:transparent;border:1px solid #e2e8f0;color:#64748b;cursor:pointer;transition:all .2s ease}.close-btn[_ngcontent-%COMP%]:hover{background:#f8fafc;border-color:#cbd5e1}.sheet-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.data-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;margin-bottom:1.5rem}.data-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:140px 1fr;gap:1rem;padding:.75rem;background:#f8fafc;border-radius:6px}.data-key[_ngcontent-%COMP%]{font-weight:600;color:#475569;font-size:.9rem}.data-value[_ngcontent-%COMP%]{color:#1e293b;font-size:.9rem}.sms-section[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid #e2e8f0}.sms-label[_ngcontent-%COMP%]{display:block;font-weight:600;color:#475569;font-size:.95rem;margin-bottom:.75rem}.sms-bubble[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff;padding:1rem;border-radius:12px;font-size:.95rem;line-height:1.5;position:relative;margin-bottom:.5rem}.sms-counter[_ngcontent-%COMP%]{color:#64748b;font-size:.85rem}.sheet-footer[_ngcontent-%COMP%]{padding:1.5rem;border-top:1px solid #e2e8f0;display:flex;gap:.75rem;background:#f8fafc}.export-btn[_ngcontent-%COMP%], .delete-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;border-radius:6px;font-weight:500;cursor:pointer;transition:all .2s ease}.export-btn[_ngcontent-%COMP%]{background:transparent;border:2px solid #3b82f6;color:#3b82f6}.export-btn[_ngcontent-%COMP%]:hover{background:#3b82f6;color:#fff}.delete-btn[_ngcontent-%COMP%]{background:#ef4444;border:none;color:#fff!important}.delete-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#fff}.delete-btn[_ngcontent-%COMP%]:hover{background:#fff;border:2px solid #dc2626;color:#dc2626!important}.delete-btn[_ngcontent-%COMP%]:hover   .material-icons[_ngcontent-%COMP%]{color:#dc2626}.sheet-loading[_ngcontent-%COMP%], .sheet-empty[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;color:#64748b}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid #e2e8f0;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%)}to{transform:translate(0)}}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media screen and (max-width: 1024px){.header-section[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:1rem}.filters-wrapper[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.search-filters[_ngcontent-%COMP%]{flex:1}.search-input[_ngcontent-%COMP%]{min-width:200px}}@media screen and (max-width: 768px){.container[_ngcontent-%COMP%]{padding:1rem}.main-title[_ngcontent-%COMP%]{font-size:1.5rem}.filters-wrapper[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.search-filters[_ngcontent-%COMP%]{width:100%;flex-direction:column}.search-input[_ngcontent-%COMP%], .tramo-select[_ngcontent-%COMP%]{width:100%}.action-buttons[_ngcontent-%COMP%]{width:100%;justify-content:stretch}.clear-filters-btn[_ngcontent-%COMP%], .create-tenor-btn[_ngcontent-%COMP%]{flex:1}.tenor-content[_ngcontent-%COMP%]{flex-direction:column}.tenor-tags[_ngcontent-%COMP%]{max-width:100%}.preview-sheet[_ngcontent-%COMP%]{width:100%}}@media screen and (max-width: 480px){.tenor-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.tenor-actions[_ngcontent-%COMP%]{justify-content:flex-start}.chips-wrapper[_ngcontent-%COMP%]{padding:.75rem}.filter-chip[_ngcontent-%COMP%]{padding:.4rem .8rem;font-size:.85rem}}']});let a=m;return a})();export{Zn as ComboListPageComponent};
