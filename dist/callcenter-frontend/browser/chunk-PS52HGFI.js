import{b as F}from"./chunk-ZSYYB5C3.js";import{a as H,b as N}from"./chunk-CO72NTPC.js";import"./chunk-5FCX4VCC.js";import"./chunk-63NKHHOY.js";import{a as Y}from"./chunk-JCIXYVAL.js";import{a as z,b as j}from"./chunk-JZPKGAPX.js";import{a as y,b as I,c as A,d as k,e as D}from"./chunk-OOEXVOEE.js";import"./chunk-PWFHRDIU.js";import{P as T,R as U,T as V,U as B,V as R}from"./chunk-BCDQDV5K.js";import"./chunk-VK6ZXGTF.js";import"./chunk-2EQX5ULE.js";import{$a as M,Da as h,Ra as l,Sa as t,Ta as e,Ua as _,W as g,X as x,Xb as E,ac as P,bb as p,db as d,kc as O,mc as w,pa as a,rb as i,sb as u,ta as f,tb as v,x as C,ya as b}from"./chunk-OVXRDAV3.js";function L(c,s){c&1&&(t(0,"div",5),_(1,"mat-spinner"),t(2,"p"),i(3,"Cargando detalles de la llamada..."),e()())}function W(c,s){c&1&&(t(0,"div",32),_(1,"mat-spinner",33),t(2,"span"),i(3,"Conectando..."),e()())}function G(c,s){if(c&1){let n=M();t(0,"div",34)(1,"button",35),p("click",function(){g(n);let r=d(2);return x(r.toggleMute())}),t(2,"mat-icon"),i(3),e(),i(4),e(),t(5,"button",36),p("click",function(){g(n);let r=d(2);return x(r.disconnectSupervision())}),t(6,"mat-icon"),i(7,"call_end"),e(),i(8," Desconectar "),e()()}if(c&2){let n=d(2);a(),l("color",n.isMuted?"warn":""),a(2),u(n.isMuted?"mic_off":"mic"),a(),v(" ",n.isMuted?"Activar Micr\xF3fono":"Silenciar"," ")}}function $(c,s){if(c&1){let n=M();t(0,"div",6)(1,"mat-card",7)(2,"mat-card-header")(3,"mat-card-title"),i(4,"Estado de la Supervisi\xF3n"),e()(),t(5,"mat-card-content")(6,"div",8)(7,"mat-chip",9)(8,"mat-icon"),i(9),e(),i(10),e(),t(11,"div",10)(12,"mat-icon"),i(13,"schedule"),e(),t(14,"span"),i(15),e()()()()(),t(16,"mat-card",11)(17,"mat-card-header")(18,"mat-card-title"),i(19,"Informaci\xF3n de la Llamada"),e()(),t(20,"mat-card-content")(21,"div",12)(22,"div",13)(23,"mat-icon"),i(24,"person"),e(),t(25,"div")(26,"div",14),i(27,"Agente"),e(),t(28,"div",15),i(29),e(),t(30,"div",16),i(31),e()()(),t(32,"div",13)(33,"mat-icon"),i(34,"phone"),e(),t(35,"div")(36,"div",14),i(37,"Cliente"),e(),t(38,"div",15),i(39),e(),t(40,"div",16),i(41),e()()()()()(),t(42,"mat-card",17)(43,"mat-card-header")(44,"mat-card-title"),i(45,"Modos de Supervisi\xF3n"),e()(),t(46,"mat-card-content")(47,"div",18)(48,"button",19),p("click",function(){g(n);let r=d();return x(r.startSpyMode())}),t(49,"mat-icon"),i(50,"visibility"),e(),t(51,"div",20)(52,"span",21),i(53,"Vig\xEDa"),e(),t(54,"span",22),i(55,"Solo escuchar"),e()()(),t(56,"button",23),p("click",function(){g(n);let r=d();return x(r.startWhisperMode())}),t(57,"mat-icon"),i(58,"record_voice_over"),e(),t(59,"div",20)(60,"span",21),i(61,"Susurro"),e(),t(62,"span",22),i(63,"Hablar al agente"),e()()(),t(64,"button",24),p("click",function(){g(n);let r=d();return x(r.startBargeMode())}),t(65,"mat-icon"),i(66,"group"),e(),t(67,"div",20)(68,"span",21),i(69,"Tripartita"),e(),t(70,"span",22),i(71,"Unirse a la llamada"),e()()()(),h(72,W,4,0,"div",25)(73,G,9,3,"div",26),e()(),t(74,"mat-card",27)(75,"mat-card-header")(76,"mat-card-title"),i(77,"Instrucciones"),e()(),t(78,"mat-card-content")(79,"div",28)(80,"mat-icon",29),i(81,"visibility"),e(),t(82,"div")(83,"strong"),i(84,"Vig\xEDa:"),e(),i(85," Escuchas la conversaci\xF3n entre agente y cliente. Nadie puede escucharte. "),e()(),t(86,"div",28)(87,"mat-icon",30),i(88,"record_voice_over"),e(),t(89,"div")(90,"strong"),i(91,"Susurro:"),e(),i(92," Hablas solo con el agente. El cliente no puede escucharte. "),e()(),t(93,"div",28)(94,"mat-icon",31),i(95,"group"),e(),t(96,"div")(97,"strong"),i(98,"Tripartita:"),e(),i(99," Te unes como participante completo. Todos se escuchan. "),e()()()()()}if(c&2){let n=d();a(7),l("color",n.getModeColor())("highlighted",n.currentMode!=="none"),a(2),u(n.currentMode!=="none"?"visibility":"visibility_off"),a(),v(" ",n.getModeLabel()," "),a(5),u(n.formatDuration(n.callDuration)),a(14),u(n.call.agentName),a(2),v("Ext: ",n.call.agentExtension),a(8),u(n.call.clientNumber),a(2),u(n.call.callState),a(7),l("disabled",n.currentMode!=="none"||n.isConnecting),a(8),l("disabled",n.currentMode!=="none"||n.isConnecting),a(8),l("disabled",n.currentMode!=="none"||n.isConnecting),a(8),l("ngIf",n.isConnecting),a(),l("ngIf",n.currentMode!=="none")}}var mt=(()=>{let s=class s{constructor(o,r,m,S){this.route=o,this.router=r,this.adminService=m,this.sipService=S,this.call=null,this.currentMode="none",this.isConnecting=!1,this.isMuted=!1,this.callDuration=0,this.callUuid="",this.sipRegistered=!1}ngOnInit(){if(this.callUuid=this.route.snapshot.paramMap.get("callUuid")||"",!this.callUuid){console.error("No call UUID provided"),this.router.navigate(["/admin/monitoring"]);return}this.loadCallDetails(),this.initializeAdminSip(),this.startDurationTimer()}ngOnDestroy(){this.timerSubscription&&this.timerSubscription.unsubscribe(),this.currentMode!=="none"&&this.disconnectSupervision(),this.sipService.disableAutoAnswer(),this.sipRegistered&&this.sipService.unregister()}loadCallDetails(){this.adminService.getActiveCall(this.callUuid).subscribe({next:o=>{this.call=o,this.callDuration=o.duration},error:o=>{console.error("Error loading call details:",o),this.router.navigate(["/admin/monitoring"])}})}initializeAdminSip(){let o={extension:"1000",password:"admin1234",wsUrl:"cobranza.contactototal.com.pe:7443",domain:"cobranza.contactototal.com.pe"};console.log("\u{1F527} Initializing admin SIP with extension 1000"),this.sipService.enableAutoAnswer(),this.sipService.register(o.extension,o.password,o.wsUrl,o.domain).then(()=>{console.log("\u2705 Admin SIP registered successfully with auto-answer enabled"),this.sipRegistered=!0}).catch(r=>{console.error("\u274C Admin SIP registration failed:",r)})}startDurationTimer(){this.timerSubscription=C(1e3).subscribe(()=>{this.callDuration++})}startSpyMode(){if(this.currentMode!=="none"){alert("Ya est\xE1s en modo de supervisi\xF3n. Desconecta primero.");return}this.isConnecting=!0,console.log("\u{1F575}\uFE0F Starting SPY mode for call:",this.callUuid),this.adminService.spyCall(this.callUuid).subscribe({next:()=>{console.log("\u2705 SPY mode activated"),this.currentMode="spy",this.isConnecting=!1},error:o=>{console.error("\u274C Error starting spy mode:",o),this.isConnecting=!1,alert("Error al iniciar modo Vig\xEDa")}})}startWhisperMode(){if(this.currentMode!=="none"){alert("Ya est\xE1s en modo de supervisi\xF3n. Desconecta primero.");return}this.isConnecting=!0,console.log("\u{1F5E3}\uFE0F Starting WHISPER mode for call:",this.callUuid),this.adminService.whisperCall(this.callUuid).subscribe({next:()=>{console.log("\u2705 WHISPER mode activated"),this.currentMode="whisper",this.isConnecting=!1},error:o=>{console.error("\u274C Error starting whisper mode:",o),this.isConnecting=!1,alert("Error al iniciar modo Susurro")}})}startBargeMode(){if(this.currentMode!=="none"){alert("Ya est\xE1s en modo de supervisi\xF3n. Desconecta primero.");return}this.isConnecting=!0,console.log("\u{1F4DE} Starting BARGE mode for call:",this.callUuid),this.adminService.bargeCall(this.callUuid).subscribe({next:()=>{console.log("\u2705 BARGE mode activated"),this.currentMode="barge",this.isConnecting=!1},error:o=>{console.error("\u274C Error starting barge mode:",o),this.isConnecting=!1,alert("Error al iniciar modo Tripartita")}})}disconnectSupervision(){console.log("\u{1F50C} Disconnecting from supervision"),this.sipService.hangup(),this.currentMode="none",this.isMuted=!1}toggleMute(){this.isMuted=!this.isMuted,this.isMuted?this.sipService.mute():this.sipService.unmute(),console.log(this.isMuted?"\u{1F507} Muted":"\u{1F50A} Unmuted")}goBack(){this.router.navigate(["/admin/monitoring"])}formatDuration(o){let r=Math.floor(o/60),m=o%60;return`${r.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`}getModeLabel(){switch(this.currentMode){case"spy":return"Vig\xEDa";case"whisper":return"Susurro";case"barge":return"Tripartita";default:return"Sin conexi\xF3n"}}getModeColor(){switch(this.currentMode){case"spy":return"accent";case"whisper":return"primary";case"barge":return"warn";default:return""}}};s.\u0275fac=function(r){return new(r||s)(f(O),f(w),f(Y),f(F))},s.\u0275cmp=b({type:s,selectors:[["app-admin-call-supervision"]],decls:9,vars:2,consts:[[1,"supervision-container"],[1,"supervision-header"],["mat-icon-button","",3,"click"],["class","loading-container",4,"ngIf"],["class","call-details-container",4,"ngIf"],[1,"loading-container"],[1,"call-details-container"],[1,"status-card"],[1,"status-info"],[3,"color","highlighted"],[1,"duration"],[1,"info-card"],[1,"info-grid"],[1,"info-item"],[1,"info-label"],[1,"info-value"],[1,"info-sublabel"],[1,"controls-card"],[1,"mode-buttons"],["mat-raised-button","","color","accent",1,"mode-button",3,"click","disabled"],[1,"button-content"],[1,"mode-name"],[1,"mode-description"],["mat-raised-button","","color","primary",1,"mode-button",3,"click","disabled"],["mat-raised-button","","color","warn",1,"mode-button",3,"click","disabled"],["class","connecting-status",4,"ngIf"],["class","active-controls",4,"ngIf"],[1,"instructions-card"],[1,"instruction-item"],["color","accent"],["color","primary"],["color","warn"],[1,"connecting-status"],["diameter","30"],[1,"active-controls"],["mat-raised-button","",3,"click","color"],["mat-raised-button","","color","warn",3,"click"]],template:function(r,m){r&1&&(t(0,"div",0)(1,"div",1)(2,"button",2),p("click",function(){return m.goBack()}),t(3,"mat-icon"),i(4,"arrow_back"),e()(),t(5,"h2"),i(6,"Supervisi\xF3n de Llamada"),e()(),h(7,L,4,0,"div",3)(8,$,100,14,"div",4),e()),r&2&&(a(7),l("ngIf",!m.call),a(),l("ngIf",m.call))},dependencies:[P,E,D,y,A,k,I,V,U,T,R,B,N,H,j,z],styles:[".supervision-container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.supervision-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:24px}.supervision-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:500}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;gap:20px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#666}.call-details-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.status-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding-top:16px}.status-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px}.status-info[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]{font-size:14px}.status-info[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.duration[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:18px;font-weight:500}.duration[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#666}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px;padding:8px 0}.info-item[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-start}.info-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3f51b5;margin-top:4px}.info-label[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase;margin-bottom:4px}.info-value[_ngcontent-%COMP%]{font-size:18px;font-weight:500;margin-bottom:2px}.info-sublabel[_ngcontent-%COMP%]{font-size:14px;color:#888}.mode-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:20px}.mode-button[_ngcontent-%COMP%]{min-height:80px!important;display:flex!important;flex-direction:column!important;align-items:center!important;justify-content:center!important;gap:8px!important;padding:16px!important}.mode-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px}.button-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.mode-name[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.mode-description[_ngcontent-%COMP%]{font-size:12px;opacity:.8}.connecting-status[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:16px;padding:20px;background-color:#f5f5f5;border-radius:4px;margin-bottom:16px}.active-controls[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;padding:20px;background-color:#e3f2fd;border-radius:4px}.active-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:160px}.instruction-item[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-start;padding:12px 0}.instruction-item[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #e0e0e0}.instruction-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-top:2px}.instruction-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}@media (max-width: 768px){.supervision-container[_ngcontent-%COMP%]{padding:12px}.mode-buttons[_ngcontent-%COMP%], .info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.active-controls[_ngcontent-%COMP%]{flex-direction:column}.active-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]});let c=s;return c})();export{mt as AdminCallSupervision};
