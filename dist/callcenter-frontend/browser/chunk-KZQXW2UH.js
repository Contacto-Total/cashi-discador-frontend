import{a as E,b as T,d as G,e as J,g as K}from"./chunk-PKFBRZD7.js";import"./chunk-RIMEIBS7.js";import"./chunk-VUSOBWTB.js";import{E as q}from"./chunk-E2JO3TS2.js";import{lc as H,mc as B}from"./chunk-RTTQIKVQ.js";import{a as W}from"./chunk-YQKVMPSG.js";import{c as U}from"./chunk-72Z2NTOL.js";import{Eb as h,Fb as f,Hb as A,Ib as y,Jb as D,Kb as l,Lb as s,Mb as a,Nb as p,Ub as I,Wb as _,Yb as g,_ as V,a as O,ab as o,b as R,ba as L,fa as j,gb as F,gc as S,jc as P,kc as c,lc as k,ld as $,ma as x,mc as M,n as z,na as v,nb as N,vc as w,wa as C}from"./chunk-BDAG5FYU.js";var Q=(()=>{let r=class r{constructor(t){this.http=t,this.menuItemsSubject=new z([]),this.menuItems$=this.menuItemsSubject.asObservable(),this.apiUrl=`${W.apiUrl}/menu`}loadVisibleMenu(){return this.http.get(`${this.apiUrl}/visible`).pipe(V(t=>this.menuItemsSubject.next(t)))}getMenuItems(){return this.menuItemsSubject.value}getMenuConfigForRole(t){return this.http.get(`${this.apiUrl}/config/${t}`)}getAllRolesConfig(){return this.http.get(`${this.apiUrl}/config/all`)}updateMenuConfig(t){return this.http.put(`${this.apiUrl}/config`,t)}clearMenu(){this.menuItemsSubject.next([])}};r.\u0275fac=function(e){return new(e||r)(j(U))},r.\u0275prov=L({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var X=i=>[i],Y=(i,r)=>r.codigo;function te(i,r){if(i&1){let d=I();s(0,"button",14),_("click",function(){let e=x(d).$implicit,n=g();return v(n.selectRole(e))}),c(1),a()}if(i&2){let d=r.$implicit,t=g();P(t.selectedRole()===d?"bg-indigo-600 text-white":"bg-slate-800 text-gray-300 hover:bg-slate-700"),o(),M(" ",t.roleLabels[d]," ")}}function ie(i,r){i&1&&(s(0,"div",13),p(1,"lucide-angular",15),a()),i&2&&(o(),l("size",32))}function ne(i,r){i&1&&(s(0,"span",36),c(1,"(dropdown)"),a())}function oe(i,r){i&1&&(s(0,"span",37),c(1,"\u21B3 hijo"),a())}function re(i,r){if(i&1){let d=I();s(0,"div",23)(1,"div",32),p(2,"lucide-angular",33)(3,"lucide-angular",34),s(4,"span",35),c(5),a(),h(6,ne,2,0,"span",36),h(7,oe,2,0,"span",37),a(),s(8,"button",38),_("click",function(){let e=x(d).$implicit,n=g(2);return v(n.moveToHidden(e))}),p(9,"lucide-angular",39),a()()}if(i&2){let d=r.$implicit;o(2),l("size",14),o(),l("name",d.icono)("size",16),o(2),k(d.etiqueta),o(),f(d.tipo==="DROPDOWN"?6:-1),o(),f(d.codigoPadre?7:-1),o(2),l("size",14)}}function se(i,r){i&1&&(s(0,"div",24),p(1,"lucide-angular",39),s(2,"p",40),c(3,"Arrastra elementos aqui"),a()()),i&2&&(o(),l("size",32))}function ae(i,r){i&1&&(s(0,"span",36),c(1,"(dropdown)"),a())}function de(i,r){i&1&&(s(0,"span",36),c(1,"\u21B3 hijo"),a())}function le(i,r){if(i&1){let d=I();s(0,"div",26)(1,"div",32),p(2,"lucide-angular",33)(3,"lucide-angular",41),s(4,"span",42),c(5),a(),h(6,ae,2,0,"span",36),h(7,de,2,0,"span",36),a(),s(8,"button",43),_("click",function(){let e=x(d).$implicit,n=g(2);return v(n.moveToVisible(e))}),p(9,"lucide-angular",44),a()()}if(i&2){let d=r.$implicit;o(2),l("size",14),o(),l("name",d.icono)("size",16),o(2),k(d.etiqueta),o(),f(d.tipo==="DROPDOWN"?6:-1),o(),f(d.codigoPadre?7:-1),o(2),l("size",14)}}function ce(i,r){i&1&&(s(0,"div",24),p(1,"lucide-angular",45),s(2,"p",40),c(3,"Todos los elementos son visibles"),a()()),i&2&&(o(),l("size",32))}function me(i,r){i&1&&p(0,"lucide-angular",30),i&2&&l("size",16)}function pe(i,r){i&1&&p(0,"lucide-angular",31),i&2&&l("size",16)}function ue(i,r){if(i&1){let d=I();s(0,"div",16)(1,"div",17)(2,"div",18),p(3,"lucide-angular",19),s(4,"h2",20),c(5,"Elementos Visibles"),a(),s(6,"span",21),c(7),a()(),s(8,"div",22,0),_("cdkDropListDropped",function(e){x(d);let n=g();return v(n.dropVisible(e))}),y(10,re,10,7,"div",23,Y),h(12,se,4,1,"div",24),a()(),s(13,"div",17)(14,"div",18),p(15,"lucide-angular",25),s(16,"h2",20),c(17,"Elementos Ocultos"),a(),s(18,"span",21),c(19),a()(),s(20,"div",22,1),_("cdkDropListDropped",function(e){x(d);let n=g();return v(n.dropHidden(e))}),y(22,le,10,7,"div",26,Y),h(24,ce,4,1,"div",24),a()()(),s(25,"div",27)(26,"button",28),_("click",function(){x(d);let e=g();return v(e.cancel())}),c(27," Cancelar "),a(),s(28,"button",29),_("click",function(){x(d);let e=g();return v(e.save())}),h(29,me,1,1,"lucide-angular",30)(30,pe,1,1,"lucide-angular",31),c(31," Guardar Cambios "),a()()}if(i&2){let d=S(9),t=S(21),e=g();o(3),l("size",18),o(4),M("(",e.visibleItems().length,")"),o(),l("cdkDropListData",e.visibleItems())("cdkDropListConnectedTo",w(13,X,t)),o(2),D(e.visibleItems()),o(2),f(e.visibleItems().length===0?12:-1),o(3),l("size",18),o(4),M("(",e.hiddenItems().length,")"),o(),l("cdkDropListData",e.hiddenItems())("cdkDropListConnectedTo",w(15,X,d)),o(2),D(e.hiddenItems()),o(2),f(e.hiddenItems().length===0?24:-1),o(2),l("disabled",!e.hasChanges()),o(2),l("disabled",!e.hasChanges()||e.saving()),o(),f(e.saving()?29:30)}}var Me=(()=>{let r=class r{constructor(t){this.menuService=t,this.roles=["ADMIN","SUPERVISOR","AGENT","COORDINADOR"],this.selectedRole=C("SUPERVISOR"),this.visibleItems=C([]),this.hiddenItems=C([]),this.loading=C(!1),this.saving=C(!1),this.hasChanges=C(!1),this.roleLabels={ADMIN:"Administrador",SUPERVISOR:"Supervisor",AGENT:"Agente",COORDINADOR:"Coordinador"}}ngOnInit(){this.loadRoleConfig(this.selectedRole())}selectRole(t){this.hasChanges()&&!confirm("Hay cambios sin guardar. \xBFDesea continuar?")||(this.selectedRole.set(t),this.loadRoleConfig(t))}loadRoleConfig(t){this.loading.set(!0),this.menuService.getMenuConfigForRole(t).subscribe({next:e=>{let n=[],m=[];e.forEach(u=>{let b=R(O({},u),{visible:u.visible??!1});u.visible?n.push(b):m.push(b)}),n.sort((u,b)=>u.orden-b.orden),m.sort((u,b)=>u.orden-b.orden),this.visibleItems.set(n),this.hiddenItems.set(m),this.hasChanges.set(!1),this.loading.set(!1)},error:e=>{console.error("Error loading menu config:",e),this.loading.set(!1),alert("Error al cargar la configuracion del menu")}})}dropVisible(t){if(t.previousContainer===t.container){let e=[...this.visibleItems()];E(e,t.previousIndex,t.currentIndex),this.visibleItems.set(e)}else{let e=[...this.hiddenItems()],n=[...this.visibleItems()];T(e,n,t.previousIndex,t.currentIndex),this.hiddenItems.set(e),this.visibleItems.set(n)}this.updateOrders(),this.hasChanges.set(!0)}dropHidden(t){if(t.previousContainer===t.container){let e=[...this.hiddenItems()];E(e,t.previousIndex,t.currentIndex),this.hiddenItems.set(e)}else{let e=[...this.visibleItems()],n=[...this.hiddenItems()];T(e,n,t.previousIndex,t.currentIndex),this.visibleItems.set(e),this.hiddenItems.set(n)}this.updateOrders(),this.hasChanges.set(!0)}moveToVisible(t){let e=[...this.hiddenItems()],n=[...this.visibleItems()],m=e.findIndex(u=>u.codigo===t.codigo);m>-1&&(e.splice(m,1),n.push(t)),this.hiddenItems.set(e),this.visibleItems.set(n),this.updateOrders(),this.hasChanges.set(!0)}moveToHidden(t){let e=[...this.hiddenItems()],n=[...this.visibleItems()],m=n.findIndex(u=>u.codigo===t.codigo);m>-1&&(n.splice(m,1),e.push(t)),this.visibleItems.set(n),this.hiddenItems.set(e),this.updateOrders(),this.hasChanges.set(!0)}updateOrders(){let t=this.visibleItems(),e=this.hiddenItems();t.forEach((n,m)=>{n.orden=m+1,n.visible=!0}),e.forEach((n,m)=>{n.orden=m+1,n.visible=!1})}save(){this.saving.set(!0);let t=[...this.visibleItems(),...this.hiddenItems()],e={rol:this.selectedRole(),permissions:t.map(n=>({menuCodigo:n.codigo,visible:n.visible,orden:n.orden}))};this.menuService.updateMenuConfig(e).subscribe({next:()=>{this.saving.set(!1),this.hasChanges.set(!1),alert("Configuracion guardada correctamente")},error:n=>{console.error("Error saving config:",n),this.saving.set(!1),alert("Error al guardar la configuracion")}})}cancel(){this.hasChanges()&&confirm("\xBFDescartar los cambios?")&&this.loadRoleConfig(this.selectedRole())}getItemTypeLabel(t){return t==="DROPDOWN"?"(dropdown)":""}};r.\u0275fac=function(e){return new(e||r)(F(Q))},r.\u0275cmp=N({type:r,selectors:[["app-menu-configuration"]],decls:17,vars:2,consts:[["visibleList","cdkDropList"],["hiddenList","cdkDropList"],[1,"h-[calc(100dvh-56px)]","bg-slate-950","overflow-hidden","flex","flex-col"],[1,"flex-1","overflow-y-auto"],[1,"p-4","max-w-[1400px]","mx-auto"],[1,"mb-4"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-gradient-to-br","from-indigo-600","to-indigo-700","rounded-lg","flex","items-center","justify-center"],["name","menu",1,"text-white",3,"size"],[1,"text-xl","font-bold","text-white"],[1,"text-sm","text-gray-400"],[1,"flex","gap-2","mb-4"],[1,"px-4","py-2","rounded-lg","text-sm","font-semibold","transition-colors",3,"class"],[1,"flex","items-center","justify-center","py-12"],[1,"px-4","py-2","rounded-lg","text-sm","font-semibold","transition-colors",3,"click"],["name","loader-2",1,"text-indigo-400","animate-spin",3,"size"],[1,"grid","grid-cols-2","gap-4"],[1,"bg-slate-900","rounded-lg","border","border-slate-800","p-4"],[1,"flex","items-center","gap-2","mb-3"],["name","eye",1,"text-green-400",3,"size"],[1,"text-sm","font-bold","text-white"],[1,"text-xs","text-gray-400"],["cdkDropList","",1,"min-h-[400px]","space-y-1","p-2","bg-slate-800/50","rounded-lg","border-2","border-dashed","border-slate-700",3,"cdkDropListDropped","cdkDropListData","cdkDropListConnectedTo"],["cdkDrag","",1,"flex","items-center","justify-between","p-2","bg-slate-800","rounded","border","border-slate-700","cursor-move","hover:border-indigo-500/50","group"],[1,"flex","flex-col","items-center","justify-center","py-8","text-gray-500"],["name","eye-off",1,"text-red-400",3,"size"],["cdkDrag","",1,"flex","items-center","justify-between","p-2","bg-slate-800","rounded","border","border-slate-700","cursor-move","hover:border-indigo-500/50","group","opacity-60","hover:opacity-100"],[1,"mt-4","flex","justify-end","gap-2"],[1,"px-4","py-2","bg-slate-700","hover:bg-slate-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","text-sm","font-semibold","transition-colors",3,"click","disabled"],[1,"px-4","py-2","bg-indigo-600","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","text-sm","font-semibold","transition-colors","flex","items-center","gap-2",3,"click","disabled"],["name","loader-2",1,"animate-spin",3,"size"],["name","save",3,"size"],[1,"flex","items-center","gap-2"],["name","grip-vertical",1,"text-gray-500",3,"size"],[1,"text-indigo-400",3,"name","size"],[1,"text-sm","text-white"],[1,"text-xs","text-gray-500"],[1,"text-xs","text-indigo-400/60"],[1,"p-1","text-gray-400","hover:text-red-400","opacity-0","group-hover:opacity-100","transition-opacity",3,"click"],["name","eye-off",3,"size"],[1,"text-sm","mt-2"],[1,"text-gray-400",3,"name","size"],[1,"text-sm","text-gray-300"],[1,"p-1","text-gray-400","hover:text-green-400","opacity-0","group-hover:opacity-100","transition-opacity",3,"click"],["name","eye",3,"size"],["name","check-circle",3,"size"]],template:function(e,n){e&1&&(s(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),p(6,"lucide-angular",8),a(),s(7,"div")(8,"h1",9),c(9,"Configuracion de Menu"),a(),s(10,"p",10),c(11,"Configura la visibilidad del menu por rol"),a()()()(),s(12,"div",11),y(13,te,2,3,"button",12,A),a(),h(15,ie,2,1,"div",13)(16,ue,32,17),a()()()),e&2&&(o(6),l("size",20),o(7),D(n.roles),o(2),f(n.loading()?15:16))},dependencies:[$,q,B,H,K,J,G],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;background:#1e293b;border:1px solid #6366f1}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.3}.cdk-drag-animating[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-receiving[_ngcontent-%COMP%]{border-color:#6366f1!important;background:#6366f11a!important}"]});let i=r;return i})();export{Me as MenuConfigurationComponent};
