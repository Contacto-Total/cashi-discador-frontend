import{I as l,L as u,Mb as m,O as n,Rb as h,Wb as g,k as c}from"./chunk-3TEXBYCN.js";var d=(()=>{let r=class r{constructor(e,i){this.http=e,this.router=i,this.TOKEN_KEY="callcenter_token",this.USER_KEY="callcenter_user";let o=null;try{let t=localStorage.getItem(this.USER_KEY);t&&t!=="undefined"&&(o=JSON.parse(t))}catch(t){console.error("Error parsing stored user",t),localStorage.removeItem(this.USER_KEY)}this.currentUserSubject=new c(o),this.currentUser$=this.currentUserSubject.asObservable()}login(e,i){let o={username:e,password:i};return this.http.post(`${g.apiUrl}/auth/login`,o).pipe(l(t=>{localStorage.setItem(this.TOKEN_KEY,t.token);let a={id:t.id,username:t.username,email:t.email,firstName:t.firstName,lastName:t.lastName,role:t.role,sipExtension:t.sipExtension,active:!0};localStorage.setItem(this.USER_KEY,JSON.stringify(a)),this.currentUserSubject.next(a)}))}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.currentUserSubject.next(null),this.router.navigate(["/login"])}isAuthenticated(){let e=this.getToken();if(!e)return!1;try{let o=JSON.parse(atob(e.split(".")[1])).exp*1e3;return Date.now()<o}catch{return!1}}getToken(){return localStorage.getItem(this.TOKEN_KEY)}getCurrentUser(){return this.currentUserSubject.value}getCurrentUserId(){let e=this.getCurrentUser();return e?e.id:null}};r.\u0275fac=function(i){return new(i||r)(n(m),n(h))},r.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();export{d as a};
