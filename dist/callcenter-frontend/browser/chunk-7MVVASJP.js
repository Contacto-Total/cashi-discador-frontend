import{a as ee}from"./chunk-FYJX7DO7.js";import{a as te}from"./chunk-LL26DHMR.js";import{a as K,b as Q,c as R,d as X,e as Y,f as Z}from"./chunk-UVU2MZPI.js";import"./chunk-PXL5Y6WR.js";import"./chunk-HQPDVYNW.js";import{a as U}from"./chunk-ZP3TNI7E.js";import{E as $,c as j,f as B,k as J,s as G,t as H,u as q}from"./chunk-7GV7UZOL.js";import{$b as W,_b as L}from"./chunk-W3UIH3CO.js";import"./chunk-YQKVMPSG.js";import{Fb as C,Gb as x,Jb as v,Kb as y,Lb as m,Mb as i,Nb as n,Ob as u,Vb as k,Xb as g,Zb as b,a as I,ab as l,b as T,gb as D,kc as N,lc as s,mc as O,md as z,na as h,nb as A,nc as S,oa as _,oc as E,qc as w,rc as M,sb as V,sc as P,xa as f}from"./chunk-SN4XSKG7.js";var F=(o,d)=>d.id;function ie(o,d){o&1&&(u(0,"div",16),i(1,"span"),s(2,"Guardando..."),n())}function ne(o,d){o&1&&(u(0,"lucide-angular",17),i(1,"span"),s(2,"Guardar Cambios"),n()),o&2&&m("size",18)}function oe(o,d){if(o&1&&(i(0,"option",13),s(1),n()),o&2){let a=d.$implicit;m("value",a.id),l(),E("",a.tenantName," (",a.tenantCode,")")}}function re(o,d){if(o&1&&(i(0,"option",13),s(1),n()),o&2){let a=d.$implicit;m("value",a.id),l(),E("",a.portfolioName," (",a.portfolioCode,")")}}function ae(o,d){if(o&1&&(i(0,"option",13),s(1),n()),o&2){let a=d.$implicit;m("value",a.id),l(),E("",a.subPortfolioName," (",a.subPortfolioCode,")")}}function le(o,d){o&1&&(i(0,"div",25),u(1,"div",26),i(2,"p",27),s(3,"Cargando campos de montos..."),n()())}function se(o,d){o&1&&(i(0,"div",25)(1,"div",28),u(2,"lucide-angular",29),n(),i(3,"p",30),s(4,"No se encontraron campos de montos"),n(),i(5,"p",31),s(6," Esta subcartera no tiene campos num\xE9ricos decimales configurados "),n()()),o&2&&(l(2),m("size",32))}function de(o,d){o&1&&u(0,"div",52)}function me(o,d){if(o&1){let a=k();i(0,"div",38)(1,"div",39)(2,"div",40),u(3,"lucide-angular",41),n(),i(4,"div",42),s(5),n(),i(6,"div",43)(7,"input",44),P("ngModelChange",function(r){let e=h(a).$implicit;return M(e.nombre,r)||(e.nombre=r),_(r)}),g("ngModelChange",function(){let r=h(a).$implicit,e=b(3);return _(e.onNameChange(r))}),n(),i(8,"div",45),s(9),n()(),i(10,"div",46),s(11),n()(),i(12,"label",47)(13,"input",48),g("change",function(){let r=h(a).$implicit,e=b(3);return _(e.toggleVisibility(r))}),n(),u(14,"div",49),i(15,"span",50),s(16),n()(),V(17,de,1,0,"div",51),n()}if(o&2){let a=d.$implicit,t=d.$index;l(3),m("size",20),l(2),S(" ",t+1," "),l(2),w("ngModel",a.nombre),m("title","Editar nombre: "+a.nombre),l(2),O(a.codigo),l(2),S(" ",a.tipoSql," "),l(2),m("checked",a.isVisible),l(2),N(a.isVisible?"text-amber-400":"text-gray-500"),l(),S(" ",a.isVisible?"Visible":"Oculto"," ")}}function ce(o,d){if(o&1){let a=k();i(0,"div",32)(1,"div",2)(2,"span",33),s(3),n(),i(4,"div",34)(5,"button",35),g("click",function(){h(a);let r=b(2);return _(r.toggleAll(!0))}),s(6," Mostrar todos "),n(),i(7,"button",36),g("click",function(){h(a);let r=b(2);return _(r.toggleAll(!1))}),s(8," Ocultar todos "),n()()()(),i(9,"div",37),g("cdkDropListDropped",function(r){h(a);let e=b(2);return _(e.drop(r))}),v(10,me,18,10,"div",38,F),n()}if(o&2){let a=b(2);l(3),S(" ",a.amountFields().length," campos de montos encontrados "),l(7),y(a.amountFields())}}function pe(o,d){if(o&1&&(i(0,"div",1)(1,"div",18)(2,"div",19),u(3,"lucide-angular",20),i(4,"div")(5,"p",21),s(6,"Instrucciones"),n(),i(7,"ul",22)(8,"li"),s(9,"Use los toggles para mostrar u ocultar cada campo de monto en el panel de deuda"),n(),i(10,"li"),s(11,"Haga clic en el nombre para editarlo y personalizar c\xF3mo se muestra"),n(),i(12,"li"),s(13,"Arrastre los campos para cambiar el orden de visualizaci\xF3n"),n(),i(14,"li"),s(15,'Los cambios se guardan al hacer clic en "Guardar Cambios"'),n()()()()()(),i(16,"div",23)(17,"div",24),C(18,le,4,0,"div",25)(19,se,7,1,"div",25)(20,ce,12,1),n()()),o&2){let a=b();l(3),m("size",20),l(15),x(a.loading()?18:a.amountFields().length===0?19:20)}}function ue(o,d){o&1&&(i(0,"div",15),u(1,"lucide-angular",53),i(2,"span"),s(3,"Cambios guardados exitosamente"),n()()),o&2&&(l(),m("size",20))}var De=(()=>{let d=class d{constructor(t,r,e){this.typificationService=t,this.portfolioService=r,this.managementService=e,this.tenants=f([]),this.portfolios=f([]),this.subPortfolios=f([]),this.amountFields=f([]),this.originalFields=f([]),this.loading=f(!1),this.saving=f(!1),this.showSuccess=f(!1),this.selectedTenantId=0,this.selectedPortfolioId=0,this.selectedSubPortfolioId=0}ngOnInit(){this.loadTenants()}loadTenants(){this.typificationService.getAllTenants().subscribe({next:t=>{this.tenants.set(t)},error:t=>{console.error("Error loading tenants:",t)}})}onTenantChange(){this.selectedPortfolioId=0,this.selectedSubPortfolioId=0,this.portfolios.set([]),this.subPortfolios.set([]),this.amountFields.set([]),this.originalFields.set([]),this.selectedTenantId>0&&this.loadPortfolios()}loadPortfolios(){this.portfolioService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:t=>{this.portfolios.set(t)},error:t=>{console.error("Error loading portfolios:",t)}})}onPortfolioChange(){this.selectedSubPortfolioId=0,this.subPortfolios.set([]),this.amountFields.set([]),this.originalFields.set([]),this.selectedPortfolioId>0&&this.loadSubPortfolios()}loadSubPortfolios(){this.portfolioService.getSubPortfoliosByPortfolio(this.selectedPortfolioId).subscribe({next:t=>{this.subPortfolios.set(t)},error:t=>{console.error("Error loading subportfolios:",t)}})}onSubPortfolioChange(){this.amountFields.set([]),this.originalFields.set([]),this.selectedSubPortfolioId>0&&this.loadAmountFields()}loadAmountFields(){this.loading.set(!0),this.managementService.getMontoCabeceras(this.selectedSubPortfolioId).subscribe({next:t=>{let e=[...t].sort((c,p)=>(c.ordenMonto||0)-(p.ordenMonto||0)).map(c=>T(I({},c),{isVisible:c.esVisibleMonto===1||c.esVisibleMonto===void 0||c.esVisibleMonto===null}));this.amountFields.set(e),this.originalFields.set(JSON.parse(JSON.stringify(e))),this.loading.set(!1)},error:t=>{console.error("Error loading amount fields:",t),this.loading.set(!1)}})}toggleVisibility(t){t.isVisible=!t.isVisible,this.amountFields.set([...this.amountFields()])}onNameChange(t){this.amountFields.set([...this.amountFields()])}toggleAll(t){let r=this.amountFields().map(e=>T(I({},e),{isVisible:t}));this.amountFields.set(r)}drop(t){let r=[...this.amountFields()];K(r,t.previousIndex,t.currentIndex),this.amountFields.set(r)}hasChanges(){let t=this.amountFields(),r=this.originalFields();if(t.length!==r.length)return!0;for(let e=0;e<t.length;e++)if(t[e].id!==r[e].id||t[e].isVisible!==r[e].isVisible||t[e].nombre!==r[e].nombre)return!0;return!1}saveChanges(){if(!this.hasChanges()||this.saving())return;this.saving.set(!0);let t=this.amountFields().map((r,e)=>({id:r.id,esVisibleMonto:r.isVisible?1:0,ordenMonto:e*10,nombre:r.nombre}));this.managementService.updateAmountVisibility(this.selectedSubPortfolioId,t).subscribe({next:()=>{this.saving.set(!1),this.showSuccessMessage(),this.originalFields.set(JSON.parse(JSON.stringify(this.amountFields())))},error:r=>{console.error("Error saving changes:",r),this.saving.set(!1),alert("Error al guardar los cambios")}})}showSuccessMessage(){this.showSuccess.set(!0),setTimeout(()=>this.showSuccess.set(!1),3e3)}};d.\u0275fac=function(r){return new(r||d)(D(te),D(U),D(ee))},d.\u0275cmp=A({type:d,selectors:[["app-amount-display-config"]],decls:44,vars:13,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","p-6"],[1,"max-w-5xl","mx-auto","mb-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-2","mb-2"],[1,"w-8","h-8","bg-amber-600","rounded-lg","flex","items-center","justify-center"],["name","eye",1,"text-white",3,"size"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-gray-400"],[1,"flex","items-center","gap-2","px-5","py-2.5","bg-gradient-to-r","from-emerald-600","to-emerald-700","text-white","rounded-lg","font-semibold","hover:shadow-lg","transition-all","hover:scale-105","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:scale-100","cursor-pointer",3,"click","disabled"],[1,"bg-slate-900","rounded-xl","p-4","shadow-sm","border","border-slate-800"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-semibold","text-gray-300","mb-2"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-amber-500",3,"ngModelChange","ngModel"],[3,"value"],[1,"w-full","px-4","py-2.5","bg-slate-800","border","border-slate-700","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-amber-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],[1,"fixed","bottom-6","right-6","bg-emerald-600","text-white","px-6","py-3","rounded-lg","shadow-lg","flex","items-center","gap-3","animate-slide-in"],[1,"w-4","h-4","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],["name","save",3,"size"],[1,"bg-amber-900/20","border","border-amber-700/50","rounded-xl","p-4"],[1,"flex","items-start","gap-3"],["name","info",1,"text-amber-400","mt-0.5","flex-shrink-0",3,"size"],[1,"text-amber-200","text-sm","font-medium"],[1,"text-amber-200/70","text-sm","mt-1","space-y-1"],[1,"max-w-5xl","mx-auto"],[1,"bg-slate-900","rounded-xl","shadow-sm","border","border-slate-800","overflow-hidden"],[1,"p-12","text-center"],[1,"inline-block","w-8","h-8","border-4","border-amber-500","border-t-transparent","rounded-full","animate-spin"],[1,"mt-4","text-gray-400"],[1,"w-16","h-16","bg-slate-800","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],["name","dollar-sign",1,"text-gray-600",3,"size"],[1,"text-gray-300","mb-2"],[1,"text-sm","text-gray-500"],[1,"bg-slate-800","border-b","border-slate-700","px-6","py-3"],[1,"text-sm","font-semibold","text-gray-300"],[1,"flex","items-center","gap-4"],[1,"text-xs","text-emerald-400","hover:text-emerald-300","transition-colors",3,"click"],[1,"text-xs","text-red-400","hover:text-red-300","transition-colors",3,"click"],["cdkDropList","",1,"divide-y","divide-slate-800",3,"cdkDropListDropped"],["cdkDrag","",1,"flex","items-center","justify-between","px-6","py-4","hover:bg-slate-800/50","transition-colors","cursor-move"],[1,"flex","items-center","gap-4","flex-1"],["cdkDragHandle","",1,"text-slate-600","hover:text-slate-400","cursor-grab","active:cursor-grabbing"],["name","grip-vertical",3,"size"],[1,"w-8","h-8","bg-slate-800","rounded-lg","flex","items-center","justify-center","text-sm","font-bold","text-slate-400"],[1,"flex-1","min-w-0"],["type","text",1,"w-full","bg-transparent","border-b","border-transparent","hover:border-slate-600","focus:border-amber-500","focus:outline-none","font-medium","text-white","px-1","py-0.5","-ml-1","transition-colors",3,"ngModelChange","ngModel","title"],[1,"text-xs","text-gray-500","font-mono","mt-0.5"],[1,"px-2","py-1","bg-slate-800","rounded","text-xs","text-gray-400"],[1,"relative","inline-flex","items-center","cursor-pointer","ml-4"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-slate-700","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-amber-800","rounded-full","peer","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-amber-600"],[1,"ml-3","text-sm","font-medium"],["class","bg-amber-900/20 border-2 border-dashed border-amber-500 rounded-lg h-16",4,"cdkDragPlaceholder"],[1,"bg-amber-900/20","border-2","border-dashed","border-amber-500","rounded-lg","h-16"],["name","check-circle",3,"size"]],template:function(r,e){r&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"div",4),u(6,"lucide-angular",5),n(),i(7,"div")(8,"h1",6),s(9,"Campos de Montos a Mostrar"),n(),i(10,"p",7),s(11,"Configure qu\xE9 campos de importes se muestran en el panel de deuda"),n()()()(),i(12,"button",8),g("click",function(){return e.saveChanges()}),C(13,ie,3,0)(14,ne,3,1),n()()(),i(15,"div",1)(16,"div",9)(17,"div",10)(18,"div")(19,"label",11),s(20," Proveedor "),n(),i(21,"select",12),P("ngModelChange",function(p){return M(e.selectedTenantId,p)||(e.selectedTenantId=p),p}),g("ngModelChange",function(){return e.onTenantChange()}),i(22,"option",13),s(23,"Seleccione un proveedor..."),n(),v(24,oe,2,3,"option",13,F),n()(),i(26,"div")(27,"label",11),s(28," Cartera "),n(),i(29,"select",14),P("ngModelChange",function(p){return M(e.selectedPortfolioId,p)||(e.selectedPortfolioId=p),p}),g("ngModelChange",function(){return e.onPortfolioChange()}),i(30,"option",13),s(31,"Seleccione una cartera..."),n(),v(32,re,2,3,"option",13,F),n()(),i(34,"div")(35,"label",11),s(36," Subcartera "),n(),i(37,"select",14),P("ngModelChange",function(p){return M(e.selectedSubPortfolioId,p)||(e.selectedSubPortfolioId=p),p}),g("ngModelChange",function(){return e.onSubPortfolioChange()}),i(38,"option",13),s(39,"Seleccione una subcartera..."),n(),v(40,ae,2,3,"option",13,F),n()()()()(),C(42,pe,21,2),C(43,ue,4,1,"div",15),n()),r&2&&(l(6),m("size",16),l(6),m("disabled",!e.hasChanges()||e.saving()),l(),x(e.saving()?13:14),l(8),w("ngModel",e.selectedTenantId),l(),m("value",0),l(2),y(e.tenants()),l(5),w("ngModel",e.selectedPortfolioId),m("disabled",e.selectedTenantId===0),l(),m("value",0),l(2),y(e.portfolios()),l(5),w("ngModel",e.selectedSubPortfolioId),m("disabled",e.selectedPortfolioId===0),l(),m("value",0),l(2),y(e.subPortfolios()),l(2),x(e.selectedSubPortfolioId>0?42:-1),l(),x(e.showSuccess()?43:-1))},dependencies:[z,$,H,q,j,G,B,J,W,L,Z,X,R,Q,Y],styles:["@keyframes _ngcontent-%COMP%_slide-in{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}.animate-slide-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in .3s ease-out}.cdk-drag-preview[_ngcontent-%COMP%]{background:#1e293b;border-radius:.5rem;box-shadow:0 25px 50px -12px #00000080;border:1px solid #334155}.cdk-drag-animating[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"]});let o=d;return o})();export{De as AmountDisplayConfigComponent};
