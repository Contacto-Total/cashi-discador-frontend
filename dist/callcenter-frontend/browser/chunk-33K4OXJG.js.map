{
  "version": 3,
  "sources": ["src/app/collection-management/services/management.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, map } from 'rxjs';\r\nimport { environment } from '../../../environments/environment';\r\nimport { PaymentSchedule } from '../models/payment-schedule.model';\r\n\r\n/**\r\n * Interface para el registro de gestión V2 del backend discador\r\n */\r\nexport interface RegistroGestionV2 {\r\n  id?: number;\r\n  uuid?: string;\r\n  idTenant: number;\r\n  idCartera?: number;\r\n  idSubcartera?: number;\r\n  idCliente: number;\r\n  nombreCliente?: string;\r\n  documentoCliente?: string;\r\n  idAgente: number;\r\n  idCampana?: number;\r\n  idLlamada?: number;\r\n  fechaGestion?: string;\r\n  duracionSegundos?: number;\r\n  tipificacion: { id: number };\r\n  rutaNivel1?: string;\r\n  rutaNivel2?: string;\r\n  rutaNivel3?: string;\r\n  rutaNivel4?: string;\r\n  observaciones?: string;\r\n  metodoContacto?: string;\r\n  canalContacto?: string;\r\n  estadoGestion?: string;\r\n  nombreAgente?: string;\r\n  userAgent?: string;\r\n  // Campos adicionales\r\n  telefonoContacto?: string;\r\n  montoPromesa?: number;\r\n  estadoPago?: string;\r\n}\r\n\r\nexport interface ManagementResource {\r\n  id: number;\r\n  customerId: string;\r\n  advisorId: string;\r\n\r\n  // Multi-tenant fields\r\n  tenantId: number;\r\n  tenantName: string;\r\n  portfolioId: number;\r\n  portfolioName: string;\r\n  subPortfolioId?: number;\r\n  subPortfolioName?: string;\r\n\r\n  // Contact info\r\n  phone: string;\r\n  telefonoContacto?: string;  // Teléfono de contacto usado\r\n\r\n  // Hierarchical categorization\r\n  level1Id: number;\r\n  level1Name: string;\r\n  level2Id?: number;\r\n  level2Name?: string;\r\n  level3Id?: number;\r\n  level3Name?: string;\r\n  level4Name?: string;\r\n\r\n  observations?: string;\r\n  typificationRequiresPayment?: boolean;\r\n  typificationRequiresSchedule?: boolean;\r\n\r\n  // Automatic timestamp fields\r\n  managementDate?: string;  // Fecha de gestión (YYYY-MM-DD)\r\n  managementTime?: string;  // Hora de gestión (HH:mm:ss)\r\n\r\n  // Additional fields for history display\r\n  canalContacto?: string;     // Channel (LLAMADA_SALIENTE, WHATSAPP, etc.)\r\n  metodoContacto?: string;    // Method (GESTION_MANUAL, GESTION_PROGRESIVO, etc.)\r\n  nombreAgente?: string;      // Agent name (human readable)\r\n  duracionSegundos?: number;  // Duration in seconds\r\n\r\n  // Promesa de pago\r\n  montoPromesa?: number;      // Monto prometido\r\n  estadoPago?: string;        // Estado del pago (PENDIENTE, PAGADA, VENCIDA, etc.)\r\n}\r\n\r\nexport interface CallDetailResource {\r\n  phoneNumber: string;\r\n  startTime: string;\r\n  endTime?: string;\r\n  durationSeconds?: number;\r\n}\r\n\r\nexport interface PaymentDetailResource {\r\n  amount: number;\r\n  scheduledDate: string;\r\n  paymentMethodType: string;\r\n  paymentMethodDetails?: string;\r\n  voucherNumber?: string;\r\n  bankName?: string;\r\n}\r\n\r\n\r\nexport interface CreateManagementRequest {\r\n  customerId: string;\r\n  customerName?: string;\r\n  customerDocument?: string;\r\n  advisorId: string;\r\n\r\n  // Multi-tenant fields\r\n  tenantId: number;\r\n  portfolioId: number;\r\n  subPortfolioId?: number | null;\r\n\r\n  // Contact info\r\n  phone: string;\r\n\r\n  // Hierarchical categorization (3 levels)\r\n  level1Id: number;\r\n  level1Name: string;\r\n  level2Id?: number | null;\r\n  level2Name?: string | null;\r\n  level3Id?: number | null;\r\n  level3Name?: string | null;\r\n\r\n  observations?: string;\r\n\r\n  // Campos adicionales para registro completo\r\n  // metodoContacto: QUIÉN/QUÉ originó la gestión\r\n  metodoContacto?: 'GESTION_MANUAL' | 'GESTION_PROGRESIVO' | 'GESTION_PREDICTIVO' | 'GESTION_AUTOMATICA';\r\n  // canalContacto: POR QUÉ MEDIO se contactó\r\n  canalContacto?: 'LLAMADA_SALIENTE' | 'LLAMADA_ENTRANTE' | 'SMS' | 'WHATSAPP' | 'EMAIL';\r\n  idCampana?: number | null;\r\n  idLlamada?: number | null;\r\n  duracionSegundos?: number | null;\r\n\r\n  // Información del agente y dispositivo\r\n  nombreAgente?: string;\r\n  userAgent?: string;\r\n}\r\n\r\nexport interface StartCallRequest {\r\n  phoneNumber: string;\r\n  startTime: string;\r\n}\r\n\r\nexport interface EndCallRequest {\r\n  endTime: string;\r\n}\r\n\r\nexport interface RegisterPaymentRequest {\r\n  amount: number;\r\n  scheduledDate: string;\r\n  paymentMethodType: string;\r\n  paymentMethodDetails?: string;\r\n  voucherNumber?: string;\r\n  bankName?: string;\r\n}\r\n\r\n/**\r\n * Interface para crear cronograma de pagos con cuotas\r\n */\r\nexport interface PaymentScheduleRequest {\r\n  idCliente: number;\r\n  nombreCliente?: string;\r\n  documentoCliente?: string;\r\n  idAgente: number;\r\n  idTenant: number;\r\n  idCartera?: number;\r\n  idSubcartera?: number;\r\n  idCampana?: number;\r\n  idTipificacion: number;\r\n  observaciones?: string;\r\n  metodoContacto?: string;  // GESTION_MANUAL, GESTION_PROGRESIVO, etc.\r\n  canalContacto?: string;   // LLAMADA_SALIENTE, LLAMADA_ENTRANTE, SMS, etc.\r\n  campoMontoOrigen?: string;  // Nombre del campo de donde viene el monto (ej: sld_mora, sld_total)\r\n  montoBase?: number;  // Monto original del campo (antes de descuento/excepción). null = monto libre\r\n  schedule: {\r\n    montoTotal: number;\r\n    numeroCuotas: number;\r\n    cuotas: PaymentInstallmentRequest[];\r\n  };\r\n}\r\n\r\nexport interface PaymentInstallmentRequest {\r\n  numeroCuota: number;\r\n  monto: number;\r\n  fechaPago: string; // formato YYYY-MM-DD\r\n}\r\n\r\n/**\r\n * Interface para configuración de cabecera desde la tabla configuracion_cabeceras\r\n */\r\nexport interface ConfiguracionCabecera {\r\n  id: number;\r\n  codigo: string;      // Nombre técnico (ej: SLD_MORA)\r\n  nombre: string;      // Nombre visual (ej: \"Saldo mora\")\r\n  tipoDato: string;    // TEXTO, NUMERICO, FECHA\r\n  tipoSql: string;     // decimal(18,2), int, etc.\r\n  esVisibleMonto?: number;  // 1 = visible, 0 = oculto\r\n  ordenMonto?: number;      // Orden de visualización\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ManagementService {\r\n  // Usando el backend discador para gestiones V2\r\n  private readonly baseUrl = `${environment.gatewayUrl}/v2/management-records`;\r\n  private readonly scheduleUrl = `${environment.tipificacionUrl}/payment-schedules`;\r\n  private readonly cabecerasUrl = `${environment.gatewayUrl}/configuracion-cabeceras`;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  /**\r\n   * Crea un nuevo registro de gestión en el backend discador\r\n   */\r\n  createManagement(request: CreateManagementRequest): Observable<ManagementResource> {\r\n    // Transformar el request al formato que espera el backend discador\r\n    const backendRequest: RegistroGestionV2 = this.transformToBackendFormat(request);\r\n\r\n    console.log('[MANAGEMENT] Creating management record:', backendRequest);\r\n\r\n    return this.http.post<RegistroGestionV2>(this.baseUrl, backendRequest).pipe(\r\n      map(response => this.transformToFrontendFormat(response, request))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Obtiene una gestión por ID\r\n   */\r\n  getManagementById(managementId: string): Observable<ManagementResource> {\r\n    return this.http.get<RegistroGestionV2>(`${this.baseUrl}/${managementId}`).pipe(\r\n      map(response => this.transformToFrontendFormat(response))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Obtiene todas las gestiones de un cliente por ID\r\n   * @deprecated Usar getManagementsByDocumento para mayor robustez\r\n   */\r\n  getManagementsByCustomer(customerId: string): Observable<ManagementResource[]> {\r\n    return this.http.get<RegistroGestionV2[]>(`${this.baseUrl}/client/${customerId}`).pipe(\r\n      map(records => records.map(r => this.transformToFrontendFormat(r)))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Obtiene todas las gestiones de un cliente por documento.\r\n   * Más robusto que buscar por ID ya que el documento es el identificador único.\r\n   */\r\n  getManagementsByDocumento(documento: string): Observable<ManagementResource[]> {\r\n    console.log('[MANAGEMENT] Fetching managements by documento:', documento);\r\n    return this.http.get<RegistroGestionV2[]>(`${this.baseUrl}/documento/${documento}`).pipe(\r\n      map(records => records.map(r => this.transformToFrontendFormat(r)))\r\n    );\r\n  }\r\n\r\n  getManagementsByAdvisor(advisorId: string): Observable<ManagementResource[]> {\r\n    return this.http.get<RegistroGestionV2[]>(`${this.baseUrl}/agent/${advisorId}`).pipe(\r\n      map(records => records.map(r => this.transformToFrontendFormat(r)))\r\n    );\r\n  }\r\n\r\n  getActiveSchedulesByCustomer(customerId: string): Observable<PaymentSchedule[]> {\r\n    console.log('[SCHEDULE] Fetching active schedules for customer:', customerId);\r\n    // Usar el nuevo endpoint del backend discador que devuelve cabeceras con cuotas\r\n    return this.http.get<any[]>(`${this.baseUrl}/payment-schedule/client/${customerId}/active`).pipe(\r\n      map(records => this.transformToPaymentSchedules(records))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Obtiene cronogramas de pago activos por documento del cliente.\r\n   * Más robusto que buscar por ID.\r\n   */\r\n  getActiveSchedulesByDocumento(documento: string): Observable<PaymentSchedule[]> {\r\n    console.log('[SCHEDULE] Fetching active schedules for documento:', documento);\r\n    return this.http.get<any[]>(`${this.baseUrl}/payment-schedule/documento/${documento}/active`).pipe(\r\n      map(records => this.transformToPaymentSchedules(records))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Transforma los registros del backend (RegistroGestionV2 con cuotasPromesa) al formato PaymentSchedule del frontend\r\n   */\r\n  private transformToPaymentSchedules(records: any[]): PaymentSchedule[] {\r\n    return records.map(record => {\r\n      const cuotas = record.cuotasPromesa || [];\r\n\r\n      // Calcular totales (usando montoPromesa que es el nuevo nombre del campo)\r\n      const totalAmount = cuotas.reduce((sum: number, c: any) => sum + (c.montoPromesa || c.monto || 0), 0);\r\n      const paidAmount = cuotas\r\n        .filter((c: any) => c.estado === 'PAGADA' || c.estado === 'CUMPLIDO')\r\n        .reduce((sum: number, c: any) => sum + (c.montoPagadoReal || c.montoPromesa || c.monto || 0), 0);\r\n      const pendingAmount = totalAmount - paidAmount;\r\n\r\n      const paidInstallments = cuotas.filter((c: any) => c.estado === 'PAGADA' || c.estado === 'CUMPLIDO').length;\r\n      const pendingInstallments = cuotas.filter((c: any) => c.estado === 'PENDIENTE').length;\r\n\r\n      return {\r\n        id: record.id,\r\n        scheduleId: {\r\n          scheduleId: record.grupoPromesaUuid || record.uuid\r\n        },\r\n        customerId: String(record.idCliente),\r\n        managementId: String(record.id),\r\n        totalAmount: totalAmount,\r\n        numberOfInstallments: cuotas.length,\r\n        startDate: record.fechaGestion?.split('T')[0] || new Date().toISOString().split('T')[0],\r\n        isActive: pendingInstallments > 0,\r\n        scheduleType: record.tipoCronograma || 'CONFIANZA',\r\n        negotiatedAmount: record.montoPromesaPago || totalAmount,\r\n        installments: cuotas.map((cuota: any) => ({\r\n          id: cuota.id,\r\n          installmentNumber: cuota.numeroCuota,\r\n          numeroCuota: cuota.numeroCuota,\r\n          amount: cuota.montoPromesa || cuota.monto,\r\n          monto: cuota.montoPromesa || cuota.monto,\r\n          montoPromesa: cuota.montoPromesa || cuota.monto,\r\n          dueDate: cuota.fechaPromesa || cuota.fechaPago,\r\n          fechaPago: cuota.fechaPromesa || cuota.fechaPago,\r\n          fechaPromesa: cuota.fechaPromesa || cuota.fechaPago,\r\n          paidDate: cuota.fechaPagoReal || null,\r\n          status: cuota.estado || 'PENDIENTE',\r\n          montoPagadoReal: cuota.montoPagadoReal || 0\r\n        })),\r\n        paidAmount,\r\n        pendingAmount,\r\n        paidInstallments,\r\n        pendingInstallments,\r\n        fullyPaid: pendingInstallments === 0\r\n      } as PaymentSchedule;\r\n    });\r\n  }\r\n\r\n  startCall(managementId: number, request: StartCallRequest): Observable<ManagementResource> {\r\n    // Por ahora mantener la funcionalidad básica\r\n    console.log('[CALL] Start call for management:', managementId, request);\r\n    return this.getManagementById(managementId.toString());\r\n  }\r\n\r\n  endCall(managementId: number, request: EndCallRequest): Observable<ManagementResource> {\r\n    // Por ahora mantener la funcionalidad básica\r\n    console.log('[CALL] End call for management:', managementId, request);\r\n    return this.getManagementById(managementId.toString());\r\n  }\r\n\r\n  registerPayment(managementId: string, request: RegisterPaymentRequest): Observable<ManagementResource> {\r\n    // Por ahora mantener la funcionalidad básica\r\n    console.log('[PAYMENT] Register payment for management:', managementId, request);\r\n    return this.getManagementById(managementId);\r\n  }\r\n\r\n  /**\r\n   * Crea un cronograma de pagos (1 cabecera + N cuotas en tabla separada)\r\n   * Retorna la cabecera con las cuotas asociadas\r\n   */\r\n  createPaymentSchedule(request: PaymentScheduleRequest): Observable<RegistroGestionV2> {\r\n    console.log('[SCHEDULE] Creating payment schedule:', request);\r\n    return this.http.post<RegistroGestionV2>(`${this.baseUrl}/payment-schedule`, request);\r\n  }\r\n\r\n  /**\r\n   * Actualiza el estado de pago de una cuota de promesa de pago\r\n   * @param recordId ID del registro en registros_gestion_v2\r\n   * @param estadoPago Nuevo estado: PENDIENTE, PAGADA, VENCIDA, PARCIAL, CANCELADA\r\n   * @param montoPagadoReal Monto realmente pagado (opcional)\r\n   * @param fechaPagoReal Fecha en que se realizó el pago (opcional)\r\n   */\r\n  updatePaymentStatus(\r\n    recordId: number,\r\n    estadoPago: 'PENDIENTE' | 'PAGADA' | 'VENCIDA' | 'PARCIAL' | 'CANCELADA',\r\n    montoPagadoReal?: number,\r\n    fechaPagoReal?: string\r\n  ): Observable<RegistroGestionV2> {\r\n    console.log('[PAYMENT-STATUS] Updating payment status:', { recordId, estadoPago, montoPagadoReal, fechaPagoReal });\r\n\r\n    let params = `estadoPago=${estadoPago}`;\r\n    if (montoPagadoReal !== undefined) {\r\n      params += `&montoPagadoReal=${montoPagadoReal}`;\r\n    }\r\n    if (fechaPagoReal) {\r\n      params += `&fechaPagoReal=${fechaPagoReal}`;\r\n    }\r\n\r\n    return this.http.put<RegistroGestionV2>(`${this.baseUrl}/${recordId}/payment-status?${params}`, {});\r\n  }\r\n\r\n  /**\r\n   * Verifica si una cuota puede ser cancelada (pagada)\r\n   * Solo se puede cancelar si está PENDIENTE y la fecha de pago es hoy o futura\r\n   * @param cuotaId ID de la cuota en cuotas_promesa\r\n   */\r\n  puedeCancelarCuota(cuotaId: number): Observable<{ cuotaId: number; puedeCancelar: boolean; mensaje?: string }> {\r\n    console.log('[CUOTA] Checking if cuota can be canceled:', cuotaId);\r\n    return this.http.get<{ cuotaId: number; puedeCancelar: boolean; mensaje?: string }>(`${this.baseUrl}/cuota/${cuotaId}/puede-cancelar`);\r\n  }\r\n\r\n  /**\r\n   * Cancela (marca como PAGADA) una cuota de promesa de pago con validación de fecha\r\n   * Valida que la cuota esté PENDIENTE y que la fecha de pago no haya pasado\r\n   * @param cuotaId ID de la cuota en cuotas_promesa\r\n   * @param montoPagadoReal Monto realmente pagado (opcional)\r\n   * @param fechaPagoReal Fecha en que se realizó el pago (opcional)\r\n   * @param observaciones Observaciones adicionales (opcional)\r\n   */\r\n  cancelarCuota(\r\n    cuotaId: number,\r\n    montoPagadoReal?: number,\r\n    fechaPagoReal?: string,\r\n    observaciones?: string\r\n  ): Observable<any> {\r\n    console.log('[CUOTA] Canceling cuota:', { cuotaId, montoPagadoReal, fechaPagoReal, observaciones });\r\n\r\n    let params = '';\r\n    const paramParts: string[] = [];\r\n    if (montoPagadoReal !== undefined) {\r\n      paramParts.push(`montoPagadoReal=${montoPagadoReal}`);\r\n    }\r\n    if (fechaPagoReal) {\r\n      paramParts.push(`fechaPagoReal=${fechaPagoReal}`);\r\n    }\r\n    if (observaciones) {\r\n      paramParts.push(`observaciones=${encodeURIComponent(observaciones)}`);\r\n    }\r\n    if (paramParts.length > 0) {\r\n      params = '?' + paramParts.join('&');\r\n    }\r\n\r\n    return this.http.put<any>(`${this.baseUrl}/cuota/${cuotaId}/cancelar${params}`, {});\r\n  }\r\n\r\n  /**\r\n   * Obtiene las cabeceras de montos (campos numéricos decimales) para una subcartera\r\n   * Esto permite mostrar los nombres visuales de los campos de monto\r\n   */\r\n  getMontoCabeceras(idSubcartera: number): Observable<ConfiguracionCabecera[]> {\r\n    console.log('[CABECERAS] Fetching monto cabeceras for subcartera:', idSubcartera);\r\n    return this.http.get<ConfiguracionCabecera[]>(`${this.cabecerasUrl}/subcartera/${idSubcartera}/montos`);\r\n  }\r\n\r\n  /**\r\n   * Actualiza la visibilidad y orden de visualización de múltiples cabeceras\r\n   * Usado para configurar qué campos de montos se muestran en la gestión de cobranza\r\n   */\r\n  updateAmountVisibility(\r\n    idSubcartera: number,\r\n    updates: { id: number; esVisibleMonto: number; ordenMonto: number }[]\r\n  ): Observable<ConfiguracionCabecera[]> {\r\n    console.log('[CABECERAS] Updating visibility for subcartera:', idSubcartera, updates);\r\n    return this.http.put<ConfiguracionCabecera[]>(\r\n      `${this.cabecerasUrl}/subcartera/${idSubcartera}/visibility`,\r\n      updates\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Transforma el request del frontend al formato del backend discador\r\n   */\r\n  private transformToBackendFormat(request: CreateManagementRequest): RegistroGestionV2 {\r\n    // Determinar cuál es la tipificación final (la de mayor nivel seleccionada)\r\n    const finalTypificationId = request.level3Id || request.level2Id || request.level1Id;\r\n\r\n    // Generar ruta jerárquica: \"Nivel1 > Nivel2 > Nivel3\"\r\n    const rutaParts: string[] = [];\r\n    if (request.level1Name) rutaParts.push(request.level1Name);\r\n    if (request.level2Name) rutaParts.push(request.level2Name);\r\n    if (request.level3Name) rutaParts.push(request.level3Name);\r\n    const rutaJerarquia = rutaParts.join(' > ');\r\n\r\n    const backendRequest: RegistroGestionV2 = {\r\n      idTenant: request.tenantId,\r\n      idCartera: request.portfolioId,\r\n      idSubcartera: request.subPortfolioId || undefined,\r\n      idCliente: Number(request.customerId),\r\n      nombreCliente: request.customerName || undefined,\r\n      documentoCliente: request.customerDocument || undefined,\r\n      idAgente: this.extractAgentId(request.advisorId),\r\n      tipificacion: { id: finalTypificationId },\r\n      observaciones: request.observations || '',\r\n      // Campos de contacto\r\n      canalContacto: request.canalContacto || undefined,\r\n      metodoContacto: request.metodoContacto || 'GESTION_MANUAL',\r\n      estadoGestion: 'COMPLETADA',\r\n      // Campos opcionales de llamada\r\n      idCampana: request.idCampana || undefined,\r\n      idLlamada: request.idLlamada || undefined,\r\n      duracionSegundos: request.duracionSegundos || undefined,\r\n      // Información del agente y dispositivo\r\n      nombreAgente: request.nombreAgente || undefined,\r\n      userAgent: request.userAgent || undefined\r\n    };\r\n\r\n    // Nota: Los niveles jerárquicos (rutaNivel1, rutaNivel2, etc.) se calculan\r\n    // automáticamente en el backend basándose en la tipificación principal\r\n\r\n    return backendRequest;\r\n  }\r\n\r\n  /**\r\n   * Transforma la respuesta del backend al formato del frontend\r\n   */\r\n  private transformToFrontendFormat(record: RegistroGestionV2, originalRequest?: CreateManagementRequest): ManagementResource {\r\n    // Extraer fecha sin hora\r\n    let managementDate = record.fechaGestion;\r\n    if (managementDate && managementDate.includes('T')) {\r\n      managementDate = managementDate.split('T')[0];\r\n    }\r\n\r\n    return {\r\n      id: record.id || 0,\r\n      customerId: String(record.idCliente),\r\n      advisorId: String(record.idAgente),\r\n      tenantId: record.idTenant,\r\n      tenantName: '',\r\n      portfolioId: record.idCartera || 0,\r\n      portfolioName: '',\r\n      subPortfolioId: record.idSubcartera,\r\n      subPortfolioName: '',\r\n      phone: record.telefonoContacto || '',\r\n      telefonoContacto: record.telefonoContacto || '',\r\n      level1Id: (record.tipificacion as any)?.id || 0,\r\n      level1Name: originalRequest?.level1Name || record.rutaNivel1 || '',\r\n      level2Id: undefined,\r\n      level2Name: originalRequest?.level2Name || record.rutaNivel2 || '',\r\n      level3Id: undefined,\r\n      level3Name: originalRequest?.level3Name || record.rutaNivel3 || '',\r\n      level4Name: record.rutaNivel4 || '',\r\n      observations: record.observaciones,\r\n      managementDate: managementDate,\r\n      managementTime: undefined,\r\n      // Additional fields for history\r\n      canalContacto: record.canalContacto || '',\r\n      metodoContacto: record.metodoContacto || '',\r\n      nombreAgente: record.nombreAgente || record.userAgent || `Agente ${record.idAgente}`,\r\n      duracionSegundos: record.duracionSegundos || 0,\r\n      // Promesa de pago\r\n      montoPromesa: record.montoPromesa || undefined,\r\n      estadoPago: record.estadoPago || undefined\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Extrae el ID numérico del agente desde el advisorId\r\n   * Si es \"ADV-001\" intenta obtener el ID real del usuario logueado\r\n   */\r\n  private extractAgentId(advisorId: string): number {\r\n    // Por ahora usar un ID fijo, luego integrar con el sistema de auth\r\n    // TODO: Obtener el ID real del agente desde el servicio de autenticación\r\n    if (advisorId.startsWith('ADV-')) {\r\n      return 1; // ID temporal\r\n    }\r\n    return Number(advisorId) || 1;\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
