import{a as X}from"./chunk-NLPIZQWL.js";import{a as Z}from"./chunk-YWILVLMO.js";import{a as Q}from"./chunk-EDV2BGIU.js";import{a as V,c as D}from"./chunk-2JQMTGI5.js";import"./chunk-NO4444JX.js";import{D as K,c as A,e as z,f as L,h as N,j as B,k as R,l as j,r as q,s as G,t as H,u as J,v as U,w as Y}from"./chunk-5CXVSPU7.js";import{Lb as W,Mb as k}from"./chunk-AY2PQ2ZV.js";import"./chunk-CVSECBKN.js";import{$a as a,B as P,Kb as d,Lb as i,Mb as o,Nb as b,Ub as w,Wb as x,Yb as m,cd as F,dd as O,fb as C,jd as T,kc as l,lc as E,ma as c,mb as I,mc as M,na as p,nc as S,pc as f,qc as u,rb as v,rc as _}from"./chunk-3MKZGHO3.js";function te(s,g){if(s&1&&(i(0,"div",8),b(1,"lucide-angular",9),l(2),o()),s&2){let t=m();a(),d("size",20),a(),M(" ",t.error," ")}}function ie(s,g){if(s&1&&(i(0,"div",10),b(1,"div",11),i(2,"p"),l(3),o()()),s&2){let t=m();a(3),E(t.isEditMode?"Cargando campa\xF1a...":"Guardando...")}}function ne(s,g){if(s&1&&(i(0,"option",29),l(1),o()),s&2){let t=g.$implicit;d("ngValue",t.id),a(),S(" ",t.tenantCode," - ",t.tenantName," ")}}function oe(s,g){if(s&1&&(i(0,"option",29),l(1),o()),s&2){let t=g.$implicit;d("ngValue",t.id),a(),S(" ",t.portfolioCode," - ",t.portfolioName," ")}}function re(s,g){if(s&1&&(i(0,"option",29),l(1),o()),s&2){let t=g.$implicit;d("ngValue",t.id),a(),S(" ",t.subPortfolioCode," - ",t.subPortfolioName," ")}}function ae(s,g){if(s&1){let t=w();i(0,"div",12)(1,"form",13),x("ngSubmit",function(){c(t);let e=m();return p(e.onSubmit())}),i(2,"div",14)(3,"h2"),b(4,"lucide-angular",15),l(5," Informaci\xF3n B\xE1sica "),o(),i(6,"div",16)(7,"label",17),l(8,"Nombre de la Campa\xF1a *"),o(),i(9,"input",18),_("ngModelChange",function(e){c(t);let n=m();return u(n.campaign.name,e)||(n.campaign.name=e),p(e)}),o()(),i(10,"div",16)(11,"label",19),l(12,"Descripci\xF3n"),o(),i(13,"textarea",20),_("ngModelChange",function(e){c(t);let n=m();return u(n.campaign.description,e)||(n.campaign.description=e),p(e)}),o()(),i(14,"div",21)(15,"div",16)(16,"label",22),l(17,"Fecha de Inicio"),o(),i(18,"input",23),_("ngModelChange",function(e){c(t);let n=m();return u(n.startDateString,e)||(n.startDateString=e),p(e)}),o(),i(19,"small"),l(20,"Fecha y hora de inicio de la campa\xF1a"),o()(),i(21,"div",16)(22,"label",24),l(23,"Fecha de Fin"),o(),i(24,"input",25),_("ngModelChange",function(e){c(t);let n=m();return u(n.endDateString,e)||(n.endDateString=e),p(e)}),o(),i(25,"small"),l(26,"Fecha y hora de finalizaci\xF3n de la campa\xF1a"),o()()()(),i(27,"div",14)(28,"h2"),b(29,"lucide-angular",26),l(30," Asignaci\xF3n "),o(),i(31,"div",21)(32,"div",16)(33,"label",27),l(34,"Proveedor (Inquilino) *"),o(),i(35,"select",28),_("ngModelChange",function(e){c(t);let n=m();return u(n.selectedTenantId,e)||(n.selectedTenantId=e),p(e)}),x("ngModelChange",function(){c(t);let e=m();return p(e.onTenantChange())}),i(36,"option",29),l(37,"Seleccione un proveedor..."),o(),v(38,ne,2,3,"option",30),o()(),i(39,"div",16)(40,"label",31),l(41,"Cartera *"),o(),i(42,"select",32),_("ngModelChange",function(e){c(t);let n=m();return u(n.selectedPortfolioId,e)||(n.selectedPortfolioId=e),p(e)}),x("ngModelChange",function(){c(t);let e=m();return p(e.onPortfolioChange())}),i(43,"option",29),l(44,"Seleccione una cartera..."),o(),v(45,oe,2,3,"option",30),o()()(),i(46,"div",16)(47,"label",33),l(48,"Subcartera *"),o(),i(49,"select",34),_("ngModelChange",function(e){c(t);let n=m();return u(n.selectedSubPortfolioId,e)||(n.selectedSubPortfolioId=e),p(e)}),i(50,"option",29),l(51,"Seleccione una subcartera..."),o(),v(52,re,2,3,"option",30),o()()(),i(53,"div",14)(54,"h2"),b(55,"lucide-angular",35),l(56," Configuraci\xF3n de Discado "),o(),i(57,"div",21)(58,"div",16)(59,"label",36),l(60,"Modo de Discado"),o(),i(61,"select",37),_("ngModelChange",function(e){c(t);let n=m();return u(n.campaign.dialMode,e)||(n.campaign.dialMode=e),p(e)}),i(62,"option",38),l(63,"Manual"),o(),i(64,"option",39),l(65,"Progresivo"),o(),i(66,"option",40),l(67,"Predictivo"),o()()(),i(68,"div",16)(69,"label",41),l(70,"Intentos M\xE1ximos"),o(),i(71,"input",42),_("ngModelChange",function(e){c(t);let n=m();return u(n.campaign.maxAttempts,e)||(n.campaign.maxAttempts=e),p(e)}),o(),i(72,"small"),l(73,"N\xFAmero m\xE1ximo de intentos por contacto (1-10)"),o()()(),i(74,"div",21)(75,"div",16)(76,"label",43),l(77,"Intervalo de Reintento (minutos)"),o(),i(78,"input",44),_("ngModelChange",function(e){c(t);let n=m();return u(n.campaign.retryInterval,e)||(n.campaign.retryInterval=e),p(e)}),o(),i(79,"small"),l(80,"Tiempo de espera entre reintentos"),o()(),i(81,"div",16)(82,"label",45),l(83,"Intensidad de Discado"),o(),i(84,"input",46),_("ngModelChange",function(e){c(t);let n=m();return u(n.campaign.intensidad,e)||(n.campaign.intensidad=e),p(e)}),o(),i(85,"small"),l(86,"Llamadas simult\xE1neas por agente (1-100). Ej: 50 con 10 agentes = 5 llamadas/agente"),o()()()(),i(87,"div",47)(88,"button",48),x("click",function(){c(t);let e=m();return p(e.onCancel())}),l(89," Cancelar "),o(),i(90,"button",49),l(91),o()()()()}if(s&2){let t=m();a(4),d("size",20),a(5),f("ngModel",t.campaign.name),a(4),f("ngModel",t.campaign.description),a(5),f("ngModel",t.startDateString),a(6),f("ngModel",t.endDateString),a(5),d("size",20),a(6),f("ngModel",t.selectedTenantId),a(),d("ngValue",0),a(2),d("ngForOf",t.tenants),a(4),f("ngModel",t.selectedPortfolioId),d("disabled",t.selectedTenantId===0),a(),d("ngValue",0),a(2),d("ngForOf",t.portfolios),a(4),f("ngModel",t.selectedSubPortfolioId),d("disabled",t.selectedPortfolioId===0),a(),d("ngValue",0),a(2),d("ngForOf",t.subPortfolios),a(3),d("size",20),a(6),f("ngModel",t.campaign.dialMode),a(10),f("ngModel",t.campaign.maxAttempts),a(7),f("ngModel",t.campaign.retryInterval),a(6),f("ngModel",t.campaign.intensidad),a(6),d("disabled",t.loading),a(),M(" ",t.isEditMode?"Actualizar Campa\xF1a":"Crear Campa\xF1a"," ")}}var Ce=(()=>{let g=class g{constructor(r,e,n,h,y){this.campaignService=r,this.tenantService=e,this.portfolioService=n,this.router=h,this.route=y,this.campaign={name:"",description:"",status:"DRAFT",dialMode:"PROGRESSIVE",maxAttempts:3,retryInterval:60,intensidad:50,tenantId:void 0,portfolioId:void 0,subPortfolioId:void 0},this.isEditMode=!1,this.loading=!1,this.error=null,this.campaignId=null,this.tenants=[],this.portfolios=[],this.subPortfolios=[],this.selectedTenantId=0,this.selectedPortfolioId=0,this.selectedSubPortfolioId=0,this.startDateString="",this.endDateString=""}ngOnInit(){this.loadTenants(),this.route.params.subscribe(r=>{r.id&&(this.isEditMode=!0,this.campaignId=+r.id,this.loadCampaign(this.campaignId))})}loadTenants(){this.tenantService.getAllTenants().subscribe({next:r=>{this.tenants=r.filter(e=>e.isActive)},error:r=>console.error("Error loading tenants:",r)})}onTenantChange(){this.selectedPortfolioId=0,this.selectedSubPortfolioId=0,this.portfolios=[],this.subPortfolios=[],this.selectedTenantId>0&&this.portfolioService.getPortfoliosByTenant(this.selectedTenantId).subscribe({next:r=>{this.portfolios=r.filter(e=>e.isActive)},error:r=>console.error("Error loading portfolios:",r)})}onPortfolioChange(){this.selectedSubPortfolioId=0,this.subPortfolios=[],this.selectedPortfolioId>0&&this.portfolioService.getSubPortfoliosByPortfolio(this.selectedPortfolioId).subscribe({next:r=>{this.subPortfolios=r.filter(e=>e.isActive)},error:r=>console.error("Error loading sub-portfolios:",r)})}loadCampaign(r){this.loading=!0,this.campaignService.getCampaignById(r).subscribe({next:e=>{console.log("\u2705 Campaign loaded:",e),this.campaign=e,e.startDate&&(this.startDateString=this.toDateTimeLocal(e.startDate)),e.endDate&&(this.endDateString=this.toDateTimeLocal(e.endDate)),e.tenantId&&e.portfolioId&&e.subPortfolioId?(console.log("\u{1F4CB} Loading cascading data for edit mode...",{tenantId:e.tenantId,portfolioId:e.portfolioId,subPortfolioId:e.subPortfolioId}),P({portfolios:this.portfolioService.getPortfoliosByTenant(e.tenantId),subPortfolios:this.portfolioService.getSubPortfoliosByPortfolio(e.portfolioId)}).subscribe({next:n=>{this.portfolios=n.portfolios.filter(h=>h.isActive),this.subPortfolios=n.subPortfolios.filter(h=>h.isActive),console.log("\u2705 Data loaded, now setting selected values:",{portfolios:this.portfolios.length,subPortfolios:this.subPortfolios.length,selectedTenant:e.tenantId,selectedPortfolio:e.portfolioId,selectedSubPortfolio:e.subPortfolioId}),this.selectedTenantId=e.tenantId||0,this.selectedPortfolioId=e.portfolioId||0,this.selectedSubPortfolioId=e.subPortfolioId||0,console.log("\u2705 Selected values assigned:",{selectedTenantId:this.selectedTenantId,selectedPortfolioId:this.selectedPortfolioId,selectedSubPortfolioId:this.selectedSubPortfolioId}),this.loading=!1},error:n=>{console.error("\u274C Error loading portfolios/subportfolios:",n),this.error="Error al cargar portfolios/subportfolios",this.loading=!1}})):(console.warn("\u26A0\uFE0F Missing tenant/portfolio/subportfolio IDs"),this.loading=!1)},error:e=>{console.error("\u274C Error loading campaign:",e),this.error="Error al cargar la campa\xF1a",this.loading=!1}})}onSubmit(){if(!this.campaign.name){this.error="El nombre de la campa\xF1a es requerido";return}if(!this.selectedSubPortfolioId||this.selectedSubPortfolioId===0){this.error="Debe seleccionar una subcartera";return}this.campaign.tenantId=this.selectedTenantId,this.campaign.portfolioId=this.selectedPortfolioId,this.campaign.subPortfolioId=this.selectedSubPortfolioId,this.startDateString&&(this.campaign.startDate=this.startDateString),this.endDateString&&(this.campaign.endDate=this.endDateString),this.loading=!0,this.error=null,this.isEditMode&&this.campaignId?this.campaignService.updateCampaign(this.campaignId,this.campaign).subscribe({next:()=>{this.router.navigate(["/admin/campaigns"])},error:r=>{console.error("Error updating campaign:",r),this.error="Error al actualizar la campa\xF1a",this.loading=!1}}):this.campaignService.createCampaign(this.campaign).subscribe({next:()=>{this.router.navigate(["/admin/campaigns"])},error:r=>{console.error("Error creating campaign:",r),this.error="Error al crear la campa\xF1a",this.loading=!1}})}onCancel(){this.router.navigate(["/admin/campaigns"])}toDateTimeLocal(r){let e=new Date(r),n=e.getFullYear(),h=String(e.getMonth()+1).padStart(2,"0"),y=String(e.getDate()).padStart(2,"0"),$=String(e.getHours()).padStart(2,"0"),ee=String(e.getMinutes()).padStart(2,"0");return`${n}-${h}-${y}T${$}:${ee}`}};g.\u0275fac=function(e){return new(e||g)(C(Q),C(X),C(Z),C(D),C(V))},g.\u0275cmp=I({type:g,selectors:[["app-campaign-form"]],decls:12,vars:7,consts:[[1,"campaign-form-container"],[1,"form-header"],[1,"header-icon",3,"name","size"],[1,"btn-back",3,"click"],["name","arrow-left",3,"size"],["class","error-message",4,"ngIf"],["class","loading-state",4,"ngIf"],["class","form-content",4,"ngIf"],[1,"error-message"],["name","x-circle",3,"size"],[1,"loading-state"],[1,"spinner"],[1,"form-content"],[3,"ngSubmit"],[1,"form-section"],["name","file-text",3,"size"],[1,"form-group"],["for","name"],["type","text","id","name","name","name","placeholder","Ej: Campa\xF1a Cobranza Enero 2025","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description","placeholder","Descripci\xF3n de la campa\xF1a...","rows","3",1,"form-textarea",3,"ngModelChange","ngModel"],[1,"form-row"],["for","startDate"],["type","datetime-local","id","startDate","name","startDate",1,"form-input",3,"ngModelChange","ngModel"],["for","endDate"],["type","datetime-local","id","endDate","name","endDate",1,"form-input",3,"ngModelChange","ngModel"],["name","building-2",3,"size"],["for","tenant"],["id","tenant","name","tenant","required","",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["for","portfolio"],["id","portfolio","name","portfolio","required","",1,"form-select",3,"ngModelChange","ngModel","disabled"],["for","subportfolio"],["id","subportfolio","name","subportfolio","required","",1,"form-select",3,"ngModelChange","ngModel","disabled"],["name","phone-call",3,"size"],["for","dialMode"],["id","dialMode","name","dialMode",1,"form-select",3,"ngModelChange","ngModel"],["value","MANUAL"],["value","PROGRESSIVE"],["value","PREDICTIVE"],["for","maxAttempts"],["type","number","id","maxAttempts","name","maxAttempts","min","1","max","10",1,"form-input",3,"ngModelChange","ngModel"],["for","retryInterval"],["type","number","id","retryInterval","name","retryInterval","min","1",1,"form-input",3,"ngModelChange","ngModel"],["for","intensidad"],["type","number","id","intensidad","name","intensidad","min","1","max","100","placeholder","50",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-actions"],["type","button",1,"btn-cancel",3,"click"],["type","submit",1,"btn-submit",3,"disabled"]],template:function(e,n){e&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),b(3,"lucide-angular",2),l(4),o(),i(5,"button",3),x("click",function(){return n.onCancel()}),b(6,"lucide-angular",4),i(7,"span"),l(8,"Volver"),o()()(),v(9,te,3,2,"div",5)(10,ie,4,1,"div",6)(11,ae,92,24,"div",7),o()),e&2&&(a(3),d("name",n.isEditMode?"pencil":"plus-circle")("size",24),a(),M(" ",n.isEditMode?"Editar Campa\xF1a":"Nueva Campa\xF1a"," "),a(2),d("size",18),a(3),d("ngIf",n.error),a(),d("ngIf",n.loading),a(),d("ngIf",!n.loading))},dependencies:[T,F,O,K,R,G,H,A,j,q,z,L,Y,U,J,B,N,k,W],styles:[".campaign-form-container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto;padding:2rem!important;min-height:100vh;background:linear-gradient(to bottom right,#0f172a,#1e293b,#0f172a)}.form-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--text-primary);margin:0;display:flex;align-items:center;gap:.75rem}.header-icon[_ngcontent-%COMP%]{flex-shrink:0}.btn-back[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:6px;cursor:pointer;font-size:.9rem;color:var(--text-secondary);transition:all .2s}.btn-back[_ngcontent-%COMP%]:hover{background:var(--bg-secondary)}.error-message[_ngcontent-%COMP%]{background:#fee2e2;border:1px solid #fca5a5;color:#991b1b;padding:1rem;border-radius:6px;margin-bottom:1.5rem;display:flex;align-items:center;gap:.5rem}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.spinner[_ngcontent-%COMP%]{border:3px solid #f3f4f6;border-top:3px solid #3b82f6;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.form-content[_ngcontent-%COMP%]{background:var(--bg-card);border-radius:8px;box-shadow:0 1px 3px #0000001a}.form-section[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--border-color)}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem;color:var(--text-primary);margin:0 0 1.5rem;font-weight:600;display:flex;align-items:center;gap:.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;color:var(--text-secondary);margin-bottom:.5rem;font-size:.9rem}.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%], .form-textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid var(--input-border);background:var(--input-bg);color:var(--text-primary);border-radius:6px;font-size:.95rem;transition:border-color .2s}.form-input[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus, .form-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.form-input[_ngcontent-%COMP%]:disabled, .form-select[_ngcontent-%COMP%]:disabled{background:var(--bg-tertiary);color:var(--text-tertiary);cursor:not-allowed;opacity:.6}.form-textarea[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.form-group[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;margin-top:.5rem;color:var(--text-tertiary);font-size:.85rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}@media (max-width: 768px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;padding:1.5rem;background:var(--bg-secondary);border-top:1px solid var(--border-color)}.btn-cancel[_ngcontent-%COMP%], .btn-submit[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border-radius:6px;font-weight:500;font-size:.95rem;cursor:pointer;transition:all .2s;border:none}.btn-cancel[_ngcontent-%COMP%]{background:#fff;color:#475569;border:1px solid #cbd5e1}.btn-cancel[_ngcontent-%COMP%]:hover{background:#f1f5f9}.btn-submit[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.btn-submit[_ngcontent-%COMP%]:hover{background:#2563eb}.btn-submit[_ngcontent-%COMP%]:disabled{background:#93c5fd;cursor:not-allowed}"]});let s=g;return s})();export{Ce as CampaignFormComponent};
