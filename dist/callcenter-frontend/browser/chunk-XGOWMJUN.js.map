{
  "version": 3,
  "sources": ["src/app/maintenance/services/typification.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { environment } from '../../../environments/environment';\r\nimport {\r\n  TypificationCatalog,\r\n  TenantTypificationConfig,\r\n  CreateTypificationCommand,\r\n  UpdateTypificationCommand,\r\n  UpdateTypificationConfigCommand,\r\n  ClassificationType,\r\n  AdditionalField\r\n} from '../models/typification.model';\r\nimport { Portfolio } from '../models/portfolio.model';\r\nimport { Tenant } from '../models/tenant.model';\r\n\r\nexport interface CsvMappingResource {\r\n  id: number;\r\n  csvColumnName: string;\r\n  targetField: string;\r\n  dataType: string;\r\n  columnOrder: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TypificationService {\r\n  private baseUrl = environment.tipificacionUrl;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  // Catalog Management\r\n  getAllClassifications(): Observable<TypificationCatalog[]> {\r\n    return this.http.get<TypificationCatalog[]>(`${this.baseUrl}/typifications`);\r\n  }\r\n\r\n  getTypificationsByType(type: ClassificationType): Observable<TypificationCatalog[]> {\r\n    return this.http.get<TypificationCatalog[]>(`${this.baseUrl}/typifications/type/${type}`);\r\n  }\r\n\r\n  getTypificationsByLevel(level: number): Observable<TypificationCatalog[]> {\r\n    return this.http.get<TypificationCatalog[]>(`${this.baseUrl}/typifications/level/${level}`);\r\n  }\r\n\r\n  getTypificationsByParent(parentId: number): Observable<TypificationCatalog[]> {\r\n    return this.http.get<TypificationCatalog[]>(`${this.baseUrl}/typifications/${parentId}/children`);\r\n  }\r\n\r\n  getClassificationById(id: number): Observable<TypificationCatalog> {\r\n    return this.http.get<TypificationCatalog>(`${this.baseUrl}/typifications/${id}`);\r\n  }\r\n\r\n  createTypification(command: CreateTypificationCommand): Observable<TypificationCatalog> {\r\n    return this.http.post<TypificationCatalog>(`${this.baseUrl}/typifications`, command);\r\n  }\r\n\r\n  updateTypification(id: number, command: UpdateTypificationCommand): Observable<TypificationCatalog> {\r\n    return this.http.put<TypificationCatalog>(`${this.baseUrl}/typifications/${id}`, command);\r\n  }\r\n\r\n  deleteTypification(id: number): Observable<void> {\r\n    return this.http.delete<void>(`${this.baseUrl}/typifications/${id}`);\r\n  }\r\n\r\n  updateDisplayOrder(updates: Array<{id: number, displayOrder: number}>): Observable<void> {\r\n    return this.http.patch<void>(`${this.baseUrl}/typifications/display-order`, updates);\r\n  }\r\n\r\n  // Tenant Configuration Management\r\n  getTenantClassifications(tenantId: number, portfolioId?: number, includeDisabled?: boolean): Observable<TenantTypificationConfig[]> {\r\n    let params = new HttpParams();\r\n    if (portfolioId) {\r\n      params = params.set('portfolioId', portfolioId.toString());\r\n    }\r\n    if (includeDisabled) {\r\n      params = params.set('includeDisabled', 'true');\r\n    }\r\n    return this.http.get<TenantTypificationConfig[]>(\r\n      `${this.baseUrl}/tenants/${tenantId}/typifications`,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  getTenantClassificationsByType(\r\n    tenantId: number,\r\n    type: ClassificationType,\r\n    portfolioId?: number\r\n  ): Observable<TenantTypificationConfig[]> {\r\n    let params = new HttpParams();\r\n    if (portfolioId) {\r\n      params = params.set('portfolioId', portfolioId.toString());\r\n    }\r\n    return this.http.get<TenantTypificationConfig[]>(\r\n      `${this.baseUrl}/tenants/${tenantId}/typifications/type/${type}`,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  getTenantClassificationsByLevel(\r\n    tenantId: number,\r\n    level: number,\r\n    portfolioId?: number\r\n  ): Observable<TenantTypificationConfig[]> {\r\n    let params = new HttpParams();\r\n    if (portfolioId) {\r\n      params = params.set('portfolioId', portfolioId.toString());\r\n    }\r\n    return this.http.get<TenantTypificationConfig[]>(\r\n      `${this.baseUrl}/tenants/${tenantId}/typifications/level/${level}`,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  getEnabledClassifications(\r\n    tenantId: number,\r\n    portfolioId?: number\r\n  ): Observable<TenantTypificationConfig[]> {\r\n    let params = new HttpParams();\r\n    if (portfolioId) {\r\n      params = params.set('portfolioId', portfolioId.toString());\r\n    }\r\n    return this.http.get<TenantTypificationConfig[]>(\r\n      `${this.baseUrl}/tenants/${tenantId}/typifications/enabled`,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  updateTenantTypificationConfig(\r\n    tenantId: number,\r\n    typificationId: number,\r\n    command: UpdateTypificationConfigCommand,\r\n    portfolioId?: number\r\n  ): Observable<TenantTypificationConfig> {\r\n    let params = new HttpParams();\r\n    if (portfolioId) {\r\n      params = params.set('portfolioId', portfolioId.toString());\r\n    }\r\n    return this.http.put<TenantTypificationConfig>(\r\n      `${this.baseUrl}/tenants/${tenantId}/typifications/${typificationId}/config`,\r\n      command,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  enableClassification(\r\n    tenantId: number,\r\n    typificationId: number,\r\n    portfolioId?: number\r\n  ): Observable<TenantTypificationConfig> {\r\n    let params = new HttpParams();\r\n    if (portfolioId) {\r\n      params = params.set('portfolioId', portfolioId.toString());\r\n    }\r\n    return this.http.post<TenantTypificationConfig>(\r\n      `${this.baseUrl}/tenants/${tenantId}/typifications/${typificationId}/enable`,\r\n      {},\r\n      { params }\r\n    );\r\n  }\r\n\r\n  disableClassification(\r\n    tenantId: number,\r\n    typificationId: number,\r\n    portfolioId?: number\r\n  ): Observable<TenantTypificationConfig> {\r\n    let params = new HttpParams();\r\n    if (portfolioId) {\r\n      params = params.set('portfolioId', portfolioId.toString());\r\n    }\r\n    return this.http.post<TenantTypificationConfig>(\r\n      `${this.baseUrl}/tenants/${tenantId}/typifications/${typificationId}/disable`,\r\n      {},\r\n      { params }\r\n    );\r\n  }\r\n\r\n  // Tenant Management\r\n  getAllTenants(): Observable<Tenant[]> {\r\n    return this.http.get<Tenant[]>(`${this.baseUrl}/system-config/tenants`);\r\n  }\r\n\r\n  createTenant(data: {\r\n    tenantCode: string;\r\n    tenantName: string;\r\n    businessName?: string;\r\n    taxId?: string;\r\n    countryCode?: string;\r\n    timezone?: string;\r\n    maxUsers?: number;\r\n    maxConcurrentSessions?: number;\r\n    subscriptionTier?: string;\r\n  }): Observable<Tenant> {\r\n    return this.http.post<Tenant>(`${this.baseUrl}/system-config/tenants`, data);\r\n  }\r\n\r\n  updateTenant(tenantId: number, data: {\r\n    tenantName?: string;\r\n    businessName?: string;\r\n    taxId?: string;\r\n    countryCode?: string;\r\n    timezone?: string;\r\n    maxUsers?: number;\r\n    maxConcurrentSessions?: number;\r\n    subscriptionTier?: string;\r\n    isActive?: boolean;\r\n  }): Observable<Tenant> {\r\n    return this.http.put<Tenant>(`${this.baseUrl}/system-config/tenants/${tenantId}`, data);\r\n  }\r\n\r\n  deleteTenant(tenantId: number): Observable<void> {\r\n    return this.http.delete<void>(`${this.baseUrl}/system-config/tenants/${tenantId}`);\r\n  }\r\n\r\n  // Portfolio Management\r\n  getPortfoliosByTenant(tenantId: number): Observable<Portfolio[]> {\r\n    return this.http.get<Portfolio[]>(`${this.baseUrl}/system-config/tenants/${tenantId}/portfolios`);\r\n  }\r\n\r\n  createPortfolio(data: {\r\n    tenantId: number;\r\n    portfolioCode: string;\r\n    portfolioName: string;\r\n    parentPortfolioId?: number;\r\n    description?: string;\r\n  }): Observable<Portfolio> {\r\n    return this.http.post<Portfolio>(`${this.baseUrl}/system-config/portfolios`, data);\r\n  }\r\n\r\n  updatePortfolio(portfolioId: number, data: {\r\n    portfolioName?: string;\r\n    description?: string;\r\n    isActive?: boolean;\r\n  }): Observable<Portfolio> {\r\n    return this.http.put<Portfolio>(`${this.baseUrl}/system-config/portfolios/${portfolioId}`, data);\r\n  }\r\n\r\n  deletePortfolio(portfolioId: number): Observable<void> {\r\n    return this.http.delete<void>(`${this.baseUrl}/system-config/portfolios/${portfolioId}`);\r\n  }\r\n\r\n  // SubPortfolio Management\r\n  getSubPortfoliosByPortfolio(portfolioId: number): Observable<any[]> {\r\n    return this.http.get<any[]>(`${this.baseUrl}/system-config/portfolios/${portfolioId}/subportfolios`);\r\n  }\r\n\r\n  // CSV Column Mapping Management\r\n  saveCsvMappings(portfolioId: number, csvHeaders: string[]): Observable<CsvMappingResource[]> {\r\n    return this.http.post<CsvMappingResource[]>(\r\n      `${this.baseUrl}/portfolios/${portfolioId}/csv-mappings`,\r\n      { csvHeaders }\r\n    );\r\n  }\r\n\r\n  getCsvMappings(portfolioId: number): Observable<CsvMappingResource[]> {\r\n    return this.http.get<CsvMappingResource[]>(\r\n      `${this.baseUrl}/portfolios/${portfolioId}/csv-mappings`\r\n    );\r\n  }\r\n\r\n  deleteCsvMappings(portfolioId: number): Observable<void> {\r\n    return this.http.delete<void>(\r\n      `${this.baseUrl}/portfolios/${portfolioId}/csv-mappings`\r\n    );\r\n  }\r\n\r\n  // V2 API Methods\r\n  getEffectiveTypifications(\r\n    tenantId: number,\r\n    portfolioId: number,\r\n    subPortfolioId: number\r\n  ): Observable<TypificationCatalog[]> {\r\n    return this.http.get<TypificationCatalog[]>(\r\n      `${environment.gatewayUrl}/v2/typifications/config/effective/tenant/${tenantId}/portfolio/${portfolioId}/subportfolio/${subPortfolioId}`\r\n    );\r\n  }\r\n\r\n  getAdditionalFields(typificationId: number): Observable<AdditionalField[]> {\r\n    return this.http.get<AdditionalField[]>(\r\n      `${environment.gatewayUrl}/v2/typifications/catalog/${typificationId}/additional-fields`\r\n    );\r\n  }\r\n\r\n  saveManagementRecord(record: any): Observable<any> {\r\n    return this.http.post(\r\n      `${environment.gatewayUrl}/v2/management-records`,\r\n      record\r\n    );\r\n  }\r\n\r\n  // Helper method to build tree structure\r\n  buildClassificationTree(typifications: TypificationCatalog[]): any[] {\r\n    const map = new Map<number, any>();\r\n    const roots: any[] = [];\r\n\r\n    // Create nodes\r\n    typifications.forEach(typification => {\r\n      map.set(typification.id, {\r\n        typification,\r\n        children: [],\r\n        level: typification.hierarchyLevel\r\n      });\r\n    });\r\n\r\n    // Build tree\r\n    typifications.forEach(typification => {\r\n      const node = map.get(typification.id);\r\n      if (typification.parentTypificationId) {\r\n        const parent = map.get(typification.parentTypificationId);\r\n        if (parent) {\r\n          parent.children.push(node);\r\n        }\r\n      } else {\r\n        roots.push(node);\r\n      }\r\n    });\r\n\r\n    // Sort children by displayOrder\r\n    const sortChildren = (node: any) => {\r\n      if (node.children.length > 0) {\r\n        node.children.sort((a: any, b: any) => {\r\n          const orderA = a.typification.displayOrder || 0;\r\n          const orderB = b.typification.displayOrder || 0;\r\n          return orderA - orderB;\r\n        });\r\n        node.children.forEach((child: any) => sortChildren(child));\r\n      }\r\n    };\r\n\r\n    roots.forEach(root => sortChildren(root));\r\n    return roots;\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;AA2BM,IAAO,uBAAP,MAAO,qBAAmB;EAG9B,YAAoB,MAAgB;AAAhB,SAAA,OAAA;AAFZ,SAAA,UAAU,YAAY;EAES;;EAGvC,wBAAqB;AACnB,WAAO,KAAK,KAAK,IAA2B,GAAG,KAAK,OAAO,gBAAgB;EAC7E;EAEA,uBAAuB,MAAwB;AAC7C,WAAO,KAAK,KAAK,IAA2B,GAAG,KAAK,OAAO,uBAAuB,IAAI,EAAE;EAC1F;EAEA,wBAAwB,OAAa;AACnC,WAAO,KAAK,KAAK,IAA2B,GAAG,KAAK,OAAO,wBAAwB,KAAK,EAAE;EAC5F;EAEA,yBAAyB,UAAgB;AACvC,WAAO,KAAK,KAAK,IAA2B,GAAG,KAAK,OAAO,kBAAkB,QAAQ,WAAW;EAClG;EAEA,sBAAsB,IAAU;AAC9B,WAAO,KAAK,KAAK,IAAyB,GAAG,KAAK,OAAO,kBAAkB,EAAE,EAAE;EACjF;EAEA,mBAAmB,SAAkC;AACnD,WAAO,KAAK,KAAK,KAA0B,GAAG,KAAK,OAAO,kBAAkB,OAAO;EACrF;EAEA,mBAAmB,IAAY,SAAkC;AAC/D,WAAO,KAAK,KAAK,IAAyB,GAAG,KAAK,OAAO,kBAAkB,EAAE,IAAI,OAAO;EAC1F;EAEA,mBAAmB,IAAU;AAC3B,WAAO,KAAK,KAAK,OAAa,GAAG,KAAK,OAAO,kBAAkB,EAAE,EAAE;EACrE;EAEA,mBAAmB,SAAkD;AACnE,WAAO,KAAK,KAAK,MAAY,GAAG,KAAK,OAAO,gCAAgC,OAAO;EACrF;;EAGA,yBAAyB,UAAkB,aAAsB,iBAAyB;AACxF,QAAI,SAAS,IAAI,WAAU;AAC3B,QAAI,aAAa;AACf,eAAS,OAAO,IAAI,eAAe,YAAY,SAAQ,CAAE;IAC3D;AACA,QAAI,iBAAiB;AACnB,eAAS,OAAO,IAAI,mBAAmB,MAAM;IAC/C;AACA,WAAO,KAAK,KAAK,IACf,GAAG,KAAK,OAAO,YAAY,QAAQ,kBACnC,EAAE,OAAM,CAAE;EAEd;EAEA,+BACE,UACA,MACA,aAAoB;AAEpB,QAAI,SAAS,IAAI,WAAU;AAC3B,QAAI,aAAa;AACf,eAAS,OAAO,IAAI,eAAe,YAAY,SAAQ,CAAE;IAC3D;AACA,WAAO,KAAK,KAAK,IACf,GAAG,KAAK,OAAO,YAAY,QAAQ,uBAAuB,IAAI,IAC9D,EAAE,OAAM,CAAE;EAEd;EAEA,gCACE,UACA,OACA,aAAoB;AAEpB,QAAI,SAAS,IAAI,WAAU;AAC3B,QAAI,aAAa;AACf,eAAS,OAAO,IAAI,eAAe,YAAY,SAAQ,CAAE;IAC3D;AACA,WAAO,KAAK,KAAK,IACf,GAAG,KAAK,OAAO,YAAY,QAAQ,wBAAwB,KAAK,IAChE,EAAE,OAAM,CAAE;EAEd;EAEA,0BACE,UACA,aAAoB;AAEpB,QAAI,SAAS,IAAI,WAAU;AAC3B,QAAI,aAAa;AACf,eAAS,OAAO,IAAI,eAAe,YAAY,SAAQ,CAAE;IAC3D;AACA,WAAO,KAAK,KAAK,IACf,GAAG,KAAK,OAAO,YAAY,QAAQ,0BACnC,EAAE,OAAM,CAAE;EAEd;EAEA,+BACE,UACA,gBACA,SACA,aAAoB;AAEpB,QAAI,SAAS,IAAI,WAAU;AAC3B,QAAI,aAAa;AACf,eAAS,OAAO,IAAI,eAAe,YAAY,SAAQ,CAAE;IAC3D;AACA,WAAO,KAAK,KAAK,IACf,GAAG,KAAK,OAAO,YAAY,QAAQ,kBAAkB,cAAc,WACnE,SACA,EAAE,OAAM,CAAE;EAEd;EAEA,qBACE,UACA,gBACA,aAAoB;AAEpB,QAAI,SAAS,IAAI,WAAU;AAC3B,QAAI,aAAa;AACf,eAAS,OAAO,IAAI,eAAe,YAAY,SAAQ,CAAE;IAC3D;AACA,WAAO,KAAK,KAAK,KACf,GAAG,KAAK,OAAO,YAAY,QAAQ,kBAAkB,cAAc,WACnE,CAAA,GACA,EAAE,OAAM,CAAE;EAEd;EAEA,sBACE,UACA,gBACA,aAAoB;AAEpB,QAAI,SAAS,IAAI,WAAU;AAC3B,QAAI,aAAa;AACf,eAAS,OAAO,IAAI,eAAe,YAAY,SAAQ,CAAE;IAC3D;AACA,WAAO,KAAK,KAAK,KACf,GAAG,KAAK,OAAO,YAAY,QAAQ,kBAAkB,cAAc,YACnE,CAAA,GACA,EAAE,OAAM,CAAE;EAEd;;EAGA,gBAAa;AACX,WAAO,KAAK,KAAK,IAAc,GAAG,KAAK,OAAO,wBAAwB;EACxE;EAEA,aAAa,MAUZ;AACC,WAAO,KAAK,KAAK,KAAa,GAAG,KAAK,OAAO,0BAA0B,IAAI;EAC7E;EAEA,aAAa,UAAkB,MAU9B;AACC,WAAO,KAAK,KAAK,IAAY,GAAG,KAAK,OAAO,0BAA0B,QAAQ,IAAI,IAAI;EACxF;EAEA,aAAa,UAAgB;AAC3B,WAAO,KAAK,KAAK,OAAa,GAAG,KAAK,OAAO,0BAA0B,QAAQ,EAAE;EACnF;;EAGA,sBAAsB,UAAgB;AACpC,WAAO,KAAK,KAAK,IAAiB,GAAG,KAAK,OAAO,0BAA0B,QAAQ,aAAa;EAClG;EAEA,gBAAgB,MAMf;AACC,WAAO,KAAK,KAAK,KAAgB,GAAG,KAAK,OAAO,6BAA6B,IAAI;EACnF;EAEA,gBAAgB,aAAqB,MAIpC;AACC,WAAO,KAAK,KAAK,IAAe,GAAG,KAAK,OAAO,6BAA6B,WAAW,IAAI,IAAI;EACjG;EAEA,gBAAgB,aAAmB;AACjC,WAAO,KAAK,KAAK,OAAa,GAAG,KAAK,OAAO,6BAA6B,WAAW,EAAE;EACzF;;EAGA,4BAA4B,aAAmB;AAC7C,WAAO,KAAK,KAAK,IAAW,GAAG,KAAK,OAAO,6BAA6B,WAAW,gBAAgB;EACrG;;EAGA,gBAAgB,aAAqB,YAAoB;AACvD,WAAO,KAAK,KAAK,KACf,GAAG,KAAK,OAAO,eAAe,WAAW,iBACzC,EAAE,WAAU,CAAE;EAElB;EAEA,eAAe,aAAmB;AAChC,WAAO,KAAK,KAAK,IACf,GAAG,KAAK,OAAO,eAAe,WAAW,eAAe;EAE5D;EAEA,kBAAkB,aAAmB;AACnC,WAAO,KAAK,KAAK,OACf,GAAG,KAAK,OAAO,eAAe,WAAW,eAAe;EAE5D;;EAGA,0BACE,UACA,aACA,gBAAsB;AAEtB,WAAO,KAAK,KAAK,IACf,GAAG,YAAY,UAAU,6CAA6C,QAAQ,cAAc,WAAW,iBAAiB,cAAc,EAAE;EAE5I;EAEA,oBAAoB,gBAAsB;AACxC,WAAO,KAAK,KAAK,IACf,GAAG,YAAY,UAAU,6BAA6B,cAAc,oBAAoB;EAE5F;EAEA,qBAAqB,QAAW;AAC9B,WAAO,KAAK,KAAK,KACf,GAAG,YAAY,UAAU,0BACzB,MAAM;EAEV;;EAGA,wBAAwB,eAAoC;AAC1D,UAAM,MAAM,oBAAI,IAAG;AACnB,UAAM,QAAe,CAAA;AAGrB,kBAAc,QAAQ,kBAAe;AACnC,UAAI,IAAI,aAAa,IAAI;QACvB;QACA,UAAU,CAAA;QACV,OAAO,aAAa;OACrB;IACH,CAAC;AAGD,kBAAc,QAAQ,kBAAe;AACnC,YAAM,OAAO,IAAI,IAAI,aAAa,EAAE;AACpC,UAAI,aAAa,sBAAsB;AACrC,cAAM,SAAS,IAAI,IAAI,aAAa,oBAAoB;AACxD,YAAI,QAAQ;AACV,iBAAO,SAAS,KAAK,IAAI;QAC3B;MACF,OAAO;AACL,cAAM,KAAK,IAAI;MACjB;IACF,CAAC;AAGD,UAAM,eAAe,CAAC,SAAa;AACjC,UAAI,KAAK,SAAS,SAAS,GAAG;AAC5B,aAAK,SAAS,KAAK,CAAC,GAAQ,MAAU;AACpC,gBAAM,SAAS,EAAE,aAAa,gBAAgB;AAC9C,gBAAM,SAAS,EAAE,aAAa,gBAAgB;AAC9C,iBAAO,SAAS;QAClB,CAAC;AACD,aAAK,SAAS,QAAQ,CAAC,UAAe,aAAa,KAAK,CAAC;MAC3D;IACF;AAEA,UAAM,QAAQ,UAAQ,aAAa,IAAI,CAAC;AACxC,WAAO;EACT;;;mCAhTW,sBAAmB,mBAAA,UAAA,CAAA;AAAA;wFAAnB,sBAAmB,SAAnB,qBAAmB,WAAA,YAFlB,OAAM,CAAA;AAEd,IAAO,sBAAP;;sEAAO,qBAAmB,CAAA;UAH/B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
