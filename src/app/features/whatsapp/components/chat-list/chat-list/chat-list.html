<div class="chat-list-container">
  <!-- Header -->
  <div class="sidebar-header">
    <div class="header-left">
      <span class="username-display">{{ getCurrentUsername() }}</span>
    </div>
    <div class="header-right">
      <button mat-icon-button class="header-icon" [matMenuTriggerFor]="menu">
        <lucide-angular name="more-vertical" [size]="20"></lucide-angular>
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="logout()">
          <lucide-angular name="log-out" [size]="20"></lucide-angular>
          <span>Cerrar sesión</span>
        </button>
      </mat-menu>
    </div>
  </div>

  <!-- Search -->
  <div class="search-container">
    <div class="search-wrapper">
      <lucide-angular name="search" [size]="20" class="search-icon"></lucide-angular>
      <input
        type="text"
        placeholder="Buscar o empezar un chat"
        [(ngModel)]="searchText"
        (ngModelChange)="filterChats()"
        class="search-input">
    </div>
  </div>

  <!-- Filter tabs -->
  <div class="filter-tabs">
    <button class="filter-tab" [class.active]="filterMode === 'all'" (click)="setFilter('all')">Todos</button>
    <button class="filter-tab" [class.active]="filterMode === 'unread'" (click)="setFilter('unread')">No leídos</button>
  </div>

  <!-- Chat list -->
  <div class="chat-list">
    <div
      *ngFor="let chat of filteredChats; trackBy: trackByChatJid"
      (click)="selectChat(chat)"
      [class.selected]="selectedChatJid === chat.jid"
      class="chat-item">

      <div class="chat-avatar">
        <img *ngIf="chat.profilePictureUrl" [src]="chat.profilePictureUrl" class="profile-pic" alt="Profile">
        <lucide-angular *ngIf="!chat.profilePictureUrl" name="user" [size]="40"></lucide-angular>
      </div>

      <div class="chat-content">
        <div class="chat-top">
          <span class="chat-name">{{ formatChatName(chat) }}</span>
          <span class="chat-time">{{ formatTime(chat.lastMsgTs) }}</span>
        </div>

        <div class="chat-bottom">
          <span class="chat-last-message">{{ truncateMessage(chat.lastMsgText) }}</span>
          <span class="chat-unread" *ngIf="chat.unreadCount && chat.unreadCount > 0">
            {{ chat.unreadCount }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
