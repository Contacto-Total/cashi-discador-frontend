<div class="settings-layout">
  <!-- Sidebar -->
  <aside class="settings-sidebar">
    <div class="sidebar-header">
      <lucide-angular name="settings" [size]="24" class="sidebar-icon"></lucide-angular>
      <span>Configuraci&oacute;n</span>
    </div>

    <nav class="sidebar-nav">
      <button
        class="nav-item"
        [class.active]="activeSection === 'appearance'"
        (click)="activeSection = 'appearance'"
      >
        <div class="nav-icon" style="background: linear-gradient(135deg, #8b5cf6, #a855f7);">
          <lucide-angular name="palette" [size]="16"></lucide-angular>
        </div>
        <span>Apariencia</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection === 'font'"
        (click)="activeSection = 'font'"
      >
        <div class="nav-icon" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">
          <lucide-angular name="type" [size]="16"></lucide-angular>
        </div>
        <span>Tama&ntilde;o de Texto</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection === 'audio'"
        (click)="activeSection = 'audio'"
      >
        <div class="nav-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
          <lucide-angular name="headphones" [size]="16"></lucide-angular>
        </div>
        <span>Audio</span>
      </button>
    </nav>
  </aside>

  <!-- Content -->
  <main class="settings-content">
    <!-- Appearance Section -->
    <div class="content-section" *ngIf="activeSection === 'appearance'">
      <h2 class="section-title">Apariencia</h2>
      <p class="section-description">Personaliza el aspecto visual de la aplicaci&oacute;n</p>

      <div class="setting-card">
        <div class="setting-row">
          <div class="setting-info">
            <lucide-angular [name]="isDarkMode ? 'moon' : 'sun'" [size]="20" class="setting-icon"></lucide-angular>
            <div>
              <span class="setting-label">Modo Oscuro</span>
              <span class="setting-hint">Reduce el brillo de la pantalla</span>
            </div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" [checked]="isDarkMode" (change)="toggleTheme()">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="theme-preview">
        <div class="preview-card light-preview" [class.selected]="!isDarkMode" (click)="setTheme('light')">
          <div class="preview-window">
            <div class="preview-header"></div>
            <div class="preview-sidebar"></div>
            <div class="preview-content">
              <div class="preview-line"></div>
              <div class="preview-line short"></div>
            </div>
          </div>
          <span>Claro</span>
        </div>
        <div class="preview-card dark-preview" [class.selected]="isDarkMode" (click)="setTheme('dark')">
          <div class="preview-window">
            <div class="preview-header"></div>
            <div class="preview-sidebar"></div>
            <div class="preview-content">
              <div class="preview-line"></div>
              <div class="preview-line short"></div>
            </div>
          </div>
          <span>Oscuro</span>
        </div>
      </div>
    </div>

    <!-- Font Size Section -->
    <div class="content-section" *ngIf="activeSection === 'font'">
      <h2 class="section-title">Tama&ntilde;o de Texto</h2>
      <p class="section-description">Ajusta el tama&ntilde;o de la fuente para mejorar la legibilidad</p>

      <div class="setting-card">
        <div class="font-control">
          <div class="font-header">
            <span class="font-current">{{ previewFontSize }}px</span>
            <span class="font-range">{{ minFontSize }}px - {{ maxFontSize }}px</span>
          </div>

          <div class="slider-row">
            <button class="size-btn" (click)="decreaseFontSize()" [disabled]="previewFontSize <= minFontSize">
              <span class="btn-label-small">A</span>
            </button>
            <input
              type="range"
              class="font-slider"
              [min]="minFontSize"
              [max]="maxFontSize"
              [value]="previewFontSize"
              (input)="onFontSizeChange($event)"
            />
            <button class="size-btn" (click)="increaseFontSize()" [disabled]="previewFontSize >= maxFontSize">
              <span class="btn-label-large">A</span>
            </button>
          </div>
        </div>

        <div class="preview-box">
          <span class="preview-label">Vista previa</span>
          <p class="preview-text" [style.font-size.px]="previewFontSize">{{ previewText }}</p>
          <p class="preview-small" [style.font-size.px]="previewFontSize * 0.85">Texto secundario m&aacute;s peque&ntilde;o.</p>
        </div>

        <div class="action-row">
          <button class="btn-secondary" (click)="resetFontSize()" [disabled]="isDefaultFontSize()">
            <lucide-angular name="refresh-cw" [size]="14"></lucide-angular>
            Restablecer
          </button>
          <button class="btn-primary" (click)="applyFontSize()" [disabled]="!hasChanges()">
            <lucide-angular name="check" [size]="14"></lucide-angular>
            Aplicar
          </button>
        </div>

        <div class="change-notice" *ngIf="hasChanges()">
          <lucide-angular name="info" [size]="14"></lucide-angular>
          <span>Tienes cambios sin guardar</span>
        </div>
      </div>
    </div>

    <!-- Audio Section -->
    <div class="content-section" *ngIf="activeSection === 'audio'">
      <h2 class="section-title">Dispositivos de Audio</h2>
      <p class="section-description">Selecciona el micr&oacute;fono y altavoz para las llamadas</p>

      <!-- Microphone Selection -->
      <div class="setting-card">
        <div class="audio-device-row">
          <div class="setting-info">
            <lucide-angular name="mic" [size]="20" class="setting-icon"></lucide-angular>
            <div>
              <span class="setting-label">Micr&oacute;fono</span>
              <span class="setting-hint">Dispositivo de entrada de audio</span>
            </div>
          </div>
        </div>

        <div class="device-select-row">
          <select
            class="device-select"
            [(ngModel)]="selectedInputId"
            (ngModelChange)="onInputDeviceSelect($event)"
          >
            <option value="default">Por defecto del sistema</option>
            <option *ngFor="let device of inputDevices" [value]="device.deviceId">
              {{ device.label }}
            </option>
          </select>

          <button
            class="test-btn"
            (click)="testMicrophone()"
            [disabled]="isTestingMic"
            [class.success]="micTestResult === 'success'"
            [class.error]="micTestResult === 'error'"
          >
            <lucide-angular
              [name]="isTestingMic ? 'loader-2' : (micTestResult === 'success' ? 'check' : (micTestResult === 'error' ? 'x' : 'mic'))"
              [size]="16"
              [class.spin]="isTestingMic"
            ></lucide-angular>
            <span>{{ isTestingMic ? 'Probando...' : 'Probar' }}</span>
          </button>
        </div>
      </div>

      <!-- Speaker Selection -->
      <div class="setting-card">
        <div class="audio-device-row">
          <div class="setting-info">
            <lucide-angular name="volume-2" [size]="20" class="setting-icon"></lucide-angular>
            <div>
              <span class="setting-label">Altavoz</span>
              <span class="setting-hint">Dispositivo de salida de audio</span>
            </div>
          </div>
        </div>

        <div class="device-select-row">
          <select
            class="device-select"
            [(ngModel)]="selectedOutputId"
            (ngModelChange)="onOutputDeviceSelect($event)"
          >
            <option value="default">Por defecto del sistema</option>
            <option *ngFor="let device of outputDevices" [value]="device.deviceId">
              {{ device.label }}
            </option>
          </select>

          <button
            class="test-btn"
            (click)="testSpeaker()"
            [disabled]="isTestingSpeaker"
            [class.success]="speakerTestResult === 'success'"
            [class.error]="speakerTestResult === 'error'"
          >
            <lucide-angular
              [name]="isTestingSpeaker ? 'loader-2' : (speakerTestResult === 'success' ? 'check' : (speakerTestResult === 'error' ? 'x' : 'volume-2'))"
              [size]="16"
              [class.spin]="isTestingSpeaker"
            ></lucide-angular>
            <span>{{ isTestingSpeaker ? 'Probando...' : 'Probar' }}</span>
          </button>
        </div>
      </div>

      <!-- Refresh Button -->
      <div class="audio-actions">
        <button class="btn-secondary" (click)="refreshAudioDevices()">
          <lucide-angular name="refresh-cw" [size]="14"></lucide-angular>
          Actualizar lista de dispositivos
        </button>
      </div>

      <!-- Info Notice -->
      <div class="audio-notice">
        <lucide-angular name="info" [size]="14"></lucide-angular>
        <span>Los cambios de dispositivo se aplicar&aacute;n a la pr&oacute;xima llamada</span>
      </div>
    </div>
  </main>
</div>
