<div class="settings-layout">
  <!-- Sidebar -->
  <aside class="settings-sidebar">
    <div class="sidebar-header">
      <lucide-angular name="settings" [size]="24" class="sidebar-icon"></lucide-angular>
      <span>Configuraci&oacute;n</span>
    </div>

    <nav class="sidebar-nav">
      <button
        class="nav-item"
        [class.active]="activeSection === 'appearance'"
        (click)="activeSection = 'appearance'"
      >
        <div class="nav-icon" style="background: linear-gradient(135deg, #8b5cf6, #a855f7);">
          <lucide-angular name="palette" [size]="16"></lucide-angular>
        </div>
        <span>Apariencia</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection === 'font'"
        (click)="activeSection = 'font'"
      >
        <div class="nav-icon" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">
          <lucide-angular name="type" [size]="16"></lucide-angular>
        </div>
        <span>Tama&ntilde;o de Texto</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection === 'audio'"
        (click)="activeSection = 'audio'"
      >
        <div class="nav-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
          <lucide-angular name="headphones" [size]="16"></lucide-angular>
        </div>
        <span>Audio</span>
      </button>
    </nav>
  </aside>

  <!-- Content -->
  <main class="settings-content">
    <!-- Appearance Section -->
    <div class="content-section" *ngIf="activeSection === 'appearance'">
      <h2 class="section-title">Apariencia</h2>
      <p class="section-description">Personaliza el aspecto visual de la aplicaci&oacute;n</p>

      <div class="setting-card">
        <div class="setting-row">
          <div class="setting-info">
            <lucide-angular [name]="isDarkMode ? 'moon' : 'sun'" [size]="20" class="setting-icon"></lucide-angular>
            <div>
              <span class="setting-label">Modo Oscuro</span>
              <span class="setting-hint">Reduce el brillo de la pantalla</span>
            </div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" [checked]="isDarkMode" (change)="toggleTheme()">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="theme-preview">
        <div class="preview-card light-preview" [class.selected]="!isDarkMode" (click)="setTheme('light')">
          <div class="preview-window">
            <div class="preview-header"></div>
            <div class="preview-sidebar"></div>
            <div class="preview-content">
              <div class="preview-line"></div>
              <div class="preview-line short"></div>
            </div>
          </div>
          <span>Claro</span>
        </div>
        <div class="preview-card dark-preview" [class.selected]="isDarkMode" (click)="setTheme('dark')">
          <div class="preview-window">
            <div class="preview-header"></div>
            <div class="preview-sidebar"></div>
            <div class="preview-content">
              <div class="preview-line"></div>
              <div class="preview-line short"></div>
            </div>
          </div>
          <span>Oscuro</span>
        </div>
      </div>
    </div>

    <!-- Font Size Section -->
    <div class="content-section" *ngIf="activeSection === 'font'">
      <h2 class="section-title">Tama&ntilde;o de Texto</h2>
      <p class="section-description">Ajusta el tama&ntilde;o de la fuente para mejorar la legibilidad</p>

      <div class="setting-card">
        <div class="font-control">
          <div class="font-header">
            <span class="font-current">{{ previewFontSize }}px</span>
            <span class="font-range">{{ minFontSize }}px - {{ maxFontSize }}px</span>
          </div>

          <div class="slider-row">
            <button class="size-btn" (click)="decreaseFontSize()" [disabled]="previewFontSize <= minFontSize">
              <span class="btn-label-small">A</span>
            </button>
            <input
              type="range"
              class="font-slider"
              [min]="minFontSize"
              [max]="maxFontSize"
              [value]="previewFontSize"
              (input)="onFontSizeChange($event)"
            />
            <button class="size-btn" (click)="increaseFontSize()" [disabled]="previewFontSize >= maxFontSize">
              <span class="btn-label-large">A</span>
            </button>
          </div>
        </div>

        <div class="preview-box">
          <span class="preview-label">Vista previa</span>
          <p class="preview-text" [style.font-size.px]="previewFontSize">{{ previewText }}</p>
          <p class="preview-small" [style.font-size.px]="previewFontSize * 0.85">Texto secundario m&aacute;s peque&ntilde;o.</p>
        </div>

        <div class="action-row">
          <button class="btn-secondary" (click)="resetFontSize()" [disabled]="isDefaultFontSize()">
            <lucide-angular name="refresh-cw" [size]="14"></lucide-angular>
            Restablecer
          </button>
          <button class="btn-primary" (click)="applyFontSize()" [disabled]="!hasChanges()">
            <lucide-angular name="check" [size]="14"></lucide-angular>
            Aplicar
          </button>
        </div>

        <div class="change-notice" *ngIf="hasChanges()">
          <lucide-angular name="info" [size]="14"></lucide-angular>
          <span>Tienes cambios sin guardar</span>
        </div>
      </div>
    </div>

    <!-- Audio Section -->
    <div class="content-section audio-section" *ngIf="activeSection === 'audio'">
      <!-- Header with animated waves -->
      <div class="audio-header">
        <div class="audio-header-content">
          <div class="audio-header-icon">
            <lucide-angular name="headphones" [size]="32"></lucide-angular>
          </div>
          <div class="audio-header-text">
            <h2 class="section-title">Configuraci&oacute;n de Audio</h2>
            <p class="section-description">Personaliza tus dispositivos de entrada y salida para las llamadas</p>
          </div>
        </div>
        <div class="audio-wave-container">
          <div class="audio-wave"></div>
          <div class="audio-wave"></div>
          <div class="audio-wave"></div>
          <div class="audio-wave"></div>
          <div class="audio-wave"></div>
        </div>
      </div>

      <!-- Audio Devices Grid -->
      <div class="audio-devices-grid">
        <!-- Microphone Card -->
        <div class="audio-device-card mic-card" [class.monitoring]="isMicMonitoring">
          <div class="device-card-header">
            <div class="device-icon-wrapper mic-icon" [class.active]="isMicMonitoring">
              <lucide-angular name="mic" [size]="24"></lucide-angular>
              <div class="icon-pulse" *ngIf="isMicMonitoring"></div>
            </div>
            <div class="device-title-group">
              <h3 class="device-title">Micr&oacute;fono</h3>
              <span class="device-subtitle">Entrada de audio</span>
            </div>
            <div class="device-status" [class.active]="isMicMonitoring" [class.recording]="isMicMonitoring">
              <span class="status-dot"></span>
              <span class="status-text">{{ isMicMonitoring ? 'Escuchando...' : (selectedInputId !== 'default' ? 'Personalizado' : 'Por defecto') }}</span>
            </div>
          </div>

          <div class="device-selector-wrapper">
            <div class="select-icon">
              <lucide-angular name="settings-2" [size]="16"></lucide-angular>
            </div>
            <select
              class="device-select-premium"
              [(ngModel)]="selectedInputId"
              (ngModelChange)="onInputDeviceSelect($event)"
              [disabled]="isMicMonitoring"
            >
              <option value="default">Usar dispositivo del sistema</option>
              <option *ngFor="let device of inputDevices" [value]="device.deviceId">
                {{ device.label }}
              </option>
            </select>
          </div>

          <!-- Audio Level Visualizer -->
          <div class="audio-visualizer" [class.active]="isMicMonitoring">
            <div class="visualizer-bars">
              <div
                *ngFor="let bar of audioLevel.bars; let i = index"
                class="visualizer-bar"
                [style.height.%]="isMicMonitoring ? (bar > 5 ? bar : 5) : 5"
                [class.low]="bar < 30"
                [class.medium]="bar >= 30 && bar < 60"
                [class.high]="bar >= 60"
              ></div>
            </div>
            <div class="visualizer-info" *ngIf="isMicMonitoring">
              <div class="level-indicator">
                <span class="level-label">Nivel</span>
                <span class="level-value" [class.low]="audioLevel.level < 30" [class.medium]="audioLevel.level >= 30 && audioLevel.level < 60" [class.high]="audioLevel.level >= 60">
                  {{ audioLevel.level }}%
                </span>
              </div>
              <div class="peak-indicator">
                <span class="peak-label">Pico</span>
                <span class="peak-value">{{ audioLevel.peakLevel }}%</span>
              </div>
            </div>
            <div class="visualizer-placeholder" *ngIf="!isMicMonitoring">
              <lucide-angular name="audio-waveform" [size]="20"></lucide-angular>
              <span>Haz clic en "Probar" para ver el nivel de audio</span>
            </div>
          </div>

          <!-- Test Button -->
          <button
            class="test-btn-premium mic-test"
            (click)="toggleMicrophoneMonitoring()"
            [disabled]="isTestingMic"
            [class.testing]="isTestingMic"
            [class.monitoring]="isMicMonitoring"
            [class.error]="micTestResult === 'error'"
          >
            <div class="test-btn-icon">
              <lucide-angular
                [name]="isTestingMic ? 'loader-2' : (isMicMonitoring ? 'square' : (micTestResult === 'error' ? 'x-circle' : 'play'))"
                [size]="18"
                [class.spin]="isTestingMic"
              ></lucide-angular>
            </div>
            <span class="test-btn-text">
              {{ isTestingMic ? 'Iniciando...' : (isMicMonitoring ? 'Detener prueba' : (micTestResult === 'error' ? 'Error - Reintentar' : 'Probar micr&oacute;fono')) }}
            </span>
            <div class="test-btn-arrow" *ngIf="!isTestingMic && !isMicMonitoring && !micTestResult">
              <lucide-angular name="chevron-right" [size]="16"></lucide-angular>
            </div>
          </button>
        </div>

        <!-- Speaker Card -->
        <div class="audio-device-card speaker-card">
          <div class="device-card-header">
            <div class="device-icon-wrapper speaker-icon">
              <lucide-angular name="volume-2" [size]="24"></lucide-angular>
              <div class="icon-pulse"></div>
            </div>
            <div class="device-title-group">
              <h3 class="device-title">Altavoz</h3>
              <span class="device-subtitle">Salida de audio</span>
            </div>
            <div class="device-status" [class.active]="selectedOutputId !== 'default'">
              <span class="status-dot"></span>
              <span class="status-text">{{ selectedOutputId !== 'default' ? 'Personalizado' : 'Por defecto' }}</span>
            </div>
          </div>

          <div class="device-selector-wrapper">
            <div class="select-icon">
              <lucide-angular name="settings-2" [size]="16"></lucide-angular>
            </div>
            <select
              class="device-select-premium"
              [(ngModel)]="selectedOutputId"
              (ngModelChange)="onOutputDeviceSelect($event)"
            >
              <option value="default">Usar dispositivo del sistema</option>
              <option *ngFor="let device of outputDevices" [value]="device.deviceId">
                {{ device.label }}
              </option>
            </select>
          </div>

          <button
            class="test-btn-premium speaker-test"
            (click)="testSpeaker()"
            [disabled]="isTestingSpeaker"
            [class.testing]="isTestingSpeaker"
            [class.success]="speakerTestResult === 'success'"
            [class.error]="speakerTestResult === 'error'"
          >
            <div class="test-btn-icon">
              <lucide-angular
                [name]="isTestingSpeaker ? 'loader-2' : (speakerTestResult === 'success' ? 'check-circle' : (speakerTestResult === 'error' ? 'x-circle' : 'play'))"
                [size]="18"
                [class.spin]="isTestingSpeaker"
              ></lucide-angular>
            </div>
            <span class="test-btn-text">
              {{ isTestingSpeaker ? 'Reproduciendo sonido...' : (speakerTestResult === 'success' ? 'Sonido reproducido' : (speakerTestResult === 'error' ? 'Error en la prueba' : 'Probar altavoz')) }}
            </span>
            <div class="test-btn-arrow" *ngIf="!isTestingSpeaker && !speakerTestResult">
              <lucide-angular name="chevron-right" [size]="16"></lucide-angular>
            </div>
          </button>
        </div>
      </div>

      <!-- Actions Footer -->
      <div class="audio-footer">
        <button class="refresh-devices-btn" (click)="refreshAudioDevices()">
          <lucide-angular name="refresh-cw" [size]="16"></lucide-angular>
          <span>Actualizar dispositivos</span>
        </button>

        <div class="audio-info-badge">
          <lucide-angular name="zap" [size]="14"></lucide-angular>
          <span>Los cambios se aplican instant&aacute;neamente en la pr&oacute;xima llamada</span>
        </div>
      </div>
    </div>
  </main>
</div>
