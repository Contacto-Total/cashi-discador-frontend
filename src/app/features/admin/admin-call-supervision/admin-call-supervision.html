<div class="supervision-container">
  <!-- Header -->
  <div class="supervision-header">
    <button mat-icon-button (click)="goBack()">
      <lucide-angular name="arrow-left" [size]="20"></lucide-angular>
    </button>
    <h2>Supervisión de Llamada</h2>
  </div>

  <!-- Loading state -->
  <div *ngIf="!call" class="loading-container">
    <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
    <p>Cargando detalles de la llamada...</p>
  </div>

  <!-- Call details -->
  <div *ngIf="call" class="call-details-container">
    <!-- Status card -->
    <mat-card class="status-card">
      <mat-card-header>
        <mat-card-title>Estado de la Supervisión</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="status-info">
          <mat-chip [color]="getModeColor()" [highlighted]="currentMode !== 'none'">
            <lucide-angular [name]="currentMode !== 'none' ? 'eye' : 'eye-off'" [size]="16"></lucide-angular>
            {{ getModeLabel() }}
          </mat-chip>
          <div class="duration">
            <lucide-angular name="clock" [size]="20"></lucide-angular>
            <span>{{ formatDuration(callDuration) }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Call information card -->
    <mat-card class="info-card">
      <mat-card-header>
        <mat-card-title>Información de la Llamada</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <lucide-angular name="user" [size]="24"></lucide-angular>
            <div>
              <div class="info-label">Asesor</div>
              <div class="info-value">{{ call.agentName }}</div>
              <div class="info-sublabel">Ext: {{ call.agentExtension }}</div>
            </div>
          </div>

          <div class="info-item">
            <lucide-angular name="phone" [size]="24"></lucide-angular>
            <div>
              <div class="info-label">Cliente</div>
              <div class="info-value">{{ call.clientNumber }}</div>
              <div class="info-sublabel">{{ call.callState }}</div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Supervision controls -->
    <mat-card class="controls-card">
      <mat-card-header>
        <mat-card-title>Modos de Supervisión</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="mode-buttons">
          <!-- Spy Mode (Vigía) -->
          <button
            mat-raised-button
            color="accent"
            class="mode-button"
            [disabled]="currentMode !== 'none' || isConnecting"
            (click)="startSpyMode()">
            <lucide-angular name="eye" [size]="20"></lucide-angular>
            <div class="button-content">
              <span class="mode-name">Vigía</span>
              <span class="mode-description">Solo escuchar</span>
            </div>
          </button>

          <!-- Whisper Mode (Susurro) -->
          <button
            mat-raised-button
            color="primary"
            class="mode-button"
            [disabled]="currentMode !== 'none' || isConnecting"
            (click)="startWhisperMode()">
            <lucide-angular name="mic" [size]="20"></lucide-angular>
            <div class="button-content">
              <span class="mode-name">Susurro</span>
              <span class="mode-description">Hablar al agente</span>
            </div>
          </button>

          <!-- Barge Mode (Tripartita) -->
          <button
            mat-raised-button
            color="warn"
            class="mode-button"
            [disabled]="currentMode !== 'none' || isConnecting"
            (click)="startBargeMode()">
            <lucide-angular name="users" [size]="20"></lucide-angular>
            <div class="button-content">
              <span class="mode-name">Tripartita</span>
              <span class="mode-description">Unirse a la llamada</span>
            </div>
          </button>
        </div>

        <!-- Connection status -->
        <div *ngIf="isConnecting" class="connecting-status">
          <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
          <span>Conectando...</span>
        </div>

        <!-- Active controls (when connected) -->
        <div *ngIf="currentMode !== 'none'" class="active-controls">
          <button
            mat-raised-button
            [color]="isMuted ? 'warn' : ''"
            (click)="toggleMute()">
            <lucide-angular [name]="isMuted ? 'mic-off' : 'mic'" [size]="20"></lucide-angular>
            {{ isMuted ? 'Activar Micrófono' : 'Silenciar' }}
          </button>

          <button
            mat-raised-button
            color="warn"
            (click)="disconnectSupervision()">
            <lucide-angular name="phone-off" [size]="20"></lucide-angular>
            Desconectar
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Instructions card -->
    <mat-card class="instructions-card">
      <mat-card-header>
        <mat-card-title>Instrucciones</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="instruction-item">
          <lucide-angular name="eye" [size]="24" class="text-blue-500"></lucide-angular>
          <div>
            <strong>Vigía:</strong> Escuchas la conversación entre agente y cliente. Nadie puede escucharte.
          </div>
        </div>
        <div class="instruction-item">
          <lucide-angular name="mic" [size]="24" class="text-green-500"></lucide-angular>
          <div>
            <strong>Susurro:</strong> Hablas solo con el agente. El cliente no puede escucharte.
          </div>
        </div>
        <div class="instruction-item">
          <lucide-angular name="users" [size]="24" class="text-red-500"></lucide-angular>
          <div>
            <strong>Tripartita:</strong> Te unes como participante completo. Todos se escuchan.
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
