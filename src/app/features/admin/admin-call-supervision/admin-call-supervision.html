<div class="supervision-container">
  <!-- Header -->
  <div class="supervision-header">
    <button mat-icon-button (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h2>Supervisión de Llamada</h2>
  </div>

  <!-- Loading state -->
  <div *ngIf="!call" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Cargando detalles de la llamada...</p>
  </div>

  <!-- Call details -->
  <div *ngIf="call" class="call-details-container">
    <!-- Status card -->
    <mat-card class="status-card">
      <mat-card-header>
        <mat-card-title>Estado de la Supervisión</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="status-info">
          <mat-chip [color]="getModeColor()" [highlighted]="currentMode !== 'none'">
            <mat-icon>{{ currentMode !== 'none' ? 'visibility' : 'visibility_off' }}</mat-icon>
            {{ getModeLabel() }}
          </mat-chip>
          <div class="duration">
            <mat-icon>schedule</mat-icon>
            <span>{{ formatDuration(callDuration) }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Call information card -->
    <mat-card class="info-card">
      <mat-card-header>
        <mat-card-title>Información de la Llamada</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <mat-icon>person</mat-icon>
            <div>
              <div class="info-label">Agente</div>
              <div class="info-value">{{ call.agentName }}</div>
              <div class="info-sublabel">Ext: {{ call.agentExtension }}</div>
            </div>
          </div>

          <div class="info-item">
            <mat-icon>phone</mat-icon>
            <div>
              <div class="info-label">Cliente</div>
              <div class="info-value">{{ call.clientNumber }}</div>
              <div class="info-sublabel">{{ call.callState }}</div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Supervision controls -->
    <mat-card class="controls-card">
      <mat-card-header>
        <mat-card-title>Modos de Supervisión</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="mode-buttons">
          <!-- Spy Mode (Vigía) -->
          <button
            mat-raised-button
            color="accent"
            class="mode-button"
            [disabled]="currentMode !== 'none' || isConnecting"
            (click)="startSpyMode()">
            <mat-icon>visibility</mat-icon>
            <div class="button-content">
              <span class="mode-name">Vigía</span>
              <span class="mode-description">Solo escuchar</span>
            </div>
          </button>

          <!-- Whisper Mode (Susurro) -->
          <button
            mat-raised-button
            color="primary"
            class="mode-button"
            [disabled]="currentMode !== 'none' || isConnecting"
            (click)="startWhisperMode()">
            <mat-icon>record_voice_over</mat-icon>
            <div class="button-content">
              <span class="mode-name">Susurro</span>
              <span class="mode-description">Hablar al agente</span>
            </div>
          </button>

          <!-- Barge Mode (Tripartita) -->
          <button
            mat-raised-button
            color="warn"
            class="mode-button"
            [disabled]="currentMode !== 'none' || isConnecting"
            (click)="startBargeMode()">
            <mat-icon>group</mat-icon>
            <div class="button-content">
              <span class="mode-name">Tripartita</span>
              <span class="mode-description">Unirse a la llamada</span>
            </div>
          </button>
        </div>

        <!-- Connection status -->
        <div *ngIf="isConnecting" class="connecting-status">
          <mat-spinner diameter="30"></mat-spinner>
          <span>Conectando...</span>
        </div>

        <!-- Active controls (when connected) -->
        <div *ngIf="currentMode !== 'none'" class="active-controls">
          <button
            mat-raised-button
            [color]="isMuted ? 'warn' : ''"
            (click)="toggleMute()">
            <mat-icon>{{ isMuted ? 'mic_off' : 'mic' }}</mat-icon>
            {{ isMuted ? 'Activar Micrófono' : 'Silenciar' }}
          </button>

          <button
            mat-raised-button
            color="warn"
            (click)="disconnectSupervision()">
            <mat-icon>call_end</mat-icon>
            Desconectar
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Instructions card -->
    <mat-card class="instructions-card">
      <mat-card-header>
        <mat-card-title>Instrucciones</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="instruction-item">
          <mat-icon color="accent">visibility</mat-icon>
          <div>
            <strong>Vigía:</strong> Escuchas la conversación entre agente y cliente. Nadie puede escucharte.
          </div>
        </div>
        <div class="instruction-item">
          <mat-icon color="primary">record_voice_over</mat-icon>
          <div>
            <strong>Susurro:</strong> Hablas solo con el agente. El cliente no puede escucharte.
          </div>
        </div>
        <div class="instruction-item">
          <mat-icon color="warn">group</mat-icon>
          <div>
            <strong>Tripartita:</strong> Te unes como participante completo. Todos se escuchan.
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
