<div class="monitoring-container">
  <!-- Header con estadísticas -->
  <div class="monitoring-header">
    <div class="header-left">
      <div class="header-icon pulse-ring">
        <lucide-angular name="radio" [size]="24"></lucide-angular>
      </div>
      <div class="header-text">
        <h1>Centro de Monitoreo</h1>
        <p>Supervisión en tiempo real</p>
      </div>
    </div>
    <div class="header-stats">
      <div class="stat-badge" [class.active]="activeCalls.length > 0">
        <span class="stat-number">{{ activeCalls.length }}</span>
        <span class="stat-label">Llamadas Activas</span>
      </div>
    </div>
  </div>

  <!-- Leyenda de modos (compacta) -->
  <div class="modes-legend">
    <div class="legend-title" (click)="toggleLegend()">
      <lucide-angular name="info" [size]="16"></lucide-angular>
      <span>Modos de Supervisión</span>
      <lucide-angular [name]="showLegend ? 'chevron-up' : 'chevron-down'" [size]="16"></lucide-angular>
    </div>
    <div class="legend-content" [class.show]="showLegend">
      <div class="mode-chip spy">
        <lucide-angular name="eye" [size]="14"></lucide-angular>
        <span>Vigía</span>
        <small>Solo escuchar</small>
      </div>
      <div class="mode-chip whisper">
        <lucide-angular name="ear" [size]="14"></lucide-angular>
        <span>Susurro</span>
        <small>Hablar al agente</small>
      </div>
      <div class="mode-chip barge">
        <lucide-angular name="users" [size]="14"></lucide-angular>
        <span>Tripartita</span>
        <small>Todos escuchan</small>
      </div>
    </div>
  </div>

  <!-- Estado de carga -->
  @if (loading) {
    <div class="loading-state">
      <div class="loader">
        <div class="loader-ring"></div>
        <lucide-angular name="phone-call" [size]="24"></lucide-angular>
      </div>
      <p>Buscando llamadas activas...</p>
    </div>
  }

  <!-- Sin llamadas -->
  @if (!loading && activeCalls.length === 0) {
    <div class="empty-state">
      <div class="empty-icon">
        <lucide-angular name="phone-off" [size]="48"></lucide-angular>
      </div>
      <h3>No hay llamadas activas</h3>
      <p>Las llamadas en curso aparecerán aquí automáticamente</p>
      <div class="empty-animation">
        <span></span><span></span><span></span>
      </div>
    </div>
  }

  <!-- Grid de llamadas -->
  @if (!loading && activeCalls.length > 0) {
    <div class="calls-grid">
      @for (call of activeCalls; track call.callUuid; let i = $index) {
        <div class="call-card" [style.animation-delay]="i * 0.1 + 's'">
          <!-- Header de la card -->
          <div class="call-card-header">
            <div class="call-status" [class]="'status-' + call.callState.toLowerCase()">
              <span class="status-dot"></span>
              <span>{{ call.callState }}</span>
            </div>
            <div class="call-duration">
              <lucide-angular name="timer" [size]="14"></lucide-angular>
              <span>{{ formatDuration(call.duration) }}</span>
            </div>
          </div>

          <!-- Info del agente -->
          <div class="call-agent">
            <div class="agent-avatar">
              <lucide-angular name="headphones" [size]="20"></lucide-angular>
            </div>
            <div class="agent-details">
              <span class="agent-name">{{ call.agentName }}</span>
              <span class="agent-ext">Ext. {{ call.agentExtension }}</span>
            </div>
          </div>

          <!-- Info del cliente -->
          <div class="call-client">
            <lucide-angular name="phone-outgoing" [size]="16"></lucide-angular>
            <span>{{ formatPhoneNumber(call.clientNumber) }}</span>
          </div>

          <!-- Campaña -->
          @if (call.campaignName) {
            <div class="call-campaign">
              <lucide-angular name="folder" [size]="14"></lucide-angular>
              <span>{{ call.campaignName }}</span>
            </div>
          }

          <!-- Botón de acción -->
          <button class="supervise-btn" (click)="superviseCall(call)">
            <lucide-angular name="radio" [size]="18"></lucide-angular>
            <span>Supervisar</span>
            <lucide-angular name="arrow-right" [size]="16" class="arrow-icon"></lucide-angular>
          </button>
        </div>
      }
    </div>
  }
</div>
