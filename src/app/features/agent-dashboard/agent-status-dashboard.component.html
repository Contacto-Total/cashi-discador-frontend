<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>Panel de Agente</h1>
      <div class="agent-info">
        <span class="agent-name">{{ agentName }}</span>
        <button class="logout-btn" (click)="logout()">
          <span>Cerrar Sesi√≥n</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="dashboard-main">
    <!-- Loading State -->
    <div *ngIf="loading && !currentStatus" class="loading-state">
      <div class="spinner"></div>
      <p>Cargando estado...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error-state">
      <p>{{ error }}</p>
      <button (click)="loadAgentStatus(currentStatus?.idUsuario || 0)">
        Reintentar
      </button>
    </div>

    <!-- Status Dashboard -->
    <div *ngIf="currentStatus && !loading" class="status-dashboard">

      <!-- Current Status Card -->
      <div class="status-card">
        <h2>Estado Actual</h2>
        <div class="current-status">
          <div class="status-badge" [style.background-color]="getStateColor(currentStatus.estadoActual)">
            {{ stateLabels[currentStatus.estadoActual] }}
          </div>
          <div class="status-timer">
            <span class="timer-label">Tiempo en este estado:</span>
            <span class="timer-value">{{ currentTimeInState }}</span>
          </div>
        </div>
      </div>

      <!-- Change Status Section -->
      <div class="change-status-section">
        <h2>Cambiar Estado</h2>
        <p class="section-subtitle">Selecciona tu estado actual</p>

        <div class="status-buttons">
          <button
            *ngFor="let state of manualStates"
            class="status-btn"
            [class.active]="isCurrentState(state)"
            [class.disabled]="!canChangeToState(state) || loading"
            [disabled]="!canChangeToState(state) || loading"
            [style.border-color]="getStateColor(state)"
            (click)="changeStatus(state)">
            <div class="status-btn-icon" [style.background-color]="getStateColor(state)"></div>
            <span>{{ stateLabels[state] }}</span>
          </button>
        </div>
      </div>

      <!-- Manual Calling Section -->
      <div class="manual-calling-section">
        <h2>Llamadas Manuales</h2>
        <p class="section-subtitle">Inicia el modo manual para realizar llamadas sin que te caigan autom√°ticas</p>

        <button
          class="manual-call-btn"
          [disabled]="loading || currentStatus.estadoActual === AgentState.EN_LLAMADA || currentStatus.estadoActual === AgentState.TIPIFICANDO"
          (click)="enterManualMode()">
          <span class="btn-icon">üìû</span>
          <span>LLAMAR MANUAL</span>
        </button>

        <p class="manual-call-note" *ngIf="currentStatus.estadoActual === AgentState.EN_MANUAL">
          Est√°s en modo manual. Ve al softphone para hacer llamadas.
        </p>
      </div>

      <!-- Info Card -->
      <div class="info-card">
        <h3>‚ÑπÔ∏è Informaci√≥n</h3>
        <ul>
          <li><strong>Disponible:</strong> Recibir√°s llamadas autom√°ticas</li>
          <li><strong>En Reuni√≥n/Refrigerio/Ba√±o:</strong> No recibir√°s llamadas</li>
          <li><strong>Modo Manual:</strong> Puedes llamar, pero no recibes autom√°ticas</li>
        </ul>
      </div>

    </div>
  </div>
</div>
