<div class="app-container" *ngIf="!isLoginPage() && authService.isAuthenticated()">
  <!-- CASHI Navbar -->
  <nav class="cashi-navbar">
    <div class="navbar-left">
      <!-- Logo CASHI -->
      <div class="cashi-logo">
        <div class="logo-icon">
          <mat-icon>account_balance_wallet</mat-icon>
        </div>
        <span class="logo-text">CASHI</span>
      </div>

      <!-- Menu Items -->
      <div class="navbar-menu">
        <!-- Items para AGENTES -->
        <a routerLink="/agent-dashboard" routerLinkActive="active" class="nav-item" *ngIf="(authService.currentUser$ | async)?.role !== 'ADMIN'">
          <mat-icon>phone</mat-icon>
          <span>Cobranza</span>
        </a>
        <a routerLink="/contacts" routerLinkActive="active" class="nav-item" *ngIf="(authService.currentUser$ | async)?.role !== 'ADMIN'">
          <mat-icon>people</mat-icon>
          <span>Clientes</span>
        </a>

        <!-- Items para ADMIN -->
        <!-- Monitoreo Dropdown -->
        <div class="nav-item-dropdown" *ngIf="(authService.currentUser$ | async)?.role === 'ADMIN'">
          <button
            class="nav-item"
            [class.active]="isMonitoreoActive()"
            (click)="toggleMonitoreoDropdown()"
            mat-button>
            <mat-icon>supervisor_account</mat-icon>
            <span>Monitoreo</span>
            <mat-icon class="dropdown-arrow" [class.rotated]="isMonitoreoDropdownOpen">expand_more</mat-icon>
          </button>

          <!-- Dropdown Menu -->
          <div class="dropdown-menu" [class.show]="isMonitoreoDropdownOpen">
            <a routerLink="/admin/monitoring" routerLinkActive="active" class="dropdown-item" (click)="closeDropdowns()">
              <mat-icon>phone_in_talk</mat-icon>
              <div class="item-content">
                <span class="item-title">Llamadas Activas</span>
                <span class="item-desc">Supervisión en vivo</span>
              </div>
            </a>
            <a routerLink="/admin/campaign-monitoring" routerLinkActive="active" class="dropdown-item" (click)="closeDropdowns()">
              <mat-icon>dashboard</mat-icon>
              <div class="item-content">
                <span class="item-title">Métricas en Tiempo Real</span>
                <span class="item-desc">Dashboard y discado</span>
              </div>
            </a>
          </div>
        </div>

        <a routerLink="/admin/campaigns" routerLinkActive="active" class="nav-item" *ngIf="(authService.currentUser$ | async)?.role === 'ADMIN'">
          <mat-icon>campaign</mat-icon>
          <span>Campañas</span>
        </a>

        <a routerLink="/admin/extensions" routerLinkActive="active" class="nav-item" *ngIf="(authService.currentUser$ | async)?.role === 'ADMIN'">
          <mat-icon>dialpad</mat-icon>
          <span>Extensiones</span>
        </a>

        <a routerLink="/whatsapp" routerLinkActive="active" class="nav-item">
          <mat-icon>chat</mat-icon>
          <span>WhatsApp</span>
        </a>
      </div>
    </div>

    <div class="navbar-right">
      <!-- User Profile -->
      <div class="user-profile">
        <mat-icon>person</mat-icon>
        <span class="username">{{ (authService.currentUser$ | async)?.username }}</span>
      </div>

      <!-- Logout Button -->
      <button mat-button class="btn-logout" (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span>Salir</span>
      </button>
    </div>
  </nav>

  <!-- Dropdown Backdrop -->
  <div class="dropdown-backdrop" *ngIf="isMonitoreoDropdownOpen" (click)="closeDropdowns()"></div>

  <!-- Main Content -->
  <div class="main-content">
    <router-outlet></router-outlet>
  </div>
</div>

<div *ngIf="isLoginPage() || !authService.isAuthenticated()">
  <router-outlet></router-outlet>
</div>
